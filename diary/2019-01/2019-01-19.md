# 2019-01-19

## 昼散歩

- [讃岐うどんマニアが「東京で一番ウマイ」と絶賛する立ち食いうどん屋『こくわがた』 ｜ バズプラスニュース Buzz+](http://buzz-plus.com/article/2015/01/30/kokuwagata/)
- [【谷根千散策】へび道をくねくね歩く - NAVER まとめ](https://matome.naver.jp/odai/2141494502259808101)
- [2019年に谷中七福神巡りをするなら、こちらをチェック！](https://iwalkedblog.com/?p=1520)
- [北区田端・谷田川(藍染川)と谷田橋 : 東京の水 2009 fragments](https://tokyoriver.exblog.jp/13138894/)
- [駒込アザレア通り商店会 |](http://azalea-street.com/)

<iframe height='405' width='590' frameborder='0' allowtransparency='true' scrolling='no' src='https://www.strava.com/activities/2088065204/embed/00a9b3896ab5a8156342ad813fb2f6fe3536402b'></iframe>

## DRF: EndpointField

- [Serializer fields - Django REST framework](https://www.django-rest-framework.org/api-guide/fields/)
- [django-rest-framework/fields.py at master · encode/django-rest-framework](https://github.com/encode/django-rest-framework/blob/master/rest_framework/fields.py#L309)

app/utils/serializers.py:

~~~py
from django.urls import reverse
from rest_framework.fields import Field


def drf_endpoint(instance, url_name=None, pk_name='pk'):
    ''' DRF endpoint '''
    try:
        if hasattr(instance, 'get_endpoint_url'):
            return instance.get_endpoint_url()
        name = url_name or f"{instance._meta.model_name}-detail"
        return reverse(name, kwargs={pk_name: instance.pk})
    except:
        pass
    return ''


class EndpointField(Field):

    def __init__(self, **kwargs):
        kwargs['source'] = '*'
        kwargs['read_only'] = True
        self.url_name = kwargs.get('url_name', None)
        self.attr_name = kwargs.get('attr_name', None)
        super().__init__(**kwargs) 

    def to_representation(self, value):
        instance = self.attr_name and getattr(value, self.attr_name, None) or value
        url = drf_endpoint(instance, url_name=self.url_name)
        request = self.context.get('request', None)
        return request and request.build_absolute_uri(url) or url
~~~

例:

~~~py
from app.utils.serializers import EndpointField
from .. import models


class VideoSerializer(serializers.ModelSerializer):
    endpoint = EndpointField()

    class Meta:
        model = models.Video
        fields = '__all__'
~~~

## 朝散歩

<iframe height='405' width='590' frameborder='0' allowtransparency='true' scrolling='no' src='https://www.strava.com/activities/2087878613/embed/fa4df1bfbe40af19d92f7b40873bccebaadd12ca'></iframe>