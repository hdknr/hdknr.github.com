# 2019-02-15i

## Electron: expressのテンプレート配置

~~~bash
$ tree src/main/web
src/main/web
├── index.js
└── templates
    └── config
        └── index.ejs

2 directories, 2 files
~~~

index.js: 

~~~js
import { app } from 'electron'
import express from 'express'
const _BASEDIR = (process.env.NODE_ENV !== 'development') ? path.dirname(app.getAppPath()) : __dirname
const server = express()
...

function config (req, res) {
  let context = {}
  ...
  return res.render('config/index', context)
}

export async function initWebServer (mainWindow) {
  ...
  if (mainWindow) {
    const templates = path.join(_BASEDIR, '/templates')
    server.set('view engine', 'ejs')
    server.set('views', templates)
    server.get('/config', config)
    ...
    server.listen(9900, '0.0.0.0')
  }
}
~~~

packages.json:

~~~json
{
  "build": {
    ...
    "files": [
      "dist/electron/**/*"
    ],
    "extraResources": [
      {
        "from": "src/main/web",
        "to": ".",
        "filter": [
          "**/*",
          "!*.js"
        ]
      }
    ],
    ...
}
~~~

## 昼

<iframe height='405' width='590' frameborder='0' allowtransparency='true' scrolling='no' src='https://www.strava.com/activities/2149874986/embed/9561709a97a62e767ee5f46b2585c17e5d24761a'></iframe>

## asar

- [asarを使ってみる - Qiita](https://qiita.com/niusounds/items/2739fdbc26df03421bfe)

## Electron: production

- [debugging - How to programmatically detect debug mode in nodejs? - Stack Overflow](https://stackoverflow.com/questions/6889470/how-to-programmatically-detect-debug-mode-in-nodejs)
- [Distinguishing "development" from "production" · Issue #7714 · electron/electron](https://github.com/electron/electron/issues/7714)

## 朝

<iframe height='405' width='590' frameborder='0' allowtransparency='true' scrolling='no' src='https://www.strava.com/activities/2149700303/embed/ad5c521fa2171798d3c29d7996bcf1ec021f838f'></iframe>
