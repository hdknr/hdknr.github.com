6.2.2.2 One-Pass Diffie-Hellman,C(1,1,ECC CDH)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. note::
    - :ref:`jwa.4.6.2`

This section describes the One-Pass Diffie-Hellman scheme 
from :term:`ANS X9.63`. 

The prerequisites for this scheme 
shall be satisfied as specified in :ref:`Section 6.2.2 <nist-sp800-56a.6.2.2>`. 

In particular, 
:term:`party U` shall obtain the static public key Qs,V of party V.

Note that U and V must use identical orderings of the bit strings 
that are input to the key derivation function.

Party U shall execute the following key agreement transformation 
in order to a) establish a :term:`shared secret` value Z with party V, 
and b) derive shared secret keying material from Z.


Actions: U shall derive secret keying material as follows:
####################################################################

1.  Generate an ephemeral key pair (de,U, Qe,U) 
    from the domain parameters D as specified in :ref:`Section 5.6.1 <nist-sp800-56a.5.6.1>`. 

    Send the public key Qe,U to V.

2.  Use the ECC CDH primitive in :ref:`Section 5.7.1.2 <nist-sp800-56a.5.7.1.2>` 
    to derive a shared secret Z – 
    an element of the finite field of size q – 
    from the set of domain parameters D, U’s ephemeral private key de,U, and V’s static public key Qs,V. 

    If this call to the ECC CDH primitive outputs 
    an error indicator, 
    zeroize the results of all intermediate calculations used 
    in the attempted computation of Z, 
    output an error indicator, and stop.

3.  Convert Z to a byte string 
    (which is also denoted by Z) 
    using the Field-element-to-Byte- String Conversion 
    specified in Appendix C.2, and 
    then zeroize the results of all intermediate calculations 
    used in the computation of Z.

4.  Use the :ref:`agreed-upon key derivation function` 
    to derive secret keying material DerivedKeyingMaterial 
    of length keydatalen bits from the shared secret value Z and OtherInput 
    (including the identifiers IDU and IDV). 
    (See :ref:`Section 5.8 <nist-sp800-56a.5.8>`.) 

    If the key derivation function outputs an error indicator, 
    zeroize all copies of Z, output an error indicator, and stop.

5.  Zeroize all copies of the shared secret Z and output DerivedKeyingMaterial.

Output: 
    The bit string DerivedKeyingMaterial of length keydatalen bits 
    or an error indicator.
