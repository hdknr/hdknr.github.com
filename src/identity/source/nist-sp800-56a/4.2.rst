4.2 Key Agreement Process
------------------------------------

Figure 2 depicts the steps 
that may be required of an :term:`entity` when establishing secret keying material 
with another entity 
using one of the key agreement schemes 
described in this Recommendation; 
however, 
some discrepancies in order may occur, 
depending on the communication protocol in which the key agreement process is performed. 

Depending on the key agreement scheme 
and the available keys, 
either entity could be the key agreement :term:`initiator`. 

.. note::
    - スキームとキーの準備情況に応じてどっちが起点かは異なる

Note that some of the shown actions may not be a part of some schemes. 

For example, 
key confirmation is optional (see :ref:`Section 8 <nist-sp800-56a.8>`). 

The specifications of this recommendation indicate 
when a particular action is required.

Each entity obtains the identifier associated with the other entity, 
and verifies that the identifier of the other entity 
corresponds to the entity with 
whom the participant wishes to establish secret keying material.

.. note::
    - スタティックキーが欲しいとき

Each entity that requires the other entity’s static public key for use 
in the key establishment scheme obtains that 
public key and obtains assurance of its validity. 

Approved methods for obtaining assurance of 
the validity of a static public key are provided in :ref:`Section 5.6.2.2 <nist-sp800-56a.5.6.2.2>`.

.. note::
    - 一時キーが欲しいとき

Each entity that requires the other entity’s ephemeral public key for use 
in the key establishment scheme obtains 
that public key and obtains assurance of its validity. 

Ephemeral key pairs are generated as specified in :ref:`Section 5.6.1 <nist-sp800-56a.5.6.1>`; 
the ephemeral private key is not provided to the other entity. 

Approved methods for obtaining assurance of the validity of an ephemeral public key 
are provided in :ref:`Section 5.6.2.3 <nist-sp800-56a.5.6.2.3>`.

If the key agreement scheme requires that 
an entity provide a :term:`nonce`, 
the nonce is generated as specified in :term:`Section 5.4 <nist-sp800-56a.5.4>` 
and provided to the other entity.


If one or both of the participants wish to confirm 
that the other entity has computed the same :term:`shared secret` 
or the same :term:`secret keying material` 
as part of the key agreement process, 
:term:`key confirmation` is performed as specified in :ref:`Section 8.4 <nist-sp800-56a.8.4>`.

.. note::
    - 永続プライベートキーの所有の妥当性はスペックの範囲外

Assurance of static private key possession is obtained 
prior to using the derived keying material for purposes 
beyond those of the key agreement transaction itself 
(see :ref:`Section 5.6.3.2 <nist-sp800-56a.5.6.3.2>`).
