6.1.  Creating a JWS with HMAC SHA-256, HMAC SHA-384, or HMAC SHA-512
------------------------------------------------------------------------------

Hash based Message Authentication Codes (:term:`HMACs <HMAC>`) enable one 
to use a **secret** plus a cryptographic **hash function** 
to generate a Message Authentication Code (:term:`MAC`). 

This can be used to demonstrate that the MAC matches the hashed content, 
in this case the :term:`JWS Signing Input`, 
which therefore demonstrates that whoever generated the MAC was in possession of the secret. 
The means of exchanging the shared key is outside the scope of this specification.

The algorithm for implementing and validating HMACs is provided in RFC 2104 [:rfc:`2104`]. 
This section defines 
the use of the HMAC SHA-256, HMAC SHA-384, and HMAC SHA-512 cryptographic hash functions 
as defined in FIPS 180-3 [FIPS.180â€‘3]. 

The reserved :term:`alg` header parameter values 
HS256, HS384, and HS512 are used in the :term:`JWS Header` to indicate that 
the :term:`Encoded JWS Signature` contains a base64url encoded HMAC value 
using the respective hash function.

The HMAC SHA-256 MAC is generated as follows:

    1.  Apply the HMAC SHA-256 algorithm to the UTF-8 representation of 
        the :term:`JWS Signing Input` using the shared key to produce an HMAC.
    2.  Base64url encode the HMAC, as defined in this specification.

The output is the :term:`Encoded JWS Signature` for that JWS.

The HMAC SHA-256 MAC for a JWS is validated as follows:

    1.  Apply the HMAC SHA-256 algorithm to the UTF-8 representation of 
        the :term:`JWS Signing Input` of the JWS using the shared key.
    2.  Base64url encode the previously generated HMAC, 
        as defined in this specification.
    3.  If the :term:`JWS Signature` and the previously calculated value exactly match, 
        then one has confirmation that the key was used to generate the HMAC 
        on the JWS and that the contents of the JWS have not be tampered with.
    4.  If the validation fails, the signed content MUST be rejected.

Signing with the HMAC SHA-384 and HMAC SHA-512 algorithms is performed identically 
to the procedure for HMAC SHA-256 - just with correspondingly longer key and result values. 

(v.03)
