4.7.2.  Key Derivation for ECDH Key Agreement
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The key derivation process derives the agreed upon key from the
shared secret Z established through the ECDH algorithm, per Section
6.2.2.2 of [NIST.800-56A].

Key derivation is performed using the Concat KDF, as defined in
Section 5.8.1 of [NIST.800-56A], where the Digest Method is SHA-256.
The Concat KDF parameters are set as follows:

.. glossary::

   Z  
      This is set to the representation of the shared secret Z as an
      octet sequence.

   keydatalen  
      This is set to the number of bits in the desired output
      key.  For "ECDH-ES", this is length of the key used by the "enc"
      algorithm.  For "ECDH-ES+A128KW", "ECDH-ES+A192KW", and
      "ECDH-ES+A256KW", this is 128, 192, and 256, respectively.

   AlgorithmID  
      In the Direct Key Agreement case, this is set to the
      octets of the UTF-8 representation of the "enc" header parameter
      value.  In the Key Agreement with Key Wrapping case, this is set
      to the octets of the UTF-8 representation of the "alg" header
      parameter value.

   PartyUInfo  
      The PartyUInfo value is of the form Datalen || Data,
      where Data is a variable-length string of zero or more octets, and
      Datalen is a fixed-length, big endian 32 bit counter that
      indicates the length (in octets) of Data, with || being
      concatenation.  If an "apu" (agreement PartyUInfo) header
      parameter is present, Data is set to the result of base64url
      decoding the "apu" value and Datalen is set to the number of
      octets in Data.  Otherwise, Datalen is set to 0 and Data is set to
      the empty octet sequence.

   PartyVInfo  
      The PartyVInfo value is of the form Datalen || Data,
      where Data is a variable-length string of zero or more octets, and
      Datalen is a fixed-length, big endian 32 bit counter that
      indicates the length (in octets) of Data, with || being
      concatenation.  If an "apv" (agreement PartyVInfo) header
      parameter is present, Data is set to the result of base64url
      decoding the "apv" value and Datalen is set to the number of
      octets in Data.  Otherwise, Datalen is set to 0 and Data is set to
      the empty octet sequence.

   SuppPubInfo  
      This is set to the keydatalen represented as a 32 bit
      big endian integer.

   SuppPrivInfo  
      This is set to the empty octet sequence.

See Appendix D for an example key agreement computation using this
method.

Note: The Diffie-Hellman Key Agreement Method [RFC2631] uses a key
derivation function similar to the Concat KDF, but with fewer
parameters.  Rather than having separate PartyUInfo and PartyVInfo
parameters, it uses a single PartyAInfo parameter, which is a random
string provided by the sender, that contains 512 bits of information,
when provided.  It has no SuppPrivInfo parameter.  Should it be
appropriate for the application, key agreement can be performed in a
manner akin to RFC 2631 by using the PartyAInfo value as the "apu"
(Agreement PartyUInfo) header parameter value, when provided, and by
using no "apv" (Agreement PartyVInfo) header parameter.

( https://tools.ietf.org/html/draft-ietf-jose-json-web-algorithms-14#section-4.7.2 )
