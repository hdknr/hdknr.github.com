3.1.  Creating a JWS with HMAC SHA-256, HMAC SHA-384, or HMAC SHA-512
--------------------------------------------------------------------------------

.. note::
    HMAC section

Hash based Message Authentication Codes (HMACs) enable 
one to use a **secret** plus a :term:`cryptographic hash function` 
to generate a Message Authentication Code (MAC). 
This can be used to demonstrate that 
the :term:`MAC` matches the hashed content, 
in this case the :term:`JWS Secured Input`, 
which therefore demonstrates that whoever generated the MAC was in possession of the secret. 
The means of exchanging the :term:`shared key` [#]_ is outside the scope of this specification.

.. [#] Shared secret ? 

The algorithm for implementing and validating HMACs is provided in RFC 2104 [:term:`RFC2104`]. 
This section defines the use of the 
HMAC SHA-256, 
HMAC SHA-384, and 
HMAC SHA-512 
cryptographic hash functions as defined in FIPS 180-3 [:term:`FIPS.180â€‘3`]. 
The :term:`alg` (algorithm) header parameter values :term:`HS256`, :term:`HS384`, and :term:`HS512` 
are used in the :term:`JWS Header` 
to indicate that the :term:`Encoded JWS Signature` 
contains a :term:`base64url` encoded :term:`HMAC` value 
using the respective hash function.

The HMAC SHA-256 MAC is generated as follows:

    1.  Apply the :term:`HMAC SHA-256` algorithm to the UTF-8 representation of the :term:`JWS Secured Input` 
        using the :term:`shared key` to produce an :term:`HMAC` value.
    2.  :term:`Base64url` encode the resulting HMAC value.
    3.  The output is the :term:`Encoded JWS Signature` for that :term:`JWS`.

The HMAC SHA-256 MAC for a JWS is validated as follows:

    1.  Apply the :term:`HMAC SHA-256` algorithm to the UTF-8 representation of the :term:`JWS Secured Input` 
        of the JWS using the :term:`shared key`.
    2.  :term:`Base64url` encode the resulting :term:`HMAC` value.
    3.  If the :term:`JWS Signature` and the base64url encoded HMAC value exactly match, 
        then one has confirmation that the :term:`shared key` was used to generate the HMAC 
        on the JWS and that the contents of the JWS have not be tampered with.
    4.  If the validation fails, the JWS MUST be rejected.

Securing content with the :term:`HMAC SHA-384` and :term:`HMAC SHA-512` algorithms is performed identically 
to the procedure for :term:`HMAC SHA-256` - just with correspondingly longer key and result values.


(00)
