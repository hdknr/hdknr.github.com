4.8. Key Encryption with PBES2
------------------------------------------------------------


This section defines the specifies of performing password-based
encryption of a JWE CEK, by first deriving a key encryption key from
a user-supplied password using PBES2 schemes as specified in Section
6.2 of [RFC2898], then by encrypting the JWE CEK using the derived
key.

These algorithms use HMAC SHA-2 algorithms as the Pseudo-Random
Function (PRF) for the PBKDF2 key derivation and AES Key Wrap
[RFC3394] for the encryption scheme.  The PBES2 password input is an
octet sequence; if the password to be used is represented as a text
string rather than an octet sequence, the UTF-8 encoding of the text
string MUST be used as the octet sequence.  
The salt parameter MUST be computed from the "p2s" (PBES2 salt input) Header Parameter value, 
and the "alg" (algorithm) Header Parameter value as specified in the
"p2s" definition below.

The iteration count parameter MUST be provided as
the "p2c" Header Parameter value.  The algorithms respectively use
HMAC SHA-256, HMAC SHA-384, and HMAC SHA-512 as the PRF and use 128,
192, and 256 bit AES Key Wrap keys.  Their derived-key lengths
respectively are 16, 24, and 32 octets.


The following "alg" (algorithm) Header Parameter values are used to
indicate that the JWE Encrypted Key is the result of encrypting the
CEK using the result of the corresponding password-based encryption
algorithm as the key encryption key for the corresponding key
wrapping algorithm:

    +---------------------+---------------------------------------------+
    | alg Parameter Value | Key Management Algorithm                    |
    +---------------------+---------------------------------------------+
    | PBES2-HS256+A128KW  | PBES2 with HMAC SHA-256 and "A128KW"        |
    |                     | wrapping                                    |
    +---------------------+---------------------------------------------+
    | PBES2-HS384+A192KW  | PBES2 with HMAC SHA-384 and "A192KW"        |
    |                     | wrapping                                    |
    +---------------------+---------------------------------------------+
    | PBES2-HS512+A256KW  | PBES2 with HMAC SHA-512 and "A256KW"        |
    |                     | wrapping                                    |
    +---------------------+---------------------------------------------+

See Appendix C of JSON Web Key (JWK) [JWK] for an example key
encryption computation using "PBES2-HS256+A128KW".

(draft21)
