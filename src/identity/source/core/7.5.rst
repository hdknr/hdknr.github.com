7.5.  Self-Issued ID Token Validation
--------------------------------------------------------

To validate the ID Token received, 
the Client MUST do the following:

    1.  The Client MUST validate that 
        the value of the :term:`iss` (issuer) Claim is https://self-isued.me. 

        If :term:`iss` contains a different value, 
        the ID Token is not Self-Issued, 
        and instead it MUST be validated according to Section 3.1.3.7.

    2.  The Client MUST validate that 
        the :term:`aud` (audience) Claim contains the value of the :term:`redirect_uri` 
        that the Client sent in the Authentication Request as an audience.

    3.  The Client MUST validate the signature of the ID Token according 
        to JWS [JWS] using the algorithm specified 
        in the :term:`alg` parameter of the JWT header [JWT], 
        using the key in the sub_jwk Claim; 
        the key is a bare key in JWK format 
        (not an X.509 certificate value).

    4.  The alg value SHOULD be the default of RS256. 
        It MAY also be ES256.

    6.  The Client MUST validate that the sub (subject) Claim value 
        is the base64url encoded SHA-256 hash of the concatenation 
        of the octets of the UTF-8 representations of the base64url encoded key values 
        in the :term:`sub_jwk` Claim. 

        When the :term:`kty` value is RSA, 
        the key values n and e are concatenated in that order. 

        When the kty value is EC, the key values crv, x, and y are concatenated in that order.

    7.  The current time MUST be before the time represented by the exp Claim 
        (possibly allowing for some small leeway to account for clock skew).

    8.  The iat Claim can be used to reject tokens that were issued 
        too far away from the current time, 
        limiting the amount of time that nonces need to be stored to prevent attacks. 

        The acceptable range is Client specific.

    9.  If a nonce value was sent in the Authentication Request, 
        a nonce Claim MUST be present and its value of the checked to verify 
        that it is the same value as the one that was sent in the Authentication Request. 

        The Client SHOULD check the nonce value for replay attacks. 

        The precise method for detecting replay attacks is Client specific.

The following is a non-normative example of a base64url decoded Self-Issued ID Token 
(with line wraps within values for display purposes only):

.. code-block:: javascript

  {
   "iss": "https://self-issued.me",
   "sub": "wBy8QvHbPzUnL0x63h13QqvUYcOur1X0cbQpPVRqX5k",
   "aud": "https://client.example.org/cb",
   "nonce": "n-0S6_WzA2Mj",
   "exp": 1311281970,
   "iat": 1311280970,
   "sub_jwk": {
     "kty":"RSA",
     "n": "0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx
     4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRXjBZCiFV4n3oknjhMs
     tn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2
     QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6qMQvRL5hajrn1n91CbOpbI
     SD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqb
     w0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw",
     "e":"AQAB"
    }
  }

(draft17)
