6.2.  Passing a Request Object by Reference
----------------------------------------------------

The :term:`request_uri` Authorization Request parameter 
enables OpenID Connect requests to be passed by reference, 
rather than by value. 

This parameter is used identically to the request parameter, 
other than that the Request Object value is retrieved 
from the resource at the specified URL, rather than passed by value.

The :term:`request_uri_parameter_supported` :doc:`Discovery` 
result indicates whether the OP supports this parameter. 
Should an OP not support this parameter and an RP uses it, 
the OP MUST return the :term:`request_uri_not_supported` error.

When the :term:`request_uri` parameter is used, 
the OpenID Connect request parameter values 
contained in the referenced JWT supersede those passed 
using the OAuth 2.0 request syntax. 

.. note::
    - Request Objectを事前キャッシュできる
    - state, nonce はOAuth2でわたす

However, 
parameters MAY also be passed using the OAuth 2.0 request syntax 
even when a request_uri is used; 
this would typically be done to enable a cached, pre-signed 
(and possibly pre-encrypted) Request Object value 
to be used containing the fixed request parameters, 
while parameters that can vary with each request, 
such as :term:`state` and :term:`nonce`, 
are passed as OAuth 2.0 parameters.

.. note::
    - response_type , clinet_id は必須。なぜならばOAuth2
    - Requdst Objectの中の値と一致する必要あるよ

So that the :term:`request` is a valid OAuth 2.0 Authorization Request, 
values for the response_type and client_id parameters 
MUST be included using the OAuth 2.0 request syntax, 
since they are REQUIRED by OAuth 2.0. 
The values for these parameters MUST match those 
in the Request Object, if present.

.. note::
    - scope=openid も必要

Even if a :term:`scope` parameter is present 
in the referenced Request Object, 
a :term:`scope` parameter MUST always be passed 
using the OAuth 2.0 request syntax 
containing the :term:`openid` scope value to indicate 
to the underlying OAuth 2.0 logic 
that this is an OpenID Connect request.

.. note::
    - uri fragmentに Request Objectのハッシュを入れとく

Servers MAY cache the contents of the resources referenced by Request URIs. 
If the contents of the referenced resource could ever change, 
the URI SHOULD include the :term:`base64url` encoded SHA-256 hash 
of the referenced resource contents as the :term:`fragment component` of the URI. 
If the fragment value used for a URI changes, 
that signals the server that any cached value 
for that URI with the old fragment value is no longer valid.

Note that Clients MAY pre-register request_uri values 
using the request_uris parameter defined in Section 2.1 
of the OpenID Connect Dynamic Client Registration 1.0 [OpenID.Registration] specification. 
OPs can require that request_uri values used be pre-registered 
with the :term:`require_request_uri_registration` discovery parameter.

The entire Request URI MUST NOT exceed 512 ASCII characters.

The contents of the resource referenced by the URL MUST be a Request Object. 
The scheme used in the :term:`request_uri` value MUST be **https**, 
unless the target Request Object is signed in a way that is verifiable 
by the Authorization Server. 

The :term:`request_uri` value MUST be reachable by the Authorization Server, 
and SHOULD be reachable by the Client.

The following is a non-normative example of the contents of 
a Request Object resource that can be referenced by a request_uri 
(with line wraps within values for display purposes only):

::

  eyJhbGciOiJSUzI1NiIsImtpZCI6ImsyYmRjIn0.ew0KICJpc3MiOiAiczZCaGRSa3
  F0MyIsDQogImF1ZCI6ICJodHRwczovL3NlcnZlci5leGFtcGxlLmNvbSIsDQogInJl
  c3BvbnNlX3R5cGUiOiAiY29kZSBpZF90b2tlbiIsDQogImNsaWVudF9pZCI6ICJzNk
  JoZFJrcXQzIiwNCiAicmVkaXJlY3RfdXJpIjogImh0dHBzOi8vY2xpZW50LmV4YW1w
  bGUub3JnL2NiIiwNCiAic2NvcGUiOiAib3BlbmlkIiwNCiAic3RhdGUiOiAiYWYwaW
  Zqc2xka2oiLA0KICJub25jZSI6ICJuLTBTNl9XekEyTWoiLA0KICJtYXhfYWdlIjog
  ODY0MDAsDQogImNsYWltcyI6IA0KICB7DQogICAidXNlcmluZm8iOiANCiAgICB7DQ
  ogICAgICJnaXZlbl9uYW1lIjogeyJlc3NlbnRpYWwiOiB0cnVlfSwNCiAgICAgIm5p
  Y2tuYW1lIjogbnVsbCwNCiAgICAgImVtYWlsIjogeyJlc3NlbnRpYWwiOiB0cnVlfS
  wNCiAgICAgImVtYWlsX3ZlcmlmaWVkIjogeyJlc3NlbnRpYWwiOiB0cnVlfSwNCiAg
  ICAgInBpY3R1cmUiOiBudWxsDQogICAgfSwNCiAgICJpZF90b2tlbiI6IA0KICAgIH
  sNCiAgICAgImdlbmRlciI6IG51bGwsDQogICAgICJiaXJ0aGRhdGUiOiB7ImVzc2Vu
  dGlhbCI6IHRydWV9LA0KICAgICAiYWNyIjogeyJ2YWx1ZXMiOiBbInVybjptYWNlOm
  luY29tbW9uOmlhcDpzaWx2ZXIiXX0NCiAgICB9DQogIH0NCn0.nwwnNsk1-Zkbmnvs
  F6zTHm8CHERFMGQPhos-EJcaH4Hh-sMgk8ePrGhw_trPYs8KQxsn6R9Emo_wHwajyF
  KzuMXZFSZ3p6Mb8dkxtVyjoy2GIzvuJT_u7PkY2t8QU9hjBcHs68PkgjDVTrG1uRTx
  0GxFbuPbj96tVuj11pTnmFCUR6IEOXKYr7iGOCRB3btfJhM0_AKQUfqKnRlrRscc8K
  ol-cSLWoYE9l5QqholImzjT_cMnNIznW9E7CDyWXTsO70xnB4SkG6pXfLSjLLlxmPG
  iyon_-Te111V8uE83IlzCYIb_NMXvtTIVc1jpspnTSD7xMbpL-2QgwUsAlMGzw

(draft17)
