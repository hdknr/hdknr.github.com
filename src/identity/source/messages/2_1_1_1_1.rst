2.1.1.1.1.  Pairwise Identifier Algorithm
####################################################

The Provider MUST calculate a unique :term:`user_id` value for each :term:`Sector Identifier`.

Providers who use pairwise user_id values SHOULD support the :term:`sector_identifier_url` 
in Dynamic Client Registration [:term:`OpenID.Registration`]

It provides a way for a group of websites 
under a single administrative control to have consistent pairwise user_id values independent of the individual domain names.

It also provides a way for Clients to change :term:`redirect_uri` domains without having to reregister all of their users.

If the Client has not provided a value for :term:`sector_identifier_url` in Dynamic Client Registration [OpenID.Registration], 
the Sector Identifier used for pairwise identifier calculation is the host component of the registered redirect_uri.

If there are multiple hostnames in the registered redirect_uris, 
the Client MUST register a sector_identifier_url. 
When a sector_identifier_url is provided, 
the host component of that URL is used as the Sector Identifier for the pairwise identifier calculation.

The value of the :term:`sector_identifier_url` must be a HTTPS URL 
that points to a JSON file containing an array of redirect_uri values. 
The values of the registered redirect_uris must be included in the elements of the array, 
or the registration MUST fail.

A number of algorithms MAY be used by Providers to calculate the pairwise identifier. 
This specification includes **three** examples.

The Sector Identifier can be concatenated with a local account ID and a salt value that is kept secret by the Provider. The concatenated string is then hashed by an appropriate algorithm.

Calculate user_id = SHA256 ( sector_identifier | local_account_id | salt ).

The Sector Identifier can be concatenated with a local account ID and a salt value that is kept secret by the Provider. The concatenated string is then encrypted by an appropriate algorithm.

Calculate user_id = AES128 ( sector_identifier | local_account_id | salt ).

The Issuer creates a Globally Unique Identifier (GUID) for the tupple of Sector Identifier and local account ID. This is stored in a table and the value looked up each time.

.. note::
    Sample identifire issuing

        1.  SHA256
        2.  AES128
        3.  GUID

(draft 07 )
