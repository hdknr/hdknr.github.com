2.1.1.  ID Token
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The :term:`ID Token` is a token 
that contains :term:`Claims` about the authentication event and other requested Claims. 
The Token is a JSON Web Token (JWT) [:term:`JWT`].

The :term:`ID Token` is used to manage the authentication event 
and user identifier and is scoped to a particular :term:`Client` 
via the :term:`aud` (audience) and :term:`nonce` Claims. 
It is used as an :term:`Access Token` for the :term:`Check ID Endpoint`, 
or consumed directly by the client.

The following Claims are REQUIRED and OPTIONAL within the ID Token: 

.. glossary::


    iss
        REQUIRED. 

        The :term:`Issuer Identifier` for the :term:`Issuer` of the response. 

    user_id
        REQUIRED. 

        A locally unique and never reassigned identifier 
        within the :term:`Issuer` for the :term:`End-User`, 
        which is intended to be consumed by the :term:`Client`. 
        e.g. 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4. 

        It MUST NOT exceed **255 ASCII characters in length**. 

    aud
        REQUIRED. 

        This member identifies the :term:`audience` 
        that this :term:`ID Token` is intended for. 

        It MUST be the OAuth 2.0 :term:`client_id` of the Client. 

    exp
        REQUIRED. 

        Type Integer. 

        Identifies the expiration time on or after 
        which the :term:`ID Token` MUST NOT be accepted for processing. 

        The processing of this parameter requires 
        that the current date/time MUST be before the expiration date/time listed in the value. 

        Implementers MAY provide for some small leeway, [#]_
        usually no more than a few minutes, 
        to account for clock skew. [#]_ 

        The value is number of **seconds** from 1970-01-01T0:0:0Z as measured 
        in :term:`UTC` until the desired date/time. 

        See RFC 3339 [:term:`RFC3339`] for details 
        regarding date/times in general and UTC in particular. 

    iat
        REQUIRED. 

        Type Integer. 

        The iat (issued at) Claim identifies the time at which the JWT was issued. 
    
        The value is number of **seconds** from 1970-01-01T0:0:0Z 
        as measured in UTC until the desired date/time.

        See RFC 3339 [:term:`RFC3339`] for details regarding date/times 
        in general and UTC in particular. 

    acr
        OPTIONAL. 
        (:term:`Authentication Context Class Reference`): 

        Specifies an :term:`Authentication Context Class Reference` of the :term:`ID Token`. 

        The values "1", "2", "3", and "4" map to the ITU-T X.1254 | ISO/IEC 29115 [:term:`ISO29115`] 
        :term:`entity authentication assurance level` of the authentication performed. 

        The value "0" indicates 
        the :term:`End User` authentication did not meet the requirements of ISO/IEC 29115 level 1. 
        Authentication using a long-lived browser cookie, for instance, 
        is one example where the use of "level 0" is appropriate. 

        Authentications with level 0 should never be used to authorize access 
        to any resource of any monetary value. 
        (This corresponds to the OpenID 2.0 :term:`PAPE` :term:`nist_auth_level` 0.) 
        An absolute URI or a registered short name [:term:`LoA.Registry`] MAY be used as an acr value.

    nonce
        Clients MUST verify that the :term:`nonce` value is equal to 
        the value of the :term:`nonce` parameter in the :term:`Authorization Request`. 

        A string value used to associate a Client session with an :term:`ID Token`, 
        and to mitigate replay attacks. 

        The value is passed through unmodified from the :term:`Authorization Request` to the ID Token. 
        If present in the :term:`ID Token`, 
        clients MUST verify that the :term:`nonce` Claim value is equal 
        to the value of the :term:`nonce` parameter sent in the :term:`Authorization Request`. 

        If present in the :term:`Authorization Request`, 
        :term:`Authorization Servers` MUST include a :term:`nonce` Claim 
        in the :term:`ID Token` with the Claim value being the :term:`nonce` value 
        sent in the :term:`Authorization Request`. 

        Use of the :term:`nonce` is REQUIRED when using the :term:`implicit flow` 
        and OPTIONAL when using the :term:`code flow`. 

    auth_time
        OPTIONAL. 
        If the :ref:`id_token <messages_2_1_2_1_2>` member of 
        the :ref:`OpenID Request Object <messages_2_1_2_1>` contains the Claim request :term:`auth_time`, 
        then this :term:`Claim` is REQUIRED. 
        The :term:`Claim` Value is the number of seconds from 1970-01-01T0:0:0Z 
        as measured in UTC until the date/time 
        that the :term:`End-User` authentication occurred. 
        (The "auth_time" Claim semantically corresponds to 
        the OpenID 2.0 [OpenID.PAPE] auth_time response parameter.) 

    at_hash
        OPTIONAL. 

        If the :term:`ID Token` is issued with a :term:`access_token` in a :term:`implicit flow` this is **REQUIRED**. 

        The value is produced by base64url encoding the **left-most half** of the hash 
        created by hashing the :term:`access_token` with the :term:`SHA-2` hash algorithm of the same length 
        as the hash used in the :term:`alg` paramater of the :term:`JWS header`. 

        For instnace,
        if the :term:`alg` is :term:`HS256`, hash :term:`access_token` with :term:`SHA-256`, 
        then take the left-most 128bits and base64url encode them.

    c_hash
        OPTIONAL. 
    
        If the :term:`ID Token` is issued with a :term:`code` in a :term:`implicit flow` this is **REQUIRED**. 


        The value is produced by base64url encoding the **left-most half** of the hash 
        created by hashing the :term:`code` with the :term:`SHA-2` hash algorithm of the same length as the hash 
        used in the :term:`alg` paramater of the :term:`JWS header`. 

        For instance,
        if the :term:`alg` is :term:`HS256`, hash code with :term:`SHA-256`, 
        then take the left-most 128bits and base64url encode them.

.. note::

    :term:`auth_time` is atom time format, while :term:`exp` and :term:`iat` are integer.
    ( http://lists.openid.net/pipermail/openid-specs-ab/Week-of-Mon-20120312/001683.html )

.. note::

    :term:`at_hash`, :term:`c_hash` are joined! (Draft 09)
    ( https://bitbucket.org/openid/connect/issue/510 )

.. [#]  2. A margin of freedom or variation, as of activity, 
        time, or expenditure; latitude. See Synonyms at room.
        ( http://www.thefreedictionary.com/leeway ) 

.. [#]  http://encyclopedia.thefreedictionary.com/clock+skew

:term:`ID Tokens` MUST be signed using JWS [:term:`JWS`] 
and OPTIONALLY both signed and encrypted using JWS [:term:`JWS`] 
and JWE [:term:`JWE`] respectively, 
thereby providing :ref:`authentication, integrity, non-repudiation and/or confidentiality <messages_8_13>`.

Clients MUST directly validate the :term:`ID Token` per :ref:`ID Token Verification <messages_5_2>`.


(draft 10)
(http://openid.net/specs/openid-connect-messages-1_0.html#id_token )
