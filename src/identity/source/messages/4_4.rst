4.4.  Encryption
------------------------------

The encrypting party MUST select an :term:`encryption algorithm` 
based on the supported algorithms of the recipient in :ref:`Section 4.1 <messages_4_1>`.

All :term:`JWT` MUST be **signed before encryption** to provide :term:`integrity` 
and to verify the :term:`Issuer`.

:term:`Symmetric Encryption` algorithms 
that provide an :term:`integrated integrity check` MUST be used 
if supported by both the sender and receiver. 
The :term:`A128GCM` and :term:`A256GCM` algorithms support this.

.. glossary::

    Symmetric Encryption
        Use the :term:`client_secret` to :term:`KeyWrap` 
        a random :term:`Content Encryption Key` to be used for encrypting the signed :term:`JWT`. 

    Asymmetric Encryption RSA
        Use the link registered/discovered in :ref:`Section 4.2 <messages_4_2>` 
        to retrieve the relevant key. 
        The :term:`jwk_encryption_url` or :term:`x509_encryption_url` link MUST be used if provided. 
    
        If there are multiple keys in the referenced :doc:`JWK document <jwk>`, 
        the :term:`kid` MUST be specified in the :term:`JWS header`. 
        
        If there are multiple certificates at the referenced certificate location, 
        then :term:`x5t` MUST be specified in the :term:`JWS header`. 
        Use the supported RSA :term:`KeyWrap` algorithm 
        to :term:`KeyWrap` a random :term:`Content Encryption Key` to be used for encrypting 
        the signed :term:`JWT`. 

        The :term:`key usage` of the respective keys MUST include encryption. 
        In particular, 
        if the key found through :term:`x5u` is used, 
        the key usage MUST include :term:`keyEncipherment`. 

    Asymmetric Encryption Elliptic Curve
        Create an ephemeral Elliptic Curve public key for the :term:`epk` element of 
        the :term:`JWE header`. 
        Use the link registered/discovered in :ref:`Section 4.2 <messages_4_2>`  
        to retrieve the relevant key. 

        The :term:`jwk_encryption_url` or :term:`x509_encryption_url` link 
        MUST be used if provided. 

        If there are multiple keys in the referenced :doc:`JWK document <jwk>`, 
        the :term:`kid` MUST be specified in the :term:`JWE header`. 

        If there are multiple certificates at the referenced certificate location, 
        then :term:`x5t` MUST be specified in the :term:`JWS header`. 

        Use the :term:`ECDH-ES` algorithm 
        to :term:`KeyWrap` a random :term:`Content Encryption Key` to be used 
        for encrypting the signed :term:`JWT`. 

        The :term:`key usage` of the respective keys MUST include encryption. 
        In particular, 
        if the key found through :term:`x5u` is used, 
        the key usage MUST include :term:`keyEncipherment`. 

( draft 07 : http://openid.bitbucket.org/openid-connect-messages-1_0.html#enc )
