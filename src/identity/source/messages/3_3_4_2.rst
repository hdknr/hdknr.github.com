3.3.4.2.  Aggregated and Distributed Claims
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Aggregated and distributed claims are represented 
within the "_claim_names" and "_claim_sources" members of a claim object. 
Both "_claim_names" and "_claim_sources" members are claim objects.

.. glossary::

    _claim_names
        This is a JSON object whose member names are the claims names for the aggregated and distributed claims. 
        The member values are references to the member names in the "_claim_sources" member of the claim object 
        from which the actual value can be retrieved. 

    _claim_sources
        This is a JSON object whose member names are referenced by the member values of 
        the "_claim_names" member of the claim object. 
        The member values contain sets of aggregated claims or reference locations for distributed claims. 
        The member values can have one of the following formats depending on whether it's providing aggregated or distributed claims:

            Aggregated Claims
                A JSON object which MUST contain the "JWT" member 
                whose value is a JWT [JWT] which MUST contain all the claims 
                in the "_claim_names" object which references the corresponding "_claim_sources" member. 
                Other members MAY be present if they are understood by both parties.

                    JWT
                        REQUIRED. JWT Value 

            Distributed Claims
                A JSON object which contains the following members and values:

                    endpoint
                        REQUIRED. 
                        The value is the OAuth 2.0 resource endpoint from which the associated claim can be retrieved. 
                        The endpoint URL MUST return the claim as a JWT. 

                    access_token
                        OPTIONAL. 
                        Access token enabling retrieval of the claims from the endpoint URL by 
                        using the OAuth 2.0 Bearer [OAuth.2.0.Bearer] scheme. 
                        Claims SHOULD be requested using the Authorization request header field 
                        and claims sources MUST support this method. 
                        If the access token is not available, 
                        clients MAY need to retrieve the access token out of band 
                        or use an a priori access token that was negotiated between the claim source and client, 
                        or the claim source MAY reauthenticate the user and/or reauthorize the client. 

        Other members MAY be present, if understood by both parties 

The following is a non-normative response with aggregated claims:

Claims Provider A contains the following claims for Jane Doe :

.. code-block:: javascript

    {
       "address": "1234 Hollywood Blvd., Los Angeles, CA 90210",
       "phone_number": "+1 (310) 123-4567"
    }
    

Claims Provider A signs the JSON claims, resulting in a signed JWT:

::

    jwt_header.jwt_part2.jwt_part3


Authorization Server returns Jane Doe's aggregated claims from Claims Provider A :

.. code-block:: javascript

    {
     "name": "Jane Doe",
     "given_name": "Jane",
     "family_name": "Doe",
     "birthday": "01/01/2001",
     "eye_color": "blue",
     "email": "janedoe@example.com",
     "_claim_names": {
       "address": "src1",
       "phone_number": "src1",
      },
     "_claim_sources": {
       "src1": {"JWT": "jwt_header.jwt_part2.jwt_part3"},
      }
    }


The following is a non-normative response with distributed claims:

Claims Provider A (Jane Doe's Bank) contains the following claims for Jane Doe :

.. code-block:: javascript

    {
       "shipping_address": "1234 Hollywood Blvd., Los Angeles, CA 90210",
       "payment_info": "Some_Card 1234 5678 90123 4562"
       "phone_number": "+1 (310) 123-4567"
    }
    

A Claims Provider B (Credit Agency) contains the following claims for Jane Doe :

.. code-block:: javascript

    {
       "credit_score": "650"
    }
    

Authorization Server returns Jane Doe's claims along 
with the distributed claims from Claims Provider A and B 
by sending the access tokens and URL locations where the claims may be retrieved.

.. code-block:: javascript

   {
    "name": "Jane Doe",
    "given_name": "Jane",
    "family_name": "Doe",
    "email": "janedoe@example.com",
    "birthday": "01/01/2001",
    "eye_color": "blue",
    "_claim_names": {
      "payment_info": "src1",
      "shipping_address": "src1",
      "credit_score": "src2"
     },
    "_claim_sources": {
      "src1": {"endpoint": "https://bank.example.com/claimsource"},
      "src2": {"endpoint": "https://creditagency.example.com/claimshere", "access_token": "ksj3n283dke"}
     }
   }
