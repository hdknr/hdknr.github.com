2.5.2.  Aggregated and Distributed Claims
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Aggregated and distributed Claims are represented by 
using special :term:`_claim_names` and :term:`_claim_sources` members of the JSON object containing the Claims.

.. glossary::

    _claim_names
        This value is a JSON object 
        whose member names are the Claim Names 
        for the Aggregated and Distributed Claims. 

        The member values are references to the member names 
        in the :term:`_claim_sources` member from 
        which the actual Claim Values can be retrieved. 

    _claim_sources
        This value is a JSON object 
        whose member names are referenced by the member values 
        of the :term:`_claim_names` member. 

        The member values contain sets of Aggregated Claims 
        or reference locations for Distributed Claims. 

        The member values can have one of the following formats 
        depending on whether it is providing Aggregated or Distributed Claims:


            Aggregated Claims
                A JSON object that MUST contain the JWT member whose value is a JWT [JWT] 
                that MUST contain all the Claims in the :term:`_claim_names` object 
                that references the corresponding :term:`_claim_sources` member. 

                Other members MAY be present if they are understood by both parties.

                    JWT
                        REQUIRED. JWT Value. 

            Distributed Claims
                A JSON object that contains the following members and values:

                    endpoint
                        REQUIRED. 
                        The value is the OAuth 2.0 resource endpoint from which the associated Claim can be retrieved. 
                        The endpoint URL MUST return the Claim as a JWT. 

                    access_token
                        OPTIONAL. 
                        Access Token enabling retrieval of the Claims from the endpoint URL 
                        by using the OAuth 2.0 Bearer [OAuth.Bearer] scheme. 
    
                        Claims SHOULD be requested using the Authorization Request header field 
                        and Claims Sources MUST support this method. 

                        If the Access Token is not available, 
                        Clients MAY need to retrieve the Access Token out of band 
                        or use an a priori Access Token that was negotiated 
                        between the Claim Source and Client, 
                        or the Claim Source MAY reauthenticate the End-User and/or reauthorize the Client. 

        Other members MAY be present, if understood by both parties. 

The following is a non-normative response with Aggregated Claims:

Claims Provider A contains the following Claims for Jane Doe:

.. code-block:: javascript

    {
     "address": {
       "street_address": "1234 Hollywood Blvd.",
       "locality": "Los Angeles",
       "region": "CA",
       "postal_code": "90210",
       "country": "US"},
     "phone_number": "+1 (310) 123-4567"
    }

Claims Provider A signs the JSON Claims, resulting in a signed JWT:

::

    jwt_header.jwt_part2.jwt_part3

Authorization Server returns Jane Doe's Aggregated Claims from
Claims Provider A:

.. code-block:: javascript

    {
     "name": "Jane Doe",
     "given_name": "Jane",
     "family_name": "Doe",
     "birthdate": "2001-03-23",
     "eye_color": "blue",
     "email": "janedoe@example.com",

     "_claim_names": {
      "address": "src1",
      "phone_number": "src1"

     },
     "_claim_sources": {
      "src1": {"JWT": "jwt_header.jwt_part2.jwt_part3"}
     }
    }

The following is a non-normative response with Distributed Claims:

Claims Provider A (Jane Doe's Bank) contains the following Claims
for Jane Doe:

.. code-block:: javascript

    {
     "shipping_address": {
       "street_address": "1234 Hollywood Blvd.",
       "locality": "Los Angeles",
       "region": "CA",
       "postal_code": "90210",
       "country": "US"},
     "payment_info": "Some_Card 1234 5678 90123 4562",
     "phone_number": "+1 (310) 123-4567"
    }

A Claims Provider B (Credit Agency) contains the following Claims
for Jane Doe:

.. code-block:: javascript

    {
     "credit_score": "650"
    }

Authorization Server returns Jane Doe's Claims along with the
Distributed Claims from Claims Provider A and B by sending the Access
Tokens and URL locations where the Claims may be retrieved:

.. code-block:: javascript

    {
     "name": "Jane Doe",
     "given_name": "Jane",
     "family_name": "Doe",
     "email": "janedoe@example.com",
     "birthdate": "2001-03-23",
     "eye_color": "blue",
     "_claim_names": {
      "payment_info": "src1",
      "shipping_address": "src1",
      "credit_score": "src2"
     },
     "_claim_sources": {
      "src1": {"endpoint": "https://bank.example.com/claimsource"},
      "src2": {"endpoint": "https://creditagency.example.com/claimshere",
               "access_token": "ksj3n283dke"}
     }
    }
