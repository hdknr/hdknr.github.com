2.3.5.1.  End-User Grants Authorization
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If the :term:`Resource Owner` grants the access request, 
the :term:`Authorization Server` issues an :term:`Authorization Response` 
and delivers it to the :term:`Client` by adding the response parameters 
to :term:`redirect_uri` specified 
in the :term:`Authorization Request` using the "**application/x-www-form-urlencoded**" format.

If the :term:`response_type` parameter in the :term:`Authorization Request` includes the string value ":term:`code`", 
the following response parameters are included:

.. glossary::

    code
        REQUIRED. The :term:`Authorization Code`. 

Upon receipt of the ":term:`code`", 
the :term:`Client` requests a response that includes the ":term:`access_token`" and other variables. [#] 
The requests and responses are described in the :ref:`Token Endpoint <standard_3>` (3) section.

.. [#] Token request ?

If the :term:`response_type` parameter in the :term:`Authorization Request` includes the string value ":term:`token`", 
the following response parameters are included:

.. glossary::

    access_token
        REQUIRED. The :term:`Access Token`. 

    token_type
        REQUIRED. This specification only supports the :term:`Bearer Token` [:term:`OAuth2.0Bearer`] scheme. 
        As such, this value MUST be set to ":term:`Bearer`". 

    expires_in
        OPTIONAL. The **lifetime** in **seconds** of the :term:`Access Token`. 

    scope
        OPTIONAL. The **scopes** of the issued :term:`Access Token`. 

If the :term:`response_type` parameter 
in the :term:`Authorization Request` includes the string value ":term:`id_token`", 
the following response parameters are returned:

.. glossary::

    id_token
        REQUIRED. The :term:`ID Token` of the for the authentication session. 

The response parameters MAY also be include:

.. glossary::

    state
        REQUIRED if the :term:`state` parameter is present in the :term:`Authorization Request`. 
        Set it to the exact value of the state parameter received from the :term:`Client`. 

No other parameter SHOULD be returned.

If the :term:`response_type` parameter 
in the :term:`Authorization Request` includes the string value ":term:`token`" or ":term:`id_token`", 
all response parameters MUST be added to the :term:`fragment component` of the :term:`redirection URI`. 
Otherwise, 
the response parameters are added to the :term:`query component` of the :term:`redirection URI`.

The following are non-normative examples of requests with differing :term:`return_type` values 
and their responses. Line wraps are for display purpose only:

::

    https://server.example.com/op/authorize?
    response_type=code
    &client_id=s6BhdRkqt3
    &redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
    &scope=openid
    &nonce=n-0S6_WzA2Mj
    &state=af0ifjsldkj
    
    
    HTTP/1.1 302 Found
    Location: https://client.example.com/cb?
    code=Qcb0Orv1zh30vL1MPRsbm-diHiMwcLyZvn1arpZv-Jxf_11jnpEX3Tgfvk
    &state=af0ifjsldkj
    
    https://server.example.com/op/authorize?
    response_type=token%20id_token
    &client_id=s6BhdRkqt3
    &redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
    &scope=openid
    &nonce=n-0S6_WzA2Mj
    &state=af0ifjsldkj
    
    
    HTTP/1.1 302 Found
    Location: https://client.example.com/cb#
    access_token=jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y
    &token_type=Bearer
    &id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOlwvXC9zZ
    XJ2ZXIuZXhhbXBsZS5jb20iLCJ1c2VyX2lkIjoiMjQ4Mjg5NzYxMDAxIiwiYXVkIjoiaHR0c
    DpcL1wvY2xpZW50LmV4YW1wbGUuY29tIiwiZXhwIjoxMzExMjgxOTcwfQ.eDesUD0vzDH3T1
    G3liaTNOrfaeWYjuRCEPNXVtaazNQ
    &state=af0ifjsldkj
    
    https://server.example.com/op/authorize?
    response_type=code%20id_token
    &client_id=s6BhdRkqt3
    &redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
    &scope=openid
    &nonce=n-0S6_WzA2Mj
    &state=af0ifjsldkj
    
    
    HTTP/1.1 302 Found
    Location: https://client.example.com/cb#
    code=Qcb0Orv1zh30vL1MPRsbm-diHiMwcLyZvn1arpZv-Jxf_11jnpEX3Tgfvk
    &id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOlwvXC9zZ
    XJ2ZXIuZXhhbXBsZS5jb20iLCJ1c2VyX2lkIjoiMjQ4Mjg5NzYxMDAxIiwiYXVkIjoiaHR0c
    DpcL1wvY2xpZW50LmV4YW1wbGUuY29tIiwiZXhwIjoxMzExMjgxOTcwfQ.eDesUD0vzDH3T1
    G3liaTNOrfaeWYjuRCEPNXVtaazNQ
    &state=af0ifjsldkj
    
    https://server.example.com/op/authorize?
    response_type=token%20code
    &client_id=s6BhdRkqt3
    &redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
    &scope=openid
    &nonce=n-0S6_WzA2Mj
    &state=af0ifjsldkj
    
    
    HTTP/1.1 302 Found
    Location: https://client.example.com/cb#
    code=Qcb0Orv1zh30vL1MPRsbm-diHiMwcLyZvn1arpZv-Jxf_11jnpEX3Tgfvk
    &access_token=jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y
    &token_type=Bearer
    &state=af0ifjsldkj
    
    https://server.example.com/op/authorize?
    response_type=token%20code%20id_token
    &client_id=s6BhdRkqt3
    &redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
    &scope=openid
    &nonce=n-0S6_WzA2Mj
    &state=af0ifjsldkj
    
    
    HTTP/1.1 302 Found
    Location: https://client.example.com/cb#
    code=Qcb0Orv1zh30vL1MPRsbm-diHiMwcLyZvn1arpZv-Jxf_11jnpEX3Tgfvk
    &access_token=jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y
    &token_type=Bearer
    &id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOlwvXC9zZ
    XJ2ZXIuZXhhbXBsZS5jb20iLCJ1c2VyX2lkIjoiMjQ4Mjg5NzYxMDAxIiwiYXVkIjoiaHR0c
    DpcL1wvY2xpZW50LmV4YW1wbGUuY29tIiwiZXhwIjoxMzExMjgxOTcwfQ.eDesUD0vzDH3T1
    G3liaTNOrfaeWYjuRCEPNXVtaazNQ
    &state=af0ifjsldkj
    

(draft 07)
