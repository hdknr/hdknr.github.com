11.1.  Adaptive Chosen-Ciphertext Attacks
------------------------------------------------------------

When decrypting, 
particular care must be taken 
not to allow the JWE recipient to be used as an oracle 
for decrypting messages.  

.. note::
    - JWE受信者をオラクルにしては行けない

RFC 3218 [RFC3218] should be consulted for specific countermeasures 
to attacks on RSAES-PKCS1-V1_5.  

An attacker might modify the contents of the "alg" parameter 
from "RSA-OAEP" to "RSA1_5" 
in order to generate a formatting error 
that can be detected and used to recover the CEK 
even if RSAES OAEP was used to encrypt the CEK.  

.. note::
    - OAEPで作られたJweのalgを PKCS#1.5 に攻撃者が変更
    - こうすることで、Jweの復号でフォーマットエラー起こして
      CEKを復元できるように攻撃できる
    - OAEP自体はCCA2耐性があるが、もしもPKCS#1.5でも使用するキーが同じだったら
      CEKが復元できてしまうかもしれない

It is therefore particularly important 
to report all formatting errors to the CEK, 
Additional Authenticated Data, 
or ciphertext as a single error when the encrypted content is rejected.

.. note::
    - この時にCEK, AAD, 暗号文に関するすべての書式エラーを単一のエラーとして報告する事。
    - (意味不明)

Additionally, 
this type of attack can be prevented by the use of "key tainting".  

This method restricts the use of a key to a limited set
of algorithms -- usually one.  

This means, for instance, 
that if the key is marked as being for "RSA-OAEP" only, 
any attempt to decrypt a message using the "RSA1_5" algorithm 
with that key would fail immediately due to invalid use of the key.

.. note::
    - キー用途を１つに制限する(「このキーはOAEPだけで使う」)
    - 用途が違うと使えないので問題を未然に防げる

(draft27)


.. note:
    - https://en.wikipedia.org/wiki/Adaptive_chosen-ciphertext_attack
    - CCA2 攻撃


.. note::
    - http://wizardbible.org/40/ipusiron.txt

    CCA（選択暗号文攻撃）
    
    暗号化オラクルを利用する前に、
    自分自身が選択した暗号文に対応する平文を知ることができる状況における攻撃である。

    このように暗号文をクエリーとして受け取り、
    平文を返す存在を復号オラクル
    Decryption Oracle：DO）という。

    つまり、CCA攻撃者は復号オラクルを使ってから（何度も問い合わせ可能）、
    暗号化オラクルを利用できる。

.. note::
　  CCA2（適応的選択暗号文攻撃）

    復号オラクルを利用してから（何度も問い合わせ可能）、
    暗号化オラクルを利用し、その後でも復号オラクルを利用できる
    何度も問い合わせ可能）状況における攻撃である。

    ただし、暗号化オラクルで受け取った暗号文を、
    その後で復号オラクルに送信してはいけない。
    な ぜならば、もし送信できてしまえば、
    敵は明らかにbを特定できまうからである。
