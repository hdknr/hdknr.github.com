
3.1.2.  Client Presents RPT

Example of a request carrying an RPT using the UMA bearer RPT
profile:

::

    GET /album/photo.jpg HTTP/1.1
    Authorization: Bearer vF9dft4qmT
    Host: photoz.example.com
    ...


If the client presents an RPT with its request, the resource server
MUST determine the RPT's status (see Section 3.3) before responding.

If the RPT is invalid, the resource server MUST return an HTTP 401
(Unauthorized) status code, along with providing the authorization
server's URI in an "as_uri" property in the header, similarly to the
case where no RPT was presented.

If the RPT is valid but has insufficient authorization data for the
type of access sought, the resource server SHOULD register a
requested permission with the authorization server that would suffice
for that scope of access (see Section 3.2), and then respond with the
HTTP 403 (Forbidden) status code, along with providing the
authorization server's URI in an "as_uri" property in the header, and
the permission ticket it just received from the AM in the body in a
JSON-encoded "ticket" property.

Example of the host's response after having registered a requested
permission and received a ticket:

::

    HTTP/1.1 403 Forbidden
    WWW-Authenticate: UMA realm="example",
      host_id="photoz.example.com",
      as_uri="https://as.example.com"
      error="insufficient_scope"
    
    {
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
    }


If the RPT's status is associated with authorization data that is
consistent with authorized access of the scope sought by the client,
the resource server MUST give access to the desired resource.

Example of the resource server's response after having determineed
that the RPT is valid and associated with sufficient authorization
data:

::

    HTTP/1.1 200 OK
    Content-Type: image/jpeg
    ...


    /9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
    3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
    /bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
    KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb


The resource server MUST NOT give access where the token's status is
not associated with sufficient authorization data for the attempted scope of access.

( draft 7, http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07#section-3.1.2 )
