3.1.2.  Client Presents RPT
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. note::
    - ベアラRPTを提示してリソースアクセスする

Example of a request carrying an RPT 
using the UMA bearer RPT profile:

::

    GET /album/photo.jpg HTTP/1.1
    Authorization: Bearer vF9dft4qmT
    Host: photoz.example.com
    ...


.. note::
    -  トークンの検証すること

If the client presents an RPT with its request, 
the :term:`resource server` MUST determine the RPT's status 
(see :ref:`Section 3.3 <uma_core.3.3>`) before responding.

.. note::
    - 不正トークン -> 401
    - + Authz Server URI "as_uri"
    
If the RPT is invalid, 
the resource server applies :term:`UMA protection` by
returning HTTP 401 (Unauthorized) status code
and providing the authorization server's URI 
in an ":term:`as_uri`" property in the header, 
similarly to the case where no RPT was presented.

.. note::
    - 認可データが不足 -> 403 + as_uri + チケット
    - 要求されるパーミッションを追加 -> チケット

If the RPT is valid but has insufficient :term:`authorization data` 
for the type of access sought, 
the resource server uses the :term:`protection API` 
to register a requested permission with the authorization server 
that would suffice for that scope of access (see :ref:`Section 3.2 <uma_core.3.2>`).

It then responds with HTTP 403 (Forbidden) status code
and providing the authorization server's URI in an "as_uri" property 
in the header 
and the permission ticket it just received from the AM in the body in a
JSON-encoded ":term:`ticket`" property.

.. note::
    - スコープが足りないケースも403

Example of the resource server's response 
after having registered a requested permission 
and received a ticket:

::

    HTTP/1.1 403 Forbidden
    WWW-Authenticate: UMA realm="example",
      host_id="photoz.example.com",
      as_uri="https://as.example.com"
      error="insufficient_scope"
    
    {
        "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
    }


.. note::
    - トークンステータスがOKで認可データもアクセスするのに十分であれば
      リソースを返す

If the RPT's status is associated with authorization data 
that is sufficient for the access sought by the client,
the resource server MUST give access to the desired resource.

Example of the resource server's response after having determined
that the RPT is valid and associated with sufficient authorization
data:

::

    HTTP/1.1 200 OK
    Content-Type: image/jpeg
    ...


    /9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
    3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
    /bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
    KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb


The resource server MUST NOT give access where the token's status is
not associated with sufficient authorization data for the attempted scope of access.

( draft09, http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.1.2 )
