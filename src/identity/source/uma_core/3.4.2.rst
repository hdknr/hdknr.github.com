:orphan:

3.4.2. Client Obtains RPT
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

In this step, 
if the client needs an RPT that applies to this requesting party for this resource server and this authorization server, 
it obtains an RPT.  

On first issuance the RPT is associated with no authorization data 
and thus does not convey any authorizations for access.

The clieint performs a POST on the RPT endpoint.  
It MUST provide its own AAT in the header.

Example of a request message containing an AAT:

::

   POST /rpt HTTP/1.1
   Host: am.example.com
   Authorization: Bearer jwfLG53^sad$#f
   ...

The authorization server responds with an HTTP 201 (Created) status code 
and provides a new RPT.

For example:

::

   HTTP/1.1 201 Created
   Content-Type: application/uma-rpt+json

   {
     "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv"
   }

If the content-type of the request is not recognized by the authorization server, 
the latter MUST produce an HTTP error.

The client might need an RPT if it has never before requested an RPT
for this combination of requesting party, resource server, 
and authorization server, 
or if it has lost control of a previously issued RPT and needs a refreshed one.  
If the AAT provided in the header is the same as one provided for a previously issued RPT 
by this authorization server, 
the authorization server invalidates the old RPT and issues a new one.

If the request fails due to missing or invalid parameters, 
or is otherwise malformed, 
the authorization server SHOULD inform the client of the error by sending an HTTP error response.

If the request fails due to an invalid, missing, 
or expired AAT or requires higher privileges at this endpoint than provided by the AAT,
the authorization server responds with an OAuth error (see Section 4.1).

For example:

::

   HTTP/1.1 401 Unauthorized
   WWW-Authenticate: Bearer realm="example",
     error="invalid_token",
     error_description="The access token expired"

(draft 06 : http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.2 )
