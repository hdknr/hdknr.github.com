3.  Getting Authorization and Accessing a Resource
========================================================================

Phase 2 of UMA is getting authorization, and Phase 3 is accessing a
resource.  In these phases, an AM orchestrates and controls
requesting parties' access to a user's protected resources at a host,
under conditions dictated by that user.

Phase 3 is merely the successful completion of a requester's access
attempt (see Section 3.1.3.2) that initially involved several
embedded interactions among the requester, AM, and host in Phase 2.
Phase 2 always begins with the requester attempting access at a
protected resource endpoint at the host.  How the requester came to
learn about this endpoint is out of scope for UMA.  The authorizing
user might, for example, have advertised its availability publicly on
a blog or other website, listed it in a discovery service, or emailed
a link to a particular intended requesting party.

The host responds to the requester's access request in one of several
ways depending on the circumstances of the request, either
immediately or having first performed one or more embedded
interactions with the AM.  Depending on the nature of the host's
response to an failed access attempt, the requester itself engages in
embedded interactions with the AM before re-attempting access.

The interactions are as follows.  The interaction summarized in each
top-level list item MAY be the last interaction engaged in, if the
requester chooses not to continue pursuing the access attempt, or the
host chooses not to continue facilitating it.

   -  The requester attempts access at a particular protected resource
      at a host (see Section 3.1).

      *  If the access attempt is unaccompanied by a requester access
         token, the host responds immediately with an HTTP 401
         (Unauthorized) response and instructions on where to go to
         obtain one (see Section 3.1.1).


   -  If the access attempt was accompanied by a requester access token,
      the host checks the token's status (see Section 3.3).

      *  If the requester access token is invalid (see Section 3.1.2),
         the host responds to the requester with an HTTP 401
         (Unauthorized) response and instructions on where to go to
         obtain a token (see Section 3.1.1).

   -  If the requester access token is valid (see Section 3.1.3) but
      none of the permissions associated with the token match the scope
      of attempted access, the host registers a suitable permission on
      the requester's behalf at the AM (see Section 3.4) and then
      responds to the requester with an HTTP 403 (Forbidden) response
      and instructions on where to go to request authorization to
      associate that permission with its token (see Section 3.1.3.1).

   -  If the requester received instructions on where to get a token, it
      requests a token from the appropriate AM (see Section 3.2).

   -  If the requester received instructions on where to get
      authorization for adding a permission, it requests the permission
      from the appropriate AM (see Section 3.5).

      *  If the requester asked the AM to add a permission, the AM
         engages in an authorization flow that MAY require requesting
         claims from the requesting party (see Section 3.6).

   -  If the requester access token is valid, and at least one of the
      permissions associated with the token match the scope of attempted
      access, the host responds to the requester's access attempt with
      an HTTP 200 (OK) response and a representation of the resource
      (see Section 3.1.3.2).

The interactions are described in detail in the following sections.

(03)

