

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Backplane &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="WebFinger" href="webfinger.html" />
    <link rel="prev" title="JSON Web Encryption JSON Serialization (JWE-JS)" href="jwe_js.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>identity 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>Backplane</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="jwe_js.html">JSON Web Encryption JSON Serialization (JWE-JS)</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="webfinger.html">WebFinger</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="backplane">
<h1><a class="toc-backref" href="#id20">Backplane</a><a class="headerlink" href="#backplane" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://developers.janrain.com/documentation/backplane-protocol/">http://developers.janrain.com/documentation/backplane-protocol/</a></p>
<div class="contents topic" id="id1">
<p class="topic-title first">Backplane</p>
<ul class="simple">
<li><a class="reference internal" href="#backplane" id="id20">Backplane</a><ul>
<li><a class="reference internal" href="#protocol" id="id21">Protocol</a><ul>
<li><a class="reference internal" href="#overview" id="id22">Overview</a></li>
<li><a class="reference internal" href="#publishing-authentication-data-on-backplane" id="id23">Publishing Authentication Data on Backplane</a></li>
<li><a class="reference internal" href="#audiences" id="id24">Audiences</a></li>
<li><a class="reference internal" href="#version" id="id25">Version</a></li>
</ul>
</li>
<li><a class="reference internal" href="#protocol-flow" id="id26">Protocol Flow</a><ul>
<li><a class="reference internal" href="#backplane-protocol" id="id27">Backplane Protocol</a></li>
<li><a class="reference internal" href="#a-message-posting-with-the-backplane-protocol" id="id28">[A] Message Posting with the Backplane Protocol</a></li>
<li><a class="reference internal" href="#b-message-notification" id="id29">[B] Message Notification</a></li>
<li><a class="reference internal" href="#c-message-retrieval" id="id30">[C] Message Retrieval</a></li>
</ul>
</li>
<li><a class="reference internal" href="#messages" id="id31">Messages</a><ul>
<li><a class="reference internal" href="#senarios" id="id32">Senarios</a><ul>
<li><a class="reference internal" href="#identity-scenario" id="id33">Identity Scenario</a></li>
<li><a class="reference internal" href="#activity-streams-scenario" id="id34">Activity Streams Scenario</a></li>
</ul>
</li>
<li><a class="reference internal" href="#messages-in-backplane-protocol-v1-2-versus-messages-in-backplane-protocol-2-0" id="id35">Messages in Backplane Protocol v1.2 versus messages in Backplane Protocol 2.0</a></li>
</ul>
</li>
<li><a class="reference internal" href="#add-to-your-website" id="id36">Add to Your Website</a><ul>
<li><a class="reference internal" href="#obtain-bus-name-and-credentials-from-capture-dashboard" id="id37">Obtain Bus Name and Credentials from Capture Dashboard</a></li>
<li><a class="reference internal" href="#add-backplane-js" id="id38">Add backplane.js</a></li>
<li><a class="reference internal" href="#initialize-the-backplane-object" id="id39">Initialize the Backplane Object</a></li>
<li><a class="reference internal" href="#configure-backplane-channel-for-engage-or-capture" id="id40">Configure Backplane Channel for Engage or Capture</a></li>
<li><a class="reference internal" href="#supported-widges" id="id41">Supported Widges</a></li>
</ul>
</li>
<li><a class="reference internal" href="#add-to-your-application" id="id42">Add to Your Application</a><ul>
<li><a class="reference internal" href="#integration-steps" id="id43">Integration Steps</a></li>
<li><a class="reference internal" href="#flow" id="id44">Flow</a><ul>
<li><a class="reference internal" href="#before-proceeding" id="id45">Before Proceeding</a></li>
<li><a class="reference internal" href="#register-for-callback" id="id46">1. Register for Callback</a></li>
<li><a class="reference internal" href="#identity-login-published-on-backplane-server-channel" id="id47">2. Identity/Login Published on Backplane Server Channel</a></li>
<li><a class="reference internal" href="#poll-for-messages-on-website" id="id48">3. Poll for Messages on Website</a></li>
<li><a class="reference internal" href="#request-payload-from-backplane-server" id="id49">4. Request Payload from Backplane Server</a></li>
<li><a class="reference internal" href="#process-payload" id="id50">5. Process Payload</a></li>
<li><a class="reference internal" href="#widget-server-subset-of-payload-to-widget" id="id51">6. Widget Server Subset of Payload to Widget</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#terms" id="id52">Terms</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backplane-2-0" id="id53">Backplane 2.0</a><ul>
<li><a class="reference internal" href="#abstract" id="id54">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id55">1.  Introduction</a></li>
<li><a class="reference internal" href="#definitions" id="id56">2.  Definitions</a></li>
<li><a class="reference internal" href="#backplane-3" id="id57">3.  Overview</a></li>
<li><a class="reference internal" href="#trust" id="id58">4.  Trust</a></li>
<li><a class="reference internal" href="#access-levels" id="id59">5.  Access Levels</a><ul>
<li><a class="reference internal" href="#backplane-5-1" id="id60">5.1.  Regular Access</a></li>
<li><a class="reference internal" href="#backplane-5-2" id="id61">5.2.  Privileged Access</a><ul>
<li><a class="reference internal" href="#authorization" id="id62">5.2.1.  Authorization</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#discovery-registration-and-authorization" id="id63">6.  Discovery, Registration and Authorization</a><ul>
<li><a class="reference internal" href="#backplane-server-discovery" id="id64">6.1.  Backplane Server Discovery</a><ul>
<li><a class="reference internal" href="#dynamic-discovery" id="id65">6.1.1.  Dynamic Discovery</a></li>
<li><a class="reference internal" href="#static-discovery" id="id66">6.1.2.  Static Discovery</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backplane-client-registration" id="id67">6.2.  Backplane Client Registration</a><ul>
<li><a class="reference internal" href="#dynamic-client-registration" id="id68">6.2.1.  Dynamic Client Registration</a></li>
<li><a class="reference internal" href="#static-client-registration" id="id69">6.2.2.  Static Client Registration</a></li>
<li><a class="reference internal" href="#manual-client-registration" id="id70">6.2.3.  Manual Client Registration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backplane-6-3" id="id71">6.3.  Authorization</a><ul>
<li><a class="reference internal" href="#backplane-client-initiated-authorization" id="id72">6.3.1.  Backplane Client Initiated Authorization</a></li>
<li><a class="reference internal" href="#backplane-server-initiated-authorization" id="id73">6.3.2.  Backplane Server Initiated Authorization</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#padded-responses" id="id74">7.  Padded Responses</a></li>
<li><a class="reference internal" href="#buses" id="id75">8.  Buses</a></li>
<li><a class="reference internal" href="#channels" id="id76">9.  Channels</a></li>
<li><a class="reference internal" href="#backplane-messages" id="id77">10.  Backplane Messages</a></li>
<li><a class="reference internal" href="#message-retention" id="id78">11.  Message Retention</a><ul>
<li><a class="reference internal" href="#sticky-messages" id="id79">11.1.  Sticky Messages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#message-sequences-and-retrieval" id="id80">12.  Message Sequences and Retrieval</a><ul>
<li><a class="reference internal" href="#access-scopes" id="id81">12.1.  Access Scopes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backplane-server-api" id="id82">13.  Backplane Server API</a><ul>
<li><a class="reference internal" href="#access-token-request" id="id83">13.1.  Access Token Request</a><ul>
<li><a class="reference internal" href="#anonymous-access-token-request" id="id84">13.1.1.  Anonymous Access Token Request</a></li>
<li><a class="reference internal" href="#authenticated-access-token-request" id="id85">13.1.2.  Authenticated Access Token Request</a></li>
</ul>
</li>
<li><a class="reference internal" href="#get-messages" id="id86">13.2.  Get Messages</a></li>
<li><a class="reference internal" href="#get-single-message" id="id87">13.3.  Get Single Message</a></li>
<li><a class="reference internal" href="#post-messages" id="id88">13.4.  Post Messages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backplane-javascript-api" id="id89">14.  Backplane JavaScript API</a><ul>
<li><a class="reference internal" href="#initialization" id="id90">14.1.  Initialization</a></li>
<li><a class="reference internal" href="#subscription-management" id="id91">14.2.  Subscription Management</a></li>
<li><a class="reference internal" href="#hints" id="id92">14.3.  Hints</a></li>
<li><a class="reference internal" href="#usage-example" id="id93">14.4.  Usage Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations" id="id94">15.  Security Considerations</a><ul>
<li><a class="reference internal" href="#channel-name-sensitivity" id="id95">15.1.  Channel Name Sensitivity</a></li>
<li><a class="reference internal" href="#message-payloads" id="id96">15.2.  Message Payloads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#normative-references" id="id97">16. Normative References</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="protocol">
<h2><a class="toc-backref" href="#id21">Protocol</a><a class="headerlink" href="#protocol" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3><a class="toc-backref" href="#id22">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The Backplane Protocol is an open source protocol,
developed to simplify communications between multiple web widgets
and applications on the same web page.</p>
<p>Instead of each widget or application using their own scheme to access user data,
Backplane-enabled widgets listen to a single,
common Backplane Server for updates.</p>
<p>The Backplane Protocol can publish different types of messages,
alerting widgets when users have authenticated,
or activities the user is sharing with social network.</p>
</div>
<div class="section" id="publishing-authentication-data-on-backplane">
<h3><a class="toc-backref" href="#id23">Publishing Authentication Data on Backplane</a><a class="headerlink" href="#publishing-authentication-data-on-backplane" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>User is authenticated with a Backplane-enabled sign-in <a class="reference internal" href="#term-widget"><em class="xref std std-term">widget</em></a>, such as Janrain <a class="reference internal" href="#term-engage"><em class="xref std std-term">Engage</em></a>.</li>
<li>The <a class="reference internal" href="#term-widget"><em class="xref std std-term">widget</em></a> publishes a <a class="reference internal" href="messages.html#term-message"><em class="xref std std-term">message</em></a> on a <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> <a class="reference internal" href="#term-42"><em class="xref std std-term">channel</em></a>.</li>
<li><a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a> on the <a class="reference internal" href="#term-web-page"><em class="xref std std-term">web page</em></a> listening to the Backplane are updated.</li>
</ol>
</div>
<div class="section" id="audiences">
<h3><a class="toc-backref" href="#id24">Audiences</a><a class="headerlink" href="#audiences" title="Permalink to this headline">¶</a></h3>
<p>Two audiences:</p>
<ul class="simple">
<li>Website Owners — Add Backplane functionality to a website.</li>
<li>Product Developers — Add Backplane support to a product, such as a widget.</li>
</ul>
</div>
<div class="section" id="version">
<h3><a class="toc-backref" href="#id25">Version</a><a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h3>
<p>The Backplane Protocol is an open source,
cross-company initiative aimed at advancing web app technology.
There are currently two versions:</p>
<ul class="simple">
<li>Backplane Protocol 1.2 – The first public implementation of Backplane Protocol.
Supports publishing Identity messages.</li>
<li>Backplane Protocol 2.0 – Uses <a class="reference internal" href="glossary.html#term-oauth2"><em class="xref std std-term">OAuth2</em></a> for the <strong>authorization process</strong>.
Supports an <a class="reference internal" href="#identity-scenario">Identity Scenario</a> ,
and will support an <a class="reference internal" href="#activity-streams-scenario">Activity Streams Scenario</a> when implemented.
<a class="reference internal" href="#messages">Messages</a> also have been re-engineered to send only <strong>header</strong> information
to browser or anonymous clients,
the <strong>payload</strong> is sent to authenticated clients as specified in the protocol.</li>
</ul>
</div>
</div>
<div class="section" id="protocol-flow">
<h2><a class="toc-backref" href="#id26">Protocol Flow</a><a class="headerlink" href="#protocol-flow" title="Permalink to this headline">¶</a></h2>
<div class="section" id="backplane-protocol">
<h3><a class="toc-backref" href="#id27">Backplane Protocol</a><a class="headerlink" href="#backplane-protocol" title="Permalink to this headline">¶</a></h3>
<p>Figure 1 shows an example of the Backplane Protocol identity message flow using Janrain as the authenticating service.</p>
<div class="figure">
<a class="reference internal image-reference" href="images/bpp-tech-diagram-1.png"><img alt="images/bpp-tech-diagram-1.png" src="images/bpp-tech-diagram-1.png" style="width: 840.0px; height: 546.7px;" /></a>
<p class="caption">Figure 1</p>
</div>
</div>
<div class="section" id="a-message-posting-with-the-backplane-protocol">
<h3><a class="toc-backref" href="#id28">[A] Message Posting with the Backplane Protocol</a><a class="headerlink" href="#a-message-posting-with-the-backplane-protocol" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A1) <a class="reference internal" href="glossary.html#term-user"><em class="xref std std-term">User</em></a> signs in to website.</p>
<p>A2) <a class="reference internal" href="#term-identity-connector"><em class="xref std std-term">Identity connector</em></a> publishes Identity/Login events to the Backplane Server.</p>
</div></blockquote>
</div>
<div class="section" id="b-message-notification">
<h3><a class="toc-backref" href="#id29">[B] Message Notification</a><a class="headerlink" href="#b-message-notification" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>B1) A Backplane-compliant application polls the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> for <a class="reference internal" href="#messages">messages</a> .</p>
<p>B2) The <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> delivers the message to the clients running in the browser, absent the payload.</p>
<p>B3) The <a class="reference internal" href="#term-backplane-javascript"><em class="xref std std-term">Backplane JavaScript</em></a> distributes the message to apps that are registered for the message.</p>
</div></blockquote>
</div>
<div class="section" id="c-message-retrieval">
<h3><a class="toc-backref" href="#id30">[C] Message Retrieval</a><a class="headerlink" href="#c-message-retrieval" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>C1) <a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a> make <a class="reference internal" href="#term-jsonp"><em class="xref std std-term">JSONP</em></a> calls to their servers.</p>
<p>C2) <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widget Server</em></a> calls <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> for full message and payload.</p>
<p>C3) <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widget Server</em></a> securely receives payload.</p>
<p>C4) <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widget Server</em></a> returns subset of payload to application on website.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="messages">
<h2><a class="toc-backref" href="#id31">Messages</a><a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="senarios">
<h3><a class="toc-backref" href="#id32">Senarios</a><a class="headerlink" href="#senarios" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> can retrieve different types of messages
and send them on to the <a class="reference internal" href="#term-widgets"><em class="xref std std-term">widgets</em></a>.</p>
<p>In <a class="reference internal" href="#backplane-protocol">Backplane Protocol</a> terms,
a <a class="reference internal" href="#term-scenario"><em class="xref std std-term">Scenario</em></a> is an a protocol extension
that defines one or more message types and specifies their semantics, use, and so on.
Currently, the Scenarios in development on the Backplane Protocol are:</p>
<div class="section" id="identity-scenario">
<h4><a class="toc-backref" href="#id33">Identity Scenario</a><a class="headerlink" href="#identity-scenario" title="Permalink to this headline">¶</a></h4>
<p>Updates all widgets with user data
once a <em class="xref std std-term">login widget</em> publishes to a <em class="xref std std-term">Backplane channel</em>.</p>
</div>
<div class="section" id="activity-streams-scenario">
<h4><a class="toc-backref" href="#id34">Activity Streams Scenario</a><a class="headerlink" href="#activity-streams-scenario" title="Permalink to this headline">¶</a></h4>
<p>Coming soon:
When a user shares activities on a social network,
widgets will be informed as well.</p>
</div>
</div>
<div class="section" id="messages-in-backplane-protocol-v1-2-versus-messages-in-backplane-protocol-2-0">
<h3><a class="toc-backref" href="#id35">Messages in Backplane Protocol v1.2 versus messages in Backplane Protocol 2.0</a><a class="headerlink" href="#messages-in-backplane-protocol-v1-2-versus-messages-in-backplane-protocol-2-0" title="Permalink to this headline">¶</a></h3>
<p>One of the improvements in the newer version is that
Backplane 1.2 always delivers the entire data payload,
while Backplane 2.0 delivers only the header information to browser
or anonymous clients,
and sends the full the data payload to authenticated clients according to the protocol.
While on the surface
this may appear to be a step backwards in the evolution of the Backplane protocol,
it was done for two important reasons.</p>
<p>The first is the security principle of “ <strong>least privilege</strong>,”
which states that applications should only have access to data
that directly concerns them,
rather than a firehose of sensitive data
that may or not be directly consumed by the subscriber of the content.</p>
<p>Secondly,
it was desirable to conserve <em class="xref std std-term">bandwidth</em>.
As payloads become more data rich,
they may contain several <strong>hundred kilobytes</strong> of data each.
Pumping the entire payload to the JavaScript client library would be wasteful.</p>
<p>Because the client implementing the Backplane 2.0 JavaScript library
receives only the <strong>message header</strong>,
each application subscribing to the message needs to use an API
to contact their server-based applications,
which then send the relevant information.</p>
<p>Backplane 2.0 allows server-side applications (
as authenticated clients) to consume the entire message content,
including the payload portion.</p>
</div>
</div>
<div class="section" id="add-to-your-website">
<h2><a class="toc-backref" href="#id36">Add to Your Website</a><a class="headerlink" href="#add-to-your-website" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="#backplane-protocol">Backplane Protocol</a>,
and Janrain’s implementation of the Backplane Server, are new.
We anticipate that given user feedback we will modify the documentation,
so check back frequently for updates.</p>
</div>
<p>This section explains how to integrate the <a class="reference internal" href="#backplane-protocol">Backplane Protocol</a> into your website.
When you are finished,
your site will publish messages to a channel on a <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>
using the Janrain <a class="reference internal" href="#term-capture"><em class="xref std std-term">Capture</em></a> or <a class="reference internal" href="#term-engage"><em class="xref std std-term">Engage</em></a> widget.</p>
<p>There is no need for any further configuration if your website is already using Backplane-compliant widgets and web apps. See our list of supported technologies for more information.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You must have access to a working <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.
You can build your own with the <a class="reference external" href="http://backplanex.com/server-operator/">open source version</a> ,
or Janrain can provide access to one.</p>
<p>Technologies used:</p>
<blockquote class="last">
<div><ul class="simple">
<li>HTML markup and DOM</li>
<li>Javascript XMLHTTP and asynchronous events</li>
<li>JSON/JSONP</li>
</ul>
</div></blockquote>
</div>
<p>The main steps to integrating Backplane Protocol on a website are:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference internal" href="#obtain-bus-name-and-credentials-from-capture-dashboard">Obtain bus name and credentials from Capture Dashboard</a> .</li>
<li><a class="reference internal" href="#add-backplane-js">Add backplane.js</a> .</li>
<li><a class="reference internal" href="#initialize-the-backplane-object">Initialize the Backplane object</a> .</li>
<li><a class="reference internal" href="#configure-backplane-channel-for-engage-or-capture">Configure Backplane channel for Engage or Capture</a> .</li>
</ol>
</div></blockquote>
<p>We recommend that you implement the latest 2.0 version of the Backplane Protocol.
Directions for version 1.2 are provided for organizations that have already installed version 1.2.</p>
<p class="seqdiag">
<img src="images/seqdiag-723b94dec9291c1b1f94cc058b76fe53a8594766.png" alt="None" width="640" height="668" />
</p>
<div class="section" id="obtain-bus-name-and-credentials-from-capture-dashboard">
<h3><a class="toc-backref" href="#id37">Obtain Bus Name and Credentials from Capture Dashboard</a><a class="headerlink" href="#obtain-bus-name-and-credentials-from-capture-dashboard" title="Permalink to this headline">¶</a></h3>
<p>In the <a class="reference internal" href="#term-capture"><em class="xref std std-term">Capture</em></a> Dashboard,
this value is listed as <strong>backplane_bus</strong>.
Copy this value to a text file, or write it down.
You will need this later.
For <a class="reference internal" href="#term-engage"><em class="xref std std-term">Engage</em></a> credentials,
please contact your Janrain support representative.</p>
<p>The <a class="reference internal" href="#term-bus-owner"><em class="xref std std-term">Bus Owner</em></a> credential is used by the website operator
or <a class="reference internal" href="#term-bus-owner"><em class="xref std std-term">Bus Owner</em></a> to authenticate with the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>
before authorizing OAuth clients (<a class="reference internal" href="#term-widgets"><em class="xref std std-term">widgets</em></a>) to post to their <a class="reference internal" href="#term-41"><em class="xref std std-term">bus</em></a>.</p>
<p>The OAuth token is used by <a class="reference internal" href="#term-widgets"><em class="xref std std-term">widgets</em></a> to post messages on a bus.
(<a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a> that do not use OAuth2 can still use the Backplane 1.2 authorization procedure.)</p>
</div>
<div class="section" id="add-backplane-js">
<h3><a class="toc-backref" href="#id38">Add backplane.js</a><a class="headerlink" href="#add-backplane-js" title="Permalink to this headline">¶</a></h3>
<p>Place this code in the &lt;head&gt; section of the webpage hosting the widgets.
<em class="xref std std-ref">This script</em> adds the library to your web page
that the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> uses.
Any Backplane-enabled <a class="reference internal" href="#term-widgets"><em class="xref std std-term">widgets</em></a> on this web page,
regardless of who made them, will have access to the Backplane <a class="reference internal" href="#term-41"><em class="xref std std-term">bus</em></a>.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span>
<span class="na">src=</span><span class="s">&quot;http://d134l0cdryxgwa.cloudfront.net/backplane.js&quot;</span> <span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="initialize-the-backplane-object">
<h3><a class="toc-backref" href="#id39">Initialize the Backplane Object</a><a class="headerlink" href="#initialize-the-backplane-object" title="Permalink to this headline">¶</a></h3>
<p>Add the code below to the &lt;body&gt; section of the web page,
replacing the <strong>busName</strong> value with the one obtained at Step 1.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
<span class="kd">function</span> <span class="nx">setup_bp</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">//</span>
<span class="c1">//  Initialize Backplane:</span>
<span class="c1">// This creates a channel and adds a cookie for the channel.</span>
<span class="c1">// It also sets the function to call when this is complete.</span>
<span class="c1">//</span>
    <span class="nx">Backplane</span><span class="p">(</span><span class="nx">bp_ready</span><span class="p">);</span>
    <span class="nx">Backplane</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
        <span class="nx">serverBaseURL</span><span class="o">:</span> <span class="s2">&quot;http://backplane1.janrainbackplane.com/v2.0&quot;</span><span class="p">,</span>
        <span class="nx">busName</span><span class="o">:</span> <span class="s2">&quot;janraindemo.com&quot;</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">bp_ready</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">//</span>
<span class="c1">// This function is called when Backplane.init is complete.</span>
<span class="c1">//</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Backplane</span><span class="p">.</span><span class="nx">getChannelID</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">demo_bp</span><span class="p">();</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">setup_bp</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>
</div>
<p>This script requests a <a class="reference internal" href="#term-42"><em class="xref std std-term">channel</em></a> on the server
and initializes the Backplane object and associated cookies.
The process is asynchronous and does not affect web page load times.</p>
</div>
<div class="section" id="configure-backplane-channel-for-engage-or-capture">
<h3><a class="toc-backref" href="#id40">Configure Backplane Channel for Engage or Capture</a><a class="headerlink" href="#configure-backplane-channel-for-engage-or-capture" title="Permalink to this headline">¶</a></h3>
<p>In order for the <a class="reference internal" href="#term-capture"><em class="xref std std-term">Capture</em></a> or <a class="reference internal" href="#term-engage"><em class="xref std std-term">Engage</em></a> <a class="reference internal" href="#term-widget"><em class="xref std std-term">widget</em></a> to publish messages,
it retrieves a Backplane <a class="reference internal" href="#term-42"><em class="xref std std-term">channel</em></a> from the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.</p>
<p>Because Backplane 2.0 is OAuth2 compliant,
access to the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> should be through an OAuth2 access token.
(You can still use the “manual” access of Backplane 1.2 if your widget is not OAuth2 compliant.)</p>
<p>This access token is issued by the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>
and is essentially a <strong>“valet key”</strong> that allows the user to access resources
“owned” by a particular <a class="reference internal" href="#term-bus-owner"><em class="xref std std-term">bus owner</em></a> (in this case, your Janrain application).</p>
<p>To initialize the <a class="reference internal" href="#term-engage"><em class="xref std std-term">Engage</em></a> <a class="reference internal" href="#term-widget"><em class="xref std std-term">widget</em></a>,
add the following code to the &lt;body&gt; of the web page:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">doBackplaneStuff</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">janrain</span><span class="p">.</span><span class="nx">engage</span><span class="p">.</span><span class="nx">signin</span><span class="p">.</span><span class="nx">setBackplaneChannel</span><span class="p">(</span><span class="nx">Backplane</span><span class="p">.</span><span class="nx">getChannelID</span><span class="p">());</span>
    <span class="nx">bpListen</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To initialize the <a class="reference internal" href="#term-capture"><em class="xref std std-term">Capture</em></a> <a class="reference internal" href="#term-widget"><em class="xref std std-term">widget</em></a>,
add the following code to the &lt;body&gt; of the web page:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">doBackplaneStuff</span><span class="p">()</span> <span class="p">{</span>
 <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;capture-signin&#39;</span><span class="p">).</span><span class="nx">href</span> <span class="o">+</span>
 <span class="s1">&#39;&amp;bp_channel=&#39;</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">Backplane</span><span class="p">.</span><span class="nx">getChannelID</span><span class="p">());</span>
 <span class="nx">bpListen</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When a visitor authenticates with a Backplane-enabled service like <a class="reference internal" href="#term-capture"><em class="xref std std-term">Capture</em></a> or <a class="reference internal" href="#term-engage"><em class="xref std std-term">Engage</em></a>,
that service will publish an event to the specified Backplane <a class="reference internal" href="#term-42"><em class="xref std std-term">channel</em></a>.</p>
</div>
<div class="section" id="supported-widges">
<h3><a class="toc-backref" href="#id41">Supported Widges</a><a class="headerlink" href="#supported-widges" title="Permalink to this headline">¶</a></h3>
<p>Once you’ve enabled the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> for your website,
the next step is to choose from the many <a class="reference internal" href="#backplane-protocol">Backplane Protocol</a> ready widgets
and web apps available to power your site.</p>
<p>Here is a list of companies that offer <a class="reference internal" href="#backplane-protocol">Backplane Protocol</a> compliant apps:</p>
<ul>
<li><p class="first">Echo</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://aboutecho.com/products/social-login.html">http://aboutecho.com/products/social-login.html</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Janrain</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://janrain.com/products/engage/">http://janrain.com/products/engage/</a></li>
<li><a class="reference external" href="http://janrain.com/products/capture/">http://janrain.com/products/capture/</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Livefyre</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.livefyre.com/features/">http://www.livefyre.com/features/</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Badgeville</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.badgeville.com/Behavior-Management-Suite">http://www.badgeville.com/Behavior-Management-Suite</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Bigdoor</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.bigdoor.com/features/">http://www.bigdoor.com/features/</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Envolve</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://www.envolve.com/docs/">https://www.envolve.com/docs/</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Arktan</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://arktan.com/products">http://arktan.com/products</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Realtidbits</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://realtidbits.com/our-products/features">http://realtidbits.com/our-products/features</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Tokbox</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.tokbox.com/opentok/api/documentation/gettingstarted">http://www.tokbox.com/opentok/api/documentation/gettingstarted</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Stocial</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://stocial.com">http://stocial.com</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Jetjaw</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.jetjaw.com/m/features">http://www.jetjaw.com/m/features</a></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="add-to-your-application">
<h2><a class="toc-backref" href="#id42">Add to Your Application</a><a class="headerlink" href="#add-to-your-application" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="#backplane-protocol">Backplane Protocol</a> ,
and Janrain’s implementation of the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> , are new.
We anticipate that given user feedback we will modify the documentation,
so check back frequently for updates.</p>
</div>
<p>These directions are for application developers
adding Backplane functionality to a standalone application
or a web application (as opposed to a website).</p>
<p>Once implemented,
your <a class="reference internal" href="#term-widget"><em class="xref std std-term">widget</em></a> or web app will be configured to listen to a <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> ,
and will be able to be deployed in any Backplane-enabled site.</p>
<div class="section" id="integration-steps">
<h3><a class="toc-backref" href="#id43">Integration Steps</a><a class="headerlink" href="#integration-steps" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="arabic simple">
<li>Obtain authentication credentials for your specific <a class="reference internal" href="#term-41"><em class="xref std std-term">bus</em></a>.</li>
<li>Set up the application to listen for <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane messages</em></a>.</li>
<li>Implement a logout.</li>
</ol>
</div></blockquote>
<p>We recommend that you implement the latest 2.0 version of the Backplane Protocol.
Directions for version 1.2 are provided for legacy purposes.</p>
</div>
<div class="section" id="flow">
<h3><a class="toc-backref" href="#id44">Flow</a><a class="headerlink" href="#flow" title="Permalink to this headline">¶</a></h3>
<p>The following steps describe the Backplane Protocol 2.0 Flow (see Figure 1),
and how to integrate your application or web app with each step:</p>
<ul class="simple">
<li><a class="reference internal" href="#register-for-callback">1. Register for Callback</a></li>
<li><a class="reference internal" href="#identity-login-published-on-backplane-server-channel">2. Identity/Login Published on Backplane Server Channel</a></li>
<li><a class="reference internal" href="#poll-for-messages-on-website">3. Poll for Messages on Website</a></li>
<li><a class="reference internal" href="#request-payload-from-backplane-server">4. Request Payload from Backplane Server</a></li>
<li><a class="reference internal" href="#process-payload">5. Process Payload</a></li>
<li><a class="reference internal" href="#widget-server-subset-of-payload-to-widget">6. Widget Server Subset of Payload to Widget</a></li>
</ul>
<p class="seqdiag">
<img src="images/seqdiag-23ac5e6f162ec9e0f3efed8a8e5eae2f37b15278.png" alt="None" width="832" height="824" />
</p>
<div class="section" id="before-proceeding">
<h4><a class="toc-backref" href="#id45">Before Proceeding</a><a class="headerlink" href="#before-proceeding" title="Permalink to this headline">¶</a></h4>
<p>In the <a class="reference internal" href="#term-capture"><em class="xref std std-term">Capture</em></a> Dashboard,
you need the values listed as <strong>backplane_password</strong> and <strong>backplane_bus</strong>.
Copy these values to a text file, or write them down. You will need these later.</p>
<p>For <a class="reference internal" href="#term-engage"><em class="xref std std-term">Engage</em></a> credentials,
please contact your Janrain support representative.</p>
</div>
<div class="section" id="register-for-callback">
<h4><a class="toc-backref" href="#id46">1. Register for Callback</a><a class="headerlink" href="#register-for-callback" title="Permalink to this headline">¶</a></h4>
<p>One of the notable differences in Backplane Protocol v2.0 from Backplane Protocol v1.2 is
that the message payload
(that portion of the message containing personally identifiable content)
is removed from the message arriving at the non-credentialled client.</p>
<p>The Backplane 2.0 <a class="reference internal" href="#term-widget"><em class="xref std std-term">widget</em></a> listens for a message,
and then requests the data to go along with the message from another server.
For more information on this change in procedure, refer to Messages.</p>
<p>The following is sample code used to listen to the Backplane channel
for ‘identity/login’ messages.
Once this message type is received,
this code will make a call to its server-side component, using JSONP,
to fetch the portion of the payload that is important for their function.</p>
<p>See <a class="reference internal" href="#backplane-step-4"><em>Step 4</em></a> for details.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">fetchPersonalData</span><span class="p">(</span><span class="nx">messageId</span><span class="p">)</span> <span class="p">{</span>
<span class="kd">var</span> <span class="nx">oldScript</span><span class="p">;</span>
<span class="c1">// Cleanup old script if it exists to prevent memory leak</span>
<span class="c1">// This will also prevent more than one server side request from pending</span>
<span class="c1">// at any point - which may or may not be desirable</span>
<span class="k">while</span> <span class="p">(</span><span class="nx">oldScript</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;fetchSingleMessage&#39;</span><span class="p">))</span> <span class="p">{</span>
<span class="nx">oldScript</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">oldScript</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">oldScript</span><span class="p">)</span> <span class="p">{</span>
<span class="k">delete</span> <span class="nx">oldScript</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">);</span>
<span class="nx">script</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;text/javascript&quot;</span><span class="p">;</span>
<span class="nx">script</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;fetchSingleMessage&#39;</span><span class="p">;</span>
<span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;getsinglemessage.php?&quot;</span>
<span class="o">+</span> <span class="s2">&quot;v=&quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="c1">// to prevent browser caching</span>
<span class="o">+</span> <span class="s2">&quot;&amp;amp;callback=fetchCallback&quot;</span> <span class="c1">// the user-defined callback</span>
<span class="o">+</span> <span class="s2">&quot;&amp;amp;messageid=&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">messageId</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">firstScript</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">firstScript</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">script</span><span class="p">,</span> <span class="nx">firstScript</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">bpListen</span><span class="p">()</span> <span class="p">{</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">escSubscription</span> <span class="o">=</span> <span class="nx">Backplane</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">backplaneMessage</span><span class="p">)</span> <span class="p">{</span>

<span class="c1">//</span>
<span class="c1">//This enclosed function runs when any message is received.</span>
<span class="c1">//Sign in if the message type is correct.</span>
<span class="c1">//</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">backplaneMessage</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;identity/login&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">fetchPersonalData</span><span class="p">(</span><span class="nx">backplaneMessage</span><span class="p">.</span><span class="nx">messageURL</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">});</span>

<span class="c1">// Expecting a message type will increase the polling for that type</span>
<span class="c1">//until it is received.</span>
<span class="c1">//</span>

<span class="nx">Backplane</span><span class="p">.</span><span class="nx">expectMessages</span><span class="p">(</span><span class="s1">&#39;identity/login&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// script block continues</span>
</pre></div>
</div>
</div>
<div class="section" id="identity-login-published-on-backplane-server-channel">
<h4><a class="toc-backref" href="#id47">2. Identity/Login Published on Backplane Server Channel</a><a class="headerlink" href="#identity-login-published-on-backplane-server-channel" title="Permalink to this headline">¶</a></h4>
<p>The user signs in to the website,
and an <strong>Identity/Login</strong> message is published onto the Backplane Server <em class="xref std std-ref">channel</em>.</p>
<p>The <a class="reference internal" href="#term-engage"><em class="xref std std-term">Engage</em></a> or <a class="reference internal" href="#term-capture"><em class="xref std std-term">Capture</em></a> <a class="reference internal" href="#term-widgets"><em class="xref std std-term">widgets</em></a> must be configured to publish this message.</p>
<p>Engage Widget</p>
<p>To initialize the Engage widget, add the following code to the &lt;body&gt; of the web page:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">doBackplaneStuff</span><span class="p">()</span> <span class="p">{</span>
 <span class="nx">janrain</span><span class="p">.</span><span class="nx">engage</span><span class="p">.</span><span class="nx">signin</span><span class="p">.</span><span class="nx">setBackplaneChannel</span><span class="p">(</span><span class="nx">Backplane</span><span class="p">.</span><span class="nx">getChannelID</span><span class="p">());</span>
 <span class="nx">bpListen</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Capture Widget</p>
<p>To initialize the Capture widget, add the following code to the &lt;body&gt; of the web page:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">doBackplaneStuff</span><span class="p">()</span> <span class="p">{</span>
 <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;capture-signin&#39;</span><span class="p">).</span><span class="nx">href</span> <span class="o">+</span>
 <span class="s1">&#39;&amp;bp_channel=&#39;</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">Backplane</span><span class="p">.</span><span class="nx">getChannelID</span><span class="p">());</span>
 <span class="nx">bpListen</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When a visitor authenticates with a Backplane-enabled service like Capture or Engage,
that service will publish an event to the specified Backplane channel.</p>
</div>
<div class="section" id="poll-for-messages-on-website">
<h4><a class="toc-backref" href="#id48">3. Poll for Messages on Website</a><a class="headerlink" href="#poll-for-messages-on-website" title="Permalink to this headline">¶</a></h4>
<p>Place this code in the section of the webpage hosting the widgets.
This script adds the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> library to your webpage.
Any Backplane-enabled widgets on this web page,
regardless of who made them, will have access to the Backplane bus.</p>
<p>Once included, the library facilitates the client side code for pulling, fetching, and getting tokens.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span>
<span class="na">src=</span><span class="s">&quot;http://d134l0cdryxgwa.cloudfront.net/backplane2.js&quot;</span> <span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="request-payload-from-backplane-server">
<span id="backplane-step-4"></span><h4><a class="toc-backref" href="#id49">4. Request Payload from Backplane Server</a><a class="headerlink" href="#request-payload-from-backplane-server" title="Permalink to this headline">¶</a></h4>
<p>Once the widget or web app on the site receives the message,
it will request more information from its <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widget Server</em></a> through a <a class="reference internal" href="#term-jsonp"><em class="xref std std-term">JSONP</em></a> call.
The <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widget Server</em></a> then requests the payload from the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.</p>
<p>The following is an example request in PHP:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// getdisplayname.php</span>

<span class="c1">// The config.ini file contains Backplane host information</span>
<span class="c1">// along with the access_token required for this server based</span>
<span class="c1">// client to interact with the Backplane server.</span>
<span class="nv">$settings</span> <span class="o">=</span> <span class="nb">parse_ini_file</span><span class="p">(</span><span class="s1">&#39;config.ini&#39;</span><span class="p">);</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;CLIENT_TOKEN&#39;</span><span class="p">,</span> <span class="nv">$settings</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;CALLBACK&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;callback&#39;</span><span class="p">]);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;CHANNEL&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;channel_name&#39;</span><span class="p">]);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;BP_POST_SSL&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;BP_POST_JSON&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;BP_CURL_ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;CURL-ERROR&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;BP_ELABEL_DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;BP_ELABEL_ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">);</span>

<span class="c1">// begin bp_post</span>
<span class="k">function</span> <span class="nf">bp_post</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">,</span> <span class="nv">$ssl</span> <span class="o">=</span> <span class="nx">BP_POST_SSL</span><span class="p">,</span> <span class="nv">$json</span> <span class="o">=</span> <span class="nx">BP_POST_JSON</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$curl</span> <span class="o">==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$json</span> <span class="o">===</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;Content-type: application/json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Authorization: Bearer &#39;</span> <span class="o">.</span> <span class="nx">CLIENT_TOKEN</span>
        <span class="p">));</span>
    <span class="p">}</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYPEER</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_FAILONERROR</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// end bp_post</span>

<span class="nv">$url</span>         <span class="o">=</span> <span class="nv">$settings</span><span class="p">[</span><span class="s1">&#39;backplane_server&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$settings</span><span class="p">[</span><span class="s1">&#39;backplane_version&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/message/&#39;</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;messageid&#39;</span><span class="p">];</span>
<span class="nv">$post_result</span> <span class="o">=</span> <span class="nx">bp_post</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$post</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$post_result</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$json</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$post_result</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$json</span><span class="o">-&gt;</span><span class="na">channel</span> <span class="o">!=</span> <span class="nx">CHANNEL</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;stat&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fail&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Channel mismatch.  Not authorized.&#39;</span>
        <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$json</span><span class="o">-&gt;</span><span class="na">payload</span><span class="o">-&gt;</span><span class="na">identities</span><span class="o">-&gt;</span><span class="na">entry</span><span class="o">-&gt;</span><span class="na">displayName</span><span class="p">;</span>
        <span class="nv">$arr</span>  <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;stat&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span>
            <span class="s1">&#39;displayName&#39;</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">,</span>
            <span class="s1">&#39;messageURL&#39;</span> <span class="o">=&gt;</span> <span class="nv">$json</span><span class="o">-&gt;</span><span class="na">messageURL</span>
        <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$name</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;stat&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fail&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;server side component failed to retrieve message payload&#39;</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;stat&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fail&#39;</span><span class="p">,</span>
        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;server side component failed to retrieve message payload&#39;</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type: text/javascript&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="nx">CALLBACK</span> <span class="o">.</span> <span class="s2">&quot;(&quot;</span> <span class="o">.</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$arr</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="process-payload">
<h4><a class="toc-backref" href="#id50">5. Process Payload</a><a class="headerlink" href="#process-payload" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> delivers the payload
to the <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widget Server</em></a> as a JSON file.</p>
<p>The <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widget Server</em></a> must parse and then store data from this file.
Not all data needs to be preserved.
The storage and format is completely up to the <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widget Server</em></a>.
All that matters is that the server can send a JSON payload to a widget.</p>
</div>
<div class="section" id="widget-server-subset-of-payload-to-widget">
<h4><a class="toc-backref" href="#id51">6. Widget Server Subset of Payload to Widget</a><a class="headerlink" href="#widget-server-subset-of-payload-to-widget" title="Permalink to this headline">¶</a></h4>
<p>Finally,
in response to the widget’s or web app’s JSONP call,
the <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widget Server</em></a> returns only the data required to update the state of the widget.
For example: some Widgets may only want to update the <strong>User Name</strong> to welcome the user.</p>
</div>
</div>
</div>
<div class="section" id="terms">
<h2><a class="toc-backref" href="#id52">Terms</a><a class="headerlink" href="#terms" title="Permalink to this headline">¶</a></h2>
<dl class="glossary docutils">
<dt id="term-activity-message">Activity Message</dt>
<dd>The message published on the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> channel
that alerts widgets that a user has shared and activity.</dd>
<dt id="term-activity-scenario">Activity Scenario</dt>
<dd><p class="first">An implementation of <a class="reference internal" href="#term-backplane-protocol"><em class="xref std std-term">Backplane Protocol</em></a>
that publishes <a class="reference internal" href="#term-activity-message"><em class="xref std std-term">Activity Message</em></a> to update widgets on a website.</p>
<p class="last">When a user shares an activity, such as a video, or image, on a social network,
all widgets listening will know as well.</p>
</dd>
<dt id="term-application-vendors">Application Vendors</dt>
<dd>Product developers who are making their web apps,
or widgets Backplane compliant, and able to listen for <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a>.</dd>
<dt id="term-backplane-javascript">Backplane JavaScript</dt>
<dd>(TBD)</dd>
<dt id="term-backplane-protocol">Backplane Protocol</dt>
<dd>The <a class="reference internal" href="#backplane-protocol">Backplane Protocol</a>  is an open source,
cross company initiative aimed at advancing web app communication technology.</dd>
<dt id="term-backplane-server">Backplane Server</dt>
<dd>The server set up to relay messages to and from widgets.
The purpose of the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> is to create a channel.
Widgets publish messages to this channel,
and widgets listening to this channel are delivered the message.</dd>
<dt id="term-bus-owner">Bus Owner</dt>
<dd>The <strong>authenticated user</strong> that accesses a channel on a <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.</dd>
<dt id="term-capture">Capture</dt>
<dd>Social Data Storage.
<a class="reference external" href="http://janrain.com/products/capture/">http://janrain.com/products/capture/</a></dd>
<dt id="term-cors">CORS</dt>
<dd>Cross-Origin Resource Sharing ( <a class="reference external" href="http://www.w3.org/TR/cors/">http://www.w3.org/TR/cors/</a> )</dd>
<dt id="term-engage">Engage</dt>
<dd><a class="reference internal" href="#term-janrain"><em class="xref std std-term">Janrain</em></a> Engage enables sites to provide a convenient and secure way to sign up and sign in.
<a href="#id2"><span class="problematic" id="id3">`</span></a>Formerly known as RPX &lt;<a class="reference external" href="http://en.wikipedia.org/wiki/Janrain">http://en.wikipedia.org/wiki/Janrain</a>&gt; <a href="#id4"><span class="problematic" id="id5">`</span></a>_.
( <a class="reference external" href="http://developers.janrain.com/documentation/engage/">http://developers.janrain.com/documentation/engage/</a> )</dd>
<dt id="term-identity-message">Identity  Message</dt>
<dd>The message published on the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> channel
that alerts widgets that a user has been authenticated.</dd>
<dt id="term-identity-connector">Identity Connector</dt>
<dd>(TBD)</dd>
<dt id="term-identity-scenario">Identity Scenario</dt>
<dd>An implementation of <a class="reference internal" href="#term-backplane-protocol"><em class="xref std std-term">Backplane Protocol</em></a>
that publishes <em class="xref std std-term">Identity Messages</em> to update widgets on a website.
These widgets then can collect current user data.</dd>
<dt id="term-janrain">Janrain</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="http://janrain.com/">http://janrain.com/</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Janrain">http://en.wikipedia.org/wiki/Janrain</a></li>
</ul>
</dd>
<dt id="term-jsonp">JSONP</dt>
<dd>JSON with padding ( <a class="reference external" href="http://ja.wikipedia.org/wiki/JSONP">http://ja.wikipedia.org/wiki/JSONP</a> )
See <a class="reference internal" href="#term-cors"><em class="xref std std-term">CORS</em></a></dd>
<dt id="term-oauth2">OAuth2</dt>
<dd>A community-based specification providing a much needed solution
for security web APIs without requiring users to share their usernames and passwords.</dd>
<dt id="term-payload">Payload</dt>
<dd><p class="first">The data indicated by the message.</p>
<p>In version 1.2, the payload is included with the message.</p>
<p class="last">In version 2.0, the payload is requested by the widget separately,
after it receives a message.</p>
</dd>
<dt id="term-scenario">Scenario</dt>
<dd>Protocol extension that defines one
or more message types and specifies their semantics,
use, and so on.</dd>
<dt id="term-site-owner">Site Owner</dt>
<dd>The individual adding the <a class="reference internal" href="#term-backplane-protocol"><em class="xref std std-term">Backplane Protocol</em></a> to a website,
namely adding code to enable a <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.</dd>
<dt id="term-widget-server">Widget Server</dt>
<dd>Relying Party
(TBD)</dd>
</dl>
</div>
</div>
<div class="section" id="backplane-2-0">
<h1><a class="toc-backref" href="#id53">Backplane 2.0</a><a class="headerlink" href="#backplane-2-0" title="Permalink to this headline">¶</a></h1>
<div class="section" id="abstract">
<span id="backplane-abstract"></span><h2><a class="toc-backref" href="#id54">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://sites.google.com/site/backplanespec/documentation/backplane2-0-draft08">https://sites.google.com/site/backplanespec/documentation/backplane2-0-draft08</a></li>
</ul>
<p>Backplane is a framework that facilitates <em class="xref std std-term">message exchanges</em>
and <em class="xref std std-term">event notifications</em>
between third-party JavaScript components within a web page.</p>
<p>(draft 08 )</p>
</div>
<div class="section" id="introduction">
<span id="backplane-1"></span><h2><a class="toc-backref" href="#id55">1.  Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Web pages have evolved from being loaded from a single resource
to being able to reference third-party,
external components that get loaded,
run and rendered by the web browser within the same web page.</p>
<p>These components can be active and continue to run
after the web page completed loading
and are generally decoupled
— not under the control of a single entity.</p>
<p>Interactions between the <em class="xref std std-term">end user</em>, the web page,
and its features provided through such components can greatly benefit
when all parties involved can exchange information with each other,
and can do it in a standardized way.</p>
<p>The Backplane framework facilitates such interactions
by providing an open standard API that is secure
in the context of the assumed trust relationships
between the parties involved.
Messages are delivered <strong>reliably</strong> and <strong>in order</strong>.
The framework may be used in different scenarios
which build on top of the transport-level semantics described in this document.</p>
<p>(draft 08)</p>
</div>
<div class="section" id="definitions">
<span id="backplane-2"></span><h2><a class="toc-backref" href="#id56">2.  Definitions</a><a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h2>
<dl class="glossary docutils">
<dt id="term-web-page">Web Page</dt>
<dd>Document obtained from a web resource and loaded by the end user&#8217;s web browser.</dd>
<dt id="term-widget"><span id="term-widgets"></span>Widget<br />Widgets</dt>
<dd>Third-party JavaScript component referenced from the <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a>
that is loaded and run in the end user&#8217;s browser.</dd>
<dt id="term-backplane-client"><span id="term-backplane-clients"></span>Backplane Client<br />Backplane Clients</dt>
<dd>Entity that uses the Backplane framework to exchange information.</dd>
<dt id="term-backplane-message"><span id="term-backplane-messages"></span>Backplane Message<br />Backplane Messages</dt>
<dd>A JSON object representing the unit of communication
between <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>.</dd>
<dt id="term-message-identifier">Message Identifier</dt>
<dd><strong>Unique string</strong> assigned by <em class="xref std std-term">Backplane Servers</em>
to each incoming <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a> for the purpose of identifying
and referencing them via the &#8220;since&#8221; retrieval mechanism.</dd>
<dt id="term-backplane-header">Backplane Header</dt>
<dd>A <a class="reference internal" href="#term-backplane-message"><em class="xref std std-term">Backplane Message</em></a> without the payload field.</dd>
<dt id="term-backplane-javascript-api">Backplane JavaScript API</dt>
<dd>JavaScript API used by Widgets to initialize and subscribe to Backplane Messages.</dd>
<dt id="term-backplane-javascript-library">Backplane JavaScript Library</dt>
<dd><a class="reference internal" href="#backplane-javascript-api"><em>Backplane JavaScript API implementation</em></a>.</dd>
<dt id="term-backplane-server-api">Backplane Server API</dt>
<dd>Server API through which <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> send
and retrieve Backplane Messages.</dd>
<dt id="term-32">Backplane Server</dt>
<dd>Backplane Server API implementation.</dd>
<dt id="term-bus"><span id="term-buses"></span>Bus<br />Buses</dt>
<dd>Logical grouping of <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>
that need to interact with each other,
typically belonging to one organization.</dd>
<dt id="term-channel">Channel</dt>
<dd>Subset of <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a>
that belong to a <a class="reference internal" href="#term-41"><em class="xref std std-term">Bus</em></a> and are addressed to the <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>
interacting with the end user through a single session and <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a>.</dd>
<dt id="term-message-sequence">Message Sequence</dt>
<dd>A set of <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a> that meet a certain filter criteria,
in the same order as they have been received by a <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.</dd>
<dt id="term-message-age">Message Age</dt>
<dd>The length of time since the <a class="reference internal" href="#term-backplane-message"><em class="xref std std-term">Message</em></a> was received
by the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.</dd>
</dl>
<p>(draft 08)</p>
</div>
<div class="section" id="backplane-3">
<span id="id6"></span><h2><a class="toc-backref" href="#id57">3.  Overview</a><a class="headerlink" href="#backplane-3" title="Permalink to this headline">¶</a></h2>
<p>An operational Backplane framework consists of the following components:</p>
<ul class="simple">
<li>A <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a></li>
<li>A <a class="reference internal" href="#term-backplane-javascript-library"><em class="xref std std-term">Backplane JavaScript Library</em></a></li>
<li><a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a> that act as <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a></li>
<li><a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a>&#8216; server-side counterparts that act as <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Widgets  are Backplane Clients</li>
<li>Widget Servers are also Backplane Clients</li>
</ul>
</div>
<p>A <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> is an <strong>independent orchestrator</strong> of the message interchange
between <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> and may serve multiple independent <a class="reference internal" href="#term-buses"><em class="xref std std-term">Buses</em></a>.</p>
<p>A Backplane framework instance needs to be configured prior to use:
all <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> and the <a class="reference internal" href="#term-32"><em class="xref std std-term">Server</em></a> have to share the same <a class="reference internal" href="#term-41"><em class="xref std std-term">Bus</em></a>.
<a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> operating at the <a class="reference internal" href="#backplane-5-2"><em>Privileged Access Level (Privileged Access)</em></a>
need a password to authenticate themselves to the Server.
It is outside the scope of this document how such configuration is performed.</p>
<p>(draft 08)</p>
</div>
<div class="section" id="trust">
<span id="backplane-4"></span><h2><a class="toc-backref" href="#id58">4.  Trust</a><a class="headerlink" href="#trust" title="Permalink to this headline">¶</a></h2>
<p>The Backplane framework is intended to be used and operate
under the following trust relationships.
Any number of security issues can arise if any of these assumptions do not hold.</p>
<blockquote>
<div><p>The <em class="xref std std-term">end user</em> trusts the <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a> owner
(and indirectly all Widget owners) that the <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a> will not attack or exploit their web browser.</p>
<p>The <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a> owner (and indirectly the end user) trusts all <a class="reference internal" href="#term-widget"><em class="xref std std-term">Widget</em></a> owners
that the <a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a> will not abuse the Backplane framework
by trying to impersonate other Widgets&#8217; behavior
in order to obtain and access information that is not directed to them,
such as end user account information addressed to other <a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a>.</p>
<p>The <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a> owner (and indirectly the end user),
and <a class="reference internal" href="#term-widget"><em class="xref std std-term">Widget</em></a> owners trust the <a class="reference internal" href="#term-backplane-server-api"><em class="xref std std-term">Backplane Server API</em></a>
and <a class="reference internal" href="#term-backplane-javascript-api"><em class="xref std std-term">Backplane JavaScript API</em></a> implementations that they will comply with this specification.</p>
<p>The <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a> owner (and indirectly the end user) trusts all content on the <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a>
to not attack the widgets or the Backplane framework.
This must explicitly include all JavaScript loaded for any purpose,
including JavaScript that is not part of any of the <a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a> on the Web Page.</p>
<p><a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> trust the <a class="reference internal" href="#term-41"><em class="xref std std-term">Bus</em></a> owner
and the authenticity of <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a> received through a <a class="reference internal" href="#term-41"><em class="xref std std-term">Bus</em></a>,
i.e all <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> that were granted permission to post on the <a class="reference internal" href="#term-41"><em class="xref std std-term">Bus</em></a> by its owner.</p>
</div></blockquote>
<p>(draft 08)</p>
</div>
<div class="section" id="access-levels">
<span id="backplane-5"></span><span id="id7"></span><h2><a class="toc-backref" href="#id59">5.  Access Levels</a><a class="headerlink" href="#access-levels" title="Permalink to this headline">¶</a></h2>
<p>Considering the significantly different security enforcement capabilities
of applications running in a web browser versus the ones running on a web server,
two access levels are defined for <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>:
<a class="reference internal" href="#regular-access"><em>Regular</em></a> and <a class="reference internal" href="#privileged-access"><em>Privileged</em></a>.</p>
<p>Each access level is exercised for retrieving messages
from the <a class="reference internal" href="#backplane-13-2"><em>Get Messages (Get Messages)</em></a> endpoint
by presenting either a regular or a privileged access token
obtained from the <em class="xref std std-term">token (Access Token Request)</em> endpoint.
The access token MUST be presented as described
<a class="reference internal" href="bearer.html#bearer-2-1"><em>in section 2.1</em></a>
(Jones, M., Hardt, D., and D. Recordon, “The OAuth 2.0 Protocol: Bearer Tokens,” Jun 2011.)
[OAuth2.token.bearer].</p>
<p><em class="xref std std-term">Backplane Servers</em> MUST validate the access token presented
with all requests received at the <a class="reference internal" href="#backplane-13-2"><em>Get Messages (Get Messages)</em></a> endpoint
and determine the access level associated with it.</p>
<p>(draft 08)</p>
<div class="section" id="backplane-5-1">
<span id="regular-access"></span><span id="id8"></span><h3><a class="toc-backref" href="#id60">5.1.  Regular Access</a><a class="headerlink" href="#backplane-5-1" title="Permalink to this headline">¶</a></h3>
<p>Regular access level is given to <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> running in the web browser
(<a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a> and the <a class="reference internal" href="#term-backplane-javascript-library"><em class="xref std std-term">Backplane JavaScript Library</em></a>)
and are obtained through <strong>anonymous calls</strong> to the <a class="reference internal" href="#backplane-13-1"><em>token (Access Token Request)</em></a> endpoint.</p>
<p><em class="xref std std-term">Bus owners</em> and <em class="xref std std-term">Backplane Servers</em> acting on their behalf
MUST NOT give authorization credentials for Privileged access level
to <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> running in the web browser.</p>
<p><em class="xref std std-term">Backplane Servers</em> MUST only make <em class="xref std std-term">Backplane Message Headers</em>
(not full <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a>)
available to Clients having Regular access level.</p>
<p>(draft 08)</p>
</div>
<div class="section" id="backplane-5-2">
<span id="privileged-access"></span><span id="id9"></span><h3><a class="toc-backref" href="#id61">5.2.  Privileged Access</a><a class="headerlink" href="#backplane-5-2" title="Permalink to this headline">¶</a></h3>
<p>Privileged access level is given to <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>
that are <strong>not</strong> running in a web browser
(typically the <a class="reference internal" href="#term-widget-server"><em class="xref std std-term">Widgets&#8217; server-side components</em></a>)
and are obtained through authenticated calls to the <a class="reference internal" href="#backplane-13-1"><em>token (Access Token Request)</em></a> endpoint.</p>
<p><a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> having Privileged access level can perform the following operations
on a <a class="reference internal" href="#term-41"><em class="xref std std-term">Bus</em></a> for which they have obtained authorization (Authorization) credentials from the Bus owner:</p>
<ul class="simple">
<li>retrieve all Backplane Messages sent to the Bus [[[ xref ]]]</li>
<li>post Backplane Messages to a Channel [[[ xref ]]]</li>
</ul>
<p>(draft 08)</p>
<div class="section" id="authorization">
<span id="backplane-5-2-1"></span><h4><a class="toc-backref" href="#id62">5.2.1.  Authorization</a><a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h4>
<p>Registered (Backplane Client Registration) <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> must be authorized
with Privilged Access Level. This can be done in one of the following ways:</p>
<ul class="simple">
<li>By <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> administrators.
It is outside of the scope of this specification
how the administrators learn from their customers,
the <em class="xref std std-term">Bus Owners</em>, the <a class="reference internal" href="#term-buses"><em class="xref std std-term">Buses</em></a> and <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> to be authorized with Privileged Access.</li>
<li>By <em class="xref std std-term">Bus Owners</em>,
through an administrative interface provided by the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.
The interactions between a <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> and its <a class="reference internal" href="#term-bus-owner"><em class="xref std std-term">Bus Owner</em></a> customers
(e.g. registration, authentication, Bus allocation) remain outside of the scope of this specification.</li>
</ul>
<p>(draft 08)</p>
</div>
</div>
</div>
<div class="section" id="discovery-registration-and-authorization">
<span id="backplane-6"></span><h2><a class="toc-backref" href="#id63">6.  Discovery, Registration and Authorization</a><a class="headerlink" href="#discovery-registration-and-authorization" title="Permalink to this headline">¶</a></h2>
<p>For a functional setup,
the <em class="xref std std-term">Bus Owners</em>, <em class="xref std std-term">Backplane Servers</em> and <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>
needing Privileged Access have to perform the following preliminary interactions:</p>
<ul class="simple">
<li><em class="xref std std-term">Bakplane Clients</em> must <a class="reference internal" href="#backplane-6-1"><em>discover (Backplane Server Discovery)</em></a>
<em class="xref std std-term">Backplane Servers</em>&#8216; endpoints for registration, authorization, token, message.</li>
<li><a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> must <a class="reference internal" href="#backplane-6-2"><em>register (Backplane Client Registration)</em></a>
with <em class="xref std std-term">Backplane Servers</em>.</li>
<li><em class="xref std std-term">Bus Owners</em> must <a class="reference internal" href="#backplane-6-3"><em>authorize (Authorization)</em></a>
<a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> with Privileged Access.</li>
</ul>
<p>(draft 08)</p>
<div class="section" id="backplane-server-discovery">
<span id="backplane-6-1"></span><h3><a class="toc-backref" href="#id64">6.1.  Backplane Server Discovery</a><a class="headerlink" href="#backplane-server-discovery" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dynamic-discovery">
<span id="backplane-6-1-1"></span><h4><a class="toc-backref" href="#id65">6.1.1.  Dynamic Discovery</a><a class="headerlink" href="#dynamic-discovery" title="Permalink to this headline">¶</a></h4>
<p>It is RECOMMENDED that Backplane Servers support dynamic discovery,
as described in
[OAuth.Dynamic.Client.Registration] (Hardjono, T., Machulak, M., Maler, E., and C. Scholz, “OAuth Dynamic Client Registration Protocol,” Oct 2011.) section 5. Discovery of Server&#8217;s Client Registration Endpoint.
[[[ doesn&#8217;t cover authorization/token endpoints, it probably should ]]]</p>
<p>(draft 08)</p>
</div>
<div class="section" id="static-discovery">
<span id="backplane-6-1-2"></span><h4><a class="toc-backref" href="#id66">6.1.2.  Static Discovery</a><a class="headerlink" href="#static-discovery" title="Permalink to this headline">¶</a></h4>
<p>When dynamic discovery is not available, Backplane Clients must independently acquire and keep configuration entries for the registration, authorization, token and message endpoints of the Backplane Servers they wish to interact with.</p>
<p>(draft 08)</p>
</div>
</div>
<div class="section" id="backplane-client-registration">
<span id="backplane-6-2"></span><h3><a class="toc-backref" href="#id67">6.2.  Backplane Client Registration</a><a class="headerlink" href="#backplane-client-registration" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> need to be registered with the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>
in order to be authorized with <a class="reference internal" href="#backplane-5-2"><em>Privileged Access (Privileged Access)</em></a>.</p>
<p><em class="xref std std-term">Backplane Servers</em> SHOULD provide one of the following registation methods,
listed in decreasing order of preference.</p>
<p>(draft08)</p>
<div class="section" id="dynamic-client-registration">
<span id="backplane-6-2-1"></span><h4><a class="toc-backref" href="#id68">6.2.1.  Dynamic Client Registration</a><a class="headerlink" href="#dynamic-client-registration" title="Permalink to this headline">¶</a></h4>
<p>It is RECOMMENDED that <em class="xref std std-term">Backplane Servers</em> and <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> employ
[OAuth.Dynamic.Client.Registration]
(Hardjono, T., Machulak, M., Maler, E., and C. Scholz, “OAuth Dynamic Client Registration Protocol,” Oct 2011.)
as described in sections
&#8220;6. Client Registration with Pushed Metadata&#8221; and
&#8220;7. Client Registration with Pushed URL and Pulled Metadata&#8221;.</p>
<p>(draft 08)</p>
</div>
<div class="section" id="static-client-registration">
<span id="backplane-6-2-2"></span><h4><a class="toc-backref" href="#id69">6.2.2.  Static Client Registration</a><a class="headerlink" href="#static-client-registration" title="Permalink to this headline">¶</a></h4>
<p><em class="xref std std-term">Backplane Servers</em> MAY provide an administrative interface
through which <em class="xref std std-term">Bus Owners</em> can register <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>.
The interactions between a <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> and its <a class="reference internal" href="#term-bus-owner"><em class="xref std std-term">Bus Owner</em></a> customers
(e.g. registration, authentication, <em class="xref std std-term">Bus allocation</em>) remain outside of the scope of this specification.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="#term-buses"><em class="xref std std-term">Buses</em></a> seems to have to be allocated at <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a></p>
</div>
<p>For the purpose of Privileged Access Level authorization
a server-side <a class="reference internal" href="#term-backplane-client"><em class="xref std std-term">Backplane Client</em></a> needs to be identified by a URL
that corresponds to the Redirection URI defined in section 2.1.1
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.)
[OAuth2]
and used in the authorization step in section 4
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.)
[OAuth2].</p>
<p>The redirection URI MUST be obtained and approved by the <a class="reference internal" href="#term-bus-owner"><em class="xref std std-term">Bus Owner</em></a> administrator.
<em class="xref std std-term">Backplane Servers</em> may assist <a class="reference internal" href="#term-bus-owner"><em class="xref std std-term">Bus Owner</em></a> administrators
by providing the redirection URIs of well known <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>
(such as popular <a class="reference internal" href="#term-widget"><em class="xref std std-term">Widget</em></a> providers) in their administration user interface.</p>
<p>When completing
a <a class="reference internal" href="#backplane-6-3-2"><em>Backplane Server Initiated Authorization (Backplane Server Initiated Authorization)</em></a>
if the previously unregistered <a class="reference internal" href="#term-backplane-client"><em class="xref std std-term">Backplane Client</em></a> opted to also send client credentials,
the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> MAY <a class="reference internal" href="#backplane-6-2-2"><em>register (Static Client Registration)</em></a>
the <a class="reference internal" href="#term-backplane-client"><em class="xref std std-term">Backplane Client</em></a>.</p>
<p>The Backplane Server MUST verify all of the following:</p>
<ul class="simple">
<li>The grant_type is &#8220;<a class="reference internal" href="standard.html#term-19"><em class="xref std std-term">code</em></a>&#8221;.</li>
<li>The code is present and the value is recognized as a previously issued, one-time use, valid code.</li>
<li>The <a class="reference internal" href="standard.html#term-redirect-uri"><em class="xref std std-term">redirect_uri</em></a> is present and matches the redirect_uri for which the supplied <a class="reference internal" href="standard.html#term-19"><em class="xref std std-term">code</em></a> was issued.</li>
<li>The <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a> is present and is different than &#8220;<em class="xref std std-term">anonymous</em>&#8221; or any other already registered client_id.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OAuth code flow</li>
<li>&#8220;anonymouse&#8221; is special client_id for Wiget</li>
</ul>
</div>
<p>After a successful registration the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> MUST continue processing
the <a class="reference internal" href="#backplane-13-1-2"><em>Authenticated Access Token Request (Authenticated Access Token Request)</em></a></p>
<p>(draft 08)</p>
</div>
<div class="section" id="manual-client-registration">
<span id="backplane-6-2-3"></span><h4><a class="toc-backref" href="#id70">6.2.3.  Manual Client Registration</a><a class="headerlink" href="#manual-client-registration" title="Permalink to this headline">¶</a></h4>
<p>As a last resort, Backplane Server administrators MAY manually register Backplane Clients and make them available to Bus Owners for Privileged Access authorization.</p>
<p>(draft 08)</p>
</div>
</div>
<div class="section" id="backplane-6-3">
<span id="id10"></span><h3><a class="toc-backref" href="#id71">6.3.  Authorization</a><a class="headerlink" href="#backplane-6-3" title="Permalink to this headline">¶</a></h3>
<div class="section" id="backplane-client-initiated-authorization">
<span id="backplane-6-3-1"></span><h4><a class="toc-backref" href="#id72">6.3.1.  Backplane Client Initiated Authorization</a><a class="headerlink" href="#backplane-client-initiated-authorization" title="Permalink to this headline">¶</a></h4>
<p>A <a class="reference internal" href="#term-bus-owner"><em class="xref std std-term">Bus Owner</em></a> MAY initiate standard <a class="reference internal" href="glossary.html#term-oauth"><em class="xref std std-term">OAuth</em></a> 2.0 authorization <em class="xref std std-term">code flow</em>
from the <a class="reference internal" href="#term-backplane-client"><em class="xref std std-term">Backplane Client</em></a> as described in section 4.1 Authorization Code
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.) [OAuth2],
if supported by the <a class="reference internal" href="#term-backplane-client"><em class="xref std std-term">Backplane Client</em></a>.
<em class="xref std std-term">Backplane Servers</em> SHOULD support the standard OAuth Authorization Code flow.</p>
<p>(draft 08)</p>
</div>
<div class="section" id="backplane-server-initiated-authorization">
<span id="backplane-6-3-2"></span><h4><a class="toc-backref" href="#id73">6.3.2.  Backplane Server Initiated Authorization</a><a class="headerlink" href="#backplane-server-initiated-authorization" title="Permalink to this headline">¶</a></h4>
<p>Backplane Servers MAY provide an administrative interface
through which Bus Owners can initiate the authorization of registered
(Backplane Client Registration) Backplane Clients
using a slightly modified OAuth Authorization Code flow
described in this section.</p>
<p>Once the Backplane Client has been identified and
the Bus Owner has selected the Buses for authorization,
the Backplane Server persists the authorization grant,
generates an OAuth code for it and
sends it with an unsolicited OAuth Authorization Response
to the Backplane Client&#8217;s redirection URI.
The successful authorization response SHOULD contain a space sperated list
with the authorized Bus names in the scope field.</p>
<p>Since an unsolicited OAuth Authorization Response is issued,
the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>&#8216;s token (Access Token Request) endpoint MUST be identified
in the Redirection URI using a query parameter named <em class="xref std std-term">bp_token_endpoint</em>.</p>
<p>The <a class="reference internal" href="#term-backplane-client"><em class="xref std std-term">Backplane Client</em></a> continues by following the OAuth Authorization Code flow
from this point, and exchanges the authorization code for an access token
at the Backplane Server&#8217;s token endpoint,
as described in sections 4.1.3 and 4.1.4
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.)
[OAuth2] and Access Token Request (Access Token Request).</p>
<p>(draft 08)</p>
</div>
</div>
</div>
<div class="section" id="padded-responses">
<span id="backplane-7"></span><h2><a class="toc-backref" href="#id74">7.  Padded Responses</a><a class="headerlink" href="#padded-responses" title="Permalink to this headline">¶</a></h2>
<p>For API requests made by the Javascript Library,
the response is formatted specially.</p>
<p>The response body begins with the value of the callback parameter
from the request.
That value is followed by a &#8220;(&#8221; (opening parenthesis),
then the JSON-encoded result value, then a &#8221;)&#8221; (closing parenthesis).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="#term-jsonp"><em class="xref std std-term">JSONP</em></a></p>
</div>
<p>(draft 08)</p>
</div>
<div class="section" id="buses">
<span id="backplane-8"></span><h2><a class="toc-backref" href="#id75">8.  Buses</a><a class="headerlink" href="#buses" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="#term-41"><em class="xref std std-term">Bus</em></a> is a <strong>logical grouping</strong> of <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>
that need to interact with each other,
typically belonging to one organization.
<a class="reference internal" href="#term-buses"><em class="xref std std-term">Buses</em></a> allow a <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> to service multiple customers.
<em class="xref std std-term">Bus names</em> are short strings referencing the <a class="reference internal" href="#term-bus-owner"><em class="xref std std-term">Bus owner</em></a>&#8216;s name
(e.g. &#8220;customer.com&#8221;, &#8220;organization.org&#8221;).
<a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> must know the identifiers for the <a class="reference internal" href="#term-buses"><em class="xref std std-term">Buses</em></a>
through which they wish to exchange <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a>.</p>
<p>It is assumed
that a relationship of trust exists between all clients
granted permission to post messages to a specific <a class="reference internal" href="#term-41"><em class="xref std std-term">Bus</em></a> (see <a class="reference internal" href="#backplane-4"><em>Trust (Trust)</em></a>).</p>
<p>(draft 08)</p>
</div>
<div class="section" id="channels">
<span id="backplane-9"></span><h2><a class="toc-backref" href="#id76">9.  Channels</a><a class="headerlink" href="#channels" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="#term-42"><em class="xref std std-term">Channel</em></a> is a subset of <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a>
that belong to a <a class="reference internal" href="#term-41"><em class="xref std std-term">Bus</em></a> and are addressed to the <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>
interacting with the end user through a single session
and <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a>.</p>
<p>A Channel is similar to a <strong>session identifier</strong> for the user
but is <strong>shared</strong> by multiple <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a>.</p>
<p>Channels are:</p>
<ul class="simple">
<li>allocated within <a class="reference internal" href="#term-buses"><em class="xref std std-term">Buses</em></a></li>
<li>referenced by unique, unguessable identifiers</li>
<li>created implicitly
once a <a class="reference internal" href="#term-backplane-message"><em class="xref std std-term">Backplane Message</em></a> gets posted to a <a class="reference internal" href="#term-42"><em class="xref std std-term">channel</em></a> that doesn&#8217;t yet exist</li>
<li><strong>non-persistent</strong> and expire after being inactive (no messages posted)
for specific amount of time (e.g. 30 minutes)</li>
<li>sensitive;
see <a class="reference internal" href="#backplane-15-1"><em>Channel Name Sensitivity (Channel Name Sensitivity)</em></a>.</li>
</ul>
<p><em class="xref std std-term">Channel identifiers</em> are used by <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> for message retrieval.
All <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> that know a given Channel identifier
can receive <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a> posted to that <a class="reference internal" href="#term-42"><em class="xref std std-term">Channel</em></a>.</p>
<p>Channel identifiers MUST only contain characters from the <a class="reference internal" href="session.html#term-base64url"><em class="xref std std-term">base64url</em></a>
(Josefsson, S., “The Base16, Base32, and Base64 Data Encodings,” October 2006.)
[RFC4648.section5] character set
and be <strong>at least 32 characters</strong> long.
New <em class="xref std std-term">channels</em> are generated only
on <a class="reference internal" href="#backplane-13-1-1"><em>anonymous access token requests (Anonymous Access Token Request)</em></a>.</p>
<p>The channel name <strong>MUST NOT be guessable</strong> given knowledge of the algorithms
in use or any details of the request being made
(RFC 4086 (Eastlake, D., Schiller, J., and S. Crocker, “Randomness Requirements for Security,” June 2005.)
[RFC4086] discusses the requirements and pitfalls of generating unguessable values in great detail).</p>
<p>There can be at most one channel active on a <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a> at a given time.</p>
<p>(draft 08)</p>
</div>
<div class="section" id="backplane-messages">
<span id="backplane-10"></span><h2><a class="toc-backref" href="#id77">10.  Backplane Messages</a><a class="headerlink" href="#backplane-messages" title="Permalink to this headline">¶</a></h2>
<p>A Backplane message is a JSON object with the following fields:</p>
<dl class="glossary docutils">
<dt id="term-messageurl">messageURL</dt>
<dd>(string)
a URL that a client can use to retrieve the message</dd>
<dt id="term-source">source</dt>
<dd>(string)
an arbitrary URL identifying the client which posted the message
[[[ who/how/when/where? ]]]</dd>
<dt id="term-type">type</dt>
<dd>(string)
opaque to the core Backplane specification;
value, semantic and associated payload format is defined in application scenario specifications</dd>
<dt id="term-41">bus</dt>
<dd>(string)
the name of the Bus the message was posted to</dd>
<dt id="term-42">channel</dt>
<dd>(string)
the identifier of Channel the message was posted to</dd>
<dt id="term-sticky">sticky</dt>
<dd>(boolean)
sticky flag. See Sticky Messages (Sticky Messages)</dd>
<dt id="term-44">payload</dt>
<dd>(object)
arbitrary data specific to the particular message type</dd>
</dl>
<p>The presence of certain fields in a <a class="reference internal" href="#term-backplane-message"><em class="xref std std-term">Backplane message</em></a> depends on the context it appears in.</p>
<p>A <strong>downstream</strong> (server-to-client) Backplane message MUST contain all the fields listed above.
If the client receiving the message has regular access,
the server MUST omit the &#8220;<a class="reference internal" href="#term-44"><em class="xref std std-term">payload</em></a>&#8221; field.</p>
<p>An <strong>upstream</strong> (client-to-server) Backplane message MUST only contain the following fields:
&#8220;<a class="reference internal" href="#term-41"><em class="xref std std-term">bus</em></a>&#8221;, &#8220;<a class="reference internal" href="#term-42"><em class="xref std std-term">channel</em></a>&#8221;, &#8220;<a class="reference internal" href="#term-44"><em class="xref std std-term">payload</em></a>&#8221;, &#8220;<a class="reference internal" href="reg.html#term-type"><em class="xref std std-term">type</em></a>&#8221;.</p>
<p>Example downstream Backplane Message:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;bus&quot;</span><span class="o">:</span> <span class="s2">&quot;customer.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;channel&quot;</span><span class="o">:</span> <span class="s2">&quot;67dc880cc265b0dbc755ea959b257118&quot;</span><span class="p">,</span>
    <span class="s2">&quot;messageURL&quot;</span><span class="o">:</span> <span class="s2">&quot;https://bp.example.com/v2/message/097a5cc401001f95b45d37aca32a3bd2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;http://aboutecho.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="o">:</span> <span class="s2">&quot;administrator&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;identity/ack&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 08)</p>
</div>
<div class="section" id="message-retention">
<span id="backplane-11"></span><h2><a class="toc-backref" href="#id78">11.  Message Retention</a><a class="headerlink" href="#message-retention" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Message retained at Backplane Server  has TTL.</li>
<li>&#8220;TTL=5(min)&#8221; is recommendation.</li>
</ul>
</div>
<p><em class="xref std std-term">Backplane Servers</em> MUST maintain a buffer of messages
received from all their clients
until messages become older than a certain <strong>threshold</strong>.</p>
<p>Such threshold MUST be no less than 1 minute.
It is RECOMMENDED that <em class="xref std std-term">Backplane Servers</em> set the threshold to <strong>at least 5 minutes</strong>.
A message is considered obsolete once its age reaches the threshold.</p>
<p>It is RECOMMENDED that <em class="xref std std-term">Backplane Servers</em> make messages available
for retrieval as soon as possible after they are posted.</p>
<p><a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> that require reliable message delivery
MUST poll their <em class="xref std std-term">Backplane Servers</em>
with an interval of 30 seconds or less in order to avoid omissions.</p>
<p>(draft 08)</p>
<div class="section" id="sticky-messages">
<span id="backplane-11-1"></span><h3><a class="toc-backref" href="#id79">11.1.  Sticky Messages</a><a class="headerlink" href="#sticky-messages" title="Permalink to this headline">¶</a></h3>
<p>Some Backplane application scenarios may require longer lived <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a>,
such as for keeping a shared state about a end user&#8217;s logged-in identity or profile data.</p>
<p>Support for such scenarios is accomplished by flagging messages as &#8220;sticky&#8221;
when they are <a class="reference internal" href="#backplane-13-4"><em>posted (see Post Messages To A Channel (Post Messages))</em></a>.
<em class="xref std std-term">Backplane Servers</em> MUST retain sticky messages for at least X minutes.
It is RECOMMENDED that <em class="xref std std-term">Backplane Servers</em> retain sticky messages for Y minutes.</p>
<p><a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> can request retrieval of Backplane Frames
that only encapsulate sticky messages
by using the &#8220;sticky&#8221; <a class="reference internal" href="#backplane-12-1"><em>Access Scope (Access Scopes)</em></a> filter.
See also <a class="reference internal" href="#backplane-12"><em>Message Retrieval Conventions (Message Sequences and Retrieval)</em></a> below.</p>
<p>Application scenario protocols MUST specify the criteria for posting sticky messages,
if any,
such as defining certain message types or operations as sticky.</p>
<p>Application scenario protocols SHOULD define <a href="#id98"><span class="problematic" id="id99">`sticky messages`_</span></a>
in such a way as to minimize the number of sticky messages
that may be retained by the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> at any one time for a channel,
in order to reduce complexity of retrieval
and processing by the <a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> that rely on them.</p>
<p>(draft 08)</p>
</div>
</div>
<div class="section" id="message-sequences-and-retrieval">
<span id="backplane-12"></span><h2><a class="toc-backref" href="#id80">12.  Message Sequences and Retrieval</a><a class="headerlink" href="#message-sequences-and-retrieval" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#term-backplane-clients"><em class="xref std std-term">Backplane Clients</em></a> may wish to retrieve a subset of all the messages
they have access to,
such as belonging to certain <a class="reference internal" href="#term-buses"><em class="xref std std-term">Buses</em></a> or <em class="xref std std-term">Channels</em>,
having a certain type, source, or other attributes such as sticky.</p>
<p>A <a class="reference internal" href="#term-message-sequence"><em class="xref std std-term">Message Sequence</em></a> is the subset of the entire stream of <a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a>
that match a filter criteria,
in the same order as they have been received by a Backplane server.</p>
<p>The <a class="reference internal" href="#backplane-13-1"><em>token (Access Token Request)</em></a> endpoint is used
to obtain an access token tailored to the filter criteria
desired by the client.
The access token is used at <a class="reference internal" href="#backplane-13-2"><em>the Get Messages (Get Messages)</em></a> endpoint
to retrieve the messages in the current buffer
that belong to the associated <a class="reference internal" href="#term-message-sequence"><em class="xref std std-term">Message Sequence</em></a>.</p>
<p>The <a class="reference internal" href="#term-message-identifier"><em class="xref std std-term">Message Identifier</em></a> of the last <a class="reference internal" href="#term-backplane-message"><em class="xref std std-term">Backplane Message</em></a>
in a retrieved batch of messages is returned as the value of the &#8220;<em class="xref std std-term">since</em>&#8221; query parameter
of the <em class="xref std std-term">nextURL</em> response field,
such that the <em class="xref std std-term">nextURL</em> value will point to the messages that will immediately follow
in the buffer and will not retrieve any of the messages that were already retrieved.</p>
<p>If a <a class="reference internal" href="#term-message-identifier"><em class="xref std std-term">Message Identifier</em></a> points to a message that is no longer in the buffer,
the associated filter criteria is evaluated against the entire current buffer.</p>
<p>(draft 08)</p>
<div class="section" id="access-scopes">
<span id="access-scope"></span><span id="backplane-12-1"></span><span id="id11"></span><h3><a class="toc-backref" href="#id81">12.1.  Access Scopes</a><a class="headerlink" href="#access-scopes" title="Permalink to this headline">¶</a></h3>
<p>The filter criteria for defining a <a class="reference internal" href="#term-message-sequence"><em class="xref std std-term">Message Sequence</em></a> are passed
to the token endpoint when <a class="reference internal" href="#backplane-13-1"><em>requesting access tokens (Access Token Request)</em></a>
as a <strong>space-delimited list</strong> of access scopes in the following format:</p>
<div class="highlight-python"><pre>Access Scope Format:
    &lt;message_field_name&gt;:&lt;message_field_value&gt;</pre>
</div>
<p>where
<strong>message_field_name</strong> is any of the defined message field names (<a class="reference internal" href="#term-backplane-messages"><em class="xref std std-term">Backplane Messages</em></a>),
and <strong>message_field_value</strong> is the expected field&#8217;s value.</p>
<p>An <a class="reference internal" href="#access-scope"><em>access scope</em></a> is evaluated by performing a case-sensitive string comparison
between the expected field&#8217;s value in the access scope,
and the field value from the Backplane Message.</p>
<p>A list of access scopes is evaluated as follows:</p>
<ul class="simple">
<li>a logical OR operation is performed for all access scopes having the same field name</li>
<li>a logical AND operation is performed among all access scopes having different field names</li>
</ul>
<p>Example access scopes: all sticky messages of type &#8220;identity/ack&#8221; posted by &#8220;<a class="reference external" href="http://aboutecho.com">http://aboutecho.com</a>&#8221;
to any channel belonging to the &#8220;customer.com&#8221; bus.</p>
<div class="highlight-python"><pre>bus:customer.com source:http://aboutecho.com type:identity/ack sticky:true</pre>
</div>
<p>Example access scopes: all messages (belonging to bus A OR bus B) AND (having type C OR type D)</p>
<div class="highlight-python"><pre>bus:A bus:B type:C type:D</pre>
</div>
<p>When issuing or verifying the scope of an access token,
<em class="xref std std-term">Backplane Servers</em> MUST enforce that the requester is authorized
with <a class="reference internal" href="#backplane-5-2"><em>Privileged Access (Privileged Access)</em></a> for all &#8220;bus:&#8221; access scopes.</p>
<p>Application scenario protocol extensions MAY define additional authorization requirements
against other scope type and <a class="reference internal" href="#term-backplane-message"><em class="xref std std-term">Backplane Message</em></a> fields.</p>
<p>(draft 08)</p>
</div>
</div>
<div class="section" id="backplane-server-api">
<span id="backplane-13"></span><h2><a class="toc-backref" href="#id82">13.  Backplane Server API</a><a class="headerlink" href="#backplane-server-api" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first"><a class="reference internal" href="#access-token-request"><em>13.1.  Access Token Request</em></a></p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#anonymous-access-token-request"><em>13.1.1.  Anonymous Access Token Request</em></a></li>
<li><a class="reference internal" href="#authenticated-access-token-request"><em>13.1.2.  Authenticated Access Token Request</em></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="#get-messages"><em>13.2.  Get Messages</em></a></p>
</li>
<li><p class="first"><a class="reference internal" href="#get-single-message"><em>13.3.  Get Single Message</em></a></p>
</li>
<li><p class="first"><a class="reference internal" href="#post-messages"><em>13.4.  Post Messages</em></a></p>
</li>
</ul>
</div>
<p>(draft 08)</p>
<div class="section" id="access-token-request">
<span id="backplane-13-1"></span><span id="id12"></span><h3><a class="toc-backref" href="#id83">13.1.  Access Token Request</a><a class="headerlink" href="#access-token-request" title="Permalink to this headline">¶</a></h3>
<p>The OAuth &#8220;<a class="reference internal" href="oauth.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a>&#8221; as defined in section 2.2
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.)
[OAuth2] is used to obtain an access token
to be used for retrieving messages
from the <a class="reference internal" href="#get-messages"><em>Get Messages (Get Messages)</em></a> endpoint.</p>
<blockquote>
<div><dl class="docutils">
<dt>Endpoint</dt>
<dd>/v2/token</dd>
<dt>HTTP mehod</dt>
<dd>POST</dd>
<dt>Security</dt>
<dd>HTTPS</dd>
<dt>Parameters</dt>
<dd><p class="first">The parameters constitute an access token request as defined in either section 4.1.3
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.)
[OAuth2] ( &#8220;code&#8221; grant type)
or section 4.4.2
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.)
[OAuth2] (&#8220;client credentials&#8221; grant type).</p>
<p>The parameters MUST be passed in the request body
using the &#8220;application/x-www-form-urlencoded&#8221; format:</p>
<blockquote class="last">
<div><ul class="simple">
<li>client_id (string, REQUIRED)</li>
<li>client_secret (string, OPTIONAL)</li>
<li>grant_type: MUST be &#8220;client_credentials&#8221; or &#8220;code&#8221;</li>
<li>code (string): REQUIRED if and only if grant_type is &#8220;code&#8221;</li>
<li>redirect_uri (string): REQUIRED if and only if grant_type is &#8220;code&#8221;</li>
<li>scope (string, OPTIONAL): a list of space-delimited filter criteria
(Access Scopes) for the messages the client is interested in.</li>
</ul>
</div></blockquote>
</dd>
<dt>Returns</dt>
<dd><p class="first">On success, a JSON object is returned per section 5.1
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.)
[OAuth2] with the following fields:</p>
<blockquote>
<div><ul class="simple">
<li>token_type: MUST be &#8220;Bearer&#8221; [OAuth2.token.bearer]
(Jones, M., Hardt, D., and D. Recordon, “The OAuth 2.0 Protocol: Bearer Tokens,” Jun 2011.)</li>
<li>access_token: the issued bearer access token</li>
<li>expires_in: the server MUST include the &#8220;expires_in&#8221; parameter if the issued token is set to expire.</li>
<li>backplane_channel (optional): the Channel name, if one was generated as a result of an anonymous request</li>
</ul>
</div></blockquote>
<p class="last">The server MUST NOT include the &#8220;refresh_token&#8221; into the response.</p>
</dd>
</dl>
</div></blockquote>
<p>Response example</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;access_token&quot;</span><span class="o">:</span> <span class="s2">&quot;465203f03680f59b7ddd5e1e5d851461&quot;</span><span class="p">,</span>
  <span class="s2">&quot;token_type&quot;</span><span class="o">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
  <span class="s2">&quot;backplane_channel&quot;</span><span class="o">:</span> <span class="s2">&quot;0a92d76f54f7877a68abe19c5b3ffcf8&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 08)</p>
<div class="section" id="anonymous-access-token-request">
<span id="backplane-13-1-1"></span><span id="id13"></span><h4><a class="toc-backref" href="#id84">13.1.1.  Anonymous Access Token Request</a><a class="headerlink" href="#anonymous-access-token-request" title="Permalink to this headline">¶</a></h4>
<dl class="glossary docutils">
<dt id="term-anonymous-access-tokne-request">anonymous access tokne request</dt>
<dd><ul class="first last simple">
<li>grant_type = client_credentials</li>
<li>client_id =&#8221;anonymous&#8221;</li>
</ul>
</dd>
</dl>
<p>If the &#8220;<a class="reference internal" href="oauth_assertion.html#term-grant-type"><em class="xref std std-term">grant_type</em></a>&#8221; parameter is &#8220;<a class="reference internal" href="glossary.html#term-281"><em class="xref std std-term">client_credentials</em></a>&#8221;
and the &#8220;<a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a>&#8221; parameter is set to &#8220;<strong>anonymous</strong>&#8221;,
the request is an anonymous access token request.
The client MUST omit the &#8220;<a class="reference internal" href="reg.html#term-30"><em class="xref std std-term">client_secret</em></a>&#8221; parameter in this case.
The server MUST ignore the value of the &#8220;<a class="reference internal" href="uma_core.html#term-scope"><em class="xref std std-term">scope</em></a>&#8221; parameter.</p>
<p>In response to a anonymous access token request
the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> allocates a new <a class="reference internal" href="#backplane-9"><em>channel (Channels)</em></a>
and issues a <a class="reference internal" href="#backplane-5-1"><em>regular access token (Regular Access)</em></a>
to the client (no message payloads) for the channel.
New channels are generated only anonymous access token requests.
The channel is not bound to a bus
until the first message is posted to the channel (see <a class="reference internal" href="#backplane-13-4"><em>Post Messages (Post Messages)</em></a>).</p>
<p>Regular access tokens issued in response to anonymous access token requests MUST expire.
It is RECOMMENDED that such tokens expire within <strong>1 hour</strong> after having been issued.</p>
<p>As an operational note,
this API call SHOULD NOT be implemented in a way that makes it capable of blocking
and use of one of the mechanisms in section 7 of RFC 4086
(Eastlake, D., Schiller, J., and S. Crocker, “Randomness Requirements for Security,” June 2005.)
[RFC4086] is RECOMMENDED.</p>
<p>(draft 08)</p>
</div>
<div class="section" id="authenticated-access-token-request">
<span id="backplane-13-1-2"></span><span id="id14"></span><h4><a class="toc-backref" href="#id85">13.1.2.  Authenticated Access Token Request</a><a class="headerlink" href="#authenticated-access-token-request" title="Permalink to this headline">¶</a></h4>
<p>If the &#8220;<a class="reference internal" href="oauth_assertion.html#term-grant-type"><em class="xref std std-term">grant_type</em></a>&#8221; parameter is &#8220;<a class="reference internal" href="standard.html#term-19"><em class="xref std std-term">code</em></a>&#8221; and both &#8220;<a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a>&#8221;
and &#8220;<a class="reference internal" href="reg.html#term-30"><em class="xref std std-term">client_secret</em></a>&#8221; are present,
the server MAY attempt <em class="xref std std-ref">Static Client Registration (Static Client Registration)</em>.</p>
<p>The server MUST check the credentials of the client.
If the credentials are valid, the request is a authenticated access token request;
otherwise the server MUST return error per section 5.2
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.)
[OAuth2] (error &#8220;unautorized_client&#8221;).</p>
<p>The server MUST check that the client making the request is authorized for the requested scopes.
If the client is not authorized for any of the requested scopes the server MUST return error
per section 5.2
(Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.)
[OAuth2] (error &#8220;invalid_scope&#8221;).</p>
<p>In response to a authenticated access token request
the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> issues an <a class="reference internal" href="#backplane-5-2"><em>privileged access token (Privileged Access)</em></a>
to the client for the requested scope.
If no &#8220;<a class="reference internal" href="uma_core.html#term-scope"><em class="xref std std-term">scope</em></a>&#8221; parameter was specified in the request,
the client is granted access to all buses it is authorized to per the server configuration.</p>
<p>(draft 08)</p>
</div>
</div>
<div class="section" id="get-messages">
<span id="backplane-13-2"></span><span id="id15"></span><h3><a class="toc-backref" href="#id86">13.2.  Get Messages</a><a class="headerlink" href="#get-messages" title="Permalink to this headline">¶</a></h3>
<p>Retrieve messages from the server.</p>
<blockquote>
<div><dl class="docutils">
<dt>Endpoint</dt>
<dd>/v2/messages</dd>
<dt>HTTP mehod</dt>
<dd>GET</dd>
<dt>Security</dt>
<dd>HTTPS</dd>
<dt>Authorization</dt>
<dd><p class="first">The client MUST present the access token obtained
from a <a class="reference internal" href="#backplane-13-1"><em>Access Token Request (Access Token Request)</em></a>
as described in section 2.1
(Jones, M., Hardt, D., and D. Recordon, “The OAuth 2.0 Protocol: Bearer Tokens,” Jun 2011.)
[OAuth2.token.bearer].</p>
<p class="last">The server MUST retrieve the <a class="reference internal" href="#backplane-12-1"><em>Access Scopes (Access Scopes)</em></a>
associated with the presented access token,
determine the <a class="reference internal" href="#backplane-12"><em>Message Sequence (Message Sequences and Retrieval)</em></a> filter
and <a class="reference internal" href="#backplane-5"><em>access level (Access Levels)</em></a>,
and respond accordingly.</p>
</dd>
</dl>
<p>Parameters</p>
<blockquote>
<div><ul class="simple">
<li>block (integer, default 0):
if no messages are available for immediate retrieval,
this parameter communicates how long (in seconds)
the server should wait before returning an empty response</li>
<li>callback (string, optional):
callback function to pad the response with (see <a class="reference internal" href="#backplane-7"><em>Padded Responses (Padded Responses)</em></a>);
MUST only contain alphanumeric characters (a-zA-Z0-9)</li>
<li>since (optional, string):
the <a class="reference internal" href="#term-message-identifier"><em class="xref std std-term">Message Identifier</em></a> representing the starting point of
the requested Message Sequence.
See Message Sequences and Retrieval (<a class="reference internal" href="#backplane-12"><em>Message Sequences and Retrieval</em></a>).</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Returns</dt>
<dd><p class="first">On success, a JSON object is returned with the following fields:</p>
<blockquote>
<div><ul class="simple">
<li>nextURL (string):
a complete URL pointing to the Get Messages endpoint
that the client can invoke to retrieve subsequent messages from the server.
The URL MUST contain a <a class="reference internal" href="#term-message-identifier"><em class="xref std std-term">Message Identifier</em></a> in the since query parameter.</li>
<li>messages[]:
an array of messages in the order they were originally received by the server.
Each message within the array is represented as a JSON object of the same structure
as returned by the <a class="reference internal" href="#backplane-13-3"><em>Get Single Message (Get Single Message)</em></a> API method.</li>
</ul>
</div></blockquote>
<p class="last">Response example</p>
</dd>
</dl>
</div></blockquote>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;nextURL&quot;</span><span class="o">:</span> <span class="s2">&quot;https://bp.example.com/v2/messages?since=958bfa2dd8aed82c86afbd54b4a314a5&quot;</span><span class="p">,</span>
  <span class="s2">&quot;messages&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;bus&quot;</span><span class="o">:</span> <span class="s2">&quot;customer.com&quot;</span><span class="p">,</span>
      <span class="s2">&quot;channel&quot;</span><span class="o">:</span> <span class="s2">&quot;67dc880cc265b0dbc755ea959b257118&quot;</span><span class="p">,</span>
      <span class="s2">&quot;messageURL&quot;</span><span class="o">:</span> <span class="s2">&quot;https://bp.example.com/v2/message/097a5cc401001f95b45d37aca32a3bd2&quot;</span><span class="p">,</span>
      <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="o">:</span> <span class="s2">&quot;administrator&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;http://aboutecho.com&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;identity/ack&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 08)</p>
</div>
<div class="section" id="get-single-message">
<span id="backplane-13-3"></span><span id="id16"></span><h3><a class="toc-backref" href="#id87">13.3.  Get Single Message</a><a class="headerlink" href="#get-single-message" title="Permalink to this headline">¶</a></h3>
<p>Retrieve a single message from the server.</p>
<blockquote>
<div><dl class="docutils">
<dt>Endpoint</dt>
<dd>/v2/message/&lt;msg_id&gt;: The full endpoint URL constitutes the messageURL obtained from a Get Messages (Get Messages) response.</dd>
<dt>HTTP mehod</dt>
<dd>GET</dd>
<dt>Security</dt>
<dd>HTTPS</dd>
<dt>Authorization</dt>
<dd>The client MUST present the access token obtained from a Access Token Request (Access Token Request) as described in section 2.1 (Jones, M., Hardt, D., and D. Recordon, “The OAuth 2.0 Protocol: Bearer Tokens,” Jun 2011.) [OAuth2.token.bearer], to prove that it has access to the message. The server MUST retrieve the Access Scopes (Access Scopes) associated with the presented access token, determine its access level (Access Levels) and respond accordingly with either a Backplane Header, a Backplane Message (including payload), or error.</dd>
</dl>
<p>Query parameter</p>
<blockquote>
<div>callback (string, optional): callback function to pad the response with (see Padded Responses (Padded Responses)); MUST only contain alphanumeric characters (a-zA-Z0-9)</div></blockquote>
<p>Returns</p>
<blockquote>
<div><ul>
<li><p class="first">HTTP status code 404 (&#8220;Not Found&#8221;)
if the message is no longer available.</p>
</li>
<li><p class="first">HTTP status code 403 (&#8220;Forbidden&#8221;)
if the client is not authorized to retrieve messages
from the Bus the message belongs to.</p>
</li>
<li><p class="first">On success,
a HTTP status code 200 (&#8220;OK&#8221;) is returned,
with the response body containing a Backplane Message JSON object, with the following fields:</p>
<blockquote>
<div><ul class="simple">
<li>messageURL (string): the URL of the message, see Get Single Message (Get Single Message)</li>
<li>source (string): an arbitrary URL identifying the client which has posted the message.</li>
<li>type (string): message type (arbitrary string).</li>
<li>bus (string): the bus name the message was posted to</li>
<li>channel (string): the channel name the message was posted do.</li>
<li>payload (object, optional): message payload. Only available to privileged access clients.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div></blockquote>
<p>Response example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;messageURL&quot;</span><span class="o">:</span> <span class="s2">&quot;https://bp.example.com/v2/message/097a5cc401001f95b45d37aca32a3bd2&quot;</span><span class="p">,</span>
  <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;http://aboutecho.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;identity/ack&quot;</span>
  <span class="s2">&quot;bus&quot;</span><span class="o">:</span> <span class="s2">&quot;customer.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;channel&quot;</span><span class="o">:</span> <span class="s2">&quot;67dc880cc265b0dbc755ea959b257118&quot;</span><span class="p">,</span>
  <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;role&quot;</span><span class="o">:</span> <span class="s2">&quot;administrator&quot;</span>
  <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 08)</p>
</div>
<div class="section" id="post-messages">
<span id="backplane-13-4"></span><span id="id17"></span><h3><a class="toc-backref" href="#id88">13.4.  Post Messages</a><a class="headerlink" href="#post-messages" title="Permalink to this headline">¶</a></h3>
<p>Publish messages to the Backplane.</p>
<blockquote>
<div><dl class="docutils">
<dt>Endpoint</dt>
<dd>/v2/messages</dd>
<dt>HTTP mehod</dt>
<dd>POST</dd>
<dt>Security</dt>
<dd>HTTPS</dd>
<dt>Authorization</dt>
<dd><p class="first">The client MUST present the access token
obtained from a Access Token Request (Access Token Request)
as described in section 2.1
(Jones, M., Hardt, D., and D. Recordon, “The OAuth 2.0 Protocol: Bearer Tokens,” Jun 2011.)
[OAuth2.token.bearer].</p>
<p class="last">The server MUST retrieve the Access Scopes (Access Scopes)
associated with the presented access token
and determine that it has Privileged Access Level (Privileged Access)
for each of the Buses referenced in the request body.</p>
</dd>
<dt>Request body</dt>
<dd><p class="first">The body of the request is a JSON object of the following structure:</p>
<blockquote class="last">
<div><ul>
<li><p class="first">messages[]: an array of messages to be posted, represented as JSON objects of the following structure:</p>
<blockquote>
<div><ul class="simple">
<li>source (string): an arbitrary URL identifying the client which has posted the message</li>
<li>type (string): message type (arbitrary string)</li>
<li>bus (string): the name of the bus to post the message to</li>
<li>channel (string): the name of the channel to post the message to</li>
<li>payload (object): the message payload</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</dd>
</dl>
<p>Returns</p>
<blockquote>
<div><ul class="simple">
<li>HTTP status code 201 (&#8220;Created&#8221;) upon success.</li>
<li>HTTP status code 403 (&#8220;Forbidden&#8221;)
if the client is not authorized to post messages
to any of the referenced Buses.
The server processes the messages in the request one by one;
if a message can&#8217;t be posted for any reason,
the whole request fails and none of the messages get posted.</li>
</ul>
</div></blockquote>
</div></blockquote>
<p>The server MUST check that the <a class="reference internal" href="#term-42"><em class="xref std std-term">channel</em></a> in a message was previously allocated
as a result of a <a class="reference internal" href="#backplane-13-1"><em>Access Token Request (Access Token Request)</em></a>.</p>
<p>If the channel is not yet bound to a <a class="reference internal" href="#term-41"><em class="xref std std-term">bus</em></a>,
the server MUST bind it to the <a class="reference internal" href="#term-41"><em class="xref std std-term">bus</em></a> specified
in the same message object from the request.</p>
<p>If the channel is already bound to a different <a class="reference internal" href="#term-41"><em class="xref std std-term">bus</em></a>
than the one specified in the same message object in the request,
the entire request is considered invalid and is aborted.</p>
<p>Request example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;messages&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;http://aboutecho.com&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;identity/ack&quot;</span>
      <span class="s2">&quot;bus&quot;</span><span class="o">:</span> <span class="s2">&quot;customer.com&quot;</span><span class="p">,</span>
      <span class="s2">&quot;channel&quot;</span><span class="o">:</span> <span class="s2">&quot;67dc880cc265b0dbc755ea959b257118&quot;</span><span class="p">,</span>
      <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="o">:</span> <span class="s2">&quot;administrator&quot;</span>
      <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;http://aboutecho.com&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;identity/ack&quot;</span>
      <span class="s2">&quot;bus&quot;</span><span class="o">:</span> <span class="s2">&quot;organization.org&quot;</span><span class="p">,</span>
      <span class="s2">&quot;channel&quot;</span><span class="o">:</span> <span class="s2">&quot;d7a592b31fbbc2baf5f9476884b9acd5&quot;</span><span class="p">,</span>
      <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="o">:</span> <span class="s2">&quot;moderator&quot;</span>
      <span class="p">},</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 08)</p>
</div>
</div>
<div class="section" id="backplane-javascript-api">
<span id="backplane-14"></span><span id="id18"></span><h2><a class="toc-backref" href="#id89">14.  Backplane JavaScript API</a><a class="headerlink" href="#backplane-javascript-api" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><em class="xref std std-ref">Backplane.init</em></li>
<li><em class="xref std std-ref">Backplane.subscribe</em></li>
<li><em class="xref std std-term">Backplane.unsubscribe</em></li>
<li>Backplane.getChannelID</li>
<li>Backplane.expectMessagesWithin</li>
</ul>
</div>
<p>A <a class="reference internal" href="#term-backplane-javascript-library"><em class="xref std std-term">Backplane JavaScript Library</em></a> runs in an end user&#8217;s browser
and mediates communication between Backplane-enabled <a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a>
on the page and the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.</p>
<p>Only one instance of the <a class="reference internal" href="#term-backplane-javascript-library"><em class="xref std std-term">Backplane JavaScript Library</em></a>
on a given page is possible.
The library has to be the first to load on the page
to make it possible for other scripts to use its subscription functionality.</p>
<p>The Backplane JavaScript Library provides the following API (all methods are static):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Initializes the backplane library</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Object} Params - hash with configuration parameters.</span>
<span class="cm"> *   Possible hash keys:</span>
<span class="cm"> *     serverBaseURL (required) - Base URL of Backplane Server</span>
<span class="cm"> *     busName (required) - Customer&#39;s backplane bus name</span>
<span class="cm"> */</span>
<span class="nx">Backplane</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Params</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Subscribes to messages from Backplane server</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Function} Callback - Callback function which accepts backplane messages.</span>
<span class="cm"> * @returns Subscription ID which can be used later for unsubscribing.</span>
<span class="cm"> */</span>
<span class="nx">Backplane</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">Callback</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Removes specified subscription</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Integer} Subscription ID</span>
<span class="cm"> */</span>
<span class="nx">Backplane</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="nx">SubscriptionID</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Returns channel ID (like http://backplane.customer.com/v2/bus/customer.com/channel/8ec92f459fa70b0da1a40e8fe70a0bc8)</span>
<span class="cm"> *</span>
<span class="cm"> * @returns Backplane channel ID</span>
<span class="cm"> */</span>
<span class="nx">Backplane</span><span class="p">.</span><span class="nx">getChannelID</span><span class="p">();</span>

<span class="cm">/**</span>
<span class="cm"> * Notifies backplane library about the fact that subscribers are going</span>
<span class="cm"> * to receive backplane messages within specified time interval.</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Integer} TimeInterval - Time interval in seconds</span>
<span class="cm"> * @param {Array} MessageTypes (optional) - a list of expected message types</span>
<span class="cm"> */</span>
<span class="nx">Backplane</span><span class="p">.</span><span class="nx">expectMessagesWithin</span><span class="p">(</span><span class="nx">TimeInterval</span><span class="p">,</span> <span class="nx">MessageTypes</span><span class="p">);</span>
</pre></div>
</div>
<p>(draft 08)</p>
<div class="section" id="initialization">
<span id="backplane-init"></span><span id="backplane-14-1"></span><h3><a class="toc-backref" href="#id90">14.1.  Initialization</a><a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<p>Backplane is initialized using the <strong>Backplane.init</strong> method.</p>
<p>During initialization the library generates a random <em class="xref std std-term">Channel Name</em>
unless information about one for the specified bus name already exists
in the <strong>backplane-channel</strong> cookie.
Since client-side generation of the channel name is non-secure,
the library performs a request to obtain a channel name from the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a>.</p>
<p>There can be at most one <a class="reference internal" href="#term-42"><em class="xref std std-term">channel</em></a> active on a <a class="reference internal" href="#term-web-page"><em class="xref std std-term">Web Page</em></a> at a given time.</p>
<p>After initialization the library stores the current <em class="xref std std-term">Channel Name</em>
in the <strong>backplane-channel</strong> cookie set
against the complete domain name of currently opened page.
The cookie is set for 5 years in advance
and keeps information about association of <em class="xref std std-term">Bus names</em> to <em class="xref std std-term">Channel Names</em>
(to support possibility to use the library with several different Bus names on the same domain).
The information about the association is stored in a serialized form.</p>
<p>Here is an example of cookie that stores association of Bus names example.com and example.org to the corresponding channel names 123 and 456:</p>
<div class="highlight-python"><pre>backplane-channel=example.com:123|example.org:456</pre>
</div>
<p>After the <em class="xref std std-term">channel ID</em> has been determined,
the library performs a first reading of messages from a channel,
discards all of them (remembering only the identifier of the very last one)
and starts polling the <a class="reference internal" href="#term-32"><em class="xref std std-term">Backplane Server</em></a> for new messages
since the latest <a class="reference internal" href="#term-backplane-message"><em class="xref std std-term">Backplane Message</em></a>.
This way the library is guaranteed to push to subscribers only those Backplane Messages
which arrived after the library had been fully initialized.</p>
<p>(draft 08)</p>
</div>
<div class="section" id="subscription-management">
<span id="id19"></span><h3><a class="toc-backref" href="#id91">14.2.  Subscription Management</a><a class="headerlink" href="#subscription-management" title="Permalink to this headline">¶</a></h3>
<p>The library provides a method for Widgets to set up notification callbacks: <strong>Backplane.subscribe</strong>.
The method returns a subscription id which can be later used for unsubscribing
using the <strong>Backplane.unsubscribe</strong> method.</p>
<p>After the initialization the library
starts polling the Backplane Server for new events.
All incoming events are delivered to the <a class="reference internal" href="#term-widgets"><em class="xref std std-term">Widgets</em></a> that have registered callbacks with the library.</p>
<p>(draft 08)</p>
</div>
<div class="section" id="hints">
<span id="backplane-14-3"></span><h3><a class="toc-backref" href="#id92">14.3.  Hints</a><a class="headerlink" href="#hints" title="Permalink to this headline">¶</a></h3>
<p>For performance reasons the Backplane JavaScript Library polls the Backplane Server with a low frequency (e.g once a minute). Since Backplane events usually are initiated on the client side (e.g. the user clicking a button), Widgets on the page are in a position to hint the library that a Backplane message may be soon delivered. Upon the receipt of such hint (via expectMessagesWithin method), the library temporarily increases the polling frequency (e.g. to once a second) and then gradually decreases it to the default low value one.</p>
<p>The expectMessagesWithin method can accept an optional list of expected message types.</p>
<blockquote>
<div><p>If the library accepts any message from the passed message types list,
it gradually returns to the lower polling frequency mode;</p>
<p>If messages with only one type are expected,
the second argument may be specified as a string;</p>
<p>Each call of the method adds passed message types to the list of expected message types.
In other words,
if a user calls the method with a message type &#8220;type1&#8221;
and then performs one more call with a message type &#8220;type2&#8221;,
the library will run in the fast polling mode
until it received messages of all the types or
until the libray reached the maximum allotted waiting time interval.</p>
</div></blockquote>
<p>(draft 08)</p>
</div>
<div class="section" id="usage-example">
<span id="backplane-14-4"></span><h3><a class="toc-backref" href="#id93">14.4.  Usage Example</a><a class="headerlink" href="#usage-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">Backplane</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
    <span class="nx">serverBaseURL</span><span class="o">:</span> <span class="s2">&quot;http://backplane.customer.com/v2&quot;</span><span class="p">,</span>
    <span class="nx">busName</span><span class="o">:</span> <span class="s2">&quot;customer.com&quot;</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">escSubscription</span> <span class="o">=</span> <span class="nx">Backplane</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">backplaneMessage</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nx">backplaneMessage</span><span class="p">.</span><span class="nx">payload</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// We can ask the library to perform more frequent polling</span>
<span class="c1">// if a widget, for example, expects a message from Backplane pretty soon</span>
<span class="c1">// using the expectMessagesWithin method which accepts</span>
<span class="c1">// time interval of possible message arrival in seconds</span>
<span class="nx">Backplane</span><span class="p">.</span><span class="nx">expectMessagesWithin</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// The method can accept an option list with expected message types.</span>
<span class="c1">// The library stops fast polling when it receives a message of</span>
<span class="c1">// either type.</span>
<span class="nx">Backplane</span><span class="p">.</span><span class="nx">expectMessagesWithin</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;type1&quot;</span><span class="p">,</span> <span class="s2">&quot;type2&quot;</span><span class="p">]);</span>

<span class="c1">// Subsequent calls extend the list of expected message types.</span>
<span class="c1">// The library stops fast polling only after it has received</span>
<span class="c1">// a message of type1 or type2 AND a message of type3 or type4.</span>
<span class="nx">Backplane</span><span class="p">.</span><span class="nx">expectMessagesWithin</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;type3&quot;</span><span class="p">,</span> <span class="s2">&quot;type4&quot;</span><span class="p">]);</span>

<span class="nx">Backplane</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="nx">escSubscription</span><span class="p">);</span>

<span class="c1">// If a widget needs Backplane channel ID it can get it using the</span>
<span class="c1">// getChannelID method</span>
<span class="nx">Backplane</span><span class="p">.</span><span class="nx">getChannelID</span><span class="p">();</span>
</pre></div>
</div>
<p>(draft 08)</p>
</div>
</div>
<div class="section" id="security-considerations">
<span id="backplane-15"></span><h2><a class="toc-backref" href="#id94">15.  Security Considerations</a><a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="#backplane-4"><em>Trust (Trust)</em></a>.</p>
<p>(draft 08)</p>
<div class="section" id="channel-name-sensitivity">
<span id="backplane-15-1"></span><h3><a class="toc-backref" href="#id95">15.1.  Channel Name Sensitivity</a><a class="headerlink" href="#channel-name-sensitivity" title="Permalink to this headline">¶</a></h3>
<p>The Channel Name acts as a session identifier shared among a group of trusted parties. Knowledge of a Channel Name offers Regular Access level to Backplane Server API.</p>
<p>It is therefore important that the Channel Name is not compromised, by either:</p>
<blockquote>
<div><ul class="simple">
<li>Trusting any third-party JavaScript source included in the Web Page without due verification, or</li>
<li>Disclosing Channel Names to untrusted parties.</li>
</ul>
</div></blockquote>
<p>(draft 08)</p>
</div>
<div class="section" id="message-payloads">
<span id="backplane-15-2"></span><h3><a class="toc-backref" href="#id96">15.2.  Message Payloads</a><a class="headerlink" href="#message-payloads" title="Permalink to this headline">¶</a></h3>
<p>Message payloads are only sent to Backplane Clients
at <a class="reference internal" href="#backplane-5-2"><em>Privileged Access Level (Privileged Access)</em></a>.
This is in order to allow sensitive data to be exchanged
among server-side Backplane Clients,
while not allowing it to reach the less secure context of web browser.</p>
<p>It is therefore important that <a class="reference internal" href="#backplane-5-2"><em>Privileged Access Level (Privileged Access)</em></a>
credentials are not provisioned to Backplane Clients that run in a web browser</p>
<p>(draft 08)</p>
</div>
</div>
<div class="section" id="normative-references">
<span id="backplane-16"></span><h2><a class="toc-backref" href="#id97">16. Normative References</a><a class="headerlink" href="#normative-references" title="Permalink to this headline">¶</a></h2>
<dl class="glossary docutils">
<dt id="term-oauth-dynamic-client-registration">[OAuth.Dynamic.Client.Registration]</dt>
<dd>Hardjono, T., Machulak, M., Maler, E., and C. Scholz, “OAuth Dynamic Client Registration Protocol,” Oct 2011.</dd>
<dt id="term-47">[OAuth2]</dt>
<dd>Habber-Lahav, E., Recordon, D., and D. Hardt, “The OAuth 2.0 Authorization Protocol,” May 2011.</dd>
<dt id="term-oauth2-token-bearer">[OAuth2.token.bearer]</dt>
<dd>Jones, M., Hardt, D., and D. Recordon, “The OAuth 2.0 Protocol: Bearer Tokens,” Jun 2011.</dd>
<dt id="term-rfc2119">[RFC2119]</dt>
<dd>Bradner, S., “Key words for use in RFCs to Indicate Requirement Levels,” BCP 14, RFC 2119, March 1997 (TXT, HTML, XML).</dd>
<dt id="term-rfc2616">[RFC2616]</dt>
<dd>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, “Hypertext Transfer Protocol &#8211; HTTP/1.1,” RFC 2616, June 1999 (TXT, PS, PDF, HTML, XML).</dd>
<dt id="term-rfc2617">[RFC2617]</dt>
<dd>Franks, J., Hallam-Baker, P., Hostetler, J., Lawrence, S., Leach, P., Luotonen, A., and L. Stewart, “HTTP Authentication: Basic and Digest Access Authentication,” RFC 2617, June 1999 (TXT, HTML, XML).</dd>
<dt id="term-rfc4086">[RFC4086]</dt>
<dd>Eastlake, D., Schiller, J., and S. Crocker, “Randomness Requirements for Security,” BCP 106, RFC 4086, June 2005 (TXT).</dd>
<dt id="term-rfc4627">[RFC4627]</dt>
<dd>Crockford, D., “The application/json Media Type for JavaScript Object Notation (JSON),” RFC 4627, July 2006 (TXT).</dd>
<dt id="term-rfc4648-section5">[RFC4648.section5]</dt>
<dd>Josefsson, S., “The Base16, Base32, and Base64 Data Encodings,” October 2006.</dd>
</dl>
<p>(draft 08)</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="jwe_js.html">JSON Web Encryption JSON Serialization (JWE-JS)</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="webfinger.html">WebFinger</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>