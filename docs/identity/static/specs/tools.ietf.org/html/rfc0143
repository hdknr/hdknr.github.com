<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.101" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Identifier" content="urn:ietf:rfc:143" />
<meta name="DC.Creator" content="Wong, J." />
<meta name="DC.Creator" content="Postel, J." />
<meta name="DC.Creator" content="Kline, C." />
<meta name="DC.Creator" content="Naylor, W." />
<meta name="DC.Date.Issued" content="May, 1971" />
<meta name="DC.Title" content="Regarding proffered official ICP" />

    <link rel="icon" href="/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="/images/rfc.png" type="image/png" />
    <title>RFC 143 - Regarding proffered official ICP</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>          <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>            <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>    <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>     <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td><td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td><td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard:</td>   <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>         <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>         <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgbrown"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="../html/" title="Document search and retrieval page">Docs</a>] [<a href="/rfc/rfc143.txt" title="Plaintext version of this document">txt</a>|<a href="/pdf/rfc143" title="PDF version of this document">pdf</a>]                                                        </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">Obsoleted by: <a href="./rfc165">165</a>                                                      </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Network Working Group                                         W. Naylor
Request for Comments #143                                     J. Wong
NIC #6728                                                     C. Kline
Categories:  D.1, D.3                                         J. Postel
Obsoletes:  None                                              UCLA - NMC
Updates:  <a href="./rfc123">123</a>, <a href="./rfc145">145</a>                                            3 May 1971

                    <span class="h1">Regarding Proferred Official ICP</span>

We should like to comment on a race condition discovered in the ICP as
proposed in NWG/RFC #123.  The problem arises when the server attempts
to initiate a second connection to the user's receive socket and the
first connection is not yet closed.  Using a similar notation to that of
NWG/RFC #123 the following table illustrates the sequence of events in
the proferred and proposed ICP.  The last two columns indicate which
actions must be completed before the current action may be initiated.
User and Server are third level programs, and UNCP and SNCP are the
users NCP and Servers NCP respectively.  Allocates have not been
included since they add nothing to the argument.

                                               Required Predecessors
                                               ---------------------
Reference #   Action              Initiator   "Proferred"   Proposed
-----------   ------              ---------   -----------   --------
    1         Listen(L,32)        Server           --          --

    2         Init(U,L,32)        User             --          --

    3         RTS(U,L,'l')        UNCP             2           2

    4         STR(L,U,32)         SNCP          1 and 3     1 and 3

    5         Send(L,S)           Server           4           4

    6         SEND('l',S)         SNCP             5           5

    7         RECEIVE('l',S)      UNCP             6           6

    8         Receive(U,S)        User             7           7

    9         Close(L)            Server           5           5

   10         CLS(L,U)            SNCP          9 and 7     9 and 7

   11         Close(U)            User             8        not used

   12         CLS(U,L)            UNCP            11          10




<span class="grey">                                                                [Page 1]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey">NWG                 Regarding Proferred Official ICP             <a href="./rfc143">RFC 143</a></span>


                                               Required Predecessors
                                               ---------------------
Reference #   Action              Initiator   "Proferred"   Proposed
-----------   ------              ---------   -----------   --------

   13         Init(S,U+1,B )      Server           9           9
                          u

   14         RTS(S,U+1,'l' )     SNCP            13          13
                           2

   15         Init(S+1,U,B )      Server          13        14 and 18
                          s

   16         STR(S+1,U,B )       SNCP            15          15
                         s

   17         Init(U+1,S,B )      User            11          12
                          u

   18         STR(U+1,S,B )       UNCP            17          17
                         u

   19         Init(U,S+1,B )      User            17          17
                          s

   20         RTS(U,S+1,'l' )     UNCP            19          19
                           3

Note that in the Proferred Order column, 16 can occur before 12 in which
case UNCP would find socket U in use and probably return a CLS (U,S+1).
The Server would probably then assume the User was finished with the
conversation.

The above problem is resolved by eliminating the Close from one side and
causing that side to wait for the CLS from the other side before doing
an Init.  We propose that eliminating the user's Close (U) is the best
solution.  (The user NCP must of course return a CLS in response to the
CLS sent by the server NCP).

The Server's Close (L) leads more quickly to the reuse of socket L thus
the serving of another user.









<span class="grey">                                                                [Page 2]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey">NWG                 Regarding Proferred Official ICP             <a href="./rfc143">RFC 143</a></span>


To clarify the above discussion which may seem confusing at first
glance, let us demonstrate the problem in the language of RFC #123.

          Server                              User
          ------                              ----
     (S1) Listen(L,32)                   (U1) Init(U,L,32)

     (S2) [Wait for match]               (U2)

     (S3) Send(L,S)                      (U3) Receive(U,S)

     (S4) Close(L)                       (U4) Close(U)

     (S5) Init(S,U+1,B )                 (U5) Init(U+1,S,B )
                      u                                   u

     (S6) Init(S+1,U,B )                 (U6) Init(U,S+1,B )
                      s                                   s

Notice that since server and user are independent (probably in different
hosts), server could execute (S6) before user executes (U4) and could
receive an error back from user's NCP that socket U is busy.  Similarly,
user could execute (U6) before server executes (S4) and could receive an
error back from his own NCP that socket U is not yet closed (assuming an
implementation where sockets are kept busy until a CLS match).

Various modifications could be made to ICP to solve this problem.  We
propose the following ICP:























<span class="grey">                                                                [Page 3]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey">NWG                 Regarding Proferred Official ICP             <a href="./rfc143">RFC 143</a></span>


          Server                              User
          ------                              ----
          Listen(L,32)                        Init(U,L,32)

          [Wait for match]

          Send(L,S)                           Receive(U,S)

          Close(L)                            [Wait for CLS]

          Init(S,U+1,B )                      Init(U+1,S,B )
                      u                                   u

          [Wait for match]                    Init(U,S+1,B )
                                                          s

          Init(S+1,U,B )
                      s

This ICP assumes the following:

<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  The user can inquire or is notified of the fact that one of his</span>
    connections has been closed.

<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  The server can inquire or is notified that a connection for which</span>
    he has done an Init (or Listen) is now open.

Both of the above seem basic to any NCP - user interface.

This race condition problem would not exist had the dynamic reconnection
features of RFC #36 been included in the NCP protocol and had dynamic
reconnection been used in this ICP.


       [ This RFC was put into machine readable form for entry ]
        [ into the online RFC archives by Walter Pienciak 1/98 ]















                                                                [Page 4]

</pre><br />
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.101, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>
</body></html>
