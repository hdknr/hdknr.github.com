<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.101" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Identifier" content="urn:ietf:id:manger-jose-jwsec" />
<meta name="DC.Description.Abstract" content="This document describes a cryptographic message format based on" />
<meta name="DC.Creator" content="James Manger &lt;james@manger.com.au&gt;" />
<meta name="DC.Date.Issued" content="2012-06-11" />
<meta name="DC.Title" content="JSON Web Security Message Format" />

    <link rel="icon" href="/images/id.png" type="image/png" />
    <link rel="shortcut icon" href="/images/id.png" type="image/png" />
    <title>draft-manger-jose-jwsec-00 - JSON Web Security Message Format</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>          <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>            <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>    <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>     <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td><td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td><td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard:</td>   <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>         <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>         <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgred"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="../html/" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/id/draft-manger-jose-jwsec-00.txt" title="Plaintext version of this document">txt</a>|<a href="/pdf/draft-manger-jose-jwsec-00.txt" title="PDF version of this document">pdf</a>|<a href="/id/draft-manger-jose-jwsec-00.xml" title="XML source for this document">xml</a>|<a href="/id/draft-manger-jose-jwsec-00.html" title="HTML version of this document, from XML2RFC">html</a>] [<a href='https://datatracker.ietf.org/doc/draft-manger-jose-jwsec' title='IESG Datatracker information for this document'>Tracker</a>] [<a href="mailto:draft-manger-jose-jwsec@tools.ietf.org?subject=draft-manger-jose-jwsec%20" title="Send email to the document authors">Email</a>] [<a href="/idnits?url=http://tools.ietf.org/id/draft-manger-jose-jwsec-00.txt" title="Run an idnits check of this document">Nits</a>]                      </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">Versions: <a href="./draft-manger-jose-jwsec-00">00</a>                                                            </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Network Working Group                                          J. Manger
Internet-Draft                                                   Telstra
Intended status:  Standards Track                          June 11, 2012
Expires:  December 13, 2012


                    <span class="h1">JSON Web Security Message Format</span>
                     <span class="h1">draft-manger-jose-jwsec-00.txt</span>

Abstract

   This document describes a cryptographic message format based on
   JavaScript Object Notation (JSON) and base-64 encodings to be easy
   for web applications to generate and process.  Signed, encrypted,
   signed-then-encrypted, and unprotected messages are supported using
   symmetric and/or asymmetric keys.

   Please discuss this document on the jose@ietf.org mailing list.

Status of this Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of <a href="./bcp78">BCP 78</a> and <a href="./bcp79">BCP 79</a>.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on December 13, 2012.

Copyright Notice

   Copyright (c) 2012 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="./bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in <a href="#section-4">Section 4</a>.e of



<span class="grey">Manger                  Expires December 13, 2012               [Page 1]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.


Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Conventions Used In This Document  . . . . . . . . . . . .  <a href="#page-4">4</a>
     <a href="#section-1.2">1.2</a>.  Examples . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  Model  . . . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
   <a href="#section-3">3</a>.  Syntax . . . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
   <a href="#section-4">4</a>.  Unprotected message (mode U) . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-5">5</a>.  Signed message (mode S)  . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-6">6</a>.  Encrypted message (mode E) . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
     <a href="#section-6.1">6.1</a>.  Key transport  . . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-6.2">6.2</a>.  Key agreement  . . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-6.3">6.3</a>.  Symmetric key wrapping . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
   <a href="#section-7">7</a>.  Header elements  . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
   <a href="#section-8">8</a>.  IANA considerations  . . . . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
     <a href="#section-8.1">8.1</a>.  JWsec Header Element Registry  . . . . . . . . . . . . . . <a href="#page-11">11</a>
     <a href="#section-8.2">8.2</a>.  Media type . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
   <a href="#section-9">9</a>.  Security considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
   <a href="#section-10">10</a>. Normative References . . . . . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
   <a href="#appendix-A">Appendix A</a>.  Acknowledgments . . . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
   Author's Address . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>














<span class="grey">Manger                  Expires December 13, 2012               [Page 2]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

      [[ This document presents the author's ideas for improving the
      JWS/JWE/JWT drafts -- formulated as a complete spec.  This
      document copies lots of text from <a href="./draft-rescorla-jsms-00">draft-rescorla-jsms-00</a>,
      <a href="./draft-ietf-jose-json-web-signature-01">draft-ietf-jose-json-web-signature-01</a>,
      <a href="./draft-ietf-jose-json-web-encryption">draft-ietf-jose-json-web-encryption</a>, and (parts of)
      <a href="./draft-ietf-oauth-json-web-token-00">draft-ietf-oauth-json-web-token-00</a>. ]]

   Many applications require the ability to send cryptographically
   secured messages (encrypted, digitally signed, etc.).  While the IETF
   has defined a number of formats for such messages -- such as
   Cryptographic Message Syntax (CMS) [<a href="./rfc5652" title="&quot;Cryptographic Message Syntax (CMS)&quot;">RFC5652</a>] -- those formats are
   widely viewed as being excessively complicated for the demands of
   many web applications, which typically only need the ability to
   secure simple messages.  In addition, existing formats use encoding
   mechanisms that are not congenial for web applications, such as
   Abstract Syntax Notation (ASN.1) Distinguished Encoding Rules (DER).
   This presents an obstacle to the deployment of strong security by
   such applications.

   This document describes a new cryptographic message format, nicknamed
   JWsec, intended to meet the needs of the web environment.  JWsec uses
   JavaScript Object Notation (JSON) [<a href="./rfc4627" title="&quot;The application/json Media Type for JavaScript Object Notation (JSON)&quot;">RFC4627</a>] and base64url encodings
   (without padding) <a href="./rfc4648#section-5">[RFC4648] section&nbsp;5</a>.  JWsec is loosly modelled on
   some of the basic functionality of CMS, but omits many CMS modes in
   the interests of simplicity.

   A JWsec message can protect any array of bytes, though it is more
   suited to protecting kilobytes than gigabytes.  A JWsec message can
   provide data origin authenticity and/or confidentiality for the data.
   It can compress the data.  A JWsec message can also carry the data
   with no cryptographic protection, which enables protocols to specify
   JWsec for fields that do not require security in all circumstances.

   After providing some example JWsec messages, this document describes
   the processing model, the message syntax, and then three modes of
   protection:  unprotected; signed; and encrypted.  The JSON elements
   that can appear in a JWsec message header are summarized in <a href="#section-7">section</a>
   <a href="#section-7">7</a>.

   An initial set of algorithms that a JWsec message can use for
   signing, encrypting, and compressing are specified separately in JSON
   Web Security Message Algorithms [<a href="#ref-ALGS" title="&quot;JSON Web Security Message Algorithms (similar to draft-ietf-jose-json-web-algorithms)&quot;">ALGS</a>].  That document also
   establishes a registry for listing further algorithms.






<span class="grey">Manger                  Expires December 13, 2012               [Page 3]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


<span class="h3"><a class="selflink" name="section-1.1" href="#section-1.1">1.1</a>.  Conventions Used In This Document</span>

   The key words "MUST", "MUST NOT", "SHOULD", "SHOULD NOT", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   [<a href="./rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].

   Requirements are specified for originators who create JWsec messages
   and recipients who receive them.  Requirements stated for messages
   apply to originators who create them.

   Long base64url encodings are wrapped over multiple lines only for
   display purposes.  The real values do not include line breaks.

<span class="h3"><a class="selflink" name="section-1.2" href="#section-1.2">1.2</a>.  Examples</span>

   This simple JWsec message consists of 3 dot-separated components:

   U.e30.SGVsbG8sIFdvcmxkIQ

   The initial letter "U" indicated that this is an unprotected JWsec
   message.  The other components are base64url encodings (without
   padding).  The second component decodes to a JSON object (the
   header), in this case an empty JSON object {} indicating that no
   processing (eg no compression) of the data has occured.  The last
   component decodes to the actual data:  13 bytes, which is the UTF-8-
   encoded 13-character string "Hello, World!".

   The next example is a signed JWsec message since it starts with "S".

   S.eyAic2lnIjoiSFMyNTYiLCAia2lkIjoiRmViMTJrMSIgfQ.
    SGVsbG8sIFdvcmxkIQ.
    MDEyMzQ-FIX-OWFiY2RlZj_xMjM0NTY-ODlhYmNkZWY

   The header (the JSON object decoded from the second dot-separated
   component) is:
   { "sig":"HS256", "kid":"Feb12k1" }

   The next component decodes to the data "Hello, World!".  The final
   component decodes to a 256-bit MAC (message authentication code)
   calculated over the preceeding portion of the JWsec message.  In this
   instance the MAC uses the HS256 algorithm (HMAC with SHA-256) with
   the secret key identified by the label "Feb12k1", and covers the 71
   initial characters of the message (UTF-8 encoded into 71 bytes).

    MDEyMzQ-FI...ZWY = B64(HMAC(S.eyAi...IgfQ.SGVsbG8sIFdvcmxkIQ))

   The following example is a signed-then-encrypted JWsec message.




<span class="grey">Manger                  Expires December 13, 2012               [Page 4]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


   e.ew0KICJhbGc-FIX-U0ExXzUiLA0KICJraWQiOiJodHRwOi8vZX
    hhbXBsZS5vcm-FIX-ibGljLmp3ayNrMiIsDQogImVuYyI6IkEyN
    TZHQ00iLA0KI-FIX-AiOiJERUYiLA0KICJlbnYiOnRydWUNCn0.
    [2048-bit RSA BT2 value].
    [96-bit IV][ciphertext][128-bit tag]

   The decoded header is:

   {
    "kmg":"RSA1_5",
    "kid":"http://example.org/public.jwk#k2",
    "enc":"A256GCM",
    "zip":"DEF",
   }

   The third component is a random 256-bit AES key encrypted with a
   2048-bit RSA public key, as per the RSA1_5 key transport algorithm.
   The fourth component is the concatenation of a 96-bit IV, the
   ciphertext, and a 128-bit authentication tag.  The ciphertext and tag
   are calculated using AES in Galois/Counter mode.

   After verifying the tag, decrypting the ciphertext, and decompressing
   with the DEFLATE algorithm, the result is S.eyJzaWciOiJSUzI1...  This
   data is processed as another (inner) JWsec messages.

   The initial lowercase "e" on the outer JWsec messages indicates the
   encryption wraps another JWsec message.  The initial "S" on the inner
   JWsec message indicates signed data.  Together they show that this is
   a signed-then-encrypted message.

   <a href="#appendix-A">Appendix A</a> has a complete example.


<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  Model</span>

   The starting point for creating a JWsec message is the input data,
   which is a byte array.  One or more modes of protection are applied
   in turn, using algorithms and keys chosen by the message originator.
   Three modes of protection are specified in this document:
   unprotected; signed; and encrypted.  The resultant JWsec message is a
   string, using a limited alphabet of 65 characters.  To apply multiple
   modes of protection, the output JWsec message from one mode is UTF-8
   encoded to give the input data for the next mode.








<span class="grey">Manger                  Expires December 13, 2012               [Page 5]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


                     --&gt;[unprotected]---
    input data       |                 |      JWsec message
   -------------+-&gt;--+-&gt;[  signed   ]--+-&gt;--+---------------&gt;
   [byte array] ^    |                 |    |   [string]
                |    --&gt;[ encrypted ]---    |
                |                           |
                --------[UTF-8 encode]&lt;------


<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  Syntax</span>

   A JWsec message is a string consisting of dot-separated components.
   Each component only uses a limited set of 64 characters:  A-Z, a-z,
   0-9, "-" (hypen-minus), and "_" (low line).  This set is sufficient
   to hold a base64url encoding (without padding), as defined in <a href="./rfc4648#section-5">RFC4648
   section&nbsp;5</a> "Base 64 Encoding with URL and Filename Safe Alphabet"
   [<a href="./rfc4648" title="&quot;The Base16, Base32, and Base64 Data Encodings&quot;">RFC4648</a>].  The limited range of characters used in a JWsec message
   make it suitable to be carried in fields of many web protocols
   without requiring escaping (eg in an HTTP header, URI query string,
   HTML form POST, XML document, JSON string value etc).

   A JWsec message MUST match the &lt;jwsec&gt; production, defined using
   Augmented Backus-Naur Form (ABNF) [<a href="./rfc5234" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">RFC5234</a>]:

   jwsec = ("U" "." header64 "." compressed64) /
           ("S" "." header64 "." compressed64 "." signature64) /
           ("E" "." header64 "." enckey64 "." ciphertext64) /
           (ext "." header64 *("." component64))
             ; note: "X" matches "X" or "x" in ABNF

   ext = %x41-5A / %x61-7A ; A-Z a-z

   header64 = 1*b64url ; base64url-encoded UTF-8-encoded JSON object

   ; base64url-encoded byte arrays
   compressed64 = *b64url ; input data, optionally compressed
   signature64  = *b64url ; digital signature or MAC
   enckey64     = *b64url ; encrypted per-message key
   ciphertext64 = *b64url ; IV, encrypted data, and authentication tag
   component64  = *b64url

   b64url = %x41-5A / %x61-7A / %x30-39 / %x2D / %x5F
           ;   A-Z       a-z       0-9      -      _

   The first dot-separated component in a JWsec message is a single
   letter indicating the nature of the protection provided to the data.
   It determines the semantics of the components after the header.
   Three modes are defined in this specification:  "U" or "u" for



<span class="grey">Manger                  Expires December 13, 2012               [Page 6]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


   unprotected data; "S" or "s" for signed data; and "E" or "e" for
   encrypted data.  A lowercase letter for the mode indicates that the
   input data for the JWsec message is another a JWsec message (UTF-8
   encoded).

   Additional modes can be defined in RFCs that update this
   specification.

   Each JWsec message incorporates a header that is a JSON object with
   0, 1, or more elements [<a href="./rfc4627" title="&quot;The application/json Media Type for JavaScript Object Notation (JSON)&quot;">RFC4627</a>].  The header64 field is the
   base64url encoding (without padding) of the UTF-8 encoding of the
   header JSON object.  Header elements identify the algorithms and keys
   required to process the message.

   Various header elements are defined in this document.  Further header
   elements holding algorithm-specific parameters are likely to be
   defined as algorithms are specified for use with JWsec.  Other header
   elements could be defined to hold status information about keys or
   certificates, for instance.  A recipient MUST ignore any header
   elements it does not recognize so new header elements can be deployed
   while maintaining interoperability.

   Subsequent sections for each mode define output components that are
   bytes arrays.  Those byte arrays are base64url encoded (without
   padding) then joined to the mode and header (all separated by dots)
   to form a JWsec message.  A component's value can be a zero-length
   byte array, in which case the corresponding part of the JWsec message
   is an empty string but the dot-separators are still present.


<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  Unprotected message (mode U)</span>

   An unprotected JWsec message offers no security for the input data it
   carries.  It can compress the data.  An unprotected message can be
   useful when security is provided by a lower layer.  Using an
   unprotected JWsec message as the input data for an encrypted JWsec
   message provides a place (the unprotected JWsec message's header) to
   include any header elements associated with the input data that are
   confidential.

   Output components (other than the mode and header) are:

   compressed  [byte array]

   The compressed data is the input data after applying the compression
   algorithm specified by the "zip" header element.  If there is no
   "zip" element the compressed data equals the input data.  A recipient
   MUST understand the "zip" header element.



<span class="grey">Manger                  Expires December 13, 2012               [Page 7]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


   There are no mandatory header elements so an empty JSON object {} is
   a valid header.


<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  Signed message (mode S)</span>

   A signed JWsec message provides data-origin authentication for the
   input data.  Signing can use the private key of a public/private key
   pair to create a digital signature; or it can use a secret symmetric
   key to create a message authentication code (MAC).  The data can,
   optionally, be compressed.

   Output components (other than the mode and header) are:

   compressed  [byte array]
   signature  [byte array]

   The compressed data is the input data after applying the compression
   algorithm specified by the "zip" element in the header.  If there is
   no "zip" element the compressed data equals the input data.  A
   recipient MUST understand the "zip" header element.

   The header MUST include a "sig" element identifying either an
   asymmetric signature algorithm or a MAC algorithm [see [<a href="#ref-ALGS" title="&quot;JSON Web Security Message Algorithms (similar to draft-ietf-jose-json-web-algorithms)&quot;">ALGS</a>]
   sections <a href="#section-4">4</a> and <a href="#section-5">5</a>].  The signature or MAC covers the mode, header, and
   compressed data.  It is calculated over the (UTF-8 encoded) prefix of
   the JWsec message upto (but excluding) the dot-separator before the
   signature64 component.

   signature  = SIGN(("S" or "s") "." B64(header) "." B64(compressed))

   When using a MAC algorithm the header MUST include a "kid" element to
   identify the secret key.

   When using an asymmetric signature algorithm the public verification
   key needs to be available to the recipient.  The header MUST include
   an "okid" element to identify the public key.  The header SHOULD
   include a "jku" or "x5u" element holding a URI for the raw or
   certified public key respectively.


<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  Encrypted message (mode E)</span>

   An encrypted JWsec message provides confidentiality for the input
   data.  The input data is, optionally, compressed.  The message is
   also integrity protected.  This is achieved by using an authenticated
   encryption algorithm that supports additional data (AEAD algorithm),
   keyed with a randomly-chosen per-message secret key.  Three



<span class="grey">Manger                  Expires December 13, 2012               [Page 8]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


   techniques are available to distribute the per-message key:

   o  Key transport:  the per-message key is encrypted with the
      recipient's public key
   o  Key agreement:  a pairwise symmetric key is generated from the
      originator's and recipient's public/private key pairs, and then
      used to encrypt the per-message key
   o  Symmetric key wrapping:  the per-message key is encrypted using a
      shared symmetric secret key

   An intermediate component to aid describing the process is:

   plaintext  [byte array]

   Output components (other than the mode and header) are:

   enckey  [byte array]
   ciphertext  [byte array]

   The plaintext is the input data after applying the compression
   algorithm specified by the "zip" element in the header.  If there is
   no "zip" element the plaintext equals the input data.  A recipient
   MUST understand the "zip" header element.

   The header MUST include an "enc" element identifying an AEAD
   algorithm [see [<a href="#ref-ALGS" title="&quot;JSON Web Security Message Algorithms (similar to draft-ietf-jose-json-web-algorithms)&quot;">ALGS</a>] <a href="#section-9">section 9</a>].  A random per-message key is
   chosen, using the key size required by the AEAD algorithm.  See
   [<a href="./rfc4086" title="&quot;Randomness Requirements for Security&quot;">RFC4086</a>] for considerations on generating random values.  The data
   to be encrypted by the AEAD algorithm is the plaintext.  The
   additional data to be authenticated by the AEAD algorithm is the
   (UTF-8 encoded) prefix of the JWsec message up to (but excluding) the
   dot-separator before the ciphertext64 component.

   If the AEAD algorithm involves an initialization vector (IV) it is
   prepended to the ciphertext.  The authentication tag generated by the
   AEAD algorithm is appended to the ciphertext.  The lengths of the IV
   and authentication tag are defined by the AEAD algorithm.

   additionalData  = ("E" or "e") "." B64(header) "." B64(enckey)

   ciphertext  = [iv] ENCRYPT(plaintext) authtag

   The header MUST include a "kmg" element identifying a key transport,
   key agreement, or symmetric key wrapping algorithm [see [<a href="#ref-ALGS" title="&quot;JSON Web Security Message Algorithms (similar to draft-ietf-jose-json-web-algorithms)&quot;">ALGS</a>]
   sections <a href="#section-6">6</a>, <a href="#section-7">7</a>, and <a href="#section-8">8</a>].  The encrypted per-message key is held in the
   enckey component.





<span class="grey">Manger                  Expires December 13, 2012               [Page 9]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


<span class="h3"><a class="selflink" name="section-6.1" href="#section-6.1">6.1</a>.  Key transport</span>

   When the "kmg" header element identifies a key transport algorithm,
   that algorithm is used to encrypted the per-message key with the
   recipient's public key.

   The header MUST include a "kid" element to identify the recipient's
   asymmetric key pair.

<span class="h3"><a class="selflink" name="section-6.2" href="#section-6.2">6.2</a>.  Key agreement</span>

   When the "kmg" header element identifies a key agreement algorithm,
   the originator and recipient each use their own private key and the
   other party's public key to generate a pairwise symmetric key.  That
   symmetric key is used to encrypted the per-message key using a
   symmetric key wrapping algorithm.

   Note:  the specification of a key agreement algorithm has to specify
   a symmetric key wrapping algorithm as well.

   The header MUST include a "kid" element to identify the recipient's
   asymmetric key pair.

   The originator's public key also needs to be identified.  The header
   MUST include either an "epk" element or an "okid" element.  The
   former hold the originator's actual public key.  The latter is an
   identifier for the public key, and SHOULD be accompanied by either a
   "jku" or "x5u" element, conveying a URI for the raw or certified
   public key respectively.

<span class="h3"><a class="selflink" name="section-6.3" href="#section-6.3">6.3</a>.  Symmetric key wrapping</span>

   When the "kmg" header element identifies a symmetric key wrapping
   algorithm, that algorithm is used to encrypted the per-message key
   with a secret key shared by the originator and recipient.

   The header MUST include a "kid" element to identify the shared secret
   key.


<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  Header elements</span>

   The following header elements are defined in this document:








<span class="grey">Manger                  Expires December 13, 2012              [Page 10]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


   +------+------------------------------------------------------------+
   | Name | Description                                                |
   +------+------------------------------------------------------------+
   | zip  | String identifier for a compression algorithm.  See [<a href="#ref-ALGS" title="&quot;JSON Web Security Message Algorithms (similar to draft-ietf-jose-json-web-algorithms)&quot;">ALGS</a>] |
   |      | <a href="#section-3">section 3</a>.                                                 |
   | sig  | String identifier for an asymmetric digital signature      |
   |      | algorithm, or for a symmetric message authentication code  |
   |      | (MAC) algorithm.  See [<a href="#ref-ALGS" title="&quot;JSON Web Security Message Algorithms (similar to draft-ietf-jose-json-web-algorithms)&quot;">ALGS</a>] sections <a href="#section-4">4</a> and <a href="#section-5">5</a>.             |
   | kmg  | String identifier for a key transport algorithm, a key     |
   |      | exchange algorithm, or a symmetric key wrapping algorithm. |
   |      | See [<a href="#ref-ALGS" title="&quot;JSON Web Security Message Algorithms (similar to draft-ietf-jose-json-web-algorithms)&quot;">ALGS</a>] sections <a href="#section-6">6</a>, <a href="#section-7">7</a>, or 8 respectively.               |
   | enc  | String identifier for an authenticated encryption with     |
   |      | additional data (AEAD) algorithm.  See [<a href="#ref-ALGS" title="&quot;JSON Web Security Message Algorithms (similar to draft-ietf-jose-json-web-algorithms)&quot;">ALGS</a>] <a href="#section-9">section 9</a>.   |
   | kid  | String identifier for the recipient's key that is needed   |
   |      | to process the message.  The identified key can be either: |
   |      | a symmetric secret key shared by the message originator    |
   |      | and recipient; or an asymmetric key pair for which the     |
   |      | recipient has the private key while the originator used    |
   |      | the public key.                                            |
   | okid | String identifier for the originator's asymmetric key      |
   |      | pair, the public key of which is needed by the recipient   |
   |      | to process the message.                                    |
   | jku  | String holding a Uniform Resource Identifier (URI) for one |
   |      | or more public keys in JSON Web Key format                 |
   |      | [<a href="./draft-ietf-jose-json-web-key">draft-ietf-jose-json-web-key</a>].  It MUST be an HTTPS URI.  |
   | x5u  | String holding a Uniform Resource Identifier (URI) for an  |
   |      | X.509 certificate chain.                                   |
   +------+------------------------------------------------------------+

   Additional header elements can be defined in other documents.  A
   header element name can be a URI or a short name.  A short name MUST
   NOT contain a colon ":" (which a URI will contain), but can otherwise
   be any Unicode string.  A header element name that is a short name
   MUST be registered in the JWsec header element registry.  A header
   element name that is a URI MAY be registered.


<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  IANA considerations</span>

<span class="h3"><a class="selflink" name="section-8.1" href="#section-8.1">8.1</a>.  JWsec Header Element Registry</span>

   This document establishes a registry that IANA will maintain for
   elements that can appear in the header of a JWsec message.  The
   registry's name is "JWsec Header Element Registry".  The registry
   lists element names and the specification where they are defined.

   The policy for registring a name that is a URI is First Come First
   Served (as per <a href="./rfc5226#section-4.1">[RFC5226] section&nbsp;4.1</a>).  The policy for registring a



<span class="grey">Manger                  Expires December 13, 2012              [Page 11]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


   name that is not a URI (and MUST NOT contain a colon) is
   Specification Required.

   The initial contents of the registry are:

                        +------+-----------------+
                        | Name | Reference       |
                        +------+-----------------+
                        | zip  | [this document] |
                        | sig  | [this document] |
                        | kmg  | [this document] |
                        | enc  | [this document] |
                        | kid  | [this document] |
                        | okid | [this document] |
                        | jku  | [this document] |
                        | x5u  | [this document] |
                        +------+-----------------+

<span class="h3"><a class="selflink" name="section-8.2" href="#section-8.2">8.2</a>.  Media type</span>

   The "application/jwsec" media type is registered with IANA to
   identify a JWsec message.

   Type name:  application
   Subtype name:  jwsec
   Required parameters:  none
   Optional parameters:  none
   Encoding considerations:  7bit
   Security considerations:  Some JWsec messages provide data origin
      authenticity and confidentiality, but others provide no security.
      A recipient of a message with this media type needs to ensure that
      the security provided by the actual message received meets the
      receiver's expectations for the message.
   Interoperability considerations:  no known issues
   Published specification  [this document]
   Applications that use this media type:  expected to be used by a
      range of web applications
   Additional information:  none
   Contact:  IETF
   Intended usage:  COMMON
   Restrictions on usage:  none
   Author:  IETF
   Change controller:  IETF


<span class="h2"><a class="selflink" name="section-9" href="#section-9">9</a>.  Security considerations</span>

   JWsec messages have different security properties depending on the



<span class="grey">Manger                  Expires December 13, 2012              [Page 12]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


   modes of protection applied, the order they are applied, and whether
   symmetric or asymmetric keys are used.  A JWsec message can have no
   security.  Consequently, a recipient needs to explicitly confirm that
   the protection applied to each received message matchs the expected
   protection.

   ...


<span class="h2"><a class="selflink" name="section-10" href="#section-10">10</a>.  Normative References</span>

   [<a name="ref-RFC2119" id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="./bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a name="ref-RFC4086" id="ref-RFC4086">RFC4086</a>]  Eastlake, D., Schiller, J., and S. Crocker, "Randomness
              Requirements for Security", <a href="./bcp106">BCP 106</a>, <a href="./rfc4086">RFC 4086</a>, June 2005.

   [<a name="ref-RFC4627" id="ref-RFC4627">RFC4627</a>]  Crockford, D., "The application/json Media Type for
              JavaScript Object Notation (JSON)", <a href="./rfc4627">RFC 4627</a>, July 2006.

   [<a name="ref-RFC4648" id="ref-RFC4648">RFC4648</a>]  Josefsson, S., "The Base16, Base32, and Base64 Data
              Encodings", <a href="./rfc4648">RFC 4648</a>, October 2006.

   [<a name="ref-RFC5652" id="ref-RFC5652">RFC5652</a>]  Housley, R., "Cryptographic Message Syntax (CMS)", STD 70,
              <a href="./rfc5652">RFC 5652</a>, September 2009.

   [<a name="ref-RFC5234" id="ref-RFC5234">RFC5234</a>]  Crocker, D. and P. Overell, "Augmented BNF for Syntax
              Specifications: ABNF", STD 68, <a href="./rfc5234">RFC 5234</a>, January 2008.

   [<a name="ref-RFC5226" id="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="./bcp26">BCP 26</a>, <a href="./rfc5226">RFC 5226</a>,
              May 2008.

   [<a href="./draft-ietf-jose-json-web-key">draft-ietf-jose-json-web-key</a>]
              Jones, M., "JSON Web Key (JWK)", May 2012.

   [<a name="ref-ALGS" id="ref-ALGS">ALGS</a>]     Doe, J., "JSON Web Security Message Algorithms (similar to
              <a href="./draft-ietf-jose-json-web-algorithms">draft-ietf-jose-json-web-algorithms</a>)", June 2012.


<span class="h2"><a class="selflink" name="appendix-A" href="#appendix-A">Appendix A</a>.  Acknowledgments</span>

   [<a name="ref-TODO" id="ref-TODO">TODO</a>]








<span class="grey">Manger                  Expires December 13, 2012              [Page 13]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey">Internet-Draft                    JWsec                        June 2012</span>


Author's Address

   James Manger
   Telstra

   Email:  james@manger.com.au













































Manger                  Expires December 13, 2012              [Page 14]

</pre><br />
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.101, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>
</body></html>
