

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HTTP Authentication: MAC Access Authentication &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="OAuth Resoure" href="oauth_res.html" />
    <link rel="prev" title="SAML 2.0 Bearer Assertion Profiles for OAuth 2.0" href="oauth_saml2_bearer.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>identity 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>HTTP Authentication: MAC Access Authentication</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="oauth_saml2_bearer.html">SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="oauth_res.html">OAuth Resoure</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="http-authentication-mac-access-authentication">
<h1><a class="toc-backref" href="#id1">HTTP Authentication: MAC Access Authentication</a><a class="headerlink" href="#http-authentication-mac-access-authentication" title="Permalink to this headline">¶</a></h1>
<p>Based on <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01">http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01</a>
( February 8, 2012 )</p>
<div class="section" id="abstract">
<span id="oauth-mac-abstract"></span><h2><a class="toc-backref" href="#id2">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>This document specifies
the <a class="reference internal" href="glossary.html#term-http-mac-access-authentication-scheme"><em class="xref std std-term">HTTP MAC access authentication scheme</em></a>,
an HTTP authentication method
using a message authentication code (<a class="reference internal" href="glossary.html#term-mac"><em class="xref std std-term">MAC</em></a>) algorithm
to provide cryptographic verification of portions of
HTTP requests.
The document also defines an <a class="reference internal" href="glossary.html#term-oauth-2-0"><em class="xref std std-term">OAuth 2.0</em></a> binding for use as an access-token type.</p>
<p>(Draft 01, <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01">http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01</a>)</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#http-authentication-mac-access-authentication" id="id1">HTTP Authentication: MAC Access Authentication</a><ul>
<li><a class="reference internal" href="#abstract" id="id2">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id3">1. Introduction</a><ul>
<li><a class="reference internal" href="#example" id="id4">1.1. Example</a></li>
<li><a class="reference internal" href="#notational-conventions" id="id5">1.2. Notational Conventions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-with-oauth-2-0" id="id6">5. Use with OAuth 2.0</a><ul>
<li><a class="reference internal" href="#issuing-mac-type-access-tokens" id="id7">5.1. Issuing MAC-Type Access Tokens</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="introduction">
<span id="oauth-mac-1"></span><h2><a class="toc-backref" href="#id3">1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This specification defines the <a class="reference internal" href="glossary.html#term-http-mac-access-authentication-scheme"><em class="xref std std-term">HTTP MAC access authentication scheme</em></a>,
providing a method for making authenticated HTTP requests
with partial cryptographic verification of the request,
covering the HTTP method, request URI, and host.</p>
<p>Similar to the <a class="reference internal" href="glossary.html#term-http-basic-access-authentication-scheme"><em class="xref std std-term">HTTP Basic access authentication scheme</em></a> [RFC2617],
the <a class="reference internal" href="glossary.html#term-mac-scheme"><em class="xref std std-term">MAC scheme</em></a> utilizes a set of <a class="reference internal" href="glossary.html#term-client-credentials"><em class="xref std std-term">client credentials</em></a>
which include an identifier and key.
However,
in contrast with the <a class="reference internal" href="glossary.html#term-basic-scheme"><em class="xref std std-term">Basic scheme</em></a>,
the key is never included in authenticated requests
but is used to calculate the request <em class="xref std std-term">MAC value</em>
which is included instead.</p>
<p>The <a class="reference internal" href="glossary.html#term-mac-scheme"><em class="xref std std-term">MAC scheme</em></a> requires
the establishment of a <em class="xref std std-term">shared symmetric key</em>
between the <a class="reference internal" href="session.html#term-client"><em class="xref std std-term">client</em></a> and the <a class="reference internal" href="glossary.html#term-server"><em class="xref std std-term">server</em></a>.
This specification offers one
such method for issuing a set of <em class="xref std std-term">MAC credentials</em>
to the <a class="reference internal" href="session.html#term-client"><em class="xref std std-term">client</em></a> using
<a class="reference internal" href="glossary.html#term-oauth-2-0"><em class="xref std std-term">OAuth 2.0</em></a> in the form of a <em class="xref std std-term">MAC-type access token</em>.</p>
<p>The primary design goal of this mechanism is
to simplify and improve HTTP authentication
for services <strong>that are unwilling or unable to employ TLS for every request</strong>.
In particular,
this mechanism leverage an initial TLS setup phase
to establish a shared secret between the client and the server.
The shared secret is then used over an insecure channel
to provide protection against a passive network attacker.</p>
<p>In particular,
when a <a class="reference internal" href="glossary.html#term-server"><em class="xref std std-term">server</em></a> uses this mechanism,
a <em class="xref std std-term">passive network attacker</em> will be unable
to &#8220;steal&#8221; the user&#8217;s <em class="xref std std-term">session token</em>,
as is possible today with <em class="xref std std-term">cookies</em> and other <a class="reference internal" href="glossary.html#term-bearer-tokens"><em class="xref std std-term">bearer tokens</em></a>.
In addition,
this mechanism helps secure the session token against leakage
when sent over a secure channel to the wrong server.
For example,
when the client uses some form of dynamic configuration
to determine where to send an authenticated request,
or when the client fails to properly validate the server&#8217;s identity
as part of its TLS handshake.</p>
<p>Unlike the <a class="reference internal" href="glossary.html#term-http-digest-authentication-scheme"><em class="xref std std-term">HTTP Digest authentication scheme</em></a>,
this mechanism does not require interacting with the server
to prevent <a class="reference internal" href="glossary.html#term-replay-attacks"><em class="xref std std-term">replay attacks</em></a>.
Instead, the <a class="reference internal" href="session.html#term-client"><em class="xref std std-term">client</em></a> provides
both a <a class="reference internal" href="standard.html#term-nonce"><em class="xref std std-term">nonce</em></a> and a <em class="xref std std-term">timestamp</em>,
which the <a class="reference internal" href="glossary.html#term-server"><em class="xref std std-term">server</em></a> can use to prevent <a class="reference internal" href="glossary.html#term-replay-attacks"><em class="xref std std-term">replay attacks</em></a>
using a bounded amount of storage.
Also unlike <a class="reference internal" href="glossary.html#term-digest-scheme"><em class="xref std std-term">Digest</em></a>,
this mechanism is not intended
to protect the user&#8217;s password itself
because the <a class="reference internal" href="session.html#term-client"><em class="xref std std-term">client</em></a> and <a class="reference internal" href="glossary.html#term-server"><em class="xref std std-term">server</em></a>
both have access to the key material in the clear.
Instead,
servers should issue a <strong>short-lived derivative credential</strong>
for this mechanism during the initial TLS setup phase.</p>
<p><a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01#section-1">http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01#section-1</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>TLS/SSL is required only when &#8220;token&#8221; is exchanged.</li>
<li>nonce and timestamp prevent replay attacks</li>
</ul>
</div>
<div class="section" id="example">
<span id="oauth-mac-1-1"></span><h3><a class="toc-backref" href="#id4">1.1. Example</a><a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="session.html#term-client"><em class="xref std std-term">client</em></a> attempts to access a <a class="reference internal" href="uma_core.html#term-protected-resource"><em class="xref std std-term">protected resource</em></a> without
authentication, making the following HTTP request to the resource
server:</p>
<div class="highlight-python"><pre>GET /resource/1?b=1&amp;a=2 HTTP/1.1
Host: example.com</pre>
</div>
<p>The resource server returns the following authentication challenge:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: MAC</pre>
</div>
<p>The <a class="reference internal" href="session.html#term-client"><em class="xref std std-term">client</em></a> has previously obtained a set of <em class="xref std std-ref">MAC credentials</em>
for accessing resources on the &#8220;<a class="reference external" href="http://example.com/">http://example.com/</a>&#8221; server.
The <em class="xref std std-term">MAC credentials</em> issued to the <a class="reference internal" href="session.html#term-client"><em class="xref std std-term">client</em></a> include the following attributes:</p>
<div class="highlight-python"><pre>MAC key identifier:  h480djs93hd8
MAC key:  489dks293j39
MAC algorithm:  hmac-sha-1</pre>
</div>
<p>The <a class="reference internal" href="session.html#term-client"><em class="xref std std-term">client</em></a> constructs the authentication header
by calculating a <em class="xref std std-term">timestamp</em>
(e.g. the number of seconds since January 1, 1970 00:00:00 GMT)
and generating a random string used as a <a class="reference internal" href="standard.html#term-nonce"><em class="xref std std-term">nonce</em></a>:</p>
<div class="highlight-python"><pre>Timestamp:  1336363200
Nonce:  dj83hs9s</pre>
</div>
<p>The client constructs the normalized request string
(the new line separator character is represented by &#8220;n&#8221; for display purposes only;
the trailing new line separator signify that no extension value is
included with the request, explained below):</p>
<div class="highlight-python"><pre>1336363200\n
dj83hs9s\n
GET\n
/resource/1?b=1&amp;a=2\n
example.com\n
80\n
\n</pre>
</div>
<p>The request MAC is calculated using the specified MAC algorithm
&#8220;hmac-sha-1&#8221; and the MAC key over the normalized request string.
The result is base64-encoded to produce the request MAC:</p>
<div class="highlight-python"><pre>bhCQXTVyfj5cmA9uKkPFx1zeOXM=</pre>
</div>
<p>The client includes the MAC key identifier, nonce, and request MAC
with the request using the &#8220;Authorization&#8221; request header field:</p>
<div class="highlight-python"><pre>GET /resource/1?b=1&amp;a=2 HTTP/1.1
Host: example.com
Authorization: MAC id="h480djs93hd8",
                   ts="1336363200",
                   nonce="dj83hs9s",
                   mac="bhCQXTVyfj5cmA9uKkPFx1zeOXM="</pre>
</div>
<p>The server validates the request by calculating the request MAC again
based on the request received and verifies the validity and scope of
the MAC credentials.  If valid, the server responds with the
requested resource representation.</p>
<p>(Draft 01 , <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01#section-1.1">http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01#section-1.1</a>)</p>
</div>
<div class="section" id="notational-conventions">
<span id="oauth-mac-1-2"></span><h3><a class="toc-backref" href="#id5">1.2. Notational Conventions</a><a class="headerlink" href="#notational-conventions" title="Permalink to this headline">¶</a></h3>
<p>The key words &#8216;MUST&#8217;, &#8216;MUST NOT&#8217;, &#8216;REQUIRED&#8217;, &#8216;SHALL&#8217;, &#8216;SHALL NOT&#8217;,
&#8216;SHOULD&#8217;, &#8216;SHOULD NOT&#8217;, &#8216;RECOMMENDED&#8217;, &#8216;MAY&#8217;, and &#8216;OPTIONAL&#8217; in this
specification are to be interpreted as described in [RFC2119].</p>
<p>This specification uses the Augmented Backus-Naur Form (ABNF)
notation of [I-D.ietf-httpbis-p1-messaging].  Additionally, the
following rules are included from [RFC2617]: auth-param.</p>
<p>(draft 01)</p>
</div>
</div>
<div class="section" id="use-with-oauth-2-0">
<span id="oauth-mac-5"></span><h2><a class="toc-backref" href="#id6">5. Use with OAuth 2.0</a><a class="headerlink" href="#use-with-oauth-2-0" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="glossary.html#term-oauth-2-0"><em class="xref std std-term">OAuth 2.0</em></a> ([I-D.ietf-oauth-v2]) defines
an extensible token-based authentication framework.
The <em class="xref std std-term">MAC authentication scheme</em> can be used
to make OAuth-based requests by issuing <em class="xref std std-term">MAC-type access tokens</em>.</p>
<p>This specification does not define methods
for the <a class="reference internal" href="session.html#term-client"><em class="xref std std-term">client</em></a> to specifically request a <em class="xref std std-term">MAC-type token</em>
from the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>.
Additionally,
it does not include any discovery facilities for identifying
which HMAC algorithms are supported by a resource server,
or how the client may go about obtaining MAC access tokens for any
given protected resource.</p>
<p>(Draft 01, <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01#section-5">http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01#section-5</a> )</p>
<div class="section" id="issuing-mac-type-access-tokens">
<span id="oauth-mac-5-1"></span><h3><a class="toc-backref" href="#id7">5.1. Issuing MAC-Type Access Tokens</a><a class="headerlink" href="#issuing-mac-type-access-tokens" title="Permalink to this headline">¶</a></h3>
<p>Authorization servers issuing MAC-type access tokens MUST include the
following parameters whenever a response includes the &#8220;<a class="reference internal" href="standard.html#term-30"><em class="xref std std-term">access_token</em></a>&#8221;
parameter:</p>
<dl class="glossary docutils">
<dt id="term-access-token">access_token</dt>
<dd>REQUIRED.
The MAC key identifier.</dd>
<dt id="term-mac-key">mac_key</dt>
<dd>REQUIRED.
The MAC key.</dd>
<dt id="term-mac-algorithm">mac_algorithm</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">The MAC algorithm used to calculate the request MAC.
Value MUST be one of &#8220;hmac-sha-1&#8221;, &#8220;hmac-sha-256&#8221;, or a
registered extension algorithm name as described in
Section 7.1.</p>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store

{
  "access_token":"SlAV32hkKG",
  "token_type":"mac",
  "expires_in":3600,
  "refresh_token":"8xLOxBtZp8",
  "mac_key":"adijq39jdlaska9asud",
  "mac_algorithm":"hmac-sha-256"
}</pre>
</div>
<p>(Draft 01, <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01#section-5.1">http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01#section-5.1</a> )</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="oauth_saml2_bearer.html">SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="oauth_res.html">OAuth Resoure</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>