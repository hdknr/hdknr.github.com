

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OpenID Connect Basic Client 1.0 &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="OpenID Connect Standard 1.0" href="standard.html" />
    <link rel="prev" title="OpenID Connect" href="openid_connect.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>identity 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>OpenID Connect Basic Client 1.0</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="openid_connect.html">OpenID Connect</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="standard.html">OpenID Connect Standard 1.0</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="openid-connect-basic-client-1-0">
<h1><a class="toc-backref" href="#id9">OpenID Connect Basic Client 1.0</a><a class="headerlink" href="#openid-connect-basic-client-1-0" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="connect-basic-client">
<p class="topic-title first">Connect Basic Client</p>
<ul class="simple">
<li><a class="reference internal" href="#openid-connect-basic-client-1-0" id="id9">OpenID Connect Basic Client 1.0</a><ul>
<li><a class="reference internal" href="#abstract" id="id10">Abstract</a></li>
<li><a class="reference internal" href="#requirements-notation-and-conventions" id="id11">1.  Requirements Notation and Conventions</a></li>
<li><a class="reference internal" href="#terminology" id="id12">2.  Terminology</a></li>
<li><a class="reference internal" href="#protocol-flows" id="id13">3.  Protocol Flows</a><ul>
<li><a class="reference internal" href="#openid-connect-scopes" id="id14">3.1.  OpenID Connect Scopes</a></li>
<li><a class="reference internal" href="#implicit-flow" id="id15">3.2.  Implicit Flow</a><ul>
<li><a class="reference internal" href="#client-prepares-an-authorization-request" id="id16">3.2.1.  Client Prepares an Authorization Request</a></li>
<li><a class="reference internal" href="#client-sends-a-request-to-the-authorization-server" id="id17">3.2.2.  Client Sends a Request to the Authorization Server</a></li>
<li><a class="reference internal" href="#authorization-server-obtains-the-end-user-consent-authorization" id="id18">3.2.3.  Authorization Server Obtains the End-User Consent/Authorization</a></li>
<li><a class="reference internal" href="#authorization-server-sends-the-end-user-back-to-the-client" id="id19">3.2.4.  Authorization Server Sends the End-User Back to the Client</a><ul>
<li><a class="reference internal" href="#end-user-grants-authorization" id="id20">3.2.4.1.  End-User Grants Authorization</a></li>
<li><a class="reference internal" href="#end-user-denies-authorization-or-invalid-request" id="id21">3.2.4.2.  End-User Denies Authorization or Invalid Request</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#check-id-endpoint" id="id22">3.3.  Check ID Endpoint</a><ul>
<li><a class="reference internal" href="#check-id-request" id="id23">3.3.1.  Check ID Request</a><ul>
<li><a class="reference internal" href="#request-verification" id="id24">3.3.1.1.  Request Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#check-id-response" id="id25">3.3.2.  Check ID Response</a><ul>
<li><a class="reference internal" href="#response-verification" id="id26">3.3.2.1.  Response Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-codes" id="id27">3.3.3.  Error Codes</a><ul>
<li><a class="reference internal" href="#basic-3-3-4-2" id="id28">3.3.4.2.  Response Verification</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#userinfo-endpoint" id="id29">4.  UserInfo Endpoint</a><ul>
<li><a class="reference internal" href="#requesting-userinfo" id="id30">4.1.  Requesting UserInfo</a></li>
<li><a class="reference internal" href="#client-receives-userinfo-response" id="id31">4.2.  Client Receives UserInfo Response</a><ul>
<li><a class="reference internal" href="#table-1-reserved-member-definitions" id="id32">Table 1: Reserved Member Definitions</a></li>
<li><a class="reference internal" href="#error-response" id="id33">4.2.1.  Error Response</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#discovery-and-registration" id="id34">5.  Discovery and Registration</a></li>
<li><a class="reference internal" href="#query-string-serialization" id="id35">6.  Query String Serialization</a></li>
<li><a class="reference internal" href="#security-considerations" id="id36">7.  Security Considerations</a><ul>
<li><a class="reference internal" href="#assertion-manufacture-modification" id="id37">7.1.  Assertion Manufacture/Modification</a></li>
<li><a class="reference internal" href="#assertion-disclosure" id="id38">7.2.  Assertion Disclosure</a></li>
<li><a class="reference internal" href="#assertion-redirect" id="id39">7.3.  Assertion Redirect</a></li>
<li><a class="reference internal" href="#assertion-reuse" id="id40">7.4.  Assertion Reuse</a></li>
<li><a class="reference internal" href="#assertion-substitution" id="id41">7.5.  Assertion Substitution</a></li>
<li><a class="reference internal" href="#authentication-request-disclosure" id="id42">7.6.  Authentication Request Disclosure</a></li>
<li><a class="reference internal" href="#authentication-process-threats" id="id43">7.7.  Authentication Process Threats</a></li>
<li><a class="reference internal" href="#implicit-flow-threats" id="id44">7.8.  Implicit Flow Threats</a></li>
<li><a class="reference internal" href="#availability" id="id45">7.9.  Availability</a></li>
</ul>
</li>
<li><a class="reference internal" href="#privacy-considerations" id="id46">8.  Privacy Considerations</a></li>
<li><a class="reference internal" href="#normative-references" id="id47">10. Normative References</a></li>
</ul>
</li>
</ul>
</div>
<p>Based on <a class="reference external" href="http://openid.bitbucket.org/openid-connect-basic-1_0.html">OpenID Connect Basic Client 1.0 - draft 15(October 30, 2011)</a>
( <a class="reference external" href="static/specs/openid.bitbucket.org/openid-connect-basic-1_0.html">Cache</a> )</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Draft 17, March 15, 2012 is available....</p>
</div>
<div class="section" id="abstract">
<span id="basic-abstract"></span><h2><a class="toc-backref" href="#id10">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>OpenID Connect 1.0 is a simple[#]_ identity layer on top of <a class="reference internal" href="oauth.html"><em>OAuth 2.0 protocol</em></a>.
It allows a web site to verify the identity of the user based on the authentication performed by the <a class="footnote-reference" href="#id2" id="id1">[1]</a> <a class="reference internal" href="glossary.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>, as well as to obtain basic profile information about the user in an interoperable and RESTful manner.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>&#8220;simple&#8221; should be removed. by Yaron Goland</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>not &#8220;the&#8221;, should be &#8220;an&#8221;. by Yaron Goland</td></tr>
</tbody>
</table>
<p>OpenID Connect Basic Client is a profile of the OpenID Connect Standard 1.0 Specification that is designed to be easy to read and implement for Relying Parties. OpenID Providers should consult the main specification. This profile omits implementation and security considerations for OpenID Providers.</p>
</div>
<div class="section" id="requirements-notation-and-conventions">
<span id="basic-1"></span><h2><a class="toc-backref" href="#id11">1.  Requirements Notation and Conventions</a><a class="headerlink" href="#requirements-notation-and-conventions" title="Permalink to this headline">¶</a></h2>
<p>The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in [RFC2119] .</p>
<p>Throughout this document, values are quoted to indicate that they are to be taken literally. When using these values in protocol messages, the quotes MUST NOT be used as part of the value.</p>
</div>
<div class="section" id="terminology">
<span id="basic-2"></span><h2><a class="toc-backref" href="#id12">2.  Terminology</a><a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<p>The following definitions define additional terminology used in this specification in addition to those
defined in <a class="reference internal" href="oauth.html"><em>OAuth 2.0 [OAuth.2.0]</em></a>.</p>
<dl class="glossary docutils">
<dt id="term-relying-party-rp">Relying Party (RP)</dt>
<dd>An application requiring identity information from an OpenID Provider.</dd>
<dt id="term-openid-provider-op">OpenID Provider (OP)</dt>
<dd>A service capable of providing identity information to a Relying Party.</dd>
<dt id="term-assertion">Assertion</dt>
<dd>A set of Claims about the End-User that are attested to by the OpenID Provider and Resource Servers.</dd>
<dt id="term-claim">Claim</dt>
<dd>A piece of information about an Entity that a Claims Provider asserts about that Entity.</dd>
<dt id="term-claims-provider">Claims Provider</dt>
<dd>An Authorization Server that can return claims about a user.</dd>
<dt id="term-entity">Entity</dt>
<dd>Something that has separate and distinct existence and that can be identified in context.</dd>
<dt id="term-id-token">ID Token</dt>
<dd>A token that contains information about the authentication event.
It is a signed token, but can be treated as opaque by clients that uses the <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a> .
Relying Parties wanting to process the token directly should refer to the <a class="reference internal" href="standard.html"><em>OpenID Connect Standard 1.0 specification</em></a>.</dd>
<dt id="term-check-id-endpoint">Check ID Endpoint</dt>
<dd>A resource that, when presented with an <a class="reference internal" href="glossary.html#term-id-token"><em class="xref std std-term">ID Token</em></a> by the client, returns authentication information about the user session represented by that ID Token.</dd>
<dt id="term-userinfo-endpoint">UserInfo Endpoint</dt>
<dd>A protected resource that, when presented with an access token by the client, returns authorized information about the user represented by that access token.</dd>
</dl>
</div>
<div class="section" id="protocol-flows">
<span id="basic-3"></span><h2><a class="toc-backref" href="#id13">3.  Protocol Flows</a><a class="headerlink" href="#protocol-flows" title="Permalink to this headline">¶</a></h2>
<p>Authorization Requests can follow one of two paths; the <a class="reference internal" href="glossary.html#term-implicit-flow"><em class="xref std std-term">Implicit Flow</em></a> or the <a class="reference internal" href="glossary.html#term-authorization-code-flow"><em class="xref std std-term">Authorization Code Flow</em></a>.
The Authorization Code Flow is suitable for clients that can securely maintain a client secret
between themselves and the <a class="reference internal" href="glossary.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> whereas,
the Implicit Flow is suitable for clients that cannot.
Clients that do not support TLS MUST use the Authorization Code Flow to prevent the interception of <a class="reference internal" href="glossary.html#term-access-tokens"><em class="xref std std-term">Access Tokens</em></a>.</p>
<p>The OpenID Connect Basic Client profile only documents clients using the <a class="reference internal" href="glossary.html#term-implicit-flow"><em class="xref std std-term">Implicit Flow</em></a>.
OpenID Providers MUST support both flows.
Clients wanting to use the Authorization Code Flow and OpenID Providers should consult the <a class="reference internal" href="standard.html"><em>OpenID Connect Standard 1.0 specification</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Basic = Implicit Flow</p>
</div>
<div class="section" id="openid-connect-scopes">
<span id="basic-3-1"></span><h3><a class="toc-backref" href="#id14">3.1.  OpenID Connect Scopes</a><a class="headerlink" href="#openid-connect-scopes" title="Permalink to this headline">¶</a></h3>
<p>OpenID Connect clients use scopes as defined in <a class="reference internal" href="oauth.html#oauth-3-3"><em>3.3 of OAuth 2.0 [OAuth.2.0]</em></a>
to specify what access privileges are requested for <a class="reference internal" href="glossary.html#term-access-tokens"><em class="xref std std-term">Access Tokens</em></a>.
The scopes associated with Access Tokens determine <strong>what resources will be available</strong>
when they are used to access OAuth 2.0 protected endpoints.
For OpenID Connect, scopes request what <strong>information is to be made available from the UserInfo Endpoint, and to request an ID Token</strong>.
OAuth 2.0 allows additional scopes to be specified, as extensions.
This specification only describes scopes that are part of OpenID Connect.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OAuth :  type of resource</li>
<li>OpenID:  type of information at <a class="reference internal" href="glossary.html#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a></li>
</ul>
</div>
<p>OpenID Connect defines the following scopes:</p>
<blockquote>
<div><dl class="docutils">
<dt>openid</dt>
<dd>REQUIRED.
Informs the <a class="reference internal" href="glossary.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> that the client is making an OpenID request.
If the openid scope is not specified, the server SHOULD treat the request as a generic OAuth 2.0 request,
and perform no OpenID Connect processing.</dd>
<dt>profile</dt>
<dd>OPTIONAL.
Requests default profile information.</dd>
<dt>email</dt>
<dd>OPTIONAL.
Requests an email address.</dd>
<dt>address</dt>
<dd>OPTIONAL.
Requests an address.</dd>
</dl>
</div></blockquote>
<p>Multiple scopes MAY be requested by creating a <strong>space delimited</strong>, <strong>case sensitive</strong> list of scope values.</p>
<p>The User <strong>may decline a scope request</strong> by the client.</p>
<p>To increase conversion, a site may elect to only request a subset of the information from the UserInfo Endpoint.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">&#8220;Convertion&#8221; is unclear. <a class="reference external" href="https://bitbucket.org/openid/connect/issue/133">Issue 133</a>.</p>
</div>
<p>The following is a non-normative example of a Scope Request.</p>
<div class="highlight-python"><pre>scope=openid profile email phone</pre>
</div>
</div>
<div class="section" id="implicit-flow">
<span id="basic-3-2"></span><h3><a class="toc-backref" href="#id15">3.2.  Implicit Flow</a><a class="headerlink" href="#implicit-flow" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="glossary.html#term-implicit-flow"><em class="xref std std-term">Implicit Flow</em></a> consists of the following steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference internal" href="#basic-3-2-1"><em>Client prepares an Authorization Request</em></a> containing the desired request parameters.</li>
<li><a class="reference internal" href="#basic-3-2-2"><em>Client sends a request to the Authorization Server</em></a>.</li>
<li>Authorization Server authenticates the End-User.</li>
<li><a class="reference internal" href="#basic-3-2-3"><em>Authorization Server obtains the End-User Consent/Authorization</em></a>.</li>
<li><a class="reference internal" href="#basic-3-2-4"><em>Authorization Server sends the End-User back to the Client</em></a>  with an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a> and <a class="reference internal" href="glossary.html#term-id-token"><em class="xref std std-term">ID Token</em></a>.</li>
</ol>
</div></blockquote>
<p>(Draft 15)</p>
<div class="section" id="client-prepares-an-authorization-request">
<span id="basic-3-2-1"></span><h4><a class="toc-backref" href="#id16">3.2.1.  Client Prepares an Authorization Request</a><a class="headerlink" href="#client-prepares-an-authorization-request" title="Permalink to this headline">¶</a></h4>
<p>When the End-User wishes to access a Protected Resource,
and the End-User Authorization has not yet been obtained,
the Client prepares an <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a> to the <a class="reference internal" href="glossary.html#term-authorization-endpoint"><em class="xref std std-term">Authorization Endpoint</em></a>.</p>
<p>The scheme used in the Authorization Endpoint URL MUST be <strong>HTTPS</strong>.</p>
<p>Clients MAY construct the request using the HTTP GET
or the HTTP POST method as defined in RFC 2616 [<span class="target" id="index-1"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2616.html"><strong>RFC 2616</strong></a>].</p>
<p>If using the HTTP GET method, the parameters are serialized using <a class="reference internal" href="glossary.html#term-query-string-serialization"><em class="xref std std-term">Query String Serialization</em></a>.
If using the HTTP POST method, the request parameters are added to the HTTP request entity-body
using the application/x-www-form-urlencoded format as defined by [W3C.REC‑html401‑19991224].</p>
<p>This profile further constrains the following request parameters:</p>
<dl class="glossary docutils">
<dt id="term-response-type">response_type</dt>
<dd>It MUST include <strong>token</strong> and <strong>id_token</strong>, as a space separated list.
This requests both an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a> and <a class="reference internal" href="#term-22"><em class="xref std std-term">id_token</em></a> to be returned in the URL fragment of the response.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>&#8220;token id_token&#8221; is MUST for Basic.</li>
</ul>
</div>
<p>Other REQUIRED parameters in the request include the following:</p>
<dl class="glossary docutils">
<dt id="term-client-id">client_id</dt>
<dd>The OAuth client identifier.</dd>
<dt id="term-scope">scope</dt>
<dd>It MUST include <strong>openid</strong> as one of the space separated strings.
Optional scope strings of <strong>profile</strong>, <strong>email</strong>, and <strong>address</strong> are also <a class="reference internal" href="#basic-3-1"><em>supported</em></a>.</dd>
<dt id="term-redirect-uri">redirect_uri</dt>
<dd>A redirection URI where the response will be sent.
This MUST be pre-registered with the provider.</dd>
<dt id="term-nonce">nonce</dt>
<dd>A random, unique string value used to mitigate the replay attack this value is returned from the Check ID Endpoint.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">nonce is REQUIRED from Draft 13.</p>
</div>
<p>The request MAY contain the following optional parameters:</p>
<dl class="glossary docutils">
<dt id="term-state">state</dt>
<dd>RECOMENDED.
An opaque value used to maintain state
between the request and the callback, used to protect against <a class="reference internal" href="glossary.html#term-xsrf"><em class="xref std std-term">XSRF</em></a> attacks.</dd>
<dt id="term-display">display</dt>
<dd><p class="first">A string value that specifies how the <a class="reference internal" href="glossary.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> displays the authentication page to the user.
The following values are supported:</p>
<dl class="last docutils">
<dt>page</dt>
<dd>The Authorization Server SHOULD display authentication and consent UI consistent
with a full browser page view.
If the display parameter is not specified this is the default display mode.</dd>
<dt>popup</dt>
<dd>The Authorization Server SHOULD display authentication and consent UI consistent
with a popup browser window.
The popup browser window SHOULD be 450 pixels wide and 500 pixels tall.</dd>
<dt>touch</dt>
<dd>The Authorization Server SHOULD display authentication and consent UI consistent
with a device that leverages a touch interface.
The Authorization Server MAY attempt to detect the touch device and further customize the interface.</dd>
<dt>wap</dt>
<dd>The Authorization Server SHOULD display authentication and consent UI consistent
with a &#8220;feature phone&#8221; type display.</dd>
<dt>embedded</dt>
<dd>The Authorization Server SHOULD display authentication and consent UI consistent
with the limitations of an embedded browser.</dd>
</dl>
</dd>
<dt id="term-prompt">prompt</dt>
<dd><p class="first">A space delimited,
case sensitive list of string values that specifies
whether the Authorization Server prompts the End-User for reauthentication and reapproval.
The possible values are:</p>
<dl class="docutils">
<dt>none</dt>
<dd>This value informs the Authorization Server that
it MUST NOT display any authentication or consent user interface pages.
An error is returned if either the End-User is not already authenticated or
the client does not have pre-configured approval for the requested scopes.
This can be used as a method to check for existing authentication and/or approval.</dd>
<dt>login</dt>
<dd>The Authorization Server MUST prompt the End-User for reauthentication.</dd>
<dt>consent</dt>
<dd>The Authorization Server MUST prompt the End-User for reapproval
before returning information to the client.</dd>
<dt>select_account</dt>
<dd>The Authorization Server MUST prompt the End-User to select a user account
if the account has multiple accounts associated with it.</dd>
</dl>
<p class="last">This can be used by the client to make sure that
the End-User is still present for the current session or to bring attention to the request.
If this parameter contains &#8220;none&#8221; with any other value, an error is returned..</p>
</dd>
</dl>
<p>The following is a non-normative example of an Authorization Request URL.
Note that the line wraps within the values are for display purpose only:</p>
<div class="highlight-python"><pre>https://server.example.com/authorize?
response_type=token%20id_token
&amp;client_id=s6BhdRkqt3
&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
&amp;scope=openid%20profile
&amp;state=af0ifjsldkj</pre>
</div>
<p>(Draft 15)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first"><a class="reference internal" href="glossary.html#term-accounts"><em class="xref std std-term">accounts</em></a> sample ask end users to optionally select scopes.</p>
</li>
<li><p class="first"><a class="reference internal" href="glossary.html#term-accounts"><em class="xref std std-term">accounts</em></a> sample always send <strong>state</strong> to bind an anonymous session at RP to authz response from OP.</p>
<blockquote>
<div><ul class="simple">
<li>I&#8217;m not quite sure if this is right way.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Draft 12 = Draft 11</p>
</li>
</ul>
</div>
</div>
<div class="section" id="client-sends-a-request-to-the-authorization-server">
<span id="basic-3-2-2"></span><h4><a class="toc-backref" href="#id17">3.2.2.  Client Sends a Request to the Authorization Server</a><a class="headerlink" href="#client-sends-a-request-to-the-authorization-server" title="Permalink to this headline">¶</a></h4>
<p>Having constructed the <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a>, the client sends it to the <a class="reference internal" href="glossary.html#term-authorization-endpoint"><em class="xref std std-term">Authorization Endpoint</em></a>.
This MAY happen via HTTPS redirect, hyperlinking, or any other secure means of directing the User-Agent to the URL.</p>
<p>Following is a non-normative example using HTTP redirect. Note: Line wraps are for display purpose only.:</p>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://server.example.com/authorize?
response_type=token%20id_token
&amp;client_id=s6BhdRkqt3
&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
&amp;scope=openid%20profile
&amp;state=af0ifjsldkj
&amp;nonce=n-0S6_WzA2Mj</pre>
</div>
<p>(Draft 15)</p>
</div>
<div class="section" id="authorization-server-obtains-the-end-user-consent-authorization">
<span id="basic-3-2-3"></span><h4><a class="toc-backref" href="#id18">3.2.3.  Authorization Server Obtains the End-User Consent/Authorization</a><a class="headerlink" href="#authorization-server-obtains-the-end-user-consent-authorization" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="glossary.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> obtains an authorization decision, for the requested scopes.
This can done by presenting the End-User with a dialogue
that allows the End-User to recognize what he is consenting to
and obtain his consent or by establishing approval via other means
(for example, via previous administrative approval).</p>
<p>The <strong>openid</strong> scope grants the RP access to the user identifier of the authenticated End-User of the session.</p>
<p>All other scopes are optional.
It is up to the OpenID Provider to determine if an error should be returned
in the case of the End-User declining to authorize scopes other than openid.</p>
<p>(Draft 15)</p>
</div>
<div class="section" id="authorization-server-sends-the-end-user-back-to-the-client">
<span id="basic-3-2-4"></span><h4><a class="toc-backref" href="#id19">3.2.4.  Authorization Server Sends the End-User Back to the Client</a><a class="headerlink" href="#authorization-server-sends-the-end-user-back-to-the-client" title="Permalink to this headline">¶</a></h4>
<p>Once the authorization is determined, the <a class="reference internal" href="glossary.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> returns a positive or negative response.</p>
<p>(Draft 15)</p>
<div class="section" id="end-user-grants-authorization">
<span id="basic-3-2-4-1"></span><h5><a class="toc-backref" href="#id20">3.2.4.1.  End-User Grants Authorization</a><a class="headerlink" href="#end-user-grants-authorization" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">&#8220;Grants Authorization&#8221; means that the end user grants issuing tokens at OP and OP return authz response.</p>
</div>
<p>If the resource owner grants the access request,
the <a class="reference internal" href="glossary.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> issues an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a> and
delivers it to the client by adding the following parameters to the <strong>fragment component</strong> of the redirection URI
using the application/x-www-form-urlencoded format
as defined in <a class="reference internal" href="oauth.html#oauth-4-2-2"><em>Section 4.2.2 of OAuth 2.0 [OAuth.2.0]</em></a></p>
<p>In the <a class="reference internal" href="glossary.html#term-implicit-flow"><em class="xref std std-term">Implicit Flow</em></a> the entire response is returned in the <strong>fragment component</strong> of the redirect URL,
as defined in <a class="reference internal" href="oauth.html#oauth-4-2-2"><em>4.2.2 of OAuth 2.0 [OAuth.2.0]</em></a></p>
<dl class="glossary docutils">
<dt id="term-access-token">access_token</dt>
<dd>REQUIRED.
The <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a> for the UserInfo Endpoint.</dd>
<dt id="term-token-type">token_type</dt>
<dd>REQUIRED.
Value MUST be &#8220;<strong>bearer</strong>&#8220;</dd>
<dt id="term-19">id_token</dt>
<dd>REQUIRED.
The Access Token for the <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a>.</dd>
<dt id="term-20">state</dt>
<dd>REQUIRED if the state parameter in the request.
Clients MUST verify that the <strong>state</strong> value is equal to the exact value of <strong>state</strong> parameter
in the <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a>.</dd>
<dt id="term-expires-in">expires_in</dt>
<dd>OPTIONAL.
The expirery time in seconds of the <a class="reference internal" href="#term-access-token"><em class="xref std std-term">access_token</em></a></dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ID Token has its own expirey.</p>
</div>
<p>The client can then use the Access Token to access protected resources at <a class="reference internal" href="glossary.html#term-resource-server"><em class="xref std std-term">Resource Servers</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">access_token is only for UserInfo ? No. The OP can allow the token to be used for additional resources.</p>
</div>
<p>The following is a non-normative example.
Line wraps after the second line is for the display purpose only:</p>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.com/#
access_token=SlAV32hkKG&amp;
token_type=bearer&amp;
id_token=1234567.SlAV32hkKG.abcde1234&amp;
expires_in=3600&amp;
&amp;state=af0ifjsldkj</pre>
</div>
<p>(Draft 15)</p>
</div>
<div class="section" id="end-user-denies-authorization-or-invalid-request">
<span id="basic-3-2-4-2"></span><h5><a class="toc-backref" href="#id21">3.2.4.2.  End-User Denies Authorization or Invalid Request</a><a class="headerlink" href="#end-user-denies-authorization-or-invalid-request" title="Permalink to this headline">¶</a></h5>
<p>If the End-User denies the authorization or the End-User authentication fails,
the <a class="reference internal" href="glossary.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST return the negative authorization response
as defined in <a class="reference internal" href="oauth.html#oauth-4-2-2-1"><em>4.2.2.1 of OAuth 2.0 [OAuth.2.0]</em></a>.
No other parameters SHOULD be returned.</p>
<p>(Draft 15)</p>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last"><a class="reference internal" href="glossary.html#term-accounts"><em class="xref std std-term">accounts</em></a> is not properly implemented for negative responses.</p>
</div>
</div>
</div>
</div>
<div class="section" id="check-id-endpoint">
<span id="basic-3-3"></span><h3><a class="toc-backref" href="#id22">3.3.  Check ID Endpoint</a><a class="headerlink" href="#check-id-endpoint" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a> validates the id_token and
returns a text JSON [<span class="target" id="index-3"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc4627.html"><strong>RFC 4627</strong></a>] object which contains information
about the End-User associated with the supplied <a class="reference internal" href="#term-22"><em class="xref std std-term">id_token</em></a>.</p>
<p>Clients MUST verify the validity of the id_token using the Check ID Endpoint.</p>
<p>The id_token is used to manage the <strong>signon event</strong> and <strong>user identifier</strong>.
It differs from an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a> which provides access to the UserInfo Endpoint and
other OAuth 2.0 protected resources that the End-User is granting access to.</p>
<p>The id_token is restricted to a particular client via the <a class="reference internal" href="#term-aud"><em class="xref std std-term">aud</em></a> (audience) and <a class="reference internal" href="glossary.html#term-nonce"><em class="xref std std-term">nonce</em></a> claims.</p>
<p>A full explination of how to use the id_token to perform session management can be found
in the <a class="reference internal" href="session.html"><em>OpenID Connect Session Management 1.0</em></a> [openID.Session]</p>
<p>(Draft 15)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Check Session -&gt; Check ID  from Draft 13</p>
</div>
<div class="section" id="check-id-request">
<span id="basic-3-3-1"></span><h4><a class="toc-backref" href="#id23">3.3.1.  Check ID Request</a><a class="headerlink" href="#check-id-request" title="Permalink to this headline">¶</a></h4>
<p>To request the information about the authentication performed on the End-User and verify the id_token,
the following parameters MAY be sent to the Check ID Endpoint as query parameters in a GET or as form encoded in a POST request:</p>
<dl class="glossary docutils">
<dt id="term-22">id_token</dt>
<dd>REQUIRED.
The id_token obtained from an OpenID Connect authorization request.</dd>
</dl>
<p>The following is a non-normative example of a request to the <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a>:</p>
<p>Request:</p>
<div class="highlight-python"><pre>GET /op/check_id?id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImtpZCI6
ImNsaWVudC5leGFtcGxlLmNvbSJ9.eyJpc3N1ZXIiOiJodHRwOlwvXC9zZXJ2ZXIuZXhhbXBs
ZS5jb20iLCJjbGllbnRfaWQiOiJjbGllbnQuZXhhbXBsZS5jb20iLCJhdWRpZW5jZSI6ImNsa
WVudC5leGFtcGxlLmNvbSIsImlkIjoidXNlcl8yMzQyMzQiLCJleHAiOjEzMDM4NTI4ODB9.a
JwagC6501Da-zK-X8Az9B-Y625aSEfxVuBpFEDjOxQ

Host: server.example.com</pre>
</div>
<p>(Draft 15)</p>
<div class="section" id="request-verification">
<span id="basic-3-3-1-1"></span><h5><a class="toc-backref" href="#id24">3.3.1.1.  Request Verification</a><a class="headerlink" href="#request-verification" title="Permalink to this headline">¶</a></h5>
<p>Clients MUST verify the request with the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>When connecting to the Endpoint, verify that the <strong>TLS</strong> peer matches that of the Endpoint.</li>
<li>Make sure that the Endpoint that the client connected to is a trusted <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a>
for the Entity via pre-configuration meta-data or discovery.</li>
</ol>
</div></blockquote>
<p>(Draft 15)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Newly introduced from Draft 13.</p>
</div>
</div>
</div>
<div class="section" id="check-id-response">
<span id="basic-3-3-2"></span><h4><a class="toc-backref" href="#id25">3.3.2.  Check ID Response</a><a class="headerlink" href="#check-id-response" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is almost a copy of &#8221; <em class="xref std std-ref">messages_3_1_1</em> &#8221;.</p>
</div>
<p>The response is a text JSON [<span class="target" id="index-4"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc4627.html"><strong>RFC 4627</strong></a>] object using the application/json media type with the following parameters.</p>
<dl class="glossary docutils">
<dt id="term-iss">iss</dt>
<dd>REQUIRED.
The unique identifier of the issuer of the response.</dd>
<dt id="term-user-id">user_id</dt>
<dd>REQUIRED.
A locally unique and never reassigned identifier for the user,
which is intended to be consumed by the Client. e.g. 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4.
It MUST NOT exceed <strong>255 ASCII characters in length</strong>.</dd>
<dt id="term-aud">aud</dt>
<dd>REQUIRED.
This member identifies the <a class="reference internal" href="glossary.html#term-audience"><em class="xref std std-term">audience</em></a> that this <a class="reference internal" href="glossary.html#term-id-token"><em class="xref std std-term">ID Token</em></a> is intended for.
It is RECOMENDED that <strong>aud</strong> be client_id of the RP.</dd>
<dt id="term-exp">exp</dt>
<dd>REQUIRED.
Type Integer.
Identifies the expiration time on or after which the ID Token MUST NOT be accepted for processing.
The processing of this parameter requires that the current date/time MUST be
before the expiration date/time listed in the value.
Implementers MAY provide for some small leeway <a class="footnote-reference" href="#id3" id="id4">[2]</a> , usually no more than a few minutes, to account for <a class="reference external" href="http://en.wikipedia.org/wiki/Clock_skew">clock skew</a> .
The value is number of seconds from 1970-01-01T0:0:0Z as measured in UTC until the desired date/time.
See RFC 3339 [<span class="target" id="index-5"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3339.html"><strong>RFC 3339</strong></a>] for details regarding date/times in general and UTC in particular.</dd>
<dt id="term-iso29115">iso29115</dt>
<dd>OPTIONAL. (entity authentication assurance):
Specifies the X.eaa / ISO/IEC29115 [ISO29115] entity authentication assurance level of the authentication performed.</dd>
<dt id="term-28">nonce</dt>
<dd>REQUIRED.
Clients MUST verify that the nonce value is equal to the exact value of nonce parameter in the Authorization Request.</dd>
</dl>
<p>The following is a non-normative example of a request to the Introspection endpoint:</p>
<p>Request:</p>
<div class="highlight-python"><pre>GET /op/check_id?id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImtpZCI6
ImNsaWVudC5leGFtcGxlLmNvbSJ9.eyJpc3N1ZXIiOiJodHRwOlwvXC9zZXJ2ZXIuZXhhbXBs
ZS5jb20iLCJjbGllbnRfaWQiOiJjbGllbnQuZXhhbXBsZS5jb20iLCJhdWRpZW5jZSI6ImNsa
WVudC5leGFtcGxlLmNvbSIsImlkIjoidXNlcl8yMzQyMzQiLCJleHAiOjEzMDM4NTI4ODB9.a
JwagC6501Da-zK-X8Az9B-Y625aSEfxVuBpFEDjOxQ

Host: server.example.com</pre>
</div>
<p>Response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json

{
"iss": "http://server.example.com",
"user_id": "Jane Doe",
"aud": "http://client.example.net",
"exp":1311281970
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">access_token is NOT required.</p>
</div>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[3]</a></td><td>A margin of freedom or variation, as of activity, time, or expenditure; latitude. See Synonyms at room.</td></tr>
</tbody>
</table>
<p>(Draft 15)</p>
<div class="section" id="response-verification">
<span id="basic-3-3-2-1"></span><h5><a class="toc-backref" href="#id26">3.3.2.1.  Response Verification</a><a class="headerlink" href="#response-verification" title="Permalink to this headline">¶</a></h5>
<p>To verify the validity of the Response, the client MUST do the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a> has not returned an error for the <a class="reference internal" href="glossary.html#term-id-token"><em class="xref std std-term">ID Token</em></a> being expired or invalid.</li>
<li>Check that the <a class="reference internal" href="#term-iss"><em class="xref std std-term">iss</em></a> is equal to that of the pre-configured or discovered <a class="reference internal" href="messages.html#term-issuer-identifier"><em class="xref std std-term">Issuer Identifier</em></a> for the user session.</li>
<li>Check that the returned <a class="reference internal" href="glossary.html#term-nonce"><em class="xref std std-term">nonce</em></a> is equal to the <a class="reference internal" href="glossary.html#term-nonce"><em class="xref std std-term">nonce</em></a> in the <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a>.</li>
<li>Verify that the <a class="reference internal" href="#term-aud"><em class="xref std std-term">aud</em></a> (audience) contained within the response is the client&#8217;s <a class="reference internal" href="#term-client-id"><em class="xref std std-term">client_id</em></a>.</li>
</ol>
</div></blockquote>
<p>(Draft 15)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Newly introduced from Draft 13.</p>
</div>
</div>
</div>
<div class="section" id="error-codes">
<span id="basic-3-3-3"></span><h4><a class="toc-backref" href="#id27">3.3.3.  Error Codes</a><a class="headerlink" href="#error-codes" title="Permalink to this headline">¶</a></h4>
<p>In addition to the error codes defined in <a class="reference internal" href="oauth.html#oauth-5-2"><em>Section 5.2 of OAuth 2.0 [OAuth.2.0]</em></a>,
this specification defines the following error codes.</p>
<blockquote>
<div><dl class="docutils">
<dt>invalid_id_token</dt>
<dd>The <a class="reference internal" href="glossary.html#term-id-token"><em class="xref std std-term">ID Token</em></a> is not valid for the requested resource, malformed, is in an incorrect format, or expired.</dd>
</dl>
</div></blockquote>
<div class="admonition-todo admonition" id="index-6">
<p class="first admonition-title">Todo</p>
<p>Sample of</p>
<blockquote class="last">
<div><ul class="simple">
<li>invalid for requested resoure</li>
<li><strong>malformed</strong> ID Token</li>
<li>incorrect format</li>
<li>expired</li>
</ul>
</div></blockquote>
</div>
<p>(Draft 15)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Newly introduced from Draft 13.</p>
</div>
<div class="section" id="basic-3-3-4-2">
<span id="id6"></span><h5><a class="toc-backref" href="#id28">3.3.4.2.  Response Verification</a><a class="headerlink" href="#basic-3-3-4-2" title="Permalink to this headline">¶</a></h5>
<p>To verify the validity of the Response, the client MUST to the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>If the authentication request contained a <strong>nonce</strong>,
check that the returned nonce is valid.</li>
<li>Verify that the response was intended for the recipient,
using the <strong>aud</strong> (audience) contained within the response.</li>
<li>If <strong>issued_to</strong> is present
then it MUST contain an identifier for a trusted intermediary.
If issued_to is unknown then the assertion MUST be rejected.</li>
<li>Check that the server that responded was really the intended server
through a TLS/SSL server <strong>certificate check</strong>.</li>
<li>The Check Session Endpoint has not returned an error for the <strong>token</strong>
being expired or invalid.</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><em class="xref std std-ref">issues_79</em> / <em class="xref std std-ref">issues_80</em> / <em class="xref std std-ref">issues_81</em> /  <em class="xref std std-ref">issues_82</em></p>
<p class="last"><a class="reference internal" href="session.html"><em>Session Management</em></a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="userinfo-endpoint">
<span id="basic-4"></span><h2><a class="toc-backref" href="#id29">4.  UserInfo Endpoint</a><a class="headerlink" href="#userinfo-endpoint" title="Permalink to this headline">¶</a></h2>
<p>To obtain the additional <strong>attributes</strong> and <strong>tokens</strong>,
the client makes a GET or POST request to the UserInfo Endpoint.</p>
<p>User Info Endpoint Servers MUST require the use of a transport-layer security mechanism.
The authorization server MUST support TLS 1.2 as described in RFC 5246 [:rfc:5246]
and MAY support other transport-layer mechanisms with equivalent security.</p>
<p>NOTE: The <a class="reference internal" href="glossary.html#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> response is not guaranteed to be about the Subject in the session.
Therefore, it MUST NOT be used as an assertion about the End-User
in the session unless the <a class="reference internal" href="#term-user-id"><em class="xref std std-term">user_id</em></a> matches the <a class="reference internal" href="#term-user-id"><em class="xref std std-term">user_id</em></a> in the <a class="reference internal" href="glossary.html#term-id-token"><em class="xref std std-term">ID Token</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ID Token is the assertion in Connect.
What is &#8220;User Info Endpoint Server&#8221; ?</p>
</div>
<p>(Draft 15)</p>
<div class="section" id="requesting-userinfo">
<span id="basic-4-1"></span><h3><a class="toc-backref" href="#id30">4.1.  Requesting UserInfo</a><a class="headerlink" href="#requesting-userinfo" title="Permalink to this headline">¶</a></h3>
<p>Clients MAY send requests with the following parameters to the UserInfo Endpoint
to obtain further information about the End-User.
The UserInfo Endpoint is an OAuth 2.0 [OAuth.2.0] protected resource
that complies with the <a class="reference internal" href="bearer.html"><em>Bearer Token [OAuth.2.0.Bearer] specification</em></a>.
As such, the access token SHOULD be specified via the HTTP Authorization header.</p>
<blockquote>
<div><dl class="docutils">
<dt>access_token</dt>
<dd>REQUIRED. The access_token obtained from an OpenID Connect <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a>.
This parameter MUST only be sent using one method through either HTTP Authorization header or query string.</dd>
<dt><a class="reference internal" href="glossary.html#term-schema"><em class="xref std std-term">schema</em></a></dt>
<dd>REQUIRED.
The schema in which the data is to be returned.
The only defined value is <strong>openid</strong>.
If the value of this parameter is omitted, or not openid,
the response may be a proprietary schema to support backwards compatibility.
Custom schema names and responses are out of scope for this specification.</dd>
<dt>id</dt>
<dd>This identifier is reserved for backwards compatibility.
It MUST be ignored by the endpoint if the openid schema is used.</dd>
</dl>
</div></blockquote>
<div class="admonition-todo admonition" id="index-7">
<p class="first admonition-title">Todo</p>
<p class="last">When is the <strong>id</strong>  used for backwards compatibility.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>access_token</strong> MUST not delivered by a HTTP <strong>POST</strong> parameter.</p>
</div>
<p>The following is a non-normative example. Line wraps are for display purpose only:</p>
<div class="highlight-python"><pre>GET /userinfo HTTP/1.1
Host: server.example.com
Authorization: Bearer vF9dft4qmT</pre>
</div>
<p>(Draft 15)</p>
</div>
<div class="section" id="client-receives-userinfo-response">
<span id="basic-4-2"></span><h3><a class="toc-backref" href="#id31">4.2.  Client Receives UserInfo Response</a><a class="headerlink" href="#client-receives-userinfo-response" title="Permalink to this headline">¶</a></h3>
<p>If the requested schema is openid, the response MUST return a plain text JSON [<span class="target" id="index-8"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc4627.html"><strong>RFC 4627</strong></a>] structure
that contains a set of members that are a subset of those defined below.
Additional members (not specified below) MAY also be returned.</p>
<p>The members may be represented in multiple languages and scripts.
To specify the languages and scripts, BCP47 [<span class="target" id="index-9"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc5646.html"><strong>RFC 5646</strong></a>] language tags MUST be added to each member names delimited by a #,
e.g., familyName#ja-Kana-JP for expressing Family Name in Katakana in Japanese,
which is commonly used to index and represent the phonetics of the Kanji representation of the same represented as familyName#ja-Hani-JP.</p>
<div class="admonition-todo admonition" id="index-10">
<p class="first admonition-title">Todo</p>
<p class="last">Check <span class="target" id="index-11"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc5646.html"><strong>RFC 5646</strong></a> and BCP47.</p>
</div>
<div class="section" id="table-1-reserved-member-definitions">
<span id="basic-table-1"></span><h4><a class="toc-backref" href="#id32">Table 1: Reserved Member Definitions</a><a class="headerlink" href="#table-1-reserved-member-definitions" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Member</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>user_id</td>
<td>string</td>
<td>Identifier for the user at the issuer.</td>
</tr>
<tr class="row-odd"><td>name</td>
<td>string</td>
<td>User&#8217;s full name in displayable form including all name parts,
ordered according to user&#8217;s locale and preferences.</td>
</tr>
<tr class="row-even"><td>given_name</td>
<td>string</td>
<td>Given name or first name of the user.</td>
</tr>
<tr class="row-odd"><td>family_name</td>
<td>string</td>
<td>Surname or last name of the user.</td>
</tr>
<tr class="row-even"><td>middle_name</td>
<td>string</td>
<td>Middle name of the user.</td>
</tr>
<tr class="row-odd"><td>nickname</td>
<td>string</td>
<td>Casual name of the user that may or may not be the same as the given_name.
For instance, a nickname value of Mike might be returned alongside
a given_name value of Michael.</td>
</tr>
<tr class="row-even"><td>profile</td>
<td>string</td>
<td>URL of user&#8217;s profile page.</td>
</tr>
<tr class="row-odd"><td>picture</td>
<td>string</td>
<td>URL of the user&#8217;s profile picture.</td>
</tr>
<tr class="row-even"><td>website</td>
<td>string</td>
<td>URL of user&#8217;s web page or blog.</td>
</tr>
<tr class="row-odd"><td>email</td>
<td>string</td>
<td>The user&#8217;s preferred e-mail address.</td>
</tr>
<tr class="row-even"><td>verified</td>
<td>boolean</td>
<td>True if the user&#8217;s e-mail address has been verified; otherwise false.</td>
</tr>
<tr class="row-odd"><td>gender</td>
<td>string</td>
<td>The user&#8217;s gender: female or male.</td>
</tr>
<tr class="row-even"><td>birthday</td>
<td>string</td>
<td>The user&#8217;s birthday, represented as a date string in MM/DD/YYYY format. The year MAY be 0000,
indicating that it is omitted.</td>
</tr>
<tr class="row-odd"><td>zoneinfo</td>
<td>string</td>
<td>String from zoneinfo [zoneinfo] timezone database. For example, Europe/Paris or
America/Los_Angeles.</td>
</tr>
<tr class="row-even"><td>locale</td>
<td>string</td>
<td>The user&#8217;s locale, represented as an RFC 5646 [RFC5646] language tag. This is typically
an ISO 639-1 Alpha-2 [ISO639‑1] language code in lowercase and an ISO 3166-1 Alpha-2
[ISO3166‑1] country code in uppercase, separated by a dash. For example, en-US or fr-CA.
As a compatibility note, some implementations have used an underscore as the separator
rather than a dash, for example, en_US; Implementations MAY choose to accept this locale
syntax as well.</td>
</tr>
<tr class="row-odd"><td>phone_number</td>
<td>string</td>
<td>The user&#8217;s preferred telephone number. For example, +1 (425) 555-1212 or +56 (2) 687 2400.</td>
</tr>
<tr class="row-even"><td>address</td>
<td>JSON object</td>
<td>The user&#8217;s preferred address. The value of the address member is a JSON [RFC4627] structure
containing some or all of these string-valued fields: formatted, street_address, locality,
region, postal_code, and country.
The street_address field MAY contain multiple lines if the address representation requires
it. Implementations MAY return only a subset of the fields of an address, depending upon
the information available and the user&#8217;s privacy preferences.
For example, the country and region might be returned without returning more fine-grained
address information.</td>
</tr>
<tr class="row-odd"><td>updated_time</td>
<td>string</td>
<td>Time the user&#8217;s information was last updated, represented as a RFC 3339 [RFC3339] datetime.
For example, 2011-01-03T23:58:42+0000.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Following is a non-normative example of such response:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;picture&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/janedoe/me.jpg&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(Draft 15)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Facebook Graph API defines <a class="reference external" href="http://developers.facebook.com/docs/reference/api/user/">User</a> objects.</p>
</div>
</div>
<div class="section" id="error-response">
<span id="basic-4-2-1"></span><h4><a class="toc-backref" href="#id33">4.2.1.  Error Response</a><a class="headerlink" href="#error-response" title="Permalink to this headline">¶</a></h4>
<p>When some error condition arises, the UserInfo endpoint returns the Error Response.
In addition to the standard OAuth 2.0 [OAuth.2.0] errors, the UserInfo endpoint may return the following errors:</p>
<blockquote>
<div><dl class="docutils">
<dt>unsupported_schema</dt>
<dd>The requested schema is unsupported.</dd>
</dl>
</div></blockquote>
<p>(Draft 15)</p>
</div>
</div>
</div>
<div class="section" id="discovery-and-registration">
<span id="basic-5"></span><h2><a class="toc-backref" href="#id34">5.  Discovery and Registration</a><a class="headerlink" href="#discovery-and-registration" title="Permalink to this headline">¶</a></h2>
<p>Some OpenID Connect installations can use a pre-configured set of OpenID Providers and/or Relying Parties.
In those cases, it may not be necessary to support dynamic discovery of information about identities
or services or dynamic registration of clients.</p>
<p>However, if installations choose to support unanticipated interactions between Relying Parties
and OpenID Providers that do not have pre-configured relationships,
they SHOULD accomplish this by implementing the facilities defined in the OpenID Connect Discovery 1.0 [<a class="reference internal" href="discovery.html"><em>OpenID Connect Discovery 1.0</em></a>]
and <a class="reference internal" href="reg.html"><em>OpenID Connect Dynamic Client Registration 1.0 [OpenID.Registration]</em></a> specifications.</p>
<p>(Draft 15)</p>
</div>
<div class="section" id="query-string-serialization">
<span id="basic-6"></span><h2><a class="toc-backref" href="#id35">6.  Query String Serialization</a><a class="headerlink" href="#query-string-serialization" title="Permalink to this headline">¶</a></h2>
<p>In order to serialize the parameters using the query string serialization,
the client constructs the string by adding the parameters
and values to the query component using the application/x-www-form-urlencoded format
as defined by [W3C.REC‑html401‑19991224].</p>
<p>Following is a non-normative example of such serialization:</p>
<div class="highlight-python"><pre>GET /authorize?scope=openid&amp;response_type=code
&amp;client_id=s6BhdRkqt3
&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1

Host: server.example.com</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">New in Draft13</p>
</div>
</div>
<div class="section" id="security-considerations">
<span id="basic-7"></span><h2><a class="toc-backref" href="#id36">7.  Security Considerations</a><a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>In addition to the Security Considerations in OAuth 2.0 <a class="reference internal" href="#term-oauth-2-0"><em class="xref std std-term">[OAuth.2.0]</em></a>,
followings are the list of attack vectors and remedies that were considered for this specification.</p>
<p>(Draft 15)</p>
<div class="section" id="assertion-manufacture-modification">
<span id="basic-7-1"></span><h3><a class="toc-backref" href="#id37">7.1.  Assertion Manufacture/Modification</a><a class="headerlink" href="#assertion-manufacture-modification" title="Permalink to this headline">¶</a></h3>
<p>An <a class="reference internal" href="#term-assertion"><em class="xref std std-term">assertion</em></a> is <strong>the result of the authentication</strong> performed by the <a class="reference internal" href="glossary.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> that was provided to the client.
The assertion is used to pass information about the user or the authentication process from the Authorization Server to the client.</p>
<p>To mitigate this attack, the assertion may be sent over a protected channel such as TLS/SSL.
In order to protect the integrity of assertions from malicious attack, the server MUST be authenticated <a class="footnote-reference" href="#id5" id="id7">[3]</a> .
In this specification, the assertion is always sent over TLS/SSL protected channel.</p>
<p>For details of the threat, see [<em class="xref std std-term">SP800‑63</em>].</p>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td>By checking the X.509 certificate used for TLS/SSL. (?)</td></tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">miteigate - To moderate (a quality or condition) in force or intensity; alleviate. See Synonyms at relieve.
( <a class="reference external" href="http://www.thefreedictionary.com/mitigation">migitation</a> )</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">I can&#8217;t find any particula section about &#8220;Assertion Manufacture/Modification&#8221; threat in &#8220;<a class="reference internal" href="nist-sp-800-63.html"><em>Electronic Authentication Guideline</em></a>&#8221;.</p>
</div>
<p>(Draft 15)</p>
</div>
<div class="section" id="assertion-disclosure">
<span id="basic-7-2"></span><h3><a class="toc-backref" href="#id38">7.2.  Assertion Disclosure</a><a class="headerlink" href="#assertion-disclosure" title="Permalink to this headline">¶</a></h3>
<p>This profile is subject to assertion disclosure in the user&#8217;s browser, if it is compromised.
Other OpenID Connect profiles should be used if this threat needs to be mitigated.</p>
<p>For details of the threat, see <a class="reference internal" href="nist-sp-800-63.html"><em>[SP800‑63]</em></a> .</p>
<p>(Draft 15)</p>
</div>
<div class="section" id="assertion-redirect">
<span id="basic-7-3"></span><h3><a class="toc-backref" href="#id39">7.3.  Assertion Redirect</a><a class="headerlink" href="#assertion-redirect" title="Permalink to this headline">¶</a></h3>
<p>To mitigate this threat, the assertion includes the identity of the client for whom it was generated as <a class="reference internal" href="#term-client-id"><em class="xref std std-term">client_id</em></a>.
The client verifies that incoming assertions include its identity as the recipient of the assertion.</p>
<p>For details of the threat, see <a class="reference internal" href="nist-sp-800-63.html"><em>[SP800‑63]</em></a>.</p>
<p>(Draft 15)</p>
</div>
<div class="section" id="assertion-reuse">
<span id="basic-7-4"></span><h3><a class="toc-backref" href="#id40">7.4.  Assertion Reuse</a><a class="headerlink" href="#assertion-reuse" title="Permalink to this headline">¶</a></h3>
<p>The assertion includes a timestamp and a short lifetime of validity.
The client checks the <strong>timestamp</strong> and <strong>lifetime values</strong> to ensure that the assertion is currently valid.</p>
<p>The use of a <strong>nonce</strong> in the request is RECOMMENDED.
The response from the Check ID Endpoint contains the nonce sent in the authorization request.
This SHOULD be checked against a list of already received ID assertions to check for replays.</p>
<p>For details of the threat, see [SP800‑63].</p>
</div>
<div class="section" id="assertion-substitution">
<span id="basic-7-5"></span><h3><a class="toc-backref" href="#id41">7.5.  Assertion Substitution</a><a class="headerlink" href="#assertion-substitution" title="Permalink to this headline">¶</a></h3>
<p>Responses to assertion requests is bound to the corresponding requests by message order in HTTP,
as both assertions and requests are protected by TLS that can detect and disallow malicious reordering of packets.</p>
<p>For details of the threat, see [SP800‑63].</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">state should be recommended.</p>
</div>
</div>
<div class="section" id="authentication-request-disclosure">
<span id="basic-7-6"></span><h3><a class="toc-backref" href="#id42">7.6.  Authentication Request Disclosure</a><a class="headerlink" href="#authentication-request-disclosure" title="Permalink to this headline">¶</a></h3>
<p>Since the authentication request is sent over a protected channel,
the disclosure may only happen at the User-Agent where the information is decrypted.</p>
<p>For details of the threat, see [SP800‑63].</p>
</div>
<div class="section" id="authentication-process-threats">
<span id="basic-7-7"></span><h3><a class="toc-backref" href="#id43">7.7.  Authentication Process Threats</a><a class="headerlink" href="#authentication-process-threats" title="Permalink to this headline">¶</a></h3>
<p>In the category of Authentication Process Threats, the following threats exist:</p>
<blockquote>
<div><ul class="simple">
<li>Online Guessing</li>
<li>Phishing</li>
<li>Pharming</li>
<li>Eavesdropping</li>
<li>Replay</li>
<li>Session Hijacking</li>
<li>Man-in-the-Middle</li>
</ul>
</div></blockquote>
<p>The authentication process, per se, as described in [SP800‑63] is out of scope for this protocol,
but care SHOULD be taken to achieve appropriate protection.</p>
<p>For details of the threat, see [SP800‑63].</p>
</div>
<div class="section" id="implicit-flow-threats">
<span id="basic-7-8"></span><h3><a class="toc-backref" href="#id44">7.8.  Implicit Flow Threats</a><a class="headerlink" href="#implicit-flow-threats" title="Permalink to this headline">¶</a></h3>
<p>In the implicit flow, the access token is returned in the fragment part of the client&#8217;s redirect_uri through HTTPS.
Thus it is protected between the Authorization Server and the User-Agent,
and User-Agent and the Client.
The only the place it can be captured is the User-Agent where the TLS session is terminated,
and is possible if the User-Agent is infested by malware.</p>
</div>
<div class="section" id="availability">
<span id="basic-7-9"></span><h3><a class="toc-backref" href="#id45">7.9.  Availability</a><a class="headerlink" href="#availability" title="Permalink to this headline">¶</a></h3>
<p>When the Authorization Server is down, users will likely be unable to access it.
To mitigate this risk, the client SHOULD allow users to associate multiple Authorization Servers.</p>
</div>
</div>
<div class="section" id="privacy-considerations">
<span id="basic-8"></span><h2><a class="toc-backref" href="#id46">8.  Privacy Considerations</a><a class="headerlink" href="#privacy-considerations" title="Permalink to this headline">¶</a></h2>
<p>The UserInfo response typically contains Personally Identifiable Information.
As such, user consent for the release of the information for the specified purpose SHOULD be obtained at or prior to the authorization time
in accordance with relevant regulations.
The purpose of use is typically registered in association with the redirect_uri.</p>
<p>Only necessary UserInfo data should be stored at the client
and the client SHOULD associate the received data with the purpose of use statement.</p>
<p>The server SHOULD make the UserInfo access log available to the user
so that the user can monitor who accessed his data.</p>
<p>To protect the user from a possible correlation among clients,
the use of a Pairwise Pseudonymous Identifier (<a class="reference internal" href="glossary.html#term-ppid"><em class="xref std std-term">PPID</em></a>) as the user_id SHOULD be considered.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em class="xref std std-ref">accounts sample implementation for PPID</em></p>
</div>
</div>
<div class="section" id="normative-references">
<span id="basic-10"></span><h2><a class="toc-backref" href="#id47">10. Normative References</a><a class="headerlink" href="#normative-references" title="Permalink to this headline">¶</a></h2>
<dl class="glossary docutils">
<dt id="term-29">[ISO29115]</dt>
<dd>McCallister, E., “ITU-T Recommendation X.eaa | ISO/IEC 2nd CD 29115 &#8211; Information technology - Security techniques - Entity authentication assurance framework,” ISO/IEC 29115.</dd>
<dt id="term-iso3166-1">[ISO3166-1]</dt>
<dd>International Organization for Standardization, “ISO 3166-1:1997. Codes for the representation of names of countries and their subdivisions &#8211; Part 1: Country codes,” 1997.</dd>
<dt id="term-iso639-1">[ISO639-1]</dt>
<dd>International Organization for Standardization, “ISO 639-1:2002. Codes for the representation of names of languages &#8211; Part 1: Alpha-2 code,” 2002.</dd>
<dt id="term-oauth-2-0">[OAuth.2.0]</dt>
<dd>Hammer-Lahav, E., Ed., Recordon, D., and D. Hardt, “OAuth 2.0 Authorization Protocol,” September 2011.</dd>
<dt id="term-oauth-2-0-bearer">[OAuth.2.0.Bearer]</dt>
<dd>Jones, M., Ed., Recordon, D., and D. Hardt, “The OAuth 2.0 Protocol: Bearer Tokens,” September 2011.</dd>
<dt id="term-openid-discovery">[OpenID.Discovery]</dt>
<dd>Sakimura, N., Bradley, J., Jones, M., and E. Jay, “OpenID Connect Discovery 1.0,” September 2011.</dd>
<dt id="term-openid-registration">[OpenID.Registration]</dt>
<dd>Sakimura, N., Bradley, J., Ed., and M. Jones, “OpenID Connect Dynamic Client Registration 1.0,” September 2011.</dd>
<dt id="term-openid-session">[OpenID.Session]</dt>
<dd>de Medeiros, B., “OpenID Connect Session Management 1.0,” September 2011.</dd>
<dt id="term-rfc2119">[RFC2119]</dt>
<dd>Bradner, S., “Key words for use in RFCs to Indicate Requirement Levels,” BCP 14, RFC 2119, March 1997 (TXT, HTML, XML).</dd>
<dt id="term-rfc2616">[RFC2616]</dt>
<dd>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, “Hypertext Transfer Protocol &#8211; HTTP/1.1,” RFC 2616, June 1999 (TXT, PS, PDF, HTML, XML).</dd>
<dt id="term-rfc3339">[RFC3339]</dt>
<dd>Klyne, G., Ed. and C. Newman, “Date and Time on the Internet: Timestamps,” RFC 3339, July 2002 (TXT, HTML, XML).</dd>
<dt id="term-rfc4627">[RFC4627]</dt>
<dd>Crockford, D., “The application/json Media Type for JavaScript Object Notation (JSON),” RFC 4627, July 2006 (TXT).</dd>
<dt id="term-rfc5246">[RFC5246]</dt>
<dd>Dierks, T. and E. Rescorla, “The Transport Layer Security (TLS) Protocol Version 1.2,” RFC 5246, August 2008 (TXT).</dd>
<dt id="term-rfc5646">[RFC5646]</dt>
<dd>Phillips, A. and M. Davis, “Tags for Identifying Languages,” BCP 47, RFC 5646, September 2009 (TXT).</dd>
<dt id="term-sp800-63">[SP800-63]</dt>
<dd>National Institute of Standards and Technology, “NIST SP800-63rev.1: Electronic Authentication Guideline,” NIST SP800-63.</dd>
<dt id="term-w3c-rec-html401-19991224">[W3C.REC-html401-19991224]</dt>
<dd>Raggett, D., Jacobs, I., and A. Hors, “HTML 4.01 Specification,” World Wide Web Consortium Recommendation REC-html401-19991224, December 1999 (HTML).</dd>
<dt id="term-zoneinfo">[zoneinfo]</dt>
<dd>Public Domain, “The tz database,” June 2011.</dd>
</dl>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="openid_connect.html">OpenID Connect</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="standard.html">OpenID Connect Standard 1.0</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>