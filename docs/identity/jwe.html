
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JSON Web Encryption (JWE)(draft30) &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/basic.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.0.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/bootstrap-sphinx.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="JSON Web Key (JWK) : draft30" href="jwk.html" />
    <link rel="prev" title="Holder-of-Key JSON Web Signature (JWS)" href="jws_hok.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">identity</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="oauth.html">RFC6759:The OAuth 2.0 Authorization Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_bearer.html">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_threat.html">Auth 2.0 Threat Model and Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_revocation.html">RFC7009:Token Revocation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_jwt_bearer.html">JSON Web Token (JWT) Bearer Token Profiles for OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_saml2_bearer.html">SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_assertion.html">Assertion Framework for OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_mac.html">HTTP Authentication: MAC Access Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_reg.html">OAuth Dynamic Client Registration Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_introspect.html">OAuth Token Introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_meta.html">JSON Metadata for OAuth Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_res_reg.html">OAuth 2.0 Resource Set Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth-lrdd.html">Link relation Type Registrations for OAuth 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_auth.html">OAuth 2.0 User Authentication and Consent For Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_responses.html">OAuth 2.0 Multiple Response Type Encoding Practices - draft 11</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_post.html">OAuth 2.0 Form Post Response Mode - draft 01</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_res.html">OAuth Resoure</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="openid_connect.html">OpenID Connect</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">OpenID Connect Core 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="reg.html">OpenID Connect Dynamic Client Registration 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="discovery.html">OpenID Connect Discovery 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="session.html">OpenID Connect Session Management 1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic.html">OpenID Connect Basic Client Profile 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="implicit.html">OpenID Connect Implicit Client Implementer&#8217;s Guide 1.0 - draft 14</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="standard.html">OpenID Connect Standard 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">OpenID Connect Messages 1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="uma_core.html">User-Managed Access (UMA) Profile of OAuth 2.0 : draft09</a></li>
<li class="toctree-l1"><a class="reference internal" href="uma_trust.html">Binding Obligations on User-Managed Access (UMA) Participants</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="jose.html">Terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwa.html">JSON Web Algorithms (JWA) : draft30</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwt.html">JSON Web Token (JWT) : draft22</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws.html">JSON Web Signature (JWS) : draft28</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws_hok.html">Holder-of-Key JSON Web Signature (JWS)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">JSON Web Encryption (JWE)(draft30)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwk.html">JSON Web Key (JWK) : draft30</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws_js.html">JSON Web Signature JSON Serialization (JWS-JS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwe_js.html">JSON Web Encryption JSON Serialization (JWE-JS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jose_usecase.html">Use Cases and Requirements for JSON Object Signing and Encryption (JOSE)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hostmeta.html">Web Host Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="webfinger.html">WebFinger</a></li>
<li class="toctree-l1"><a class="reference internal" href="swd.html">Simple Web Discovery (SWD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="acct.html">The &#8216;acct&#8217; URI Scheme</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rfc3394.html">RFC3394:Advanced Encryption Standard (AES) Key Wrap Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="nist-sp-800-59a.html">NIST SP 800-56A:Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="nist-sp-800-63.html">Electronic Authentication Guideline</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="backplane.html">Backplane</a></li>
<li class="toctree-l1"><a class="reference internal" href="backplane.html#backplane-2-0">Backplane 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="lrdd.html">LRDD: Link-based Resource Descriptor Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="revoke.html">Token Revocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="poco.html">Portable Contacts 1.0 Draft C</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Terms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="saml.html">SAML</a></li>
<li class="toctree-l1"><a class="reference internal" href="xacml.html">XACML</a></li>
<li class="toctree-l1"><a class="reference internal" href="shibboleth.html">Shibboleth</a></li>
<li class="toctree-l1"><a class="reference internal" href="SamlHokProfile.html">SAML V2.0 Holder-of-Key Assertion Profile Version 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="SamlHokWebSsoProfile.html">SAML V2.0 Holder-of-Key Web Browser SSO Profile Version 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="wss_saml_token_profile.html">Web Services Security SAML Token Profile Version 1.1.1</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scim_rest.html">Simple Cloud Identity Management: Protocol 1.0 (REST API 1.0)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="active_directory.html">Active Directory &amp; Connect</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO/TBD</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource.html">Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion.html">Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="signed_nonce.html">Decoupling Identity and Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="adtech.html">AdTech</a></li>
<li class="toctree-l1"><a class="reference internal" href="technight_9.html">Technight #9</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="well-known.html">RFC5783: Defining Well-Known Uniform Resource Identifiers (URIs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rfc5988.html">RFC5988:Web Linking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="impl_id_token.html">ID Token:Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="impl_jws.html">JOSE JWS:Implementation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">JSON Web Encryption (JWE)(draft30)</a><ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#introduction">1.  Introduction</a></li>
<li><a class="reference internal" href="#terminology">2. Terminology</a></li>
<li><a class="reference internal" href="#json-web-encryption-jwe-overview">3. JSON Web Encryption (JWE) Overview</a><ul>
<li><a class="reference internal" href="#jwe-compact-serialization-overview">3.1.  JWE Compact Serialization Overview</a></li>
<li><a class="reference internal" href="#jwe-json-serialization-overview">3.2.  JWE JSON Serialization Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jwe-header">4.  JWE Header</a><ul>
<li><a class="reference internal" href="#reserved-header-parameter-names">4.1. Reserved Header Parameter Names</a><ul>
<li><a class="reference internal" href="#alg-algorithm-header-parameter">4.1.1. &#8220;alg&#8221; (Algorithm) Header Parameter</a></li>
<li><a class="reference internal" href="#enc-encryption-algorithm-header-parameter">4.1.2. &#8220;enc&#8221; (Encryption Algorithm) Header Parameter</a></li>
<li><a class="reference internal" href="#zip-compression-algorithm-header-parameter">4.1.3.  &#8220;zip&#8221; (Compression Algorithm) Header Parameter</a></li>
<li><a class="reference internal" href="#jku-jwk-set-url-header-parameter">4.1.4. &#8220;jku&#8221; (JWK Set URL) Header Parameter</a></li>
<li><a class="reference internal" href="#jwk-json-web-key-header-parameter">4.1.5. &#8220;jwk&#8221; (JSON Web Key) Header Parameter</a></li>
<li><a class="reference internal" href="#id1">4.1.6. &#8220;jwk&#8221; (JSON Web Key) Header Parameter</a></li>
<li><a class="reference internal" href="#x5u-x-509-url-header-parameter">4.1.7. &#8220;x5u&#8221; (X.509 URL) Header Parameter</a></li>
<li><a class="reference internal" href="#x5c-x-509-certificate-chain-header-parameter">4.1.8.  &#8220;x5c&#8221; (X.509 Certificate Chain) Header Parameter</a></li>
<li><a class="reference internal" href="#x5t-x-509-certificate-sha-1-thumbprint-header-parameter">4.1.9.  &#8220;x5t&#8221; (X.509 Certificate SHA-1 Thumbprint) Header Parameter</a></li>
<li><a class="reference internal" href="#x5t-s256-x-509-certificate-sha-256-thumbprint-header-parameter">4.1.10.  &#8220;x5t#S256&#8221; (X.509 Certificate SHA-256 Thumbprint) Header Parameter</a></li>
<li><a class="reference internal" href="#typ-type-header-parameter">4.1.11. &#8220;typ&#8221; (Type) Header Parameter</a></li>
<li><a class="reference internal" href="#cty-content-type-header-parameter">4.1.12. &#8220;cty&#8221; (Content Type) Header Parameter</a></li>
<li><a class="reference internal" href="#crit-critical-header-parameter">4.1.13. &#8220;crit&#8221; (Critical) Header Parameter</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#producing-and-consuming-jwes">5.  Producing and Consuming JWEs</a><ul>
<li><a class="reference internal" href="#message-encryption">5.1.  Message Encryption</a></li>
<li><a class="reference internal" href="#message-decryption">5.2.  Message Decryption</a></li>
<li><a class="reference internal" href="#string-comparison-rules">5.3.  String Comparison Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#encrypting-jwes-with-cryptographic-algorithms">6. Encrypting JWEs with Cryptographic Algorithms</a><ul>
<li><a class="reference internal" href="#cmk-encryption">6.1. CMK Encryption</a></li>
</ul>
</li>
<li><a class="reference internal" href="#serializations">7.  Serializations</a><ul>
<li><a class="reference internal" href="#jwe-compact-serialization">7.1.  JWE Compact Serialization</a></li>
<li><a class="reference internal" href="#jwe-json-serialization">7.2.  JWE JSON Serialization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#composition">8.  Composition</a></li>
<li><a class="reference internal" href="#references">9. References</a><ul>
<li><a class="reference internal" href="#normative-references">9.1. Normative References</a></li>
<li><a class="reference internal" href="#informative-references">9.2. Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iana-considerations">10.  IANA Considerations</a><ul>
<li><a class="reference internal" href="#json-web-signature-and-encryption-header-parameters-registration">10.1.  JSON Web Signature and Encryption Header Parameters Registration</a><ul>
<li><a class="reference internal" href="#registry-contents">10.1.1.  Registry Contents</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations">11.  Security Considerations</a><ul>
<li><a class="reference internal" href="#using-matching-algorithm-strengths">11.1.  Using Matching Algorithm Strengths</a></li>
<li><a class="reference internal" href="#adaptive-chosen-ciphertext-attacks">11.1.  Adaptive Chosen-Ciphertext Attacks</a></li>
<li><a class="reference internal" href="#timing-attacks">11.2.  Timing Attacks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jwe-12">12.  References</a><ul>
<li><a class="reference internal" href="#jwe-12-1">12.1.  Normative References</a></li>
<li><a class="reference internal" href="#jwe-12-2">12.2.  Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jwe-13">13. References</a><ul>
<li><a class="reference internal" href="#jwe-13-1">13.1. Normative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-a-jwe-examples">Appendix A. JWE Examples</a><ul>
<li><a class="reference internal" href="#a-1-example-jwe-using-rsaes-oaep-and-aes-gcm">A.1. Example JWE using RSAES OAEP and AES GCM</a><ul>
<li><a class="reference internal" href="#a-1-1-jwe-header">A.1.1. JWE Header</a></li>
<li><a class="reference internal" href="#a-1-2-content-encryption-key-cek">A.1.2.  Content Encryption Key (CEK)</a></li>
<li><a class="reference internal" href="#a-1-3-key-encryption">A.1.3.  Key Encryption</a></li>
<li><a class="reference internal" href="#a-1-4-initialization-vector">A.1.4.  Initialization Vector</a></li>
<li><a class="reference internal" href="#a-1-5-additional-authenticated-data">A.1.5.  Additional Authenticated Data</a></li>
<li><a class="reference internal" href="#a-1-6-content-encryption">A.1.6.  Content Encryption</a></li>
<li><a class="reference internal" href="#a-1-7-complete-representation">A.1.7.  Complete Representation</a></li>
<li><a class="reference internal" href="#a-1-8-validation">A.1.8.  Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-2-example-jwe-using-rsaes-pkcs1-v1-5-and-aes-128-cbc-hmac-sha-256">A.2. Example JWE using RSAES-PKCS1-V1_5 and AES_128_CBC_HMAC_SHA_256</a><ul>
<li><a class="reference internal" href="#a-2-1-jwe-header">A.2.1. JWE Header</a></li>
<li><a class="reference internal" href="#a-2-2-content-encryption-key-cek">A.2.2.  Content Encryption Key (CEK)</a></li>
<li><a class="reference internal" href="#a-2-3-key-encryption">A.2.3.  Key Encryption</a></li>
<li><a class="reference internal" href="#a-2-4-initialization-vector">A.2.4.  Initialization Vector</a></li>
<li><a class="reference internal" href="#a-2-5-additional-authenticated-data">A.2.5.  Additional Authenticated Data</a></li>
<li><a class="reference internal" href="#a-2-6-content-encryption">A.2.6.  Content Encryption</a></li>
<li><a class="reference internal" href="#a-2-7-complete-representation">A.2.7.  Complete Representation</a></li>
<li><a class="reference internal" href="#a-2-8-validation">A.2.8.  Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-3-example-jwe-using-aes-key-wrap-and-aes-128-cbc-hmac-sha-256">A.3.  Example JWE using AES Key Wrap and AES_128_CBC_HMAC_SHA_256</a><ul>
<li><a class="reference internal" href="#a-3-1-jwe-header">A.3.1.  JWE Header</a></li>
<li><a class="reference internal" href="#a-3-2-content-encryption-key-cek">A.3.2.  Content Encryption Key (CEK)</a></li>
<li><a class="reference internal" href="#a-3-3-key-encryption">A.3.3.  Key Encryption</a><ul>
<li><a class="reference internal" href="#python">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-3-4-initialization-vector">A.3.4.  Initialization Vector</a><ul>
<li><a class="reference internal" href="#id10">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-3-5-additional-authenticated-data">A.3.5.  Additional Authenticated Data</a><ul>
<li><a class="reference internal" href="#id11">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-3-6-content-encryption">A.3.6.  Content Encryption</a></li>
<li><a class="reference internal" href="#a-3-7-complete-representation">A.3.7.  Complete Representation</a></li>
<li><a class="reference internal" href="#a-3-8-validation">A.3.8.  Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-4-example-jwe-using-jwe-json-serialization">A.4.  Example JWE using JWE JSON Serialization</a><ul>
<li><a class="reference internal" href="#a-4-1-jwe-per-recipient-unprotected-headers">A.4.1.  JWE Per-Recipient Unprotected Headers</a></li>
<li><a class="reference internal" href="#a-4-2-jwe-protected-header">A.4.2.  JWE Protected Header</a></li>
<li><a class="reference internal" href="#a-4-3-jwe-unprotected-header">A.4.3.  JWE Unprotected Header</a></li>
<li><a class="reference internal" href="#a-4-4-complete-jwe-header-values">A.4.4.  Complete JWE Header Values</a></li>
<li><a class="reference internal" href="#a-4-5-additional-authenticated-data">A.4.5.  Additional Authenticated Data</a></li>
<li><a class="reference internal" href="#a-4-6-content-encryption">A.4.6.  Content Encryption</a></li>
<li><a class="reference internal" href="#a-4-7-complete-jwe-json-serialization-representation">A.4.7.  Complete JWE JSON Serialization Representation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-b-example-aes-128-cbc-hmac-sha-256-computation">Appendix B.  Example AES_128_CBC_HMAC_SHA_256 Computation</a><ul>
<li><a class="reference internal" href="#b-1-extract-mac-key-and-enc-key-from-key">B.1. Extract MAC_KEY and ENC_KEY from Key</a><ul>
<li><a class="reference internal" href="#id12">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-2-encrypt-plaintext-to-create-ciphertext">B.2.  Encrypt Plaintext to Create Ciphertext</a><ul>
<li><a class="reference internal" href="#id13">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-3-64-bit-big-endian-representation-of-aad-length">B.3. 64 Bit Big Endian Representation of AAD Length</a><ul>
<li><a class="reference internal" href="#id14">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-4-initialization-vector-value">B.4. Initialization Vector Value</a></li>
<li><a class="reference internal" href="#b-5-create-input-to-hmac-computation">B.5. Create Input to HMAC Computation</a><ul>
<li><a class="reference internal" href="#id15">python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-6-compute-hmac-value">B.6. Compute HMAC Value</a><ul>
<li><a class="reference internal" href="#id16">python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-7-truncate-hmac-value-to-create-authentication-tag">B.7. Truncate HMAC Value to Create Authentication Tag</a><ul>
<li><a class="reference internal" href="#id17">Python</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li><a href="jws_hok.html"
         title="Previous Chapter: Holder-of-Key JSON Web Signature (JWS)">&laquo; Holder-of-Key JS...</a></li>
  <li><a href="jwk.html"
         title="Next Chapter: JSON Web Key (JWK) : draft30">JSON Web Key (JW... &raquo;</a></li>
              
            
            
            
            
              <li>
<div id="sourcelink">
  <a href="sources/jwe.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="json-web-encryption-jwe-draft30">
<span id="jwe-head"></span><h1>JSON Web Encryption (JWE)(draft30)<a class="headerlink" href="#json-web-encryption-jwe-draft30" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-30">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-30</a></li>
<li>Security Considerations</li>
</ul>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id18">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id19">1.  Introduction</a></li>
<li><a class="reference internal" href="#terminology" id="id20">2. Terminology</a></li>
<li><a class="reference internal" href="#json-web-encryption-jwe-overview" id="id21">3. JSON Web Encryption (JWE) Overview</a><ul>
<li><a class="reference internal" href="#jwe-compact-serialization-overview" id="id22">3.1.  JWE Compact Serialization Overview</a></li>
<li><a class="reference internal" href="#jwe-json-serialization-overview" id="id23">3.2.  JWE JSON Serialization Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jwe-header" id="id24">4.  JWE Header</a><ul>
<li><a class="reference internal" href="#reserved-header-parameter-names" id="id25">4.1. Reserved Header Parameter Names</a><ul>
<li><a class="reference internal" href="#alg-algorithm-header-parameter" id="id26">4.1.1. &#8220;alg&#8221; (Algorithm) Header Parameter</a></li>
<li><a class="reference internal" href="#enc-encryption-algorithm-header-parameter" id="id27">4.1.2. &#8220;enc&#8221; (Encryption Algorithm) Header Parameter</a></li>
<li><a class="reference internal" href="#zip-compression-algorithm-header-parameter" id="id28">4.1.3.  &#8220;zip&#8221; (Compression Algorithm) Header Parameter</a></li>
<li><a class="reference internal" href="#jku-jwk-set-url-header-parameter" id="id29">4.1.4. &#8220;jku&#8221; (JWK Set URL) Header Parameter</a></li>
<li><a class="reference internal" href="#jwk-json-web-key-header-parameter" id="id30">4.1.5. &#8220;jwk&#8221; (JSON Web Key) Header Parameter</a></li>
<li><a class="reference internal" href="#id1" id="id31">4.1.6. &#8220;jwk&#8221; (JSON Web Key) Header Parameter</a></li>
<li><a class="reference internal" href="#x5u-x-509-url-header-parameter" id="id32">4.1.7. &#8220;x5u&#8221; (X.509 URL) Header Parameter</a></li>
<li><a class="reference internal" href="#x5c-x-509-certificate-chain-header-parameter" id="id33">4.1.8.  &#8220;x5c&#8221; (X.509 Certificate Chain) Header Parameter</a></li>
<li><a class="reference internal" href="#x5t-x-509-certificate-sha-1-thumbprint-header-parameter" id="id34">4.1.9.  &#8220;x5t&#8221; (X.509 Certificate SHA-1 Thumbprint) Header Parameter</a></li>
<li><a class="reference internal" href="#x5t-s256-x-509-certificate-sha-256-thumbprint-header-parameter" id="id35">4.1.10.  &#8220;x5t#S256&#8221; (X.509 Certificate SHA-256 Thumbprint) Header Parameter</a></li>
<li><a class="reference internal" href="#typ-type-header-parameter" id="id36">4.1.11. &#8220;typ&#8221; (Type) Header Parameter</a></li>
<li><a class="reference internal" href="#cty-content-type-header-parameter" id="id37">4.1.12. &#8220;cty&#8221; (Content Type) Header Parameter</a></li>
<li><a class="reference internal" href="#crit-critical-header-parameter" id="id38">4.1.13. &#8220;crit&#8221; (Critical) Header Parameter</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#producing-and-consuming-jwes" id="id39">5.  Producing and Consuming JWEs</a><ul>
<li><a class="reference internal" href="#message-encryption" id="id40">5.1.  Message Encryption</a></li>
<li><a class="reference internal" href="#message-decryption" id="id41">5.2.  Message Decryption</a></li>
<li><a class="reference internal" href="#string-comparison-rules" id="id42">5.3.  String Comparison Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#encrypting-jwes-with-cryptographic-algorithms" id="id43">6. Encrypting JWEs with Cryptographic Algorithms</a><ul>
<li><a class="reference internal" href="#cmk-encryption" id="id44">6.1. CMK Encryption</a></li>
</ul>
</li>
<li><a class="reference internal" href="#serializations" id="id45">7.  Serializations</a><ul>
<li><a class="reference internal" href="#jwe-compact-serialization" id="id46">7.1.  JWE Compact Serialization</a></li>
<li><a class="reference internal" href="#jwe-json-serialization" id="id47">7.2.  JWE JSON Serialization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#composition" id="id48">8.  Composition</a></li>
<li><a class="reference internal" href="#references" id="id49">9. References</a><ul>
<li><a class="reference internal" href="#normative-references" id="id50">9.1. Normative References</a></li>
<li><a class="reference internal" href="#informative-references" id="id51">9.2. Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iana-considerations" id="id52">10.  IANA Considerations</a><ul>
<li><a class="reference internal" href="#json-web-signature-and-encryption-header-parameters-registration" id="id53">10.1.  JSON Web Signature and Encryption Header Parameters Registration</a><ul>
<li><a class="reference internal" href="#registry-contents" id="id54">10.1.1.  Registry Contents</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations" id="id55">11.  Security Considerations</a><ul>
<li><a class="reference internal" href="#using-matching-algorithm-strengths" id="id56">11.1.  Using Matching Algorithm Strengths</a></li>
<li><a class="reference internal" href="#adaptive-chosen-ciphertext-attacks" id="id57">11.1.  Adaptive Chosen-Ciphertext Attacks</a></li>
<li><a class="reference internal" href="#timing-attacks" id="id58">11.2.  Timing Attacks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jwe-12" id="id59">12.  References</a><ul>
<li><a class="reference internal" href="#jwe-12-1" id="id60">12.1.  Normative References</a></li>
<li><a class="reference internal" href="#jwe-12-2" id="id61">12.2.  Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jwe-13" id="id62">13. References</a><ul>
<li><a class="reference internal" href="#jwe-13-1" id="id63">13.1. Normative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-a-jwe-examples" id="id64">Appendix A. JWE Examples</a><ul>
<li><a class="reference internal" href="#a-1-example-jwe-using-rsaes-oaep-and-aes-gcm" id="id65">A.1. Example JWE using RSAES OAEP and AES GCM</a><ul>
<li><a class="reference internal" href="#a-1-1-jwe-header" id="id66">A.1.1. JWE Header</a></li>
<li><a class="reference internal" href="#a-1-2-content-encryption-key-cek" id="id67">A.1.2.  Content Encryption Key (CEK)</a></li>
<li><a class="reference internal" href="#a-1-3-key-encryption" id="id68">A.1.3.  Key Encryption</a></li>
<li><a class="reference internal" href="#a-1-4-initialization-vector" id="id69">A.1.4.  Initialization Vector</a></li>
<li><a class="reference internal" href="#a-1-5-additional-authenticated-data" id="id70">A.1.5.  Additional Authenticated Data</a></li>
<li><a class="reference internal" href="#a-1-6-content-encryption" id="id71">A.1.6.  Content Encryption</a></li>
<li><a class="reference internal" href="#a-1-7-complete-representation" id="id72">A.1.7.  Complete Representation</a></li>
<li><a class="reference internal" href="#a-1-8-validation" id="id73">A.1.8.  Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-2-example-jwe-using-rsaes-pkcs1-v1-5-and-aes-128-cbc-hmac-sha-256" id="id74">A.2. Example JWE using RSAES-PKCS1-V1_5 and AES_128_CBC_HMAC_SHA_256</a><ul>
<li><a class="reference internal" href="#a-2-1-jwe-header" id="id75">A.2.1. JWE Header</a></li>
<li><a class="reference internal" href="#a-2-2-content-encryption-key-cek" id="id76">A.2.2.  Content Encryption Key (CEK)</a></li>
<li><a class="reference internal" href="#a-2-3-key-encryption" id="id77">A.2.3.  Key Encryption</a></li>
<li><a class="reference internal" href="#a-2-4-initialization-vector" id="id78">A.2.4.  Initialization Vector</a></li>
<li><a class="reference internal" href="#a-2-5-additional-authenticated-data" id="id79">A.2.5.  Additional Authenticated Data</a></li>
<li><a class="reference internal" href="#a-2-6-content-encryption" id="id80">A.2.6.  Content Encryption</a></li>
<li><a class="reference internal" href="#a-2-7-complete-representation" id="id81">A.2.7.  Complete Representation</a></li>
<li><a class="reference internal" href="#a-2-8-validation" id="id82">A.2.8.  Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-3-example-jwe-using-aes-key-wrap-and-aes-128-cbc-hmac-sha-256" id="id83">A.3.  Example JWE using AES Key Wrap and AES_128_CBC_HMAC_SHA_256</a><ul>
<li><a class="reference internal" href="#a-3-1-jwe-header" id="id84">A.3.1.  JWE Header</a></li>
<li><a class="reference internal" href="#a-3-2-content-encryption-key-cek" id="id85">A.3.2.  Content Encryption Key (CEK)</a></li>
<li><a class="reference internal" href="#a-3-3-key-encryption" id="id86">A.3.3.  Key Encryption</a><ul>
<li><a class="reference internal" href="#python" id="id87">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-3-4-initialization-vector" id="id88">A.3.4.  Initialization Vector</a><ul>
<li><a class="reference internal" href="#id10" id="id89">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-3-5-additional-authenticated-data" id="id90">A.3.5.  Additional Authenticated Data</a><ul>
<li><a class="reference internal" href="#id11" id="id91">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-3-6-content-encryption" id="id92">A.3.6.  Content Encryption</a></li>
<li><a class="reference internal" href="#a-3-7-complete-representation" id="id93">A.3.7.  Complete Representation</a></li>
<li><a class="reference internal" href="#a-3-8-validation" id="id94">A.3.8.  Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-4-example-jwe-using-jwe-json-serialization" id="id95">A.4.  Example JWE using JWE JSON Serialization</a><ul>
<li><a class="reference internal" href="#a-4-1-jwe-per-recipient-unprotected-headers" id="id96">A.4.1.  JWE Per-Recipient Unprotected Headers</a></li>
<li><a class="reference internal" href="#a-4-2-jwe-protected-header" id="id97">A.4.2.  JWE Protected Header</a></li>
<li><a class="reference internal" href="#a-4-3-jwe-unprotected-header" id="id98">A.4.3.  JWE Unprotected Header</a></li>
<li><a class="reference internal" href="#a-4-4-complete-jwe-header-values" id="id99">A.4.4.  Complete JWE Header Values</a></li>
<li><a class="reference internal" href="#a-4-5-additional-authenticated-data" id="id100">A.4.5.  Additional Authenticated Data</a></li>
<li><a class="reference internal" href="#a-4-6-content-encryption" id="id101">A.4.6.  Content Encryption</a></li>
<li><a class="reference internal" href="#a-4-7-complete-jwe-json-serialization-representation" id="id102">A.4.7.  Complete JWE JSON Serialization Representation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-b-example-aes-128-cbc-hmac-sha-256-computation" id="id103">Appendix B.  Example AES_128_CBC_HMAC_SHA_256 Computation</a><ul>
<li><a class="reference internal" href="#b-1-extract-mac-key-and-enc-key-from-key" id="id104">B.1. Extract MAC_KEY and ENC_KEY from Key</a><ul>
<li><a class="reference internal" href="#id12" id="id105">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-2-encrypt-plaintext-to-create-ciphertext" id="id106">B.2.  Encrypt Plaintext to Create Ciphertext</a><ul>
<li><a class="reference internal" href="#id13" id="id107">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-3-64-bit-big-endian-representation-of-aad-length" id="id108">B.3. 64 Bit Big Endian Representation of AAD Length</a><ul>
<li><a class="reference internal" href="#id14" id="id109">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-4-initialization-vector-value" id="id110">B.4. Initialization Vector Value</a></li>
<li><a class="reference internal" href="#b-5-create-input-to-hmac-computation" id="id111">B.5. Create Input to HMAC Computation</a><ul>
<li><a class="reference internal" href="#id15" id="id112">python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-6-compute-hmac-value" id="id113">B.6. Compute HMAC Value</a><ul>
<li><a class="reference internal" href="#id16" id="id114">python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-7-truncate-hmac-value-to-create-authentication-tag" id="id115">B.7. Truncate HMAC Value to Create Authentication Tag</a><ul>
<li><a class="reference internal" href="#id17" id="id116">Python</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="abstract">
<span id="jwe-abstract"></span><h2><a class="toc-backref" href="#id18">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>JSON Web Encryption (JWE) is a means of representing encrypted content
using JSON data structures.
Related signature capabilities are described
in the separate JSON Web Signature (<a class="reference internal" href="messages.html#term-jws"><em class="xref std std-term">JWS</em></a>) specification.</p>
<p>(v.01)</p>
<blockquote>
<div>JSON Web Encryption (JWE) represents encrypted content</div></blockquote>
<p>using JavaScript Object Notation (JSON) based data structures.</p>
<p>Cryptographic algorithms and identifiers for use with this
specification are described in the separate JSON Web Algorithms (JWA) <a class="reference internal" href="jwa.html"><em>specification</em></a>
and IANA registries defined by that specification.</p>
<p>Related digital signature and MAC capabilities are described in the
separate JSON Web Signature (JWS) <a class="reference internal" href="jws.html"><em>specification</em></a>.</p>
<p>(draft 16)</p>
</div>
<div class="section" id="introduction">
<span id="jwe-1"></span><h2><a class="toc-backref" href="#id19">1.  Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>JSON Web Encryption (JWE) is a compact encryption format intended for
space constrained environments such as HTTP Authorization headers and URI query parameters.
It represents this content using JavaScript Object Notation (JSON) <a class="reference internal" href="oauth_meta.html#term-rfc4627"><em class="xref std std-term">[RFC4627]</em></a> based data structures.
The JWE cryptographic mechanisms encrypt and provide integrity protection for
arbitrary sequences of bytes.</p>
<p>Cryptographic algorithms and identifiers for use with this specification are described
in the separate JSON Web Algorithms (<a class="reference internal" href="jwa.html"><em>JWA</em></a>) <a class="reference internal" href="#term-jwa"><em class="xref std std-term">[JWA]</em></a> specification.
Related digital signature and MAC capabilities are described in the separate JSON Web Signature (<a class="reference internal" href="jws.html"><em>JWS</em></a>) <a class="reference internal" href="#term-76"><em class="xref std std-term">[JWS]</em></a> specification.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>draft 08, <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-1">http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-1</a></li>
</ul>
</div>
</div>
<div class="section" id="terminology">
<span id="jwe-2"></span><h2><a class="toc-backref" href="#id20">2. Terminology</a><a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<dl class="glossary docutils">
<dt id="term-json-web-encryption-jwe">JSON Web Encryption (JWE)</dt>
<dd>A data structure representing an encrypted
message.  The structure represents five values: the JWE Header,
the JWE Encrypted Key, the JWE Initialization Vector, the JWE
Ciphertext, and the JWE Authentication Tag.</dd>
<dt id="term-authenticated-encryption-with-associated-data-aead">Authenticated Encryption with Associated Data (AEAD)</dt>
<dd><p class="first">An AEAD algorithm is one that encrypts the Plaintext,
allows Additional Authenticated Data to be specified,
and provides an integrated content integrity check
over the Ciphertext and Additional Authenticated Data.</p>
<p>AEAD algorithms accept two inputs,
the Plaintext and the <em class="xref std std-term">Additional Authenticated Data</em> value,
and produce two outputs,
the Ciphertext and the Authentication Tag value.</p>
<p class="last">AES Galois/Counter Mode (GCM) is one such algorithm.</p>
</dd>
<dt id="term-plaintext">Plaintext</dt>
<dd>The sequence of octets to be encrypted &#8211; a.k.a., the
message.  The plaintext can contain an arbitrary sequence of
octets.</dd>
<dt id="term-ciphertext">Ciphertext</dt>
<dd>An encrypted representation of the Plaintext.</dd>
<dt id="term-additional-authenticated-data-aad">Additional Authenticated Data (AAD)</dt>
<dd>An input to an AEAD operation
that is integrity protected but not encrypted.</dd>
<dt id="term-authentication-tag">Authentication Tag</dt>
<dd>An output of an AEAD operation that ensures the
integrity of the Ciphertext and the Additional Authenticated Data.
Note that some algorithms may not use an Authentication Tag, in
which case this value is the empty octet sequence.</dd>
<dt id="term-content-encryption-key-cek">Content Encryption Key (CEK)</dt>
<dd>A symmetric key for the AEAD algorithm
used to encrypt the Plaintext for the recipient to produce the
Ciphertext and the Authentication Tag.</dd>
<dt id="term-json-text-object">JSON Text Object</dt>
<dd>A UTF-8 [RFC3629] encoded text string representing
a JSON object; the syntax of JSON objects is defined in Section
2.2 of [RFC4627].</dd>
<dt id="term-jwe-header">JWE Header</dt>
<dd><p class="first">A JSON Text Object
(or JSON Text Objects, when using the JWE JSON Serialization)
that describes the encryption operations
applied to create the <a class="reference internal" href="#term-34"><em class="xref std std-term">JWE Encrypted Key</em></a>, the <a class="reference internal" href="#term-37"><em class="xref std std-term">JWE Ciphertext</em></a>, and
the <a class="reference internal" href="#term-38"><em class="xref std std-term">JWE Authentication Tag</em></a>.</p>
<p class="last">The members of the JWE Header object(s) are Header Parameters.</p>
</dd>
<dt id="term-jwe-encrypted-key">JWE Encrypted Key</dt>
<dd>The result of encrypting the Content Encryption
Key (CEK) with the intended recipient&#8217;s key using the specified
algorithm.  Note that for some algorithms, the JWE Encrypted Key
value is specified as being the empty octet sequence.</dd>
<dt id="term-jwe-initialization-vector">JWE Initialization Vector</dt>
<dd>A sequence of octets containing the
Initialization Vector used when encrypting the Plaintext.  Note
that some algorithms may not use an Initialization Vector, in
which case this value is the empty octet sequence.</dd>
<dt id="term-jwe-ciphertext">JWE Ciphertext</dt>
<dd>A sequence of octets containing the Ciphertext for a
JWE.</dd>
<dt id="term-jwe-authentication-tag">JWE Authentication Tag</dt>
<dd>A sequence of octets containing the
Authentication Tag for a JWE.</dd>
<dt id="term-jwe-protected-header">JWE Protected Header</dt>
<dd>A JSON Text Object that contains the portion of
the JWE Header that is integrity protected.  For the JWE Compact
Serialization, this comprises the entire JWE Header.  For the JWE
JSON Serialization, this is one component of the JWE Header.</dd>
<dt id="term-header-parameter">Header Parameter</dt>
<dd>A name/value pair that is member of the JWE Header.</dd>
<dt id="term-15">Header Parameter</dt>
<dd>Name  The name of a member of the JWE Header.</dd>
<dt id="term-header-parameter-value">Header Parameter Value</dt>
<dd>The value of a member of the JWE Header.</dd>
<dt id="term-base64url-encoding">Base64url Encoding</dt>
<dd>The URL- and filename-safe Base64 encoding
described in RFC 4648 [RFC4648], Section 5, with the (non URL-
safe) &#8216;=&#8217; padding characters omitted, as permitted by Section 3.2.
(See Appendix C of [JWS] for notes on implementing base64url
encoding without padding.)</dd>
<dt id="term-encoded-jwe-header">Encoded JWE Header</dt>
<dd>Base64url encoding of the <a class="reference internal" href="#term-39"><em class="xref std std-term">JWE Protected Header</em></a>.</dd>
<dt id="term-encoded-jwe-encrypted-key">Encoded JWE Encrypted Key</dt>
<dd>Base64url encoding of the JWE Encrypted
Key.</dd>
<dt id="term-encoded-jwe-initialization-vector">Encoded JWE Initialization Vector</dt>
<dd>Base64url encoding of the JWE
Initialization Vector.</dd>
<dt id="term-encoded-jwe-ciphertext">Encoded JWE Ciphertext</dt>
<dd>Base64url encoding of the JWE Ciphertext.</dd>
<dt id="term-encoded-jwe-authentication-tag">Encoded JWE Authentication Tag</dt>
<dd>Base64url encoding of the JWE
Authentication Tag.</dd>
<dt id="term-jwe-compact-serialization">JWE Compact Serialization</dt>
<dd>A representation of the JWE as the
concatenation of the Encoded JWE Header, the Encoded JWE Encrypted
Key, the Encoded JWE Initialization Vector, the Encoded JWE
Ciphertext, and the Encoded JWE Authentication Tag in that order,
with the five strings being separated by four period (&#8216;.&#8217;)
characters.  This representation is compact and URL-safe.</dd>
<dt id="term-jwe-json-serialization">JWE JSON Serialization</dt>
<dd>A representation of the JWE as a JSON
structure containing JWE Header, Encoded JWE Encrypted Key,
Encoded JWE Initialization Vector, Encoded JWE Ciphertext, and
Encoded JWE Authentication Tag values.  Unlike the JWE Compact
Serialization, the JWE JSON Serialization enables the same content
to be encrypted to multiple parties.  This representation is
neither compact nor URL-safe.</dd>
<dt id="term-collision-resistant-namespace">Collision Resistant Namespace</dt>
<dd>A namespace that allows names to be
allocated in a manner such that they are highly unlikely to
collide with other names.  For instance, collision resistance can
be achieved through administrative delegation of portions of the
namespace or through use of collision-resistant name allocation
functions.  Examples of Collision Resistant Namespaces include:
Domain Names, Object Identifiers (OIDs) as defined in the ITU-T
X.660 and X.670 Recommendation series, and Universally Unique
IDentifiers (UUIDs) [RFC4122].  When using an administratively
delegated namespace, the definer of a name needs to take
reasonable precautions to ensure they are in control of the
portion of the namespace they use to define the name.</dd>
<dt id="term-stringoruri">StringOrURI</dt>
<dd>A JSON string value, with the additional requirement
that while arbitrary string values MAY be used, any value
containing a &#8221;:&#8221; character MUST be a URI [RFC3986].  StringOrURI
values are compared as case-sensitive strings with no
transformations or canonicalizations applied.</dd>
<dt id="term-key-management-mode">Key Management Mode</dt>
<dd>A method of determining the Content Encryption
Key (CEK) value to use.  Each algorithm used for determining the
CEK value uses a specific Key Management Mode.  Key Management
Modes employed by this specification are Key Encryption, Key
Wrapping, Direct Key Agreement, Key Agreement with Key Wrapping,
and Direct Encryption.</dd>
<dt id="term-key-encryption">Key Encryption</dt>
<dd>A Key Management Mode in which the Content Encryption
Key (CEK) value is encrypted to the intended recipient using an
asymmetric encryption algorithm.</dd>
<dt id="term-key-wrapping">Key Wrapping</dt>
<dd>A Key Management Mode in which the Content Encryption
Key (CEK) value is encrypted to the intended recipient using a
symmetric key wrapping algorithm.</dd>
<dt id="term-direct-key-agreement">Direct Key Agreement</dt>
<dd>A Key Management Mode in which a key agreement
algorithm is used to agree upon the Content Encryption Key (CEK)
value.</dd>
<dt id="term-key-agreement-with-key-wrapping">Key Agreement with Key Wrapping</dt>
<dd>A Key Management Mode in which a key
agreement algorithm is used to agree upon a symmetric key used to
encrypt the Content Encryption Key (CEK) value to the intended
recipient using a symmetric key wrapping algorithm.</dd>
<dt id="term-direct-encryption">Direct Encryption</dt>
<dd>A Key Management Mode in which the Content
Encryption Key (CEK) value used is the secret symmetric key value
shared between the parties.</dd>
</dl>
<p>( <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-13#section-2">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-13#section-2</a> )</p>
</div>
<div class="section" id="json-web-encryption-jwe-overview">
<span id="jwe-3"></span><h2><a class="toc-backref" href="#id21">3. JSON Web Encryption (JWE) Overview</a><a class="headerlink" href="#json-web-encryption-jwe-overview" title="Permalink to this headline">¶</a></h2>
<p>JWE represents encrypted content using JSON data structures and
base64url encoding.  A JWE represents these logical values:</p>
<dl class="glossary docutils">
<dt id="term-jose-header">JOSE Header</dt>
<dd>JSON object containing the parameters describing the cryptographic
operations and parameters employed.  For a JWE object, the JOSE
Header members are the union of the members of the JWE Protected
Header, the JWE Shared Unprotected Header, and the JWE Per-
Recipient Unprotected Header, as described below.</dd>
<dt id="term-34">JWE Encrypted Key</dt>
<dd>Encrypted Content Encryption Key (CEK) value.</dd>
<dt id="term-35">JWE Initialization Vector</dt>
<dd>Initialization Vector value used when encrypting the plaintext.</dd>
<dt id="term-jwe-aad">JWE AAD</dt>
<dd>Additional value to be integrity protected by the authenticated
encryption operation.</dd>
<dt id="term-37">JWE Ciphertext</dt>
<dd>Ciphertext value resulting from authenticated encryption of the
plaintext with additional authenticated data.</dd>
<dt id="term-38">JWE Authentication Tag</dt>
<dd>Authentication Tag value resulting from authenticated encryption
of the plaintext with additional authenticated data.</dd>
</dl>
<p>For a JWE object, the JOSE Header represents the combination of these
logical values:</p>
<dl class="glossary docutils">
<dt id="term-39">JWE Protected Header</dt>
<dd>JSON object that contains the Header Parameters that are integrity
protected by the authenticated encryption operation.  These
parameters apply to all recipients of the JWE.</dd>
<dt id="term-jwe-shared-unprotected-header">JWE Shared Unprotected Header</dt>
<dd>JSON object that contains the Header Parameters that apply to all
recipients of the JWE that are not integrity protected.</dd>
<dt id="term-jwe-per-recipient-unprotected-header">JWE Per-Recipient Unprotected Header</dt>
<dd>JSON object that contains Header Parameters that apply to a single
recipient of the JWE.  These Header Parameter values are not
integrity protected.</dd>
</dl>
<p>JWE utilizes authenticated encryption to ensure the confidentiality
and integrity of the Plaintext and the integrity of the JWE Protected
Header and the JWE AAD.</p>
<p>This document defines two serializations for JWE objects: a compact,
URL-safe serialization called the JWE Compact Serialization and a
JSON serialization called the JWE JSON Serialization.  In both
serializations, the JWE Protected Header, JWE Encrypted Key, JWE
Initialization Vector, JWE Ciphertext, and JWE Authentication Tag are
base64url encoded for transmission, since JSON lacks a way to
directly represent octet sequences.  When present, the JWE AAD is
also base64url encoded for transmission.</p>
<p>(draft30)</p>
<div class="section" id="jwe-compact-serialization-overview">
<span id="jwe-3-1"></span><h3><a class="toc-backref" href="#id22">3.1.  JWE Compact Serialization Overview</a><a class="headerlink" href="#jwe-compact-serialization-overview" title="Permalink to this headline">¶</a></h3>
<p>In the JWE Compact Serialization, no JWE Shared Unprotected Header or
JWE Per-Recipient Unprotected Header are used.  In this case, the
JOSE Header and the JWE Protected Header are the same.</p>
<p>In the JWE Compact Serialization, a JWE object is represented as the
combination of these five string values,</p>
<blockquote>
<div>BASE64URL(UTF8(JWE Protected Header)),
BASE64URL(JWE Encrypted Key),
BASE64URL(JWE Initialization Vector),
BASE64URL(JWE Ciphertext), and
BASE64URL(JWE Authentication Tag),</div></blockquote>
<p>concatenated in that order, with the five strings being separated by
four period (&#8216;.&#8217;) characters.</p>
<p>(draft30)</p>
</div>
<div class="section" id="jwe-json-serialization-overview">
<span id="jwe-3-2"></span><h3><a class="toc-backref" href="#id23">3.2.  JWE JSON Serialization Overview</a><a class="headerlink" href="#jwe-json-serialization-overview" title="Permalink to this headline">¶</a></h3>
<p>In the JWE JSON Serialization, one or more of the JWE Protected
Header, JWE Shared Unprotected Header, and JWE Per-Recipient
Unprotected Header MUST be present.  In this case, the members of the
JOSE Header are the combination of the members of the JWE Protected
Header, JWE Shared Unprotected Header, and JWE Per-Recipient
Unprotected Header values that are present.</p>
<p>In the JWE JSON Serialization, a JWE object is represented as the
combination of these eight values,</p>
<blockquote>
<div>BASE64URL(UTF8(JWE Protected Header)),
JWE Shared Unprotected Header,
JWE Per-Recipient Unprotected Header,
BASE64URL(JWE Encrypted Key),
BASE64URL(JWE Initialization Vector),
BASE64URL(JWE Ciphertext),
BASE64URL(JWE Authentication Tag), and
BASE64URL(JWE AAD),</div></blockquote>
<p>with the six base64url encoded result strings and the two unprotected
JSON object values being represented as members within a JSON object.
The inclusion of some of these values is OPTIONAL.  The JWE JSON
Serialization can also encrypt the plaintext to multiple recipients.
See Section 7.2 for more information about the JWE JSON
Serialization.</p>
<p>(draft30)</p>
</div>
</div>
<div class="section" id="jwe-header">
<span id="jwe-4"></span><h2><a class="toc-backref" href="#id24">4.  JWE Header</a><a class="headerlink" href="#jwe-header" title="Permalink to this headline">¶</a></h2>
<p>The members of the JSON object(s) representing the JWE Header
describe the encryption applied to the Plaintext and optionally
additional properties of the JWE.  The Header Parameter names within
the JWE Header MUST be unique; recipients MUST either reject JWEs
with duplicate Header Parameter names or use a JSON parser that
returns only the lexically last duplicate member name, as specified
in Section 15.12 (The JSON Object) of ECMAScript 5.1 [ECMAScript].</p>
<p>Implementations are required to understand the specific Header
Parameters defined by this specification that are designated as &#8220;MUST
be understood&#8221; and process them in the manner defined in this
specification.  All other Header Parameters defined by this
specification that are not so designated MUST be ignored when not
understood.  Unless listed as a critical Header Parameter, per
Section 4.1.13, all Header Parameters not defined by this
specification MUST be ignored when not understood.</p>
<p>There are three classes of Header Parameter names: Registered Header
Parameter names, Public Header Parameter names, and Private Header
Parameter names.</p>
<p>(draft21)
(draft27)</p>
<div class="section" id="reserved-header-parameter-names">
<span id="jwe-4-1"></span><h3><a class="toc-backref" href="#id25">4.1. Reserved Header Parameter Names</a><a class="headerlink" href="#reserved-header-parameter-names" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The following Header Parameter names are registered in the IANA JSON
Web Signature and Encryption Header Parameters registry defined in
[JWS], with meanings as defined below.</p>
<p>As indicated by the common registry, JWSs and JWEs share a common
Header Parameter space; when a parameter is used by both
specifications, its usage must be compatible between the
specifications.</p>
</div></blockquote>
<p>(draft21)</p>
<div class="section" id="alg-algorithm-header-parameter">
<span id="jwe-alg"></span><span id="jwe-4-1-1"></span><h4><a class="toc-backref" href="#id26">4.1.1. &#8220;alg&#8221; (Algorithm) Header Parameter</a><a class="headerlink" href="#alg-algorithm-header-parameter" title="Permalink to this headline">¶</a></h4>
<p>This parameter has the same meaning, syntax, and processing rules as
the &#8220;alg&#8221; Header Parameter defined in Section 4.1.1 of [JWS], except
that the Header Parameter identifies the cryptographic algorithm used
to encrypt or determine the value of the Content Encryption Key
(CEK).  The encrypted content is not usable if the &#8220;alg&#8221; value does
not represent a supported algorithm, or if the recipient does not
have a key that can be used with that algorithm.</p>
<p>A list of defined &#8220;alg&#8221; values for this use can be found in the IANA
JSON Web Signature and Encryption Algorithms registry defined in
[JWA]; the initial contents of this registry are the values defined
in <a class="reference internal" href="jwa.html#jwa-4-1"><em>Section 4.1 of the JSON Web Algorithms</em></a> (JWA)
[JWA] specification.</p>
<p>(draft21)</p>
</div>
<div class="section" id="enc-encryption-algorithm-header-parameter">
<span id="jwe-enc"></span><span id="jwe-4-1-2"></span><h4><a class="toc-backref" href="#id27">4.1.2. &#8220;enc&#8221; (Encryption Algorithm) Header Parameter</a><a class="headerlink" href="#enc-encryption-algorithm-header-parameter" title="Permalink to this headline">¶</a></h4>
<p>The &#8220;enc&#8221; (encryption algorithm) Header Parameter identifies the
content encryption algorithm used to encrypt the Plaintext to produce
the Ciphertext.  This algorithm MUST be an AEAD algorithm with a
specified key length.  The recipient MUST reject the JWE if the &#8220;enc&#8221;
value does not represent a supported algorithm. &#8220;enc&#8221; values should
either be registered in the IANA JSON Web Signature and Encryption
Algorithms registry defined in [JWA] or be a value that contains a
Collision-Resistant Name.  The &#8220;enc&#8221; value is a case-sensitive string
containing a StringOrURI value.  This Header Parameter MUST be
present and MUST be understood and processed by implementations.</p>
<p>A list of defined &#8220;enc&#8221; values for this use can be found in the IANA
JSON Web Signature and Encryption Algorithms registry defined in
[JWA]; the initial contents of this registry are the values defined
in <a class="reference internal" href="jwa.html#jwa-5-1"><em>Section 5.1 of the JSON Web Algorithms</em></a>
(JWA) [JWA] specification.</p>
<p>(draft21)</p>
</div>
<div class="section" id="zip-compression-algorithm-header-parameter">
<span id="jwe-zip"></span><span id="jwe-4-1-3"></span><h4><a class="toc-backref" href="#id28">4.1.3.  &#8220;zip&#8221; (Compression Algorithm) Header Parameter</a><a class="headerlink" href="#zip-compression-algorithm-header-parameter" title="Permalink to this headline">¶</a></h4>
<p>The &#8220;zip&#8221; (compression algorithm) applied to the Plaintext before
encryption, if any.  The &#8220;zip&#8221; value defined by this specification
is:</p>
<ul class="simple">
<li>&#8220;DEF&#8221; - Compression with the DEFLATE [RFC1951] algorithm</li>
</ul>
<p>Other values MAY be used.  Compression algorithm values can be
registered in the IANA JSON Web Encryption Compression Algorithm
registry defined in [JWA].  The &#8220;zip&#8221; value is a case-sensitive
string.  If no &#8220;zip&#8221; parameter is present, no compression is applied
to the Plaintext before encryption.  This Header Parameter MUST be
integrity protected, and therefore MUST occur only within the JWE
Protected Header, when used.  Use of this Header Parameter is
OPTIONAL.  This Header Parameter MUST be understood and processed by
implementations.</p>
<p>(draft21)</p>
</div>
<div class="section" id="jku-jwk-set-url-header-parameter">
<span id="jwe-jku"></span><span id="jwe-4-1-4"></span><h4><a class="toc-backref" href="#id29">4.1.4. &#8220;jku&#8221; (JWK Set URL) Header Parameter</a><a class="headerlink" href="#jku-jwk-set-url-header-parameter" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This parameter has the same meaning, syntax, and processing rules as
the &#8220;jku&#8221; Header Parameter defined in Section 4.1.2 of [JWS], except
that the JWK Set resource contains the public key to which the JWE
was encrypted; this can be used to determine the private key needed
to decrypt the JWE.</div></blockquote>
<p>(draft21)</p>
</div>
<div class="section" id="jwk-json-web-key-header-parameter">
<span id="jwe-jwk"></span><span id="jwe-4-1-5"></span><h4><a class="toc-backref" href="#id30">4.1.5. &#8220;jwk&#8221; (JSON Web Key) Header Parameter</a><a class="headerlink" href="#jwk-json-web-key-header-parameter" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This parameter has the same meaning, syntax, and processing rules as
the &#8220;jwk&#8221; Header Parameter defined in Section 4.1.3 of [JWS], except
that the key is the public key to which the JWE was encrypted; this
can be used to determine the private key needed to decrypt the JWE.</div></blockquote>
<p>(draft21)</p>
</div>
<div class="section" id="id1">
<span id="id2"></span><h4><a class="toc-backref" href="#id31">4.1.6. &#8220;jwk&#8221; (JSON Web Key) Header Parameter</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>The &#8220;jwk&#8221; (JSON Web Key) header parameter is a public key that
corresponds to the key used to encrypt the JWE; this can be used to
determine the private key needed to decrypt the JWE.  This key is
represented as a JSON Web Key [JWK].  Use of this header parameter is
OPTIONAL.</div></blockquote>
</div>
<div class="section" id="x5u-x-509-url-header-parameter">
<span id="jwk-x5u"></span><span id="jwe-4-1-7"></span><h4><a class="toc-backref" href="#id32">4.1.7. &#8220;x5u&#8221; (X.509 URL) Header Parameter</a><a class="headerlink" href="#x5u-x-509-url-header-parameter" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This parameter has the same meaning, syntax, and processing rules as
the &#8220;x5u&#8221; Header Parameter defined in Section 4.1.5 of [JWS], except
that the X.509 public key certificate or certificate chain [RFC5280]
contains the public key to which the JWE was encrypted; this can be
used to determine the private key needed to decrypt the JWE.</div></blockquote>
<p>(draft21)</p>
</div>
<div class="section" id="x5c-x-509-certificate-chain-header-parameter">
<span id="jwe-x5c"></span><span id="jwe-4-1-8"></span><h4><a class="toc-backref" href="#id33">4.1.8.  &#8220;x5c&#8221; (X.509 Certificate Chain) Header Parameter</a><a class="headerlink" href="#x5c-x-509-certificate-chain-header-parameter" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>This parameter has the same meaning, syntax, and processing rules as
the &#8220;x5c&#8221; Header Parameter defined in Section 4.1.6 of [JWS], except
that the X.509 public key certificate or certificate chain [RFC5280]
contains the public key to which the JWE was encrypted; this can be
used to determine the private key needed to decrypt the JWE.</p>
<p>See Appendix B of [JWS] for an example &#8220;x5c&#8221; value.</p>
</div></blockquote>
<p>(draft21)</p>
<span class="target" id="jwe-4-1-9"></span></div>
<div class="section" id="x5t-x-509-certificate-sha-1-thumbprint-header-parameter">
<h4><a class="toc-backref" href="#id34">4.1.9.  &#8220;x5t&#8221; (X.509 Certificate SHA-1 Thumbprint) Header Parameter</a><a class="headerlink" href="#x5t-x-509-certificate-sha-1-thumbprint-header-parameter" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This parameter has the same meaning, syntax, and processing rules as
the &#8220;x5t&#8221; Header Parameter defined in Section 4.1.7 of [JWS], except
that certificate referenced by the thumbprint contains the public key
to which the JWE was encrypted; this can be used to determine the
private key needed to decrypt the JWE.</div></blockquote>
<p>(draft21)</p>
</div>
<div class="section" id="x5t-s256-x-509-certificate-sha-256-thumbprint-header-parameter">
<span id="jwe-4-1-10"></span><h4><a class="toc-backref" href="#id35">4.1.10.  &#8220;x5t#S256&#8221; (X.509 Certificate SHA-256 Thumbprint) Header Parameter</a><a class="headerlink" href="#x5t-s256-x-509-certificate-sha-256-thumbprint-header-parameter" title="Permalink to this headline">¶</a></h4>
<p>This parameter has the same meaning, syntax, and processing rules as
the &#8220;x5t#S256&#8221; Header Parameter defined in Section 4.1.8 of [JWS],
except that the certificate referenced by the thumbprint contains the
public key to which the JWE was encrypted; this can be used to
determine the private key needed to decrypt the JWE.</p>
<p>(draft27)</p>
</div>
<div class="section" id="typ-type-header-parameter">
<span id="jwe-typ"></span><span id="jwe-4-1-11"></span><h4><a class="toc-backref" href="#id36">4.1.11. &#8220;typ&#8221; (Type) Header Parameter</a><a class="headerlink" href="#typ-type-header-parameter" title="Permalink to this headline">¶</a></h4>
<p>This parameter has the same meaning, syntax, and processing rules
as the &#8220;typ&#8221; Header Parameter defined in <a class="reference internal" href="jws.html#jws-4-1-9"><em>Section 4.1.9</em></a> of <a class="reference internal" href="#term-76"><em class="xref std std-term">[JWS]</em></a>,
except that the type is of this complete JWE object.</p>
<p>(draft27)</p>
</div>
<div class="section" id="cty-content-type-header-parameter">
<span id="jwe-cty"></span><span id="jwe-4-1-12"></span><h4><a class="toc-backref" href="#id37">4.1.12. &#8220;cty&#8221; (Content Type) Header Parameter</a><a class="headerlink" href="#cty-content-type-header-parameter" title="Permalink to this headline">¶</a></h4>
<p>This parameter has the same meaning, syntax, and processing rules as
the &#8220;cty&#8221; Header Parameter defined in Section 4.1.10 of [JWS], except
that the type is of the secured content (the payload).</p>
<p>(draft27)</p>
</div>
<div class="section" id="crit-critical-header-parameter">
<span id="jwe-crit"></span><span id="jwe-4-1-13"></span><h4><a class="toc-backref" href="#id38">4.1.13. &#8220;crit&#8221; (Critical) Header Parameter</a><a class="headerlink" href="#crit-critical-header-parameter" title="Permalink to this headline">¶</a></h4>
<p>This parameter has the same meaning, syntax, and processing rules as
the &#8220;crit&#8221; Header Parameter defined in Section 4.1.11 of [JWS],
except that JWE Header Parameters are being referred to, rather than
JWS Header Parameters.</p>
<p>(draft27)</p>
</div>
</div>
</div>
<div class="section" id="producing-and-consuming-jwes">
<span id="jwe-5"></span><h2><a class="toc-backref" href="#id39">5.  Producing and Consuming JWEs</a><a class="headerlink" href="#producing-and-consuming-jwes" title="Permalink to this headline">¶</a></h2>
<p>(draft27)</p>
<div class="section" id="message-encryption">
<span id="jwe-5-1"></span><h3><a class="toc-backref" href="#id40">5.1.  Message Encryption</a><a class="headerlink" href="#message-encryption" title="Permalink to this headline">¶</a></h3>
<p>The message encryption process is as follows.  The order of the steps
is not significant in cases where there are no dependencies between
the inputs and outputs of the steps.</p>
<ol class="arabic">
<li><p class="first">Determine the Key Management Mode employed by the algorithm used
to determine the Content Encryption Key (CEK) value.  (This is
the algorithm recorded in the &#8220;alg&#8221; (algorithm) Header Parameter
of the resulting JWE.)</p>
</li>
<li><p class="first">When Key Wrapping, Key Encryption, or Key Agreement with Key
Wrapping are employed, generate a random Content Encryption Key
(CEK) value.  See RFC 4086 [RFC4086] for considerations on
generating random values.  The CEK MUST have a length equal to
that required for the content encryption algorithm.</p>
</li>
<li><p class="first">When Direct Key Agreement or Key Agreement with Key Wrapping are
employed, use the key agreement algorithm to compute the value
of the agreed upon key.  When Direct Key Agreement is employed,
let the Content Encryption Key (CEK) be the agreed upon key.
When Key Agreement with Key Wrapping is employed, the agreed
upon key will be used to wrap the CEK.</p>
</li>
<li><p class="first">When Key Wrapping, Key Encryption, or Key Agreement with Key
Wrapping are employed, encrypt the CEK to the recipient and let
the result be the JWE Encrypted Key.</p>
</li>
<li><p class="first">When Direct Key Agreement or Direct Encryption are employed, let
the JWE Encrypted Key be the empty octet sequence.</p>
</li>
<li><p class="first">When Direct Encryption is employed, let the Content Encryption
Key (CEK) be the shared symmetric key.</p>
</li>
<li><p class="first">Compute the encoded key value BASE64URL(JWE Encrypted Key).</p>
</li>
<li><p class="first">If the JWE JSON Serialization is being used, repeat this process
(steps 1-7) for each recipient.</p>
</li>
<li><p class="first">Generate a random JWE Initialization Vector of the correct size
for the content encryption algorithm (if required for the
algorithm); otherwise, let the JWE Initialization Vector be the
empty octet sequence.</p>
</li>
<li><p class="first">Compute the encoded initialization vector value BASE64URL(JWE
Initialization Vector).</p>
</li>
<li><p class="first">If a &#8220;zip&#8221; parameter was included, compress the Plaintext using
the specified compression algorithm.</p>
</li>
<li><p class="first">Serialize the (compressed) Plaintext into an octet sequence M.</p>
</li>
<li><p class="first">Create the JSON object(s) containing the desired set of Header
Parameters, which together comprise the JWE Header: the JWE
Protected Header, and if the JWE JSON Serialization is being
used, the JWE Shared Unprotected Header and the JWE Per-
Recipient Unprotected Header.</p>
</li>
<li><p class="first">Compute the Encoded Protected Header value BASE64URL(UTF8(JWE
Protected Header)).  If the JWE Protected Header is not present
(which can only happen when using the JWE JSON Serialization and
no &#8220;protected&#8221; member is present), let this value be the empty
string.</p>
</li>
<li><p class="first">Let the Additional Authenticated Data encryption parameter be
ASCII(Encoded Protected Header).</p>
<p>However if a JWE AAD value is present
(which can only be the case when using the JWE JSON Serialization),
instead let the Additional Authenticated Data
encryption parameter be
ASCII(Encoded Protected Header || &#8216;.&#8217; ||
BASE64URL(JWE AAD)).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">aad が指定されたら、 AAD = protected + aad</p>
</div>
</li>
<li><p class="first">Encrypt M using the CEK, the JWE Initialization Vector, and the
Additional Authenticated Data value using the specified content
encryption algorithm to create the JWE Ciphertext value and the
JWE Authentication Tag (which is the Authentication Tag output
from the encryption operation).</p>
</li>
<li><p class="first">Compute the encoded ciphertext value BASE64URL(JWE Ciphertext).</p>
</li>
<li><p class="first">Compute the encoded authentication tag value BASE64URL(JWE
Authentication Tag).</p>
</li>
<li><p class="first">The five encoded values are used in both the JWE Compact
Serialization and the JWE JSON Serialization representations.</p>
</li>
<li><p class="first">If a JWE AAD value is present, compute the encoded AAD value
BASE64URL(JWE AAD).</p>
</li>
<li><p class="first">Create the desired serialized output.  The Compact Serialization
of this result is the string BASE64URL(UTF8(JWE Protected
Header)) || &#8216;.&#8217; || BASE64URL(JWE Encrypted Key) || &#8216;.&#8217; ||
BASE64URL(JWE Initialization Vector) || &#8216;.&#8217; || BASE64URL(JWE
Ciphertext) || &#8216;.&#8217; || BASE64URL(JWE Authentication Tag).  The
JWE JSON Serialization is described in Section 7.2.</p>
</li>
</ol>
<p>(draft23)</p>
</div>
<div class="section" id="message-decryption">
<span id="jwe-5-2"></span><h3><a class="toc-backref" href="#id41">5.2.  Message Decryption</a><a class="headerlink" href="#message-decryption" title="Permalink to this headline">¶</a></h3>
<p>The message decryption process is the reverse of the encryption
process.  The order of the steps is not significant in cases where
there are no dependencies between the inputs and outputs of the
steps.  If any of these steps fails, the encrypted content cannot be
validated.</p>
<p>It is an application decision which recipients&#8217; encrypted content
must successfully validate for the JWE to be accepted.  In some
cases, encrypted content for all recipients must successfully
validate or the JWE will be rejected.  In other cases, only the
encrypted content for a single recipient needs to be successfully
validated.  However, in all cases, the encrypted content for at least
one recipient MUST successfully validate or the JWE MUST be rejected.</p>
<ol class="arabic">
<li><p class="first">Parse the JWE representation to extract the serialized values
for the components of the JWE.  When using the JWE Compact
Serialization, these components are the base64url encoded
representations of the JWE Protected Header, the JWE Encrypted
Key, the JWE Initialization Vector, the JWE Ciphertext, and the
JWE Authentication Tag, and when using the JWE JSON
Serialization, these components also include the base64url
encoded representation of the JWE AAD and the unencoded JWE
Shared Unprotected Header and JWE Per-Recipient Unprotected
Header values.  When using the JWE Compact Serialization, the
JWE Protected Header, the JWE Encrypted Key, the JWE
Initialization Vector, the JWE Ciphertext, and the JWE
Authentication Tag are represented as base64url encoded values
in that order, separated by four period (&#8216;.&#8217;) characters.  The
JWE JSON Serialization is described in Section 7.2.</p>
<p>JWE JSON Serialization is described in Section 7.2.</p>
</li>
<li><p class="first">The encoded representations of the JWE Protected Header, the JWE
Encrypted Key, the JWE Initialization Vector, the JWE
Ciphertext, the JWE Authentication Tag, and the JWE AAD MUST be
successfully base64url decoded following the restriction that no
padding characters have been used.</p>
</li>
<li><p class="first">The octet sequence resulting from decoding the encoded
JWE Protected Header MUST be a UTF-8 encoded representation of
a completely valid JSON object conforming to RFC 7159 [RFC7159],
which is the JWE Protected Header.</p>
</li>
<li><p class="first">If using the JWE Compact Serialization, let the JOSE Header be
the JWE Protected Header.  Otherwise, when using the JWE JSON
Serialization, let the JOSE Header be the union of the members
of the JWE Protected Header, the JWE Shared Unprotected Header
and the corresponding JWE Per-Recipient Unprotected Header, all
of which must be completely valid JSON objects.</p>
</li>
<li><p class="first">The resulting JWE Header MUST NOT contain duplicate Header
Parameter names.  When using the JWE JSON Serialization, this
restriction includes that the same Header Parameter name also
UST NOT occur in distinct JSON object values that together
comprise the JWE Header.</p>
</li>
<li><p class="first">Verify that the implementation understands and can process all
fields that it is required to support, whether required by this
specification, by the algorithms being used, or by the &#8220;crit&#8221;
Header Parameter value, and that the values of those parameters
are also understood and supported.</p>
</li>
<li><p class="first">Determine the Key Management Mode employed by the algorithm
specified by the &#8220;alg&#8221; (algorithm) Header Parameter.</p>
</li>
<li><p class="first">Verify that the JWE uses a key known to the recipient.</p>
</li>
<li><p class="first">When Direct Key Agreement or Key Agreement with Key Wrapping are
employed, use the key agreement algorithm to compute the value
of the agreed upon key.  When Direct Key Agreement is employed,
let the Content Encryption Key (CEK) be the agreed upon key.
When Key Agreement with Key Wrapping is employed, the agreed
upon key will be used to decrypt the JWE Encrypted Key.</p>
</li>
<li><p class="first">When Key Wrapping, Key Encryption, or Key Agreement
with Key Wrapping are employed,
decrypt the JWE Encrypted Key
to produce the Content Encryption Key (CEK).</p>
<p>The CEK MUST have a length equal to that required
for the content encryption algorithm.</p>
<p>Note that when there are multiple recipients,
each recipient will only be able decrypt any JWE Encrypted Key values
that were encrypted to a key in that recipient&#8217;s possession.</p>
<p>It is therefore normal to only be able to decrypt
one of the per-recipient JWE Encrypted Key values
to obtain the CEK value.</p>
<p>Also, see <a class="reference internal" href="#jwe-11-2"><em>Section 11.2</em></a> for security considerations
on mitigating timing attacks.</p>
</li>
<li><p class="first">When Direct Key Agreement or Direct Encryption are employed,
verify that the JWE Encrypted Key value is empty octet sequence.</p>
</li>
<li><p class="first">When Direct Encryption is employed, let the Content Encryption
Key (CEK) be the shared symmetric key.</p>
</li>
<li><p class="first">If the JWE JSON Serialization is being used, repeat this process
(steps 4-12) for each recipient contained in the representation
until the CEK value has been determined.</p>
</li>
<li><p class="first">Compute the Encoded Protected Header value BASE64URL(UTF8(JWE
Protected Header)).  If the JWE Protected Header is not present
(which can only happen when using the JWE JSON Serialization and
no &#8220;protected&#8221; member is present), let this value be the empty
string.</p>
</li>
<li><p class="first">Let the Additional Authenticated Data encryption parameter be
ASCII(Encoded Protected Header).  However if a JWE AAD value is
present (which can only be the case when using the JWE JSON
Serialization), instead let the Additional Authenticated Data
encryption parameter be ASCII(Encoded Protected Header || &#8216;.&#8217; ||
BASE64URL(JWE AAD)).</p>
</li>
<li><p class="first">Decrypt the JWE Ciphertext using the CEK, the JWE Initialization
Vector, the Additional Authenticated Data value, and the JWE
Authentication Tag (which is the Authentication Tag input to the
calculation) using the specified content encryption algorithm,
returning the decrypted plaintext and validating the JWE
Authentication Tag in the manner specified for the algorithm,
rejecting the input without emitting any decrypted output if the
JWE Authentication Tag is incorrect.</p>
</li>
<li><p class="first">If a &#8220;zip&#8221; parameter was included, uncompress the decrypted
plaintext using the specified compression algorithm.</p>
</li>
<li><p class="first">If all the previous steps succeeded, output the resulting
Plaintext.</p>
</li>
</ol>
<p>(draft23)</p>
</div>
<div class="section" id="string-comparison-rules">
<span id="jwe-5-3"></span><h3><a class="toc-backref" href="#id42">5.3.  String Comparison Rules</a><a class="headerlink" href="#string-comparison-rules" title="Permalink to this headline">¶</a></h3>
<p>The string comparison rules for this specification
are the same as those defined in <a class="reference internal" href="jws.html#jws-5-3"><em>Section 5.3</em></a> of <a class="reference internal" href="#term-76"><em class="xref std std-term">[JWS]</em></a>.</p>
<p>(draft23)</p>
</div>
</div>
<div class="section" id="encrypting-jwes-with-cryptographic-algorithms">
<span id="jwe-6"></span><h2><a class="toc-backref" href="#id43">6. Encrypting JWEs with Cryptographic Algorithms</a><a class="headerlink" href="#encrypting-jwes-with-cryptographic-algorithms" title="Permalink to this headline">¶</a></h2>
<p>JWE uses cryptographic algorithms
to encrypt the Plaintext and the Content Encryption Key (CMK)
and to provide integrity protection
for the JWE Header, JWE Encrypted Key, and JWE Ciphertext.</p>
<p>The JSON Web Algorithms (JWA) [JWA] specification specifies
a set of cryptographic algorithms and identifiers to be used
with this specification and defines registries for additional such algorithms.</p>
<p>Specifically,
Section 4.1 specifies a set of &#8220;<a class="reference internal" href="#jwe-alg"><em>alg</em></a>&#8221;
(algorithm) header parameter values and
Section 4.2 specifies a set of &#8220;<a class="reference internal" href="#jwe-enc"><em>enc</em></a>&#8221;
(encryption method) header parameter values
intended for use this specification.</p>
<p>It also describes the semantics and operations that are specific to these algorithms.</p>
<p>Public keys employed for encryption can be identified
using the Header Parameter methods described in Section 4.1 or
can be distributed using methods that are outside the scope of this specification.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference external" href="http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-6">http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-6</a></li>
</ul>
</div>
<div class="section" id="cmk-encryption">
<span id="jwk-cmk"></span><span id="jwe-6-1"></span><h3><a class="toc-backref" href="#id44">6.1. CMK Encryption</a><a class="headerlink" href="#cmk-encryption" title="Permalink to this headline">¶</a></h3>
<p>JWE supports three forms of Content Master Key (CMK) encryption:</p>
<blockquote>
<div><ul class="simple">
<li>Asymmetric encryption under the recipient&#8217;s <strong>public key</strong>.</li>
<li>Symmetric encryption under <strong>a key shared</strong> between the sender and receiver.</li>
<li>Symmetric encryption under <strong>a key agreed upon</strong> between the sender and receiver.</li>
</ul>
</div></blockquote>
<p>See the algorithms registered for &#8220;<a class="reference internal" href="#jwe-enc"><em>enc</em></a>&#8221; usage
in the IANA JSON Web Signature and Encryption Algorithms registry [JWA]
and <a class="reference internal" href="jwa.html#jwa-4-1"><em>Section 4.1 of the JSON Web Algorithms</em></a> (JWA) [JWA] specification
for lists of encryption algorithms that can be used for CMK encryption.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>draft 08,http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-6.1</li>
</ul>
</div>
</div>
</div>
<div class="section" id="serializations">
<span id="jwe-serialization"></span><span id="jwe-7"></span><h2><a class="toc-backref" href="#id45">7.  Serializations</a><a class="headerlink" href="#serializations" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>JWE objects use one of two serializations, the JWE Compact
Serialization or the JWE JSON Serialization.  Applications using this
specification need to specify what serialization and serialization
features are used for that application.  For instance, applications
might specify that only the JWE JSON Serialization is used, that only
JWE JSON Serialization support for a single recipient is used, or
that support for multiple recipients is used.  JWE implementations
only need to implement the features needed for the applications they
are designed to support.</div></blockquote>
<p>(draft21)</p>
<div class="section" id="jwe-compact-serialization">
<span id="jwe-7-1"></span><span id="id3"></span><h3><a class="toc-backref" href="#id46">7.1.  JWE Compact Serialization</a><a class="headerlink" href="#jwe-compact-serialization" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">HEADER.KEY.IV.CIPHER_TEXT.TAG</p>
</div>
<p>The JWE Compact Serialization represents encrypted content
as a compact URL-safe string.</p>
<p>This string is
BASE64URL(UTF8(JWE Protected Header)) || &#8216;.&#8217; ||
BASE64URL(JWE Encrypted Key) || &#8216;.&#8217; ||
BASE64URL(JWE Initialization Vector) || &#8216;.&#8217; ||
BASE64URL(JWE Ciphertext) || &#8216;.&#8217; ||
BASE64URL(JWE Authentication Tag).</p>
<p>Only one recipient is supported by the JWE Compact Serialization
and it provides no syntax to represent JWE Shared Unprotected Header,
JWE Per-Recipient Unprotected Header,
or JWE AAD values.</p>
<p>(draft21)</p>
</div>
<div class="section" id="jwe-json-serialization">
<span id="jwe-7-2"></span><span id="id4"></span><h3><a class="toc-backref" href="#id47">7.2.  JWE JSON Serialization</a><a class="headerlink" href="#jwe-json-serialization" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>複数のRecipientに同じCEKで暗号化されたCipherTextを送る</li>
<li>CEKは各Recipient毎に別のキーで暗号化されているので、
他のRecipientのキーを復元する事はできない。</li>
</ul>
</div>
<p>The JWE JSON Serialization represents encrypted content as a JSON
object.  Content using the JWE JSON Serialization can be encrypted to
more than one recipient.  This representation is neither optimized
for compactness nor URL-safe.</p>
<p>The following members are defined for use in top-level JSON objects
used for the JWE JSON Serialization:</p>
<dl class="glossary docutils">
<dt id="term-protected">protected</dt>
<dd>The &#8220;protected&#8221; member MUST be present and contain the
value BASE64URL(UTF8(JWE Protected Header)) when the JWE Protected
Header value is non-empty; otherwise, it MUST be absent.  These
Header Parameter values are integrity protected.</dd>
<dt id="term-unprotected">unprotected</dt>
<dd>The &#8220;unprotected&#8221; member MUST be present and contain the
value JWE Shared Unprotected Header when the JWE Shared
Unprotected Header value is non-empty; otherwise, it MUST be
absent.  This value is represented as an unencoded JSON object,
rather than as a string.  These Header Parameter values are not
integrity protected.</dd>
<dt id="term-iv">iv</dt>
<dd>The &#8220;iv&#8221; member MUST be present and contain the value
BASE64URL(JWE Initialization Vector) when the JWE Initialization
Vector value is non-empty; otherwise, it MUST be absent.</dd>
<dt id="term-aad">aad</dt>
<dd>The &#8220;aad&#8221; member MUST be present and contain the value
BASE64URL(JWE AAD)) when the JWE AAD value is non-empty;
otherwise, it MUST be absent.  A JWE AAD value can be included to
supply a base64url encoded value to be integrity protected but not
encrypted.</dd>
<dt id="term-46">ciphertext</dt>
<dd>The &#8220;ciphertext&#8221; member MUST be present and contain the
value BASE64URL(JWE Ciphertext).</dd>
<dt id="term-tag">tag</dt>
<dd>The &#8220;tag&#8221; member MUST be present and contain the value
BASE64URL(JWE Authentication Tag) when the JWE Authentication Tag
value is non-empty; otherwise, it MUST be absent.</dd>
<dt id="term-recipients">recipients</dt>
<dd>The &#8220;recipients&#8221; member value MUST be an array of JSON
objects.  Each object contains information specific to a single
recipient.  This member MUST be present, even if the array
elements contain only the empty JSON object &#8220;{}&#8221; (which can happen
when all Header Parameter values are shared between all recipients
and when no encrypted key is used, such as when doing Direct
Encryption).</dd>
</dl>
<p>The following members are defined for use in the JSON objects that
are elements of the &#8220;recipients&#8221; array:</p>
<dl class="glossary docutils">
<dt id="term-header">header</dt>
<dd><p class="first">The &#8220;header&#8221; member MUST be present and contain
the value JWE Per-Recipient Unprotected Header
when the JWE Per-Recipient Unprotected Header value is non-empty;
otherwise, it MUST be absent.</p>
<p>This value is represented as an unencoded JSON object,
rather than as a string.</p>
<p class="last">These Header Parameter values are <strong>not</strong> integrity protected.</p>
</dd>
<dt id="term-encrypted-key">encrypted_key</dt>
<dd><p class="first">The &#8220;encrypted_key&#8221; member MUST be present and contain
the value BASE64URL(JWE Encrypted Key)
when the JWE Encrypted Key value is non-empty;
otherwise, it MUST be absent.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>これを各々のrecipentが復号してCEKとする</li>
<li>復号されたCEKは全てのrecipentsで同一(ciphertextが同じ、ということ)</li>
</ul>
</div>
</dd>
</dl>
<p>At least one of the &#8220;header&#8221;, &#8220;protected&#8221;, and &#8220;unprotected&#8221; members
MUST be present so that &#8220;alg&#8221; and &#8220;enc&#8221; Header Parameter values are
conveyed for each recipient computation.</p>
<p>Additional members can be present in both the JSON objects defined
above; if not understood by implementations encountering them, they
MUST be ignored.</p>
<p>Some Header Parameters, including the &#8220;alg&#8221; parameter, can be shared
among all recipient computations.  Header Parameters in the JWE
Protected Header and JWE Shared Unprotected Header values are shared
among all recipients.</p>
<p>The Header Parameter values used when creating or validating per-
recipient Ciphertext and Authentication Tag values are the union of
the three sets of Header Parameter values that may be present: (1)
the JWE Protected Header represented in the &#8220;protected&#8221; member, (2)
the JWE Shared Unprotected Header represented in the &#8220;unprotected&#8221;
member, and (3) the JWE Per-Recipient Unprotected Header represented
in the &#8220;header&#8221; member of the recipient&#8217;s array element.  The union
of these sets of Header Parameters comprises the JWE Header.  The
Header Parameter names in the three locations MUST be disjoint.</p>
<p>Each JWE Encrypted Key value is computed using the parameters of the
corresponding JWE Header value in the same manner as for the JWE
Compact Serialization.  This has the desirable property that each JWE
Encrypted Key value in the &#8220;recipients&#8221; array is identical to the
value that would have been computed for the same parameter in the JWE
Compact Serialization.  Likewise, the JWE Ciphertext and JWE
Authentication Tag values match those produced for the JWE Compact
Serialization, provided that the JWE Protected Header value (which
represents the integrity-protected Header Parameter values) matches
that used in the JWE Compact Serialization.</p>
<p>All recipients use the same JWE Protected Header, JWE Initialization
Vector, JWE Ciphertext, and JWE Authentication Tag values, when
present, resulting in potentially significant space savings if the
message is large.  Therefore, all Header Parameters that specify the
treatment of the Plaintext value MUST be the same for all recipients.
This primarily means that the &#8220;enc&#8221; (encryption algorithm) Header
Parameter value in the JWE Header for each recipient and any
parameters of that algorithm MUST be the same.</p>
<p>In summary, the syntax of a JWE using the JWE JSON Serialization is
as follows:</p>
<div class="highlight-python"><pre>{"protected":"&lt;integrity-protected shared header contents&gt;",
 "unprotected":&lt;non-integrity-protected shared header contents&gt;,
 "recipients":[
  {"header":&lt;per-recipient unprotected header 1 contents&gt;,
   "encrypted_key":"&lt;encrypted key 1 contents&gt;"},
  ...
  {"header":&lt;per-recipient unprotected header N contents&gt;,
   "encrypted_key":"&lt;encrypted key N contents&gt;"}],
 "aad":"&lt;additional authenticated data contents&gt;",
 "iv":"&lt;initialization vector contents&gt;",
 "ciphertext":"&lt;ciphertext contents&gt;",
 "tag":"&lt;authentication tag contents&gt;"
}</pre>
</div>
<p>See <a class="reference internal" href="#jwe-appendix-a-4"><em>Appendix A.4</em></a> for an example of
computing a JWE using the JWE JSON Serialization.</p>
<p>(draft21)</p>
</div>
</div>
<div class="section" id="composition">
<span id="jwe-8"></span><h2><a class="toc-backref" href="#id48">8.  Composition</a><a class="headerlink" href="#composition" title="Permalink to this headline">¶</a></h2>
<p>This document does not specify a combination signed and encrypted mode.</p>
<p>However, because the contents of a message can be arbitrary,
encryption and data origin authentication can be provided
by recursively encapsulating multiple JWE and JWS messages.</p>
<p>In general,
senders SHOULD sign the message and then encrypt the result
(thus encrypting the signature).
This prevents attacks in which the signature is stripped,
leaving just an encrypted message,
as well as providing privacy for the signer.</p>
<p>(draft 02)</p>
</div>
<div class="section" id="references">
<span id="jwe-9"></span><h2><a class="toc-backref" href="#id49">9. References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>( <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-9">http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-9</a> )</p>
<div class="section" id="normative-references">
<span id="jwe-9-1"></span><h3><a class="toc-backref" href="#id50">9.1. Normative References</a><a class="headerlink" href="#normative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-itu-x690-1994">[ITU.X690.1994]</dt>
<dd>International Telecommunications Union, &#8220;Information
Technology - ASN.1 encoding rules: Specification of Basic
Encoding Rules (BER), Canonical Encoding Rules (CER) and
Distinguished Encoding Rules (DER)&#8221;, ITU-T Recommendation
X.690, 1994.</dd>
<dt id="term-jwa">[JWA]</dt>
<dd>Jones, M., &#8220;JSON Web Algorithms (JWA)&#8221;,
draft-ietf-jose-json-web-algorithms (work in progress),
December 2012.</dd>
<dt id="term-jwk">[JWK]</dt>
<dd>Jones, M., &#8220;JSON Web Key (JWK)&#8221;,
draft-ietf-jose-json-web-key (work in progress),
December 2012.</dd>
<dt id="term-jws">[JWS]</dt>
<dd>Jones, M., Bradley, J., and N. Sakimura, &#8220;JSON Web
Signature (JWS)&#8221;, draft-ietf-jose-json-web-signature (work
in progress), December 2012.</dd>
<dt id="term-rfc1421">[RFC1421]</dt>
<dd>Linn, J., &#8220;Privacy Enhancement for Internet Electronic
Mail: Part I: Message Encryption and Authentication
Procedures&#8221;, RFC 1421, February 1993.</dd>
<dt id="term-rfc1951">[RFC1951]</dt>
<dd>Deutsch, P., &#8220;DEFLATE Compressed Data Format Specification
version 1.3&#8221;, RFC 1951, May 1996.</dd>
<dt id="term-rfc2046">[RFC2046]</dt>
<dd>Freed, N. and N. Borenstein, &#8220;Multipurpose Internet Mail
Extensions (MIME) Part Two: Media Types&#8221;, RFC 2046,
November 1996.</dd>
<dt id="term-rfc2119">[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt id="term-rfc2818">[RFC2818]</dt>
<dd>Rescorla, E., &#8220;HTTP Over TLS&#8221;, RFC 2818, May 2000.</dd>
<dt id="term-rfc3629">[RFC3629]</dt>
<dd>Yergeau, F., &#8220;UTF-8, a transformation format of ISO
10646&#8221;, STD 63, RFC 3629, November 2003.</dd>
<dt id="term-rfc3986">[RFC3986]</dt>
<dd>Berners-Lee, T., Fielding, R., and L. Masinter, &#8220;Uniform
Resource Identifier (URI): Generic Syntax&#8221;, STD 66,
RFC 3986, January 2005.</dd>
<dt id="term-rfc4086">[RFC4086]</dt>
<dd>Eastlake, D., Schiller, J., and S. Crocker, &#8220;Randomness
Requirements for Security&#8221;, BCP 106, RFC 4086, June 2005.</dd>
<dt id="term-rfc4288">[RFC4288]</dt>
<dd>Freed, N. and J. Klensin, &#8220;Media Type Specifications and
Registration Procedures&#8221;, BCP 13, RFC 4288, December 2005.</dd>
<dt id="term-rfc4627">[RFC4627]</dt>
<dd>Crockford, D., &#8220;The application/json Media Type for
JavaScript Object Notation (JSON)&#8221;, RFC 4627, July 2006.</dd>
<dt id="term-rfc4648">[RFC4648]</dt>
<dd>Josefsson, S., &#8220;The Base16, Base32, and Base64 Data
Encodings&#8221;, RFC 4648, October 2006.</dd>
<dt id="term-rfc5246">[RFC5246]</dt>
<dd>Dierks, T. and E. Rescorla, &#8220;The Transport Layer Security
(TLS) Protocol Version 1.2&#8221;, RFC 5246, August 2008.</dd>
<dt id="term-rfc5280">[RFC5280]</dt>
<dd>Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
Housley, R., and W. Polk, &#8220;Internet X.509 Public Key
Infrastructure Certificate and Certificate Revocation List
(CRL) Profile&#8221;, RFC 5280, May 2008.</dd>
<dt id="term-w3c-cr-xmlenc-core1-20120313">[W3C.CR-xmlenc-core1-20120313]</dt>
<dd>Eastlake, D., Reagle, J., Roessler, T., and F. Hirsch,
&#8220;XML Encryption Syntax and Processing Version 1.1&#8221;, World
Wide Web Consortium CR CR-xmlenc-core1-20120313,
March 2012,
&lt;<a class="reference external" href="http://www.w3.org/TR/2012/CR-xmlenc-core1-20120313">http://www.w3.org/TR/2012/CR-xmlenc-core1-20120313</a>&gt;.</dd>
</dl>
<p>( draft 08, <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-9.1">http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-9.1</a> )</p>
</div>
<div class="section" id="informative-references">
<span id="jwe-9-2"></span><h3><a class="toc-backref" href="#id51">9.2. Informative References</a><a class="headerlink" href="#informative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-i-d-rescorla-jsms">[I-D.rescorla-jsms]</dt>
<dd>Rescorla, E. and J. Hildebrand, &#8220;JavaScript Message
Security Format&#8221;, draft-rescorla-jsms-00 (work in
progress), March 2011.</dd>
<dt id="term-jse">[JSE]</dt>
<dd>Bradley, J. and N. Sakimura (editor), &#8220;JSON Simple
Encryption&#8221;, September 2010.</dd>
<dt id="term-jwe-js">[JWE-JS]</dt>
<dd>Jones, M., &#8220;JSON Web Encryption JSON Serialization
(JWE-JS)&#8221;, draft-jones-jose-jwe-json-serialization
(work in progress), December 2012.</dd>
<dt id="term-rfc4122">[RFC4122]</dt>
<dd>Leach, P., Mealling, M., and R. Salz, &#8220;A Universally
Unique IDentifier (UUID) URN Namespace&#8221;, RFC 4122,
July 2005.</dd>
<dt id="term-rfc5652">[RFC5652]</dt>
<dd>Housley, R., &#8220;Cryptographic Message Syntax (CMS)&#8221;, STD 70,
RFC 5652, September 2009.</dd>
</dl>
<p>( draft 08, <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-9.2">http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-08#section-9.2</a> )</p>
</div>
</div>
<div class="section" id="iana-considerations">
<span id="jwe-10"></span><h2><a class="toc-backref" href="#id52">10.  IANA Considerations</a><a class="headerlink" href="#iana-considerations" title="Permalink to this headline">¶</a></h2>
<p>(draft27)</p>
<div class="section" id="json-web-signature-and-encryption-header-parameters-registration">
<span id="jwe-10-1"></span><h3><a class="toc-backref" href="#id53">10.1.  JSON Web Signature and Encryption Header Parameters Registration</a><a class="headerlink" href="#json-web-signature-and-encryption-header-parameters-registration" title="Permalink to this headline">¶</a></h3>
<p>This specification registers the Header Parameter names defined in
Section 4.1 in the IANA JSON Web Signature and Encryption Header
Parameters registry defined in [JWS]</p>
<p>(draft27)</p>
<div class="section" id="registry-contents">
<span id="jwe-10-1-1"></span><h4><a class="toc-backref" href="#id54">10.1.1.  Registry Contents</a><a class="headerlink" href="#registry-contents" title="Permalink to this headline">¶</a></h4>
<p>o  Header Parameter Name: &#8220;alg&#8221;
o  Header Parameter Description: Algorithm
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.1 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;enc&#8221;
o  Header Parameter Description: Encryption Algorithm
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.2 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;zip&#8221;
o  Header Parameter Description: Compression Algorithm
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.3 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;jku&#8221;
o  Header Parameter Description: JWK Set URL
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.4 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;jwk&#8221;
o  Header Parameter Description: JSON Web Key
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification document(s): Section 4.1.5 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;kid&#8221;
o  Header Parameter Description: Key ID
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.6 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;x5u&#8221;
o  Header Parameter Description: X.509 URL
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.7 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;x5c&#8221;
o  Header Parameter Description: X.509 Certificate Chain
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.8 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;x5t&#8221;
o  Header Parameter Description: X.509 Certificate SHA-1 Thumbprint
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.9 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;x5t#S256&#8221;
o  Header Parameter Description: X.509 Certificate SHA-256 Thumbprint
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.10 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;typ&#8221;
o  Header Parameter Description: Type
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.11 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;cty&#8221;
o  Header Parameter Description: Content Type
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.12 of [[ this document ]]</p>
<p>o  Header Parameter Name: &#8220;crit&#8221;
o  Header Parameter Description: Critical
o  Header Parameter Usage Location(s): JWE
o  Change Controller: IESG
o  Specification Document(s): Section 4.1.13 of [[ this document ]]</p>
<p>(draft27)</p>
</div>
</div>
</div>
<div class="section" id="security-considerations">
<span id="jwe-11"></span><h2><a class="toc-backref" href="#id55">11.  Security Considerations</a><a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>All of the security issues that are pertinent to any cryptographic
application must be addressed by JWS/JWE/JWK agents.  Among these
issues are protecting the user&#8217;s asymmetric private and symmetric
secret keys, preventing various attacks, and helping avoid mistakes
such as inadvertently encrypting a message to the wrong recipient.
The entire list of security considerations is beyond the scope of
this document, but some significant considerations are listed here.</p>
<p>All the security considerations in the JWS specification also apply
to this specification.  Likewise, all the security considerations in
XML Encryption 1.1 [W3C.REC-xmlenc-core1-20130411] also apply, other
than those that are XML specific.</p>
<p>(draft30)</p>
<div class="section" id="using-matching-algorithm-strengths">
<span id="jwe-11-1"></span><h3><a class="toc-backref" href="#id56">11.1.  Using Matching Algorithm Strengths</a><a class="headerlink" href="#using-matching-algorithm-strengths" title="Permalink to this headline">¶</a></h3>
<p>Algorithms of matching strengths
should be used together whenever possible.</p>
<p>For instance,
when AES Key Wrap is used with a given key size,
using the same key size is recommended when AES GCM is also used.</p>
<p>(draft28)</p>
</div>
<div class="section" id="adaptive-chosen-ciphertext-attacks">
<span id="jwe-11-2"></span><h3><a class="toc-backref" href="#id57">11.1.  Adaptive Chosen-Ciphertext Attacks</a><a class="headerlink" href="#adaptive-chosen-ciphertext-attacks" title="Permalink to this headline">¶</a></h3>
<p>When decrypting,
particular care must be taken
not to allow the JWE recipient to be used as an oracle
for decrypting messages.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>JWE受信者をオラクルにしては行けない</li>
</ul>
</div>
<p>RFC 3218 [RFC3218] should be consulted for specific countermeasures
to attacks on RSAES-PKCS1-V1_5.</p>
<p>An attacker might modify the contents of the &#8220;alg&#8221; parameter
from &#8220;RSA-OAEP&#8221; to &#8220;RSA1_5&#8221;
in order to generate a formatting error
that can be detected and used to recover the CEK
even if RSAES OAEP was used to encrypt the CEK.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OAEPで作られたJweのalgを PKCS#1.5 に攻撃者が変更</li>
<li>こうすることで、Jweの復号でフォーマットエラー起こして
CEKを復元できるように攻撃できる</li>
<li>OAEP自体はCCA2耐性があるが、もしもPKCS#1.5でも使用するキーが同じだったら
CEKが復元できてしまうかもしれない</li>
</ul>
</div>
<p>It is therefore particularly important
to report all formatting errors to the CEK,
Additional Authenticated Data,
or ciphertext as a single error when the encrypted content is rejected.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>この時にCEK, AAD, 暗号文に関するすべての書式エラーを単一のエラーとして報告する事。</li>
<li>(意味不明)</li>
</ul>
</div>
<p>Additionally,
this type of attack can be prevented by the use of &#8220;key tainting&#8221;.</p>
<p>This method restricts the use of a key to a limited set
of algorithms &#8211; usually one.</p>
<p>This means, for instance,
that if the key is marked as being for &#8220;RSA-OAEP&#8221; only,
any attempt to decrypt a message using the &#8220;RSA1_5&#8221; algorithm
with that key would fail immediately due to invalid use of the key.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>キー用途を１つに制限する(「このキーはOAEPだけで使う」)</li>
<li>用途が違うと使えないので問題を未然に防げる</li>
</ul>
</div>
<p>(draft27)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="simple">
<li><a class="reference external" href="http://wizardbible.org/40/ipusiron.txt">http://wizardbible.org/40/ipusiron.txt</a></li>
</ul>
<p>CCA（選択暗号文攻撃）</p>
<p>暗号化オラクルを利用する前に、
自分自身が選択した暗号文に対応する平文を知ることができる状況における攻撃である。</p>
<p>このように暗号文をクエリーとして受け取り、
平文を返す存在を復号オラクル
Decryption Oracle：DO）という。</p>
<p class="last">つまり、CCA攻撃者は復号オラクルを使ってから（何度も問い合わせ可能）、
暗号化オラクルを利用できる。</p>
</div>
<p>　  CCA2（適応的選択暗号文攻撃）</p>
<blockquote>
<div><p>復号オラクルを利用してから（何度も問い合わせ可能）、
暗号化オラクルを利用し、その後でも復号オラクルを利用できる
何度も問い合わせ可能）状況における攻撃である。</p>
<p>ただし、暗号化オラクルで受け取った暗号文を、
その後で復号オラクルに送信してはいけない。
な ぜならば、もし送信できてしまえば、
敵は明らかにbを特定できまうからである。</p>
</div></blockquote>
</div>
<div class="section" id="timing-attacks">
<span id="jwe-11-3"></span><h3><a class="toc-backref" href="#id58">11.2.  Timing Attacks</a><a class="headerlink" href="#timing-attacks" title="Permalink to this headline">¶</a></h3>
<p>To mitigate the attacks described in RFC 3218 [RFC3218],
the recipient MUST NOT distinguish
between format, padding, and length errors of encrypted keys.</p>
<p>It is strongly recommended,
in the event of receiving an improperly formatted key,
that the receiver substitute a randomly generated CEK
and proceed to the next step,
to mitigate timing attacks.</p>
<p>(draft27)</p>
</div>
</div>
<div class="section" id="jwe-12">
<span id="id5"></span><h2><a class="toc-backref" href="#id59">12.  References</a><a class="headerlink" href="#jwe-12" title="Permalink to this headline">¶</a></h2>
<div class="section" id="jwe-12-1">
<span id="id6"></span><h3><a class="toc-backref" href="#id60">12.1.  Normative References</a><a class="headerlink" href="#jwe-12-1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="docutils">
<dt>[ECMAScript]</dt>
<dd>Ecma International, &#8220;ECMAScript Language Specification,
5.1 Edition&#8221;, ECMA 262, June 2011.</dd>
<dt>[JWA]      Jones, M., &#8220;JSON Web Algorithms (JWA)&#8221;,</dt>
<dd>draft-ietf-jose-json-web-algorithms (work in progress),
June 2014.</dd>
<dt>[JWK]      Jones, M., &#8220;JSON Web Key (JWK)&#8221;,</dt>
<dd>draft-ietf-jose-json-web-key (work in progress),
June 2014.</dd>
<dt>[JWS]      Jones, M., Bradley, J., and N. Sakimura, &#8220;JSON Web</dt>
<dd>Signature (JWS)&#8221;, draft-ietf-jose-json-web-signature (work
in progress), June 2014.</dd>
<dt>[RFC1951]  Deutsch, P., &#8220;DEFLATE Compressed Data Format Specification</dt>
<dd>version 1.3&#8221;, RFC 1951, May 1996.</dd>
<dt>[RFC2119]  Bradner, S., &#8220;Key words for use in RFCs to Indicate</dt>
<dd>Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt>[RFC3629]  Yergeau, F., &#8220;UTF-8, a transformation format of ISO</dt>
<dd>10646&#8221;, STD 63, RFC 3629, November 2003.</dd>
<dt>[RFC5280]  Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,</dt>
<dd>Housley, R., and W. Polk, &#8220;Internet X.509 Public Key
Infrastructure Certificate and Certificate Revocation List
(CRL) Profile&#8221;, RFC 5280, May 2008.</dd>
<dt>[RFC7159]  Bray, T., &#8220;The JavaScript Object Notation (JSON) Data</dt>
<dd>Interchange Format&#8221;, RFC 7159, March 2014.</dd>
<dt>[USASCII]  American National Standards Institute, &#8220;Coded Character</dt>
<dd>Set &#8211; 7-bit American Standard Code for Information
Interchange&#8221;, ANSI X3.4, 1986.</dd>
</dl>
</div></blockquote>
<p>(draft27)</p>
</div>
<div class="section" id="jwe-12-2">
<span id="id7"></span><h3><a class="toc-backref" href="#id61">12.2.  Informative References</a><a class="headerlink" href="#jwe-12-2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="docutils">
<dt>[I-D.mcgrew-aead-aes-cbc-hmac-sha2]</dt>
<dd>McGrew, D., Foley, J., and K. Paterson, &#8220;Authenticated
Encryption with AES-CBC and HMAC-SHA&#8221;,
draft-mcgrew-aead-aes-cbc-hmac-sha2-04 (work in progress),
February 2014.</dd>
<dt>[I-D.rescorla-jsms]</dt>
<dd>Rescorla, E. and J. Hildebrand, &#8220;JavaScript Message
Security Format&#8221;, draft-rescorla-jsms-00 (work in
progress), March 2011.</dd>
<dt>[JSE]      Bradley, J. and N. Sakimura (editor), &#8220;JSON Simple</dt>
<dd>Encryption&#8221;, September 2010.</dd>
<dt>[RFC3218]  Rescorla, E., &#8220;Preventing the Million Message Attack on</dt>
<dd>Cryptographic Message Syntax&#8221;, RFC 3218, January 2002.</dd>
<dt>[RFC4086]  Eastlake, D., Schiller, J., and S. Crocker, &#8220;Randomness</dt>
<dd>Requirements for Security&#8221;, BCP 106, RFC 4086, June 2005.</dd>
<dt>[RFC5652]  Housley, R., &#8220;Cryptographic Message Syntax (CMS)&#8221;, STD 70,</dt>
<dd>RFC 5652, September 2009.</dd>
<dt>[W3C.REC-xmlenc-core1-20130411]</dt>
<dd>Eastlake, D., Reagle, J., Hirsch, F., and T. Roessler,
&#8220;XML Encryption Syntax and Processing Version 1.1&#8221;, World
Wide Web Consortium Recommendation REC-xmlenc-core1-
20130411, April 2013,
&lt;<a class="reference external" href="http://www.w3.org/TR/2013/REC-xmlenc-core1-20130411/">http://www.w3.org/TR/2013/REC-xmlenc-core1-20130411/</a>&gt;.</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="jwe-13">
<span id="id8"></span><h2><a class="toc-backref" href="#id62">13. References</a><a class="headerlink" href="#jwe-13" title="Permalink to this headline">¶</a></h2>
<div class="section" id="jwe-13-1">
<span id="id9"></span><h3><a class="toc-backref" href="#id63">13.1. Normative References</a><a class="headerlink" href="#jwe-13-1" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-fips-197">[FIPS-197]</dt>
<dd>National Institute of Standards and Technology (NIST),
&#8220;Advanced Encryption Standard (AES)&#8221;, FIPS PUB 197,
November 2001.</dd>
<dt id="term-75">[JWK]</dt>
<dd>Jones, M., &#8220;JSON Web Key (JWK)&#8221;, October 2011.</dd>
<dt id="term-76">[JWS]</dt>
<dd>Jones, M., Balfanz, D., Bradley, J., Goland, Y., Panzer,
J., Sakimura, N., and P. Tarjan, &#8220;JSON Web Signature
(JWS)&#8221;, October 2011.</dd>
<dt id="term-nist-800-38a">[NIST-800-38A]</dt>
<dd>National Institute of Standards and Technology (NIST),
&#8220;Recommendation for Block Cipher Modes of Operation&#8221;,
NIST PUB 800-38A, December 2001.</dd>
<dt id="term-nist-800-38d">[NIST-800-38D]</dt>
<dd>National Institute of Standards and Technology (NIST),
&#8220;Recommendation for Block Cipher Modes of Operation:
Galois/Counter Mode (GCM) and GMAC&#8221;, NIST PUB 800-38D,
December 2001.</dd>
<dt id="term-nist-800-56a">[NIST-800-56A]</dt>
<dd>National Institute of Standards and Technology (NIST),
&#8220;Recommendation for Pair-Wise Key Establishment Schemes
Using Discrete Logarithm Cryptography (Revised)&#8221;, NIST PUB
800-56A, March 2007.</dd>
<dt id="term-80">[RFC1421]</dt>
<dd>Linn, J., &#8220;Privacy Enhancement for Internet Electronic
Mail: Part I: Message Encryption and Authentication
Procedures&#8221;, RFC 1421, February 1993.</dd>
<dt id="term-rfc1738">[RFC1738]</dt>
<dd>Berners-Lee, T., Masinter, L., and M. McCahill, &#8220;Uniform
Resource Locators (URL)&#8221;, RFC 1738, December 1994.</dd>
<dt id="term-rfc1952">[RFC1952]</dt>
<dd>Deutsch, P., Gailly, J-L., Adler, M., Deutsch, L., and G.
Randers-Pehrson, &#8220;GZIP file format specification version
4.3&#8221;, RFC 1952, May 1996.</dd>
<dt id="term-83">[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt id="term-84">[RFC2818]</dt>
<dd>Rescorla, E., &#8220;HTTP Over TLS&#8221;, RFC 2818, May 2000.</dd>
<dt id="term-rfc3394">[RFC3394]</dt>
<dd>Schaad, J. and R. Housley, &#8220;Advanced Encryption Standard
(AES) Key Wrap Algorithm&#8221;, <span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3394.html"><strong>RFC 3394</strong></a>, September 2002.</dd>
<dt id="term-rfc3447">[RFC3447]</dt>
<dd>Jonsson, J. and B. Kaliski, &#8220;Public-Key Cryptography
Standards (PKCS) #1: RSA Cryptography Specifications
Version 2.1&#8221;, RFC 3447, February 2003.</dd>
<dt id="term-87">[RFC3629]</dt>
<dd>Yergeau, F., &#8220;UTF-8, a transformation format of ISO
10646&#8221;, STD 63, RFC 3629, November 2003.</dd>
<dt id="term-88">[RFC3986]</dt>
<dd>Berners-Lee, T., Fielding, R., and L. Masinter, &#8220;Uniform
Resource Identifier (URI): Generic Syntax&#8221;, STD 66,
RFC 3986, January 2005.</dd>
<dt id="term-89">[RFC4086]</dt>
<dd>Eastlake, D., Schiller, J., and S. Crocker, &#8220;Randomness
Requirements for Security&#8221;, BCP 106, RFC 4086, June 2005.</dd>
<dt id="term-90">[RFC4627]</dt>
<dd>Crockford, D., &#8220;The application/json Media Type for
JavaScript Object Notation (JSON)&#8221;, RFC 4627, July 2006.</dd>
<dt id="term-91">[RFC4648]</dt>
<dd>Josefsson, S., &#8220;The Base16, Base32, and Base64 Data
Encodings&#8221;, RFC 4648, October 2006.</dd>
<dt id="term-rfc5226">[RFC5226]</dt>
<dd>Narten, T. and H. Alvestrand, &#8220;Guidelines for Writing an
IANA Considerations Section in RFCs&#8221;, BCP 26, RFC 5226,
May 2008.</dd>
<dt id="term-93">[RFC5246]</dt>
<dd>Dierks, T. and E. Rescorla, &#8220;The Transport Layer Security
(TLS) Protocol Version 1.2&#8221;, RFC 5246, August 2008.</dd>
<dt id="term-94">[RFC5280]</dt>
<dd>Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
Housley, R., and W. Polk, &#8220;Internet X.509 Public Key
Infrastructure Certificate and Certificate Revocation List
(CRL) Profile&#8221;, RFC 5280, May 2008.</dd>
<dt id="term-rfc5785">[RFC5785]</dt>
<dd>Nottingham, M. and E. Hammer-Lahav, &#8220;Defining Well-Known
Uniform Resource Identifiers (URIs)&#8221;, RFC 5785,
April 2010.</dd>
<dt id="term-rfc6090">[RFC6090]</dt>
<dd>McGrew, D., Igoe, K., and M. Salter, &#8220;Fundamental Elliptic
Curve Cryptography Algorithms&#8221;, RFC 6090, February 2011.</dd>
<dt id="term-rfc6125">[RFC6125]</dt>
<dd>Saint-Andre, P. and J. Hodges, &#8220;Representation and
Verification of Domain-Based Application Service Identity
within Internet Public Key Infrastructure Using X.509
(PKIX) Certificates in the Context of Transport Layer
Security (TLS)&#8221;, RFC 6125, March 2011.</dd>
</dl>
<p id="jwe-13-2">13.2. Informative References</p>
<dl class="glossary docutils">
<dt id="term-98">[I-D.rescorla-jsms]</dt>
<dd>Rescorla, E. and J. Hildebrand, &#8220;JavaScript Message
Security Format&#8221;, draft-rescorla-jsms-00 (work in
progress), March 2011.</dd>
<dt id="term-jca">[JCA]</dt>
<dd>Oracle, &#8220;Java Cryptography Architecture&#8221;, 2011.</dd>
<dt id="term-jss">[JSS]</dt>
<dd>Bradley, J. and N. Sakimura (editor), &#8220;JSON Simple Sign&#8221;,
September 2010.</dd>
<dt id="term-jwt">[JWT]</dt>
<dd>Jones, M., Balfanz, D., Bradley, J., Goland, Y., Panzer,
J., Sakimura, N., and P. Tarjan, &#8220;JSON Web Token (JWT)&#8221;,
October 2011.  (<a class="reference internal" href="jwt.html"><em>JSON Web Token (JWT) : draft22</em></a>)</dd>
<dt id="term-rfc3275">[RFC3275]</dt>
<dd>Eastlake, D., Reagle, J., and D. Solo, &#8220;(Extensible Markup
Language) XML-Signature Syntax and Processing&#8221;, RFC 3275,
March 2002.</dd>
<dt id="term-103">[RFC5652]</dt>
<dd>Housley, R., &#8220;Cryptographic Message Syntax (CMS)&#8221;, STD 70,
RFC 5652, September 2009.</dd>
<dt id="term-w3c-cr-xmlenc-core1-20110303">[W3C.CR-xmlenc-core1-20110303]</dt>
<dd>Hirsch, F., Reagle, J., Eastlake, D., and T. Roessler,
&#8220;XML Encryption Syntax and Processing Version 1.1&#8221;, World
Wide Web Consortium CR CR-xmlenc-core1-20110303,
March 2011,
&lt;<a class="reference external" href="http://www.w3.org/TR/2011/CR-xmlenc-core1-20110303">http://www.w3.org/TR/2011/CR-xmlenc-core1-20110303</a>&gt;.</dd>
<dt id="term-w3c-rec-xmlenc-core-20021210">[W3C.REC-xmlenc-core-20021210]</dt>
<dd>Eastlake, D. and J. Reagle, &#8220;XML Encryption Syntax and
Processing&#8221;, World Wide Web Consortium Recommendation REC-
xmlenc-core-20021210, December 2002,
&lt;<a class="reference external" href="http://www.w3.org/TR/2002/REC-xmlenc-core-20021210">http://www.w3.org/TR/2002/REC-xmlenc-core-20021210</a>&gt;.</dd>
</dl>
</div>
</div>
<div class="section" id="appendix-a-jwe-examples">
<span id="jwe-appendix-a"></span><h2><a class="toc-backref" href="#id64">Appendix A. JWE Examples</a><a class="headerlink" href="#appendix-a-jwe-examples" title="Permalink to this headline">¶</a></h2>
<p>This section provides examples of JWE computations.</p>
<p>(draft23)</p>
<div class="section" id="a-1-example-jwe-using-rsaes-oaep-and-aes-gcm">
<span id="jwe-appendix-a-1"></span><h3><a class="toc-backref" href="#id65">A.1. Example JWE using RSAES OAEP and AES GCM</a><a class="headerlink" href="#a-1-example-jwe-using-rsaes-oaep-and-aes-gcm" title="Permalink to this headline">¶</a></h3>
<p>This example encrypts the plaintext
&#8220;The true sign of intelligence is not knowledge but imagination.&#8221;
to the recipient
using <em class="xref std std-term">RSAES OAEP</em> for key encryption and <em class="xref std std-term">AES GCM</em>
for content encryption.</p>
<p>The representation of this plaintext is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">84</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
<span class="mi">111</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span>
<span class="mi">101</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span>
<span class="mi">101</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span>
<span class="mi">110</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">46</span><span class="p">]</span>
</pre></div>
</div>
<p>(draft23, <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.1">http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.1</a>)</p>
<div class="section" id="a-1-1-jwe-header">
<span id="jwe-appendix-a-1-1"></span><h4><a class="toc-backref" href="#id66">A.1.1. JWE Header</a><a class="headerlink" href="#a-1-1-jwe-header" title="Permalink to this headline">¶</a></h4>
<p>The following example JWE Header declares that:</p>
<ul>
<li><p class="first">the Content Encryption Key is encrypted to the recipient using the
RSAES OAEP algorithm to produce the JWE Encrypted Key and</p>
</li>
<li><p class="first">the Plaintext is encrypted using the AES GCM algorithm with a 256
bit key to produce the Ciphertext.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;alg&quot;</span><span class="p">:</span><span class="s">&quot;RSA-OAEP&quot;</span><span class="p">,</span><span class="s">&quot;enc&quot;</span><span class="p">:</span><span class="s">&quot;A256GCM&quot;</span><span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<p>Encoding this JWE Protected Header
as BASE64URL(UTF8(JWE Protected Header)) gives this value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ</span>
</pre></div>
</div>
<p>( draft23, <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.1.1">http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.1.1</a> )</p>
</div>
<div class="section" id="a-1-2-content-encryption-key-cek">
<span id="jwe-appendix-a-1-2"></span><h4><a class="toc-backref" href="#id67">A.1.2.  Content Encryption Key (CEK)</a><a class="headerlink" href="#a-1-2-content-encryption-key-cek" title="Permalink to this headline">¶</a></h4>
<p>Generate a 256 bit random Content Encryption Key (CEK).</p>
<p>In this example, the value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">177</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span>
<span class="mi">212</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span>
<span class="mi">234</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">252</span><span class="p">]</span>
</pre></div>
</div>
<p>( draft23, <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.1.2">http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.1.2</a> )</p>
</div>
<div class="section" id="a-1-3-key-encryption">
<span id="jwe-appendix-a-1-3"></span><h4><a class="toc-backref" href="#id68">A.1.3.  Key Encryption</a><a class="headerlink" href="#a-1-3-key-encryption" title="Permalink to this headline">¶</a></h4>
<p>Encrypt the CEK with the recipient&#8217;s public key
using the <em class="xref std std-term">RSAES OAEP</em> algorithm
to produce the JWE Encrypted Key.</p>
<p>This example uses the RSA key represented in <a class="reference internal" href="jwk.html"><em>JSON Web Key</em></a> [JWK] format
below (with line breaks for display purposes only):</p>
<div class="highlight-python"><pre>{"kty":"RSA",
 "n":"oahUIoWw0K0usKNuOR6H4wkf4oBUXHTxRvgb48E-BVvxkeDNjbC4he8rUW
      cJoZmds2h7M70imEVhRU5djINXtqllXI4DFqcI1DgjT9LewND8MW2Krf3S
      psk_ZkoFnilakGygTwpZ3uesH-PFABNIUYpOiN15dsQRkgr0vEhxN92i2a
      sbOenSZeyaxziK72UwxrrKoExv6kc5twXTq4h-QChLOln0_mtUZwfsRaMS
      tPs6mS6XrgxnxbWhojf663tuEQueGC-FCMfra36C9knDFGzKsNa7LZK2dj
      YgyD3JR_MB_4NUJW_TqOQtwHYbxevoJArm-L5StowjzGy-_bq6Gw",
 "e":"AQAB",
 "d":"kLdtIj6GbDks_ApCSTYQtelcNttlKiOyPzMrXHeI-yk1F7-kpDxY4-WY5N
      WV5KntaEeXS1j82E375xxhWMHXyvjYecPT9fpwR_M9gV8n9Hrh2anTpTD9
      3Dt62ypW3yDsJzBnTnrYu1iwWRgBKrEYY46qAZIrA2xAwnm2X7uGR1hghk
      qDp0Vqj3kbSCz1XyfCs6_LehBwtxHIyh8Ripy40p24moOAbgxVw3rxT_vl
      t3UVe4WO3JkJOzlpUf-KTVI2Ptgm-dARxTEtE-id-4OJr0h-K-VFs3VSnd
      VTIznSxfyrj8ILL6MG_Uv8YAu7VILSB3lOW085-4qE3DzgrTjgyQ"
}</pre>
</div>
<p>The resulting JWE Encrypted Key value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">56</span><span class="p">,</span> <span class="mi">163</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span>
<span class="mi">22</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span>
<span class="mi">82</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span>
<span class="mi">145</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">214</span><span class="p">,</span>
<span class="mi">74</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span>
<span class="mi">13</span><span class="p">,</span> <span class="mi">237</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">228</span><span class="p">,</span>
<span class="mi">173</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span>
<span class="mi">89</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span>
<span class="mi">243</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">249</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
<span class="mi">41</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">214</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span>
<span class="mi">215</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span>
<span class="mi">63</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span>
<span class="mi">193</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span>
<span class="mi">206</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">214</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span>
<span class="mi">104</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span>
<span class="mi">89</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span>
<span class="mi">172</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span>
<span class="mi">117</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">206</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Encrypted Key as BASE64URL(JWE Encrypted Key) gives
this value (with line breaks for display purposes only):</p>
<div class="highlight-python"><pre>OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
6UklfCpIMfIjf7iGdXKHzg</pre>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-1-4-initialization-vector">
<span id="jwe-appendix-a-1-4"></span><h4><a class="toc-backref" href="#id69">A.1.4.  Initialization Vector</a><a class="headerlink" href="#a-1-4-initialization-vector" title="Permalink to this headline">¶</a></h4>
<p>Generate a random 96 bit JWE Initialization Vector.</p>
<p>In this example, the value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">227</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">219</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Initialization Vector as BASE64URL(JWE
Initialization Vector) gives this value:</p>
<blockquote>
<div>48V1_ALb6US04U3b</div></blockquote>
<p>(draft23)</p>
</div>
<div class="section" id="a-1-5-additional-authenticated-data">
<span id="jwe-appendix-a-1-5"></span><h4><a class="toc-backref" href="#id70">A.1.5.  Additional Authenticated Data</a><a class="headerlink" href="#a-1-5-additional-authenticated-data" title="Permalink to this headline">¶</a></h4>
<p>Let the Additional Authenticated Data encryption parameter
be ASCII(BASE64URL(UTF8(JWE Protected Header))).</p>
<p>This value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span>
<span class="mi">116</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span>
<span class="mi">54</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">81</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="a-1-6-content-encryption">
<span id="jwe-appendix-a-1-6"></span><h4><a class="toc-backref" href="#id71">A.1.6.  Content Encryption</a><a class="headerlink" href="#a-1-6-content-encryption" title="Permalink to this headline">¶</a></h4>
<p>Encrypt the Plaintext with AES GCM using
the CEK as the encryption key,
the JWE Initialization Vector, and the
Additional Authenticated Data value above,
requesting a 128 bit Authentication Tag output.</p>
<p>The resulting Ciphertext is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">229</span><span class="p">,</span> <span class="mi">236</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span>
<span class="mi">233</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">237</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span>
<span class="mi">104</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
<span class="mi">123</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span>
<span class="mi">160</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">192</span><span class="p">]</span>
</pre></div>
</div>
<p>The resulting Authentication Tag value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">92</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span>
<span class="mi">210</span><span class="p">,</span> <span class="mi">145</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Ciphertext as BASE64URL(JWE Ciphertext)
gives this value (with line breaks for display purposes only):</p>
<div class="highlight-python"><pre>5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
SdiwkIr3ajwQzaBtQD_A</pre>
</div>
<p>Encoding this JWE Authentication Tag
as BASE64URL(JWE Authentication Tag) gives this value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">XFBoMYUZodetZdvTiFvSkQ</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-1-7-complete-representation">
<span id="jwe-appendix-a-1-7"></span><h4><a class="toc-backref" href="#id72">A.1.7.  Complete Representation</a><a class="headerlink" href="#a-1-7-complete-representation" title="Permalink to this headline">¶</a></h4>
<p>Assemble the final representation:
The Compact Serialization of this result is the
string BASE64URL(UTF8(JWE Protected Header)) || &#8216;.&#8217; ||
BASE64URL(JWE Encrypted Key) || &#8216;.&#8217; ||
BASE64URL(JWE Initialization Vector) || &#8216;.&#8217; ||
BASE64URL(JWE Ciphertext) || &#8216;.&#8217; ||
BASE64URL(JWE Authentication Tag).</p>
<p>The final result in this example (with line breaks for display
purposes only) is:</p>
<div class="highlight-python"><pre>eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.
OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
6UklfCpIMfIjf7iGdXKHzg.
48V1_ALb6US04U3b.
5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
SdiwkIr3ajwQzaBtQD_A.
XFBoMYUZodetZdvTiFvSkQ</pre>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-1-8-validation">
<span id="jwe-appendix-a-1-8"></span><h4><a class="toc-backref" href="#id73">A.1.8.  Validation</a><a class="headerlink" href="#a-1-8-validation" title="Permalink to this headline">¶</a></h4>
<p>This example illustrates the process of creating a JWE with RSAES
OAEP for key encryption and AES GCM for content encryption.  These
results can be used to validate JWE decryption implementations for
these algorithms.  Note that since the RSAES OAEP computation
includes random values, the encryption results above will not be
completely reproducible.  However, since the AES GCM computation is
deterministic, the JWE Encrypted Ciphertext values will be the same
for all encryptions performed using these inputs.</p>
<p>(draft23)</p>
</div>
</div>
<div class="section" id="a-2-example-jwe-using-rsaes-pkcs1-v1-5-and-aes-128-cbc-hmac-sha-256">
<span id="jwe-appendix-a-2"></span><h3><a class="toc-backref" href="#id74">A.2. Example JWE using RSAES-PKCS1-V1_5 and AES_128_CBC_HMAC_SHA_256</a><a class="headerlink" href="#a-2-example-jwe-using-rsaes-pkcs1-v1-5-and-aes-128-cbc-hmac-sha-256" title="Permalink to this headline">¶</a></h3>
<p>This example encrypts the plaintext &#8220;Live long and prosper.&#8221;
to the recipient
using <em class="xref std std-ref">RSAES-PKCS1-V1_5</em> for key encryption and
<a class="reference internal" href="jwa.html#aes-128-cbc-hmac-sha-256"><em>5.2.3. AES_128_CBC_HMAC_SHA_256</em></a> for content encryption.</p>
<p>The representation of this plaintext is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
<span class="mi">112</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">46</span><span class="p">]</span>
</pre></div>
</div>
<p>( <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.2">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.2</a> )</p>
<div class="section" id="a-2-1-jwe-header">
<span id="jwe-appendix-a-2-1"></span><h4><a class="toc-backref" href="#id75">A.2.1. JWE Header</a><a class="headerlink" href="#a-2-1-jwe-header" title="Permalink to this headline">¶</a></h4>
<p>The following example JWE Protected Header declares that:</p>
<ul class="simple">
<li>the Content Encryption Key is encrypted to the recipient using the
RSAES-PKCS1-V1_5 algorithm to produce the JWE Encrypted Key and</li>
<li>the Plaintext is encrypted using the AES_128_CBC_HMAC_SHA_256
algorithm to produce the Ciphertext.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;alg&quot;</span><span class="p">:</span><span class="s">&quot;RSA1_5&quot;</span><span class="p">,</span><span class="s">&quot;enc&quot;</span><span class="p">:</span><span class="s">&quot;A128CBC-HS256&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Encoding this JWE Protected Header
as BASE64URL(UTF8(JWE Protected Header)) gives this value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0</span>
</pre></div>
</div>
<p>( draft23 <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.2.1">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-23#appendix-A.2.1</a> )</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>CEK は RSA AES PKCS1 V.1.5 で非対称暗号化されて JEK となる</li>
<li>Plaintextは AES_128_CBC_HMAC_SHA_256 でCEKを使った共有鍵暗号化で Ciphertextとなる</li>
</ul>
</div>
</div>
<div class="section" id="a-2-2-content-encryption-key-cek">
<span id="jwe-appendix-a-2-2"></span><h4><a class="toc-backref" href="#id76">A.2.2.  Content Encryption Key (CEK)</a><a class="headerlink" href="#a-2-2-content-encryption-key-cek" title="Permalink to this headline">¶</a></h4>
<p>Generate a 256 bit random Content Encryption Key (CEK).</p>
<p>In this example, the key value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span>
<span class="mi">206</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span>
<span class="mi">44</span><span class="p">,</span> <span class="mi">207</span><span class="p">]</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-2-3-key-encryption">
<span id="jwe-appendix-a-2-3"></span><h4><a class="toc-backref" href="#id77">A.2.3.  Key Encryption</a><a class="headerlink" href="#a-2-3-key-encryption" title="Permalink to this headline">¶</a></h4>
<p>Encrypt the CEK with the recipient&#8217;s public key
using the <em class="xref std std-ref">RSAES-PKCS1-V1_5</em> algorithm
to produce the <a class="reference internal" href="#term-34"><em class="xref std std-term">JWE Encrypted Key</em></a>.</p>
<p>This example uses the RSA key represented
in JSON Web Key [JWK] format below
(with line breaks for display purposes only):</p>
<div class="highlight-python"><pre>{"kty":"RSA",
 "n":"sXchDaQebHnPiGvyDOAT4saGEUetSyo9MKLOoWFsueri23bOdgWp4Dy1Wl
      UzewbgBHod5pcM9H95GQRV3JDXboIRROSBigeC5yjU1hGzHHyXss8UDpre
      cbAYxknTcQkhslANGRUZmdTOQ5qTRsLAt6BTYuyvVRdhS8exSZEy_c4gs_
      7svlJJQ4H9_NxsiIoLwAEk7-Q3UXERGYw_75IDrGA84-lA_-Ct4eTlXHBI
      Y2EaV7t7LjJaynVJCpkv4LKjTTAumiGUIuQhrNhZLuF_RJLqHpM2kgWFLU
      7-VTdL1VbC2tejvcI2BlMkEpk1BzBZI0KQB0GaDWFLN-aEAw3vRw",
 "e":"AQAB",
 "d":"VFCWOqXr8nvZNyaaJLXdnNPXZKRaWCjkU5Q2egQQpTBMwhprMzWzpR8Sxq
      1OPThh_J6MUD8Z35wky9b8eEO0pwNS8xlh1lOFRRBoNqDIKVOku0aZb-ry
      nq8cxjDTLZQ6Fz7jSjR1Klop-YKaUHc9GsEofQqYruPhzSA-QgajZGPbE_
      0ZaVDJHfyd7UUBUKunFMScbflYAAOYJqVIVwaYR5zWEEceUjNnTNo_CVSj
      -VvXLO5VZfCUAVLgW4dpf1SrtZjSt34YLsRarSb127reG_DUwg9Ch-Kyvj
      T1SkHgUWRVGcyly7uvVGRSDwsXypdrNinPA4jlhoNdizK2zF2CWQ"
}</pre>
</div>
<p>The resulting JWE Encrypted Key value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">236</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span>
<span class="mi">176</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span>
<span class="mi">156</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">237</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span>
<span class="mi">116</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span>
<span class="mi">226</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span>
<span class="mi">212</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">214</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span>
<span class="mi">215</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span>
<span class="mi">66</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">227</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span>
<span class="mi">54</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span>
<span class="mi">250</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span>
<span class="mi">21</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span>
<span class="mi">166</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span>
<span class="mi">150</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">227</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span>
<span class="mi">124</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span>
<span class="mi">16</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span>
<span class="mi">248</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">249</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span>
<span class="mi">101</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span>
<span class="mi">146</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">252</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Encrypted Key as BASE64URL(JWE Encrypted Key) gives
this value (with line breaks for display purposes only):</p>
<div class="highlight-python"><pre>UGhIOguC7IuEvf_NPVaXsGMoLOmwvc1GyqlIKOK1nN94nHPoltGRhWhw7Zx0-kFm
1NJn8LE9XShH59_i8J0PH5ZZyNfGy2xGdULU7sHNF6Gp2vPLgNZ__deLKxGHZ7Pc
HALUzoOegEI-8E66jX2E4zyJKx-YxzZIItRzC5hlRirb6Y5Cl_p-ko3YvkkysZIF
NPccxRU7qve1WYPxqbb2Yw8kZqa2rMWI5ng8OtvzlV7elprCbuPhcCdZ6XDP0_F8
rkXds2vE4X-ncOIM8hAYHHi29NX0mcKiRaD0-D-ljQTP-cFPgwCp6X-nZZd9OHBv
-B3oWh2TbqmScqXMR4gp_A</pre>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-2-4-initialization-vector">
<span id="jwe-appendix-a-2-4"></span><h4><a class="toc-backref" href="#id78">A.2.4.  Initialization Vector</a><a class="headerlink" href="#a-2-4-initialization-vector" title="Permalink to this headline">¶</a></h4>
<p>Generate a random 128 bit JWE Initialization Vector.</p>
<p>In this example,
the value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span>
<span class="mi">101</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Initialization Vector
as BASE64URL(JWE Initialization Vector) gives this value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AxY8DCtDaGlsbGljb3RoZQ</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-2-5-additional-authenticated-data">
<span id="jwe-appendix-a-2-5"></span><h4><a class="toc-backref" href="#id79">A.2.5.  Additional Authenticated Data</a><a class="headerlink" href="#a-2-5-additional-authenticated-data" title="Permalink to this headline">¶</a></h4>
<p>Let the Additional Authenticated Data encryption parameter be
ASCII(BASE64URL(UTF8(JWE Protected Header))).</p>
<p>This value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span>
<span class="mi">120</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span>
<span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span>
<span class="mi">50</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">48</span><span class="p">]</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-2-6-content-encryption">
<span id="jwe-appendix-a-2-6"></span><h4><a class="toc-backref" href="#id80">A.2.6.  Content Encryption</a><a class="headerlink" href="#a-2-6-content-encryption" title="Permalink to this headline">¶</a></h4>
<p>Encrypt the Plaintext with
<a class="reference internal" href="jwa.html#aes-128-cbc-hmac-sha-256"><em>5.2.3. AES_128_CBC_HMAC_SHA_256</em></a> using
the CEK as the encryption key,
the JWE Initialization Vector, and
the Additional Authenticated Data value above.</p>
<p>The steps for doing this using the values
from Appendix A.3 are detailed in Appendix B.</p>
<p>The resulting Ciphertext is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
<span class="mi">75</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span>
<span class="mi">112</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">102</span><span class="p">]</span>
</pre></div>
</div>
<p>The resulting Authentication Tag value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">246</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>
<span class="mi">191</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Ciphertext as BASE64URL(JWE Ciphertext) gives this
value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY</span>
</pre></div>
</div>
<p>Encoding this JWE Authentication Tag
as BASE64URL(JWE Authentication Tag) gives this value:</p>
<div class="highlight-python"><pre>9hH0vgRfYgPnAHOd8stkvw</pre>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-2-7-complete-representation">
<span id="jwe-appendix-a-2-7"></span><h4><a class="toc-backref" href="#id81">A.2.7.  Complete Representation</a><a class="headerlink" href="#a-2-7-complete-representation" title="Permalink to this headline">¶</a></h4>
<p>Assemble the final representation:
The Compact Serialization of this result is the string
BASE64URL(UTF8(JWE Protected Header)) || &#8216;.&#8217; ||
BASE64URL(JWE Encrypted Key) || &#8216;.&#8217; ||
BASE64URL(JWE Initialization Vector) || &#8216;.&#8217; ||
BASE64URL(JWE Ciphertext) || &#8216;.&#8217; ||
BASE64URL(JWE Authentication Tag).</p>
<p>The final result in this example (with line breaks for display
purposes only) is:</p>
<div class="highlight-python"><pre>eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.
UGhIOguC7IuEvf_NPVaXsGMoLOmwvc1GyqlIKOK1nN94nHPoltGRhWhw7Zx0-kFm
1NJn8LE9XShH59_i8J0PH5ZZyNfGy2xGdULU7sHNF6Gp2vPLgNZ__deLKxGHZ7Pc
HALUzoOegEI-8E66jX2E4zyJKx-YxzZIItRzC5hlRirb6Y5Cl_p-ko3YvkkysZIF
NPccxRU7qve1WYPxqbb2Yw8kZqa2rMWI5ng8OtvzlV7elprCbuPhcCdZ6XDP0_F8
rkXds2vE4X-ncOIM8hAYHHi29NX0mcKiRaD0-D-ljQTP-cFPgwCp6X-nZZd9OHBv
-B3oWh2TbqmScqXMR4gp_A.
AxY8DCtDaGlsbGljb3RoZQ.
KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY.
9hH0vgRfYgPnAHOd8stkvw</pre>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-2-8-validation">
<span id="jwe-appendix-a-2-8"></span><h4><a class="toc-backref" href="#id82">A.2.8.  Validation</a><a class="headerlink" href="#a-2-8-validation" title="Permalink to this headline">¶</a></h4>
<p>This example illustrates the process of creating a JWE with RSAES-
PKCS1-V1_5 for key encryption and AES_CBC_HMAC_SHA2 for content
encryption.  These results can be used to validate JWE decryption
implementations for these algorithms.  Note that since the RSAES-
PKCS1-V1_5 computation includes random values, the encryption results
above will not be completely reproducible.  However, since the AES
CBC computation is deterministic, the JWE Encrypted Ciphertext values
will be the same for all encryptions performed using these inputs.</p>
<p>(draft23)</p>
</div>
</div>
<div class="section" id="a-3-example-jwe-using-aes-key-wrap-and-aes-128-cbc-hmac-sha-256">
<span id="jwe-appendix-a-3"></span><h3><a class="toc-backref" href="#id83">A.3.  Example JWE using AES Key Wrap and AES_128_CBC_HMAC_SHA_256</a><a class="headerlink" href="#a-3-example-jwe-using-aes-key-wrap-and-aes-128-cbc-hmac-sha-256" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference internal" href="jwa.html#jwa-5-2-3"><em>5.2.3. AES_128_CBC_HMAC_SHA_256</em></a></li>
</ul>
</div>
<p>This example encrypts the plaintext &#8220;Live long and prosper.&#8221;</p>
<p>to the recipient using AES Key Wrap
for key encryption and AES GCM for content encryption.</p>
<p>The representation of this plaintext is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
<span class="mi">112</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">46</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plaintext</span><span class="p">)</span>
<span class="go">&#39;Live long and prosper.&#39;</span>
</pre></div>
</div>
<p>(draft23)</p>
<div class="section" id="a-3-1-jwe-header">
<span id="jwe-appendix-a-3-1"></span><h4><a class="toc-backref" href="#id84">A.3.1.  JWE Header</a><a class="headerlink" href="#a-3-1-jwe-header" title="Permalink to this headline">¶</a></h4>
<p>The following example JWE Protected Header declares that:</p>
<ul class="simple">
<li>the Content Encryption Key is encrypted to the recipient
using the AES Key Wrap algorithm with a 128 bit key
to produce the JWE Encrypted Key and</li>
</ul>
<dl class="docutils">
<dt>o  the Plaintext is encrypted using the <em class="xref std std-term">AES_128_CBC_HMAC_SHA_256</em></dt>
<dd>algorithm to produce the Ciphertext.</dd>
</dl>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="s2">&quot;alg&quot;</span><span class="o">:</span><span class="s2">&quot;A128KW&quot;</span><span class="p">,</span><span class="s2">&quot;enc&quot;</span><span class="o">:</span><span class="s2">&quot;A128CBC-HS256&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Encoding this JWE Protected Header
as BASE64URL(UTF8(JWE Protected Header)) gives this value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jose.utils</span> <span class="kn">import</span> <span class="n">base64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">base64</span><span class="o">.</span><span class="n">base64url_encode</span><span class="p">(</span><span class="s">&#39;{&quot;alg&quot;:&quot;A128KW&quot;,&quot;enc&quot;:&quot;A128CBC-HS256&quot;}&#39;</span><span class="p">)</span>

<span class="go">&#39;eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0&#39;</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-3-2-content-encryption-key-cek">
<span id="jwe-appendix-a-3-2"></span><h4><a class="toc-backref" href="#id85">A.3.2.  Content Encryption Key (CEK)</a><a class="headerlink" href="#a-3-2-content-encryption-key-cek" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>256 ビットのランダムオクテットを生成し、これを CEKとします</li>
<li>このCEKは <a class="reference internal" href="#jwe-appendix-a-3-3"><em>A.3.3.  Key Encryption</em></a> でキーラップされて渡されます。</li>
</ul>
</div>
<p>Generate a 256 bit random Content Encryption Key (CEK).</p>
<p>In this example, the value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span>
<span class="mi">206</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span>
<span class="mi">44</span><span class="p">,</span> <span class="mi">207</span><span class="p">]</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-3-3-key-encryption">
<span id="jwe-appendix-a-3-3"></span><h4><a class="toc-backref" href="#id86">A.3.3.  Key Encryption</a><a class="headerlink" href="#a-3-3-key-encryption" title="Permalink to this headline">¶</a></h4>
<p>Encrypt the CEK with the shared symmetric key
using the AES Key Wrap algorithm
to produce the JWE Encrypted Key.</p>
<p>This example uses the symmetric key represented
in JSON Web Key [JWK] format below:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="s2">&quot;kty&quot;</span><span class="o">:</span><span class="s2">&quot;oct&quot;</span><span class="p">,</span>
 <span class="s2">&quot;k&quot;</span><span class="o">:</span><span class="s2">&quot;GawgguFyGrWKav7AX4VKUg&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The resulting JWE Encrypted Key value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">232</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span>
<span class="mi">22</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
<span class="mi">76</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">57</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Encrypted Key as BASE64URL(JWE Encrypted Key) gives
this value:</p>
<div class="highlight-python"><pre>6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ</pre>
</div>
<p>(draft23)</p>
<div class="section" id="python">
<h5><a class="toc-backref" href="#id87">Python</a><a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://gist.github.com/doublereedkurt/4243633">https://gist.github.com/doublereedkurt/4243633</a></li>
<li><span class="target" id="index-1"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3394.html"><strong>RFC 3394</strong></a></li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">jose.jwk</span> <span class="kn">import</span> <span class="n">Jwk</span>
<span class="kn">from</span> <span class="nn">jose.utils</span> <span class="kn">import</span> <span class="n">base64</span>

<span class="n">jstr</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">{&quot;kty&quot;:&quot;oct&quot;,</span>
<span class="s">      &quot;k&quot;:&quot;GawgguFyGrWKav7AX4VKUg&quot;</span>
<span class="s">           }</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="n">jwk</span> <span class="o">=</span> <span class="n">Jwk</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">jstr</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">jwk</span><span class="o">.</span><span class="n">kty</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&#39;oct&#39;</span>
<span class="k">assert</span> <span class="n">jwk</span><span class="o">.</span><span class="n">k</span> <span class="o">==</span> <span class="s">&quot;GawgguFyGrWKav7AX4VKUg&quot;</span>

<span class="n">cek</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="mi">4</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span>
    <span class="mi">206</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span>
    <span class="mi">44</span><span class="p">,</span> <span class="mi">207</span><span class="p">])</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">base64url_decode</span><span class="p">(</span><span class="n">jwk</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span>

<span class="n">wkey1</span> <span class="o">=</span> <span class="n">aes_wrap_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">cek</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">cek</span> <span class="o">==</span> <span class="n">aes_unwrap_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">wkey1</span><span class="p">)</span>

<span class="n">wkey2</span> <span class="o">=</span> <span class="n">aes_wrap_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">cek</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">cek</span> <span class="o">==</span> <span class="n">aes_unwrap_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">wkey2</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">wkey1</span> <span class="o">==</span> <span class="n">wkey2</span>

<span class="n">jwe_encrypted_key</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">232</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span>
    <span class="mi">22</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
    <span class="mi">76</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">57</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">jwe_encrypted_key</span> <span class="o">==</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wkey1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-3-4-initialization-vector">
<span id="jwe-appendix-a-3-4"></span><h4><a class="toc-backref" href="#id88">A.3.4.  Initialization Vector</a><a class="headerlink" href="#a-3-4-initialization-vector" title="Permalink to this headline">¶</a></h4>
<p>Generate a random 128 bit JWE Initialization Vector.</p>
<p>In this example, the value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span>
<span class="mi">101</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Initialization Vector as
BASE64URL(JWE Initialization Vector) gives this value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AxY8DCtDaGlsbGljb3RoZQ</span>
</pre></div>
</div>
<div class="section" id="id10">
<h5><a class="toc-backref" href="#id89">Python</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jose.utils</span> <span class="kn">import</span> <span class="n">base64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iv</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">101</span><span class="p">]</span>
<span class="go">        &gt;&gt;&gt; iv = &#39;&#39;.join(chr(i) for i in iv)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">base64</span><span class="o">.</span><span class="n">base64url_encode</span><span class="p">(</span><span class="n">iv</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;AxY8DCtDaGlsbGljb3RoZQ&#39;</span>
<span class="go">True</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
</div>
<div class="section" id="a-3-5-additional-authenticated-data">
<span id="jwe-appendix-a-3-5"></span><h4><a class="toc-backref" href="#id90">A.3.5.  Additional Authenticated Data</a><a class="headerlink" href="#a-3-5-additional-authenticated-data" title="Permalink to this headline">¶</a></h4>
<p>Let the Additional Authenticated Data encryption parameter be
ASCII(BASE64URL(UTF8(JWE Protected Header))).</p>
<p>This value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span>
<span class="mi">83</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span>
<span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span>
<span class="mi">110</span><span class="p">,</span> <span class="mi">48</span><span class="p">]</span>
</pre></div>
</div>
<p>(draft23)</p>
<div class="section" id="id11">
<h5><a class="toc-backref" href="#id91">Python</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><em class="xref std std-ref">jwe.a.3.1</em></li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">83</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">110</span><span class="p">,</span> <span class="mi">48</span><span class="p">])</span>
<span class="go">&#39;eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-3-6-content-encryption">
<span id="jwe-appendix-a-3-6"></span><h4><a class="toc-backref" href="#id92">A.3.6.  Content Encryption</a><a class="headerlink" href="#a-3-6-content-encryption" title="Permalink to this headline">¶</a></h4>
<p>Encrypt the Plaintext with <a class="reference internal" href="jwa.html#aes-128-cbc-hmac-sha-256"><em>5.2.3. AES_128_CBC_HMAC_SHA_256</em></a>
using the CEK as the encryption key,
the JWE Initialization Vector,
and the Additional Authenticated Data value above.</p>
<p>The steps for doing this
using the values from this example are detailed
in <a class="reference internal" href="#jwe-appendix-b"><em>Appendix B</em></a>.</p>
<p>The <em class="xref std std-ref">resulting Ciphertext</em> is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
<span class="mi">75</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span>
<span class="mi">112</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">102</span><span class="p">]</span>
</pre></div>
</div>
<p>The resulting Authentication Tag value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">83</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span>
<span class="mi">194</span><span class="p">,</span> <span class="mi">85</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Ciphertext as BASE64URL(JWE Ciphertext) gives this
value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY</span>
</pre></div>
</div>
<p>Encoding this JWE Authentication Tag
as BASE64URL(JWE Authentication Tag) gives this value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">U0m_YmjN04DJvceFICbCVQ</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-3-7-complete-representation">
<span id="jwe-appendix-a-3-7"></span><h4><a class="toc-backref" href="#id93">A.3.7.  Complete Representation</a><a class="headerlink" href="#a-3-7-complete-representation" title="Permalink to this headline">¶</a></h4>
<p>Assemble the final representation: The Compact Serialization of this
result is the string
BASE64URL(UTF8(JWE Protected Header)) || &#8216;.&#8217; ||
BASE64URL(JWE Encrypted Key) || &#8216;.&#8217; ||
BASE64URL(JWE Initialization Vector) || &#8216;.&#8217; ||
BASE64URL(JWE Ciphertext) || &#8216;.&#8217; ||
BASE64URL(JWE Authentication Tag).</p>
<p>The final result in this example (with line breaks for display
purposes only) is:</p>
<div class="highlight-python"><pre>eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.
6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ.
AxY8DCtDaGlsbGljb3RoZQ.
KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY.
U0m_YmjN04DJvceFICbCVQ</pre>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-3-8-validation">
<span id="jwe-appendix-a-3-8"></span><h4><a class="toc-backref" href="#id94">A.3.8.  Validation</a><a class="headerlink" href="#a-3-8-validation" title="Permalink to this headline">¶</a></h4>
<p>This example illustrates the process of
creating a JWE with AES Key Wrap for key encryption
and AES GCM for content encryption.</p>
<p>These results can be used to validate JWE decryption implementations
for these algorithms.</p>
<p>Also,
since both the AES Key Wrap and AES GCM computations are deterministic,
the resulting JWE value will be the same for all encryptions
performed using these inputs.</p>
<p>Since the computation is reproducible,
these results can also be used to validate JWE encryption implementations
for these algorithms.</p>
<p>(draft23)</p>
</div>
</div>
<div class="section" id="a-4-example-jwe-using-jwe-json-serialization">
<span id="jwe-appendix-a-4"></span><h3><a class="toc-backref" href="#id95">A.4.  Example JWE using JWE JSON Serialization</a><a class="headerlink" href="#a-4-example-jwe-using-jwe-json-serialization" title="Permalink to this headline">¶</a></h3>
<p>This section contains an example
using the <a class="reference internal" href="#jwe-json-serialization"><em>JWE JSON Serialization</em></a>.</p>
<p>This example demonstrates the capability
for encrypting the same plaintext to multiple recipients.</p>
<p>Two recipients are present in this example.</p>
<p>The algorithm and key used for the first recipient
are the same as that used in <a class="reference internal" href="#jwe-appendix-a-2"><em>Appendix A.2</em></a>.</p>
<p>The algorithm and key used for the second recipient
are the same as that used in <a class="reference internal" href="#jwe-appendix-a-3"><em>Appendix A.3</em></a>.</p>
<p>The resulting JWE Encrypted Key values are therefore the same;
those computations are not repeated here.</p>
<p>The Plaintext,
the Content Encryption Key (CEK),
Initialization Vector, and
JWE Protected Header are shared by all recipients
(which must be the case, since the Ciphertext and
Authentication Tag are also shared).</p>
<p>(draft23)</p>
<div class="section" id="a-4-1-jwe-per-recipient-unprotected-headers">
<span id="jwe-appendix-a-4-1"></span><h4><a class="toc-backref" href="#id96">A.4.1.  JWE Per-Recipient Unprotected Headers</a><a class="headerlink" href="#a-4-1-jwe-per-recipient-unprotected-headers" title="Permalink to this headline">¶</a></h4>
<p>The first recipient uses the RSAES-PKCS1-V1_5 algorithm to encrypt
the Content Encryption Key (CEK).  The second uses AES Key Wrap to
encrypt the CEK.  Key ID values are supplied for both keys.  The two
per-recipient header values used to represent these algorithms and
Key IDs are:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;alg&quot;</span><span class="p">:</span><span class="s">&quot;RSA1_5&quot;</span><span class="p">,</span><span class="s">&quot;kid&quot;</span><span class="p">:</span><span class="s">&quot;2011-04-29&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;alg&quot;</span><span class="p">:</span><span class="s">&quot;A128KW&quot;</span><span class="p">,</span><span class="s">&quot;kid&quot;</span><span class="p">:</span><span class="s">&quot;7&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-4-2-jwe-protected-header">
<span id="jwe-appendix-a-4-2"></span><h4><a class="toc-backref" href="#id97">A.4.2.  JWE Protected Header</a><a class="headerlink" href="#a-4-2-jwe-protected-header" title="Permalink to this headline">¶</a></h4>
<p>The Plaintext is encrypted using the AES_128_CBC_HMAC_SHA_256
algorithm to produce the common JWE Ciphertext and JWE Authentication
Tag values.  The JWE Protected Header value representing this is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;enc&quot;</span><span class="p">:</span><span class="s">&quot;A128CBC-HS256&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Encoding this JWE Protected Header as BASE64URL(UTF8(JWE Protected
Header)) gives this value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">eyJlbmMiOiJBMTI4Q0JDLUhTMjU2In0</span>
</pre></div>
</div>
<p>(draft23)</p>
</div>
<div class="section" id="a-4-3-jwe-unprotected-header">
<span id="jwe-appendix-a-4-3"></span><h4><a class="toc-backref" href="#id98">A.4.3.  JWE Unprotected Header</a><a class="headerlink" href="#a-4-3-jwe-unprotected-header" title="Permalink to this headline">¶</a></h4>
<p>This JWE uses the &#8220;jku&#8221; Header Parameter to reference a JWK Set. This
is represented in the following JWE Unprotected Header value as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;jku&quot;</span><span class="p">:</span><span class="s">&quot;https://server.example.com/keys.jwks&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="a-4-4-complete-jwe-header-values">
<span id="jwe-appendix-a-4-4"></span><h4><a class="toc-backref" href="#id99">A.4.4.  Complete JWE Header Values</a><a class="headerlink" href="#a-4-4-complete-jwe-header-values" title="Permalink to this headline">¶</a></h4>
<p>Combining the per-recipient, protected, and unprotected header values
supplied, the JWE Header values used for the first and second
recipient respectively are:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;alg&quot;</span><span class="p">:</span><span class="s">&quot;RSA1_5&quot;</span><span class="p">,</span>
 <span class="s">&quot;kid&quot;</span><span class="p">:</span><span class="s">&quot;2011-04-29&quot;</span><span class="p">,</span>
 <span class="s">&quot;enc&quot;</span><span class="p">:</span><span class="s">&quot;A128CBC-HS256&quot;</span><span class="p">,</span>
 <span class="s">&quot;jku&quot;</span><span class="p">:</span><span class="s">&quot;https://server.example.com/keys.jwks&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;alg&quot;</span><span class="p">:</span><span class="s">&quot;A128KW&quot;</span><span class="p">,</span>
 <span class="s">&quot;kid&quot;</span><span class="p">:</span><span class="s">&quot;7&quot;</span><span class="p">,</span>
 <span class="s">&quot;enc&quot;</span><span class="p">:</span><span class="s">&quot;A128CBC-HS256&quot;</span><span class="p">,</span>
 <span class="s">&quot;jku&quot;</span><span class="p">:</span><span class="s">&quot;https://server.example.com/keys.jwks&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="a-4-5-additional-authenticated-data">
<span id="jwe-appendix-a-4-5"></span><h4><a class="toc-backref" href="#id100">A.4.5.  Additional Authenticated Data</a><a class="headerlink" href="#a-4-5-additional-authenticated-data" title="Permalink to this headline">¶</a></h4>
<p>Let the Additional Authenticated Data encryption parameter be
ASCII(BASE64URL(UTF8(JWE Protected Header))).  This value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span>
<span class="mi">52</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">48</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="a-4-6-content-encryption">
<span id="jwe-appendix-a-4-6"></span><h4><a class="toc-backref" href="#id101">A.4.6.  Content Encryption</a><a class="headerlink" href="#a-4-6-content-encryption" title="Permalink to this headline">¶</a></h4>
<p>Encrypt the Plaintext
with <a class="reference internal" href="jwa.html#aes-128-cbc-hmac-sha-256"><em>5.2.3. AES_128_CBC_HMAC_SHA_256</em></a>
using the CEK as the encryption key,
the JWE Initialization Vector, and
the Additional Authenticated Data value above.</p>
<p>The steps for doing this using the values
from <a class="reference internal" href="#jwe-appendix-a-3"><em>Appendix A.3</em></a> are detailed
in <a class="reference internal" href="#jwe-appendix-b"><em>Appendix B</em></a>.</p>
<p>The resulting Ciphertext is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
<span class="mi">75</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span>
<span class="mi">112</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">102</span><span class="p">]</span>
</pre></div>
</div>
<p>The resulting Authentication Tag value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span>
<span class="mi">207</span><span class="p">]</span>
</pre></div>
</div>
<p>Encoding this JWE Ciphertext as BASE64URL(JWE Ciphertext) gives this
value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY</span>
</pre></div>
</div>
<p>Encoding this JWE Authentication Tag as BASE64URL(JWE Authentication
Tag) gives this value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Mz</span><span class="o">-</span><span class="n">VPPyU4RlcuYv1IwIvzw</span>
</pre></div>
</div>
</div>
<div class="section" id="a-4-7-complete-jwe-json-serialization-representation">
<span id="jwe-appendix-a-4-7"></span><h4><a class="toc-backref" href="#id102">A.4.7.  Complete JWE JSON Serialization Representation</a><a class="headerlink" href="#a-4-7-complete-jwe-json-serialization-representation" title="Permalink to this headline">¶</a></h4>
<p>The complete JSON Web Encryption JSON Serialization for these values
is as follows (with line breaks for display purposes only):</p>
<div class="highlight-python"><pre>{"protected":
  "eyJlbmMiOiJBMTI4Q0JDLUhTMjU2In0",
 "unprotected":
  {"jku":"https://server.example.com/keys.jwks"},
 "recipients":[
  {"header":
    {"alg":"RSA1_5"},
   "encrypted_key":
    "UGhIOguC7IuEvf_NPVaXsGMoLOmwvc1GyqlIKOK1nN94nHPoltGRhWhw7Zx0-
     kFm1NJn8LE9XShH59_i8J0PH5ZZyNfGy2xGdULU7sHNF6Gp2vPLgNZ__deLKx
     GHZ7PcHALUzoOegEI-8E66jX2E4zyJKx-YxzZIItRzC5hlRirb6Y5Cl_p-ko3
     YvkkysZIFNPccxRU7qve1WYPxqbb2Yw8kZqa2rMWI5ng8OtvzlV7elprCbuPh
     cCdZ6XDP0_F8rkXds2vE4X-ncOIM8hAYHHi29NX0mcKiRaD0-D-ljQTP-cFPg
     wCp6X-nZZd9OHBv-B3oWh2TbqmScqXMR4gp_A"},
  {"header":
    {"alg":"A128KW"},
   "encrypted_key":
    "6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ"}],
 "iv":
  "AxY8DCtDaGlsbGljb3RoZQ",
 "ciphertext":
  "KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY",
 "tag":
  "Mz-VPPyU4RlcuYv1IwIvzw"
}</pre>
</div>
</div>
</div>
</div>
<div class="section" id="appendix-b-example-aes-128-cbc-hmac-sha-256-computation">
<span id="jwe-appendix-b"></span><h2><a class="toc-backref" href="#id103">Appendix B.  Example AES_128_CBC_HMAC_SHA_256 Computation</a><a class="headerlink" href="#appendix-b-example-aes-128-cbc-hmac-sha-256-computation" title="Permalink to this headline">¶</a></h2>
<p>This example shows the steps
in the <em class="xref std std-ref">jwa.AES_128_CBC_HMAC_SHA_256</em>
authenticated encryption computation
using the values from the example in <a class="reference internal" href="#jwe-appendix-a-3"><em>Appendix A.3</em></a>.</p>
<p>As described where this algorithm is defined
in <a class="reference internal" href="jwa.html#jwa-4-8"><em>Sections 4.8</em></a> and <em class="xref std std-ref">4.8.3</em> of JWA,
the <em class="xref std std-ref">jwa.AES_CBC_HMAC_SHA2</em> family of algorithms are implemented
using Advanced Encryption Standard (AES)
in Cipher Block Chaining (CBC) mode
with PKCS #5 padding
to perform the encryption and an HMAC SHA-2 function
to perform the integrity calculation - in this case, HMAC SHA-256.</p>
<p>(draft21)</p>
<div class="section" id="b-1-extract-mac-key-and-enc-key-from-key">
<span id="jwe-appendix-b-1"></span><h3><a class="toc-backref" href="#id104">B.1. Extract MAC_KEY and ENC_KEY from Key</a><a class="headerlink" href="#b-1-extract-mac-key-and-enc-key-from-key" title="Permalink to this headline">¶</a></h3>
<p>The 256 bit AES_128_CBC_HMAC_SHA_256 key K used in this example is:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span>
<span class="mi">206</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span>
<span class="mi">44</span><span class="p">,</span> <span class="mi">207</span><span class="p">]</span>
</pre></div>
</div>
<p>Use the first 128 bits of this key as the HMAC SHA-256 key MAC_KEY,
which is:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span>
<span class="mi">206</span><span class="p">]</span>
</pre></div>
</div>
<p>Use the last 128 bits of this key as the AES CBC key ENC_KEY, which is:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span><span class="mi">107</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span>
<span class="mi">207</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that the MAC key comes before the encryption key in the input
key K; this is in the opposite order of the algorithm names in the
identifiers &#8220;AES_128_CBC_HMAC_SHA_256&#8221; and &#8220;A128CBC-HS256&#8221;.</p>
<p>( <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-13#appendix-B.1">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-13#appendix-B.1</a> )</p>
<div class="section" id="id12">
<h4><a class="toc-backref" href="#id105">Python</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>CEK は <a class="reference internal" href="#jwe-appendix-a-2-2"><em>A.2.2.  Content Encryption Key (CEK)</em></a> のCEKと同じで、
既に共有 Jwkキーで、 AES Key Wrapされたもの。</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cek</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">206</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">44</span><span class="p">,</span> <span class="mi">207</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mac_key</span> <span class="o">=</span> <span class="n">cek</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">enc_key</span> <span class="o">=</span> <span class="n">cek</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mac_key</span>
<span class="go">[4, 211, 31, 197, 84, 157, 252, 254, 11, 100, 157, 250, 63, 170, 106, 206]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">enc_key</span>
<span class="go">[107, 124, 212, 45, 111, 107, 9, 219, 200, 177, 0, 240, 143, 156, 44, 207]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="b-2-encrypt-plaintext-to-create-ciphertext">
<span id="jwe-appendix-b-2"></span><h3><a class="toc-backref" href="#id106">B.2.  Encrypt Plaintext to Create Ciphertext</a><a class="headerlink" href="#b-2-encrypt-plaintext-to-create-ciphertext" title="Permalink to this headline">¶</a></h3>
<p>Encrypt the Plaintext
with AES in Cipher Block Chaining (CBC) mode
using PKCS #5 padding using the ENC_KEY above.</p>
<p>The Plaintext in this example is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
<span class="mi">112</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">46</span><span class="p">]</span>
</pre></div>
</div>
<p>The encryption result is as follows, which is the Ciphertext output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
<span class="mi">75</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span>
<span class="mi">112</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">102</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>iv は :ref`jwe.appendix.b.4` をつかってAESを初期化すること</li>
</ul>
</div>
<div class="section" id="id13">
<h4><a class="toc-backref" href="#id107">Python</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plaintext</span> <span class="o">=</span> <span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">112</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">46</span><span class="p">]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plaintext_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plaintext</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plaintext_str</span>
<span class="go">&#39;Live long and prosper.&#39;</span>


<span class="gp">&gt;&gt;&gt; </span><span class="n">cek</span>
<span class="go">[4, 211, 31, 197, 84, 157, 252, 254, 11, 100, 157, 250,</span>
<span class="go"> 63, 170, 106, 206, 107, 124, 212, 45, 111, 107, 9, 219,</span>
<span class="go"> 200, 177, 0, 240, 143, 156, 44, 207]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">mac_key</span><span class="p">,</span><span class="n">enc_key</span> <span class="o">=</span> <span class="n">cek</span><span class="p">[:</span><span class="mi">16</span><span class="p">],</span><span class="n">cek</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mac_key</span>
<span class="go">[4, 211, 31, 197, 84, 157, 252, 254, 11, 100, 157, 250, 63, 170, 106, 206]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">enc_key</span>
<span class="go">[107, 124, 212, 45, 111, 107, 9, 219, 200, 177, 0, 240, 143, 156, 44, 207]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">iv</span> <span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">101</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">enc_key_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">enc_key</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iv_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sender</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">enc_key_str</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv_str</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">pkcs5_pad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">BS</span><span class="p">,</span><span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="n">BS</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BS</span><span class="p">)</span> <span class="o">*</span> <span class="nb">chr</span><span class="p">(</span><span class="n">BS</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BS</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">pkcs5_pad</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">plaintext_str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span>
<span class="go">&#39;Live long and prosper.\n\n\n\n\n\n\n\n\n\n&#39;</span>


<span class="gp">&gt;&gt;&gt; </span><span class="n">ciphertext_str</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ciphertext_str</span>
<span class="go">&#39;(9S\xb5w!\x85\x94\xc6\xb9\xf3\x18\x98\xe6\x06K\x81\xdf\x7f\x13\xd2R\xb7\xe6\xa8!\xd7h\x</span>


<span class="gp">&gt;&gt;&gt; </span><span class="n">ciphertext</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ciphertext_str</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ciphertext</span>
<span class="go">[40, 57, 83, 181, 119, 33, 133, 148, 198, 185, 243, 24, 152,</span>
<span class="go"> 230, 6, 75, 129, 223, 127, 19, 210, 82, 183, 230, 168,</span>
<span class="go"> 33, 215, 104, 143, 112, 56, 102]</span>
</pre></div>
</div>
<p>復号で確認:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">recipient</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">enc_key_str</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv_str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span> <span class="o">=</span> <span class="n">recipient</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">ciphertext_str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span>
<span class="go">&#39;Live long and prosper.\n\n\n\n\n\n\n\n\n\n&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">pkcs5_unpad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pkcs5_unpad</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="go">&#39;Live long and prosper.&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">pkcs5_unpad</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">==</span> <span class="n">plaintext_str</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="b-3-64-bit-big-endian-representation-of-aad-length">
<span id="jwe-appendix-b-3"></span><h3><a class="toc-backref" href="#id108">B.3. 64 Bit Big Endian Representation of AAD Length</a><a class="headerlink" href="#b-3-64-bit-big-endian-representation-of-aad-length" title="Permalink to this headline">¶</a></h3>
<p>The Additional Authenticated Data (AAD) in this example is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span>
<span class="mi">83</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span>
<span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span>
<span class="mi">110</span><span class="p">,</span> <span class="mi">48</span><span class="p">]</span>
</pre></div>
</div>
<p>This AAD is 51 bytes long, which is 408 bits long.  The octet string
AL, which is the number of bits in AAD expressed as a big endian 64
bit unsigned integer is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">152</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>AADのビット数です。オクテット数ではありません。</li>
</ul>
</div>
<p>( <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.3">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.3</a> )</p>
<div class="section" id="id14">
<h4><a class="toc-backref" href="#id109">Python</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">aad_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aad</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aad_str</span>
<span class="go">&#39;eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">base64</span><span class="o">.</span><span class="n">base64url_decode</span><span class="p">(</span><span class="n">aad_str</span><span class="p">)</span>
<span class="go">&#39;{&quot;alg&quot;:&quot;A128KW&quot;,&quot;enc&quot;:&quot;A128CBC-HS256&quot;}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">to_al</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">,]</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">int_to_string</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)])[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">to_al</span><span class="p">(</span><span class="n">aad</span><span class="p">)</span>
<span class="go">[0, 0, 0, 0, 0, 0, 1, 152]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="b-4-initialization-vector-value">
<span id="jwe-appendix-b-4"></span><h3><a class="toc-backref" href="#id110">B.4. Initialization Vector Value</a><a class="headerlink" href="#b-4-initialization-vector-value" title="Permalink to this headline">¶</a></h3>
<p>The Initialization Vector value used in this example is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span>
<span class="mi">101</span><span class="p">]</span>
</pre></div>
</div>
<p>( <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.4">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.4</a> )</p>
</div>
<div class="section" id="b-5-create-input-to-hmac-computation">
<span id="jwe-appendix-b-5"></span><h3><a class="toc-backref" href="#id111">B.5. Create Input to HMAC Computation</a><a class="headerlink" href="#b-5-create-input-to-hmac-computation" title="Permalink to this headline">¶</a></h3>
<p>Concatenate the AAD, the Initialization Vector, the Ciphertext, and
the AL value.  The result of this concatenation is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span>
<span class="mi">83</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span>
<span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span>
<span class="mi">110</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span>
<span class="mi">116</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span>
<span class="mi">152</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span>
<span class="mi">104</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">152</span><span class="p">]</span>
</pre></div>
</div>
<p>( <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.5">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.5</a> )</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>HMAC INPUT = {{AAD}} + {{IV}} + {{CipherText}} + {{AL}}</p>
<ul class="last simple">
<li>{{AAD}} &lt;- <a class="reference internal" href="#jwe-appendix-b-3"><em>B.3. 64 Bit Big Endian Representation of AAD Length</em></a></li>
<li>{{IV}} &lt;- <a class="reference internal" href="#jwe-appendix-b-4"><em>B.4. Initialization Vector Value</em></a></li>
<li>{{CihperText}} &lt;- <a class="reference internal" href="#jwe-appendix-b-2"><em>B.2.  Encrypt Plaintext to Create Ciphertext</em></a></li>
<li>{{AL}} &lt;- <a class="reference internal" href="#jwe-appendix-b-3"><em>B.3. 64 Bit Big Endian Representation of AAD Length</em></a></li>
</ul>
</div>
<div class="section" id="id15">
<h4><a class="toc-backref" href="#id112">python</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hmac_input</span> <span class="o">=</span> <span class="n">aad</span> <span class="o">+</span> <span class="n">iv</span> <span class="o">+</span> <span class="n">ciphertext</span> <span class="o">+</span> <span class="n">al</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">83</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">77</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">110</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">116</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">152</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">104</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">152</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">==</span> <span class="n">hmac_input</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="b-6-compute-hmac-value">
<span id="jwe-appendix-b-6"></span><h3><a class="toc-backref" href="#id113">B.6. Compute HMAC Value</a><a class="headerlink" href="#b-6-compute-hmac-value" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">HS256 = HMAC SHA-256</p>
</div>
<p>Compute the HMAC SHA-256 of the concatenated value above.  This result M is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">83</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span>
<span class="mi">194</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span>
<span class="mi">86</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">116</span><span class="p">]</span>
</pre></div>
</div>
<p>( <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.6">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.6</a> )</p>
<div class="section" id="id16">
<h4><a class="toc-backref" href="#id114">python</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hmac_input_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hmac_input</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mac_key_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mac_key</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">HMAC</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">SHA256</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hmac</span> <span class="o">=</span> <span class="n">HMAC</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">mac_key_str</span><span class="p">,</span> <span class="n">hmac_input_str</span><span class="p">,</span><span class="n">SHA256</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hmac</span>
<span class="go">&lt;Crypto.Hash.HMAC.HMAC instance at 0x2a4e950&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">hmac</span> <span class="o">=</span> <span class="n">_</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">83</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">194</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span>
<span class="gp">... </span>   <span class="mi">86</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">116</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dig_str</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">)</span> <span class="o">==</span> <span class="n">dig_str</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="b-7-truncate-hmac-value-to-create-authentication-tag">
<span id="jwe-appendix-b-7"></span><h3><a class="toc-backref" href="#id115">B.7. Truncate HMAC Value to Create Authentication Tag</a><a class="headerlink" href="#b-7-truncate-hmac-value-to-create-authentication-tag" title="Permalink to this headline">¶</a></h3>
<p>Use the first half (128 bits) of the HMAC output M as the
Authentication Tag output T. This truncated value is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">83</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span>
<span class="mi">194</span><span class="p">,</span> <span class="mi">85</span><span class="p">]</span>
</pre></div>
</div>
<p>( <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.7">https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-21#appendix-B.7</a> )</p>
<div class="section" id="id17">
<h4><a class="toc-backref" href="#id116">Python</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dig_str</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">dig_str</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]]</span>
<span class="go">[83, 73, 191, 98, 104, 205, 211, 128,</span>
<span class="go">201, 189, 199, 133, 32, 38, 194, 85]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
  <h2>HDKNR.COM</h2>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011, HDKNR.COM.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.<br/>
    </p>
  </div>
</footer>

  </body>
</html>