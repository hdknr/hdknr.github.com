
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JOSE JWS:Implementation &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/basic.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.0.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/bootstrap-sphinx.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="prev" title="ID Token:Implementation" href="impl_id_token.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">identity</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="oauth.html">RFC6759:The OAuth 2.0 Authorization Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_bearer.html">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_threat.html">Auth 2.0 Threat Model and Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_revocation.html">RFC7009:Token Revocation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_jwt_bearer.html">JSON Web Token (JWT) Bearer Token Profiles for OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_saml2_bearer.html">SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_assertion.html">Assertion Framework for OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_mac.html">HTTP Authentication: MAC Access Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_reg.html">OAuth Dynamic Client Registration Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_introspect.html">OAuth Token Introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_meta.html">JSON Metadata for OAuth Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_res_reg.html">OAuth 2.0 Resource Set Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth-lrdd.html">Link relation Type Registrations for OAuth 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_auth.html">OAuth 2.0 User Authentication and Consent For Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_responses.html">OAuth 2.0 Multiple Response Type Encoding Practices - draft 11</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_post.html">OAuth 2.0 Form Post Response Mode - draft 01</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_res.html">OAuth Resoure</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="openid_connect.html">OpenID Connect</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">OpenID Connect Core 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="reg.html">OpenID Connect Dynamic Client Registration 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="discovery.html">OpenID Connect Discovery 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="session.html">OpenID Connect Session Management 1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic.html">OpenID Connect Basic Client Profile 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="implicit.html">OpenID Connect Implicit Client Implementer&#8217;s Guide 1.0 - draft 14</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="standard.html">OpenID Connect Standard 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">OpenID Connect Messages 1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="uma_core.html">User-Managed Access (UMA) Profile of OAuth 2.0 : draft09</a></li>
<li class="toctree-l1"><a class="reference internal" href="uma_trust.html">Binding Obligations on User-Managed Access (UMA) Participants</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="jose.html">Terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwa.html">JSON Web Algorithms (JWA) : draft21</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwt.html">JSON Web Token (JWT) : draft19</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws.html">JSON Web Signature (JWS) : draft25</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws_hok.html">Holder-of-Key JSON Web Signature (JWS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwe.html">JSON Web Encryption (JWE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwk.html">JSON Web Key (JWK) : draft24</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws_js.html">JSON Web Signature JSON Serialization (JWS-JS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwe_js.html">JSON Web Encryption JSON Serialization (JWE-JS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jose_usecase.html">Use Cases and Requirements for JSON Object Signing and Encryption (JOSE)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hostmeta.html">Web Host Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="webfinger.html">WebFinger</a></li>
<li class="toctree-l1"><a class="reference internal" href="swd.html">Simple Web Discovery (SWD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="acct.html">The &#8216;acct&#8217; URI Scheme</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rfc3394.html">RFC3394:Advanced Encryption Standard (AES) Key Wrap Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="nist-sp-800-59a.html">NIST SP 800-56A:Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="nist-sp-800-63.html">Electronic Authentication Guideline</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="backplane.html">Backplane</a></li>
<li class="toctree-l1"><a class="reference internal" href="backplane.html#backplane-2-0">Backplane 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="lrdd.html">LRDD: Link-based Resource Descriptor Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="revoke.html">Token Revocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="poco.html">Portable Contacts 1.0 Draft C</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Terms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="saml.html">SAML</a></li>
<li class="toctree-l1"><a class="reference internal" href="xacml.html">XACML</a></li>
<li class="toctree-l1"><a class="reference internal" href="shibboleth.html">Shibboleth</a></li>
<li class="toctree-l1"><a class="reference internal" href="SamlHokProfile.html">SAML V2.0 Holder-of-Key Assertion Profile Version 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="SamlHokWebSsoProfile.html">SAML V2.0 Holder-of-Key Web Browser SSO Profile Version 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="wss_saml_token_profile.html">Web Services Security SAML Token Profile Version 1.1.1</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scim_rest.html">Simple Cloud Identity Management: Protocol 1.0 (REST API 1.0)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="active_directory.html">Active Directory &amp; Connect</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO/TBD</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource.html">Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion.html">Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="signed_nonce.html">Decoupling Identity and Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="adtech.html">AdTech</a></li>
<li class="toctree-l1"><a class="reference internal" href="technight_9.html">Technight #9</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="well-known.html">RFC5783: Defining Well-Known Uniform Resource Identifiers (URIs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rfc5988.html">RFC5988:Web Linking</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="impl_id_token.html">ID Token:Implementation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">JOSE JWS:Implementation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">JOSE JWS:Implementation</a><ul>
<li><a class="reference internal" href="#dependancy">Dependancy</a><ul>
<li><a class="reference internal" href="#m2crypto">M2Crypto</a></li>
<li><a class="reference internal" href="#bouncycastle">BouncyCastle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jws-token">JWS Token</a><ul>
<li><a class="reference internal" href="#base64url">base64url</a><ul>
<li><a class="reference internal" href="#python">Python</a></li>
<li><a class="reference internal" href="#c">C#:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#token">Token</a><ul>
<li><a class="reference internal" href="#jws-create-token">jws_create_token()</a><ul>
<li><a class="reference internal" href="#id2">Python</a></li>
<li><a class="reference internal" href="#id3">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jws-verify-token">jws_verify_token()</a><ul>
<li><a class="reference internal" href="#id4">Python</a></li>
<li><a class="reference internal" href="#id5">C#</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#rsa-and-x-509">RSA and X.509</a><ul>
<li><a class="reference internal" href="#key-negotiation-in-advance">Key negotiation in advance</a><ul>
<li><a class="reference internal" href="#rp-registartion">RP : Registartion</a></li>
<li><a class="reference internal" href="#op-discovery-information">OP:Discovery Information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#session-wise-key-negotiation">Session-wise Key Negotiation</a><ul>
<li><a class="reference internal" href="#id6">Python</a></li>
<li><a class="reference internal" href="#id7">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sign-verify-with-rsa-key-and-x-509-certificate">Sign/Verify with RSA Key and X.509 Certificate</a><ul>
<li><a class="reference internal" href="#sha-name">sha_name()</a><ul>
<li><a class="reference internal" href="#id8">Python</a></li>
<li><a class="reference internal" href="#id9">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rsa-sign">rsa_sign()</a><ul>
<li><a class="reference internal" href="#id10">Python</a></li>
<li><a class="reference internal" href="#id11">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rsa-verify">rsa_verify()</a><ul>
<li><a class="reference internal" href="#id12">Python</a></li>
<li><a class="reference internal" href="#id13">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pem-in-c">PEM in C#</a><ul>
<li><a class="reference internal" href="#x-509-certificate-im-pem">X.509 Certificate im PEM</a></li>
<li><a class="reference internal" href="#der-private-key-im-pem">DER Private Key im PEM</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#hmac-and-shared-secret">HMAC and Shared Secret</a><ul>
<li><a class="reference internal" href="#shared-secrete-negotiation-on-client-registartion">Shared Secrete negotiation  on Client  Registartion</a></li>
<li><a class="reference internal" href="#signature">Signature?</a></li>
<li><a class="reference internal" href="#hmac-sign">hmac_sign()</a><ul>
<li><a class="reference internal" href="#id14">Python</a></li>
<li><a class="reference internal" href="#id15">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hmac-verify">hmac_verify()</a><ul>
<li><a class="reference internal" href="#id16">Python</a></li>
<li><a class="reference internal" href="#id17">C#</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ecdsa">ECDSA</a></li>
<li><a class="reference internal" href="#libraries">Libraries</a><ul>
<li><a class="reference internal" href="#id18">Python</a></li>
<li><a class="reference internal" href="#id19">C#</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li><a href="impl_id_token.html"
         title="Previous Chapter: ID Token:Implementation">&laquo; ID Token:Impleme...</a></li>
              
            
            
            
            
              <li>
<div id="sourcelink">
  <a href="sources/impl_jws.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="jose-jws-implementation">
<h1><a class="toc-backref" href="#id20">JOSE JWS:Implementation</a><a class="headerlink" href="#jose-jws-implementation" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="id1">
<p class="topic-title first">JOSE JWS Implementation</p>
<ul class="simple">
<li><a class="reference internal" href="#jose-jws-implementation" id="id20">JOSE JWS:Implementation</a><ul>
<li><a class="reference internal" href="#dependancy" id="id21">Dependancy</a><ul>
<li><a class="reference internal" href="#m2crypto" id="id22">M2Crypto</a></li>
<li><a class="reference internal" href="#bouncycastle" id="id23">BouncyCastle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jws-token" id="id24">JWS Token</a><ul>
<li><a class="reference internal" href="#base64url" id="id25">base64url</a><ul>
<li><a class="reference internal" href="#python" id="id26">Python</a></li>
<li><a class="reference internal" href="#c" id="id27">C#:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#token" id="id28">Token</a><ul>
<li><a class="reference internal" href="#jws-create-token" id="id29">jws_create_token()</a><ul>
<li><a class="reference internal" href="#id2" id="id30">Python</a></li>
<li><a class="reference internal" href="#id3" id="id31">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jws-verify-token" id="id32">jws_verify_token()</a><ul>
<li><a class="reference internal" href="#id4" id="id33">Python</a></li>
<li><a class="reference internal" href="#id5" id="id34">C#</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#rsa-and-x-509" id="id35">RSA and X.509</a><ul>
<li><a class="reference internal" href="#key-negotiation-in-advance" id="id36">Key negotiation in advance</a><ul>
<li><a class="reference internal" href="#rp-registartion" id="id37">RP : Registartion</a></li>
<li><a class="reference internal" href="#op-discovery-information" id="id38">OP:Discovery Information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#session-wise-key-negotiation" id="id39">Session-wise Key Negotiation</a><ul>
<li><a class="reference internal" href="#id6" id="id40">Python</a></li>
<li><a class="reference internal" href="#id7" id="id41">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sign-verify-with-rsa-key-and-x-509-certificate" id="id42">Sign/Verify with RSA Key and X.509 Certificate</a><ul>
<li><a class="reference internal" href="#sha-name" id="id43">sha_name()</a><ul>
<li><a class="reference internal" href="#id8" id="id44">Python</a></li>
<li><a class="reference internal" href="#id9" id="id45">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rsa-sign" id="id46">rsa_sign()</a><ul>
<li><a class="reference internal" href="#id10" id="id47">Python</a></li>
<li><a class="reference internal" href="#id11" id="id48">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rsa-verify" id="id49">rsa_verify()</a><ul>
<li><a class="reference internal" href="#id12" id="id50">Python</a></li>
<li><a class="reference internal" href="#id13" id="id51">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pem-in-c" id="id52">PEM in C#</a><ul>
<li><a class="reference internal" href="#x-509-certificate-im-pem" id="id53">X.509 Certificate im PEM</a></li>
<li><a class="reference internal" href="#der-private-key-im-pem" id="id54">DER Private Key im PEM</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#hmac-and-shared-secret" id="id55">HMAC and Shared Secret</a><ul>
<li><a class="reference internal" href="#shared-secrete-negotiation-on-client-registartion" id="id56">Shared Secrete negotiation  on Client  Registartion</a></li>
<li><a class="reference internal" href="#signature" id="id57">Signature?</a></li>
<li><a class="reference internal" href="#hmac-sign" id="id58">hmac_sign()</a><ul>
<li><a class="reference internal" href="#id14" id="id59">Python</a></li>
<li><a class="reference internal" href="#id15" id="id60">C#</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hmac-verify" id="id61">hmac_verify()</a><ul>
<li><a class="reference internal" href="#id16" id="id62">Python</a></li>
<li><a class="reference internal" href="#id17" id="id63">C#</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ecdsa" id="id64">ECDSA</a></li>
<li><a class="reference internal" href="#libraries" id="id65">Libraries</a><ul>
<li><a class="reference internal" href="#id18" id="id66">Python</a></li>
<li><a class="reference internal" href="#id19" id="id67">C#</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>ECDSA must be implemented</li>
</ul>
</div>
<div class="section" id="dependancy">
<h2><a class="toc-backref" href="#id21">Dependancy</a><a class="headerlink" href="#dependancy" title="Permalink to this headline">¶</a></h2>
<div class="section" id="m2crypto">
<h3><a class="toc-backref" href="#id22">M2Crypto</a><a class="headerlink" href="#m2crypto" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.heikkitoivonen.net/m2crypto/api/">http://www.heikkitoivonen.net/m2crypto/api/</a></li>
</ul>
</div>
<div class="section" id="bouncycastle">
<h3><a class="toc-backref" href="#id23">BouncyCastle</a><a class="headerlink" href="#bouncycastle" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.bouncycastle.org/csharp/">http://www.bouncycastle.org/csharp/</a></li>
</ul>
</div>
</div>
<div class="section" id="jws-token">
<h2><a class="toc-backref" href="#id24">JWS Token</a><a class="headerlink" href="#jws-token" title="Permalink to this headline">¶</a></h2>
<div class="section" id="base64url">
<h3><a class="toc-backref" href="#id25">base64url</a><a class="headerlink" href="#base64url" title="Permalink to this headline">¶</a></h3>
<div class="section" id="python">
<h4><a class="toc-backref" href="#id26">Python</a><a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">to_base64url</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">src</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">from_base64url</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64decode</span><span class="p">(</span><span class="n">src</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span> <span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="c">
<h4><a class="toc-backref" href="#id27">C#:</a><a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h4>
<div class="highlight-csharp"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">ToBase64Url</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">input</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">StringBuilder</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">(</span>
                   <span class="n">Convert</span><span class="p">.</span><span class="n">ToBase64String</span><span class="p">(</span><span class="n">input</span><span class="p">).</span><span class="n">TrimEnd</span><span class="p">(</span><span class="sc">&#39;=&#39;</span><span class="p">));</span>
    <span class="n">result</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="sc">&#39;+&#39;</span><span class="p">,</span> <span class="sc">&#39;-&#39;</span><span class="p">);</span>
    <span class="n">result</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="sc">&#39;/&#39;</span><span class="p">,</span> <span class="sc">&#39;_&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">FromBase64Url</span><span class="p">(</span><span class="kt">string</span> <span class="n">base64ForUrlInput</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">padChars</span> <span class="p">=</span> <span class="p">(</span><span class="n">base64ForUrlInput</span><span class="p">.</span><span class="n">Length</span> <span class="p">%</span> <span class="m">4</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span> <span class="p">?</span> <span class="m">0</span>
                 <span class="p">:</span> <span class="p">(</span><span class="m">4</span> <span class="p">-</span> <span class="p">(</span><span class="n">base64ForUrlInput</span><span class="p">.</span><span class="n">Length</span> <span class="p">%</span> <span class="m">4</span><span class="p">));</span>
    <span class="n">StringBuilder</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">(</span>
                               <span class="n">base64ForUrlInput</span><span class="p">,</span>
                               <span class="n">base64ForUrlInput</span><span class="p">.</span><span class="n">Length</span> <span class="p">+</span> <span class="n">padChars</span><span class="p">);</span>
    <span class="n">result</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">.</span><span class="n">PadRight</span><span class="p">(</span><span class="n">padChars</span><span class="p">,</span> <span class="sc">&#39;=&#39;</span><span class="p">));</span>
    <span class="n">result</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="sc">&#39;-&#39;</span><span class="p">,</span> <span class="sc">&#39;+&#39;</span><span class="p">);</span>
    <span class="n">result</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="sc">&#39;_&#39;</span><span class="p">,</span> <span class="sc">&#39;/&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="n">FromBase64String</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="token">
<h3><a class="toc-backref" href="#id28">Token</a><a class="headerlink" href="#token" title="Permalink to this headline">¶</a></h3>
<div class="section" id="jws-create-token">
<h4><a class="toc-backref" href="#id29">jws_create_token()</a><a class="headerlink" href="#jws-create-token" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id2">
<h5><a class="toc-backref" href="#id30">Python</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">jws_create_token</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="n">payload</span> <span class="p">,</span><span class="n">secret</span><span class="p">,</span><span class="n">pem_private_key</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param header: JWS Header JSON</span>
<span class="sd">        :param payload: JWS Payload in JSON</span>
<span class="sd">        :param secret: Shared Secret for HMAC</span>
<span class="sd">        :param pem_private_key: RSA/DSA Private Key in PEM format</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">jws_header</span><span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span> <span class="n">header</span> <span class="p">)</span>        <span class="c">#dumps produdes utf8 string by default</span>
    <span class="n">jws_payload</span><span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span> <span class="n">payload</span> <span class="p">)</span>

    <span class="n">encoded_jws_header</span> <span class="o">=</span> <span class="n">to_base64url</span><span class="p">(</span><span class="n">jws_header</span><span class="p">)</span>
    <span class="n">encoded_jws_payload</span><span class="o">=</span> <span class="n">to_base64url</span><span class="p">(</span><span class="n">jws_payload</span><span class="p">)</span>

    <span class="n">jws_secured_input</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">encoded_jws_header</span><span class="p">,</span> <span class="n">encoded_jws_payload</span> <span class="p">)</span>
    <span class="n">jws_signature</span> <span class="o">=</span> <span class="n">_sign</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="n">pem_private_key</span><span class="p">,</span>
                            <span class="n">header</span><span class="p">[</span><span class="s">&#39;alg&#39;</span><span class="p">],</span>
                            <span class="n">jws_secured_input</span> <span class="p">)</span>

    <span class="n">encoded_jws_signature</span> <span class="o">=</span> <span class="n">to_base64url</span><span class="p">(</span><span class="n">jws_signature</span><span class="p">)</span>
    <span class="n">jws_token</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">encoded_jws_header</span><span class="p">,</span><span class="n">encoded_jws_payload</span><span class="p">,</span> <span class="n">encoded_jws_signature</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">jws_token</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#  alg : [HRE]S[256|384|512]</span>

<span class="n">token</span> <span class="o">=</span> <span class="n">create_jws_token_rsa</span><span class="p">(</span>
        <span class="p">{</span><span class="s">&quot;typ&quot;</span><span class="p">:</span><span class="s">&quot;JWT&quot;</span><span class="p">,</span><span class="s">&quot;alg&quot;</span><span class="p">:</span><span class="s">&quot;RS256&quot;</span><span class="p">},</span>                    <span class="c">#:Header</span>
        <span class="p">{</span><span class="s">&quot;iss&quot;</span><span class="p">:</span><span class="s">&quot;alice&quot;</span><span class="p">,</span><span class="s">&quot;aud&quot;</span><span class="p">:</span><span class="s">&quot;bob&quot;</span><span class="p">,</span><span class="s">&quot;user_id&quot;</span><span class="p">:</span><span class="s">&quot;charlie&quot;</span><span class="p">},</span><span class="c">#:Payload</span>
        <span class="n">secret</span><span class="p">,</span>                                         <span class="c">#:for HMAC</span>
        <span class="n">Idp</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">issuer</span><span class="o">=</span><span class="s">&quot;me&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">private_key</span>        <span class="c">#: Load private key</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5><a class="toc-backref" href="#id31">C#</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<div class="highlight-csharp"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">JwsCreateToken</span><span class="p">(</span>
    <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">header</span><span class="p">,</span>
    <span class="kt">object</span> <span class="n">payload</span><span class="p">,</span>
    <span class="kt">string</span> <span class="n">secret</span><span class="p">,</span>
    <span class="kt">string</span> <span class="n">pem_private_key</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">jws_header</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">SerializeObject</span><span class="p">(</span><span class="n">header</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">jws_payload</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">SerializeObject</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>

    <span class="kt">string</span> <span class="n">encoded_jws_header</span> <span class="p">=</span> <span class="n">Jose</span><span class="p">.</span><span class="n">Utils</span><span class="p">.</span><span class="n">ToBase64Url</span><span class="p">(</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">jws_header</span><span class="p">));</span>
    <span class="kt">string</span> <span class="n">encoded_jws_payload</span> <span class="p">=</span> <span class="n">Jose</span><span class="p">.</span><span class="n">Utils</span><span class="p">.</span><span class="n">ToBase64Url</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">jws_payload</span><span class="p">));</span>

    <span class="kt">string</span> <span class="n">jws_secured_input</span> <span class="p">=</span> <span class="n">encoded_jws_header</span> <span class="p">+</span> <span class="s">&quot;.&quot;</span> <span class="p">+</span> <span class="n">encoded_jws_payload</span><span class="p">;</span>

    <span class="kt">byte</span><span class="p">[]</span> <span class="n">jws_signature</span> <span class="p">=</span> <span class="n">_sign</span><span class="p">(</span><span class="n">secrete</span><span class="p">,</span>
                                <span class="n">pem_private_key</span><span class="p">,</span>
                                <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">header</span><span class="p">[</span><span class="s">&quot;alg&quot;</span><span class="p">],</span>
                                <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">jws_secured_input</span><span class="p">));</span>

    <span class="kt">string</span> <span class="n">encoded_jws_signature</span> <span class="p">=</span> <span class="n">Jose</span><span class="p">.</span><span class="n">Utils</span><span class="p">.</span><span class="n">ToBase64Url</span><span class="p">(</span><span class="n">jws_signature</span><span class="p">);</span>

    <span class="k">return</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0}.{1}.{2}&quot;</span><span class="p">,</span>
                <span class="n">encoded_jws_header</span><span class="p">,</span> <span class="n">encoded_jws_payload</span><span class="p">,</span> <span class="n">encoded_jws_signature</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-csharp"><pre>// just a sample
Dictionary&lt;string, object&gt; header = new Dictionary&lt;string, object&gt;()
                                        { { "typ", "JWT" },
                                          { "alg", "RS256" } };
Dictionary&lt;string, object&gt; payload = new Dictionary&lt;string, object&gt;()
                                        { { "iss", "alice" },
                                          { "aud", "bob" },
                                          { "user_id", "charlie" } };
// for RSA ( Shared Secret in null )
string token = Jose.Jws.CreateTokenRsa( header,
                                        payload,
                                        null,
                                        GetIdpByName('alice").private_key);</pre>
</div>
</div>
</div>
<div class="section" id="jws-verify-token">
<h4><a class="toc-backref" href="#id32">jws_verify_token()</a><a class="headerlink" href="#jws-verify-token" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id4">
<h5><a class="toc-backref" href="#id33">Python</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">jws_verify_token</span><span class="p">(</span><span class="n">jws_token</span><span class="p">,</span><span class="n">secret</span><span class="p">,</span><span class="n">pem_x509</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param jws_token:  JWS Token</span>
<span class="sd">        :param secret:  Shared Secret for HMAC</span>
<span class="sd">        :param pem_x509: X.509 Certificate for RSA, ECDSA</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">encoded_jws_header</span><span class="p">,</span><span class="n">encoded_jws_payload</span><span class="p">,</span><span class="n">encoded_jws_signature</span><span class="p">)</span> <span class="o">=</span> <span class="n">jws_token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>

    <span class="n">jws_header</span> <span class="o">=</span> <span class="n">from_base64url</span><span class="p">(</span><span class="n">encoded_jws_header</span><span class="p">)</span>
    <span class="n">jws_payload</span> <span class="o">=</span> <span class="n">from_base64url</span><span class="p">(</span><span class="n">encoded_jws_payload</span><span class="p">)</span>
    <span class="n">jws_signature</span><span class="o">=</span><span class="n">from_base64url</span><span class="p">(</span><span class="n">encoded_jws_signature</span><span class="p">)</span>

    <span class="n">jws_secured_input</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">encoded_jws_header</span><span class="p">,</span> <span class="n">encoded_jws_payload</span> <span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jws_header</span><span class="p">)</span>

    <span class="n">is_valid</span> <span class="o">=</span> <span class="n">_verify</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="n">pem_x509</span><span class="p">,</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;alg&#39;</span><span class="p">],</span><span class="n">jws_secured_input</span><span class="p">,</span> <span class="n">jws_signature</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">is_valid</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jws_payload</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">pem_x509 can be None for session wise certificate negotiation.
There should be the other utility which fetch and validate the certficate
based on <strong>header</strong> decoded from <strong>jws_token</strong> .</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">is_valid</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span> <span class="o">=</span> <span class="n">verify_jws_token</span><span class="p">(</span>
                                <span class="n">token</span><span class="p">,</span>
                                <span class="n">secret</span><span class="p">,</span>
                                <span class="n">Op</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">issuer</span><span class="o">=</span><span class="s">&quot;alice&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">x509_cert_cache</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5><a class="toc-backref" href="#id34">C#</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<div class="highlight-csharp"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">JwsVerifyToken</span><span class="p">(</span><span class="kt">string</span> <span class="n">jws_token</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span><span class="n">secret</span><span class="p">,</span><span class="kt">string</span> <span class="n">pem_x509</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Match</span> <span class="n">m</span><span class="p">=</span>  <span class="p">(</span><span class="k">new</span> <span class="n">Regex</span><span class="p">(</span><span class="s">@&quot;^(?&lt;encoded_jws_header&gt;.+)\.(?&lt;encoded_jws_payload&gt;.+)\.(?&lt;encoded_jws_signature&gt;.+)$&quot;</span><span class="p">)).</span><span class="n">Match</span><span class="p">(</span><span class="n">jws_token</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">jws_header</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span>
                            <span class="n">Jose</span><span class="p">.</span><span class="n">Utils</span><span class="p">.</span><span class="n">FromBase64Url</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&quot;encoded_jws_header&quot;</span><span class="p">].</span><span class="n">Value</span><span class="p">))</span> <span class="p">;</span>
    <span class="kt">string</span> <span class="n">jws_payload</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span>
                            <span class="n">Jose</span><span class="p">.</span><span class="n">Utils</span><span class="p">.</span><span class="n">FromBase64Url</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&quot;encoded_jws_header&quot;</span><span class="p">].</span><span class="n">Value</span><span class="p">))</span> <span class="p">;</span>
    <span class="kt">byte</span><span class="p">[]</span> <span class="n">jws_signature</span> <span class="p">=</span> <span class="n">Jose</span><span class="p">.</span><span class="n">Utils</span><span class="p">.</span><span class="n">FromBase64Url</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&quot;encoded_jws_signature&quot;</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>

    <span class="kt">string</span> <span class="n">jws_secured_input</span> <span class="p">=</span> <span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&quot;encoded_jws_header&quot;</span><span class="p">].</span><span class="n">Value</span> <span class="p">+</span> <span class="s">&quot;.&quot;</span> <span class="p">+</span>  <span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&quot;encoded_jws_payload&quot;</span><span class="p">].</span><span class="n">Value</span><span class="p">;</span>

    <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">header</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;&gt;(</span><span class="n">jws_header</span><span class="p">);</span>

    <span class="kt">bool</span> <span class="n">ret</span> <span class="p">=</span> <span class="n">_verify</span><span class="p">(</span><span class="n">pem_x509</span><span class="p">,</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">header</span><span class="p">[</span><span class="s">&quot;alg&quot;</span><span class="p">],</span>
                   <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">jws_secured_input</span><span class="p">),</span>
                    <span class="n">jws_signature</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">// just a sample</span>
<span class="kt">bool</span> <span class="n">ret</span> <span class="p">=</span> <span class="n">Jose</span><span class="p">.</span><span class="n">Jws</span><span class="p">.</span><span class="n">VerifyTokenRsa</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span><span class="n">GetOpByName</span><span class="p">(</span><span class="s">&quot;alice&quot;</span><span class="p">).</span><span class="n">x509_cache</span><span class="p">);</span>
</pre></div>
</div>
<p>So what is _sign() and _verify() ?
Actula funcitons will vary based on &#8220;alg&#8221;orithm paramter:
rsa_sign() and rsa_vefiy() for RSA, hmac_sign() and hamc_verify for HMAC.</p>
</div>
</div>
</div>
</div>
<div class="section" id="rsa-and-x-509">
<h2><a class="toc-backref" href="#id35">RSA and X.509</a><a class="headerlink" href="#rsa-and-x-509" title="Permalink to this headline">¶</a></h2>
<div class="section" id="key-negotiation-in-advance">
<h3><a class="toc-backref" href="#id36">Key negotiation in advance</a><a class="headerlink" href="#key-negotiation-in-advance" title="Permalink to this headline">¶</a></h3>
<p>Any RP and OP can negotiate their private keys and X.509 certificate
in advance before a OpenID Connect session begins.</p>
<div class="section" id="rp-registartion">
<h4><a class="toc-backref" href="#id37">RP : Registartion</a><a class="headerlink" href="#rp-registartion" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>An Relying Party  can register it&#8217;s X.509 certificate via <a class="reference internal" href="reg.html"><em>OpenID Connect Dynamic Client Registration 1.0</em></a>.</li>
<li><a class="reference internal" href="oauth_reg.html#term-34"><em class="xref std std-term">x509_url</em></a> is the RP&#8217;s X.509 Certificate for OP
to verify requsets&#8217; signatures, or public-encrypt token and other data.</li>
<li>If RP ask OP to encrypt wth the other public key,
<a class="reference internal" href="oauth_reg.html#term-35"><em class="xref std std-term">x509_encryption_url</em></a> can be specified.</li>
<li>If you want to specify <a class="reference internal" href="oauth_reg.html#term-32"><em class="xref std std-term">jwk_url</em></a> as well, both keys must be the same.</li>
<li>So do <a class="reference internal" href="oauth_reg.html#term-35"><em class="xref std std-term">x509_encryption_url</em></a> and <a class="reference internal" href="oauth_reg.html#term-33"><em class="xref std std-term">jwk_encryption_url</em></a>.</li>
<li>Format is <a class="reference internal" href="glossary.html#term-288"><em class="xref std std-term">PEM</em></a></li>
</ul>
</div>
<div class="section" id="op-discovery-information">
<h4><a class="toc-backref" href="#id38">OP:Discovery Information</a><a class="headerlink" href="#op-discovery-information" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>OP can advertise its public key for signing and encrypton via <a class="reference internal" href="discovery.html"><em>OpenID Connect Discovery 1.0</em></a></li>
<li>As with RP in <a class="reference internal" href="reg.html"><em>OpenID Connect Dynamic Client Registration 1.0</em></a>, both <a class="reference internal" href="oauth_reg.html#term-34"><em class="xref std std-term">x509_url</em></a> and <a class="reference internal" href="oauth_reg.html#term-35"><em class="xref std std-term">x509_encryption_url</em></a> work
in the same way.</li>
<li>So do <a class="reference internal" href="oauth_reg.html#term-32"><em class="xref std std-term">jwk_url</em></a> and <a class="reference internal" href="oauth_reg.html#term-33"><em class="xref std std-term">jwk_encryption_url</em></a>.</li>
<li>Format is <a class="reference internal" href="glossary.html#term-288"><em class="xref std std-term">PEM</em></a></li>
</ul>
</div>
</div>
<div class="section" id="session-wise-key-negotiation">
<h3><a class="toc-backref" href="#id39">Session-wise Key Negotiation</a><a class="headerlink" href="#session-wise-key-negotiation" title="Permalink to this headline">¶</a></h3>
<p>Any RP can specifiy its X.509 certificate for the private key used to sign a OpenID Request Object.
Also any OP can specify its X.509 certificate for the private key used to sign tokens or response data.
To do those, JWS header provides the following X.509 parameters.  {See <a class="reference internal" href="jws.html#jws-4-1"><em>4.1.  Reserved Header Parameter Names</em></a> )</p>
<table border="1" class="docutils">
<caption>JWS X.509 Header Parameters</caption>
<colgroup>
<col width="10%" />
<col width="45%" />
<col width="45%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>x5u</td>
<td>URL, like as <a class="reference internal" href="oauth_reg.html#term-34"><em class="xref std std-term">x509_url</em></a> in <a class="reference internal" href="reg.html"><em>OpenID Connect Dynamic Client Registration 1.0</em></a> and <a class="reference internal" href="discovery.html"><em>OpenID Connect Discovery 1.0</em></a>.</td>
<td>Format of data returned by this URL is <a class="reference internal" href="glossary.html#term-288"><em class="xref std std-term">PEM</em></a></td>
</tr>
<tr class="row-even"><td>x5c</td>
<td>X.509 certificate(chain) used this JWS</td>
<td>base64-encode <a class="reference internal" href="glossary.html#term-der"><em class="xref std std-term">DER</em></a>/<a class="reference internal" href="glossary.html#term-170"><em class="xref std std-term">BER</em></a> ( <strong>NOT</strong> in <a class="reference internal" href="session.html#term-base64url"><em class="xref std std-term">base64url</em></a> )</td>
</tr>
<tr class="row-odd"><td>x5t</td>
<td>SHA-1 thumprint of :<a class="reference internal" href="glossary.html#term-der"><em class="xref std std-term">DER</em></a> (binary) encoded X.509 certificate</td>
<td>base64url encoded thumprint</td>
</tr>
</tbody>
</table>
<p>Fingerprint of specifed <a class="reference internal" href="glossary.html#term-288"><em class="xref std std-term">PEM</em></a> certificate.</p>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id40">Python</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">M2Crypto</span> <span class="kn">import</span> <span class="n">X509</span>
<span class="kn">import</span> <span class="nn">utils</span>
<span class="k">def</span> <span class="nf">x5t</span><span class="p">(</span><span class="n">cert_string</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; format</span>
<span class="sd">        = 0 (M2Crypto.X509.DER_FORMAT)</span>
<span class="sd">        = 1 (M2Crypto.X509.PEM_FORMAT)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cert</span> <span class="o">=</span> <span class="n">X509</span><span class="o">.</span><span class="n">load_cert_string</span><span class="p">(</span><span class="n">cert_string</span><span class="p">,</span><span class="n">format</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_base64url</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">from_hex_string</span><span class="p">(</span>
                <span class="n">cert</span><span class="o">.</span><span class="n">get_fingerprint</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="s">&#39;sha1&#39;</span><span class="p">))</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4><a class="toc-backref" href="#id41">C#</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="highlight-csharp"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetFingerprint</span><span class="p">(</span><span class="n">X509Certificate</span> <span class="n">cert</span><span class="p">,</span>
                                        <span class="kt">string</span> <span class="n">digester_name</span><span class="p">=</span><span class="s">&quot;SHA1&quot;</span><span class="p">)</span>
<span class="p">{</span>

    <span class="n">IDigest</span> <span class="n">digester</span> <span class="p">=</span> <span class="n">DigestUtilities</span><span class="p">.</span><span class="n">GetDigest</span><span class="p">(</span><span class="n">digester_name</span><span class="p">);</span>
    <span class="kt">byte</span><span class="p">[]</span> <span class="n">der</span> <span class="p">=</span> <span class="n">cert</span><span class="p">.</span><span class="n">GetEncoded</span><span class="p">();</span>

    <span class="n">digester</span><span class="p">.</span><span class="n">BlockUpdate</span><span class="p">(</span><span class="n">der</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">der</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>

    <span class="kt">byte</span><span class="p">[]</span> <span class="n">hash</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">digester</span><span class="p">.</span><span class="n">GetDigestSize</span><span class="p">()];</span>
    <span class="n">digester</span><span class="p">.</span><span class="n">DoFinal</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">Jose</span><span class="p">.</span><span class="n">Utils</span><span class="p">.</span><span class="n">ToBase64Url</span><span class="p">(</span><span class="n">hash</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetFingerprint</span><span class="p">(</span><span class="kt">string</span> <span class="n">pem_x509</span><span class="p">,</span><span class="kt">string</span>
                                        <span class="n">digerster_name</span><span class="p">=</span><span class="s">&quot;SHA1&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nf">GetFingerprint</span><span class="p">(</span><span class="n">CertificateFromPem</span><span class="p">(</span><span class="n">pem_x509</span><span class="p">),</span> <span class="n">digerster_name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sign-verify-with-rsa-key-and-x-509-certificate">
<h3><a class="toc-backref" href="#id42">Sign/Verify with RSA Key and X.509 Certificate</a><a class="headerlink" href="#sign-verify-with-rsa-key-and-x-509-certificate" title="Permalink to this headline">¶</a></h3>
<div class="section" id="sha-name">
<h4><a class="toc-backref" href="#id43">sha_name()</a><a class="headerlink" href="#sha-name" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>select proper SHA digest function for <strong>alg</strong> .</li>
</ul>
<div class="section" id="id8">
<h5><a class="toc-backref" href="#id44">Python</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">sha_name</span><span class="p">(</span><span class="n">alg</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param alg: Algorithms defined in JWA</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="s">&quot;sha</span><span class="si">%(bits)s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;[HRE]S(?P&lt;bits&gt;\d+)$&#39;</span><span class="p">,</span><span class="n">alg</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h5><a class="toc-backref" href="#id45">C#</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">// Look at &quot;security/SignerUtilities.cs&quot; of BouncyCastle</span>
<span class="c1">// for RSA signature algorithm.</span>

<span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">SignerName</span><span class="p">(</span><span class="kt">string</span> <span class="n">alg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Regex</span> <span class="n">re</span><span class="p">=</span> <span class="k">new</span> <span class="n">Regex</span><span class="p">(</span><span class="s">&quot;^RS(?&lt;bits&gt;\\d+)$&quot;</span><span class="p">);</span>
    <span class="n">Match</span> <span class="n">m</span> <span class="p">=</span> <span class="n">re</span><span class="p">.</span><span class="n">Match</span><span class="p">(</span><span class="n">alg</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">m</span><span class="p">!=</span> <span class="k">null</span> <span class="p">){</span>
        <span class="k">return</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;SHA{0}WITHRSA&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&quot;bits&quot;</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="rsa-sign">
<h4><a class="toc-backref" href="#id46">rsa_sign()</a><a class="headerlink" href="#rsa-sign" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id10">
<h5><a class="toc-backref" href="#id47">Python</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">M2Crypto</span> <span class="kn">import</span> <span class="n">RSA</span><span class="p">,</span><span class="n">util</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="k">def</span> <span class="nf">rsa_sign</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="n">private_key_pem</span><span class="p">,</span> <span class="n">alg</span><span class="p">,</span> <span class="n">secure_input</span> <span class="p">,</span><span class="n">passphrase</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param secret: ignored for RSA</span>
<span class="sd">        :param private_key_pem: PEM string of private key of signer</span>
<span class="sd">        :param alg: Algorithms defined in JWA</span>
<span class="sd">        :param secure_input: Message for digest input</span>
<span class="sd">        :param passphrase: (optional) pass phrase for private key</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">_passphrase</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">passphrase</span>

    <span class="n">callback</span> <span class="o">=</span> <span class="n">_passphrase</span> <span class="k">if</span> <span class="n">passphrase</span> <span class="k">else</span> <span class="n">util</span><span class="o">.</span><span class="n">passphrase_callback</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">load_key_string</span><span class="p">(</span><span class="n">private_key_pem</span><span class="p">,</span><span class="n">callback</span><span class="o">=</span><span class="n">callback</span> <span class="p">)</span>

    <span class="n">sha</span><span class="o">=</span><span class="n">sha_name</span><span class="p">(</span><span class="n">alg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hashlib</span><span class="p">,</span><span class="n">sha</span><span class="p">)(</span><span class="n">secure_input</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">(),</span><span class="n">sha</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h5><a class="toc-backref" href="#id48">C#</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
<div class="highlight-csharp"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">RsaSign</span><span class="p">(</span><span class="kt">string</span> <span class="n">secret</span><span class="p">,</span><span class="kt">string</span> <span class="n">key_pem</span><span class="p">,</span>
            <span class="kt">string</span> <span class="n">alg</span><span class="p">,</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">secure_input</span> <span class="p">,</span><span class="kt">string</span> <span class="n">passphrase</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// secret is isngored for RSA</span>

    <span class="kt">var</span> <span class="n">signer</span> <span class="p">=</span> <span class="n">SignerUtilities</span><span class="p">.</span><span class="n">GetSigner</span><span class="p">(</span><span class="n">SignerName</span><span class="p">(</span><span class="n">alg</span><span class="p">));</span>
    <span class="n">signer</span><span class="p">.</span><span class="n">Init</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="n">RsaPrivateKeyFromPem</span><span class="p">(</span><span class="n">key_pem</span><span class="p">));</span>
    <span class="n">signer</span><span class="p">.</span><span class="n">BlockUpdate</span><span class="p">(</span><span class="n">secure_input</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">secure_input</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">signer</span><span class="p">.</span><span class="n">GenerateSignature</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last">Find to load PEM private key secured with pass phrase.</p>
</div>
</div>
</div>
<div class="section" id="rsa-verify">
<h4><a class="toc-backref" href="#id49">rsa_verify()</a><a class="headerlink" href="#rsa-verify" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id12">
<h5><a class="toc-backref" href="#id50">Python</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">M2Crypto</span> <span class="kn">import</span> <span class="n">X509</span>

<span class="k">def</span> <span class="nf">rsa_verify</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="n">x509_pem</span><span class="p">,</span> <span class="n">alg</span><span class="p">,</span> <span class="n">secure_input</span> <span class="p">,</span><span class="n">signature</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param secret: ignored for RSA</span>
<span class="sd">        :param x509_pem: PEM string of signer&#39;s X.509 certificate</span>
<span class="sd">        :param alg: Algorithms defined in JWA</span>
<span class="sd">        :param secure_input: Message for digest input</span>
<span class="sd">        :param signature: signature which OP has signed.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">pub</span><span class="o">=</span> <span class="n">X509</span><span class="o">.</span><span class="n">load_cert_string</span><span class="p">(</span><span class="n">x509_pem</span><span class="p">)</span><span class="o">.</span><span class="n">get_pubkey</span><span class="p">()</span>
    <span class="n">sha</span><span class="o">=</span><span class="n">sha_name</span><span class="p">(</span><span class="n">alg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pub</span><span class="o">.</span><span class="n">get_rsa</span><span class="p">()</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hashlib</span><span class="p">,</span><span class="n">sha</span><span class="p">)(</span><span class="n">secure_input</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">(),</span><span class="n">signature</span><span class="p">,</span><span class="n">sha</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h5><a class="toc-backref" href="#id51">C#</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h5>
<div class="highlight-csharp"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">RsaVerify</span><span class="p">(</span><span class="kt">string</span> <span class="n">secret</span><span class="p">,</span> <span class="c1">// ignored for RSA</span>
                        <span class="kt">string</span> <span class="n">x509_pem</span><span class="p">,</span>
                        <span class="kt">string</span> <span class="n">alg</span><span class="p">,</span>
                        <span class="kt">byte</span><span class="p">[]</span> <span class="n">secure_input</span><span class="p">,</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">signature</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">RsaKeyParameters</span> <span class="n">pubkey</span> <span class="p">=</span> <span class="p">(</span><span class="n">RsaKeyParameters</span><span class="p">)</span><span class="n">CertificateFromPem</span><span class="p">(</span><span class="n">x509_pem</span><span class="p">).</span><span class="n">GetPublicKey</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">signer</span> <span class="p">=</span> <span class="n">SignerUtilities</span><span class="p">.</span><span class="n">GetSigner</span><span class="p">(</span><span class="n">SignerName</span><span class="p">(</span><span class="n">alg</span><span class="p">));</span>
    <span class="n">signer</span><span class="p">.</span><span class="n">Init</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">);</span>
    <span class="n">signer</span><span class="p">.</span><span class="n">BlockUpdate</span><span class="p">(</span><span class="n">secure_input</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">secure_input</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">signer</span><span class="p">.</span><span class="n">VerifySignature</span><span class="p">(</span><span class="n">signature</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pem-in-c">
<h4><a class="toc-backref" href="#id52">PEM in C#</a><a class="headerlink" href="#pem-in-c" title="Permalink to this headline">¶</a></h4>
<p>Because it&#8217;s not easy to read PEM formatted data in Microsoft library,
BouncyCastle can be used to load X.509 certificate and private key.</p>
<div class="section" id="x-509-certificate-im-pem">
<h5><a class="toc-backref" href="#id53">X.509 Certificate im PEM</a><a class="headerlink" href="#x-509-certificate-im-pem" title="Permalink to this headline">¶</a></h5>
<div class="highlight-csharp"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="n">X509Certificate</span> <span class="nf">CertificateFromPem</span><span class="p">(</span><span class="kt">string</span> <span class="n">certificate</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">TextReader</span> <span class="n">c</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringReader</span><span class="p">(</span><span class="n">certificate</span><span class="p">);</span>
    <span class="n">PemReader</span> <span class="n">pem2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PemReader</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="n">X509Certificate</span> <span class="n">x509</span> <span class="p">=</span> <span class="p">(</span><span class="n">X509Certificate</span><span class="p">)</span><span class="n">pem2</span><span class="p">.</span><span class="n">ReadObject</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">x509</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="der-private-key-im-pem">
<h5><a class="toc-backref" href="#id54">DER Private Key im PEM</a><a class="headerlink" href="#der-private-key-im-pem" title="Permalink to this headline">¶</a></h5>
<div class="highlight-csharp"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="n">RsaKeyParameters</span> <span class="nf">RsaPrivateKeyFromPem</span><span class="p">(</span><span class="kt">string</span> <span class="n">private_key</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">TextReader</span> <span class="n">r</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringReader</span><span class="p">(</span><span class="n">private_key</span><span class="p">);</span>
    <span class="n">PemReader</span> <span class="n">pem</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PemReader</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">RsaKeyParameters</span><span class="p">)((</span><span class="n">AsymmetricCipherKeyPair</span> <span class="p">)</span><span class="n">pem</span><span class="p">.</span><span class="n">ReadObject</span><span class="p">()).</span><span class="n">Private</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="hmac-and-shared-secret">
<h2><a class="toc-backref" href="#id55">HMAC and Shared Secret</a><a class="headerlink" href="#hmac-and-shared-secret" title="Permalink to this headline">¶</a></h2>
<div class="section" id="shared-secrete-negotiation-on-client-registartion">
<h3><a class="toc-backref" href="#id56">Shared Secrete negotiation  on Client  Registartion</a><a class="headerlink" href="#shared-secrete-negotiation-on-client-registartion" title="Permalink to this headline">¶</a></h3>
<p>Audience must register his shared secret as <a class="reference internal" href="oauth.html#term-client-secret"><em class="xref std std-term">client_secret</em></a> on <a class="reference internal" href="reg.html"><em>OpenID Connect Dynamic Client Registration 1.0</em></a>  process.</p>
</div>
<div class="section" id="signature">
<h3><a class="toc-backref" href="#id57">Signature?</a><a class="headerlink" href="#signature" title="Permalink to this headline">¶</a></h3>
<p>No. JWS Signature for HMAC is not signature actually.
Verifier must repeat the same hmac_sign() process as creator did
and check if JWS Signature value produced by the verifier is exactly same as the one received.</p>
</div>
<div class="section" id="hmac-sign">
<h3><a class="toc-backref" href="#id58">hmac_sign()</a><a class="headerlink" href="#hmac-sign" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id14">
<h4><a class="toc-backref" href="#id59">Python</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">hmac</span><span class="o">,</span><span class="nn">hashlib</span>

<span class="k">def</span> <span class="nf">digester</span><span class="p">(</span><span class="n">alg</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param alg: Algorithms defined in JWA</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hashlib</span><span class="p">,</span>
            <span class="s">&quot;sha</span><span class="si">%(bits)s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;[HRE]S(?P&lt;bits&gt;\d+)$&#39;</span><span class="p">,</span><span class="n">alg</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">hmac_sign</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="n">pem</span><span class="p">,</span><span class="n">alg</span><span class="p">,</span><span class="n">data</span> <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param secret: shared secret</span>
<span class="sd">        :param pem: ignored by HMAC</span>
<span class="sd">        :param alg: JWA algorithm</span>
<span class="sd">        :param data: data to be signed.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">digester</span><span class="p">(</span><span class="n">alg</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h4><a class="toc-backref" href="#id60">C#</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">// BouncyCastle</span>

<span class="k">public</span> <span class="k">static</span> <span class="n">IMac</span> <span class="nf">GetMac</span><span class="p">(</span><span class="kt">string</span> <span class="n">alg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Regex</span> <span class="n">re</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Regex</span><span class="p">(</span><span class="s">&quot;^(?&lt;alg&gt;[H])S(?&lt;bits&gt;\\d+)$&quot;</span><span class="p">);</span>
    <span class="n">Match</span> <span class="n">m</span> <span class="p">=</span> <span class="n">re</span><span class="p">.</span><span class="n">Match</span><span class="p">(</span><span class="n">alg</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MacUtilities</span><span class="p">.</span><span class="n">GetMac</span><span class="p">(</span>
                    <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;HMAC-SHA{0}&quot;</span><span class="p">,</span>
                            <span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&quot;bits&quot;</span><span class="p">].</span><span class="n">Value</span> <span class="p">));</span>
    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">HmacSign</span><span class="p">(</span>
            <span class="kt">string</span> <span class="n">key</span><span class="p">,</span>
            <span class="kt">string</span> <span class="n">pem</span><span class="p">,</span>     <span class="c1">//ignored for HMAC</span>
            <span class="kt">string</span> <span class="n">alg</span><span class="p">,</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IMac</span> <span class="n">mac</span> <span class="p">=</span> <span class="n">GetMac</span><span class="p">(</span><span class="n">alg</span><span class="p">);</span>

    <span class="kt">byte</span><span class="p">[]</span> <span class="n">signature</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">mac</span><span class="p">.</span><span class="n">GetMacSize</span><span class="p">()];</span>

    <span class="n">mac</span><span class="p">.</span><span class="n">Init</span><span class="p">(</span> <span class="k">new</span> <span class="n">KeyParameter</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="p">));</span>
    <span class="n">mac</span><span class="p">.</span><span class="n">BlockUpdate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
    <span class="n">mac</span><span class="p">.</span><span class="n">DoFinal</span><span class="p">(</span><span class="n">signature</span><span class="p">,</span><span class="m">0</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">signature</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hmac-verify">
<h3><a class="toc-backref" href="#id61">hmac_verify()</a><a class="headerlink" href="#hmac-verify" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id16">
<h4><a class="toc-backref" href="#id62">Python</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hmac_verify</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="n">pem</span><span class="p">,</span><span class="n">alg</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">signature</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param secret: shared secret</span>
<span class="sd">        :param pem: ignored by HMAC</span>
<span class="sd">        :param alg : JWA algorithm</span>
<span class="sd">        :param data: data signed</span>
<span class="sd">        :param signature: produced signature</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#: hmac_sign is used by a verifier to check if same or not</span>

    <span class="k">return</span> <span class="n">signature</span> <span class="o">==</span> <span class="n">hmac_sign</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="n">alg</span><span class="p">,</span><span class="n">data</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h4><a class="toc-backref" href="#id63">C#</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<div class="highlight-csharp"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">HmacVerify</span><span class="p">(</span>
        <span class="kt">string</span> <span class="n">key</span><span class="p">,</span>
        <span class="kt">string</span> <span class="n">pem</span><span class="p">,</span> <span class="c1">// ignored for HMAC</span>
        <span class="kt">string</span> <span class="n">alg</span><span class="p">,</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="n">data</span><span class="p">,</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">signature</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">signature</span><span class="p">.</span><span class="n">SequenceEqual</span><span class="p">(</span> <span class="n">HmacSign</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">alg</span><span class="p">,</span> <span class="n">data</span> <span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ecdsa">
<h2><a class="toc-backref" href="#id64">ECDSA</a><a class="headerlink" href="#ecdsa" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="libraries">
<h2><a class="toc-backref" href="#id65">Libraries</a><a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id18">
<h3><a class="toc-backref" href="#id66">Python</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># standard python</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c"># M2Crypto</span>
<span class="kn">from</span> <span class="nn">M2Crypto</span> <span class="kn">import</span> <span class="n">RSA</span>
<span class="kn">from</span> <span class="nn">M2Crypto</span> <span class="kn">import</span> <span class="n">X509</span>
<span class="kn">from</span> <span class="nn">M2Crypto</span> <span class="kn">import</span> <span class="n">util</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h3><a class="toc-backref" href="#id67">C#</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">// Micsosoft</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text.RegularExpressions</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>

<span class="c1">// BouncyCastle</span>
<span class="k">using</span> <span class="nn">Org.BouncyCastle.OpenSsl</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Org.BouncyCastle.Crypto</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Org.BouncyCastle.Crypto.Signers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Org.BouncyCastle.Crypto.Digests</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Org.BouncyCastle.Crypto.Generators</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Org.BouncyCastle.Crypto.Parameters</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Org.BouncyCastle.X509</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Org.BouncyCastle.Security</span><span class="p">;</span>

<span class="c1">// Json.NET</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Linq</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
  <h2>HDKNR.COM</h2>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011, HDKNR.COM.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.<br/>
    </p>
  </div>
</footer>

  </body>
</html>