

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OpenID Connect Core 1.0 &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="OpenID Connect Dynamic Client Registration 1.0" href="reg.html" />
    <link rel="prev" title="OpenID Connect" href="openid_connect.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>identity 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>OpenID Connect Core 1.0</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="openid_connect.html">OpenID Connect</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="reg.html">OpenID Connect Dynamic Client Registration 1.0</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="openid-connect-core-1-0">
<span id="core-head"></span><h1>OpenID Connect Core 1.0<a class="headerlink" href="#openid-connect-core-1-0" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id35">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id36">1.  Introduction</a><ul>
<li><a class="reference internal" href="#requirements-notation-and-conventions" id="id37">1.1.  Requirements Notation and Conventions</a></li>
<li><a class="reference internal" href="#terminology" id="id38">1.2.  Terminology</a></li>
<li><a class="reference internal" href="#overview" id="id39">1.3.  Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id-token" id="id40">2.  ID Token</a></li>
<li><a class="reference internal" href="#authentication" id="id41">3.  Authentication</a><ul>
<li><a class="reference internal" href="#authentication-using-the-authorization-code-flow" id="id42">3.1.  Authentication using the Authorization Code Flow</a><ul>
<li><a class="reference internal" href="#authorization-code-flow-steps" id="id43">3.1.1.  Authorization Code Flow Steps</a></li>
<li><a class="reference internal" href="#authorization-endpoint" id="id44">3.1.2.  Authorization Endpoint</a><ul>
<li><a class="reference internal" href="#authentication-request" id="id45">3.1.2.1.  Authentication Request</a></li>
<li><a class="reference internal" href="#authentication-request-validation" id="id46">3.1.2.2.  Authentication Request Validation</a></li>
<li><a class="reference internal" href="#authorization-server-authenticates-end-user" id="id47">3.1.2.3.  Authorization Server Authenticates End-User</a></li>
<li><a class="reference internal" href="#authorization-server-obtains-end-user-consent-authorization" id="id48">3.1.2.4.  Authorization Server Obtains End-User Consent/Authorization</a></li>
<li><a class="reference internal" href="#successful-authentication-response" id="id49">3.1.2.5.  Successful Authentication Response</a></li>
<li><a class="reference internal" href="#authentication-error-response" id="id50">3.1.2.6.  Authentication Error Response</a></li>
<li><a class="reference internal" href="#authentication-response-validation" id="id51">3.1.2.7.  Authentication Response Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#token-endpoint" id="id52">3.1.3.  Token Endpoint</a><ul>
<li><a class="reference internal" href="#token-request" id="id53">3.1.3.1.  Token Request</a></li>
<li><a class="reference internal" href="#token-request-validation" id="id54">3.1.3.2.  Token Request Validation</a></li>
<li><a class="reference internal" href="#successful-token-response" id="id55">3.1.3.3.  Successful Token Response</a></li>
<li><a class="reference internal" href="#token-error-response" id="id56">3.1.3.4.  Token Error Response</a></li>
<li><a class="reference internal" href="#token-response-validation" id="id57">3.1.3.5.  Token Response Validation</a></li>
<li><a class="reference internal" href="#core-3-1-3-6" id="id58">3.1.3.6.  ID Token</a></li>
<li><a class="reference internal" href="#core-3-1-3-7" id="id59">3.1.3.7.  ID Token Validation</a></li>
<li><a class="reference internal" href="#access-token-validation" id="id60">3.1.3.8.  Access Token Validation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#authentication-using-the-implicit-flow" id="id61">3.2.  Authentication using the Implicit Flow</a><ul>
<li><a class="reference internal" href="#implicit-flow-steps" id="id62">3.2.1.  Implicit Flow Steps</a></li>
<li><a class="reference internal" href="#core-3-2-2" id="id63">3.2.2.  Authorization Endpoint</a><ul>
<li><a class="reference internal" href="#core-3-2-2-1" id="id64">3.2.2.1.  Authentication Request</a></li>
<li><a class="reference internal" href="#core-3-2-2-2" id="id65">3.2.2.2.  Authentication Request Validation</a></li>
<li><a class="reference internal" href="#core-3-2-2-3" id="id66">3.2.2.3.  Authorization Server Authenticates End-User</a></li>
<li><a class="reference internal" href="#core-3-2-2-4" id="id67">3.2.2.4.  Authorization Server Obtains End-User Consent/Authorization</a></li>
<li><a class="reference internal" href="#core-3-2-2-5" id="id68">3.2.2.5.  Successful Authentication Response</a></li>
<li><a class="reference internal" href="#core-3-2-2-6" id="id69">3.2.2.6.  Authentication Error Response</a></li>
<li><a class="reference internal" href="#redirect-uri-fragment-handling" id="id70">3.2.2.7.  Redirect URI Fragment Handling</a></li>
<li><a class="reference internal" href="#core-3-2-2-8" id="id71">3.2.2.8.  Authentication Response Validation</a></li>
<li><a class="reference internal" href="#core-3-2-2-9" id="id72">3.2.2.9.  Access Token Validation</a></li>
<li><a class="reference internal" href="#core-3-2-2-10" id="id73">3.2.2.10.  ID Token</a></li>
<li><a class="reference internal" href="#core-3-2-2-11" id="id74">3.2.2.11.  ID Token Validation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#authentication-using-the-hybrid-flow" id="id75">3.3.  Authentication using the Hybrid Flow</a><ul>
<li><a class="reference internal" href="#hybrid-flow-steps" id="id76">3.3.1.  Hybrid Flow Steps</a></li>
<li><a class="reference internal" href="#core-3-3-2" id="id77">3.3.2.  Authorization Endpoint</a><ul>
<li><a class="reference internal" href="#core-3-3-2-1" id="id78">3.3.2.1.  Authentication Request</a></li>
<li><a class="reference internal" href="#core-3-3-2-2" id="id79">3.3.2.2.  Authentication Request Validation</a></li>
<li><a class="reference internal" href="#core-3-3-2-3" id="id80">3.3.2.3.  Authorization Server Authenticates End-User</a></li>
<li><a class="reference internal" href="#core-3-3-2-4" id="id81">3.3.2.4.  Authorization Server Obtains End-User Consent/Authorization</a></li>
<li><a class="reference internal" href="#core-3-3-2-5" id="id82">3.3.2.5.  Successful Authentication Response</a></li>
<li><a class="reference internal" href="#core-3-3-2-6" id="id83">3.3.2.6.  Authentication Error Response</a></li>
<li><a class="reference internal" href="#core-3-3-2-7" id="id84">3.3.2.7.  Redirect URI Fragment Handling</a></li>
<li><a class="reference internal" href="#core-3-3-2-8" id="id85">3.3.2.8.  Authentication Response Validation</a></li>
<li><a class="reference internal" href="#core-3-3-2-9" id="id86">3.3.2.9.  Access Token Validation</a></li>
<li><a class="reference internal" href="#authorization-code-validation" id="id87">3.3.2.10.  Authorization Code Validation</a></li>
<li><a class="reference internal" href="#core-3-3-2-11" id="id88">3.3.2.11.  ID Token</a></li>
<li><a class="reference internal" href="#core-3-3-2-12" id="id89">3.3.2.12.  ID Token Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#core-3-3-3" id="id90">3.3.3.  Token Endpoint</a><ul>
<li><a class="reference internal" href="#core-3-3-3-1" id="id91">3.3.3.1.  Token Request</a></li>
<li><a class="reference internal" href="#core-3-3-3-2" id="id92">3.3.3.2.  Token Request Validation</a></li>
<li><a class="reference internal" href="#core-3-3-3-3" id="id93">3.3.3.3.  Successful Token Response</a></li>
<li><a class="reference internal" href="#core-3-3-3-4" id="id94">3.3.3.4.  Token Error Response</a></li>
<li><a class="reference internal" href="#core-3-3-3-5" id="id95">3.3.3.5.  Token Response Validation</a></li>
<li><a class="reference internal" href="#core-3-3-3-6" id="id96">3.3.3.6.  ID Token</a></li>
<li><a class="reference internal" href="#core-3-3-3-7" id="id97">3.3.3.7.  ID Token Validation</a></li>
<li><a class="reference internal" href="#access-token" id="id98">3.3.3.8.  Access Token</a></li>
<li><a class="reference internal" href="#core-3-3-3-9" id="id99">3.3.3.9.  Access Token Validation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#initiating-login-from-a-third-party" id="id100">4.  Initiating Login from a Third Party</a></li>
<li><a class="reference internal" href="#claims" id="id101">5.  Claims</a><ul>
<li><a class="reference internal" href="#standard-claims" id="id102">5.1.  Standard Claims</a><ul>
<li><a class="reference internal" href="#address-claim" id="id103">5.1.1.  Address Claim</a></li>
<li><a class="reference internal" href="#additional-claims" id="id104">5.1.2.  Additional Claims</a></li>
</ul>
</li>
<li><a class="reference internal" href="#claims-languages-and-scripts" id="id105">5.2.  Claims Languages and Scripts</a></li>
<li><a class="reference internal" href="#userinfo-endpoint" id="id106">5.3.  UserInfo Endpoint</a><ul>
<li><a class="reference internal" href="#userinfo-request" id="id107">5.3.1.  UserInfo Request</a></li>
<li><a class="reference internal" href="#successful-userinfo-response" id="id108">5.3.2.  Successful UserInfo Response</a></li>
<li><a class="reference internal" href="#userinfo-error-response" id="id109">5.3.3.  UserInfo Error Response</a></li>
<li><a class="reference internal" href="#userinfo-response-validation" id="id110">5.3.4.  UserInfo Response Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#requesting-claims-using-scope-values" id="id111">5.4.  Requesting Claims using Scope Values</a></li>
<li><a class="reference internal" href="#requesting-claims-using-the-claims-request-parameter" id="id112">5.5.  Requesting Claims using the &#8220;claims&#8221; Request Parameter</a><ul>
<li><a class="reference internal" href="#individual-claims-requests" id="id113">5.5.1.  Individual Claims Requests</a><ul>
<li><a class="reference internal" href="#requesting-the-acr-claim" id="id114">5.5.1.1.  Requesting the &#8220;acr&#8221; Claim</a></li>
</ul>
</li>
<li><a class="reference internal" href="#languages-and-scripts-for-individual-claims" id="id115">5.5.2.  Languages and Scripts for Individual Claims</a></li>
</ul>
</li>
<li><a class="reference internal" href="#claim-types" id="id116">5.6.  Claim Types</a><ul>
<li><a class="reference internal" href="#normal-claims" id="id117">5.6.1.  Normal Claims</a></li>
<li><a class="reference internal" href="#aggregated-and-distributed-claims" id="id118">5.6.2.  Aggregated and Distributed Claims</a><ul>
<li><a class="reference internal" href="#example-of-aggregated-claims" id="id119">5.6.2.1.  Example of Aggregated Claims</a></li>
<li><a class="reference internal" href="#example-of-distributed-claims" id="id120">5.6.2.2.  Example of Distributed Claims</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#claim-stability-and-uniqueness" id="id121">5.7.  Claim Stability and Uniqueness</a></li>
</ul>
</li>
<li><a class="reference internal" href="#passing-request-parameters-as-jwts" id="id122">6.  Passing Request Parameters as JWTs</a><ul>
<li><a class="reference internal" href="#passing-a-request-object-by-value" id="id123">6.1.  Passing a Request Object by Value</a><ul>
<li><a class="reference internal" href="#request-using-the-request-request-parameter" id="id124">6.1.1.  Request using the &#8220;request&#8221; Request Parameter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#passing-a-request-object-by-reference" id="id125">6.2.  Passing a Request Object by Reference</a><ul>
<li><a class="reference internal" href="#url-referencing-the-request-object" id="id126">6.2.1.  URL Referencing the Request Object</a></li>
<li><a class="reference internal" href="#request-using-the-request-uri-request-parameter" id="id127">6.2.2.  Request using the &#8220;request_uri&#8221; Request Parameter</a></li>
<li><a class="reference internal" href="#authorization-server-fetches-request-object" id="id128">6.2.3.  Authorization Server Fetches Request Object</a></li>
<li><a class="reference internal" href="#request-uri-rationale" id="id129">6.2.4.  &#8220;request_uri&#8221; Rationale</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validating-jwt-based-requests" id="id130">6.3.  Validating JWT-Based Requests</a><ul>
<li><a class="reference internal" href="#encrypted-request-object" id="id131">6.3.1.  Encrypted Request Object</a></li>
<li><a class="reference internal" href="#signed-request-object" id="id132">6.3.2.  Signed Request Object</a></li>
<li><a class="reference internal" href="#request-parameter-assembly-and-validation" id="id133">6.3.3.  Request Parameter Assembly and Validation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#self-issued-openid-provider" id="id134">7.  Self-Issued OpenID Provider</a><ul>
<li><a class="reference internal" href="#self-issued-openid-provider-discovery" id="id135">7.1.  Self-Issued OpenID Provider Discovery</a></li>
<li><a class="reference internal" href="#self-issued-openid-provider-registration" id="id136">7.2.  Self-Issued OpenID Provider Registration</a><ul>
<li><a class="reference internal" href="#providing-information-with-the-registration-request-parameter" id="id137">7.2.1.  Providing Information with the &#8220;registration&#8221; Request Parameter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#self-issued-openid-provider-request" id="id138">7.3.  Self-Issued OpenID Provider Request</a></li>
<li><a class="reference internal" href="#self-issued-openid-provider-response" id="id139">7.4.  Self-Issued OpenID Provider Response</a></li>
<li><a class="reference internal" href="#self-issued-id-token-validation" id="id140">7.5.  Self-Issued ID Token Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subject-identifier-types" id="id141">8.  Subject Identifier Types</a><ul>
<li><a class="reference internal" href="#pairwise-identifier-algorithm" id="id142">8.1.  Pairwise Identifier Algorithm</a></li>
</ul>
</li>
<li><a class="reference internal" href="#client-authentication" id="id143">9.  Client Authentication</a></li>
<li><a class="reference internal" href="#signatures-and-encryption" id="id144">10.  Signatures and Encryption</a><ul>
<li><a class="reference internal" href="#signing" id="id145">10.1.  Signing</a></li>
<li><a class="reference internal" href="#rotation-of-asymmetric-signing-keys" id="id146">10.1.1.  Rotation of Asymmetric Signing Keys</a></li>
<li><a class="reference internal" href="#encryption" id="id147">10.2.  Encryption</a><ul>
<li><a class="reference internal" href="#rotation-of-asymmetric-encryption-keys" id="id148">10.2.1.  Rotation of Asymmetric Encryption Keys</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#offline-access" id="id149">11.  Offline Access</a></li>
<li><a class="reference internal" href="#using-refresh-tokens" id="id150">12.  Using Refresh Tokens</a><ul>
<li><a class="reference internal" href="#refresh-request" id="id151">12.1.  Refresh Request</a></li>
<li><a class="reference internal" href="#successful-refresh-response" id="id152">12.2.  Successful Refresh Response</a></li>
<li><a class="reference internal" href="#refresh-error-response" id="id153">12.3.  Refresh Error Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#serializations" id="id154">13.  Serializations</a><ul>
<li><a class="reference internal" href="#query-string-serialization" id="id155">13.1.  Query String Serialization</a></li>
<li><a class="reference internal" href="#form-serialization" id="id156">13.2.  Form Serialization</a></li>
<li><a class="reference internal" href="#json-serialization" id="id157">13.3.  JSON Serialization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#string-operations" id="id158">14.  String Operations</a></li>
<li><a class="reference internal" href="#implementation-considerations" id="id159">15.  Implementation Considerations</a><ul>
<li><a class="reference internal" href="#mandatory-to-implement-features-for-all-openid-providers" id="id160">15.1.  Mandatory to Implement Features for All OpenID Providers</a></li>
<li><a class="reference internal" href="#mandatory-to-implement-features-for-dynamic-openid-providers" id="id161">15.2.  Mandatory to Implement Features for Dynamic OpenID Providers</a></li>
<li><a class="reference internal" href="#discovery-and-registration" id="id162">15.3.  Discovery and Registration</a></li>
<li><a class="reference internal" href="#mandatory-to-implement-features-for-relying-parties" id="id163">15.4.  Mandatory to Implement Features for Relying Parties</a></li>
<li><a class="reference internal" href="#implementation-notes" id="id164">15.5.  Implementation Notes</a><ul>
<li><a class="reference internal" href="#authorization-code-implementation-notes" id="id165">15.5.1.  Authorization Code Implementation Notes</a></li>
<li><a class="reference internal" href="#nonce-implementation-notes" id="id166">15.5.2.  Nonce Implementation Notes</a></li>
<li><a class="reference internal" href="#redirect-uri-fragment-handling-implementation-notes" id="id167">15.5.3.  Redirect URI Fragment Handling Implementation Notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compatibility-notes" id="id168">15.6.  Compatibility Notes</a></li>
<li><a class="reference internal" href="#pre-final-ietf-specifications" id="id169">15.6.1.  Pre-Final IETF Specifications</a><ul>
<li><a class="reference internal" href="#google-iss-value" id="id170">15.6.2.  Google &#8220;iss&#8221; Value</a></li>
</ul>
</li>
<li><a class="reference internal" href="#related-specifications-and-implementer-s-guides" id="id171">15.7.  Related Specifications and Implementer&#8217;s Guides</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations" id="id172">16.  Security Considerations</a></li>
<li><a class="reference internal" href="#privacy-considerations" id="id173">17.  Privacy Considerations</a></li>
<li><a class="reference internal" href="#iana-considerations" id="id174">18.  IANA Considerations</a></li>
<li><a class="reference internal" href="#references" id="id175">19.  References</a><ul>
<li><a class="reference internal" href="#normative-references" id="id176">19.1. Normative References</a></li>
<li><a class="reference internal" href="#informative-references" id="id177">19.2. Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-a-authorization-examples" id="id178">Appendix A.  Authorization Examples</a><ul>
<li><a class="reference internal" href="#a-1-example-using-response-type-code" id="id179">A.1.  Example using response_type=code</a></li>
<li><a class="reference internal" href="#a-2-example-using-response-type-id-token" id="id180">A.2.  Example using response_type=id_token</a></li>
<li><a class="reference internal" href="#a-3-example-using-response-type-id-token-token" id="id181">A.3.  Example using response_type=id_token token</a></li>
<li><a class="reference internal" href="#a-4-example-using-response-type-code-id-token" id="id182">A.4.  Example using response_type=code id_token</a></li>
<li><a class="reference internal" href="#a-5-example-using-response-type-code-token" id="id183">A.5.  Example using response_type=code token</a></li>
<li><a class="reference internal" href="#a-6-example-using-response-type-code-id-token-token" id="id184">A.6.  Example using response_type=code id_token token</a></li>
<li><a class="reference internal" href="#a-7-rsa-key-used-in-examples" id="id185">A.7.  RSA Key Used in Examples</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>draft 17</li>
<li><a class="reference external" href="https://openid.net/specs/openid-connect-core-1_0-17.html">https://openid.net/specs/openid-connect-core-1_0-17.html</a></li>
</ul>
</div>
<div class="section" id="abstract">
<span id="core-abstract"></span><h2><a class="toc-backref" href="#id35">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>OpenID Connect 1.0 is a simple identity layer on top of the OAuth 2.0 protocol.
It enables Clients to verify the identity of the End-User
based on the authentication performed by an Authorization Server,
as well as to obtain basic profile information
about the End-User in an interoperable and REST-like manner.</p>
<p>This specification defines the core OpenID Connect functionality:
authentication built on top of OAuth 2.0
and the use of Claims to communicate information about the End-User.</p>
<p>It also describes the security and privacy considerations for using OpenID Connect.</p>
<p>(draft 17)</p>
</div>
<div class="section" id="introduction">
<span id="core-1"></span><h2><a class="toc-backref" href="#id36">1.  Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Entity : OP,  RP, End User</li>
<li>Protocal Framework : OAuth 2.0</li>
<li>Assertion Format : JWT</li>
<li>Cryptography for Assertion : Jose</li>
<li>Token : OAuth Bearer</li>
<li>Confiuration Data : Discovery</li>
<li>Registrion : Dynamic Registration</li>
</ul>
</div>
<p>OpenID Connect 1.0 is a simple identity layer
on top of the <a class="reference internal" href="oauth.html"><em>OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a> protocol.
It enables Clients to verify the identity of the End-User
based on the authentication performed by an Authorization Server,
as well as to obtain basic profile information about the End-User
in an interoperable and REST-like manner.</p>
<p>The OpenID Connect Core 1.0 specification defines
the core OpenID Connect functionality:
authentication built on top of OAuth 2.0
and the use of Claims to communicate information about the End-User.</p>
<p>It also describes the security and privacy considerations for using OpenID Connect.</p>
<p>As background,
the OAuth 2.0 Authorization Framework [RFC6749] and <a class="reference internal" href="oauth_bearer.html"><em>OAuth 2.0 Bearer Token Usage</em></a>
[RFC6750] specifications provide a general framework for third-party applications
to obtain and use limited access to HTTP resources.
They define mechanisms to obtain and use Access Tokens
to access resources but do not define standard methods to provide identity information.
Notably,
without profiling OAuth 2.0,
it is incapable of providing information about the authentication of an End-User.
Readers are expected to be familiar with these specifications.</p>
<p>OpenID Connect implements authentication as an extension to the OAuth 2.0 authorization process.
Use of this extension is requested by Clients by including the openid scope value in the Authorization Request.
Information about the authentication performed is returned
in a <a class="reference internal" href="jwt.html"><em>JSON Web Token (JWT)</em></a> <a class="reference internal" href="#term-jwt"><em class="xref std std-term">[JWT]</em></a> called an <a class="reference internal" href="messages.html#term-id-token"><em class="xref std std-term">ID Token</em></a> (see <a class="reference internal" href="#core-2"><em>Section 2</em></a>).
OAuth 2.0 Authentication Servers implementing OpenID Connect are also referred to as OpenID Providers (OPs).
OAuth 2.0 Clients using OpenID Connect are also referred to as Relying Parties (RPs).</p>
<p>This specification assumes that
the Relying Party has already obtained configuration information
about the OpenID Provider,
including its Authorization Endpoint and Token Endpoint locations.
This information is normally obtained via <a class="reference internal" href="discovery.html"><em>Discovery</em></a>,
as described in <a class="reference internal" href="discovery.html"><em>OpenID Connect Discovery 1.0</em></a> <a class="reference internal" href="#term-openid-discovery"><em class="xref std std-term">[OpenID.Discovery]</em></a>,
or may be obtained via other mechanisms.</p>
<p>Likewise,
this specification assumes that the Relying Party has already obtained sufficient credentials
and provided information needed to use the OpenID Provider.
This is normally done via Dynamic Registration,
as described in <a class="reference internal" href="reg.html"><em>OpenID Connect Dynamic Client Registration 1.0</em></a>
<a class="reference internal" href="#term-openid-registration"><em class="xref std std-term">[OpenID.Registration]</em></a>,
or may be obtained via other mechanisms.</p>
<div class="section" id="requirements-notation-and-conventions">
<span id="core-1-1"></span><h3><a class="toc-backref" href="#id37">1.1.  Requirements Notation and Conventions</a><a class="headerlink" href="#requirements-notation-and-conventions" title="Permalink to this headline">¶</a></h3>
<p>The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in RFC 2119 [RFC2119].</p>
<p>In the .txt version of this document, values are quoted to indicate that they are to be taken literally. When using these values in protocol messages, the quotes MUST NOT be used as part of the value. In the HTML version of this document, values to be taken literally are indicated by the use of this fixed-width font.</p>
<p>All uses of JSON Web Signature (JWS) [JWS] and JSON Web Encryption (JWE) [JWE] data structures in this specification utilize the JWS Compact Serialization or the JWE Compact Serialization; the JWS JSON Serialization and the JWE JSON Serialization are not used.</p>
</div>
<div class="section" id="terminology">
<span id="core-1-2"></span><h3><a class="toc-backref" href="#id38">1.2.  Terminology</a><a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<p>This specification uses the terms &#8220;Access Token&#8221;, &#8220;Authorization Code&#8221;, &#8220;Authorization Endpoint&#8221;, &#8220;Authorization Grant&#8221;, &#8220;Authorization Server&#8221;, &#8220;Client&#8221;, &#8220;Client Authentication&#8221;, &#8220;Client Identifier&#8221;, &#8220;Client Secret&#8221;, &#8220;Grant Type&#8221;, &#8220;Protected Resource&#8221;, &#8220;Redirection URI&#8221;, &#8220;Refresh Token&#8221;, &#8220;Resource Owner&#8221;, &#8220;Resource Server&#8221;, &#8220;Response Type&#8221;, and &#8220;Token Endpoint&#8221; defined by OAuth 2.0 [RFC6749], the terms &#8220;Claim Name&#8221;, &#8220;Claim Value&#8221;, &#8220;JSON Web Token (JWT)&#8221;, and &#8220;Nested JWT&#8221; defined by JSON Web Token (JWT) [JWT], the term &#8220;User Agent&#8221; defined by RFC 2616 [RFC2616], and the term &#8220;Response Mode&#8221; defined by OAuth 2.0 Multiple Response Type Encoding Practices [OAuth.Responses].</p>
<p>This specification also defines the following terms:</p>
<dl class="glossary docutils">
<dt id="term-authentication">Authentication</dt>
<dd>Process used to achieve sufficient confidence
in the binding between the Entity and the presented Identity.</dd>
<dt id="term-authentication-request">Authentication Request</dt>
<dd>OAuth 2.0 Authorization Request using extension parameters and scopes
defined by OpenID Connect to request
that the End-User be authenticated
by the Authorization Server, which is an OpenID Connect Provider,
to the Client, which is an OpenID Connect Relying Party.</dd>
<dt id="term-authentication-context">Authentication Context</dt>
<dd><p class="first">Information that the Relying Party can require
before it makes an entitlement decision
with respect to an authentication response.</p>
<p class="last">Such context can include, but is not limited to,
the actual authentication method used or level of assurance
such as ISO/IEC 29115 <a class="reference internal" href="#term-iso29115"><em class="xref std std-term">[ISO29115]</em></a> entity authentication assurance level.</p>
</dd>
<dt id="term-authentication-context-class">Authentication Context Class</dt>
<dd>Set of authentication methods or procedures
that are considered to be equivalent to each other in a particular context.</dd>
<dt id="term-authentication-context-class-reference">Authentication Context Class Reference</dt>
<dd>Identifier for an <a class="reference internal" href="#term-authentication-context-class"><em class="xref std std-term">Authentication Context Class</em></a>.</dd>
<dt id="term-authorization-code-flow">Authorization Code Flow</dt>
<dd>OAuth 2.0 flow in which an <a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a> is returned
from the Authorization Endpoint
and all tokens are returned from the <em class="xref std std-term">Token Endpoint</em>.</dd>
<dt id="term-authorization-request">Authorization Request</dt>
<dd>OAuth 2.0 Authorization Request as defined by <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>.</dd>
<dt id="term-claim">Claim</dt>
<dd>Piece of information asserted about an Entity.</dd>
<dt id="term-claim-type">Claim Type</dt>
<dd><p class="first">Syntax used for representing a Claim Value.</p>
<p class="last">This specification defines Normal, Aggregated, and Distributed Claim Types.</p>
</dd>
<dt id="term-claims-provider">Claims Provider</dt>
<dd>Server that can return Claims about an Entity.</dd>
<dt id="term-credential">Credential</dt>
<dd>Data presented as evidence of the right to use an identity or other resources.</dd>
<dt id="term-end-user">End-User</dt>
<dd>Human participant.</dd>
<dt id="term-entity">Entity</dt>
<dd>Something that has a separate and distinct existence
and that can be identified in a context. An End-User is one example of an Entity.</dd>
<dt id="term-essential-claim">Essential Claim</dt>
<dd>Claim specified by the Client as being necessary
to ensure a smooth authorization experience
for the specific task requested by the End-User.</dd>
<dt id="term-hybrid-flow">Hybrid Flow</dt>
<dd>OAuth 2.0 flow in which an Authorization Code is returned from the Authorization Endpoint,
some tokens are returned from the Authorization Endpoint,
and others are returned from the Token Endpoint.</dd>
<dt id="term-id-token">ID Token</dt>
<dd><p class="first"><a class="reference internal" href="jwt.html"><em>JSON Web Token (JWT)</em></a> <a class="reference internal" href="#term-jwt"><em class="xref std std-term">[JWT]</em></a>
that contains Claims about the Authentication event.</p>
<p class="last">It MAY contain other Claims.</p>
</dd>
<dt id="term-identifier">Identifier</dt>
<dd>Value that uniquely characterizes an Entity in a specific context.</dd>
<dt id="term-identity">Identity</dt>
<dd>Set of attributes related to an Entity.</dd>
<dt id="term-implicit-flow">Implicit Flow</dt>
<dd>OAuth 2.0 flow in which all tokens are returned from the Authorization Endpoint
and neither the Token Endpoint nor an Authorization Code are used.</dd>
<dt id="term-issuer">Issuer</dt>
<dd>Entity that issues a set of Claims.</dd>
<dt id="term-issuer-identifier">Issuer Identifier</dt>
<dd><p class="first">Verifiable Identifier for an Issuer.</p>
<p class="last">An Issuer Identifier is a case sensitive URL
using the https scheme that contains scheme, host, and optionally,
port number and path components and <strong>no query or fragment components</strong>.</p>
</dd>
<dt id="term-message">Message</dt>
<dd>Request or a response between an OpenID Relying Party
and an OpenID Provider.</dd>
<dt id="term-openid-provider-op">OpenID Provider (OP)</dt>
<dd>OAuth 2.0 Authorization Server
that is capable of Authenticating the End-User
and providing Claims to a Relying Party
about the Authentication event and the End-User.</dd>
<dt id="term-request-object">Request Object</dt>
<dd>JWT that contains a set of request parameters as its Claims.</dd>
<dt id="term-request-uri">Request URI</dt>
<dd>URL that references a resource containing a Request Object.
The Request URI contents MUST be retrievable by the Authorization Server.</dd>
<dt id="term-pairwise-pseudonymous-identifier-ppid">Pairwise Pseudonymous Identifier (PPID)</dt>
<dd>Identifier that identifies the Entity to a Relying Party
that cannot be correlated with the Entity&#8217;s PPID at another Relying Party.</dd>
<dt id="term-personally-identifiable-information-pii">Personally Identifiable Information (PII)</dt>
<dd>Information that
(a) can be used to identify the natural person
to whom such information relates,
or (b) is or might be directly or indirectly linked to a natural person
to whom such information relates.</dd>
<dt id="term-relying-party-rp">Relying Party (RP)</dt>
<dd>OAuth 2.0 Client application requiring End-User Authentication
and Claims from an OpenID Provider.</dd>
<dt id="term-sector-identifier">Sector Identifier</dt>
<dd>Host component of a URL used by the Relying Party&#8217;s organization
that is an input to the computation of pairwise Subject Identifiers
for that Relying Party.</dd>
<dt id="term-self-issued-openid-provider">Self-Issued OpenID Provider</dt>
<dd>Personal, self-hosted OpenID Provider that issues self-signed ID Tokens.</dd>
<dt id="term-subject-identifier">Subject Identifier</dt>
<dd>Locally unique and never reassigned identifier within the Issuer for the End-User,
which is intended to be consumed by the Client.</dd>
<dt id="term-userinfo-endpoint">UserInfo Endpoint</dt>
<dd><p class="first">Protected Resource that,
when presented with an Access Token by the Client,
returns authorized information about the End-User represented
by the corresponding Authorization Grant.</p>
<p class="last">The UserInfo Endpoint URL MUST use the https scheme and MAY contain port, path, and query parameter components.</p>
</dd>
<dt id="term-validation">Validation</dt>
<dd>Process intended to establish the soundness or correctness of a construct.</dd>
<dt id="term-verification">Verification</dt>
<dd>Process intended to test or prove the truth or accuracy of a fact or value.</dd>
<dt id="term-voluntary-claim">Voluntary Claim</dt>
<dd>Claim specified by the Client as being useful
but not Essential for the specific task requested by the End-User.</dd>
</dl>
<p>IMPORTANT NOTE TO READERS:</p>
<blockquote>
<div><p>The terminology definitions in this section are a normative portion of this specification,
imposing requirements upon implementations.</p>
<p>All the capitalized words in the text of this specification,
such as &#8220;Issuer Identifier&#8221;, reference these defined terms.
Whenever the reader encounters them,
their definitions found in this section must be followed.</p>
</div></blockquote>
<p>For more background on some of the terminology used,
see Internet Security Glossary, Version 2 <a class="reference internal" href="#term-rfc4949"><em class="xref std std-term">[RFC4949]</em></a>,
ISO/IEC 29115 Entity Authentication Assurance <a class="reference internal" href="#term-iso29115"><em class="xref std std-term">[ISO29115]</em></a>,
and ITU-T X.1252 <a class="reference internal" href="#term-x-1252"><em class="xref std std-term">[X.1252]</em></a>.</p>
<p>( draft17)</p>
</div>
<div class="section" id="overview">
<span id="core-1-3"></span><h3><a class="toc-backref" href="#id39">1.3.  Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The OpenID Connect protocol,
in abstract,
follows the following steps.</p>
<blockquote>
<div><ol class="arabic simple">
<li>The RP (Client) sends a request to the OpenID Provider (OP).</li>
<li>The OP authenticates the End-User and obtains authorization.</li>
<li>The OP responds with an ID Token and usually an Access Token.</li>
<li>The RP can send a request with the Access Token to the UserInfo Endpoint.</li>
<li>The UserInfo Endpoint returns Claims about the End-User.</li>
</ol>
</div></blockquote>
<p>These steps are illustrated in the following diagram:</p>
<div class="highlight-python"><pre>+--------+                                   +--------+
|        |                                   |        |
|        |---------(1) AuthN Request--------&gt;|        |
|        |                                   |        |
|        |  +--------+                       |        |
|        |  |        |                       |        |
|        |  |  End-  |&lt;--(2) AuthN &amp; AuthZ--&gt;|        |
|        |  |  User  |                       |        |
|   RP   |  |        |                       |   OP   |
|        |  +--------+                       |        |
|        |                                   |        |
|        |&lt;--------(3) AuthN Response--------|        |
|        |                                   |        |
|        |---------(4) UserInfo Request-----&gt;|        |
|        |                                   |        |
|        |&lt;--------(5) UserInfo Response-----|        |
|        |                                   |        |
+--------+                                   +--------+</pre>
</div>
<p>( draft 17 )</p>
</div>
</div>
<div class="section" id="id-token">
<span id="core-2"></span><span id="id1"></span><h2><a class="toc-backref" href="#id40">2.  ID Token</a><a class="headerlink" href="#id-token" title="Permalink to this headline">¶</a></h2>
<p>The primary extension that OpenID Connect makes to OAuth 2.
0 to enable End-Users to be Authenticated is the ID Token data structure.</p>
<p>The ID Token is a <strong>security token</strong> that contains Claims
about the Authentication of an End-User by an Authorization Server
when using a Client,
and potentially other requested Claims.
The ID Token is represented as a <a class="reference internal" href="jwt.html"><em>JSON Web Token (JWT)</em></a> <a class="reference internal" href="#term-jwt"><em class="xref std std-term">[JWT]</em></a>.</p>
<p>The following Claims are used within the ID Token for all OAuth 2.0 flows used by OpenID Connect:</p>
<dl class="glossary docutils">
<dt id="term-iss">iss</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">Issuer Identifier for the Issuer of the response.
The <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> value is a <strong>case sensitive URL</strong>
using the <strong>https</strong> scheme that contains scheme, host, and optionally,
port number and path components and <strong>no query or fragment components</strong>.</p>
</dd>
<dt id="term-sub">sub</dt>
<dd><p class="first">REQUIRED.</p>
<p>Subject Identifier.
A locally unique and never reassigned identifier
within the Issuer for the End-User,
which is intended to be consumed by the Client,
e.g., 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4.</p>
<p class="last">It MUST NOT exceed 255 ASCII characters in length.
The sub value is a case sensitive string.</p>
</dd>
<dt id="term-aud">aud</dt>
<dd><p class="first">REQUIRED.</p>
<p>Audience(s) that this ID Token is intended for.
It MUST contain the OAuth 2.0 <a class="reference internal" href="messages.html#term-62"><em class="xref std std-term">client_id</em></a> of the Relying Party
as an audience value.</p>
<p>It MAY also contain identifiers for other audiences.
In the general case,
the <a class="reference internal" href="messages.html#term-aud"><em class="xref std std-term">aud</em></a> value is an <strong>array</strong> of case sensitive strings.</p>
<p class="last">In the common special case when there is one audience,
the aud value MAY be a single case sensitive string.</p>
</dd>
<dt id="term-exp">exp</dt>
<dd><p class="first">REQUIRED.</p>
<p>Expiration time on or after which the ID Token MUST NOT be accepted for processing.</p>
<p>The processing of this parameter requires
that the current date/time MUST be before the expiration date/time listed in the value.</p>
<p>Implementers MAY provide for some small leeway,
usually no more than a few minutes, to account for clock skew.</p>
<p>Its value is a JSON number representing the number of seconds
from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</p>
<p class="last">See <span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3339.html"><strong>RFC 3339</strong></a> <a class="reference internal" href="#term-rfc3339"><em class="xref std std-term">[RFC3339]</em></a> for details
regarding date/times in general and UTC in particular.</p>
</dd>
<dt id="term-iat">iat</dt>
<dd><p class="first">REQUIRED.</p>
<p>Time at which the JWT was issued.</p>
<p class="last">Its value is a JSON number representing the number of seconds
from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</p>
</dd>
<dt id="term-auth-time">auth_time</dt>
<dd><p class="first">Time when the End-User authentication occurred.</p>
<p>Its value is a JSON number representing the number of seconds
from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</p>
<p>When a <a class="reference internal" href="messages.html#term-89"><em class="xref std std-term">max_age</em></a> request is made
or when <a class="reference internal" href="messages.html#term-87"><em class="xref std std-term">auth_time</em></a> is requested
as an <a class="reference internal" href="#term-essential-claim"><em class="xref std std-term">Essential Claim</em></a>, then this Claim is REQUIRED;
otherwise, its inclusion is OPTIONAL.</p>
<p class="last">(The auth_time Claim semantically corresponds to
the OpenID 2.0 PAPE <a class="reference internal" href="#term-openid-pape"><em class="xref std std-term">[OpenID.PAPE]</em></a> <strong>auth_time</strong> response parameter.)</p>
</dd>
<dt id="term-nonce">nonce</dt>
<dd><p class="first">String value used to associate a Client session with an ID Token,
and to mitigate replay attacks.</p>
<p>The value is passed through unmodified
from the Authentication Request to the ID Token.</p>
<p>If present in the ID Token,
Clients MUST verify that the <strong>nonce</strong> Claim Value is
equal to the value of the <strong>nonce</strong> parameter
sent in the Authentication Request.</p>
<p>If present in the Authentication Request,
Authorization Servers MUST include a <strong>nonce</strong> Claim
in the ID Token with the Claim Value being the <strong>nonce</strong> value
sent in the Authentication Request.</p>
<p>Authorization Servers SHOULD perform no other processing
on <strong>nonce</strong> values used.</p>
<p class="last">The <strong>nonce</strong> value is a case sensitive string.</p>
</dd>
<dt id="term-acr">acr</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Authentication Context Class Reference.</p>
<p>String specifying an <a class="reference internal" href="#term-authentication-context-class-reference"><em class="xref std std-term">Authentication Context Class Reference</em></a> value
that identifies the Authentication Context Class
that the authentication performed satisfied.</p>
<p>The value &#8220;0&#8221; indicates the End-User authentication
did not meet the requirements of ISO/IEC 29115 <a class="reference internal" href="#term-iso29115"><em class="xref std std-term">[ISO29115]</em></a> level 1.</p>
<p>Authentication using a long-lived browser cookie,
for instance, is one example where the use of &#8220;<strong>level 0</strong>&#8221; is appropriate.</p>
<p>Authentications with level 0 SHOULD NOT be used to authorize access
to any resource of any monetary value.</p>
<p>(This corresponds to the OpenID 2.0 PAPE <em class="xref std std-ref">[OpenID.PAPE]</em> <strong>nist_auth_level 0</strong>.)</p>
<p>An absolute URI or an RFC 6711 <a class="reference internal" href="#term-rfc6711"><em class="xref std std-term">[RFC6711]</em></a> registered name
SHOULD be used as the acr value;
registered names MUST NOT be used with a different meaning than
that which is registered.</p>
<p>Parties using this claim will need to agree upon the meanings of the values used,
which may be context-specific.</p>
<p class="last">The acr value is a case sensitive string.</p>
</dd>
<dt id="term-amr">amr</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Authentication Methods References.</p>
<p>JSON array of strings that are identifiers
for authentication methods used in the authentication.</p>
<p>For instance,
values might indicate that both password and OTP authentication methods were used.</p>
<p>The definition of particular values to be used
in the <a class="reference internal" href="messages.html#term-amr"><em class="xref std std-term">amr</em></a> Claim is beyond the scope of this specification.</p>
<p>Parties using this claim will need to agree upon the meanings of the values used,
which may be context-specific.</p>
<p class="last">The amr value is an array of case sensitive strings.</p>
</dd>
<dt id="term-azp">azp</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Authorized party - the party to which the ID Token was issued.</p>
<p>If present,
it MUST contain the OAuth 2.0 Client ID of this party.</p>
<p>This Claim is only needed when the ID Token has a single audience value
and that audience is different than the authorized party.</p>
<p>It MAY be included even when the authorized party is the same as the sole audience.</p>
<p class="last">The azp value is a case sensitive string containing a StringOrURI value.</p>
</dd>
</dl>
<p>ID Tokens MAY contain other Claims.
Any Claims used that are not understood MUST be ignored.</p>
<p>See Sections <a class="reference internal" href="#core-3-1-3-6"><em>3.1.3.6</em></a>, <a class="reference internal" href="#core-3-3-2-11"><em>3.3.2.11</em></a>, <a class="reference internal" href="#core-5-1"><em>5.1</em></a>,
and <a class="reference internal" href="#core-7-4"><em>7.4</em></a> for additional Claims defined by this specification.</p>
<p>ID Tokens MUST be signed using JWS <a class="reference internal" href="jwa.html#term-62"><em class="xref std std-term">[JWS]</em></a>
and optionally both signed and then encrypted
using JWS <a class="reference internal" href="jwa.html#term-62"><em class="xref std std-term">[JWS]</em></a> and JWE <a class="reference internal" href="jwa.html#term-60"><em class="xref std std-term">[JWE]</em></a> respectively,
thereby providing authentication, integrity, non-repudiation, and optionally,
confidentiality, per <em class="xref std std-ref">Section 16.14</em>.</p>
<p>If the ID Token is encrypted,
it MUST be signed then encrypted,
with the result being a Nested <a class="reference internal" href="jwt.html"><em>JWT</em></a>, as defined in <a class="reference internal" href="#term-jwt"><em class="xref std std-term">[JWT]</em></a>.
ID Tokens MUST NOT use <strong>none</strong> as the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> value
unless the Response Type used returns no ID Token from the Authorization Endpoint
(such as when using the Authorization Code Flow)
and the Client explicitly requested the use of <strong>none</strong> at Registration time.</p>
<p>ID Tokens SHOULD NOT use the JWS or JWE x5u, x5c, jku, or jwk header parameter fields.
Instead,
references to keys used are communicated in advance using <a class="reference internal" href="discovery.html"><em>Discovery</em></a>
and <a class="reference internal" href="reg.html"><em>Registration</em></a> parameters, per <a class="reference internal" href="#core-10"><em>Section 10</em></a>.</p>
<p>The following is a non-normative example of
the set of Claims (the JWT Claims Set) in an ID Token:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;iss&quot;</span><span class="o">:</span> <span class="s2">&quot;https://server.example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;sub&quot;</span><span class="o">:</span> <span class="s2">&quot;24400320&quot;</span><span class="p">,</span>
 <span class="s2">&quot;aud&quot;</span><span class="o">:</span> <span class="s2">&quot;s6BhdRkqt3&quot;</span><span class="p">,</span>
 <span class="s2">&quot;nonce&quot;</span><span class="o">:</span> <span class="s2">&quot;n-0S6_WzA2Mj&quot;</span><span class="p">,</span>
 <span class="s2">&quot;exp&quot;</span><span class="o">:</span> <span class="mi">1311281970</span><span class="p">,</span>
 <span class="s2">&quot;iat&quot;</span><span class="o">:</span> <span class="mi">1311280970</span><span class="p">,</span>
 <span class="s2">&quot;auth_time&quot;</span><span class="o">:</span> <span class="mi">1311280969</span><span class="p">,</span>
 <span class="s2">&quot;acr&quot;</span><span class="o">:</span> <span class="s2">&quot;urn:mace:incommon:iap:silver&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>( draft 17 )</p>
</div>
<div class="section" id="authentication">
<span id="core-3"></span><h2><a class="toc-backref" href="#id41">3.  Authentication</a><a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<p>OpenID Connect performs authentication to log
in the End-User or to determine that the End-User is already logged in.
OpenID Connect returns the result of the Authentication
performed by the Server to the Client in a secure manner
so that the Client can rely on it.
For this reason,
the Client is called Relying Party (RP) in this case.</p>
<p>The Authentication result is returned in an ID Token,
as defined in <a class="reference internal" href="#core-2"><em>Section 2</em></a>.
It has Claims expressing such information as the Issuer,
the Subject Identifier, when the authentication expires, etc.</p>
<p>Authentication can follow one of three paths:
the <a class="reference internal" href="#term-authorization-code-flow"><em class="xref std std-term">Authorization Code Flow</em></a> (response_type=code),
the <a class="reference internal" href="#term-implicit-flow"><em class="xref std std-term">Implicit Flow</em></a> (response_type=id_token token or response_type=id_token),
or the <a class="reference internal" href="#term-hybrid-flow"><em class="xref std std-term">Hybrid Flow</em></a> (using other Response Type values
defined in OAuth 2.0 Multiple Response Type Encoding Practices <a class="reference internal" href="#term-oauth-responses"><em class="xref std std-term">[OAuth.Responses]</em></a>).</p>
<p>The flows determine how the ID Token and Access Token are returned to the Client.</p>
<p>The characteristics of the three flows are summarized in the following non-normative table.
The table is intended to provide some guidance on which flow to choose in particular contexts.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="25%" />
<col width="14%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Authorization Code Flow</th>
<th class="head">Implicit Flow</th>
<th class="head">Hybrid Flow</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>All tokens returned from Authorization Endpoint</td>
<td>no</td>
<td>yes</td>
<td>no</td>
</tr>
<tr class="row-odd"><td>All tokens returned from Token Endpoint</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="row-even"><td>Tokens not revealed to User Agent</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="row-odd"><td>Client can be authenticated</td>
<td>yes</td>
<td>no</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>Refresh Token possible</td>
<td>yes</td>
<td>no</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>Communication in one round trip</td>
<td>no</td>
<td>yes</td>
<td>no</td>
</tr>
<tr class="row-even"><td>Most communication server-to-server</td>
<td>yes</td>
<td>no</td>
<td>varies</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The flow used is determined by the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value
contained in the Authorization Request.</p>
<p>These response_type values select these flows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#8220;response_type&#8221; value</th>
<th class="head">Flow</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>code</td>
<td>Authorization Code Flow</td>
</tr>
<tr class="row-odd"><td>id_token</td>
<td>Implicit Flow</td>
</tr>
<tr class="row-even"><td>id_token token</td>
<td>Implicit Flow</td>
</tr>
<tr class="row-odd"><td>code id_token</td>
<td>Hybrid Flow</td>
</tr>
<tr class="row-even"><td>code token</td>
<td>Hybrid Flow</td>
</tr>
<tr class="row-odd"><td>code id_token token</td>
<td>Hybrid Flow</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>All but the <strong>code</strong> Response Type value,
which is defined by <a class="reference internal" href="oauth.html"><em>OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>,
are defined in the OAuth 2.0 Multiple Response Type Encoding Practices <a class="reference internal" href="#term-oauth-responses"><em class="xref std std-term">[OAuth.Responses]</em></a>
specification.</p>
<p>NOTE:</p>
<blockquote>
<div><p>While OAuth 2.0 also defines the <strong>token</strong> Response Type value for the Implicit Flow,
OpenID Connect does not use this Response Type,
since no ID Token would be returned.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">response_type=token の暗黙フローはConnectでは使えない。</p>
</div>
</div></blockquote>
<p>(draft 17)</p>
<div class="section" id="authentication-using-the-authorization-code-flow">
<span id="core-3-1"></span><h3><a class="toc-backref" href="#id42">3.1.  Authentication using the Authorization Code Flow</a><a class="headerlink" href="#authentication-using-the-authorization-code-flow" title="Permalink to this headline">¶</a></h3>
<p>This section describes how to perform authentication
using the <a class="reference internal" href="#term-authorization-code-flow"><em class="xref std std-term">Authorization Code Flow</em></a>.
When using the Authorization Code Flow,
all tokens are returned from the Token Endpoint.</p>
<p>The Authorization Code Flow returns an Authorization Code to the Client,
which can then exchange it for an ID Token and an Access Token directly.
This provides the benefit of not exposing any tokens to the User Agent
and possibly other malicious applications with access to the User Agent.</p>
<p>The Authorization Server can also authenticate the Client
before exchanging the Authorization Code for an Access Token.
The Authorization Code flow is suitable for Clients
that can securely maintain a Client Secret
between themselves and the Authorization Server.</p>
<p>(draf17)</p>
<div class="section" id="authorization-code-flow-steps">
<span id="core-3-1-1"></span><h4><a class="toc-backref" href="#id43">3.1.1.  Authorization Code Flow Steps</a><a class="headerlink" href="#authorization-code-flow-steps" title="Permalink to this headline">¶</a></h4>
<p>The Authorization Code Flow goes through the following steps.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Client prepares an Authentication Request containing the desired request parameters.</li>
<li>Client sends the request to the Authorization Server.</li>
<li>Authorization Server Authenticates the End-User.</li>
<li>Authorization Server obtains End-User Consent/Authorization.</li>
<li>Authorization Server sends the End-User back to the Client with an Authorization Code.</li>
<li>Client requests a response using the Authorization Code at the Token Endpoint.</li>
<li>Client receives a response that contains an ID Token and Access Token in the response body.</li>
<li>Client validates the ID token and retrieves the End-User&#8217;s Subject Identifier.</li>
</ol>
</div></blockquote>
<p>( draft 17 )</p>
</div>
<div class="section" id="authorization-endpoint">
<span id="core-3-1-2"></span><h4><a class="toc-backref" href="#id44">3.1.2.  Authorization Endpoint</a><a class="headerlink" href="#authorization-endpoint" title="Permalink to this headline">¶</a></h4>
<p>The Authorization Endpoint performs Authentication of the End-User.</p>
<p>This is done by sending the User Agent
to the Authorization Server&#8217;s Authorization Endpoint
for Authentication and Authorization,
using request parameters defined by OAuth 2.0
and additional parameters and parameter values defined by OpenID Connect.</p>
<p>Communication with the Authorization Endpoint MUST utilize TLS.
See Section 16.17 for more information on using TLS.</p>
<p>(draft 17)</p>
<div class="section" id="authentication-request">
<span id="core-3-1-2-1"></span><h5><a class="toc-backref" href="#id45">3.1.2.1.  Authentication Request</a><a class="headerlink" href="#authentication-request" title="Permalink to this headline">¶</a></h5>
<p>An Authentication Request is an OAuth 2.0 Authorization Request
that requests that the End-User be authenticated
by the Authorization Server.</p>
<p>Authorization Servers MUST support the use of the HTTP GET
and POST methods defined in RFC 2616 <a class="reference internal" href="oauth_meta.html#term-rfc2616"><em class="xref std std-term">[RFC2616]</em></a>
at the Authorization Endpoint.</p>
<p>Clients MAY use the HTTP GET or POST methods
to send the Authorization Request to the Authorization Server.
If using the HTTP GET method,
the request parameters are serialized using URI Query String Serialization,
per <a class="reference internal" href="#core-13-1"><em>Section 13.1</em></a>.</p>
<p>If using the HTTP POST method,
the request parameters are serialized using Form Serialization,
per <a class="reference internal" href="#core-13-2"><em>Section 13.2</em></a>.</p>
<p>OpenID Connect uses the following OAuth 2.0 request parameters
with the Authorization Code Flow:</p>
<dl class="glossary docutils">
<dt id="term-scope">scope</dt>
<dd><p class="first">REQUIRED.</p>
<p>OpenID Connect requests MUST contain the openid scope value.</p>
<p>If the <strong>openid</strong> <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> value is not present,
the behavior is entirely unspecified.
Other scope values MAY be present.</p>
<p class="last">Scope values used that are not understood by an implementation SHOULD be ignored.
See <a class="reference internal" href="#core-5-4"><em>Sections 5.4</em></a> and <em class="xref std std-term">11</em>
for additional scope values defined by this specification.</p>
</dd>
<dt id="term-response-type">response_type</dt>
<dd><p class="first">REQUIRED.</p>
<p>OAuth 2.0 Response Type value
that determines the authorization processing flow to be used,
including what parameters are returned from the endpoints used.</p>
<p class="last">When using the Authorization Code Flow, this value is <strong>code</strong>.</p>
</dd>
<dt id="term-client-id">client_id</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">OAuth 2.0 Client Identifier valid at the Authorization Server.</p>
</dd>
<dt id="term-redirect-uri">redirect_uri</dt>
<dd><p class="first">REQUIRED.</p>
<p>Redirection URI to which the response will be sent.
This URI MUST exactly match one of the Redirection URI values
for the Client pre-registered at the OpenID Provider,
with the matching performed as described in Section 6.2.1 of <a class="reference internal" href="#term-rfc3986"><em class="xref std std-term">[RFC3986]</em></a>
(Simple String Comparison).</p>
<p>When using this flow,
the Redirection URI SHOULD use the https scheme;
however, it MAY use the http scheme,
provided that the Client Type is <strong>confidential</strong>,
as defined in <a class="reference internal" href="oauth.html#oauth-2-1"><em>Section 2.1 of OAuth 2.0</em></a>,
and provided the OP allows the use of http Redirection URIs in this case.</p>
<p class="last">The Redirection URI MAY use an alternate scheme,
such as one that is intended to identify a callback into a native application.</p>
</dd>
<dt id="term-state">state</dt>
<dd><p class="first">RECOMMENDED.</p>
<p>Opaque value used to maintain state
between the request and the callback.</p>
<p class="last">Typically,
Cross-Site Request Forgery (CSRF, XSRF) mitigation is
done by cryptographically binding the value of this parameter
with a browser cookie.</p>
</dd>
</dl>
<p>OpenID Connect also uses the following OAuth 2.0 request parameter,
which is defined in OAuth 2.0 Multiple Response Type Encoding Practices <a class="reference internal" href="#term-oauth-responses"><em class="xref std std-term">[OAuth.Responses]</em></a>:</p>
<dl class="glossary docutils">
<dt id="term-response-mode">response_mode</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Informs the Authorization Server of the mechanism
to be used for returning parameters from the Authorization Endpoint.</p>
<p class="last">This use of this parameter is NOT RECOMMENDED
when the Response Mode that would be requested is the default mode
specified for the Response Type.</p>
</dd>
</dl>
<p>This specification also defines the following request parameters:</p>
<dl class="glossary docutils">
<dt id="term-51">nonce</dt>
<dd><p class="first">OPTIONAL.</p>
<p>String value used to associate a Client session with an ID Token,
and to mitigate replay attacks.</p>
<p>The value is passed through unmodified
from the Authorization Request to the ID Token.</p>
<p>Sufficient entropy MUST be present in the nonce values
used to prevent attackers from guessing values.</p>
<p class="last">For implementation notes, see <a class="reference internal" href="#core-15-5-2"><em>Section 15.5.2</em></a>.</p>
</dd>
<dt id="term-display">display</dt>
<dd><p class="first">OPTIONAL.</p>
<p>ASCII string value that specifies
how the Authorization Server displays the authentication
and consent user interface pages to the End-User.</p>
<p>The defined values are:</p>
<blockquote>
<div><dl class="docutils">
<dt>page</dt>
<dd><p class="first">The Authorization Server SHOULD display the authentication
and consent UI consistent with a full User Agent page view.</p>
<p class="last">If the display parameter is not specified,
this is the default display mode.</p>
</dd>
<dt>popup</dt>
<dd><p class="first">The Authorization Server SHOULD display the authentication
and consent UI consistent with a popup User Agent window.</p>
<p class="last">The <strong>popup</strong> User Agent window should be of an appropriate size
for a login-focused dialog
and should not obscure the entire window
that it is popping up over.</p>
</dd>
<dt>touch</dt>
<dd>The Authorization Server SHOULD display the authentication
and consent UI consistent
with a device that leverages a touch interface.</dd>
<dt>wap</dt>
<dd>The Authorization Server SHOULD display the authentication
and consent UI consistent with a &#8220;feature phone&#8221; type display.</dd>
</dl>
</div></blockquote>
<p class="last">The Authorization Server MAY also attempt
to detect the capabilities of the User Agent
and present an appropriate display.</p>
</dd>
<dt id="term-prompt">prompt</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Space delimited,
case sensitive list of ASCII string values
that specifies whether the Authorization Server prompts
the End-User for reauthentication and consent.</p>
<p>The defined values are:</p>
<blockquote>
<div><dl class="docutils">
<dt>none</dt>
<dd><p class="first">The Authorization Server MUST NOT display
any authentication or consent user interface pages.</p>
<p>An error is returned
if an End-User is not already authenticated
or the Client does not have pre-configured consent
for the requested Claims
or does not fulfill other conditions
for processing the request.</p>
<p>The error code will typically be <a class="reference internal" href="#term-login-required"><em class="xref std std-term">login_required</em></a>,
<a class="reference internal" href="#term-interaction-required"><em class="xref std std-term">interaction_required</em></a>,
or another code defined in <a class="reference internal" href="#core-3-1-2-6"><em>Section 3.1.2.6</em></a>.</p>
<p class="last">This can be used as a method
to check for existing authentication and/or consent.</p>
</dd>
<dt>login</dt>
<dd><p class="first">The Authorization Server SHOULD prompt the End-User
for reauthentication.</p>
<p class="last">If it cannot reauthenticate the End-User,
it MUST return an error, typically login_required.</p>
</dd>
<dt>consent</dt>
<dd><p class="first">The Authorization Server SHOULD prompt the End-User
for consent before returning information to the Client.</p>
<p class="last">If it cannot obtain consent,
it MUST return an error, typically <a class="reference internal" href="#term-consent-required"><em class="xref std std-term">consent_required</em></a>.</p>
</dd>
<dt>select_account</dt>
<dd><p class="first">The Authorization Server SHOULD prompt the End-User
to select a user account.</p>
<p>This enables an End-User who has multiple accounts
at the Authorization Server to select
amongst the multiple accounts that they might have current sessions for.</p>
<p class="last">If it cannot obtain an account selection choice
made by the End-User,
it MUST return an error,
typically <a class="reference internal" href="#term-account-selection-required"><em class="xref std std-term">account_selection_required</em></a>.</p>
</dd>
</dl>
</div></blockquote>
<p>The prompt parameter can be used by the Client
to make sure that the End-User is still present for the current session
or to bring attention to the request.</p>
<p class="last">If this parameter contains <em class="xref std std-ref">none</em> with any other value,
an error is returned.</p>
</dd>
<dt id="term-max-age">max_age</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Maximum Authentication Age.</p>
<p>Specifies the allowable elapsed time in seconds
since the last time the End-User was actively authenticated by the OP.</p>
<p>If the elapsed time is greater than this value,
the OP MUST attempt to actively re-authenticate the End-User.
(The max_age request parameter corresponds to the OpenID 2.0 PAPE <a class="reference internal" href="#term-openid-pape"><em class="xref std std-term">[OpenID.PAPE]</em></a>
<strong>max_auth_age</strong> request parameter.)</p>
<p class="last">When max_age is used,
the ID Token returned MUST include an auth_time Claim Value.</p>
</dd>
<dt id="term-ui-locales">ui_locales</dt>
<dd><p class="first">OPTIONAL.</p>
<p>End-User&#8217;s preferred languages and scripts for the user interface,
represented as a space-separated list of BCP47 [RFC5646] language tag values,
ordered by preference.</p>
<p>For instance,
the value &#8220;fr-CA fr en&#8221; represents a preference for French
as spoken in Canada, then French (without a region designation),
followed by English (without a region designation).</p>
<p class="last">An error SHOULD NOT result
if some or all of the requested locales are
not supported by the OpenID Provider.</p>
</dd>
<dt id="term-id-token-hint">id_token_hint</dt>
<dd><p class="first">OPTIONAL.</p>
<p>ID Token previously issued by the Authorization Server being passed
as a hint about the End-User&#8217;s current or past authenticated session with the Client.</p>
<p>If the End-User identified by the ID Token is logged in or is logged in by the request,
then the Authorization Server returns a positive response;</p>
<p>otherwise, it SHOULD return an error,
such as <a class="reference internal" href="#term-login-required"><em class="xref std std-term">login_required</em></a>.</p>
<p>When possible,
an id_token_hint SHOULD be present when prompt=none is used
and an <a class="reference internal" href="oauth_bearer.html#term-invalid-request"><em class="xref std std-term">invalid_request</em></a> error MAY be returned if it is not;
however,
the server SHOULD respond successfully when possible,
even if it is not present.</p>
<p>The Authorization Server need not be listed as an audience of the ID Token
when it is used as an id_token_hint value.</p>
<p>If the ID Token received by the RP from the OP is encrypted,
to use it as an id_token_hint,
the Client MUST decrypt the signed ID Token contained within the encrypted ID Token.</p>
<p class="last">The Client MAY re-encrypt the signed ID token to the Authentication Server
using a key that enables the server to decrypt the ID Token,
and use the re-encrypted ID token as the id_token_hint value.</p>
</dd>
<dt id="term-login-hint">login_hint</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Hint to the Authorization Server
about the login identifier the End-User might use to log in (if necessary).</p>
<p>This hint can be used by an RP
if it first asks the End-User for their e-mail address (or other identifier)
and then wants to pass that value as a hint to the discovered authorization service.</p>
<p>It is RECOMMENDED that the hint value match the value used for discovery.</p>
<p>This value MAY also be a phone number in the format specified
for the phone_number Claim.</p>
<p class="last">The use of this parameter is left to the OP&#8217;s discretion.</p>
</dd>
<dt id="term-acr-values">acr_values</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Requested Authentication Context Class Reference values.
Space-separated string that specifies the acr values
that the Authorization Server is being requested
to use for processing this Authentication Request,
with the values appearing in order of preference.</p>
<p>The Authentication Context Class satisfied by the authentication performed
is returned as the acr Claim Value,
as specified in <a class="reference internal" href="#core-2"><em>Section 2</em></a>.</p>
<p class="last">The acr Claim is requested as a Voluntary Claim by this parameter.</p>
</dd>
</dl>
<p>Other parameters MAY be sent.
See Sections <a class="reference internal" href="#core-3-2-2"><em>3.2.2</em></a>, <a class="reference internal" href="#core-3-3-2"><em>3.3.2</em></a>, <a class="reference internal" href="#core-5-2"><em>5.2</em></a>,
<em class="xref std std-ref">5.5 &lt;core.5.</em>, <a class="reference internal" href="#core-6"><em>6</em></a>, and <a class="reference internal" href="#core-7-2-1"><em>7.2.1</em></a>
for additional Authorization Request parameters
and parameter values defined by this specification.</p>
<p>The following is a non-normative example HTTP 302 redirect response
by the Client,
which triggers the User Agent to make an Authentication Request
to the Authorization Endpoint
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://server.example.com/authorize?
  response_type=code
  &amp;scope=openid%20profile%20email
  &amp;client_id=s6BhdRkqt3
  &amp;state=af0ifjsldkj
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb</pre>
</div>
<p>The following is the non-normative example request
that would be sent by the User Agent to the Authorization Server
in response to the HTTP 302 redirect response
by the Client above
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>GET /authorize?
  response_type=code
  &amp;scope=openid%20profile%20email
  &amp;client_id=s6BhdRkqt3
  &amp;state=af0ifjsldkj
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb HTTP/1.1
Host: server.example.com</pre>
</div>
</div>
<div class="section" id="authentication-request-validation">
<span id="core-3-1-2-2"></span><h5><a class="toc-backref" href="#id46">3.1.2.2.  Authentication Request Validation</a><a class="headerlink" href="#authentication-request-validation" title="Permalink to this headline">¶</a></h5>
<p>The Authorization Server MUST validate the request received as follows:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The Authorization Server MUST validate
all the <a class="reference internal" href="oauth.html"><em>OAuth 2.0</em></a> parameters
according to the OAuth 2.0 specification.</p>
</li>
<li><p class="first">Verify that a <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> parameter is present
and contains the <strong>openid</strong> scope value.</p>
<p>(If no <strong>openid</strong> scope value is present,
the request may still be a valid OAuth 2.0 request,
but is not an OpenID Connect request.)</p>
</li>
<li><p class="first">The Authorization Server MUST verify
that all the REQUIRED parameters are present
and their usage conforms to this specification.</p>
</li>
<li><p class="first">If the <a class="reference internal" href="messages.html#term-sub"><em class="xref std std-term">sub</em></a> (subject) Claim is requested
with a specific value for the ID Token,
the Authorization Server MUST only send a positive response
if the End-User identified by that <a class="reference internal" href="messages.html#term-sub"><em class="xref std std-term">sub</em></a> value has an active session
with the Authorization Server
or has been Authenticated as a result of the request.</p>
<p>The Authorization Server MUST NOT reply with an ID Token
or Access Token for a different user,
even if they have an active session with the Authorization Server.</p>
<p>Such a request can be made either using an id_token_hint parameter
or by requesting a specific Claim Value
as described in <a class="reference internal" href="#core-5-5-1"><em>Section 5.5.1</em></a>,
if the claims parameter is supported by the implementation.</p>
</li>
</ol>
</div></blockquote>
<p>As specified in <a class="reference internal" href="oauth.html"><em>OAuth 2.0</em></a> <em class="xref std std-ref">[RFC6749]</em>,
Authorization Servers SHOULD ignore unrecognized request parameters.</p>
<p>If the Authorization Server encounters any error,
it MUST return an error response,
per <a class="reference internal" href="#core-3-1-2-6"><em>Section 3.1.2.6</em></a></p>
<p>(draft17)</p>
</div>
<div class="section" id="authorization-server-authenticates-end-user">
<span id="core-3-1-2-3"></span><h5><a class="toc-backref" href="#id47">3.1.2.3.  Authorization Server Authenticates End-User</a><a class="headerlink" href="#authorization-server-authenticates-end-user" title="Permalink to this headline">¶</a></h5>
<p>If the request is valid,
the Authorization Server attempts to Authenticate the End-User
or determines whether the End-User is Authenticated,
depending upon the request parameter values used.</p>
<p>The methods used by the Authorization Server to Authenticate the End-User
(e.g. username and password, session cookies, etc.)
are beyond the scope of this specification.
An Authentication user interface MAY be displayed by the Authorization Server,
depending upon the request parameter values used and the authentication methods used.</p>
<p>The Authorization Server MUST attempt
to Authenticate the End-User in the following cases:</p>
<blockquote>
<div><ul class="simple">
<li>The End-User is not already Authenticated.</li>
<li>The Authentication Request contains the prompt parameter with the value login. In this case, the Authorization Server MUST reauthenticate the End-User even if the End-User is already authenticated.</li>
</ul>
</div></blockquote>
<p>The Authorization Server MUST NOT interact
with the End-User in the following case:</p>
<blockquote>
<div><ul>
<li><p class="first">The Authentication Request contains the <a class="reference internal" href="messages.html#term-67"><em class="xref std std-term">prompt</em></a> parameter
with the value <a class="reference internal" href="messages.html#term-none"><em class="xref std std-term">none</em></a>.</p>
<p>In this case,
the Authorization Server MUST return an error
if an End-User is not already Authenticated
or could not be silently Authenticated.</p>
</li>
</ul>
</div></blockquote>
<p>When interacting with the End-User,
the Authorization Server MUST employ appropriate measures
against Cross-Site Request Forgery and Clickjacking as,
described in <a class="reference internal" href="oauth.html#oauth-10-12"><em>Sections 10.12</em></a>
and <a class="reference internal" href="oauth.html#oauth-10-13"><em>10.13</em></a> of OAuth 2.0 <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="authorization-server-obtains-end-user-consent-authorization">
<span id="core-3-1-2-4"></span><h5><a class="toc-backref" href="#id48">3.1.2.4.  Authorization Server Obtains End-User Consent/Authorization</a><a class="headerlink" href="#authorization-server-obtains-end-user-consent-authorization" title="Permalink to this headline">¶</a></h5>
<p>Once the End-User is authenticated,
the Authorization Server MUST obtain an authorization decision
before releasing information to the Relying Party.</p>
<p>When permitted by the request parameters used,
this MAY be done through an interactive dialogue
with the End-User that makes it clear what is being consented to
or by establishing consent via conditions for processing the request
or other means
(for example, via previous administrative consent).</p>
<p><a class="reference internal" href="#core-2"><em>Sections 2</em></a> and <a class="reference internal" href="#core-2"><em>5.3</em></a> describe information release mechanisms.</p>
<p>(draft17)</p>
</div>
<div class="section" id="successful-authentication-response">
<span id="core-3-1-2-5"></span><h5><a class="toc-backref" href="#id49">3.1.2.5.  Successful Authentication Response</a><a class="headerlink" href="#successful-authentication-response" title="Permalink to this headline">¶</a></h5>
<p>An Authentication Response is an OAuth 2.0 Authorization Response message
returned from the OP&#8217;s Authorization Endpoint
in response to the Authorization Request message sent by the RP.</p>
<p>When using the <a class="reference internal" href="#term-authorization-code-flow"><em class="xref std std-term">Authorization Code Flow</em></a>,
the Authorization Response MUST return the parameters
defined in <a class="reference internal" href="oauth.html#oauth-4-1-2"><em>Section 4.1.2 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>
by adding them as query parameters to the <a class="reference internal" href="messages.html#term-63"><em class="xref std std-term">redirect_uri</em></a>
specified in the Authorization Request
using the <strong>application/x-www-form-urlencoded</strong> format,
unless a different Response Mode was specified.</p>
<p>The following is a non-normative example successful response
using this flow (with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.org/cb?
  code=SplxlOBeZQQYbYS6WxSbIA
  &amp;state=af0ifjsldkj</pre>
</div>
<p>For implementation notes on the contents of the Authorization Code,
see Section <a class="reference internal" href="#core-15-5-1"><em>15.5.1</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="authentication-error-response">
<span id="core-3-1-2-6"></span><h5><a class="toc-backref" href="#id50">3.1.2.6.  Authentication Error Response</a><a class="headerlink" href="#authentication-error-response" title="Permalink to this headline">¶</a></h5>
<p>An Authentication Error Response is an OAuth 2.0 Authorization Error Response message
returned from the OP&#8217;s Authorization Endpoint
in response to the Authorization Request message sent by the RP.</p>
<p>If the End-User denies the request or the End-User authentication fails,
the OP (Authorization Server) informs the RP (Client)
by using the Error Response parameters
defined in <a class="reference internal" href="oauth.html#oauth-4-1-2-1"><em>Section 4.1.2.1</em></a> of OAuth 2.0 <em class="xref std std-ref">[RFC6749]</em>.
(HTTP errors unrelated to RFC 6749 are returned to the User Agent
using the appropriate HTTP status code.)</p>
<p>Unless the Redirection URI is invalid,
the Authorization Server returns the Client to the Redirection URI
specified in the Authorization Request with the appropriate error
and state parameters.
Other parameters SHOULD NOT be returned.</p>
<p>In addition to the error codes defined in <a class="reference internal" href="oauth.html#oauth-4-1-2-1"><em>Section 4.1.2.1 of OAuth 2.0</em></a>,
this specification also defines the following error codes:</p>
<dl class="glossary docutils">
<dt id="term-interaction-required">interaction_required</dt>
<dd>The Authorization Server requires End-User interaction of some form to proceed. This error MAY be returned when the prompt parameter value in the Authentication Request is none, but the Authentication Request cannot be completed without displaying a user interface for End-User interaction.</dd>
<dt id="term-login-required">login_required</dt>
<dd>The Authorization Server requires End-User authentication. This error MAY be returned when the prompt parameter value in the Authentication Request is none, but the Authentication Request cannot be completed without displaying a user interface for End-User authentication.</dd>
<dt id="term-account-selection-required">account_selection_required</dt>
<dd>The End-User is REQUIRED to select a session at the Authorization Server. The End-User MAY be authenticated at the Authorization Server with different associated accounts, but the End-User did not select a session. This error MAY be returned when the prompt parameter value in the Authentication Request is none, but the Authentication Request cannot be completed without displaying a user interface to prompt for a session to use.</dd>
<dt id="term-consent-required">consent_required</dt>
<dd>The Authorization Server requires End-User consent. This error MAY be returned when the prompt parameter value in the Authentication Request is none, but the Authentication Request cannot be completed without displaying a user interface for End-User consent.</dd>
<dt id="term-invalid-request-uri">invalid_request_uri</dt>
<dd>The request_uri in the Authorization Request returns an error or contains invalid data.</dd>
<dt id="term-invalid-request-object">invalid_request_object</dt>
<dd>The request parameter contains an invalid Request Object.</dd>
<dt id="term-request-not-supported">request_not_supported</dt>
<dd>The OP does not support use of the request parameter defined in Section 6.</dd>
<dt id="term-request-uri-not-supported">request_uri_not_supported</dt>
<dd>The OP does not support use of the request_uri parameter defined in Section 6.</dd>
<dt id="term-registration-not-supported">registration_not_supported</dt>
<dd>The OP does not support use of the registration parameter defined in Section 7.2.1.</dd>
</dl>
<p>The error response parameters are the following:</p>
<dl class="glossary docutils">
<dt id="term-error">error</dt>
<dd>REQUIRED. Error code.</dd>
<dt id="term-error-description">error_description</dt>
<dd>OPTIONAL. Human-readable ASCII encoded text description of the error.</dd>
<dt id="term-error-uri">error_uri</dt>
<dd>OPTIONAL. URI of a web page that includes additional information about the error.</dd>
<dt id="term-71">state</dt>
<dd><p class="first">OAuth 2.0 state value.</p>
<p>REQUIRED
if the Authorization Request included the state parameter.</p>
<p class="last">Set to the value received from the Client.</p>
</dd>
</dl>
<p>When using the Authorization Code Flow,
the error response parameters are added to the query component of the Redirection URI,
unless a different Response Mode was specified.</p>
<p>The following is a non-normative example error response
using this flow (with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>HTTP/1.1 302 Found

Location: https://client.example.org/cb?
  error=invalid_request
  &amp;error_description=
    Unsupported%20response_type%20value
  &amp;state=af0ifjsldkj</pre>
</div>
</div>
<div class="section" id="authentication-response-validation">
<span id="core-3-1-2-7"></span><h5><a class="toc-backref" href="#id51">3.1.2.7.  Authentication Response Validation</a><a class="headerlink" href="#authentication-response-validation" title="Permalink to this headline">¶</a></h5>
<p>When using the Authorization Code Flow,
the Client MUST validate the response according to RFC 6749,
especially Sections 4.1.2 and 10.12.</p>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="token-endpoint">
<span id="core-3-1-3"></span><h4><a class="toc-backref" href="#id52">3.1.3.  Token Endpoint</a><a class="headerlink" href="#token-endpoint" title="Permalink to this headline">¶</a></h4>
<p>To obtain an Access Token, an ID Token, and optionally a Refresh Token,
the RP (Client) sends a Token Request to the Token Endpoint
to obtain a Token Response,
as described in <em class="xref std std-ref">Section 3.2 of OAuth 2.0</em> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>,
when using the Authorization Code Flow.</p>
<p>Communication with the Token Endpoint MUST utilize TLS.</p>
<p>See Section 16.17 for more information on using TLS.</p>
<p>(draft 17)</p>
<div class="section" id="token-request">
<span id="core-3-1-3-1"></span><h5><a class="toc-backref" href="#id53">3.1.3.1.  Token Request</a><a class="headerlink" href="#token-request" title="Permalink to this headline">¶</a></h5>
<p>A Client makes a Token Request by presenting its Authorization Grant
(in the form of an Authorization Code)
to the Token Endpoint
using the <a class="reference internal" href="oauth_assertion.html#term-grant-type"><em class="xref std std-term">grant_type</em></a> value <a class="reference internal" href="glossary.html#term-341"><em class="xref std std-term">authorization_code</em></a>,
as described in <a class="reference internal" href="oauth.html#oauth-4-1-3"><em>Section 4.1.3 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>.</p>
<p>If the Client is a Confidential Client,
then it MUST authenticate to the Token Endpoint
using the authentication method registered for its <a class="reference internal" href="messages.html#term-62"><em class="xref std std-term">client_id</em></a>,
as described in <em class="xref std std-term">Section 9</em>.</p>
<p>The Client sends the parameters to the Token Endpoint
using the HTTP POST method and the Form Serialization, per Section 13.2,
as described in <a class="reference internal" href="oauth.html#oauth-4-1-3"><em>Section 4.1.3 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>.</p>
<p>The following is a non-normative example of a Token Request
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded
Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW

grant_type=authorization_code&amp;code=SplxlOBeZQQYbYS6WxSbIA
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="token-request-validation">
<span id="core-3-1-3-2"></span><h5><a class="toc-backref" href="#id54">3.1.3.2.  Token Request Validation</a><a class="headerlink" href="#token-request-validation" title="Permalink to this headline">¶</a></h5>
<p>The Authorization Server MUST validate the Token Request as follows:</p>
<blockquote>
<div><ul>
<li><p class="first">Authenticate the Client if it was issued Client Credentials
or if it uses another Client Authentication method, per Section 9.</p>
</li>
<li><p class="first">Ensure the Authorization Code was issued to the authenticated Client.</p>
</li>
<li><p class="first">Verify that the Authorization Code is valid.</p>
</li>
<li><p class="first">If possible,
verify that the Authorization Code has not been previously used.</p>
</li>
<li><p class="first">Ensure that the <a class="reference internal" href="messages.html#term-63"><em class="xref std std-term">redirect_uri</em></a> parameter value is identical
to the <a class="reference internal" href="messages.html#term-63"><em class="xref std std-term">redirect_uri</em></a> parameter value
that was included in the initial Authorization Request.</p>
<p>If the <a class="reference internal" href="messages.html#term-63"><em class="xref std std-term">redirect_uri</em></a> parameter value is not present
when there is only one registered <a class="reference internal" href="messages.html#term-63"><em class="xref std std-term">redirect_uri</em></a> value,
the Authorization Server MAY return an error
(since the Client should have included the parameter)
or MAY proceed without an error
(since OAuth 2.0 permits the parameter to be omitted in this case).</p>
</li>
<li><p class="first">Verify that the Authorization Code used was issued
in response to an OpenID Connect Authentication Request
(so that an ID Token will be returned from the Token Endpoint).</p>
</li>
</ul>
</div></blockquote>
<p>(draft17)</p>
</div>
<div class="section" id="successful-token-response">
<span id="core-3-1-3-3"></span><h5><a class="toc-backref" href="#id55">3.1.3.3.  Successful Token Response</a><a class="headerlink" href="#successful-token-response" title="Permalink to this headline">¶</a></h5>
<p>After receiving and validating a valid
and authorized Token Request from the Client,
the Authorization Server returns a successful response
that includes an <a class="reference internal" href="messages.html#term-id-token"><em class="xref std std-term">ID Token</em></a> and an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>.</p>
<p>The parameters in the successful response are defined
in <a class="reference internal" href="oauth.html#oauth-4-1-4"><em>Section 4.1.4 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>.
The response uses the <strong>application/json</strong> media type.</p>
<p>The OAuth 2.0 <a class="reference internal" href="implicit.html#term-token-type"><em class="xref std std-term">token_type</em></a> response parameter value MUST be <strong>Bearer</strong>,
as specified in <em class="xref std std-ref">OAuth 2.0 Bearer Token Usage</em> <a class="reference internal" href="#term-rfc6750"><em class="xref std std-term">[RFC6750]</em></a>,
unless another Token Type has been negotiated with the Client.</p>
<p>Servers SHOULD support the Bearer Token Type;
use of other Token Types is outside the scope of this specification.</p>
<p>In addition to the response parameters specified by OAuth 2.0,
the following parameters MUST be included in the response:</p>
<dl class="glossary docutils">
<dt id="term-72">id_token</dt>
<dd>ID Token value associated with the authenticated session.</dd>
</dl>
<p>All Token Responses that contain tokens, secrets, or other sensitive information MUST include the following HTTP response header fields and values:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Header Name</th>
<th class="head">Header Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Cache-Control</td>
<td>no-store</td>
</tr>
<tr class="row-odd"><td>Pragma</td>
<td>no-cache</td>
</tr>
</tbody>
</table>
<p>HTTP Response Headers and Values</p>
</div></blockquote>
<p>The following is a non-normative example of a successful Token Response.
The ID Token signature in the example can be verified with the key at <a class="reference internal" href="#core-appendix-a-7"><em>Appendix A.7</em></a>.</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
Pragma: no-cache

{
 "access_token": "SlAV32hkKG",
 "token_type": "Bearer",
 "refresh_token": "8xLOxBtZp8",
 "expires_in": 3600,
 "id_token": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjFlOWdkazcifQ.ewogImlzc
   yI6ICJodHRwOi8vc2VydmVyLmV4YW1wbGUuY29tIiwKICJzdWIiOiAiMjQ4Mjg5
   NzYxMDAxIiwKICJhdWQiOiAiczZCaGRSa3F0MyIsCiAibm9uY2UiOiAibi0wUzZ
   fV3pBMk1qIiwKICJleHAiOiAxMzExMjgxOTcwLAogImlhdCI6IDEzMTEyODA5Nz
   AKfQ.ggW8hZ1EuVLuxNuuIJKX_V8a_OMXzR0EHR9R6jgdqrOOF4daGU96Sr_P6q
   Jp6IcmD3HP99Obi1PRs-cwh3LO-p146waJ8IhehcwL7F09JdijmBqkvPeB2T9CJ
   NqeGpe-gccMg4vfKjkM8FcGvnzZUN4_KSP0aAp1tOJ1zZwgjxqGByKHiOtX7Tpd
   QyHE5lcMiKPXfEIQILVq0pc_E2DzL7emopWoaoZTF_m0_N0YzFC6g6EJbOEoRoS
   K5hoDalrcvRYLSrQAZZKflyuVCyixEoV9GfNQC3_osjzw2PAithfubEEBLuVVk4
   XUVrWOLrLl0nx7RkKU8NXNHq-rvKMzqg"
}</pre>
</div>
<p>As specified in <a class="reference internal" href="oauth.html"><em>OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>,
Clients SHOULD ignore unrecognized response parameters.</p>
<p>( draft17 )</p>
</div>
<div class="section" id="token-error-response">
<span id="core-3-1-3-4"></span><h5><a class="toc-backref" href="#id56">3.1.3.4.  Token Error Response</a><a class="headerlink" href="#token-error-response" title="Permalink to this headline">¶</a></h5>
<p>If the Token Request is invalid or unauthorized,
the Authorization Server constructs the error response.</p>
<p>The parameters of the Token Error Response are defined as
in <a class="reference internal" href="oauth.html#oauth-5-2"><em>Section 5.2 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>.</p>
<p>The HTTP response body uses the <strong>application/json</strong> media type
with HTTP response code of 400.</p>
<p>The following is a non-normative example Token Error Response:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
Pragma: no-cache

{
 "error": "invalid_request"
}</pre>
</div>
<p>( draft17 )</p>
</div>
<div class="section" id="token-response-validation">
<span id="core-3-1-3-5"></span><h5><a class="toc-backref" href="#id57">3.1.3.5.  Token Response Validation</a><a class="headerlink" href="#token-response-validation" title="Permalink to this headline">¶</a></h5>
<p>The Client MUST validate the Token Response as follows:</p>
<blockquote>
<div><ul class="simple">
<li>Follow the validation rules in RFC 6749, especially those in Sections 5.1 and 10.12.</li>
<li>Follow the ID Token validation rules in Section 3.1.3.7.</li>
<li>Follow the Access Token validation rules in Section 3.1.3.8.</li>
</ul>
</div></blockquote>
<p>( draft17 )</p>
</div>
<div class="section" id="core-3-1-3-6">
<span id="id2"></span><h5><a class="toc-backref" href="#id58">3.1.3.6.  ID Token</a><a class="headerlink" href="#core-3-1-3-6" title="Permalink to this headline">¶</a></h5>
<p>The contents of the ID Token are as described in <a class="reference internal" href="#core-2"><em>Section 2</em></a>.
When using the Authorization Code Flow,
these additional requirements for the following ID Token Claims apply:</p>
<dl class="glossary docutils">
<dt id="term-at-hash">at_hash</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Access Token hash value.</p>
<p>Its value is the <a class="reference internal" href="jwa.html#term-base64url-encoding"><em class="xref std std-term">base64url encoding</em></a> of
the left-most half of the hash of the octets of the ASCII representation of
the access_token value,
where the hash algorithm used is the hash algorithm used
in the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> parameter of the ID Token&#8217;s <a class="reference internal" href="jws.html"><em>JWS</em></a> [JWS] header.</p>
<p>For instance,
if the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> is <a class="reference internal" href="glossary.html#term-rs256"><em class="xref std std-term">RS256</em></a>,
hash the <a class="reference internal" href="messages.html#term-access-token"><em class="xref std std-term">access_token</em></a> value with <a class="reference internal" href="glossary.html#term-sha-256"><em class="xref std std-term">SHA-256</em></a>,
then take the left-most 128 bits and <a class="reference internal" href="session.html#term-base64url"><em class="xref std std-term">base64url</em></a> encode them.</p>
<p class="last">The <a class="reference internal" href="messages.html#term-at-hash"><em class="xref std std-term">at_hash</em></a> value is a case sensitive string.</p>
</dd>
</dl>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-1-3-7">
<span id="id-token-validation"></span><h5><a class="toc-backref" href="#id59">3.1.3.7.  ID Token Validation</a><a class="headerlink" href="#core-3-1-3-7" title="Permalink to this headline">¶</a></h5>
<p>Clients MUST validate the ID Token in the Token Response in the following manner:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">If the ID Token is encrypted,
decrypt it using the keys and algorithms that the Client specified
during Registration that the OP was to use to encrypt the ID Token.
If encryption was negotiated with the OP at Registration time
and the ID Token is not encrypted, the RP SHOULD reject it.</p>
</li>
<li><p class="first">The Issuer Identifier for the OpenID Provider
(which is typically obtained during Discovery)
MUST exactly match the value of the iss (issuer) Claim.</p>
</li>
<li><p class="first">The Client MUST validate that the aud (audience)
Claim contains its client_id value registered at the Issuer
identified by the iss (issuer) Claim as an audience.</p>
<p>The aud (audience) Claim MAY contain an array with more than one element.</p>
<p>The ID Token MUST be rejected if the ID Token does not list the Client
as a valid audience,
or if it contains additional audiences not trusted by the Client.</p>
</li>
<li><p class="first">If the ID Token contains multiple audiences,
the Client SHOULD verify that an <a class="reference internal" href="messages.html#term-azp"><em class="xref std std-term">azp</em></a> Claim is present.</p>
</li>
<li><p class="first">If an <a class="reference internal" href="messages.html#term-azp"><em class="xref std std-term">azp</em></a> (authorized party) Claim is present,
the Client SHOULD verify that its <a class="reference internal" href="messages.html#term-62"><em class="xref std std-term">client_id</em></a> is the Claim Value.</p>
</li>
<li><p class="first">If the ID Token is received via direct communication
between the Client and the Token Endpoint
(which it is in this flow),
the TLS server validation MAY be used to validate the issuer
in place of checking the token signature.</p>
<p>The Client MUST validate the signature of
all other ID Tokens according to JWS [JWS]
using the algorithm specified in the JWT alg header parameter.</p>
<p>The Client MUST use the keys provided by the Issuer.</p>
</li>
<li><p class="first">The <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> value SHOULD be the default of RS256
or the algorithm sent by the Client
in the <a class="reference internal" href="reg.html#term-id-token-signed-response-alg"><em class="xref std std-term">id_token_signed_response_alg</em></a> parameter
during <a class="reference internal" href="reg.html"><em>Registration</em></a>.</p>
</li>
<li><p class="first">If the JWT <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> header parameter uses a MAC based algorithm
such as HS256, HS384, or HS512,
the octets of the UTF-8 representation of the <a class="reference internal" href="oauth.html#term-client-secret"><em class="xref std std-term">client_secret</em></a>
corresponding to the <a class="reference internal" href="messages.html#term-62"><em class="xref std std-term">client_id</em></a> contained
in the <a class="reference internal" href="messages.html#term-aud"><em class="xref std std-term">aud</em></a> (audience) Claim are used as the key
to validate the signature.</p>
<p>For MAC based algorithms,
the behavior is unspecified if the <a class="reference internal" href="messages.html#term-aud"><em class="xref std std-term">aud</em></a> is multi-valued
or if an <a class="reference internal" href="messages.html#term-azp"><em class="xref std std-term">azp</em></a> value is present that is different than the aud value.</p>
</li>
<li><p class="first">The current time MUST be
before the time represented by the <a class="reference internal" href="messages.html#term-exp"><em class="xref std std-term">exp</em></a> Claim.</p>
</li>
<li><p class="first">The <a class="reference internal" href="messages.html#term-iat"><em class="xref std std-term">iat</em></a> Claim can be used to reject tokens
that were issued too far away from the current time,
limiting the amount of time that nonces need to be stored
to prevent attacks.</p>
<p>The acceptable range is Client specific.</p>
</li>
<li><p class="first">If a <a class="reference internal" href="messages.html#term-78"><em class="xref std std-term">nonce</em></a> value was sent in the Authentication Request,
a nonce Claim MUST be present and its value checked
to verify that it is the same value as the one
that was sent in the Authentication Request.</p>
<p>The Client SHOULD check the <a class="reference internal" href="messages.html#term-78"><em class="xref std std-term">nonce</em></a> value for <a class="reference internal" href="glossary.html#term-replay-attacks"><em class="xref std std-term">replay attacks</em></a>.</p>
<p>The precise method for detecting replay attacks is Client specific.</p>
</li>
<li><p class="first">If the <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a> Claim was requested,
the Client SHOULD check that the asserted Claim Value is appropriate.</p>
<p>The meaning and processing of acr Claim Values is
out of scope for this specification.</p>
</li>
<li><p class="first">If the <a class="reference internal" href="messages.html#term-87"><em class="xref std std-term">auth_time</em></a> Claim was requested,
either through a specific request for this Claim
or by using the <a class="reference internal" href="messages.html#term-89"><em class="xref std std-term">max_age</em></a> parameter,
the Client SHOULD check the <a class="reference internal" href="messages.html#term-87"><em class="xref std std-term">auth_time</em></a> Claim value
and request re-authentication
if it determines too much time has elapsed
since the last End-User authentication.</p>
</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
<div class="section" id="access-token-validation">
<span id="core-3-1-3-8"></span><h5><a class="toc-backref" href="#id60">3.1.3.8.  Access Token Validation</a><a class="headerlink" href="#access-token-validation" title="Permalink to this headline">¶</a></h5>
<p>When using the Authorization Code Flow,
if the ID Token contains an <a class="reference internal" href="messages.html#term-at-hash"><em class="xref std std-term">at_hash</em></a> Claim,
the Client MAY use it to validate the Access Token in the same manner
as for the Implicit Flow,
as defined in <a class="reference internal" href="#core-3-2-2-9"><em>Section 3.2.2.9</em></a>,
but using the ID Token and Access Token returned from the Token Endpoint.</p>
<p>(draft17)</p>
</div>
</div>
</div>
<div class="section" id="authentication-using-the-implicit-flow">
<span id="core-3-2"></span><h3><a class="toc-backref" href="#id61">3.2.  Authentication using the Implicit Flow</a><a class="headerlink" href="#authentication-using-the-implicit-flow" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>No Token Endpoint</li>
<li>No Client Authentication</li>
</ul>
</div>
<p>This section describes how to perform authentication using the Implicit Flow.
When using the Implicit Flow,
all tokens are returned from the Authorization Endpoint;
the <em class="xref std std-term">Token Endpoint</em> is not used.</p>
<p>The Implicit Flow is mainly used by Clients implemented
in a browser using a scripting language.</p>
<p>The Access Token and ID Token are returned directly to the Client,
which may expose them to the End-User and applications
that have access to the End-User&#8217;s User Agent.</p>
<p>The Authorization Server does not perform Client Authentication.</p>
<p>( draft17 )</p>
<ul class="simple">
<li><a class="reference external" href="https://openid.net/specs/openid-connect-core-1_0-17.html#ImplicitFlowAuth">https://openid.net/specs/openid-connect-core-1_0-17.html#ImplicitFlowAuth</a></li>
</ul>
<div class="section" id="implicit-flow-steps">
<span id="core-3-2-1"></span><h4><a class="toc-backref" href="#id62">3.2.1.  Implicit Flow Steps</a><a class="headerlink" href="#implicit-flow-steps" title="Permalink to this headline">¶</a></h4>
<p>The Implicit Flow follows the following steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Client prepares an Authentication Request
containing the desired request parameters.</li>
<li>Client sends the request to the Authorization Server.</li>
<li>Authorization Server Authenticates the End-User.</li>
<li>Authorization Server obtains End-User Consent/Authorization.</li>
<li>Authorization Server sends the End-User back to the Client
with an ID Token and,
if requested, an Access Token.</li>
<li>Client validates the ID token and retrieves the End-User&#8217;s Subject Identifier.</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-2-2">
<span id="id3"></span><h4><a class="toc-backref" href="#id63">3.2.2.  Authorization Endpoint</a><a class="headerlink" href="#core-3-2-2" title="Permalink to this headline">¶</a></h4>
<p>When using the Implicit Flow,
the Authorization Endpoint is used in the same manner
as for the <a class="reference internal" href="#term-authorization-code-flow"><em class="xref std std-term">Authorization Code Flow</em></a>,
as defined in <a class="reference internal" href="#core-3-1-2"><em>Section 3.1.2</em></a>,
with the exception of the differences specified in this section.</p>
<p>( draft17 )</p>
<div class="section" id="core-3-2-2-1">
<span id="id4"></span><h5><a class="toc-backref" href="#id64">3.2.2.1.  Authentication Request</a><a class="headerlink" href="#core-3-2-2-1" title="Permalink to this headline">¶</a></h5>
<p>Authentication Requests are made as defined in <a class="reference internal" href="#core-3-1-2-1"><em>Section 3.1.2.1</em></a>,
except that these Authentication Request parameters are used as follows:</p>
<dl class="glossary docutils">
<dt id="term-74">response_type</dt>
<dd><p class="first">REQUIRED.</p>
<p>OAuth 2.0 Response Type value that determines
the authorization processing flow to be used,
including what parameters are returned from the endpoints used.</p>
<p>When using the Implicit Flow,
this value is <a class="reference internal" href="standard.html#term-id-token-token"><em class="xref std std-term">id_token token</em></a> or <a class="reference internal" href="messages.html#term-96"><em class="xref std std-term">id_token</em></a>.</p>
<p>The meanings of both of these values are defined
in OAuth 2.0 Multiple Response Type Encoding Practices <a class="reference internal" href="#term-oauth-responses"><em class="xref std std-term">[OAuth.Responses]</em></a>.</p>
<p>No Access Token is returned when the value is id_token.</p>
<p>NOTE:</p>
<blockquote class="last">
<div>While OAuth 2.0 also defines the <a class="reference internal" href="standard.html#term-token"><em class="xref std std-term">token</em></a> Response Type value
for the Implicit Flow,
OpenID Connect does not use this Response Type,
since no ID Token would be returned.</div></blockquote>
</dd>
<dt id="term-75">redirect_uri</dt>
<dd><p class="first">REQUIRED.</p>
<p>Redirection URI to which the response will be sent.</p>
<p>This URI MUST exactly match one of the Redirection URI values
for the Client pre-registered at the OpenID Provider,
with the matching performed as described in Section 6.2.1 of <a class="reference internal" href="#term-rfc3986"><em class="xref std std-term">[RFC3986]</em></a>
(Simple String Comparison).</p>
<p class="last">When using this flow,
the Redirection URI MUST NOT use the http scheme
unless the Client is a native application,
in which case it MAY use the http: scheme with localhost as the hostname.</p>
</dd>
<dt id="term-76">nonce</dt>
<dd><p class="first">REQUIRED.</p>
<p>String value used to associate a Client session with an ID Token,
and to mitigate replay attacks.</p>
<p>The value is passed through <strong>unmodified</strong> from the Authentication Request
to the ID Token.</p>
<p>Sufficient <em class="xref std std-term">entropy</em> MUST be present in the <a class="reference internal" href="messages.html#term-78"><em class="xref std std-term">nonce</em></a> values
used to prevent attackers from guessing values.</p>
<p class="last">For implementation notes, see <a class="reference internal" href="#core-15-5-2"><em>Section 15.5.2</em></a>.</p>
</dd>
</dl>
<p>The following is a non-normative example request
using the Implicit Flow
that would be sent by the User Agent
to the Authorization Server
in response to a corresponding HTTP 302 redirect response
by the Client
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>GET /authorize?
  response_type=id_token%20token
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid%20profile
  &amp;state=af0ifjsldkj
  &amp;nonce=n-0S6_WzA2Mj HTTP/1.1
Host: server.example.com</pre>
</div>
<p>( draft17 )</p>
</div>
<div class="section" id="core-3-2-2-2">
<span id="id5"></span><h5><a class="toc-backref" href="#id65">3.2.2.2.  Authentication Request Validation</a><a class="headerlink" href="#core-3-2-2-2" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Codeフローと全く同じ</li>
</ul>
</div>
<p>When using the Implicit Flow,
the Authentication Request is validated in the same manner
as for the Authorization Code Flow,
as defined in <em class="xref std std-term">Section 3.1.2.2</em>.</p>
<p>( draft17 )</p>
</div>
<div class="section" id="core-3-2-2-3">
<span id="id6"></span><h5><a class="toc-backref" href="#id66">3.2.2.3.  Authorization Server Authenticates End-User</a><a class="headerlink" href="#core-3-2-2-3" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Codeフローと全く同じ</li>
</ul>
</div>
<p>When using the Implicit Flow, End-User Authentication is performed
in the same manner as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-2-3"><em>Section 3.1.2.3</em></a>.</p>
<p>(draf17)</p>
</div>
<div class="section" id="core-3-2-2-4">
<span id="id7"></span><h5><a class="toc-backref" href="#id67">3.2.2.4.  Authorization Server Obtains End-User Consent/Authorization</a><a class="headerlink" href="#core-3-2-2-4" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Codeフローと全く同じ</li>
</ul>
</div>
<p>When using the Implicit Flow,
End-User Consent is obtained in the same manner
as for the Authorization Code Flow,
as defined in <em class="xref std std-term">Section 3.1.2.4</em>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-2-2-5">
<span id="id8"></span><h5><a class="toc-backref" href="#id68">3.2.2.5.  Successful Authentication Response</a><a class="headerlink" href="#core-3-2-2-5" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>パラメータの返答の仕方はCodeフローと同じ</li>
<li>ただし、フラグメントに返す</li>
</ul>
</div>
<p>When using the Implicit Flow,
Authentication Responses are made in the same manner as
for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-2-5"><em>Section 3.1.2.5</em></a>,
with the exception of the differences specified in this section.</p>
<p>When using the Implicit Flow,
all response parameters are added
to the <em class="xref std std-term">fragment component</em> of the Redirection URI,
as specified in OAuth 2.0 Multiple Response Type Encoding Practices
[OAuth.Responses],
unless a different Response Mode was specified.</p>
<p>These parameters are returned from the Authorization Endpoint:</p>
<dl class="glossary docutils">
<dt id="term-access-token">access_token</dt>
<dd><p class="first">OAuth 2.0 Access Token.</p>
<p class="last">This is returned unless the response_type value used is <a class="reference internal" href="messages.html#term-96"><em class="xref std std-term">id_token</em></a>.</p>
</dd>
<dt id="term-token-type">token_type</dt>
<dd><p class="first">OAuth 2.0 Token Type value.
The value MUST be Bearer or another token_type value
that the Client has negotiated with the Authorization Server.</p>
<p>Clients implementing this profile MUST support
the <a class="reference internal" href="oauth_bearer.html"><em>OAuth 2.0 Bearer Token Usage</em></a> <a class="reference internal" href="#term-rfc6750"><em class="xref std std-term">[RFC6750]</em></a> specification.</p>
<p>This profile only describes the use of bearer tokens.</p>
<p class="last">This is returned in the same cases as access_token is.</p>
</dd>
<dt id="term-79">id_token</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last"><a class="reference internal" href="#id-token"><em>ID Token</em></a>.</p>
</dd>
<dt id="term-80">state</dt>
<dd><p class="first">OAuth 2.0 <a class="reference internal" href="messages.html#term-64"><em class="xref std std-term">state</em></a> value.</p>
<p>REQUIRED if the <a class="reference internal" href="messages.html#term-64"><em class="xref std std-term">state</em></a> parameter is present
in the Authorization Request.</p>
<p class="last">Clients MUST verify that the state value is equal
to the value of state parameter in the Authorization Request.</p>
</dd>
<dt id="term-expires-in">expires_in</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">Expiration time of the Access Token in seconds
since the response was generated.</p>
</dd>
</dl>
<p>Per Section <a class="reference internal" href="oauth.html#oauth-4-2-2"><em>4.2.2 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>,
no <a class="reference internal" href="#term-code"><em class="xref std std-term">code</em></a> result is returned when using the Implicit Flow.</p>
<p>The following is a non-normative example of a successful response
using the Implicit Flow
(with line wraps for the display purposes only):</p>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.org/cb#
  access_token=SlAV32hkKG
  &amp;token_type=bearer
  &amp;id_token=eyJ0 ... NiJ9.eyJ1c ... I6IjIifX0.DeWt4Qu ... ZXso
  &amp;expires_in=3600
  &amp;state=af0ifjsldkj</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-2-2-6">
<span id="id9"></span><h5><a class="toc-backref" href="#id69">3.2.2.6.  Authentication Error Response</a><a class="headerlink" href="#core-3-2-2-6" title="Permalink to this headline">¶</a></h5>
<p>When using the Implicit Flow,
Authorization Error Responses are made in the same manner
as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-2-6"><em>Section 3.1.2.6</em></a>,
with the exception of the differences specified in this section.</p>
<p>If the End-User denies the request or the End-User authentication fails,
the Authorization Server MUST return the <a class="reference internal" href="#term-error"><em class="xref std std-term">error</em></a> Authorization Response
in the <em class="xref std std-term">fragment component</em> of the Redirection URI,
as defined in <a class="reference internal" href="oauth.html#oauth-4-2-2-1"><em>4.2.2.1 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>
and OAuth 2.0 Multiple Response Type Encoding Practices <a class="reference internal" href="#term-oauth-responses"><em class="xref std std-term">[OAuth.Responses]</em></a>,
unless a different Response Mode was specified.</p>
<p>(draft17)</p>
</div>
<div class="section" id="redirect-uri-fragment-handling">
<span id="core-3-2-2-7"></span><h5><a class="toc-backref" href="#id70">3.2.2.7.  Redirect URI Fragment Handling</a><a class="headerlink" href="#redirect-uri-fragment-handling" title="Permalink to this headline">¶</a></h5>
<p>Since response parameters are returned in the Redirection URI <a class="reference internal" href="glossary.html#term-fragment"><em class="xref std std-term">fragment</em></a> value,
the Client needs to have the User Agent parse the fragment encoded values
and pass them to on to the Client&#8217;s processing logic for consumption.</p>
<p>See <a class="reference internal" href="#core-15-5-3"><em>Section 15.5.3</em></a>
for implementation notes on URI fragment handling.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-2-2-8">
<span id="id10"></span><h5><a class="toc-backref" href="#id71">3.2.2.8.  Authentication Response Validation</a><a class="headerlink" href="#core-3-2-2-8" title="Permalink to this headline">¶</a></h5>
<p>When using the Implicit Flow,
the Client MUST validate the response as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Verify that the response conforms to Section 5 of <a class="reference internal" href="#term-oauth-responses"><em class="xref std std-term">[OAuth.Responses]</em></a>.</li>
<li>Follow the validation rules in <span class="target" id="index-1"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc6749.html"><strong>RFC 6749</strong></a>,
especially those in Sections 4.2.2 and 10.12.</li>
<li>Follow the ID Token validation rules in <a class="reference internal" href="#core-3-2-2-11"><em>Section 3.2.2.11</em></a>.</li>
<li>Follow the Access Token validation rules in <a class="reference internal" href="#core-3-2-2-9"><em>Section 3.2.2.9</em></a>,
unless the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value used is <a class="reference internal" href="messages.html#term-96"><em class="xref std std-term">id_token</em></a>.</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-2-2-9">
<span id="id11"></span><h5><a class="toc-backref" href="#id72">3.2.2.9.  Access Token Validation</a><a class="headerlink" href="#core-3-2-2-9" title="Permalink to this headline">¶</a></h5>
<p>To validate an Access Token issued from the Authorization Endpoint
with an ID Token,
the Client SHOULD do the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Hash the octets of the ASCII representation of the <a class="reference internal" href="messages.html#term-access-token"><em class="xref std std-term">access_token</em></a>
with the hash algorithm specified in <a class="reference internal" href="jwa.html"><em>JWA</em></a> <a class="reference internal" href="#term-jwa"><em class="xref std std-term">[JWA]</em></a>
for the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> header parameter in the ID Token&#8217;s <a class="reference internal" href="jws.html"><em>JWS</em></a> <a class="reference internal" href="jwa.html#term-62"><em class="xref std std-term">[JWS]</em></a> header.
For instance,
if the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> is <a class="reference internal" href="glossary.html#term-rs256"><em class="xref std std-term">RS256</em></a>, the hash algorithm used is <a class="reference internal" href="glossary.html#term-sha-256"><em class="xref std std-term">SHA-256</em></a>.</li>
<li>Take the left-most half of the hash and <a class="reference internal" href="session.html#term-base64url"><em class="xref std std-term">base64url</em></a> encode it.</li>
<li>The value of <a class="reference internal" href="messages.html#term-at-hash"><em class="xref std std-term">at_hash</em></a> in the ID Token
MUST match the value produced in the previous step.</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-2-2-10">
<span id="id12"></span><h5><a class="toc-backref" href="#id73">3.2.2.10.  ID Token</a><a class="headerlink" href="#core-3-2-2-10" title="Permalink to this headline">¶</a></h5>
<p>The contents of the ID Token are as described in <a class="reference internal" href="#core-2"><em>Section 2</em></a>.
When using the Implicit Flow,
these additional requirements for the following ID Token Claims apply:</p>
<dl class="glossary docutils">
<dt id="term-82">nonce</dt>
<dd>Use of the nonce Claim is REQUIRED for this flow.</dd>
<dt id="term-83">at_hash</dt>
<dd><p class="first">Access Token hash value.</p>
<p>Its value is the base64url encoding of the left-most half
of the hash of the octets of the ASCII representation
of the <a class="reference internal" href="messages.html#term-access-token"><em class="xref std std-term">access_token</em></a> value,
where the hash algorithm used is the hash algorithm
used in the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> header parameter
of the ID Token&#8217;s <a class="reference internal" href="jws.html"><em>JWS</em></a> <a class="reference internal" href="jwa.html#term-62"><em class="xref std std-term">[JWS]</em></a> header.</p>
<p>For instance,
if the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> is <a class="reference internal" href="glossary.html#term-rs256"><em class="xref std std-term">RS256</em></a>,
hash the <a class="reference internal" href="messages.html#term-access-token"><em class="xref std std-term">access_token</em></a> value with <a class="reference internal" href="glossary.html#term-sha-256"><em class="xref std std-term">SHA-256</em></a>,
then take the left-most 128 bits
and <a class="reference internal" href="session.html#term-base64url"><em class="xref std std-term">base64url</em></a> encode them.</p>
<p>The <a class="reference internal" href="messages.html#term-at-hash"><em class="xref std std-term">at_hash</em></a> value is a case sensitive string.</p>
<p class="last">If the ID Token is issued from the Authorization Endpoint
with an <a class="reference internal" href="messages.html#term-access-token"><em class="xref std std-term">access_token</em></a> value,
which is the case for the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value <a class="reference internal" href="standard.html#term-id-token-token"><em class="xref std std-term">id_token token</em></a>,
this is REQUIRED;
it MAY NOT be used when no Access Token is issued,
which is the case for the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value <a class="reference internal" href="messages.html#term-96"><em class="xref std std-term">id_token</em></a>.</p>
</dd>
</dl>
<p>( draft17 )</p>
</div>
<div class="section" id="core-3-2-2-11">
<span id="id13"></span><h5><a class="toc-backref" href="#id74">3.2.2.11.  ID Token Validation</a><a class="headerlink" href="#core-3-2-2-11" title="Permalink to this headline">¶</a></h5>
<p>When using the Implicit Flow,
the contents of the ID Token MUST be validated in the same manner
as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-3-7"><em>Section 3.1.3.7</em></a>,
with the exception of the differences specified in this section.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The Client MUST validate the signature
of the ID Token according to <tt class="xref doc docutils literal"><span class="pre">JWS</span></tt> <a class="reference internal" href="jwa.html#term-62"><em class="xref std std-term">[JWS]</em></a>
using the algorithm specified in the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> parameter of the <tt class="xref doc docutils literal"><span class="pre">JWT</span></tt> header.</p>
</li>
<li><p class="first">The value of the <a class="reference internal" href="messages.html#term-78"><em class="xref std std-term">nonce</em></a> Claim MUST be checked
to verify that it is the same value as the one
that was sent in the Authentication Request.</p>
<p>The Client SHOULD check the nonce value for <a class="reference internal" href="glossary.html#term-replay-attacks"><em class="xref std std-term">replay attacks</em></a>.</p>
<p>The precise method for detecting <a class="reference internal" href="glossary.html#term-replay-attacks"><em class="xref std std-term">replay attacks</em></a> is Client specific.</p>
</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
</div>
</div>
<div class="section" id="authentication-using-the-hybrid-flow">
<span id="core-3-3"></span><h3><a class="toc-backref" href="#id75">3.3.  Authentication using the Hybrid Flow</a><a class="headerlink" href="#authentication-using-the-hybrid-flow" title="Permalink to this headline">¶</a></h3>
<p>This section describes how to perform authentication
using the Hybrid Flow.</p>
<p>When using the Hybrid Flow,
some tokens are returned from the Authorization Endpoint
and others are returned from the Token Endpoint.</p>
<p>The mechanisms for returning tokens in the Hybrid Flow are
specified in OAuth 2.0 Multiple Response Type Encoding Practices
[OAuth.Responses].</p>
<p>(draft17)</p>
<div class="section" id="hybrid-flow-steps">
<span id="core-3-3-1"></span><h4><a class="toc-backref" href="#id76">3.3.1.  Hybrid Flow Steps</a><a class="headerlink" href="#hybrid-flow-steps" title="Permalink to this headline">¶</a></h4>
<p>The Hybrid Flow follows the following steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Client prepares an Authentication Request
containing the desired request parameters.</li>
<li>Client sends the request to the Authorization Server.</li>
<li>Authorization Server Authenticates the End-User.</li>
<li>Authorization Server obtains End-User Consent/Authorization.</li>
<li>Authorization Server sends the End-User
back to the Client with an Authorization Code and,
depending on the Response Type, one or more additional parameters.</li>
<li>Client requests a response
using the Authorization Code at the Token Endpoint.</li>
<li>Client receives a response that contains an ID Token
and Access Token in the response body.</li>
<li>Client validates the ID Token
and retrieves the End-User&#8217;s Subject Identifier.</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2">
<span id="id14"></span><h4><a class="toc-backref" href="#id77">3.3.2.  Authorization Endpoint</a><a class="headerlink" href="#core-3-3-2" title="Permalink to this headline">¶</a></h4>
<p>When using the Hybrid Flow,
the Authorization Endpoint is used in the same manner
as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-2"><em>Section 3.1.2</em></a>,
with the exception of the differences specified in this section.</p>
<p>(draft17)</p>
<div class="section" id="core-3-3-2-1">
<span id="id15"></span><h5><a class="toc-backref" href="#id78">3.3.2.1.  Authentication Request</a><a class="headerlink" href="#core-3-3-2-1" title="Permalink to this headline">¶</a></h5>
<p>Authentication Requests are made as defined in <a class="reference internal" href="#core-3-1-2-1"><em>Section 3.1.2.1</em></a>,
except that these Authentication Request parameters are used as follows:</p>
<dl class="glossary docutils">
<dt id="term-84">response_type</dt>
<dd><p class="first">REQUIRED.</p>
<p>OAuth 2.0 Response Type value
that determines the authorization processing flow to be used,
including what parameters are returned from the endpoints used.</p>
<p>When using the Hybrid Flow,
this value is <a class="reference internal" href="standard.html#term-code-id-token"><em class="xref std std-term">code id_token</em></a>, <a class="reference internal" href="standard.html#term-code-token"><em class="xref std std-term">code token</em></a>,
or <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>.</p>
<p>The meanings of these values are defined
in OAuth 2.0 Multiple Response Type Encoding Practices [OAuth.Responses].</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><strong>code</strong> + 何か、でHybrid</li>
</ul>
</div>
</dd>
</dl>
<p>The following is a non-normative example request
using the Hybrid Flow that would be sent by the User Agent to the Authorization Server
in response to a corresponding HTTP 302 redirect response
by the Client
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>GET /authorize?
  response_type=code%20id_token
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid%20profile%20email
  &amp;nonce=n-0S6_WzA2Mj
  &amp;state=af0ifjsldkj HTTP/1.1
Host: server.example.com</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2-2">
<span id="id16"></span><h5><a class="toc-backref" href="#id79">3.3.2.2.  Authentication Request Validation</a><a class="headerlink" href="#core-3-3-2-2" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow,
the Authentication Request is validated in the same manner as for the Authorization Code Flow, as defined in <a class="reference internal" href="#core-3-1-2-2"><em>Section 3.1.2.2</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2-3">
<span id="id17"></span><h5><a class="toc-backref" href="#id80">3.3.2.3.  Authorization Server Authenticates End-User</a><a class="headerlink" href="#core-3-3-2-3" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, End-User Authentication is performed in the same manner as for the Authorization Code Flow, as defined in <a class="reference internal" href="#core-3-1-2-3"><em>Section 3.1.2.3</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2-4">
<span id="id18"></span><h5><a class="toc-backref" href="#id81">3.3.2.4.  Authorization Server Obtains End-User Consent/Authorization</a><a class="headerlink" href="#core-3-3-2-4" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, End-User Consent is obtained in the same manner as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-2-4"><em>Section 3.1.2.4</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2-5">
<span id="id19"></span><h5><a class="toc-backref" href="#id82">3.3.2.5.  Successful Authentication Response</a><a class="headerlink" href="#core-3-3-2-5" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow,
Authentication Responses are made in the same manner as for the Implicit Flow,
as defined in Section 3.2.2.5,
with the exception of the differences specified in this section.</p>
<p>These Authorization Endpoint results are used in the following manner:</p>
<dl class="glossary docutils">
<dt id="term-85">access_token</dt>
<dd><p class="first">OAuth 2.0 Access Token.</p>
<p class="last">This is returned when the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value used is <a class="reference internal" href="standard.html#term-code-token"><em class="xref std std-term">code token</em></a>,
or <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>.
(A <a class="reference internal" href="implicit.html#term-token-type"><em class="xref std std-term">token_type</em></a> value is also returned in the same cases.)</p>
</dd>
<dt id="term-86">id_token</dt>
<dd><p class="first">ID Token.</p>
<p class="last">This is returned when the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value used
is <a class="reference internal" href="standard.html#term-code-id-token"><em class="xref std std-term">code id_token</em></a> or <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>.</p>
</dd>
<dt id="term-code">code</dt>
<dd><p class="first">Authorization Code.</p>
<p class="last">This is always returned when using the Hybrid Flow.</p>
</dd>
</dl>
<p>The following is a non-normative example of a successful response using the Hybrid Flow (with line wraps for the display purposes only):</p>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.org/cb#
  code=SplxlOBeZQQYbYS6WxSbIA
  &amp;id_token=eyJ0 ... NiJ9.eyJ1c ... I6IjIifX0.DeWt4Qu ... ZXso
  &amp;state=af0ifjsldkj</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2-6">
<span id="id20"></span><h5><a class="toc-backref" href="#id83">3.3.2.6.  Authentication Error Response</a><a class="headerlink" href="#core-3-3-2-6" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow,
Authorization Error Responses are made in the same manner
as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-2-6"><em>Section 3.1.2.6</em></a>,
with the exception of the differences specified in this section.</p>
<p>If the End-User denies the request or the End-User authentication fails,
the Authorization Server MUST return the error Authorization Response
in the fragment component of the Redirection URI,
as defined in <a class="reference internal" href="oauth.html#oauth-4-2-2-1"><em>4.2.2.1 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>
and OAuth 2.0 Multiple Response Type Encoding Practices [OAuth.Responses],
unless a different Response Mode was specified.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2-7">
<span id="id21"></span><h5><a class="toc-backref" href="#id84">3.3.2.7.  Redirect URI Fragment Handling</a><a class="headerlink" href="#core-3-3-2-7" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow,
the same requirements for Redirection URI fragment parameter handling apply
as do for the Implicit Flow,
as defined in <a class="reference internal" href="#core-3-2-2-7"><em>Section 3.2.2.7</em></a>.</p>
<p>Also see <a class="reference internal" href="#core-15-5-3"><em>Section 15.5.3</em></a> for implementation notes on URI fragment handling.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2-8">
<span id="id22"></span><h5><a class="toc-backref" href="#id85">3.3.2.8.  Authentication Response Validation</a><a class="headerlink" href="#core-3-3-2-8" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, the Client MUST validate the response as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Verify that the response conforms to Section 5 of [OAuth.Responses].</li>
<li>Follow the validation rules in RFC 6749,
especially those in Sections 4.2.2 and 10.12.</li>
<li>Follow the ID Token validation rules in Section 3.3.2.12
when the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value
used is <a class="reference internal" href="standard.html#term-code-id-token"><em class="xref std std-term">code id_token</em></a> or <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>.</li>
<li>Follow the Access Token validation rules
in <a class="reference internal" href="#core-3-3-2-9"><em>Section 3.3.2.9</em></a>
when the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value
used is <a class="reference internal" href="standard.html#term-code-token"><em class="xref std std-term">code token</em></a> or <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>.</li>
<li>Follow the Authorization Code validation rules
in Section 3.3.2.10
when the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value
used is <a class="reference internal" href="standard.html#term-code-id-token"><em class="xref std std-term">code id_token</em></a>, <a class="reference internal" href="standard.html#term-code-token"><em class="xref std std-term">code token</em></a>, or <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>.</li>
</ol>
</div></blockquote>
<p>(draft 17)</p>
</div>
<div class="section" id="core-3-3-2-9">
<span id="id23"></span><h5><a class="toc-backref" href="#id86">3.3.2.9.  Access Token Validation</a><a class="headerlink" href="#core-3-3-2-9" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, Access Tokens returned
from the Authorization Endpoint are validated in the same manner
as for the Implicit Flow,
as defined in <a class="reference internal" href="#core-3-2-2-9"><em>Section 3.2.2.9</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="authorization-code-validation">
<span id="core-3-3-2-10"></span><h5><a class="toc-backref" href="#id87">3.3.2.10.  Authorization Code Validation</a><a class="headerlink" href="#authorization-code-validation" title="Permalink to this headline">¶</a></h5>
<p>To validate an Authorization Code issued
from the Authorization Endpoint with an ID Token,
the Client SHOULD do the following:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Hash the octets of the ASCII representation of the <a class="reference internal" href="#term-code"><em class="xref std std-term">code</em></a>
with the hash algorithm specified in <tt class="xref doc docutils literal"><span class="pre">JWA</span></tt> <a class="reference internal" href="#term-jwa"><em class="xref std std-term">[JWA]</em></a>
for the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> header parameter
in the ID Token&#8217;s <tt class="xref doc docutils literal"><span class="pre">JWS</span></tt> <a class="reference internal" href="jwa.html#term-62"><em class="xref std std-term">[JWS]</em></a> header.</p>
<p>For instance,
if the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> is <a class="reference internal" href="glossary.html#term-rs256"><em class="xref std std-term">RS256</em></a>,
the hash algorithm used is <a class="reference internal" href="glossary.html#term-sha-256"><em class="xref std std-term">SHA-256</em></a>.</p>
</li>
<li><p class="first">Take the left-most half of the hash
and <a class="reference internal" href="session.html#term-base64url"><em class="xref std std-term">base64url</em></a> encode it.</p>
</li>
<li><p class="first">The value of <a class="reference internal" href="messages.html#term-c-hash"><em class="xref std std-term">c_hash</em></a> in the ID Token MUST match
the value produced in the previous step if <a class="reference internal" href="messages.html#term-c-hash"><em class="xref std std-term">c_hash</em></a> is present in the <a class="reference internal" href="#id-token"><em>ID Token</em></a>.</p>
</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2-11">
<span id="id24"></span><h5><a class="toc-backref" href="#id88">3.3.2.11.  ID Token</a><a class="headerlink" href="#core-3-3-2-11" title="Permalink to this headline">¶</a></h5>
<p>The contents of the ID Token are as described in <a class="reference internal" href="#core-2"><em>Section 2</em></a>.
When using the Hybrid Flow,
these additional requirements for the following ID Token Claims apply
to an ID Token returned from the Authorization Endpoint:</p>
<dl class="glossary docutils">
<dt id="term-88">nonce</dt>
<dd>Use of the <a class="reference internal" href="messages.html#term-78"><em class="xref std std-term">nonce</em></a> Claim is REQUIRED for this flow.</dd>
<dt id="term-89">at_hash</dt>
<dd><p class="first">Access Token hash value.</p>
<p>Its value is the base64url encoding of the left-most half
of the hash of the octets of the ASCII representation
of the access_token value,
where the hash algorithm used is the hash algorithm
used in the alg header parameter of the ID Token&#8217;s JWS [JWS] header.</p>
<p>For instance,
if the alg is RS256, hash the access_token value with SHA-256,
then take the left-most 128 bits and base64url encode them.</p>
<p>The at_hash value is a case sensitive string.</p>
<p class="last">If the ID Token is issued from the Authorization Endpoint
with an <a class="reference internal" href="messages.html#term-access-token"><em class="xref std std-term">access_token</em></a> value,
which is the case for the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>, this is REQUIRED;
otherwise, its inclusion is OPTIONAL.</p>
</dd>
<dt id="term-c-hash">c_hash</dt>
<dd><p class="first">Code hash value.</p>
<p>Its value is the <a class="reference internal" href="session.html#term-base64url"><em class="xref std std-term">base64url</em></a> encoding of the left-most half
of the hash of the octets of the ASCII representation
of the <a class="reference internal" href="#term-code"><em class="xref std std-term">code</em></a> value,
where the hash algorithm used is the hash algorithm
used in the alg header parameter of the ID Token&#8217;s JWS [JWS] header.</p>
<p>For instance,
if the alg is HS512, hash the code value with SHA-512,
then take the left-most 256 bits and base64url encode them.</p>
<p>The c_hash value is a case sensitive string.</p>
<p class="last">If the ID Token is issued from the Authorization Endpoint with a <a class="reference internal" href="#term-code"><em class="xref std std-term">code</em></a>,
which is the case for the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> values <a class="reference internal" href="standard.html#term-code-id-token"><em class="xref std std-term">code id_token</em></a>
and <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>, this is REQUIRED;
otherwise, its inclusion is OPTIONAL.</p>
</dd>
</dl>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-2-12">
<span id="id25"></span><h5><a class="toc-backref" href="#id89">3.3.2.12.  ID Token Validation</a><a class="headerlink" href="#core-3-3-2-12" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, the contents of an ID Token returned from the Authorization Endpoint MUST be validated
in the same manner as for the Implicit Flow,
as defined in <a class="reference internal" href="#core-3-2-2-11"><em>Section 3.2.2.11</em></a>.</p>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="core-3-3-3">
<span id="id26"></span><h4><a class="toc-backref" href="#id90">3.3.3.  Token Endpoint</a><a class="headerlink" href="#core-3-3-3" title="Permalink to this headline">¶</a></h4>
<p>When using the Hybrid Flow,
the Token Endpoint is used in the same manner as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-3"><em>Section 3.1.3</em></a>,
with the exception of the differences specified in this section.</p>
<p>(draft17)</p>
<div class="section" id="core-3-3-3-1">
<span id="id27"></span><h5><a class="toc-backref" href="#id91">3.3.3.1.  Token Request</a><a class="headerlink" href="#core-3-3-3-1" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow,
Token Requests are made in the same manner as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-3-1"><em>Section 3.1.3.1</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-3-2">
<span id="id28"></span><h5><a class="toc-backref" href="#id92">3.3.3.2.  Token Request Validation</a><a class="headerlink" href="#core-3-3-3-2" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow,
Token Requests are validated in the same manner as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-3-2"><em>Section 3.1.3.2</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-3-3">
<span id="id29"></span><h5><a class="toc-backref" href="#id93">3.3.3.3.  Successful Token Response</a><a class="headerlink" href="#core-3-3-3-3" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, Token Responses are made in the same manner as for the Authorization Code Flow,
as defined in <em class="xref std std-ref">Section 3.1.3.3 &lt;core.3.1.3.3&gt;1</em>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-3-4">
<span id="id30"></span><h5><a class="toc-backref" href="#id94">3.3.3.4.  Token Error Response</a><a class="headerlink" href="#core-3-3-3-4" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, Token Error Responses are made in the same manner as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-3-4"><em>Section 3.1.3.4</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-3-5">
<span id="id31"></span><h5><a class="toc-backref" href="#id95">3.3.3.5.  Token Response Validation</a><a class="headerlink" href="#core-3-3-3-5" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, Token Responses are validated in the same manner as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-3-5"><em>Section 3.1.3.5</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-3-6">
<span id="id32"></span><h5><a class="toc-backref" href="#id96">3.3.3.6.  ID Token</a><a class="headerlink" href="#core-3-3-3-6" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow,
the contents of an ID Token
returned from the Token Endpoint are the same as for an ID Token
returned from the Authorization Endpoint,
as defined in <a class="reference internal" href="#core-3-3-2-11"><em>Section 3.3.2.11</em></a>,
with the exception of the differences specified in this section.</p>
<p>If an ID Token is returned from both the Authorization Endpoint and from the Token Endpoint,
which is the case for the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> values <a class="reference internal" href="standard.html#term-code-id-token"><em class="xref std std-term">code id_token</em></a>
and <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>,
the <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> and <a class="reference internal" href="messages.html#term-sub"><em class="xref std std-term">sub</em></a> Claim Values MUST be identical in both ID Tokens.</p>
<p>All Claims about the Authentication event present in either SHOULD be present in both.
If either ID Token contains Claims about the End-User,
any that are present in both SHOULD have the same values in both.</p>
<p>Note that the OP MAY choose to return fewer Claims about the End-User
from the Authorization Endpoint, for instance,
for privacy reasons.</p>
<p>The <a class="reference internal" href="messages.html#term-at-hash"><em class="xref std std-term">at_hash</em></a> and <a class="reference internal" href="messages.html#term-c-hash"><em class="xref std std-term">c_hash</em></a> Claims MAY be omitted
from the ID Token returned from the Token Endpoint
even when these Claims are present in the ID Token returned from the Authorization Endpoint,
because the ID Token and Access Token values returned from the Token Endpoint are
already cryptographically bound together by the TLS encryption performed by the Token Endpoint.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-3-7">
<span id="id33"></span><h5><a class="toc-backref" href="#id97">3.3.3.7.  ID Token Validation</a><a class="headerlink" href="#core-3-3-3-7" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, the contents of an ID Token returned from the Token Endpoint
MUST be validated in the same manner as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-3-7"><em>Section 3.1.3.7</em></a>.</p>
<p>(draft17)</p>
</div>
<div class="section" id="access-token">
<span id="core-3-3-3-8"></span><h5><a class="toc-backref" href="#id98">3.3.3.8.  Access Token</a><a class="headerlink" href="#access-token" title="Permalink to this headline">¶</a></h5>
<p>If an Access Token is returned from both the Authorization Endpoint
and from the Token Endpoint,
which is the case for the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> values <a class="reference internal" href="standard.html#term-code-token"><em class="xref std std-term">code token</em></a> and <a class="reference internal" href="standard.html#term-code-id-token-token"><em class="xref std std-term">code id_token token</em></a>,
their values MAY be the same or they MAY be different.</p>
<p>Note that different Access Tokens might be returned be
due to the different security characteristics of the two endpoints
and the lifetimes and the access to resources granted by them might also be different.</p>
<p>(draft17)</p>
</div>
<div class="section" id="core-3-3-3-9">
<span id="id34"></span><h5><a class="toc-backref" href="#id99">3.3.3.9.  Access Token Validation</a><a class="headerlink" href="#core-3-3-3-9" title="Permalink to this headline">¶</a></h5>
<p>When using the Hybrid Flow, the Access Token returned from the Token Endpoint is validated
in the same manner as for the Authorization Code Flow,
as defined in <a class="reference internal" href="#core-3-1-3-8"><em>Section 3.1.3.8</em></a>.</p>
<p>(draft 17)</p>
</div>
</div>
</div>
</div>
<div class="section" id="initiating-login-from-a-third-party">
<span id="core-4"></span><h2><a class="toc-backref" href="#id100">4.  Initiating Login from a Third Party</a><a class="headerlink" href="#initiating-login-from-a-third-party" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OP起点でOpenID Connectが始まることもある</li>
<li>場合によっては3rdパーティ起点</li>
</ul>
</div>
<p>In some cases,
the login flow is initiated by an OpenID Provider or another party,
rather than the Relying Party.</p>
<p>In this case,
the initiator redirects to the RP at its login initiation endpoint,
which requests that the RP send an Authentication Request to a specified OP.
This login initiation endpoint can be a deep link at the RP,
rather than a default landing page.</p>
<p>RPs supporting OpenID Connect Dynamic Client Registration 1.0 [OpenID.Registration]
register this endpoint value using the <a class="reference internal" href="reg.html#term-initiate-login-uri"><em class="xref std std-term">initiate_login_uri</em></a> Registration parameter.</p>
<p>The party initiating the login request does so
by redirecting to the login initiation endpoint at the RP,
passing the following parameters:</p>
<dl class="glossary docutils">
<dt id="term-91">iss</dt>
<dd><p class="first">REQUIRED.</p>
<p>Issuer Identifier for the OP that the RP is to send the Authentication Request to.</p>
<p class="last">Its value MUST be a URL using the https scheme.</p>
</dd>
<dt id="term-92">login_hint</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Hint to the Authorization Server
about the login identifier the End-User might use to log in.</p>
<p class="last">If the client receives a value for this string-valued parameter,
it MUST include it in the Authentication Request
as the <a class="reference internal" href="messages.html#term-45"><em class="xref std std-term">login_hint</em></a> parameter value.</p>
</dd>
<dt id="term-target-link-uri">target_link_uri</dt>
<dd><p class="first">OPTIONAL.</p>
<p>URL that the RP is requested to redirect to after authentication.</p>
<p class="last">RPs MUST verify the value of the <a class="reference internal" href="#term-target-link-uri"><em class="xref std std-term">target_link_uri</em></a>
to prevent being used as an open redirector to external sites.</p>
</dd>
</dl>
<p>The parameters can either be passed as <em class="xref std std-term">query</em> parameters
using the HTTP GET method or be passed as <em class="xref std std-term">HTML form</em> values
that are auto-submitted in the User Agent,
and thus are transmitted via the HTTP POST method.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Code フロー</li>
<li>CSRF 対策は？</li>
</ul>
</div>
<p>Other parameters MAY be sent, if defined by extensions.
Any parameters used that are not understood MUST be ignored by the Client.</p>
<p>Clients SHOULD employ frame busting and other techniques to prevent End-Users
from being logged in by third party sites
without their knowledge through attacks such as Clickjacking.</p>
<p>Refer to Section 4.4.1.9 of <em class="xref std std-ref">[RFC6819]</em> for more details.</p>
<p>(draft17)</p>
</div>
<div class="section" id="claims">
<span id="core-5"></span><h2><a class="toc-backref" href="#id101">5.  Claims</a><a class="headerlink" href="#claims" title="Permalink to this headline">¶</a></h2>
<p>This section specifies how the Client can obtain Claims
about the End-User and the Authentication event.
It also defines a standard set of basic profile Claims.</p>
<p>Pre-defined sets of Claims can be requested using specific <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> values
or individual Claims can be requested using the <a class="reference internal" href="messages.html#term-84"><em class="xref std std-term">claims</em></a> request parameter.</p>
<p>The Claims can come directly from the OpenID Provider
or from distributed sources as well.</p>
<p>(draft17)</p>
<div class="section" id="standard-claims">
<span id="core-5-1"></span><h3><a class="toc-backref" href="#id102">5.1.  Standard Claims</a><a class="headerlink" href="#standard-claims" title="Permalink to this headline">¶</a></h3>
<p>This specification defines a set of standard Claims.</p>
<p>They can be requested to be returned either
in the <a class="reference internal" href="#term-userinfo"><em class="xref std std-term">UserInfo</em></a> Response, per <a class="reference internal" href="#core-5-3-2"><em>Section 5.3.2</em></a>,
or in the ID Token, per <a class="reference internal" href="#core-2"><em>Section 2</em></a>.</p>
<p>(draft17)</p>
<div class="section" id="address-claim">
<span id="core-5-1-1"></span><h4><a class="toc-backref" href="#id103">5.1.1.  Address Claim</a><a class="headerlink" href="#address-claim" title="Permalink to this headline">¶</a></h4>
<p>The Address Claim represents a physical mailing address. Implementations MAY return only a subset of the fields of an address, depending upon the information available and the End-User&#8217;s privacy preferences. For example, the country and region might be returned without returning more fine-grained address information.</p>
<p>Implementations MAY return just the full address as a single string in the formatted sub-field, or they MAY return just the individual component fields using the other sub-fields, or they MAY return both. If both variants are returned, they SHOULD be describing the same address, with the formatted address indicating how the component fields are combined.</p>
<dl class="glossary docutils">
<dt id="term-formatted">formatted</dt>
<dd><p class="first">Full mailing address,
formatted for display or use on a mailing label.</p>
<p>This field MAY contain multiple lines,
separated by newlines.</p>
<p class="last">Newlines can be represented either
as a carriage return/line feed pair (&#8220;rn&#8221;)
or as a single line feed character (&#8220;n&#8221;).</p>
</dd>
<dt id="term-street-address">street_address</dt>
<dd><p class="first">Full street address component,
which MAY include house number, street name, Post Office Box,
and multi-line extended street address information.</p>
<p>This field MAY contain multiple lines,
separated by newlines.</p>
<p class="last">Newlines can be represented either
as a carriage return/line feed pair (&#8220;rn&#8221;)
or as a single line feed character (&#8220;n&#8221;).</p>
</dd>
<dt id="term-locality">locality</dt>
<dd>City or locality component.</dd>
<dt id="term-region">region</dt>
<dd>State, province, prefecture, or region component.</dd>
<dt id="term-postal-code">postal_code</dt>
<dd>Zip code or postal code component.</dd>
<dt id="term-country">country</dt>
<dd>Country name component.</dd>
</dl>
<p>(draft17)</p>
</div>
<div class="section" id="additional-claims">
<span id="core-5-1-2"></span><h4><a class="toc-backref" href="#id104">5.1.2.  Additional Claims</a><a class="headerlink" href="#additional-claims" title="Permalink to this headline">¶</a></h4>
<p>While this specification defines only a small set of Claims
as standard Claims,
other Claims MAY be used in conjunction with the standard Claims.</p>
<p>When using such Claims,
it is RECOMMENDED that collision-resistant names be used for the Claim Names,
as described in the JSON Web Token (JWT) [JWT] specification.</p>
<p>Alternatively,
Private Claim Names can be safely used
when naming conflicts are unlikely to arise,
as described in the JWT specification.</p>
<p>Or,
if specific additional Claims will have broad and general applicability,
they can be registered with Registered Claim Names, per the JWT specification.</p>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="claims-languages-and-scripts">
<span id="core-5-2"></span><h3><a class="toc-backref" href="#id105">5.2.  Claims Languages and Scripts</a><a class="headerlink" href="#claims-languages-and-scripts" title="Permalink to this headline">¶</a></h3>
<p>Human-readable Claim Values
and Claim Values that reference human-readable values
MAY be represented in multiple languages and scripts.</p>
<p>To specify the languages and scripts,
BCP47 [RFC5646] language tags are added to member names,
delimited by a # character.</p>
<p>For example,
family_name#ja-Kana-JP expresses the Family Name in Katakana in Japanese,
which is commonly used to index
and represent the phonetics of the Kanji representation
of the same represented as family_name#ja-Hani-JP.</p>
<p>As another example,
both website and website#de Claim Values might be returned,
referencing a Web site in an unspecified language and a Web site in German.</p>
<p>Since Claim Names are case sensitive,
it is strongly RECOMMENDED that language tag values used
in Claim Names be spelled using the character case with
which they are registered in the IANA Language Subtag Registry [IANA.Language].
In particular,
normally language names are spelled with lowercase characters,
region names are spelled with uppercase characters,
and scripts are spelled with mixed case characters.
However,
since BCP47 language tag values are case insensitive,
implementations SHOULD interpret the language tag values supplied in a case insensitive manner.</p>
<p>Per the recommendations in BCP47,
language tag values for Claims SHOULD only be as specific as necessary.
For instance,
using fr might be sufficient in many contexts,
rather than fr-CA or fr-FR.
Where possible,
OPs SHOULD try to match requested Claim locales with Claims it has.
For instance,
if the Client asks for a Claim with a de (German) language tag
and the OP has a value tagged with de-CH (Swiss German)
and no generic German value,
it would be appropriate for the OP to return the Swiss German value to the Client.
(This intentionally moves as much of
the complexity of language tag matching to the OP as possible, to simplify Clients.)</p>
<p>OpenID Connect defines the following Authorization Request parameter
to enable specify the preferred languages
and scripts to be used for the returned Claims:</p>
<dl class="glossary docutils">
<dt id="term-claims-locales">claims_locales</dt>
<dd><p class="first">OPTIONAL.</p>
<p>End-User&#8217;s preferred languages and scripts for Claims being returned,
represented as a space-separated list of BCP47 [RFC5646] language tag values,
ordered by preference.</p>
<p class="last">An error SHOULD NOT result if some or all
of the requested locales are not supported by the OpenID Provider.</p>
</dd>
</dl>
<p>When the OP determines, either through the claims_locales parameter,
or by other means,
that the End-User and Client are requesting Claims in only one set of languages and scripts,
it is RECOMMENDED that OPs return Claims without language tags
when they employ this language and script.</p>
<p>It is also RECOMMENDED that Clients be written in a manner
that they can handle and utilize Claims using language tags.</p>
<p>(draft17)</p>
</div>
<div class="section" id="userinfo-endpoint">
<span id="core-5-3"></span><h3><a class="toc-backref" href="#id106">5.3.  UserInfo Endpoint</a><a class="headerlink" href="#userinfo-endpoint" title="Permalink to this headline">¶</a></h3>
<p>The UserInfo Endpoint is an OAuth 2.0 Protected Resource
that returns Claims about the authenticated End-User.</p>
<p>To obtain the requested Claims about the End-User,
the Client makes a request to the UserInfo Endpoint
using an Access Token obtained through OpenID Connect Authentication.</p>
<p>These Claims are normally represented
by a JSON object that contains a collection of name
and value pairs for the Claims.</p>
<p>Communication with the UserInfo Endpoint MUST utilize TLS.
See Section 16.17 for more information on using TLS.</p>
<p>The UserInfo Endpoint MUST support the use of the HTTP GET
and HTTP POST methods defined in RFC 2616 [RFC2616].</p>
<p>The UserInfo Endpoint MUST accept Access Tokens
as <a class="reference internal" href="oauth_bearer.html"><em>OAuth 2.0 Bearer Token Usage</em></a> [RFC6750].</p>
<p>The UserInfo Endpoint SHOULD support
the use of Cross Origin Resource Sharing (<em class="xref std std-ref">CORS</em>) [CORS]
and or other methods as appropriate to enable Java Script Clients
to access the endpoint.</p>
<p>(draft17)</p>
<div class="section" id="userinfo-request">
<span id="core-5-3-1"></span><h4><a class="toc-backref" href="#id107">5.3.1.  UserInfo Request</a><a class="headerlink" href="#userinfo-request" title="Permalink to this headline">¶</a></h4>
<p>The Client sends the UserInfo Request using either HTTP GET or HTTP POST.</p>
<p>The Access Token obtained from an OpenID Connect Authentication Request
MUST be sent as a Bearer Token,
per Section 2 of OAuth 2.0 Bearer Token Usage [RFC6750].</p>
<p>It is RECOMMENDED that the request use the HTTP GET method
and the Access Token be sent using the Authorization header field.</p>
<p>The following is a non-normative example of a UserInfo Request:</p>
<div class="highlight-python"><pre>GET /userinfo HTTP/1.1
Host: server.example.com
Authorization: Bearer SlAV32hkKG</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="successful-userinfo-response">
<span id="core-5-3-2"></span><h4><a class="toc-backref" href="#id108">5.3.2.  Successful UserInfo Response</a><a class="headerlink" href="#successful-userinfo-response" title="Permalink to this headline">¶</a></h4>
<p>The UserInfo Claims MUST be returned as the members of a JSON object
unless a signed or encrypted response was requested during Client Registration.
The Claims defined in Section 5.1 can be returned,
as can additional Claims not specified there.</p>
<p>For privacy reasons,
OpenID Providers MAY elect to not return values for some requested Claims.</p>
<p>If a Claim is not returned,
that Claim Name SHOULD be omitted from the JSON object representing the Claims;
it SHOULD NOT be present with a null or empty string value.</p>
<p>The <a class="reference internal" href="messages.html#term-sub"><em class="xref std std-term">sub</em></a> (subject) Claim MUST always be returned in the UserInfo Response.</p>
<p>NOTE:</p>
<blockquote>
<div><p>Due to the possibility of token substitution attacks
(see Section 16.11),
the UserInfo Response is not guaranteed to be about the End-User identified
by the sub (subject) element of the ID Token.</p>
<p>The sub Claim in the UserInfo Response MUST be verified to exactly match
the sub Claim in the ID Token;
if they do not match,
the UserInfo Response values MUST NOT be used.</p>
</div></blockquote>
<p>Upon receipt of the UserInfo Request,
the UserInfo Endpoint MUST return the JSON Serialization of the UserInfo Response
as in Section 13.3 in the HTTP response body
unless a different format was specified during Registration [OpenID.Registration].
The UserInfo Endpoint MUST return a content-type header to indicate
which format is being returned.
The content-type of the HTTP response MUST be application/json
if the response body is a text JSON object;
the response body SHOULD be encoded using UTF-8.</p>
<p>If the UserInfo Response is signed and/or encrypted,
then the Claims are returned in a JWT
and the content-type MUST be application/jwt.</p>
<p>The response MAY be encrypted without also being signed.
If both signing and encryption are requested,
the response MUST be signed then encrypted,
with the result being a Nested JWT, as defined in [JWT].</p>
<p>If signed,
the UserInfo Response SHOULD contain the Claims <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> (issuer)
and <a class="reference internal" href="messages.html#term-aud"><em class="xref std std-term">aud</em></a> (audience) as members.
The iss value SHOULD be the OP&#8217;s Issuer Identifier URL.
The aud value SHOULD be or include the RP&#8217;s Client ID value.</p>
<p>The following is a non-normative example of a UserInfo Response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json

{
 "sub": "248289761001",
 "name": "Jane Doe",
 "given_name": "Jane",
 "family_name": "Doe",
 "preferred_username": "j.doe",
 "email": "janedoe@example.com",
 "picture": "http://example.com/janedoe/me.jpg"
}</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="userinfo-error-response">
<span id="core-5-3-3"></span><h4><a class="toc-backref" href="#id109">5.3.3.  UserInfo Error Response</a><a class="headerlink" href="#userinfo-error-response" title="Permalink to this headline">¶</a></h4>
<p>When an error condition occurs,
the UserInfo Endpoint returns an Error Response as defined
in Section 3 of OAuth 2.0 Bearer Token Usage [RFC6750].
(HTTP errors unrelated to RFC 6750 are returned to the User Agent
using the appropriate HTTP status code.)</p>
<p>The following is a non-normative example of a UserInfo Error Response:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: error="invalid_token",
  error_description="The Access Token expired"</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="userinfo-response-validation">
<span id="core-5-3-4"></span><h4><a class="toc-backref" href="#id110">5.3.4.  UserInfo Response Validation</a><a class="headerlink" href="#userinfo-response-validation" title="Permalink to this headline">¶</a></h4>
<p>The Client MUST validate the UserInfo Response as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Verify that the OP that responded was the intended OP
through a TLS server certificate check,
per RFC 6125 [RFC6125].</li>
<li>If the Client has provided
a <a class="reference internal" href="reg.html#term-userinfo-encrypted-response-alg"><em class="xref std std-term">userinfo_encrypted_response_alg</em></a> parameter during Registration,
decrypt the UserInfo Response
using the keys specified during Registration.</li>
<li>If the response was signed,
the Client SHOULD validate the signature according to JWS [JWS].</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="requesting-claims-using-scope-values">
<span id="core-5-4"></span><h3><a class="toc-backref" href="#id111">5.4.  Requesting Claims using Scope Values</a><a class="headerlink" href="#requesting-claims-using-scope-values" title="Permalink to this headline">¶</a></h3>
<p>OpenID Connect Clients use scope values,
as defined in Section 3.3 of OAuth 2.0 [RFC6749],
to specify what access privileges are being requested for Access Tokens.</p>
<p>The scopes associated with Access Tokens determine
what resources will be available
when they are used to access OAuth 2.0 protected endpoints.
Protected Resource endpoints MAY perform different actions
and return different information based on the scope values
and other parameters used when requesting the presented Access Token.</p>
<p>For OpenID Connect,
scopes can be used to request that specific sets of information be made available as Claim Values.</p>
<p>Claims requested by the following scopes
are treated by Authorization Servers as Voluntary Claims.</p>
<p>OpenID Connect defines the following scope values that are used to request Claims:</p>
<dl class="glossary docutils">
<dt id="term-profile">profile</dt>
<dd><p class="first">OPTIONAL.</p>
<p>This scope value requests access to the End-User&#8217;s default profile Claims,
which are:</p>
<blockquote class="last">
<div>name, family_name, given_name, middle_name, nickname,
preferred_username, profile, picture, website, gender,
birthdate, zoneinfo, locale, and updated_at.</div></blockquote>
</dd>
<dt id="term-email">email</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">This scope value requests access
to the <a class="reference internal" href="messages.html#term-122"><em class="xref std std-term">email</em></a> and <em class="xref std std-term">email_verified</em> Claims.</p>
</dd>
<dt id="term-address">address</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">This scope value requests access to the <a class="reference internal" href="messages.html#term-129"><em class="xref std std-term">address</em></a> Claim.</p>
</dd>
<dt id="term-phone">phone</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">This scope value requests access to the <a class="reference internal" href="messages.html#term-phone-number"><em class="xref std std-term">phone_number</em></a> and <em class="xref std std-term">phone_number_verified</em> Claims.</p>
</dd>
</dl>
<p>Multiple scope values MAY be used by creating a space delimited, case sensitive list of ASCII scope values.</p>
<p>The Claims requested by the profile, email, address,
and phone scope values are returned from the UserInfo Endpoint,
as described in Section 5.3.2,
when a response_type value is used that results in an Access Token being issued.</p>
<p>However,
when no Access Token is issued
(which is the case for the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value <a class="reference internal" href="messages.html#term-96"><em class="xref std std-term">id_token</em></a>),
the resulting Claims are returned in the ID Token.</p>
<p>In some cases,
the End-User will be given the option to have the OpenID Provider decline
to provide some or all information requested by RPs.
To minimize the amount of information that
the End-User is being asked to disclose,
an RP can elect to only request a subset of the information available
from the UserInfo Endpoint.</p>
<p>The following is a non-normative example
of an unencoded scope request:</p>
<div class="highlight-python"><pre>scope=openid profile email phone</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="requesting-claims-using-the-claims-request-parameter">
<span id="core-5-5"></span><h3><a class="toc-backref" href="#id112">5.5.  Requesting Claims using the &#8220;claims&#8221; Request Parameter</a><a class="headerlink" href="#requesting-claims-using-the-claims-request-parameter" title="Permalink to this headline">¶</a></h3>
<p>OpenID Connect defines the following Authorization Request parameter
to enable requesting individual Claims
and specifying parameters that apply to the requested Claims:</p>
<p>The claims Authentication Request parameter requests that
specific Claims be returned from the UserInfo Endpoint and/or in the ID Token.
It is represented as a JSON object containing lists
of Claims being requested from these locations.
Properties of the Claims being requested MAY also be specified.</p>
<p>Support for the claims parameter is OPTIONAL.
Should an OP not support this parameter and an RP uses it,
the OP SHOULD return a set of Claims to the RP that
it believes would be useful to the RP and the End-User
using whatever heuristics it believes are appropriate.
The <a class="reference internal" href="discovery.html#term-claims-parameter-supported"><em class="xref std std-term">claims_parameter_supported</em></a> Discovery result
indicates whether the OP supports this parameter.</p>
<p>The claims parameter value is represented in an OAuth 2.0 request
as UTF-8 encoded JSON
(which ends up being form-urlencoded when passed as an OAuth parameter).
When used in a Request Object value, per Section 6.1,
the JSON is used as the value of the claims member.</p>
<p>The top-level members of the Claims request JSON object are:</p>
<dl class="glossary docutils">
<dt id="term-userinfo">userinfo</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Requests that the listed individual Claims be returned
from the UserInfo Endpoint.</p>
<p>If present,
the listed Claims are being requested to be added to any Claims
that are being requested using scope values.</p>
<p>If not present,
the Claims being requested from the UserInfo Endpoint are
only those requested using scope values.</p>
<p class="last">When the userinfo member is used,
the request MUST also use a <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value
that results in an Access Token being issued
to the Client for use at the UserInfo Endpoint.</p>
</dd>
<dt id="term-106">id_token</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Requests that the listed individual Claims be returned
in the ID Token.</p>
<p>If present,
the listed Claims are being requested to be added
to the default Claims in the ID Token.</p>
<p class="last">If not present,
the default ID Token Claims are requested,
as per the ID Token definition in Section 2
and per the additional per-flow ID Token requirements
in Sections 3.1.3.6, 3.2.2.10, 3.3.2.11, and 3.3.3.6.</p>
</dd>
</dl>
<p>Other members MAY be present. Any members used that are not understood MUST be ignored.</p>
<p>An example Claims request is as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;userinfo&quot;</span><span class="o">:</span>
  <span class="p">{</span>
   <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
   <span class="s2">&quot;nickname&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
   <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
   <span class="s2">&quot;email_verified&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
   <span class="s2">&quot;picture&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
   <span class="s2">&quot;http://example.info/claims/groups&quot;</span><span class="o">:</span> <span class="kc">null</span>
  <span class="p">},</span>
 <span class="s2">&quot;id_token&quot;</span><span class="o">:</span>
  <span class="p">{</span>
   <span class="s2">&quot;auth_time&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
   <span class="s2">&quot;acr&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;values&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;urn:mace:incommon:iap:silver&quot;</span><span class="p">]</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that a Claim that is not in the standard set defined in Section 5.1,
the (example) <a class="reference external" href="http://example.info/claims/groups">http://example.info/claims/groups</a> Claim, is being requested.
Using the claims parameter is the only way to request Claims outside the standard set.
It is also the only way to request specific combinations
of the standard Claims that cannot be specified using scope values.</p>
<p>(draft17)</p>
<div class="section" id="individual-claims-requests">
<span id="core-5-5-1"></span><h4><a class="toc-backref" href="#id113">5.5.1.  Individual Claims Requests</a><a class="headerlink" href="#individual-claims-requests" title="Permalink to this headline">¶</a></h4>
<p>The userinfo and id_token members of the claims request
both are JSON objects with the names of the individual Claims
being requested as the member names.</p>
<p>The member values MUST be one of the following:</p>
<dl class="glossary docutils">
<dt id="term-null">null</dt>
<dd><p class="first">Indicates that this Claim is being requested
in the default manner.</p>
<p>In particular, this is a Voluntary Claim.</p>
<p>For instance, the Claim request:</p>
<div class="highlight-python"><pre>"given_name": null</pre>
</div>
<p class="last">requests the given_name Claim in the default manner.</p>
</dd>
<dt id="term-json-object">JSON Object</dt>
<dd><p class="first">Used to provide additional information
about the Claim being requested.</p>
<p>This specification defines the following members:</p>
<blockquote>
<div><dl class="docutils">
<dt>essential</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Indicates whether the Claim being requested
is an Essential Claim.</p>
<p>If the value is true,
this indicates that the Claim is an Essential Claim.</p>
<p>For instance, the Claim request:</p>
<div class="highlight-python"><pre>"auth_time": {"essential": true}</pre>
</div>
<p>can be used to specify that it is Essential
to return an auth_time Claim Value.</p>
<p>If the value is false,
it indicates that it is a Voluntary Claim.
The default is false.</p>
<p>By requesting Claims as Essential Claims,
the RP indicates to the End-User that
releasing these Claims will ensure a smooth authorization
for the specific task requested by the End-User.</p>
<p class="last">Note that even if the Claims are not available
because the End-User did not authorize their release
or they are not present,
the Authorization Server MUST NOT generate an error
when Claims are not returned,
whether they are Essential or Voluntary,
unless otherwise specified in the description
of the specific claim.</p>
</dd>
<dt>value</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Requests that the Claim be returned
with a particular value.</p>
<p>For instance the Claim request:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="s2">&quot;sub&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;248289761001&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>can be used to specify that the request apply to
the End-User with Subject Identifier 248289761001.</p>
<p>The value of the value member MUST be a valid value
for the Claim being requested.</p>
<p class="last">Definitions of individual Claims can include requirements
on how and whether the value qualifier is to be used
when requesting that Claim.</p>
</dd>
<dt>values</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Requests that the Claim be returned
with one of a set of values,
with the values appearing in order of preference.</p>
<p>For instance the Claim request:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="s2">&quot;acr&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="s2">&quot;values&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;urn:mace:incommon:iap:silver&quot;</span><span class="p">,</span>
           <span class="s2">&quot;urn:mace:incommon:iap:bronze&quot;</span><span class="p">]}</span>
</pre></div>
</div>
<p>specifies that it is Essential
that the <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a> Claim be returned with
either the value <a class="reference external" href="urn:mace:incommon:iap:silver">urn:mace:incommon:iap:silver</a>
or <a class="reference external" href="urn:mace:incommon:iap:bronze">urn:mace:incommon:iap:bronze</a>.</p>
<p>The values in the <em class="xref std std-ref">values</em> member array
MUST be valid values for the Claim being requested.</p>
<p class="last">Definitions of individual Claims can include requirements
on how and whether the values qualifier is to be used
when requesting that Claim.</p>
</dd>
</dl>
</div></blockquote>
<p>Other members MAY be defined to provide additional information
about the requested Claims.</p>
<p class="last">Any members used that are not understood MUST be ignored.</p>
</dd>
</dl>
<p>Note that when the <a class="reference internal" href="messages.html#term-84"><em class="xref std std-term">claims</em></a> request parameter is supported,
the <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> values that request Claims, as defined in <a class="reference internal" href="#core-5-4"><em>Section 5.4</em></a>,
are effectively shorthand methods for requesting sets of individual Claims.</p>
<p>For example,
using the <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> value <strong>openid email</strong> and a <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a>
that returns an Access Token is equivalent to
using the <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> value <strong>openid</strong> and the following request for individual Claims.</p>
<p>Equivalent of using the <strong>email</strong> <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> value:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;userinfo&quot;</span><span class="o">:</span>
  <span class="p">{</span>
   <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
   <span class="s2">&quot;email_verified&quot;</span><span class="o">:</span> <span class="kc">null</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft17)</p>
<div class="section" id="requesting-the-acr-claim">
<span id="core-5-5-1-1"></span><h5><a class="toc-backref" href="#id114">5.5.1.1.  Requesting the &#8220;acr&#8221; Claim</a><a class="headerlink" href="#requesting-the-acr-claim" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>RPが認証コンテキストを指定した場合</li>
<li>OPはそのうちのどれかを返す</li>
</ul>
</div>
<p>If the <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a> Claim is requested as an <a class="reference internal" href="#term-essential-claim"><em class="xref std std-term">Essential Claim</em></a>
for the <a class="reference internal" href="messages.html#term-id-token"><em class="xref std std-term">ID Token</em></a> with a <em class="xref std std-term">values</em> parameter
requesting specific <a class="reference internal" href="#term-authentication-context-class-reference"><em class="xref std std-term">Authentication Context Class Reference</em></a> values
and the implementation supports the <a class="reference internal" href="messages.html#term-84"><em class="xref std std-term">claims</em></a> parameter,
the Authorization Server MUST return an <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a> Claim Value
that matches one of the requested values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>(認証クッキーを持っていたとしても)再度認証させることもある</li>
</ul>
</div>
<p>The Authorization Server MAY ask the End-User
to re-authenticate with additional factors
to meet this requirement.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>ACRの条件で認証出来ない場合は OpenID Connectが negative終了</li>
</ul>
</div>
<p>If this is an Essential Claim and the requirement cannot be met,
then the Authorization Server MUST treat that outcome
as a failed authentication attempt.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>任意要求(Volntary)の場合</li>
</ul>
</div>
<p>Note that the RP MAY request the <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a> Claim as a Voluntary Claim
by using the <a class="reference internal" href="messages.html#term-acr-values"><em class="xref std std-term">acr_values</em></a> request parameter
or by not including <strong>&#8220;essential&#8221;: true</strong>
in an individual <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a> Claim request.</p>
<p>If the Claim is not Essential and a requested value cannot be provided,
the Authorization Server SHOULD return the session&#8217;s current <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a>
as the value of the <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a> Claim.</p>
<p>If the Claim is not Essential,
the Authorization Server is not required to provide this Claim in its response.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>acr_values と acrの両方で指定しないようにする</li>
</ul>
</div>
<p>If the client requests the <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a> Claim using
both the <a class="reference internal" href="messages.html#term-acr-values"><em class="xref std std-term">acr_values</em></a> request parameter
and an individual <a class="reference internal" href="messages.html#term-88"><em class="xref std std-term">acr</em></a> Claim request for the ID Token
listing specific requested values,
the resulting behavior is unspecified.</p>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="languages-and-scripts-for-individual-claims">
<span id="core-5-5-2"></span><h4><a class="toc-backref" href="#id115">5.5.2.  Languages and Scripts for Individual Claims</a><a class="headerlink" href="#languages-and-scripts-for-individual-claims" title="Permalink to this headline">¶</a></h4>
<p>As described in <em class="xref std std-term">Section 5.2</em>,
human-readable Claim Values and Claim Values that
reference human-readable values MAY be represented
in multiple languages and scripts.</p>
<p>Within a request for individual Claims,
requested languages and scripts for particular Claims MAY be requested
by including Claim Names that contain #-separated BCP47 [RFC5646] language tags
in the Claims request,
using the Claim Name syntax specified in Section 5.2.</p>
<p>For example,
a Family Name in Katakana in Japanese can be requested
using the Claim Name family_name#ja-Kana-JP and a Kanji representation
of the Family Name in Japanese can be requested using the Claim Name family_name#ja-Hani-JP.</p>
<p>A German-language Web site can be requested with the Claim Name website#de.</p>
<p>If an OP receives a request for human-readable Claims in a language
and script that it doesn&#8217;t have,
any versions of those Claims returned that don&#8217;t use the requested language
and script SHOULD use a language tag in the Claim Name.</p>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="claim-types">
<span id="core-5-6"></span><h3><a class="toc-backref" href="#id116">5.6.  Claim Types</a><a class="headerlink" href="#claim-types" title="Permalink to this headline">¶</a></h3>
<p>Three representations of Claim Values are defined by this specification:</p>
<dl class="glossary docutils">
<dt id="term-normal-claims">Normal Claims</dt>
<dd>Claims that are directly asserted by the OpenID Provider.</dd>
<dt id="term-aggregated-claims">Aggregated Claims</dt>
<dd>Claims that are asserted by a Claims Provider
other than the OpenID Provider
but are returned by OpenID Provider.</dd>
<dt id="term-distributed-claims">Distributed Claims</dt>
<dd>Claims that are asserted by a Claims Provider
other than the OpenID Provider
but are returned as references by the OpenID Provider.</dd>
</dl>
<p>Normal Claims MUST be supported. Support for Aggregated Claims and Distributed Claims is OPTIONAL.</p>
<p>(draft17)</p>
<div class="section" id="normal-claims">
<span id="core-5-6-1"></span><h4><a class="toc-backref" href="#id117">5.6.1.  Normal Claims</a><a class="headerlink" href="#normal-claims" title="Permalink to this headline">¶</a></h4>
<p>Normal Claims are represented as members in a JSON object.
The Claim Name is the member name and the Claim Value is the member value.</p>
<p>The following is a non-normative response containing Normal Claims:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;picture&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/janedoe/me.jpg&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="aggregated-and-distributed-claims">
<span id="core-5-6-2"></span><h4><a class="toc-backref" href="#id118">5.6.2.  Aggregated and Distributed Claims</a><a class="headerlink" href="#aggregated-and-distributed-claims" title="Permalink to this headline">¶</a></h4>
<p>Aggregated and distributed Claims are represented
by using special _claim_names and _claim_sources members
of the JSON object containing the Claims.</p>
<dl class="glossary docutils">
<dt id="term-claim-names">_claim_names</dt>
<dd><p class="first">JSON object whose member names are the Claim Names
for the Aggregated and Distributed Claims.</p>
<p class="last">The member values are references to the member names
in the <a class="reference internal" href="messages.html#term-147"><em class="xref std std-term">_claim_sources</em></a> member
from which the actual Claim Values can be retrieved.</p>
</dd>
<dt id="term-claim-sources">_claim_sources</dt>
<dd><p class="first">JSON object whose member names are referenced
by the member values of the _claim_names member.</p>
<p>The member values contain sets of Aggregated Claims
or reference locations for Distributed Claims.</p>
<p>The member values can have one of the following formats
depending on whether it is providing Aggregated or Distributed Claims:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>Aggregated Claims</dt>
<dd><p class="first">JSON object that MUST contain the JWT member
whose value is a JWT [JWT] that MUST contain all the Claims
in the _claim_names object that references
the corresponding _claim_sources member.</p>
<p>Other members MAY be present.</p>
<p>Any members used that are not understood MUST be ignored.</p>
<blockquote>
<div><dl class="docutils">
<dt>JWT</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">JWT containing Claim Values.</p>
</dd>
</dl>
</div></blockquote>
<p class="last">The JWT SHOULD NOT contain a sub (subject) Claim
unless its value is an identifier for the End-User
at the Claims Provider
(and not for the OpenID Provider or another party);
this typically means that a sub Claim SHOULD NOT be provided.</p>
</dd>
<dt>Distributed Claims</dt>
<dd><p class="first">JSON object that contains the following members and values:</p>
<blockquote>
<div><dl class="docutils">
<dt>endpoint</dt>
<dd><p class="first">REQUIRED.</p>
<p>OAuth 2.0 resource endpoint
from which the associated Claim can be retrieved.</p>
<p>The endpoint URL MUST return the Claim as a JWT.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>JWT で返す事</li>
</ul>
</div>
</dd>
<dt>access_token</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Access Token enabling retrieval of the Claims
from the endpoint URL
by using the <a class="reference internal" href="oauth_bearer.html"><em>OAuth 2.0 Bearer Token Usage</em></a>
[RFC6750] protocol.</p>
<p>Claims SHOULD be requested using the Authorization Request header field
and Claims Providers MUST support this method.</p>
<p>If the Access Token is not available,
RPs MAY need to retrieve the Access Token out of band
or use an Access Token that was pre-negotiated
between the Claims Provider and RP,
or the Claims Provider MAY reauthenticate the End-User
and/or reauthorize the RP.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">トークン</p>
<blockquote>
<div><ol class="arabic simple">
<li>UserInfoで返す</li>
<li>事前に手に入れる</li>
<li>CPに認証要求される/RPを再認可する</li>
</ol>
</div></blockquote>
</li>
</ul>
</div>
</dd>
</dl>
</div></blockquote>
<p>A <a class="reference internal" href="messages.html#term-sub"><em class="xref std std-term">sub</em></a> (subject) Claim SHOULD NOT be returned
from the Claims Provider unless its value is an identifier
for the End-User at the Claims Provider
(and not for the OpenID Provider or another party);
this typically means that a sub Claim SHOULD NOT be provided.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>CPはサブジェクトは(本人以外には)返さないこと。</li>
</ul>
</div>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>In general,
it is up to the OP when it is appropriate
to use Aggregated Claims and Distributed Claims.</p>
<p>In some cases,
information about when to use what Claim Types might be negotiated
out of band between RPs and OPs.</p>
<p>(draft17)</p>
<div class="section" id="example-of-aggregated-claims">
<span id="core-5-6-2-1"></span><h5><a class="toc-backref" href="#id119">5.6.2.1.  Example of Aggregated Claims</a><a class="headerlink" href="#example-of-aggregated-claims" title="Permalink to this headline">¶</a></h5>
<p>In this non-normative example,
Claims from Claims Provider A are combined with other Claims held by the OpenID provider,
with the Claims from Claims Provider A being returned as Aggregated Claims.</p>
<p>In this example,
these Claims about Jane Doe have been issued by Claims Provider A:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;address&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;street_address&quot;</span><span class="o">:</span> <span class="s2">&quot;1234 Hollywood Blvd.&quot;</span><span class="p">,</span>
   <span class="s2">&quot;locality&quot;</span><span class="o">:</span> <span class="s2">&quot;Los Angeles&quot;</span><span class="p">,</span>
   <span class="s2">&quot;region&quot;</span><span class="o">:</span> <span class="s2">&quot;CA&quot;</span><span class="p">,</span>
   <span class="s2">&quot;postal_code&quot;</span><span class="o">:</span> <span class="s2">&quot;90210&quot;</span><span class="p">,</span>
   <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;US&quot;</span><span class="p">},</span>
 <span class="s2">&quot;phone_number&quot;</span><span class="o">:</span> <span class="s2">&quot;+1 (310) 123-4567&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Claims Provider A signs the JSON Claims,
representing them in a signed <strong>JWT: jwt_header.jwt_part2.jwt_part3</strong>.
It is this <tt class="xref doc docutils literal"><span class="pre">JWT</span></tt> that is used by the OpenID Provider.</p>
<p>In this example,
this JWT containing Jane Doe&#8217;s Aggregated Claims from Claims Provider A
is combined with other Normal Claims,
and returned as the following set of Claims:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;birthdate&quot;</span><span class="o">:</span> <span class="s2">&quot;0000-03-22&quot;</span><span class="p">,</span>
 <span class="s2">&quot;eye_color&quot;</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;_claim_names&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;address&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;phone_number&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span>
 <span class="p">},</span>
 <span class="s2">&quot;_claim_sources&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;src1&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;JWT&quot;</span><span class="o">:</span> <span class="s2">&quot;jwt_header.jwt_part2.jwt_part3&quot;</span><span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="example-of-distributed-claims">
<span id="core-5-6-2-2"></span><h5><a class="toc-backref" href="#id120">5.6.2.2.  Example of Distributed Claims</a><a class="headerlink" href="#example-of-distributed-claims" title="Permalink to this headline">¶</a></h5>
<p>In this non-normative example,
the OpenID Provider combines Normal Claims
that it holds with references to Claims held by two different Claims Providers, B and C,
incorporating references to some of the Claims held by B and C as Distributed Claims.</p>
<p>In this example, these Claims about Jane Doe are held
by Claims Provider B (Jane Doe&#8217;s bank):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;shipping_address&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;street_address&quot;</span><span class="o">:</span> <span class="s2">&quot;1234 Hollywood Blvd.&quot;</span><span class="p">,</span>
   <span class="s2">&quot;locality&quot;</span><span class="o">:</span> <span class="s2">&quot;Los Angeles&quot;</span><span class="p">,</span>
   <span class="s2">&quot;region&quot;</span><span class="o">:</span> <span class="s2">&quot;CA&quot;</span><span class="p">,</span>
   <span class="s2">&quot;postal_code&quot;</span><span class="o">:</span> <span class="s2">&quot;90210&quot;</span><span class="p">,</span>
   <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;US&quot;</span><span class="p">},</span>
 <span class="s2">&quot;payment_info&quot;</span><span class="o">:</span> <span class="s2">&quot;Some_Card 1234 5678 9012 3456&quot;</span><span class="p">,</span>
 <span class="s2">&quot;phone_number&quot;</span><span class="o">:</span> <span class="s2">&quot;+1 (310) 123-4567&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Also in this example,
this Claim about Jane Doe is held by Claims Provider C (a credit agency):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;credit_score&quot;</span><span class="o">:</span> <span class="mi">650</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The OpenID Provider returns Jane Doe&#8217;s Claims along with references
to the Distributed Claims from Claims Provider B and Claims Provider C
by sending the Access Tokens and URLs of locations
from which the Distributed Claims can be retrieved:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;birthdate&quot;</span><span class="o">:</span> <span class="s2">&quot;0000-03-22&quot;</span><span class="p">,</span>
 <span class="s2">&quot;eye_color&quot;</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
 <span class="s2">&quot;_claim_names&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;payment_info&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;shipping_address&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;credit_score&quot;</span><span class="o">:</span> <span class="s2">&quot;src2&quot;</span>
  <span class="p">},</span>
 <span class="s2">&quot;_claim_sources&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;src1&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;endpoint&quot;</span><span class="o">:</span>
              <span class="s2">&quot;https://bank.example.com/claim_source&quot;</span><span class="p">},</span>
   <span class="s2">&quot;src2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;endpoint&quot;</span><span class="o">:</span>
              <span class="s2">&quot;https://creditagency.example.com/claims_here&quot;</span><span class="p">,</span>
            <span class="s2">&quot;access_token&quot;</span><span class="o">:</span> <span class="s2">&quot;ksj3n283dke&quot;</span><span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draf17)</p>
</div>
</div>
</div>
<div class="section" id="claim-stability-and-uniqueness">
<span id="core-5-7"></span><h3><a class="toc-backref" href="#id121">5.7.  Claim Stability and Uniqueness</a><a class="headerlink" href="#claim-stability-and-uniqueness" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>ユニーク識別子 = iss + sub</li>
<li>他はユニークで無い可能性があるのでキーとしては使わない事</li>
</ul>
</div>
<p>The <a class="reference internal" href="messages.html#term-sub"><em class="xref std std-term">sub</em></a> (subject) and <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> (issuer) Claims,
used together, are the only Claims that an RP can rely
upon as a stable identifier for the End-User,
since the sub Claim MUST be locally unique
and never reassigned within the Issuer for a particular End-User,
as described in <a class="reference internal" href="#core-2"><em>Section 2</em></a>.</p>
<p>Therefore,
the only guaranteed unique identifier
for a given End-User is the combination of the <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> Claim and the <a class="reference internal" href="messages.html#term-sub"><em class="xref std std-term">sub</em></a> Claim.</p>
<p>All other Claims carry no such guarantees across different issuers
in terms of stability over time or uniqueness across users,
and Issuers are permitted to apply local restrictions and policies.</p>
<p>For instance,
an Issuer MAY re-use an <a class="reference internal" href="messages.html#term-122"><em class="xref std std-term">email</em></a> Claim Value across different End-Users
at different points in time,
and the claimed <a class="reference internal" href="messages.html#term-122"><em class="xref std std-term">email</em></a> address for a given End-User MAY change over time.</p>
<p>Therefore,
other Claims such as <a class="reference internal" href="messages.html#term-122"><em class="xref std std-term">email</em></a>, <a class="reference internal" href="messages.html#term-phone-number"><em class="xref std std-term">phone_number</em></a>, and <em class="xref std std-term">preferred_username</em> and
MUST NOT be used as unique identifiers for the End-User.</p>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="passing-request-parameters-as-jwts">
<span id="core-6"></span><h2><a class="toc-backref" href="#id122">6.  Passing Request Parameters as JWTs</a><a class="headerlink" href="#passing-request-parameters-as-jwts" title="Permalink to this headline">¶</a></h2>
<p>OpenID Connect defines the following Authorization Request parameters
to enable Authentication Requests to be signed and optionally encrypted:</p>
<dl class="glossary docutils">
<dt id="term-request">request</dt>
<dd><p class="first">OPTIONAL.</p>
<p>This parameter enables OpenID Connect requests to be passed in a single,
self-contained parameter and to be optionally signed and/or encrypted.</p>
<p>The parameter value is a Request Object value,
as specified in <em class="xref std std-ref">Section 6.1</em>.</p>
<p class="last">It represents the request as a JWT whose Claims
are the request parameters.</p>
</dd>
<dt id="term-115">request_uri</dt>
<dd><p class="first">OPTIONAL.</p>
<p>This parameter enables OpenID Connect requests to be passed by reference,
rather than by value.</p>
<p class="last">The request_uri value is a URL using the https scheme
referencing a resource containing a <a class="reference internal" href="#term-request-object"><em class="xref std std-term">Request Object</em></a> value,
which is a JWT containing the request parameters.</p>
</dd>
</dl>
<p>Requests using these parameters are represented as JWTs,
which are respectively passed by value or by reference.</p>
<p>The ability to pass requests by reference is particularly useful
for large requests.</p>
<p>If one of these parameters is used,
the other MUST NOT be used in the same request.</p>
<p>(draft17)</p>
<div class="section" id="passing-a-request-object-by-value">
<span id="core-6-1"></span><h3><a class="toc-backref" href="#id123">6.1.  Passing a Request Object by Value</a><a class="headerlink" href="#passing-a-request-object-by-value" title="Permalink to this headline">¶</a></h3>
<p>The request Authorization Request parameter enables
OpenID Connect requests to be passed in a single, self-contained parameter
and to be optionally signed and/or encrypted.</p>
<p>It represents the request as a JWT
whose Claims are the request parameters specified in <a class="reference internal" href="#core-3-1-2"><em>Section 3.1.2</em></a>.</p>
<p>This JWT is called a Request Object.</p>
<p>Support for the request parameter is OPTIONAL.
The <a class="reference internal" href="discovery.html#term-request-parameter-supported"><em class="xref std std-term">request_parameter_supported</em></a> <a class="reference internal" href="discovery.html"><em>Discovery</em></a> result
indicates whether the OP supports this parameter.
Should an OP not support this parameter and an RP uses it,
the OP MUST return the <a class="reference internal" href="#term-request-not-supported"><em class="xref std std-term">request_not_supported</em></a> error.</p>
<p>When the request parameter is used,
the OpenID Connect request parameter values contained
in the JWT supersede those passed using the OAuth 2.0 request syntax.</p>
<p>However,
parameters MAY also be passed using the OAuth 2.0 request syntax
even when a Request Object is used;
this would typically be done to enable a cached, pre-signed
(and possibly pre-encrypted) Request Object value
to be used containing the fixed request parameters,
while parameters that can vary with each request,
such as state and nonce,
are passed as OAuth 2.0 parameters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>request_uri でパラメータを事前共有しても、 nonce, stateは必ず送る事</li>
<li>OPはRequest Objectを処理したあとでAuthReqのパラメータでオーバーライドすること(?)</li>
</ul>
</div>
<p>So that the request is a valid OAuth 2.0 Authorization Request,
values for the <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> and <a class="reference internal" href="messages.html#term-62"><em class="xref std std-term">client_id</em></a> parameters
MUST be included using the OAuth 2.0 request syntax,
since they are REQUIRED by OAuth 2.0.
The values for these parameters MUST match those in the Request Object,
if present.</p>
<p>Even if a <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> parameter is present in the Request Object value,
a <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> parameter MUST always be passed
using the OAuth 2.0 request syntax containing the <strong>openid</strong> scope value
to indicate to the underlying OAuth 2.0 logic
that this is an OpenID Connect request.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>request / request_uri があればOpenID Connectだとわかりそうな気はしますが。。。</li>
</ul>
</div>
<p>The Request Object MAY be signed or unsigned (plaintext).</p>
<p>When it is <strong>plaintext</strong>,
this is indicated by use of the <a class="reference internal" href="messages.html#term-none"><em class="xref std std-term">none</em></a> algorithm <a class="reference internal" href="#term-jwa"><em class="xref std std-term">[JWA]</em></a>
in the JWS header.</p>
<p>If <strong>signed</strong>,
the Request Object SHOULD contain the Claims
<a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> (issuer) and <a class="reference internal" href="messages.html#term-aud"><em class="xref std std-term">aud</em></a> (audience) as members.
The <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> value SHOULD be the Client ID of the RP,
unless it was signed by a different party than the RP.
The <a class="reference internal" href="messages.html#term-aud"><em class="xref std std-term">aud</em></a> value SHOULD be or include the OP&#8217;s Issuer Identifier URL.</p>
<p>The Request Object MAY also be encrypted using JWE [JWE]
and MAY be encrypted without also being signed.
If both signing and encryption are performed,
it MUST be signed then encrypted,
with the result being a Nested JWT,
as defined in [JWT].</p>
<p><a class="reference internal" href="messages.html#term-68"><em class="xref std std-term">request</em></a> and <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> parameters
MUST NOT be included in Request Objects.</p>
<p>The following is a non-normative example of the Claims
in a Request Object before base64url encoding and signing:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;iss&quot;</span><span class="o">:</span> <span class="s2">&quot;s6BhdRkqt3&quot;</span><span class="p">,</span>
 <span class="s2">&quot;aud&quot;</span><span class="o">:</span> <span class="s2">&quot;https://server.example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;response_type&quot;</span><span class="o">:</span> <span class="s2">&quot;code id_token&quot;</span><span class="p">,</span>
 <span class="s2">&quot;client_id&quot;</span><span class="o">:</span> <span class="s2">&quot;s6BhdRkqt3&quot;</span><span class="p">,</span>
 <span class="s2">&quot;redirect_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;https://client.example.org/cb&quot;</span><span class="p">,</span>
 <span class="s2">&quot;scope&quot;</span><span class="o">:</span> <span class="s2">&quot;openid&quot;</span><span class="p">,</span>
 <span class="s2">&quot;state&quot;</span><span class="o">:</span> <span class="s2">&quot;af0ifjsldkj&quot;</span><span class="p">,</span>
 <span class="s2">&quot;nonce&quot;</span><span class="o">:</span> <span class="s2">&quot;n-0S6_WzA2Mj&quot;</span><span class="p">,</span>
 <span class="s2">&quot;max_age&quot;</span><span class="o">:</span> <span class="mi">86400</span><span class="p">,</span>
 <span class="s2">&quot;claims&quot;</span><span class="o">:</span>
  <span class="p">{</span>
   <span class="s2">&quot;userinfo&quot;</span><span class="o">:</span>
    <span class="p">{</span>
     <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
     <span class="s2">&quot;nickname&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
     <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
     <span class="s2">&quot;email_verified&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
     <span class="s2">&quot;picture&quot;</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
   <span class="s2">&quot;id_token&quot;</span><span class="o">:</span>
    <span class="p">{</span>
     <span class="s2">&quot;gender&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
     <span class="s2">&quot;birthdate&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
     <span class="s2">&quot;acr&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;values&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;urn:mace:incommon:iap:silver&quot;</span><span class="p">]}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Signing it with the RS256 algorithm results in this Request Object value
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>eyJhbGciOiJSUzI1NiIsImtpZCI6ImsyYmRjIn0.ew0KICJpc3MiOiAiczZCaGRSa3
F0MyIsDQogImF1ZCI6ICJodHRwczovL3NlcnZlci5leGFtcGxlLmNvbSIsDQogInJl
c3BvbnNlX3R5cGUiOiAiY29kZSBpZF90b2tlbiIsDQogImNsaWVudF9pZCI6ICJzNk
JoZFJrcXQzIiwNCiAicmVkaXJlY3RfdXJpIjogImh0dHBzOi8vY2xpZW50LmV4YW1w
bGUub3JnL2NiIiwNCiAic2NvcGUiOiAib3BlbmlkIiwNCiAic3RhdGUiOiAiYWYwaW
Zqc2xka2oiLA0KICJub25jZSI6ICJuLTBTNl9XekEyTWoiLA0KICJtYXhfYWdlIjog
ODY0MDAsDQogImNsYWltcyI6IA0KICB7DQogICAidXNlcmluZm8iOiANCiAgICB7DQ
ogICAgICJnaXZlbl9uYW1lIjogeyJlc3NlbnRpYWwiOiB0cnVlfSwNCiAgICAgIm5p
Y2tuYW1lIjogbnVsbCwNCiAgICAgImVtYWlsIjogeyJlc3NlbnRpYWwiOiB0cnVlfS
wNCiAgICAgImVtYWlsX3ZlcmlmaWVkIjogeyJlc3NlbnRpYWwiOiB0cnVlfSwNCiAg
ICAgInBpY3R1cmUiOiBudWxsDQogICAgfSwNCiAgICJpZF90b2tlbiI6IA0KICAgIH
sNCiAgICAgImdlbmRlciI6IG51bGwsDQogICAgICJiaXJ0aGRhdGUiOiB7ImVzc2Vu
dGlhbCI6IHRydWV9LA0KICAgICAiYWNyIjogeyJ2YWx1ZXMiOiBbInVybjptYWNlOm
luY29tbW9uOmlhcDpzaWx2ZXIiXX0NCiAgICB9DQogIH0NCn0.nwwnNsk1-Zkbmnvs
F6zTHm8CHERFMGQPhos-EJcaH4Hh-sMgk8ePrGhw_trPYs8KQxsn6R9Emo_wHwajyF
KzuMXZFSZ3p6Mb8dkxtVyjoy2GIzvuJT_u7PkY2t8QU9hjBcHs68PkgjDVTrG1uRTx
0GxFbuPbj96tVuj11pTnmFCUR6IEOXKYr7iGOCRB3btfJhM0_AKQUfqKnRlrRscc8K
ol-cSLWoYE9l5QqholImzjT_cMnNIznW9E7CDyWXTsO70xnB4SkG6pXfLSjLLlxmPG
iyon_-Te111V8uE83IlzCYIb_NMXvtTIVc1jpspnTSD7xMbpL-2QgwUsAlMGzw</pre>
</div>
<p>The following RSA public key,
represented in JWK format,
can be used to validate the Request Object signature in this
and subsequent Request Object examples
(with line wraps within values for display purposes only):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;kty&quot;</span><span class="o">:</span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
 <span class="s2">&quot;kid&quot;</span><span class="o">:</span><span class="s2">&quot;k2bdc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n&quot;</span><span class="o">:</span><span class="s2">&quot;y9Lqv4fCp6Ei-u2-ZCKq83YvbFEk6JMs_pSj76eMkddWRuWX2aBKGHAtKlE5P</span>
<span class="s2">      7_vn__PCKZWePt3vGkB6ePgzAFu08NmKemwE5bQI0e6kIChtt_6KzT5OaaXDF</span>
<span class="s2">      I6qCLJmk51Cc4VYFaxgqevMncYrzaW_50mZ1yGSFIQzLYP8bijAHGVjdEFgZa</span>
<span class="s2">      ZEN9lsn_GdWLaJpHrB3ROlS50E45wxrlg9xMncVb8qDPuXZarvghLL0HzOuYR</span>
<span class="s2">      adBJVoWZowDNTpKpk2RklZ7QaBO7XDv3uR7s_sf2g-bAjSYxYUGsqkNA9b3xV</span>
<span class="s2">      W53am_UZZ3tZbFTIh557JICWKHlWj5uzeJXaw&quot;</span><span class="p">,</span>
 <span class="s2">&quot;e&quot;</span><span class="o">:</span><span class="s2">&quot;AQAB&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft17)</p>
<div class="section" id="request-using-the-request-request-parameter">
<span id="core-6-1-1"></span><h4><a class="toc-backref" href="#id124">6.1.1.  Request using the &#8220;request&#8221; Request Parameter</a><a class="headerlink" href="#request-using-the-request-request-parameter" title="Permalink to this headline">¶</a></h4>
<p>The Client sends the Authorization Request
to the Authorization Endpoint.</p>
<p>The following is a non-normative example
of an Authorization Request
using the request parameter
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>https://server.example.com/authorize?
  response_type=code%20id_token
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid
  &amp;state=af0ifjsldkj
  &amp;nonce=n-0S6_WzA2Mj
  &amp;request=eyJhbGciOiJSUzI1NiIsImtpZCI6ImsyYmRjIn0.ew0KICJpc3MiOiA
  iczZCaGRSa3F0MyIsDQogImF1ZCI6ICJodHRwczovL3NlcnZlci5leGFtcGxlLmN
  vbSIsDQogInJlc3BvbnNlX3R5cGUiOiAiY29kZSBpZF90b2tlbiIsDQogImNsaWV
  udF9pZCI6ICJzNkJoZFJrcXQzIiwNCiAicmVkaXJlY3RfdXJpIjogImh0dHBzOi8
  vY2xpZW50LmV4YW1wbGUub3JnL2NiIiwNCiAic2NvcGUiOiAib3BlbmlkIiwNCiA
  ic3RhdGUiOiAiYWYwaWZqc2xka2oiLA0KICJub25jZSI6ICJuLTBTNl9XekEyTWo
  iLA0KICJtYXhfYWdlIjogODY0MDAsDQogImNsYWltcyI6IA0KICB7DQogICAidXN
  lcmluZm8iOiANCiAgICB7DQogICAgICJnaXZlbl9uYW1lIjogeyJlc3NlbnRpYWw
  iOiB0cnVlfSwNCiAgICAgIm5pY2tuYW1lIjogbnVsbCwNCiAgICAgImVtYWlsIjo
  geyJlc3NlbnRpYWwiOiB0cnVlfSwNCiAgICAgImVtYWlsX3ZlcmlmaWVkIjogeyJ
  lc3NlbnRpYWwiOiB0cnVlfSwNCiAgICAgInBpY3R1cmUiOiBudWxsDQogICAgfSw
  NCiAgICJpZF90b2tlbiI6IA0KICAgIHsNCiAgICAgImdlbmRlciI6IG51bGwsDQo
  gICAgICJiaXJ0aGRhdGUiOiB7ImVzc2VudGlhbCI6IHRydWV9LA0KICAgICAiYWN
  yIjogeyJ2YWx1ZXMiOiBbInVybjptYWNlOmluY29tbW9uOmlhcDpzaWx2ZXIiXX0
  NCiAgICB9DQogIH0NCn0.nwwnNsk1-ZkbmnvsF6zTHm8CHERFMGQPhos-EJcaH4H
  h-sMgk8ePrGhw_trPYs8KQxsn6R9Emo_wHwajyFKzuMXZFSZ3p6Mb8dkxtVyjoy2
  GIzvuJT_u7PkY2t8QU9hjBcHs68PkgjDVTrG1uRTx0GxFbuPbj96tVuj11pTnmFC
  UR6IEOXKYr7iGOCRB3btfJhM0_AKQUfqKnRlrRscc8Kol-cSLWoYE9l5QqholImz
  jT_cMnNIznW9E7CDyWXTsO70xnB4SkG6pXfLSjLLlxmPGiyon_-Te111V8uE83Il
  zCYIb_NMXvtTIVc1jpspnTSD7xMbpL-2QgwUsAlMGzw</pre>
</div>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="passing-a-request-object-by-reference">
<span id="core-6-2"></span><h3><a class="toc-backref" href="#id125">6.2.  Passing a Request Object by Reference</a><a class="headerlink" href="#passing-a-request-object-by-reference" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> Authorization Request parameter
enables OpenID Connect requests to be passed by reference,
rather than by value.</p>
<p>This parameter is used identically to the request parameter,
other than that the Request Object value is retrieved
from the resource at the specified URL, rather than passed by value.</p>
<p>The <a class="reference internal" href="discovery.html#term-request-uri-parameter-supported"><em class="xref std std-term">request_uri_parameter_supported</em></a> <tt class="xref doc docutils literal"><span class="pre">Discovery</span></tt>
result indicates whether the OP supports this parameter.
Should an OP not support this parameter and an RP uses it,
the OP MUST return the <a class="reference internal" href="#term-request-uri-not-supported"><em class="xref std std-term">request_uri_not_supported</em></a> error.</p>
<p>When the <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> parameter is used,
the OpenID Connect request parameter values
contained in the referenced JWT supersede those passed
using the OAuth 2.0 request syntax.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Request Objectを事前キャッシュできる</li>
<li>state, nonce はOAuth2でわたす</li>
</ul>
</div>
<p>However,
parameters MAY also be passed using the OAuth 2.0 request syntax
even when a request_uri is used;
this would typically be done to enable a cached, pre-signed
(and possibly pre-encrypted) Request Object value
to be used containing the fixed request parameters,
while parameters that can vary with each request,
such as <a class="reference internal" href="messages.html#term-64"><em class="xref std std-term">state</em></a> and <a class="reference internal" href="messages.html#term-78"><em class="xref std std-term">nonce</em></a>,
are passed as OAuth 2.0 parameters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>response_type , clinet_id は必須。なぜならばOAuth2</li>
<li>Requdst Objectの中の値と一致する必要あるよ</li>
</ul>
</div>
<p>So that the <a class="reference internal" href="messages.html#term-68"><em class="xref std std-term">request</em></a> is a valid OAuth 2.0 Authorization Request,
values for the response_type and client_id parameters
MUST be included using the OAuth 2.0 request syntax,
since they are REQUIRED by OAuth 2.0.
The values for these parameters MUST match those
in the Request Object, if present.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>scope=openid も必要</li>
</ul>
</div>
<p>Even if a <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> parameter is present
in the referenced Request Object,
a <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> parameter MUST always be passed
using the OAuth 2.0 request syntax
containing the <a class="reference internal" href="messages.html#term-openid"><em class="xref std std-term">openid</em></a> scope value to indicate
to the underlying OAuth 2.0 logic
that this is an OpenID Connect request.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>uri fragmentに Request Objectのハッシュを入れとく</li>
</ul>
</div>
<p>Servers MAY cache the contents of the resources referenced by Request URIs.
If the contents of the referenced resource could ever change,
the URI SHOULD include the <a class="reference internal" href="session.html#term-base64url"><em class="xref std std-term">base64url</em></a> encoded SHA-256 hash
of the referenced resource contents as the <em class="xref std std-term">fragment component</em> of the URI.
If the fragment value used for a URI changes,
that signals the server that any cached value
for that URI with the old fragment value is no longer valid.</p>
<p>Note that Clients MAY pre-register request_uri values
using the request_uris parameter defined in Section 2.1
of the OpenID Connect Dynamic Client Registration 1.0 [OpenID.Registration] specification.
OPs can require that request_uri values used be pre-registered
with the <a class="reference internal" href="discovery.html#term-require-request-uri-registration"><em class="xref std std-term">require_request_uri_registration</em></a> discovery parameter.</p>
<p>The entire Request URI MUST NOT exceed 512 ASCII characters.</p>
<p>The contents of the resource referenced by the URL MUST be a Request Object.
The scheme used in the <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> value MUST be <strong>https</strong>,
unless the target Request Object is signed in a way that is verifiable
by the Authorization Server.</p>
<p>The <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> value MUST be reachable by the Authorization Server,
and SHOULD be reachable by the Client.</p>
<p>The following is a non-normative example of the contents of
a Request Object resource that can be referenced by a request_uri
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>eyJhbGciOiJSUzI1NiIsImtpZCI6ImsyYmRjIn0.ew0KICJpc3MiOiAiczZCaGRSa3
F0MyIsDQogImF1ZCI6ICJodHRwczovL3NlcnZlci5leGFtcGxlLmNvbSIsDQogInJl
c3BvbnNlX3R5cGUiOiAiY29kZSBpZF90b2tlbiIsDQogImNsaWVudF9pZCI6ICJzNk
JoZFJrcXQzIiwNCiAicmVkaXJlY3RfdXJpIjogImh0dHBzOi8vY2xpZW50LmV4YW1w
bGUub3JnL2NiIiwNCiAic2NvcGUiOiAib3BlbmlkIiwNCiAic3RhdGUiOiAiYWYwaW
Zqc2xka2oiLA0KICJub25jZSI6ICJuLTBTNl9XekEyTWoiLA0KICJtYXhfYWdlIjog
ODY0MDAsDQogImNsYWltcyI6IA0KICB7DQogICAidXNlcmluZm8iOiANCiAgICB7DQ
ogICAgICJnaXZlbl9uYW1lIjogeyJlc3NlbnRpYWwiOiB0cnVlfSwNCiAgICAgIm5p
Y2tuYW1lIjogbnVsbCwNCiAgICAgImVtYWlsIjogeyJlc3NlbnRpYWwiOiB0cnVlfS
wNCiAgICAgImVtYWlsX3ZlcmlmaWVkIjogeyJlc3NlbnRpYWwiOiB0cnVlfSwNCiAg
ICAgInBpY3R1cmUiOiBudWxsDQogICAgfSwNCiAgICJpZF90b2tlbiI6IA0KICAgIH
sNCiAgICAgImdlbmRlciI6IG51bGwsDQogICAgICJiaXJ0aGRhdGUiOiB7ImVzc2Vu
dGlhbCI6IHRydWV9LA0KICAgICAiYWNyIjogeyJ2YWx1ZXMiOiBbInVybjptYWNlOm
luY29tbW9uOmlhcDpzaWx2ZXIiXX0NCiAgICB9DQogIH0NCn0.nwwnNsk1-Zkbmnvs
F6zTHm8CHERFMGQPhos-EJcaH4Hh-sMgk8ePrGhw_trPYs8KQxsn6R9Emo_wHwajyF
KzuMXZFSZ3p6Mb8dkxtVyjoy2GIzvuJT_u7PkY2t8QU9hjBcHs68PkgjDVTrG1uRTx
0GxFbuPbj96tVuj11pTnmFCUR6IEOXKYr7iGOCRB3btfJhM0_AKQUfqKnRlrRscc8K
ol-cSLWoYE9l5QqholImzjT_cMnNIznW9E7CDyWXTsO70xnB4SkG6pXfLSjLLlxmPG
iyon_-Te111V8uE83IlzCYIb_NMXvtTIVc1jpspnTSD7xMbpL-2QgwUsAlMGzw</pre>
</div>
<p>(draft17)</p>
<div class="section" id="url-referencing-the-request-object">
<span id="core-6-2-1"></span><h4><a class="toc-backref" href="#id126">6.2.1.  URL Referencing the Request Object</a><a class="headerlink" href="#url-referencing-the-request-object" title="Permalink to this headline">¶</a></h4>
<p>The Client stores the Request Object resource
either locally or remotely
at a URL the Server can access.</p>
<p>This URL is the Request URI, <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a>.</p>
<p>If the Request Object includes requested values for Claims,
it MUST NOT be revealed to anybody
but the Authorization Server.</p>
<p>As such,
the request_uri MUST have appropriate entropy for its lifetime.
It is RECOMMENDED that it be removed
if it is known that it will not be used again or after a reasonable timeout
unless access control measures are taken.</p>
<p>The following is a non-normative example of a Request URI value
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>https://client.example.org/request.jwt#
  GkurKxf5T0Y-mnPFCHqWOMiZi4VS138cQ</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="request-using-the-request-uri-request-parameter">
<span id="core-6-2-2"></span><h4><a class="toc-backref" href="#id127">6.2.2.  Request using the &#8220;request_uri&#8221; Request Parameter</a><a class="headerlink" href="#request-using-the-request-uri-request-parameter" title="Permalink to this headline">¶</a></h4>
<p>The Client sends the Authorization Request
to the Authorization Endpoint.</p>
<p>The following is a non-normative example of an Authorization Request
using the request_uri parameter
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>https://server.example.com/authorize?
  response_type=code%20id_token
  &amp;client_id=s6BhdRkqt3
  &amp;request_uri=https%3A%2F%2Fclient.example.org%2Frequest.jwt
  %23GkurKxf5T0Y-mnPFCHqWOMiZi4VS138cQO_V7PZHAdM
  &amp;state=af0ifjsldkj&amp;nonce=n-0S6_WzA2Mj
  &amp;scope=openid</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="authorization-server-fetches-request-object">
<span id="core-6-2-3"></span><h4><a class="toc-backref" href="#id128">6.2.3.  Authorization Server Fetches Request Object</a><a class="headerlink" href="#authorization-server-fetches-request-object" title="Permalink to this headline">¶</a></h4>
<p>Upon receipt of the Request,
the Authorization Server MUST send an HTTP GET request
to the <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> to retrieve the referenced Request Object,
unless it is already cached,
and parse it to recreate the Authorization Request parameters.</p>
<p>Note that the RP SHOULD use a unique URI
for each request utilizing distinct parameters,
or otherwise prevent the Authorization Server from caching the <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a>.</p>
<p>The following is a non-normative example of this fetch process:</p>
<div class="highlight-python"><pre>GET /request.jwt HTTP/1.1
Host: client.example.org</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="request-uri-rationale">
<span id="core-6-2-4"></span><h4><a class="toc-backref" href="#id129">6.2.4.  &#8220;request_uri&#8221; Rationale</a><a class="headerlink" href="#request-uri-rationale" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>根本原理、理論的根拠</li>
</ul>
</div>
<p>There are several reasons that one might choose
to use the <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> parameter:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The set of request parameters can become <strong>large</strong>,
and can exceed <strong>browser URI size limitations</strong>.</p>
<p>Passing the request parameters <strong>by reference</strong> can solve this problem.</p>
</li>
<li><p class="first">Passing a <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> value,
rather than a complete request by value,
can reduce request latency.</p>
</li>
<li><p class="first">Most requests for Claims from an RP are constant.</p>
<p>The <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> is a way of creating
and sometimes also signing and encrypting a constant set of request parameters
in advance.</p>
<p>(The request_uri value becomes an &#8220;artifact&#8221;
representing a particular fixed set of request parameters.)</p>
</li>
<li><p class="first">Pre-registering a fixed set of request parameters at Registration time
enables OPs to cache and pre-validate the request parameters
at Registration time,
meaning they need not be retrieved at request time.</p>
</li>
<li><p class="first">Pre-registering a fixed set of request parameters at Registration time
enables OPs to vet the contents of the request
from consumer protection and other points of views,
either itself or by utilizing a third party.</p>
</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="validating-jwt-based-requests">
<span id="core-6-3"></span><h3><a class="toc-backref" href="#id130">6.3.  Validating JWT-Based Requests</a><a class="headerlink" href="#validating-jwt-based-requests" title="Permalink to this headline">¶</a></h3>
<p>When the request or request_uri Authorization Request parameters are used,
additional steps must be performed to validate the Authentication Request
beyond those specified in Sections 3.1.2.2, 3.2.2.2, or 3.3.2.2.</p>
<p>These steps are to validate the JWT containing the Request Object
and to validate the Request Object itself.</p>
<p>(draf17)</p>
<div class="section" id="encrypted-request-object">
<span id="core-6-3-1"></span><h4><a class="toc-backref" href="#id131">6.3.1.  Encrypted Request Object</a><a class="headerlink" href="#encrypted-request-object" title="Permalink to this headline">¶</a></h4>
<p>If the Authorization Server has advertised JWE encryption algorithms
in the <a class="reference internal" href="discovery.html#term-request-object-encryption-alg-values-supported"><em class="xref std std-term">request_object_encryption_alg_values_supported</em></a> and
<a class="reference internal" href="discovery.html#term-request-object-encryption-enc-values-supported"><em class="xref std std-term">request_object_encryption_enc_values_supported</em></a> elements
of its <tt class="xref doc docutils literal"><span class="pre">Discovery</span></tt> document [OpenID.Discovery],
or has supplied encryption algorithms by other means,
these are used by the Client to encrypt the JWT.</p>
<p>The Authorization Server MUST decrypt the JWT
in accordance with the JSON Web Encryption [JWE] specification.
The result MAY be either a signed or unsigned (plaintext) Request Object.
In the former case,
signature validation MUST be performed as defined in Section 6.3.2.</p>
<p>The Authorization Server MUST return an error if decryption fails.</p>
<p>(draf17)</p>
</div>
<div class="section" id="signed-request-object">
<span id="core-6-3-2"></span><h4><a class="toc-backref" href="#id132">6.3.2.  Signed Request Object</a><a class="headerlink" href="#signed-request-object" title="Permalink to this headline">¶</a></h4>
<p>To perform Signature Validation,
the alg parameter in the JWS header MUST match the value of
the <a class="reference internal" href="reg.html#term-request-object-signing-alg"><em class="xref std std-term">request_object_signing_alg</em></a> set during Client Registration [OpenID.Registration]
or a value that was pre-registered by other means.</p>
<p>The signature MUST be validated against the appropriate key for that <a class="reference internal" href="messages.html#term-62"><em class="xref std std-term">client_id</em></a> and algorithm.</p>
<p>The Authorization Server MUST return an error if signature validation fails.</p>
<p>(draf17)</p>
</div>
<div class="section" id="request-parameter-assembly-and-validation">
<span id="core-6-3-3"></span><h4><a class="toc-backref" href="#id133">6.3.3.  Request Parameter Assembly and Validation</a><a class="headerlink" href="#request-parameter-assembly-and-validation" title="Permalink to this headline">¶</a></h4>
<p>The Authorization Server MUST assemble
the set of Authorization Request parameters
to be used from the Request Object value
and the OAuth 2.0 Authorization Request parameters
(minus the <a class="reference internal" href="messages.html#term-68"><em class="xref std std-term">request</em></a> or <a class="reference internal" href="messages.html#term-69"><em class="xref std std-term">request_uri</em></a> parameters).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Requset Object と AuthReqパラメータに両方存在したら、
Request Objectが優先</li>
</ul>
</div>
<p>If the same parameter exists both in the Request Object
and the OAuth Authorization Request parameters,
the parameter in the Request Object is used.</p>
<p>Using the assembled set of Authorization Request parameters,
the Authorization Server then validates the request
the normal manner for the flow being used,
as specified in Sections 3.1.2.2, 3.2.2.2, or 3.3.2.2.</p>
<p>(draft17)</p>
</div>
</div>
</div>
<div class="section" id="self-issued-openid-provider">
<span id="core-7"></span><h2><a class="toc-backref" href="#id134">7.  Self-Issued OpenID Provider</a><a class="headerlink" href="#self-issued-openid-provider" title="Permalink to this headline">¶</a></h2>
<p>OpenID Connect supports Self-Issued OpenID Providers -
personal, self-hosted OPs that issue self-signed ID Tokens.
Self-Issued OPs use the special Issuer Identifier
<a class="reference external" href="https://self-issued.me">https://self-issued.me</a>.</p>
<p>The messages used to communicate with Self-Issued OPs
are mostly the same as those used to communicate with other OPs.
Specifications for the few additional parameters used
and for the values of some parameters
in the Self-Issued case are defined in this section.</p>
<p>(draft17)</p>
<div class="section" id="self-issued-openid-provider-discovery">
<span id="core-7-1"></span><h3><a class="toc-backref" href="#id135">7.1.  Self-Issued OpenID Provider Discovery</a><a class="headerlink" href="#self-issued-openid-provider-discovery" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>RPはディスカバリしない</li>
<li>固定の OP Meta Infoを使います</li>
</ul>
</div>
<p>If the input identifier for the discovery process
contains the domain self-issued.me,
dynamic discovery is not performed.</p>
<p>Instead, then the following static configuration values are used:</p>
<dl class="docutils">
<dt>NOTE:</dt>
<dd><p class="first">The OpenID Foundation plans to host
the OpenID Provider site <a class="reference external" href="https://self-issued.me/">https://self-issued.me/</a>,
including its WebFinger service,
so that performing discovery on it returns
the above static discovery information,
enabling RPs to not need any special processing
for discovery of the Self-Issued OP.</p>
<p class="last">This site will be hosted on an experimental basis.
Production implementations should not take a dependency upon it
without a subsequent commitment by the OpenID Foundation
to host the site in a manner intended for production use.</p>
</dd>
</dl>
<p>(draf17)</p>
</div>
<div class="section" id="self-issued-openid-provider-registration">
<span id="core-7-2"></span><h3><a class="toc-backref" href="#id136">7.2.  Self-Issued OpenID Provider Registration</a><a class="headerlink" href="#self-issued-openid-provider-registration" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>RPのレジストレーション</li>
</ul>
</div>
<p>When using a Self-Issued OP,
registration is not required.
The Client can proceed without registration as if it had registered with the OP and obtained the following Client Registration Response:</p>
<dl class="docutils">
<dt>NOTE:</dt>
<dd><p class="first">The OpenID Foundation plans to host the (stateless) endpoint
<a class="reference external" href="https://self-issued.me/registration/1.0/">https://self-issued.me/registration/1.0/</a> that
returns the response above,
enabling RPs to not need any special processing
for registration with the Self-Issued OP.</p>
<p class="last">This site will be hosted on an experimental basis.
Production implementations should not take a dependency upon it
without a subsequent commitment
by the OpenID Foundation to host the site
in a manner intended for production use.</p>
</dd>
</dl>
<p>(draft17)</p>
<div class="section" id="providing-information-with-the-registration-request-parameter">
<span id="core-7-2-1"></span><h4><a class="toc-backref" href="#id137">7.2.1.  Providing Information with the &#8220;registration&#8221; Request Parameter</a><a class="headerlink" href="#providing-information-with-the-registration-request-parameter" title="Permalink to this headline">¶</a></h4>
<p>OpenID Connect defines the following Authorization Request parameter
to enable Clients to provide additional registration information
to Self-Issued OpenID Providers:</p>
<dl class="glossary docutils">
<dt id="term-registration">registration</dt>
<dd><p class="first">OPTIONAL.</p>
<p>This parameter is used by the Client to provide information
about itself to a Self-Issued OP that
would normally be provided to an OP during Dynamic Client Registration.</p>
<p>The value is a JSON object containing Client metadata values,
as defined in Section 2.1 of the OpenID Connect Dynamic Client Registration 1.0
[OpenID.Registration] specification.</p>
<p class="last">The registration parameter SHOULD NOT be used
when the OP is not a Self-Issued OP.</p>
</dd>
</dl>
<p>None of this information is REQUIRED by Self-Issued OPs,
so the use of this parameter is OPTIONAL.</p>
<p>The registration parameter value is represented in an OAuth 2.0 request
as a UTF-8 encoded JSON object
(which ends up being form-urlencoded when passed as an OAuth parameter).
When used in a Request Object value, per Section 6.1,
the JSON object is used as the value of the registration member.</p>
<p>The Registration parameters that would typically be used in requests
to Self-Issued OPs are policy_uri, tos_uri, and logo_uri.
If the Client uses more than one Redirection URI,
the redirect_uris parameter would be used to register them.</p>
<p>Finally,
if the Client is requesting encrypted responses,
it would typically use the jwks_uri,
id_token_encrypted_response_alg and
id_token_encrypted_response_enc parameters.</p>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="self-issued-openid-provider-request">
<span id="core-7-3"></span><h3><a class="toc-backref" href="#id138">7.3.  Self-Issued OpenID Provider Request</a><a class="headerlink" href="#self-issued-openid-provider-request" title="Permalink to this headline">¶</a></h3>
<p>The Client sends the Authentication Request to the Authorization Endpoint
with the following parameters:</p>
<dl class="glossary docutils">
<dt id="term-117">scope</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">scope parameter value,
as specified in Section 3.1.2.</p>
</dd>
<dt id="term-118">response_type</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">Constant string value id_token.</p>
</dd>
<dt id="term-119">client_id</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">Client ID value for the Client,
which in this case contains the redirect_uri value of the Client.
Since the Client&#8217;s redirect_uri URI value is communicated as the Client ID,
a redirect_uri parameter is NOT REQUIRED to also be included in the request.</p>
</dd>
<dt id="term-120">id_token_hint</dt>
<dd><p class="first">OPTIONAL.</p>
<p>id_token_hint parameter value,
as specified in Section 3.1.2.</p>
<p>If the ID Token is encrypted to the Self-Issued OP,
the sub (subject) of the signed ID Token MUST be sent
as the kid (Key ID) of the JWE.</p>
<p class="last">Encrypting content to Self-Issued OPs is currently only supported
when the OP&#8217;s JWK key type is RSA
and the encryption algorithm used is RSA1_5.</p>
</dd>
<dt id="term-claims">claims</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">claims parameter value,
as specified in Section 5.5.</p>
</dd>
<dt id="term-122">registration</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">This parameter is used by the Client to provide information
about itself to a Self-Issued OP that would normally be provided
to an OP during Dynamic Client Registration,
as specified in Section 7.2.1.</p>
</dd>
<dt id="term-123">request</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Request Object value, as specified in Section 6.1.
The Request Object MAY be encrypted to the Self-Issued OP by the Client.</p>
<p>In this case,
the sub (subject) of a previously issued ID Token
for this Client MUST be sent as the kid (Key ID) of the JWE.</p>
<p class="last">Encrypting content to Self-Issued OPs is currently only supported
when the OP&#8217;s JWK key type is RSA and the encryption algorithm used is RSA1_5.</p>
</dd>
</dl>
<p>Other parameters MAY be sent.
Note that all Claims are returned in the ID Token.</p>
<p>The entire URL MUST NOT exceed 2048 ASCII characters.</p>
<p>The following is a non-normative example HTTP 302 redirect response by the Client,
which triggers the User Agent to make an Authentication Request
to the Self-Issued OpenID Provider (with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: openid://?
  response_type=id_token
  &amp;client_id=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid%20profile
  &amp;state=af0ifjsldkj
  &amp;nonce=n-0S6_WzA2Mj
  &amp;registration=%7B%22logo_uri%22%3A%22https%3A%2F%2F
    client.example.org%2Flogo.png%22%7D</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="self-issued-openid-provider-response">
<span id="core-7-4"></span><h3><a class="toc-backref" href="#id139">7.4.  Self-Issued OpenID Provider Response</a><a class="headerlink" href="#self-issued-openid-provider-response" title="Permalink to this headline">¶</a></h3>
<p>OpenID Connect defines the following Claim for use in Self-Issued OpenID Provider Responses:</p>
<dl class="glossary docutils">
<dt id="term-sub-jwk">sub_jwk</dt>
<dd><p class="first">REQUIRED.</p>
<p>Public key used to check the signature of an ID Token
issued by a Self-Issued OpenID Provider,
as specified in Section 7.</p>
<p class="last">The key is a bare key in JWK [JWK] format
(not an X.509 certificate value).</p>
</dd>
</dl>
<p>The sub_jwk value is a JSON object.
Use of the <a class="reference internal" href="messages.html#term-sub-jwk"><em class="xref std std-term">sub_jwk</em></a> Claim is NOT RECOMMENDED
when the OP is not Self-Issued.</p>
<p>The Self-Issued OpenID Provider response is the same
as the normal <a class="reference internal" href="#term-implicit-flow"><em class="xref std std-term">Implicit Flow</em></a> response
with the following refinements.
Since it is an Implicit Flow response,
the response parameters will be returned in the URL fragment component,
unless a different Response Mode was specified.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> (issuer) Claim Value is <a class="reference external" href="https://self-issued.me">https://self-issued.me</a>.</p>
</li>
<li><p class="first">A <a class="reference internal" href="messages.html#term-sub-jwk"><em class="xref std std-term">sub_jwk</em></a> Claim is present,
with its value being the public key used
to check the signature of the ID Token.</p>
</li>
<li><p class="first">The sub (subject) Claim value is the base64url encoded SHA-256 hash
of the concatenation of the octets of the UTF-8 representations
of the base64url encoded key values in the sub_jwk Claim.</p>
<p>When the <em class="xref std std-term">kty</em> value is RSA,
the key values n and e are concatenated in that order.</p>
<p>When the kty value is EC,
the key values crv, x, and y are concatenated in that order.</p>
</li>
<li><p class="first">No Access Token is returned for accessing a UserInfo Endpoint,
so all Claims returned MUST be in the ID Token.</p>
</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
<div class="section" id="self-issued-id-token-validation">
<span id="core-7-5"></span><h3><a class="toc-backref" href="#id140">7.5.  Self-Issued ID Token Validation</a><a class="headerlink" href="#self-issued-id-token-validation" title="Permalink to this headline">¶</a></h3>
<p>To validate the ID Token received,
the Client MUST do the following:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The Client MUST validate that
the value of the <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> (issuer) Claim is <a class="reference external" href="https://self-isued.me">https://self-isued.me</a>.</p>
<p>If <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> contains a different value,
the ID Token is not Self-Issued,
and instead it MUST be validated according to Section 3.1.3.7.</p>
</li>
<li><p class="first">The Client MUST validate that
the <a class="reference internal" href="messages.html#term-aud"><em class="xref std std-term">aud</em></a> (audience) Claim contains the value of the <a class="reference internal" href="messages.html#term-63"><em class="xref std std-term">redirect_uri</em></a>
that the Client sent in the Authentication Request as an audience.</p>
</li>
<li><p class="first">The Client MUST validate the signature of the ID Token according
to JWS [JWS] using the algorithm specified
in the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> parameter of the JWT header [JWT],
using the key in the sub_jwk Claim;
the key is a bare key in JWK format
(not an X.509 certificate value).</p>
</li>
<li><p class="first">The alg value SHOULD be the default of RS256.
It MAY also be ES256.</p>
</li>
</ol>
<ol class="arabic" start="6">
<li><p class="first">The Client MUST validate that the sub (subject) Claim value
is the base64url encoded SHA-256 hash of the concatenation
of the octets of the UTF-8 representations of the base64url encoded key values
in the <a class="reference internal" href="messages.html#term-sub-jwk"><em class="xref std std-term">sub_jwk</em></a> Claim.</p>
<p>When the <em class="xref std std-term">kty</em> value is RSA,
the key values n and e are concatenated in that order.</p>
<p>When the kty value is EC, the key values crv, x, and y are concatenated in that order.</p>
</li>
<li><p class="first">The current time MUST be before the time represented by the exp Claim
(possibly allowing for some small leeway to account for clock skew).</p>
</li>
<li><p class="first">The iat Claim can be used to reject tokens that were issued
too far away from the current time,
limiting the amount of time that nonces need to be stored to prevent attacks.</p>
<p>The acceptable range is Client specific.</p>
</li>
<li><p class="first">If a nonce value was sent in the Authentication Request,
a nonce Claim MUST be present and its value of the checked to verify
that it is the same value as the one that was sent in the Authentication Request.</p>
<p>The Client SHOULD check the nonce value for replay attacks.</p>
<p>The precise method for detecting replay attacks is Client specific.</p>
</li>
</ol>
</div></blockquote>
<p>The following is a non-normative example of a base64url decoded Self-Issued ID Token
(with line wraps within values for display purposes only):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;iss&quot;</span><span class="o">:</span> <span class="s2">&quot;https://self-issued.me&quot;</span><span class="p">,</span>
 <span class="s2">&quot;sub&quot;</span><span class="o">:</span> <span class="s2">&quot;wBy8QvHbPzUnL0x63h13QqvUYcOur1X0cbQpPVRqX5k&quot;</span><span class="p">,</span>
 <span class="s2">&quot;aud&quot;</span><span class="o">:</span> <span class="s2">&quot;https://client.example.org/cb&quot;</span><span class="p">,</span>
 <span class="s2">&quot;nonce&quot;</span><span class="o">:</span> <span class="s2">&quot;n-0S6_WzA2Mj&quot;</span><span class="p">,</span>
 <span class="s2">&quot;exp&quot;</span><span class="o">:</span> <span class="mi">1311281970</span><span class="p">,</span>
 <span class="s2">&quot;iat&quot;</span><span class="o">:</span> <span class="mi">1311280970</span><span class="p">,</span>
 <span class="s2">&quot;sub_jwk&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;kty&quot;</span><span class="o">:</span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
   <span class="s2">&quot;n&quot;</span><span class="o">:</span> <span class="s2">&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx</span>
<span class="s2">   4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRXjBZCiFV4n3oknjhMs</span>
<span class="s2">   tn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2</span>
<span class="s2">   QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6qMQvRL5hajrn1n91CbOpbI</span>
<span class="s2">   SD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqb</span>
<span class="s2">   w0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw&quot;</span><span class="p">,</span>
   <span class="s2">&quot;e&quot;</span><span class="o">:</span><span class="s2">&quot;AQAB&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="subject-identifier-types">
<span id="core-8"></span><h2><a class="toc-backref" href="#id141">8.  Subject Identifier Types</a><a class="headerlink" href="#subject-identifier-types" title="Permalink to this headline">¶</a></h2>
<p>A Subject Identifier is a locally unique and never reassigned identifier
within the Issuer for the End-User,
which is intended to be consumed by the Client.</p>
<p>Two Subject Identifier types are defined by this specification:</p>
<dl class="glossary docutils">
<dt id="term-public">public</dt>
<dd><p class="first">This provides the same sub (subject) value to all Clients.</p>
<p class="last">It is the default if the provider
has no subject_types_supported element in its discovery document.</p>
</dd>
<dt id="term-pairwise">pairwise</dt>
<dd>This provides a different sub value to each Client,
so as not to enable Clients
to correlate the End-User&#8217;s activities without permission.</dd>
</dl>
<p>The OpenID Provider&#8217;s <tt class="xref doc docutils literal"><span class="pre">Discovery</span></tt> document SHOULD list
its supported Subject Identifier types
in the <a class="reference internal" href="discovery.html#term-subject-types-supported"><em class="xref std std-term">subject_types_supported</em></a> element.</p>
<p>If there is more than one type listed in the array,
the Client MAY elect to provide its preferred identifier type
using the <a class="reference internal" href="reg.html#term-subject-type"><em class="xref std std-term">subject_type</em></a> parameter during <a class="reference internal" href="reg.html"><em>Registration</em></a>.</p>
<p>(draft17)</p>
<div class="section" id="pairwise-identifier-algorithm">
<span id="core-8-1"></span><h3><a class="toc-backref" href="#id142">8.1.  Pairwise Identifier Algorithm</a><a class="headerlink" href="#pairwise-identifier-algorithm" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">ユニーク文字列を作る</p>
<blockquote>
<div><ul class="simple">
<li>selector id + local acount id + salt</li>
<li>GUID</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">さらにハッシュとか暗号化とかする</p>
</li>
</ul>
</div>
<p>When pairwise Subject Identifiers are used, the OpenID Provider MUST calculate a unique sub (subject) value for each Sector Identifier. The Subject Identifier value MUST NOT be reversible by any party other than the OpenID Provider.</p>
<p>Providers that use pairwise sub values and support Dynamic Client Registration [OpenID.Registration] SHOULD use the sector_identifier_uri parameter. It provides a way for a group of websites under common administrative control to have consistent pairwise sub values independent of the individual domain names. It also provides a way for Clients to change redirect_uri domains without having to reregister all of their users.</p>
<p>If the Client has not provided a value for sector_identifier_uri in Dynamic Client Registration [OpenID.Registration], the Sector Identifier used for pairwise identifier calculation is the host component of the registered redirect_uri. If there are multiple hostnames in the registered redirect_uris, the Client MUST register a sector_identifier_uri.</p>
<p>When a sector_identifier_uri is provided, the host component of that URL is used as the Sector Identifier for the pairwise identifier calculation. The value of the sector_identifier_uri MUST be a URL using the https scheme that points to a JSON file containing an array of redirect_uri values. The values of the registered redirect_uris MUST be included in the elements of the array.</p>
<p>Any algorithm with the following properties can be used by OpenID Providers to calculate pairwise Subject Identifiers:</p>
<blockquote>
<div><ul class="simple">
<li>The Subject Identifier value MUST NOT be reversible
by any party other than the OpenID Provider.</li>
<li>Distinct Sector Identifier values MUST result
in distinct Subject Identifier values.</li>
<li>The algorithm MUST be deterministic. ( 計算で一意に決まる )</li>
</ul>
</div></blockquote>
<p>Three example methods are:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The Sector Identifier can be concatenated with a local account ID
and a <strong>salt</strong> value that is kept secret by the Provider.</p>
<p>The concatenated string is then <strong>hashed</strong> using an appropriate algorithm.</p>
<div class="highlight-python"><pre>Calculate sub = SHA-256 ( sector_identifier || local_account_id || salt ).</pre>
</div>
</li>
<li><p class="first">The Sector Identifier can be concatenated with a local account ID
and a <strong>salt</strong> value that is kept secret by the Provider.</p>
<p>The concatenated string is then <strong>encrypted</strong> using an appropriate algorithm.</p>
<div class="highlight-python"><pre>Calculate sub = AES-128 ( sector_identifier || local_account_id || salt ).</pre>
</div>
</li>
<li><p class="first">The Issuer creates a Globally Unique Identifier (GUID)
for the pair of Sector Identifier and local account ID
and stores this value.</p>
</li>
</ol>
</div></blockquote>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="client-authentication">
<span id="core-9"></span><h2><a class="toc-backref" href="#id143">9.  Client Authentication</a><a class="headerlink" href="#client-authentication" title="Permalink to this headline">¶</a></h2>
<p>This section defines a set of Client Authentication methods that are used by Clients to authenticate to the Authorization Server when using the Token Endpoint. During Client Registration, the RP (Client) MAY register a Client Authentication method. If no method is registered, the default method is client_secret_basic.</p>
<p>These Client Authentication methods are:</p>
<dl class="glossary docutils">
<dt id="term-client-secret-basic">client_secret_basic</dt>
<dd>Clients that have received a <a class="reference internal" href="oauth.html#term-client-secret"><em class="xref std std-term">client_secret</em></a> value
from the Authorization Server authenticate with the Authorization Server
in accordance with <a class="reference internal" href="oauth.html#oauth-3-2-1"><em>Section 3.2.1 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>
using the HTTP <em class="xref std std-term">Basic authentication</em> scheme.</dd>
<dt id="term-client-secret-post">client_secret_post</dt>
<dd>Clients that have received a <a class="reference internal" href="oauth.html#term-client-secret"><em class="xref std std-term">client_secret</em></a> value from the Authorization Server,
authenticate with the Authorization Server
in accordance with Section <a class="reference internal" href="oauth.html#oauth-3-2-1"><em>3.2.1 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>
by including the <a class="reference internal" href="glossary.html#term-client-credentials"><em class="xref std std-term">Client Credentials</em></a> in the <em class="xref std std-term">request body</em>.</dd>
<dt id="term-client-secret-jwt">client_secret_jwt</dt>
<dd><p class="first">Clients that have received a <a class="reference internal" href="oauth.html#term-client-secret"><em class="xref std std-term">client_secret</em></a> value
from the Authorization Server create a JWT
using an HMAC SHA algorithm, such as HMAC SHA-256.</p>
<p>The HMAC (Hash-based Message Authentication Code) is calculated
using the octets of the UTF-8 representation of
the client_secret as the shared key.</p>
<p>The Client authenticates in accordance with JSON Web Token (JWT) Profile
for OAuth 2.0 Client Authentication and Authorization Grants [OAuth.JWT]
and Assertion Framework for OAuth 2.0 Client Authentication
and Authorization Grants [OAuth.Assertions].</p>
<p>The JWT MUST contain the following REQUIRED Claim Values
and MAY contain the following OPTIONAL Claim Values:</p>
<blockquote>
<div><dl class="docutils">
<dt>iss</dt>
<dd><p class="first">REQUIRED.</p>
<p>Issuer.</p>
<p class="last">This MUST contain the <a class="reference internal" href="messages.html#term-62"><em class="xref std std-term">client_id</em></a> of the OAuth Client.</p>
</dd>
<dt>sub</dt>
<dd><p class="first">REQUIRED. Subject.</p>
<p class="last">This MUST contain the <a class="reference internal" href="messages.html#term-62"><em class="xref std std-term">client_id</em></a> of the OAuth Client.</p>
</dd>
<dt>aud</dt>
<dd><p class="first">REQUIRED. Audience.</p>
<p>The aud (audience) Claim.
Value that identifies the Authorization Server as an intended audience.</p>
<p>The Authorization Server MUST verify that it is an intended audience
for the token.</p>
<p class="last">The Audience SHOULD be the URL of
the Authorization Server&#8217;s <em class="xref std std-term">Token Endpoint</em>.</p>
</dd>
<dt>jti</dt>
<dd><p class="first">REQUIRED.</p>
<p>JWT ID.</p>
<p>A unique identifier for the token,
which can be used to prevent reuse of the token.</p>
<p class="last">These tokens MUST only be used once,
unless conditions for reuse were negotiated between the parties;
any such negotiation is beyond the scope of this specification.</p>
</dd>
<dt>exp</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">Expiration time on or after
which the ID Token MUST NOT be accepted for processing.</p>
</dd>
<dt>iat</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">Time at which the JWT was issued.</p>
</dd>
</dl>
</div></blockquote>
<p>The JWT MAY contain other Claims.</p>
<p>Any Claims used that are not understood MUST be ignored.</p>
<p>The authentication token MUST be sent
as the value of the <a class="reference internal" href="#term-oauth-assertions"><em class="xref std std-term">[OAuth.Assertions]</em></a> <a class="reference internal" href="oauth_assertion.html#term-client-assertion"><em class="xref std std-term">client_assertion</em></a> parameter.</p>
<p class="last">The value of the [OAuth.Assertions] <a class="reference internal" href="oauth_assertion.html#term-client-assertion-type"><em class="xref std std-term">client_assertion_type</em></a> parameter MUST
be &#8220;<a class="reference external" href="urn:ietf:params:oauth:client-assertion-type:jwt-bearer">urn:ietf:params:oauth:client-assertion-type:jwt-bearer</a>&#8221;, per <a class="reference internal" href="#term-oauth-jwt"><em class="xref std std-term">[OAuth.JWT]</em></a>.</p>
</dd>
<dt id="term-private-key-jwt">private_key_jwt</dt>
<dd><p class="first">Clients that have registered a public key sign a JWT
using that key.</p>
<p>The Client authenticates in accordance with JSON Web Token (JWT) Profile
for OAuth 2.0 Client Authentication and Authorization Grants [OAuth.JWT]
and Assertion Framework for OAuth 2.0 Client Authentication
and Authorization Grants [OAuth.Assertions].</p>
<p>The JWT MUST contain the following REQUIRED Claim Values
and MAY contain the following OPTIONAL Claim Values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>iss</dt>
<dd>REQUIRED. Issuer. This MUST contain the client_id of the OAuth Client.</dd>
<dt>sub</dt>
<dd>REQUIRED. Subject. This MUST contain the client_id of the OAuth Client.</dd>
<dt>aud</dt>
<dd><p class="first">REQUIRED. Audience. The aud (audience) Claim.</p>
<p>Value that identifies the Authorization Server as an intended audience.</p>
<p>The Authorization Server MUST verify that it is an intended audience for the token.</p>
<p class="last">The Audience SHOULD be the URL of the Authorization Server&#8217;s Token Endpoint.</p>
</dd>
<dt>jti</dt>
<dd><p class="first">REQUIRED. JWT ID. A unique identifier for the token,
which can be used to prevent reuse of the token.</p>
<p class="last">These tokens MUST only be used once, unless conditions
for reuse were negotiated between the parties;
any such negotiation is beyond the scope of this specification.</p>
</dd>
<dt>exp</dt>
<dd>REQUIRED. Expiration time on or after which the ID Token MUST NOT be accepted for processing.</dd>
<dt>iat</dt>
<dd><p class="first">OPTIONAL. Time at which the JWT was issued.
The JWT MAY contain other Claims.</p>
<p class="last">Any Claims used that are not understood MUST be ignored.
The authentication token MUST be sent as the value of the <a class="reference internal" href="#term-oauth-assertions"><em class="xref std std-term">[OAuth.Assertions]</em></a> <a class="reference internal" href="oauth_assertion.html#term-client-assertion"><em class="xref std std-term">client_assertion</em></a> parameter.
The value of the [OAuth.Assertions] client_assertion_type parameter MUST be &#8220;<a class="reference external" href="urn:ietf:params:oauth:client-assertion-type:jwt-bearer">urn:ietf:params:oauth:client-assertion-type:jwt-bearer</a>&#8221;, per [OAuth.JWT].</p>
</dd>
</dl>
<p>For example (with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;
  code=i1WsRn1uB1&amp;
  client_id=s6BhdRkqt3&amp;
  client_assertion_type=
  urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&amp;
  client_assertion=PHNhbWxwOl ... ZT</pre>
</div>
</div></blockquote>
</dd>
<dt id="term-none">none</dt>
<dd>The Client does not authenticate itself at the Token Endpoint,
either because it uses only the Implicit Flow
(and so does not use the Token Endpoint)
or because it is a Public Client
with no Client Secret or other authentication mechanism.</dd>
</dl>
<p>(draft17)</p>
</div>
<div class="section" id="signatures-and-encryption">
<span id="core-10"></span><h2><a class="toc-backref" href="#id144">10.  Signatures and Encryption</a><a class="headerlink" href="#signatures-and-encryption" title="Permalink to this headline">¶</a></h2>
<p>Depending on the transport through which the messages are sent,
the <strong>integrity</strong> of the message might not be guaranteed
and the <strong>originator</strong> of the message might not be authenticated.</p>
<p>To mitigate these risks, ID Token, UserInfo Response, Request Object,
and Client Authentication JWT values can utilize JSON Web Signature (JWS) [JWS]
to sign their contents.</p>
<p>To achieve message <strong>confidentiality</strong>,
these values can also use JSON Web Encryption (JWE) [JWE] to encrypt their contents.</p>
<p>When the message is both signed and encrypted,
it MUST be signed first and then encrypted,
per Section 16.14,
with the result being a Nested JWT, as specified in [JWT].</p>
<p>Note that all JWE encryption methods perform <strong>integrity checking</strong>.</p>
<p>The OP advertises its supported signing and encryption algorithms
in its <tt class="xref doc docutils literal"><span class="pre">Discovery</span></tt> document,
or may supply this information by other means.</p>
<p>The RP declares its required signing and encryption algorithms
in its <a class="reference internal" href="reg.html"><em>Dynamic Registration</em></a> request,
or may communicate this information by other means.</p>
<p>The OP advertises its public keys via its Discovery document,
or may supply this information by other means.</p>
<p>The RP declares its public keys via its Dynamic Registration request,
or may communicate this information by other means.</p>
<p>(draft17)</p>
<div class="section" id="signing">
<span id="core-10-1"></span><h3><a class="toc-backref" href="#id145">10.1.  Signing</a><a class="headerlink" href="#signing" title="Permalink to this headline">¶</a></h3>
<p>The signing party MUST select a signature algorithm based on the algorithms
supported by the recipient.</p>
<dl class="glossary docutils">
<dt id="term-asymmetric-signatures">Asymmetric Signatures</dt>
<dd><p class="first">When using RSA or ECDSA Signatures,
the alg header parameter value of the JWS header MUST be set
to an appropriate algorithm as defined in JSON Web Algorithms [JWA].</p>
<p>The private key used to sign the content MUST be associated
with a public key used for signature verification
published by the sender in its JWK Set document.</p>
<p>If there are multiple keys in the referenced JWK Set document,
a <em class="xref std std-term">kid</em> value MUST be provided in the JWS header.</p>
<p class="last">The key usage of the respective keys MUST support signing.</p>
</dd>
<dt id="term-symmetric-signatures">Symmetric Signatures</dt>
<dd><p class="first">When using MAC-based signatures,
the alg header parameter value of the JWS header MUST be set to a MAC algorithm,
as defined in JSON Web Algorithms [JWA].</p>
<p>The MAC key used is the octets of the UTF-8 representation
of the client_secret value.</p>
<p>See Section 16.19 for a discussion of entropy requirements
for client_secret values.</p>
<p>Symmetric signatures MUST NOT be used by public (non-confidential) Clients
because of their inability to keep secrets.</p>
<p class="last">See Section 16.20 for Security Considerations about the need for signed requests</p>
</dd>
</dl>
<p>(draft17)</p>
</div>
<div class="section" id="rotation-of-asymmetric-signing-keys">
<span id="core-10-1-1"></span><h3><a class="toc-backref" href="#id146">10.1.1.  Rotation of Asymmetric Signing Keys</a><a class="headerlink" href="#rotation-of-asymmetric-signing-keys" title="Permalink to this headline">¶</a></h3>
<p>Rotation of signing keys can be accomplished with the following approach. The signer publishes its keys in a JWK Set at its jwks_uri location and includes the kid of the signing key in the JWS header of each message to indicate to the verifier which key is to be used to validate the signature. Keys can be rolled over by periodically adding new keys to the JWK Set at the jwks_uri location. The signer can begin using a new key at its discretion and signals the change to the verifier using the kid value. The verifier knows to go back to the jwks_uri location to re-retrieve the keys when it sees an unfamiliar kid value. The JWK Set document at the jwks_uri SHOULD retain recently decommissioned signing keys for a reasonable period of time to facilitate a smooth transition.</p>
<p>(draft17)</p>
</div>
<div class="section" id="encryption">
<span id="core-10-2"></span><h3><a class="toc-backref" href="#id147">10.2.  Encryption</a><a class="headerlink" href="#encryption" title="Permalink to this headline">¶</a></h3>
<p>The encrypting party MUST select an encryption algorithm based on the algorithms supported by the recipient.</p>
<blockquote>
<div><dl class="docutils">
<dt>Asymmetric Encryption: RSA</dt>
<dd>The Vpublic key to which the content was encrypted MUST be a public key used for encryption published by the recipient in its JWK Set document. If there are multiple keys in the referenced JWK Set document, a kid value MUST be provided in the JWE header. Use the supported RSA encryption algorithm to encrypt a random Content Encryption Key to be used for encrypting the signed JWT. The key usage of the respective keys MUST include encryption.</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>Asymmetric Encryption: Elliptic Curve</dt>
<dd>Create an ephemeral Elliptic Curve public key for the epk element of the JWE header. The other public key used for the key agreement computation MUST be a public key published by the recipient in its JWK Set document. If there are multiple keys in the referenced JWK Set document, a kid value MUST be provided in the JWE header. Use the ECDH-ES algorithm to agree upon a Content Encryption Key to be used for encrypting the signed JWT. The key usage of the respective keys MUST support encryption.</dd>
<dt>Symmetric Encryption</dt>
<dd>The symmetric encryption key is derived from the client_secret value by using a left truncated SHA-2 hash of the octets of the UTF-8 representation of the client_secret. For keys of 256 or fewer bits, SHA-256 is used; for keys of 257-384 bits, SHA-384 is used; for keys of 385-512 bits, SHA-512 is used. The hash value MUST be left truncated to the appropriate bit length for the AES key wrapping or direct encryption algorithm used, for instance, truncating the SHA-256 hash to 128 bits for A128KW. If a symmetric key with greater than 512 bits is needed, a different method of deriving the key from the client_secret would have to be defined by an extension. Symmetric encryption MUST NOT be used by public (non-confidential) Clients because of their inability to keep secrets.</dd>
</dl>
<p>See Section 16.21 for Security Considerations about the need for encrypted requests.</p>
<p>(draft17)</p>
<div class="section" id="rotation-of-asymmetric-encryption-keys">
<span id="core-10-2-1"></span><h4><a class="toc-backref" href="#id148">10.2.1.  Rotation of Asymmetric Encryption Keys</a><a class="headerlink" href="#rotation-of-asymmetric-encryption-keys" title="Permalink to this headline">¶</a></h4>
<p>Rotating encryption keys necessarily uses a different process than the one for signing keys because the encrypting party starts the process and thus cannot rely on a change in kid as a signal that keys need to change. The encrypting party still uses the kid header parameter in the JWE to tell the decrypting party which private key to use to decrypt, however, the encrypting party needs to first select the most appropriate key from those provided in the JWK Set at the recipient&#8217;s jwks_uri location.</p>
<p>To rotate keys, the decrypting party can publish new keys at its jwks_uri location and remove from the JWK Set those that are being decommissioned. The jwks_uri SHOULD include a Cache-Control header in the response that contains a max-age directive, as defined in RFC 2616 [RFC2616], which enables the encrypting party to safely cache the JWK Set and not have to re-retrieve the document for every encryption event. The decrypting party SHOULD remove decommissioned keys from the JWK Set referenced by jwks_uri but retain them internally for some reasonable period of time, coordinated with the cache duration, to facilitate a smooth transition between keys by allowing the encrypting party some time to obtain the new keys. The cache duration SHOULD also be coordinated with the issuance of new signing keys, as described in Section 10.1.1.</p>
<p>(draft17)</p>
</div>
</div>
</div>
<div class="section" id="offline-access">
<span id="core-11"></span><h2><a class="toc-backref" href="#id149">11.  Offline Access</a><a class="headerlink" href="#offline-access" title="Permalink to this headline">¶</a></h2>
<p>OpenID Connect defines the following scope value to request offline access:</p>
<dl class="glossary docutils">
<dt id="term-offline-access">offline_access</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">This scope value requests that an OAuth 2.0 <a class="reference internal" href="glossary.html#term-refresh-token"><em class="xref std std-term">Refresh Token</em></a> be issued
that can be used to obtain an Access Token that grants access
to the End-User&#8217;s UserInfo Endpoint
even when the End-User is not present (not logged in).</p>
</dd>
</dl>
<p>When offline access is requested,
a prompt parameter value of consent MUST be used
unless other conditions for processing the request permitting offline access
to the requested resources are in place.</p>
<p>The OP MUST always obtain consent to returning a Refresh Token
that enables offline access to the requested resources.</p>
<p>A previously saved user consent is not always sufficient
to grant offline access.</p>
<p>Upon receipt of a scope parameter
containing the offline_access value, the Authorization Server:</p>
<blockquote>
<div><ul class="simple">
<li>MUST ensure that the prompt parameter contains consent
unless other conditions for processing the request permitting offline access
to the requested resources are in place;
unless one or both of these conditions are fulfilled,
then it MUST ignore the offline_access request,</li>
<li>MUST ignore the offline_access request
unless the Client is using a <a class="reference internal" href="messages.html#term-60"><em class="xref std std-term">response_type</em></a> value
that would result in an <a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a> being returned,</li>
<li>MUST explicitly receive or have consent for all Clients
when the registered <a class="reference internal" href="reg.html#term-application-type"><em class="xref std std-term">application_type</em></a> is <strong>web</strong>,</li>
<li>SHOULD explicitly receive or have consent for all Clients
when the registered <a class="reference internal" href="reg.html#term-application-type"><em class="xref std std-term">application_type</em></a> is <strong>native</strong>.</li>
</ul>
</div></blockquote>
<p>The use of Refresh Tokens is not exclusive to the offline_access use case.</p>
<p>The Authorization Server MAY grant Refresh Tokens
in other contexts that are beyond the scope of this specification.</p>
<p>(draft17)</p>
</div>
<div class="section" id="using-refresh-tokens">
<span id="core-12"></span><h2><a class="toc-backref" href="#id150">12.  Using Refresh Tokens</a><a class="headerlink" href="#using-refresh-tokens" title="Permalink to this headline">¶</a></h2>
<p>A request to the <em class="xref std std-term">Token Endpoint</em> can also use a <a class="reference internal" href="glossary.html#term-refresh-token"><em class="xref std std-term">Refresh Token</em></a>
by using the <a class="reference internal" href="oauth_assertion.html#term-grant-type"><em class="xref std std-term">grant_type</em></a> value <a class="reference internal" href="uma_core.html#term-refresh-token"><em class="xref std std-term">refresh_token</em></a>,
as described in <a class="reference internal" href="oauth.html#oauth-6"><em>Section 6 of OAuth 2.0</em></a> <a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>.</p>
<p>This section defines the behaviors for OpenID Connect Authorization Servers
when Refresh Tokens are used.</p>
<p>(draft17)</p>
<div class="section" id="refresh-request">
<span id="core-12-1"></span><h3><a class="toc-backref" href="#id151">12.1.  Refresh Request</a><a class="headerlink" href="#refresh-request" title="Permalink to this headline">¶</a></h3>
<p>To refresh an Access Token,
the Client MUST authenticate to the Token Endpoint
using the authentication method registered
for its <a class="reference internal" href="messages.html#term-62"><em class="xref std std-term">client_id</em></a>, as documented in <a class="reference internal" href="#core-9"><em>Section 9</em></a>.</p>
<p>The Client sends the parameters via <strong>HTTP POST</strong>
to the Token Endpoint using
Form Serialization, per <a class="reference internal" href="#core-13-2"><em>Section 13.2</em></a>.</p>
<p>The following is a non-normative example of a Refresh Request
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3
  &amp;client_secret=some_secret12345
  &amp;grant_type=refresh_token
  &amp;refresh_token=8xLOxBtZp8
  &amp;scope=openid%20profile</pre>
</div>
<p>The Authorization Server MUST validate the Refresh Token,
MUST verify that it was issued to the Client,
and must verify that the Client successfully authenticated
it has a Client Authentication method.</p>
<p>(draft17)</p>
</div>
<div class="section" id="successful-refresh-response">
<span id="core-12-2"></span><h3><a class="toc-backref" href="#id152">12.2.  Successful Refresh Response</a><a class="headerlink" href="#successful-refresh-response" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>ID Tokenは認証イベントに紐づいているのでリフレッシュしないこともある</li>
</ul>
</div>
<p>Upon successful validation of the Refresh Token,
the response body is the Token Response of
<a class="reference internal" href="#core-3-1-3-3"><em>Section 3.1.3.3</em></a>
except that it might not contain an <a class="reference internal" href="messages.html#term-96"><em class="xref std std-term">id_token</em></a>.</p>
<p>If an ID Token is returned as a result of a token refresh request,
the following requirements apply:</p>
<blockquote>
<div><ul class="simple">
<li>its <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> Claim Value MUST be the same
as in the ID Token issued
when the original authentication occurred,</li>
<li>its <a class="reference internal" href="messages.html#term-sub"><em class="xref std std-term">sub</em></a> Claim Value MUST be the same
as in the ID Token issued when the original authentication occurred,</li>
<li>its <a class="reference internal" href="messages.html#term-iat"><em class="xref std std-term">iat</em></a> Claim MUST represent the time
that the new ID Token is issued,</li>
<li>its <a class="reference internal" href="messages.html#term-aud"><em class="xref std std-term">aud</em></a> Claim Value MUST be the same
as in the ID Token issued
when the original authentication occurred,</li>
<li>if the ID Token contains an <a class="reference internal" href="messages.html#term-87"><em class="xref std std-term">auth_time</em></a> Claim,
its value MUST represent the time of the original authentication -
not the time that the new ID token is issued,</li>
<li>its <a class="reference internal" href="messages.html#term-azp"><em class="xref std std-term">azp</em></a> Claim Value MUST be the same as
in the ID Token issued
when the original authentication occurred;
if no azp Claim was present in the original ID Token,
one MUST NOT be present in the new ID Token, and</li>
<li>otherwise,
the same rules apply as apply when issuing an ID Token
at the time of the original authentication.</li>
</ul>
</div></blockquote>
<p>The following is a non-normative example of a Refresh Response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
Pragma: no-cache

{
 "access_token": "TlBN45jURg",
 "token_type": "Bearer",
 "refresh_token": "9yNOxJtZa5",
 "expires_in": 3600
}</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="refresh-error-response">
<span id="core-12-3"></span><h3><a class="toc-backref" href="#id153">12.3.  Refresh Error Response</a><a class="headerlink" href="#refresh-error-response" title="Permalink to this headline">¶</a></h3>
<p>If the Refresh Request is invalid or unauthorized,
the Authorization Server returns the Token Error Response
as defined in <a class="reference internal" href="oauth.html#oauth-5-2"><em>Section 5.2 of OAuth 2.0</em></a>
<a class="reference internal" href="oauth_meta.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a>.</p>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="serializations">
<span id="core-13"></span><h2><a class="toc-backref" href="#id154">13.  Serializations</a><a class="headerlink" href="#serializations" title="Permalink to this headline">¶</a></h2>
<p>Messages are serialized using one of the following methods:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#core-13-1"><em>Query String Serialization</em></a></li>
<li><a class="reference internal" href="#core-13-2"><em>Form Serialization</em></a></li>
<li><a class="reference internal" href="#core-13-3"><em>JSON Serialization</em></a></li>
</ul>
</div></blockquote>
<p>This section describes the syntax of these serialization methods;
other sections describe
when they can and must be used.</p>
<p>Note that not all methods can be used
for all messages.</p>
<p>(draft17)</p>
<div class="section" id="query-string-serialization">
<span id="core-13-1"></span><h3><a class="toc-backref" href="#id155">13.1.  Query String Serialization</a><a class="headerlink" href="#query-string-serialization" title="Permalink to this headline">¶</a></h3>
<p>In order to serialize the parameters
using the Query String Serialization,
the Client constructs the string by adding the parameters and values
to the query component of a URL
using the <strong>application/x-www-form-urlencoded</strong> format
as defined by <em class="xref std std-term">[W3C.REC‑html401‑19991224]</em>.</p>
<p>Query String Serialization is typically used in HTTP GET requests.</p>
<p>The same serialization method is also used
when adding parameters to the fragment component of a URL.</p>
<p>The following is a non-normative example of this serialization (with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>GET /authorize?
  response_type=code
  &amp;scope=openid
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb HTTP/1.1
Host: server.example.com</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="form-serialization">
<span id="core-13-2"></span><h3><a class="toc-backref" href="#id156">13.2.  Form Serialization</a><a class="headerlink" href="#form-serialization" title="Permalink to this headline">¶</a></h3>
<p>Parameters and their values are Form Serialized
by adding the parameter names and values
to the entity body of the HTTP request
using the <strong>application/x-www-form-urlencoded</strong> format
as defined by <em class="xref std std-term">[W3C.REC‑html401‑19991224]</em>.</p>
<p>Form Serialization is typically used in HTTP POST requests.</p>
<p>The following is a non-normative example of this serialization
(with line wraps within values for display purposes only):</p>
<div class="highlight-python"><pre>POST /authorize HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

response_type=code
  &amp;scope=openid
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="json-serialization">
<span id="core-13-3"></span><h3><a class="toc-backref" href="#id157">13.3.  JSON Serialization</a><a class="headerlink" href="#json-serialization" title="Permalink to this headline">¶</a></h3>
<p>The parameters are serialized into a JSON object structure
by adding each parameter at the highest structure level.</p>
<p>Parameter names and string values are represented as JSON strings.</p>
<p>Numerical values are represented as JSON numbers.
Boolean values are represented as JSON booleans.
Omitted parameters and parameters with no value SHOULD be omitted
from the object and not represented by a JSON null value,
unless otherwise specified.</p>
<p>A parameter MAY have a JSON object or a JSON array as its value.</p>
<p>The following is a non-normative example
of this serialization:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;access_token&quot;</span><span class="o">:</span> <span class="s2">&quot;SlAV32hkKG&quot;</span><span class="p">,</span>
 <span class="s2">&quot;token_type&quot;</span><span class="o">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expires_in&quot;</span><span class="o">:</span> <span class="mi">3600</span><span class="p">,</span>
 <span class="s2">&quot;refresh_token&quot;</span><span class="o">:</span> <span class="s2">&quot;8xLOxBtZp8&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="string-operations">
<span id="core-14"></span><h2><a class="toc-backref" href="#id158">14.  String Operations</a><a class="headerlink" href="#string-operations" title="Permalink to this headline">¶</a></h2>
<p>Processing some OpenID Connect messages requires
comparing values in the messages
to known values.</p>
<p>For example,
the Claim Names returned by the UserInfo Endpoint might be compared
to specific Claim Names such as <a class="reference internal" href="messages.html#term-sub"><em class="xref std std-term">sub</em></a>.</p>
<p>Comparing Unicode strings,
however, has significant security implications.</p>
<p>Therefore,
comparisons between JSON strings and other Unicode strings MUST
be performed as specified below:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Remove any JSON applied escaping
to produce an array of Unicode code points.</li>
</ol>
<ol class="arabic simple">
<li>Unicode Normalization <a class="reference internal" href="#term-usa15"><em class="xref std std-term">[USA15]</em></a> MUST NOT be applied
at any point to either the JSON string
or to the string it is to be compared against.</li>
</ol>
<ol class="arabic simple">
<li>Comparisons between the two strings MUST be performed
as a Unicode code point to code point equality comparison.</li>
</ol>
</div></blockquote>
<p>In several places,
this specification uses space delimited lists of strings.
In all such cases,
a single ASCII space character (0x20) MUST be used as the delimiter.</p>
<p>(draft17)</p>
</div>
<div class="section" id="implementation-considerations">
<span id="core-15"></span><h2><a class="toc-backref" href="#id159">15.  Implementation Considerations</a><a class="headerlink" href="#implementation-considerations" title="Permalink to this headline">¶</a></h2>
<p>This specification defines features used by
both Relying Parties and OpenID Providers.</p>
<p>It is expected that some OpenID Providers will require
static, out-of-band configuration of RPs using them,
whereas others will support dynamic usage by RPs
without a pre-established relationship between them.</p>
<p>For that reason,
the mandatory-to-implement features for OPs are listed below
in two groups:
the first <a class="reference internal" href="#core-15-1"><em>for all OPs</em></a>
and the second for <a class="reference internal" href="#core-15-2"><em>&#8220;Dynamic&#8221; OpenID Providers</em></a>.</p>
<p>(draft17)</p>
<div class="section" id="mandatory-to-implement-features-for-all-openid-providers">
<span id="core-15-1"></span><h3><a class="toc-backref" href="#id160">15.1.  Mandatory to Implement Features for All OpenID Providers</a><a class="headerlink" href="#mandatory-to-implement-features-for-all-openid-providers" title="Permalink to this headline">¶</a></h3>
<p>All OpenID Providers MUST implement the following features defined in this specification. This list augments the set of features that are already listed elsewhere as being &#8220;REQUIRED&#8221; or are described with a &#8220;MUST&#8221;, and so is not, by itself, a comprehensive set of implementation requirements for OPs.</p>
<blockquote>
<div><dl class="docutils">
<dt>Signing ID Tokens with RSA SHA-256</dt>
<dd>OPs MUST support signing ID Tokens
with the <a class="reference internal" href="glossary.html#term-rsa"><em class="xref std std-term">RSA</em></a> <a class="reference internal" href="glossary.html#term-sha-256"><em class="xref std std-term">SHA-256</em></a> algorithm
(an alg value of RS256),
unless the OP only supports returning ID Tokens
from the Token Endpoint
(as is the case for the Authorization Code Flow)
and only allows Clients to register specifying none
as the requested ID Token signing algorithm.</dd>
<dt>Prompt Parameter</dt>
<dd>OPs MUST support the prompt parameter,
as defined in Section 3.1.2,
including the specified user interface behaviors such as none and login.</dd>
<dt>Display Parameter</dt>
<dd>OPs MUST support the display parameter,
as defined in Section 3.1.2.
(Note that the minimum level of support required for this parameter
is simply that its use must not result in an error.)</dd>
<dt>Preferred Locales</dt>
<dd>OPs MUST support requests for preferred languages
and scripts for the user interface
and for Claims via the <strong>ui_locales</strong> and <strong>claims_locales</strong> request parameters,
as defined in Section 3.1.2.
(Note that the minimum level of support
required for these parameters is simply
to have their use not result in errors.)</dd>
<dt>Authentication Time</dt>
<dd>OPs MUST support returning the time
at which the End-User authenticated
via the auth_time Claim, when requested,
as defined in Section 2.</dd>
<dt>Maximum Authentication Age</dt>
<dd>OPs MUST support enforcing a maximum authentication age
via the max_age parameter,
as defined in Section 3.1.2.</dd>
<dt>Authentication Context Class Reference</dt>
<dd><p class="first">OPs MUST support requests for specific Authentication Context Class Reference values
via the <a class="reference internal" href="messages.html#term-acr-values"><em class="xref std std-term">acr_values</em></a> parameter,
as defined in Section 3.1.2.</p>
<p class="last">(Note that the minimum level of support required for this parameter
is simply to have its use not result in an error.)</p>
</dd>
</dl>
</div></blockquote>
<p>(draft17)</p>
</div>
<div class="section" id="mandatory-to-implement-features-for-dynamic-openid-providers">
<span id="core-15-2"></span><h3><a class="toc-backref" href="#id161">15.2.  Mandatory to Implement Features for Dynamic OpenID Providers</a><a class="headerlink" href="#mandatory-to-implement-features-for-dynamic-openid-providers" title="Permalink to this headline">¶</a></h3>
<p>In addition to the features listed above,
OpenID Providers supporting dynamic establishment of relationships
with RPs that they do not have a pre-configured relationship with
MUST also implement the following features defined
in this and related specifications.</p>
<dl class="glossary docutils">
<dt id="term-response-types">Response Types</dt>
<dd>These OpenID Providers MUST support the <a class="reference internal" href="messages.html#term-96"><em class="xref std std-term">id_token</em></a> Response Type
and all that are not Self-Issued OPs
MUST also support the code and id_token token Response Types.</dd>
<dt id="term-discovery">Discovery</dt>
<dd>These OPs MUST support Discovery,
as defined in OpenID Connect Discovery 1.0 [OpenID.Discovery].</dd>
<dt id="term-dynamic-registration">Dynamic Registration</dt>
<dd>These OPs MUST support Dynamic Client Registration,
as defined in OpenID Connect Dynamic Client Registration 1.0
[OpenID.Registration].</dd>
<dt id="term-138">UserInfo Endpoint</dt>
<dd>All dynamic OPs that issue Access Tokens
MUST support the UserInfo Endpoint,
as defined in Section 5.3.
(Self-Issued OPs do not issue Access Tokens.)</dd>
<dt id="term-public-keys-published-as-bare-keys">Public Keys Published as Bare Keys</dt>
<dd>These OPs MUST publish their public keys as bare JWK keys
(which MAY also be accompanied by X.509 representations of those keys).</dd>
<dt id="term-140">Request URI</dt>
<dd>These OPs MUST support requests made
using a Request Object value that is retrieved
from a Request URI that is provided with the request_uri parameter,
as defined in Section 3.1.2.</dd>
</dl>
<p>(draft17)</p>
</div>
<div class="section" id="discovery-and-registration">
<span id="core-15-3"></span><h3><a class="toc-backref" href="#id162">15.3.  Discovery and Registration</a><a class="headerlink" href="#discovery-and-registration" title="Permalink to this headline">¶</a></h3>
<p>Some OpenID Connect installations can use a pre-configured set
of OpenID Providers and/or Relying Parties.</p>
<p>In those cases,
it might not be necessary to support dynamic discovery
of information about identities
or services or dynamic registration of Clients.</p>
<p>However,
if installations choose to support unanticipated interactions
between Relying Parties and OpenID Providers
that do not have pre-configured relationships,
they SHOULD accomplish this by implementing the facilities
defined in the OpenID Connect Discovery 1.0 <a class="reference internal" href="#term-openid-discovery"><em class="xref std std-term">[OpenID.Discovery]</em></a>
and OpenID Connect Dynamic Client Registration 1.0
<a class="reference internal" href="#term-openid-registration"><em class="xref std std-term">[OpenID.Registration]</em></a> specifications.</p>
<p>(draft17)</p>
</div>
<div class="section" id="mandatory-to-implement-features-for-relying-parties">
<span id="core-15-4"></span><h3><a class="toc-backref" href="#id163">15.4.  Mandatory to Implement Features for Relying Parties</a><a class="headerlink" href="#mandatory-to-implement-features-for-relying-parties" title="Permalink to this headline">¶</a></h3>
<p>In general,
it is up to Relying Parties which features they use
when interacting with OpenID Providers.</p>
<p>However,
some choices are dictated by the nature of their OAuth Client,
such as whether it is a <a class="reference internal" href="glossary.html#term-confidential-client"><em class="xref std std-term">Confidential Client</em></a>,
capable of keeping secrets,
in which case the Authorization Code Flow may be appropriate,
or whether it is a <a class="reference internal" href="glossary.html#term-public-client"><em class="xref std std-term">Public Client</em></a>, for instance,
a User Agent Based Application or a statically registered Native Application,
in which case the Implicit Flow may be appropriate.</p>
<p>When using OpenID Connect features,
those listed as being &#8220;REQUIRED&#8221;
or are described with a &#8220;MUST&#8221; are mandatory to implement,
when used by a Relying Party.</p>
<p>Likewise, those features that are described as &#8220;OPTIONAL&#8221;
need not be used or supported
unless they provide value in the particular application context.</p>
<p>Finally,
when interacting with OpenID Providers that support Discovery,
the OP&#8217;s Discovery document can be used to dynamically determine
which OP features are available for use by the RP.</p>
<p>(draft17)</p>
</div>
<div class="section" id="implementation-notes">
<span id="core-15-5"></span><h3><a class="toc-backref" href="#id164">15.5.  Implementation Notes</a><a class="headerlink" href="#implementation-notes" title="Permalink to this headline">¶</a></h3>
<p>(draft17)</p>
<div class="section" id="authorization-code-implementation-notes">
<span id="core-15-5-1"></span><h4><a class="toc-backref" href="#id165">15.5.1.  Authorization Code Implementation Notes</a><a class="headerlink" href="#authorization-code-implementation-notes" title="Permalink to this headline">¶</a></h4>
<p>When using the Authorization Code or Hybrid flows,
an ID Token is returned from the Token Endpoint
in response to a Token Request using an Authorization Code.</p>
<p>Some implementations may choose to encode state
about the ID Token to be returned in the Authorization Code value.</p>
<p>Others may use the Authorization Code value
as an index into a database storing this state.</p>
<p>(draft17)</p>
</div>
<div class="section" id="nonce-implementation-notes">
<span id="core-15-5-2"></span><h4><a class="toc-backref" href="#id166">15.5.2.  Nonce Implementation Notes</a><a class="headerlink" href="#nonce-implementation-notes" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="messages.html#term-78"><em class="xref std std-term">nonce</em></a> parameter value needs to include per-session state
and be unguessable to attackers.</p>
<p>One method to achieve this for Web Server Clients is
to store a cryptographically random value
as an <em class="xref std std-term">HttpOnly</em> session cookie
and use a cryptographic hash of the value as the <a class="reference internal" href="messages.html#term-78"><em class="xref std std-term">nonce</em></a> parameter.</p>
<p>In that case,
the <a class="reference internal" href="messages.html#term-78"><em class="xref std std-term">nonce</em></a> in the returned ID Token is compared
to the hash of the session cookie to detect ID Token replay
by third parties.</p>
<p>A related method applicable to JavaScript Clients is
to store the cryptographically random value
in HTML5 local storage and
use a cryptographic hash of this value.</p>
<p>(draft17)</p>
</div>
<div class="section" id="redirect-uri-fragment-handling-implementation-notes">
<span id="core-15-5-3"></span><h4><a class="toc-backref" href="#id167">15.5.3.  Redirect URI Fragment Handling Implementation Notes</a><a class="headerlink" href="#redirect-uri-fragment-handling-implementation-notes" title="Permalink to this headline">¶</a></h4>
<p>When response parameters are returned
in the Redirection URI <a class="reference internal" href="glossary.html#term-fragment"><em class="xref std std-term">fragment</em></a> value,
the Client needs to have the User Agent parse the fragment encoded values
and pass them to on to the Client&#8217;s processing logic for consumption.</p>
<p>User Agents that have direct access to cryptographic APIs
may be able to be self-contained, for instance,
with all Client code being written in JavaScript.</p>
<p>However,
if the Client does not run entirely in the User Agent,
one way to achieve this is to post them
to a Web Server Client for validation.</p>
<p>The following is an example of a JavaScript file
that a Client might host at its <a class="reference internal" href="messages.html#term-63"><em class="xref std std-term">redirect_uri</em></a>.</p>
<p>This is loaded by the redirect from the Authorization Server.
The <em class="xref std std-term">fragment component</em> is parsed and
then sent by POST to a URI that will validate
and use the information received.</p>
<p>Following is a non-normative example of a Redirect URI response:</p>
<div class="highlight-python"><pre>GET /cb HTTP/1.1
Host: client.example.org

HTTP/1.1 200 OK
Content-Type: text/html

&lt;script type="text/javascript"&gt;

// First, parse the query string
var params = {}, postBody = location.hash.substring(1),
    regex = /([^&amp;=]+)=([^&amp;]*)/g, m;
while (m = regex.exec(postBody)) {
  params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
}

// And send the token over to the server
var req = new XMLHttpRequest();
// using POST so query isn't logged
req.open('POST', 'https://' + window.location.host +
                 '/catch_response', true);
req.setRequestHeader('Content-Type',
                     'application/x-www-form-urlencoded');

req.onreadystatechange = function (e) {
  if (req.readyState == 4) {
    if (req.status == 200) {
// If the response from the POST is 200 OK, perform a redirect
      window.location = 'https://'
        + window.location.host + '/redirect_after_login'
    }
// if the OAuth response is invalid, generate an error message
    else if (req.status == 400) {
      alert('There was an error processing the token')
    } else {
      alert('Something other than 200 was returned')
    }
  }
};
req.send(postBody);</pre>
</div>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="compatibility-notes">
<span id="core-15-6"></span><h3><a class="toc-backref" href="#id168">15.6.  Compatibility Notes</a><a class="headerlink" href="#compatibility-notes" title="Permalink to this headline">¶</a></h3>
<p>(draft17)</p>
</div>
<div class="section" id="pre-final-ietf-specifications">
<span id="core-15-6-1"></span><h3><a class="toc-backref" href="#id169">15.6.1.  Pre-Final IETF Specifications</a><a class="headerlink" href="#pre-final-ietf-specifications" title="Permalink to this headline">¶</a></h3>
<p>Implementers should be aware that this specification uses several IETF specifications that are not yet final specifications. Those specifications are:</p>
<blockquote>
<div><ul class="simple">
<li>JSON Web Token (<a class="reference internal" href="jwt.html"><em>JWT</em></a>) draft -13 [JWT]</li>
<li>JSON Web Signature (<a class="reference internal" href="jws.html"><em>JWS</em></a>) draft -18 [JWS]</li>
<li>JSON Web Encryption (<a class="reference internal" href="jwe.html"><em>JWE</em></a>) draft -18 [JWE]</li>
<li>JSON Web Key (<a class="reference internal" href="jwk.html"><em>JWK</em></a>) draft -18 [JWK]</li>
<li>JSON Web Algorithms <a class="reference internal" href="jwa.html"><em>draft</em></a> -18 [JWA]</li>
<li>Assertion Framework for OAuth 2.0 Client Authentication and Authorization Grants draft -13 <a class="reference internal" href="#term-oauth-assertions"><em class="xref std std-term">[OAuth.Assertions]</em></a></li>
<li>JSON Web Token (JWT) Profile for OAuth 2.0 Client Authentication and Authorization Grants draft -07 <a class="reference internal" href="#term-oauth-jwt"><em class="xref std std-term">[OAuth.JWT]</em></a></li>
</ul>
</div></blockquote>
<p>While every effort will be made to prevent breaking changes
to these specifications, should they occur,
OpenID Connect implementations should continue to use
the specifically referenced draft versions above
in preference to the final versions,
unless using a possible future OpenID Connect profile or specification
that updates some or all of these references.</p>
<p>(draft17)</p>
<div class="section" id="google-iss-value">
<span id="core-15-6-2"></span><h4><a class="toc-backref" href="#id170">15.6.2.  Google &#8220;iss&#8221; Value</a><a class="headerlink" href="#google-iss-value" title="Permalink to this headline">¶</a></h4>
<p>Implementers may want to be aware that,
as of the time of this writing,
Google&#8217;s deployed OpenID Connect implementation issues ID Tokens
that omit the required <strong>https://</strong> scheme prefix from the <a class="reference internal" href="messages.html#term-iss"><em class="xref std std-term">iss</em></a> (issuer) Claim Value.</p>
<p>Relying Party implementations wishing to work with Google
will therefore need to have code to work around this,
until such time as their implementation is updated.</p>
<p>Any such workaround code should be written in a manner
that will not break at such point Google adds the missing prefix
to their issuer values.</p>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="related-specifications-and-implementer-s-guides">
<span id="core-15-7"></span><h3><a class="toc-backref" href="#id171">15.7.  Related Specifications and Implementer&#8217;s Guides</a><a class="headerlink" href="#related-specifications-and-implementer-s-guides" title="Permalink to this headline">¶</a></h3>
<p>These related OPTIONAL specifications MAY be used in combination with this specification to provide additional functionality:</p>
<blockquote>
<div><ul class="simple">
<li>OpenID Connect <a class="reference internal" href="discovery.html"><em>Discovery</em></a> 1.0 <a class="reference internal" href="#term-openid-discovery"><em class="xref std std-term">[OpenID.Discovery]</em></a> - Defines how Relying Parties dynamically discover information about OpenID Providers</li>
<li>OpenID Connect <a class="reference internal" href="reg.html"><em>Dynamic Client Registration</em></a> 1.0 [OpenID.Registration] - Defines how Relying Parties dynamically register with OpenID Providers</li>
<li>OpenID Connect <a class="reference internal" href="session.html"><em>Session Management</em></a> 1.0 [OpenID.Session] - Defines how to manage OpenID Connect sessions, including logout functionality</li>
<li>OAuth 2.0 Form Post Response Mode <a class="reference internal" href="#term-oauth-post"><em class="xref std std-term">[OAuth.Post]</em></a> - Defines how to return OAuth 2.0 Authorization Response parameters (including OpenID Connect Authentication Response parameters) using HTML form values that are auto-submitted by the User Agent using HTTP POST</li>
</ul>
</div></blockquote>
<p>These implementer&#8217;s guides are intended to serve as self-contained references for implementers of basic Web-based Relying Parties:</p>
<blockquote>
<div><ul class="simple">
<li>OpenID Connect Basic Client Implementer&#8217;s Guide 1.0 [OpenID.Basic] - Implementer&#8217;s guide containing a subset of this specification that is intended for use by basic Web-based Relying Parties using the OAuth Authorization Code Flow</li>
<li>OpenID Connect Implicit Client Implementer&#8217;s Guide 1.0 [OpenID.Implicit] - Implementer&#8217;s guide containing a subset of this specification that is intended for use by basic Web-based Relying Parties using the OAuth Implicit Flow</li>
</ul>
</div></blockquote>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="security-considerations">
<span id="core-16"></span><h2><a class="toc-backref" href="#id172">16.  Security Considerations</a><a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>This specification references the security considerations defined in Section 10 of OAuth 2.0 [RFC6749], and Section 5 of OAuth 2.0 Bearer Token Usage [RFC6750]. Furthermore, the OAuth 2.0 Threat Model and Security Considerations [RFC6819] specification provides an extensive list of threats and controls that apply to this specification as well, given that it is based upon OAuth 2.0. ISO/IEC 29115 [ISO29115] also provides threats and controls that implementers need to take into account. Implementers are highly advised to read these references in detail and apply the countermeasures described therein.</p>
<p>In addition, the following list of attack vectors and remedies are also considered.</p>
<p>(draft17)</p>
</div>
<div class="section" id="privacy-considerations">
<span id="core-17"></span><h2><a class="toc-backref" href="#id173">17.  Privacy Considerations</a><a class="headerlink" href="#privacy-considerations" title="Permalink to this headline">¶</a></h2>
<p>(draft17)</p>
</div>
<div class="section" id="iana-considerations">
<span id="core-18"></span><h2><a class="toc-backref" href="#id174">18.  IANA Considerations</a><a class="headerlink" href="#iana-considerations" title="Permalink to this headline">¶</a></h2>
<p>(draft17)</p>
</div>
<div class="section" id="references">
<span id="core-19"></span><h2><a class="toc-backref" href="#id175">19.  References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>(draft17)</p>
<div class="section" id="normative-references">
<span id="core-19-1"></span><h3><a class="toc-backref" href="#id176">19.1. Normative References</a><a class="headerlink" href="#normative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-cors">[CORS]</dt>
<dd>Opera Software ASA, “Cross-Origin Resource Sharing,” July 2010.</dd>
<dt id="term-e-164">[E.164]</dt>
<dd>International Telecommunication Union, “E.164: The international public telecommunication numbering plan,” 2010.</dd>
<dt id="term-iana-language">[IANA.Language]</dt>
<dd>Internet Assigned Numbers Authority (IANA), “Language Subtag Registry,” 2005.</dd>
<dt id="term-iso29115">[ISO29115]</dt>
<dd>International Organization for Standardization, “ISO/IEC 29115:2013 &#8211; Information technology - Security techniques - Entity authentication assurance framework,” ISO/IEC 29115, March 2013.</dd>
<dt id="term-iso3166-1">[ISO3166-1]</dt>
<dd>International Organization for Standardization, “ISO 3166-1:1997. Codes for the representation of names of countries and their subdivisions &#8211; Part 1: Country codes,” 1997.</dd>
<dt id="term-iso639-1">[ISO639-1]</dt>
<dd>International Organization for Standardization, “ISO 639-1:2002. Codes for the representation of names of languages &#8211; Part 1: Alpha-2 code,” 2002.</dd>
<dt id="term-iso8601-2004">[ISO8601-2004]</dt>
<dd>International Organization for Standardization, “ISO 8601:2004. Data elements and interchange formats - Information interchange - Representation of dates and times,” 2004.</dd>
<dt id="term-jwa">[JWA]</dt>
<dd>Jones, M., “JSON Web Algorithms (JWA),” draft-ietf-jose-json-web-algorithms (work in progress), November 2013 (HTML).</dd>
<dt id="term-jwe">[JWE]</dt>
<dd>Jones, M., Rescorla, E., and J. Hildebrand, “JSON Web Encryption (JWE),” draft-ietf-jose-json-web-encryption (work in progress), November 2013 (HTML).</dd>
<dt id="term-jwk">[JWK]</dt>
<dd>Jones, M., “JSON Web Key (JWK),” draft-ietf-jose-json-web-key (work in progress), November 2013 (HTML).</dd>
<dt id="term-jws">[JWS]</dt>
<dd>Jones, M., Bradley, J., and N. Sakimura, “JSON Web Signature (JWS),” draft-ietf-jose-json-web-signature (work in progress), November 2013 (HTML).</dd>
<dt id="term-jwt">[JWT]</dt>
<dd>Jones, M., Bradley, J., and N. Sakimura, “JSON Web Token (JWT),” draft-ietf-oauth-json-web-token (work in progress), November 2013 (HTML).</dd>
<dt id="term-oauth-assertions">[OAuth.Assertions]</dt>
<dd>Campbell, B., Mortimore, C., Jones, M., and Y. Goland, “Assertion Framework for OAuth 2.0 Client Authentication and Authorization Grants,” draft-ietf-oauth-assertions (work in progress), December 2013 (HTML).</dd>
<dt id="term-oauth-jwt">[OAuth.JWT]</dt>
<dd>Jones, M., Campbell, B., and C. Mortimore, “JSON Web Token (JWT) Profile for OAuth 2.0 Client Authentication and Authorization Grants,” draft-ietf-oauth-jwt-bearer (work in progress), December 2013 (HTML).</dd>
<dt id="term-oauth-responses">[OAuth.Responses]</dt>
<dd>de Medeiros, B., Ed., Scurtescu, M., Tarjan, P., and M. Jones, “OAuth 2.0 Multiple Response Type Encoding Practices,” December 2013.</dd>
<dt id="term-openid-discovery">[OpenID.Discovery]</dt>
<dd>Sakimura, N., Bradley, J., Jones, M., and E. Jay, “OpenID Connect Discovery 1.0,” December 2013.</dd>
<dt id="term-openid-registration">[OpenID.Registration]</dt>
<dd>Sakimura, N., Bradley, J., and M. Jones, “OpenID Connect Dynamic Client Registration 1.0,” December 2013.</dd>
<dt id="term-rfc2119">[RFC2119]</dt>
<dd>Bradner, S., “Key words for use in RFCs to Indicate Requirement Levels,” BCP 14, RFC 2119, March 1997 (TXT, HTML, XML).</dd>
<dt id="term-rfc2246">[RFC2246]</dt>
<dd>Dierks, T. and C. Allen, “The TLS Protocol Version 1.0,” RFC 2246, January 1999 (TXT).</dd>
<dt id="term-rfc2616">[RFC2616]</dt>
<dd>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, “Hypertext Transfer Protocol &#8211; HTTP/1.1,” RFC 2616, June 1999 (TXT, PS, PDF, HTML, XML).</dd>
<dt id="term-rfc3339">[RFC3339]</dt>
<dd>Klyne, G., Ed. and C. Newman, “Date and Time on the Internet: Timestamps,” RFC 3339, July 2002 (TXT, HTML, XML).</dd>
<dt id="term-rfc3966">[RFC3966]</dt>
<dd>Schulzrinne, H., “The tel URI for Telephone Numbers,” RFC 3966, December 2004 (TXT).</dd>
<dt id="term-rfc3986">[RFC3986]</dt>
<dd>Berners-Lee, T., Fielding, R., and L. Masinter, “Uniform Resource Identifier (URI): Generic Syntax,” STD 66, RFC 3986, January 2005 (TXT, HTML, XML).</dd>
<dt id="term-rfc4627">[RFC4627]</dt>
<dd>Crockford, D., “The application/json Media Type for JavaScript Object Notation (JSON),” RFC 4627, July 2006 (TXT).</dd>
<dt id="term-rfc5246">[RFC5246]</dt>
<dd>Dierks, T. and E. Rescorla, “The Transport Layer Security (TLS) Protocol Version 1.2,” RFC 5246, August 2008 (TXT).</dd>
<dt id="term-rfc5322">[RFC5322]</dt>
<dd>Resnick, P., Ed., “Internet Message Format,” RFC 5322, October 2008 (TXT, HTML, XML).</dd>
<dt id="term-rfc5646">[RFC5646]</dt>
<dd>Phillips, A. and M. Davis, “Tags for Identifying Languages,” BCP 47, RFC 5646, September 2009 (TXT).</dd>
<dt id="term-rfc6125">[RFC6125]</dt>
<dd>Saint-Andre, P. and J. Hodges,
“Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS),” RFC 6125, March 2011 (TXT).</dd>
<dt id="term-rfc6711">[RFC6711]</dt>
<dd>Johansson, L., “An IANA Registry for Level of Assurance (LoA) Profiles,” RFC 6711, August 2012 (TXT).</dd>
<dt id="term-rfc6749">[RFC6749]</dt>
<dd>Hardt, D., “The OAuth 2.0 Authorization Framework,” RFC 6749, October 2012 (TXT).</dd>
<dt id="term-rfc6750">[RFC6750]</dt>
<dd>Jones, M. and D. Hardt, “The OAuth 2.0 Authorization Framework: Bearer Token Usage,” RFC 6750, October 2012 (TXT).</dd>
<dt id="term-rfc6819">[RFC6819]</dt>
<dd>Lodderstedt, T., McGloin, M., and P. Hunt, “OAuth 2.0 Threat Model and Security Considerations,” RFC 6819, January 2013 (TXT).</dd>
<dt id="term-usa15">[USA15]</dt>
<dd>Davis, M., Whistler, K., and M. Dürst, “Unicode Normalization Forms,” Unicode Standard Annex 15, 09 2009.</dd>
<dt id="term-w3c-rec-html401-19991224">[W3C.REC-html401-19991224]</dt>
<dd>Hors, A., Raggett, D., and I. Jacobs, “HTML 4.01 Specification,” World Wide Web Consortium Recommendation REC-html401-19991224, December 1999 (HTML).</dd>
<dt id="term-zoneinfo">[zoneinfo]</dt>
<dd>Public Domain, “The tz database,” June 2011.</dd>
</dl>
<p>(draft17)</p>
</div>
<div class="section" id="informative-references">
<span id="core-19-2"></span><h3><a class="toc-backref" href="#id177">19.2. Informative References</a><a class="headerlink" href="#informative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-oauth-post">[OAuth.Post]</dt>
<dd>Jones, M. and B. Campbell, “OAuth 2.0 Form Post Response Mode,” December 2013.</dd>
<dt id="term-openid-2-0">[OpenID.2.0]</dt>
<dd>OpenID Foundation, “OpenID Authentication 2.0,” December 2007 (TXT, HTML).</dd>
<dt id="term-openid-basic">[OpenID.Basic]</dt>
<dd>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, “OpenID Connect Basic Client Implementer&#8217;s Guide 1.0,” December 2013.</dd>
<dt id="term-openid-implicit">[OpenID.Implicit]</dt>
<dd>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, “OpenID Connect Implicit Client Implementer&#8217;s Guide 1.0,” December 2013.</dd>
<dt id="term-openid-pape">[OpenID.PAPE]</dt>
<dd>Recordon, D., Jones, M., Bufu, J., Ed., Daugherty, J., Ed., and N. Sakimura, “OpenID Provider Authentication Policy Extension 1.0,” December 2008 (TXT, HTML).</dd>
<dt id="term-openid-session">[OpenID.Session]</dt>
<dd>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., Mortimore, C., and E. Jay, “OpenID Connect Session Management 1.0,” December 2013.</dd>
<dt id="term-rfc4949">[RFC4949]</dt>
<dd>Shirey, R., “Internet Security Glossary, Version 2,” RFC 4949, August 2007 (TXT).</dd>
<dt id="term-x-1252">[X.1252]</dt>
<dd>International Telecommunication Union, “ITU-T Recommendation X.1252 &#8211; Cyberspace security &#8211; Identity management &#8211; Baseline identity management terms and definitions,” ITU-T X.1252, November 2010.</dd>
</dl>
<p>(draft17)</p>
</div>
</div>
<div class="section" id="appendix-a-authorization-examples">
<span id="core-appendix-a"></span><h2><a class="toc-backref" href="#id178">Appendix A.  Authorization Examples</a><a class="headerlink" href="#appendix-a-authorization-examples" title="Permalink to this headline">¶</a></h2>
<p>The following are non-normative examples of Authorization Requests with different response_type values and their responses (with line wraps within values for display purposes only):</p>
<p>(draft17)</p>
<div class="section" id="a-1-example-using-response-type-code">
<span id="core-appendix-a-1"></span><h3><a class="toc-backref" href="#id179">A.1.  Example using response_type=code</a><a class="headerlink" href="#a-1-example-using-response-type-code" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>GET /authorize?
  response_type=code
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid%20profile%20email
  &amp;nonce=n-0S6_WzA2Mj
  &amp;state=af0ifjsldkj HTTP/1.1
Host: server.example.com</pre>
</div>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.org/cb?
  code=Qcb0Orv1zh30vL1MPRsbm-diHiMwcLyZvn1arpZv-Jxf_11jnpEX3Tgfvk
  &amp;state=af0ifjsldkj</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="a-2-example-using-response-type-id-token">
<span id="core-appendix-a-2"></span><h3><a class="toc-backref" href="#id180">A.2.  Example using response_type=id_token</a><a class="headerlink" href="#a-2-example-using-response-type-id-token" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>GET /authorize?
  response_type=id_token
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid%20profile%20email
  &amp;nonce=n-0S6_WzA2Mj
  &amp;state=af0ifjsldkj HTTP/1.1
Host: server.example.com</pre>
</div>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.org/cb#
  id_token=eyJraWQiOiIxZTlnZGs3IiwiYWxnIjoiUlMyNTYifQ.ewogImlz
  cyI6ICJodHRwOi8vc2VydmVyLmV4YW1wbGUuY29tIiwKICJzdWIiOiAiMjQ4
  Mjg5NzYxMDAxIiwKICJhdWQiOiAiczZCaGRSa3F0MyIsCiAibm9uY2UiOiAi
  bi0wUzZfV3pBMk1qIiwKICJleHAiOiAxMzExMjgxOTcwLAogImlhdCI6IDEz
  MTEyODA5NzAsCiAibmFtZSI6ICJKYW5lIERvZSIsCiAiZ2l2ZW5fbmFtZSI6
  ICJKYW5lIiwKICJmYW1pbHlfbmFtZSI6ICJEb2UiLAogImdlbmRlciI6ICJm
  ZW1hbGUiLAogImJpcnRoZGF0ZSI6ICIwMDAwLTEwLTMxIiwKICJlbWFpbCI6
  ICJqYW5lZG9lQGV4YW1wbGUuY29tIiwKICJwaWN0dXJlIjogImh0dHA6Ly9l
  eGFtcGxlLmNvbS9qYW5lZG9lL21lLmpwZyIKfQ.rHQjEmBqn9Jre0OLykYNn
  spA10Qql2rvx4FsD00jwlB0Sym4NzpgvPKsDjn_wMkHxcp6CilPcoKrWHcip
  R2iAjzLvDNAReF97zoJqq880ZD1bwY82JDauCXELVR9O6_B0w3K-E7yM2mac
  AAgNCUwtik6SjoSUZRcf-O5lygIyLENx882p6MtmwaL1hd6qn5RZOQ0TLrOY
  u0532g9Exxcm-ChymrB4xLykpDj3lUivJt63eEGGN6DH5K6o33TcxkIjNrCD
  4XB1CKKumZvCedgHHF3IAK4dVEDSUoGlH9z4pP_eWYNXvqQOjGs-rDaQzUHl
  6cQQWNiDpWOl_lxXjQEvQ
  &amp;state=af0ifjsldkj</pre>
</div>
<p>The value of the id_token parameter is the ID Token, which is a signed JWT, containing three base64url encoded segments separated by period (&#8216;.&#8217;) characters. The first segment represents the JWT header. Base64url decoding it will result in the following set of Header Parameters:</p>
<div class="highlight-javacript"><pre>{"kid":"1e9gdk7","alg":"RS256"}</pre>
</div>
<p>The alg value represents the algorithm that was used to sign the JWT, in this case RS256, representing RSASSA-PKCS-v1_5 using SHA-256. The kid value is a key identifier used in identifying the key to be used to verify the signature. If the kid value is unknown to the RP, it needs to retrieve the contents of the OP&#8217;s JWK Set again to obtain the OP&#8217;s current set of keys.</p>
<p>The second segment represents the Claims in the ID Token.</p>
<p>Verifying and decoding the ID Token will yield the following Claims:</p>
<div class="highlight-javacript"><pre>{
 "iss": "http://server.example.com",
 "sub": "248289761001",
 "aud": "s6BhdRkqt3",
 "nonce": "n-0S6_WzA2Mj",
 "exp": 1311281970,
 "iat": 1311280970,
 "name": "Jane Doe",
 "given_name": "Jane",
 "family_name": "Doe",
 "gender": "female",
 "birthdate": "0000-10-31",
 "email": "janedoe@example.com",
 "picture": "http://example.com/janedoe/me.jpg"
}</pre>
</div>
<p>The third segment represents the ID Token signature, which is verified as described in [JWS].</p>
<p>(draft17)</p>
</div>
<div class="section" id="a-3-example-using-response-type-id-token-token">
<span id="core-appendix-a-3"></span><h3><a class="toc-backref" href="#id181">A.3.  Example using response_type=id_token token</a><a class="headerlink" href="#a-3-example-using-response-type-id-token-token" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>GET /authorize?
  response_type=id_token%20token
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid%20profile%20email
  &amp;nonce=n-0S6_WzA2Mj
  &amp;state=af0ifjsldkj HTTP/1.1
Host: server.example.com</pre>
</div>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.org/cb#
  access_token=jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y
  &amp;token_type=Bearer
  &amp;id_token=eyJraWQiOiIxZTlnZGs3IiwiYWxnIjoiUlMyNTYifQ.ewogIml
  zcyI6ICJodHRwOi8vc2VydmVyLmV4YW1wbGUuY29tIiwKICJzdWIiOiAiMjQ
  4Mjg5NzYxMDAxIiwKICJhdWQiOiAiczZCaGRSa3F0MyIsCiAibm9uY2UiOiA
  ibi0wUzZfV3pBMk1qIiwKICJleHAiOiAxMzExMjgxOTcwLAogImlhdCI6IDE
  zMTEyODA5NzAsCiAiYXRfaGFzaCI6ICI3N1FtVVB0alBmeld0RjJBbnBLOVJ
  RIgp9.F9gRev0Dt2tKcrBkHy72cmRqnLdzw9FLCCSebV7mWs7o_sv2O5s6zM
  ky2kmhHTVx9HmdvNnx9GaZ8XMYRFeYk8L5NZ7aYlA5W56nsG1iWOou_-gji0
  ibWIuuf4Owaho3YSoi7EvsTuLFz6tq-dLyz0dKABMDsiCmJ5wqkPUDTE3QTX
  jzbUmOzUDli-gCh5QPuZAq0cNW3pf_2n4zpvTYtbmj12cVcxGIMZby7TMWES
  RjQ9_o3jvhVNcCGcE0KAQXejhA1ocJhNEvQNqMFGlBb6_0RxxKjDZ-Oa329e
  GDidOvvp0h5hoES4a8IuGKS7NOcpp-aFwp0qVMDLI-Xnm-Pg
  &amp;state=af0ifjsldkj</pre>
</div>
<p>Verifying and decoding the ID Token will yield the following Claims:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;iss&quot;</span><span class="o">:</span> <span class="s2">&quot;http://server.example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;sub&quot;</span><span class="o">:</span> <span class="s2">&quot;248289761001&quot;</span><span class="p">,</span>
 <span class="s2">&quot;aud&quot;</span><span class="o">:</span> <span class="s2">&quot;s6BhdRkqt3&quot;</span><span class="p">,</span>
 <span class="s2">&quot;nonce&quot;</span><span class="o">:</span> <span class="s2">&quot;n-0S6_WzA2Mj&quot;</span><span class="p">,</span>
 <span class="s2">&quot;exp&quot;</span><span class="o">:</span> <span class="mi">1311281970</span><span class="p">,</span>
 <span class="s2">&quot;iat&quot;</span><span class="o">:</span> <span class="mi">1311280970</span><span class="p">,</span>
 <span class="s2">&quot;at_hash&quot;</span><span class="o">:</span> <span class="s2">&quot;77QmUPtjPfzWtF2AnpK9RQ&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="a-4-example-using-response-type-code-id-token">
<span id="core-appendix-a-4"></span><h3><a class="toc-backref" href="#id182">A.4.  Example using response_type=code id_token</a><a class="headerlink" href="#a-4-example-using-response-type-code-id-token" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>GET /authorize?
  response_type=code%20id_token
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid%20profile%20email
  &amp;nonce=n-0S6_WzA2Mj
  &amp;state=af0ifjsldkj HTTP/1.1
Host: server.example.com</pre>
</div>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.org/cb#
  code=Qcb0Orv1zh30vL1MPRsbm-diHiMwcLyZvn1arpZv-Jxf_11jnpEX3Tgfvk
  &amp;id_token=eyJraWQiOiIxZTlnZGs3IiwiYWxnIjoiUlMyNTYifQ.ewogIml
  zcyI6ICJodHRwOi8vc2VydmVyLmV4YW1wbGUuY29tIiwKICJzdWIiOiAiMjQ
  4Mjg5NzYxMDAxIiwKICJhdWQiOiAiczZCaGRSa3F0MyIsCiAibm9uY2UiOiA
  ibi0wUzZfV3pBMk1qIiwKICJleHAiOiAxMzExMjgxOTcwLAogImlhdCI6IDE
  zMTEyODA5NzAsCiAiY19oYXNoIjogIkxEa3RLZG9RYWszUGswY25YeENsdEE
  iCn0.XW6uhdrkBgcGx6zVIrCiROpWURs-4goO1sKA4m9jhJIImiGg5muPUcN
  egx6sSv43c5DSn37sxCRrDZZm4ZPBKKgtYASMcE20SDgvYJdJS0cyuFw7Ijp
  _7WnIjcrl6B5cmoM6ylCvsLMwkoQAxVublMwH10oAxjzD6NEFsu9nipkszWh
  sPePf_rM4eMpkmCbTzume-fzZIi5VjdWGGEmzTg32h3jiex-r5WTHbj-u5HL
  7u_KP3rmbdYNzlzd1xWRYTUs4E8nOTgzAUwvwXkIQhOh5TPcSMBYy6X3E7-_
  gr9Ue6n4ND7hTFhtjYs3cjNKIA08qm5cpVYFMFMG6PkhzLQ
  &amp;state=af0ifjsldkj</pre>
</div>
<p>Verifying and decoding the ID Token will yield the following Claims:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;iss&quot;</span><span class="o">:</span> <span class="s2">&quot;http://server.example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;sub&quot;</span><span class="o">:</span> <span class="s2">&quot;248289761001&quot;</span><span class="p">,</span>
 <span class="s2">&quot;aud&quot;</span><span class="o">:</span> <span class="s2">&quot;s6BhdRkqt3&quot;</span><span class="p">,</span>
 <span class="s2">&quot;nonce&quot;</span><span class="o">:</span> <span class="s2">&quot;n-0S6_WzA2Mj&quot;</span><span class="p">,</span>
 <span class="s2">&quot;exp&quot;</span><span class="o">:</span> <span class="mi">1311281970</span><span class="p">,</span>
 <span class="s2">&quot;iat&quot;</span><span class="o">:</span> <span class="mi">1311280970</span><span class="p">,</span>
 <span class="s2">&quot;c_hash&quot;</span><span class="o">:</span> <span class="s2">&quot;LDktKdoQak3Pk0cnXxCltA&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="a-5-example-using-response-type-code-token">
<span id="core-appendix-a-5"></span><h3><a class="toc-backref" href="#id183">A.5.  Example using response_type=code token</a><a class="headerlink" href="#a-5-example-using-response-type-code-token" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>GET /authorize?
  response_type=code%20token
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid%20profile%20email
  &amp;nonce=n-0S6_WzA2Mj
  &amp;state=af0ifjsldkj HTTP/1.1
Host: server.example.com</pre>
</div>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.org/cb#
  code=Qcb0Orv1zh30vL1MPRsbm-diHiMwcLyZvn1arpZv-Jxf_11jnpEX3Tgfvk
  &amp;access_token=jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y
  &amp;token_type=Bearer
  &amp;state=af0ifjsldkj</pre>
</div>
<p>(draft17)</p>
</div>
<div class="section" id="a-6-example-using-response-type-code-id-token-token">
<span id="core-appendix-a-6"></span><h3><a class="toc-backref" href="#id184">A.6.  Example using response_type=code id_token token</a><a class="headerlink" href="#a-6-example-using-response-type-code-id-token-token" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>GET /authorize?
  response_type=code%20id_token%20token
  &amp;client_id=s6BhdRkqt3
  &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
  &amp;scope=openid%20profile%20email
  &amp;nonce=n-0S6_WzA2Mj
  &amp;state=af0ifjsldkj HTTP/1.1
Host: server.example.com</pre>
</div>
<div class="highlight-python"><pre>HTTP/1.1 302 Found
Location: https://client.example.org/cb#
  code=Qcb0Orv1zh30vL1MPRsbm-diHiMwcLyZvn1arpZv-Jxf_11jnpEX3Tgfvk
  &amp;access_token=jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y
  &amp;token_type=Bearer
  &amp;id_token=eyJraWQiOiIxZTlnZGs3IiwiYWxnIjoiUlMyNTYifQ.ewogIml
  zcyI6ICJodHRwOi8vc2VydmVyLmV4YW1wbGUuY29tIiwKICJzdWIiOiAiMjQ
  4Mjg5NzYxMDAxIiwKICJhdWQiOiAiczZCaGRSa3F0MyIsCiAibm9uY2UiOiA
  ibi0wUzZfV3pBMk1qIiwKICJleHAiOiAxMzExMjgxOTcwLAogImlhdCI6IDE
  zMTEyODA5NzAsCiAiY19oYXNoIjogIkxEa3RLZG9RYWszUGswY25YeENsdEE
  iCn0.XW6uhdrkBgcGx6zVIrCiROpWURs-4goO1sKA4m9jhJIImiGg5muPUcN
  egx6sSv43c5DSn37sxCRrDZZm4ZPBKKgtYASMcE20SDgvYJdJS0cyuFw7Ijp
  _7WnIjcrl6B5cmoM6ylCvsLMwkoQAxVublMwH10oAxjzD6NEFsu9nipkszWh
  sPePf_rM4eMpkmCbTzume-fzZIi5VjdWGGEmzTg32h3jiex-r5WTHbj-u5HL
  7u_KP3rmbdYNzlzd1xWRYTUs4E8nOTgzAUwvwXkIQhOh5TPcSMBYy6X3E7-_
  gr9Ue6n4ND7hTFhtjYs3cjNKIA08qm5cpVYFMFMG6PkhzLQ
  &amp;state=af0ifjsldkj</pre>
</div>
<p>Verifying and decoding the ID Token will yield the following Claims:</p>
<p>(draft17)</p>
</div>
<div class="section" id="a-7-rsa-key-used-in-examples">
<span id="core-appendix-a-7"></span><h3><a class="toc-backref" href="#id185">A.7.  RSA Key Used in Examples</a><a class="headerlink" href="#a-7-rsa-key-used-in-examples" title="Permalink to this headline">¶</a></h3>
<p>The following RSA public key, represented in JWK format, can be used to validate the ID Token signatures in the above examples (with line wraps within values for display purposes only):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;kty&quot;</span><span class="o">:</span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
 <span class="s2">&quot;kid&quot;</span><span class="o">:</span><span class="s2">&quot;1e9gdk7&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n&quot;</span><span class="o">:</span><span class="s2">&quot;w7Zdfmece8iaB0kiTY8pCtiBtzbptJmP28nSWwtdjRu0f2GFpajvWE4VhfJA</span>
<span class="s2">      jEsOcwYzay7XGN0b-X84BfC8hmCTOj2b2eHT7NsZegFPKRUQzJ9wW8ipn_aD</span>
<span class="s2">      JWMGDuB1XyqT1E7DYqjUCEOD1b4FLpy_xPn6oV_TYOfQ9fZdbE5HGxJUzeku</span>
<span class="s2">      GcOKqOQ8M7wfYHhHHLxGpQVgL0apWuP2gDDOdTtpuld4D2LK1MZK99s9gaSj</span>
<span class="s2">      RHE8JDb1Z4IGhEcEyzkxswVdPndUWzfvWBBWXWxtSUvQGBRkuy1BHOa4sP6F</span>
<span class="s2">      KjWEeeF7gm7UMs2Nm2QUgNZw6xvEDGaLk4KASdIxRQ&quot;</span><span class="p">,</span>
 <span class="s2">&quot;e&quot;</span><span class="o">:</span><span class="s2">&quot;AQAB&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft17)</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="openid_connect.html">OpenID Connect</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="reg.html">OpenID Connect Dynamic Client Registration 1.0</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, HDKNR.COM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>