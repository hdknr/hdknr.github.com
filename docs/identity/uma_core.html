
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>User-Managed Access (UMA) Profile of OAuth 2.0 : draft09 &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/basic.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.0.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/bootstrap-sphinx.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="Binding Obligations on User-Managed Access (UMA) Participants" href="uma_trust.html" />
    <link rel="prev" title="OpenID Connect Messages 1.0" href="messages.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">identity</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="oauth.html">RFC6759:The OAuth 2.0 Authorization Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_bearer.html">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_threat.html">Auth 2.0 Threat Model and Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_revocation.html">RFC7009:Token Revocation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_jwt_bearer.html">JSON Web Token (JWT) Bearer Token Profiles for OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_saml2_bearer.html">SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_assertion.html">Assertion Framework for OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_mac.html">HTTP Authentication: MAC Access Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_reg.html">OAuth Dynamic Client Registration Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_introspect.html">OAuth Token Introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_meta.html">JSON Metadata for OAuth Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_res_reg.html">OAuth 2.0 Resource Set Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth-lrdd.html">Link relation Type Registrations for OAuth 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_auth.html">OAuth 2.0 User Authentication and Consent For Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_responses.html">OAuth 2.0 Multiple Response Type Encoding Practices - draft 11</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_post.html">OAuth 2.0 Form Post Response Mode - draft 01</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_res.html">OAuth Resoure</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="openid_connect.html">OpenID Connect</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">OpenID Connect Core 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="reg.html">OpenID Connect Dynamic Client Registration 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="discovery.html">OpenID Connect Discovery 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="session.html">OpenID Connect Session Management 1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic.html">OpenID Connect Basic Client Profile 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="implicit.html">OpenID Connect Implicit Client Implementer&#8217;s Guide 1.0 - draft 14</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="standard.html">OpenID Connect Standard 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">OpenID Connect Messages 1.0</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">User-Managed Access (UMA) Profile of OAuth 2.0 : draft09</a></li>
<li class="toctree-l1"><a class="reference internal" href="uma_trust.html">Binding Obligations on User-Managed Access (UMA) Participants</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="jose.html">Terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwa.html">JSON Web Algorithms (JWA) : draft21</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwt.html">JSON Web Token (JWT) : draft19</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws.html">JSON Web Signature (JWS) : draft25</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws_hok.html">Holder-of-Key JSON Web Signature (JWS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwe.html">JSON Web Encryption (JWE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwk.html">JSON Web Key (JWK) : draft24</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws_js.html">JSON Web Signature JSON Serialization (JWS-JS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwe_js.html">JSON Web Encryption JSON Serialization (JWE-JS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jose_usecase.html">Use Cases and Requirements for JSON Object Signing and Encryption (JOSE)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hostmeta.html">Web Host Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="webfinger.html">WebFinger</a></li>
<li class="toctree-l1"><a class="reference internal" href="swd.html">Simple Web Discovery (SWD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="acct.html">The &#8216;acct&#8217; URI Scheme</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rfc3394.html">RFC3394:Advanced Encryption Standard (AES) Key Wrap Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="nist-sp-800-59a.html">NIST SP 800-56A:Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="nist-sp-800-63.html">Electronic Authentication Guideline</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="backplane.html">Backplane</a></li>
<li class="toctree-l1"><a class="reference internal" href="backplane.html#backplane-2-0">Backplane 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="lrdd.html">LRDD: Link-based Resource Descriptor Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="revoke.html">Token Revocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="poco.html">Portable Contacts 1.0 Draft C</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Terms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="saml.html">SAML</a></li>
<li class="toctree-l1"><a class="reference internal" href="xacml.html">XACML</a></li>
<li class="toctree-l1"><a class="reference internal" href="shibboleth.html">Shibboleth</a></li>
<li class="toctree-l1"><a class="reference internal" href="SamlHokProfile.html">SAML V2.0 Holder-of-Key Assertion Profile Version 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="SamlHokWebSsoProfile.html">SAML V2.0 Holder-of-Key Web Browser SSO Profile Version 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="wss_saml_token_profile.html">Web Services Security SAML Token Profile Version 1.1.1</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scim_rest.html">Simple Cloud Identity Management: Protocol 1.0 (REST API 1.0)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="active_directory.html">Active Directory &amp; Connect</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO/TBD</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource.html">Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion.html">Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="signed_nonce.html">Decoupling Identity and Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="adtech.html">AdTech</a></li>
<li class="toctree-l1"><a class="reference internal" href="technight_9.html">Technight #9</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="well-known.html">RFC5783: Defining Well-Known Uniform Resource Identifiers (URIs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rfc5988.html">RFC5988:Web Linking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="impl_id_token.html">ID Token:Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="impl_jws.html">JOSE JWS:Implementation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">User-Managed Access (UMA) Profile of OAuth 2.0 : draft09</a><ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#introduction">1.  Introduction</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#pat-api">リソース保護(PAT API)</a></li>
<li><a class="reference internal" href="#rpt">認可発行(RPT発行)</a></li>
<li><a class="reference internal" href="#id1">リソースアクセス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notational-conventions">1.1.  Notational Conventions</a></li>
<li><a class="reference internal" href="#terminology">1.2.  Terminology</a></li>
<li><a class="reference internal" href="#achieving-distributed-protection-through-apis-and-tokens">1.3.  Achieving Distributed Protection Through APIs and Tokens</a><ul>
<li><a class="reference internal" href="#protection-api">1.3.1.  Protection API</a></li>
<li><a class="reference internal" href="#authorization-api">1.3.2.  Authorization API</a></li>
<li><a class="reference internal" href="#protected-resource-interface">1.3.3.  Protected Resource Interface</a></li>
<li><a class="reference internal" href="#time-to-live-considerations">1.3.4.  Time-to-Live Considerations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authorization-server-configuration-data">1.4.  Authorization Server Configuration Data</a></li>
<li><a class="reference internal" href="#uma-core-1-5">1.5. Authorization Server Configuration Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#protecting-a-resource">2.  Protecting a Resource</a><ul>
<li><a class="reference internal" href="#resource-server-obtains-pat">2.1. Resource Server Obtains PAT</a></li>
<li><a class="reference internal" href="#resource-server-registers-sets-of-resources-to-be-protected">2.2. Resource Server Registers Sets of Resources to Be Protected</a></li>
<li><a class="reference internal" href="#host-obtains-protection-api-token">2.3.  Host Obtains Protection API Token</a></li>
<li><a class="reference internal" href="#host-registers-sets-of-resources-to-be-protected">2.4. Host Registers Sets of Resources to Be Protected</a><ul>
<li><a class="reference internal" href="#scope-descriptions">2.4.1. Scope Descriptions</a></li>
<li><a class="reference internal" href="#resource-set-descriptions">2.4.2. Resource Set Descriptions</a></li>
<li><a class="reference internal" href="#resource-set-registration-api">2.4.3. Resource Set Registration API</a><ul>
<li><a class="reference internal" href="#create-resource-set-description">2.4.3.1. Create Resource Set Description</a></li>
<li><a class="reference internal" href="#read-resource-set-description">2.4.3.2.  Read Resource Set Description</a></li>
<li><a class="reference internal" href="#update-resource-set-description">2.4.3.3.  Update Resource Set Description</a></li>
<li><a class="reference internal" href="#delete-resource-set-description">2.4.3.4.  Delete Resource Set Description</a></li>
<li><a class="reference internal" href="#list-resource-set-descriptions">2.4.3.5.  List Resource Set Descriptions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#getting-authorization-and-accessing-a-resource">3. Getting Authorization and Accessing a Resource</a><ul>
<li><a class="reference internal" href="#client-attempts-to-access-protected-resource">3.1.  Client Attempts to Access Protected Resource</a><ul>
<li><a class="reference internal" href="#client-presents-no-rpt">3.1.1.  Client Presents No RPT</a></li>
<li><a class="reference internal" href="#client-presents-rpt">3.1.2.  Client Presents RPT</a></li>
<li><a class="reference internal" href="#client-presents-a-valid-rpt-with-sufficient-authorization-data">3.1.3. Client Presents a Valid RPT with Sufficient Authorization Data</a><ul>
<li><a class="reference internal" href="#requester-s-token-has-insufficient-permission">3.1.3.1.  Requester&#8217;s Token Has Insufficient Permission</a></li>
<li><a class="reference internal" href="#requester-s-token-has-sufficient-permission">3.1.3.2.  Requester&#8217;s Token Has Sufficient Permission</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#resource-server-registers-requested-permission-with-authorization-server">3.2.  Resource Server Registers Requested Permission With Authorization Server</a></li>
<li><a class="reference internal" href="#resource-server-determines-rpt-s-status">3.3.  Resource Server Determines RPT&#8217;s Status</a><ul>
<li><a class="reference internal" href="#token-introspection">3.3.1.  Token Introspection</a></li>
<li><a class="reference internal" href="#rpt-profile-bearer">3.3.2.  RPT Profile: Bearer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#client-seeks-authorization-for-access">3.4.  Client Seeks Authorization for Access</a><ul>
<li><a class="reference internal" href="#client-obtains-rpt">3.4.1. Client Obtains RPT</a></li>
<li><a class="reference internal" href="#client-asks-for-authorization-data">3.4.2.  Client Asks for Authorization Data</a></li>
<li><a class="reference internal" href="#uma-core-3-4-3">3.4.3. Client Asks for Authorization Data</a></li>
<li><a class="reference internal" href="#requester-obtains-requester-permission-token">3.4.4.  Requester Obtains Requester Permission Token</a></li>
<li><a class="reference internal" href="#requester-asks-for-authorization-to-add-permission">3.4.5.  Requester Asks for Authorization to Add Permission</a></li>
</ul>
</li>
<li><a class="reference internal" href="#claims-gathering-flows">3.5. Claims-Gathering Flows</a></li>
<li><a class="reference internal" href="#authorization-flows">3.6.  Authorization Flows</a><ul>
<li><a class="reference internal" href="#authorization-flow-for-requester-apps-operated-by-end-users">3.6.1.  Authorization Flow for Requester Apps Operated by End-Users</a><ul>
<li><a class="reference internal" href="#gathering-claims-from-requesting-end-users-with-openid-connect">3.6.1.1.  Gathering Claims from Requesting End-Users with OpenID Connect</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#error-messages">4.  Error Messages</a><ul>
<li><a class="reference internal" href="#oauth-error-responses">4.1.  OAuth Error Responses</a></li>
<li><a class="reference internal" href="#uma-error-responses">4.2.  UMA Error Responses</a></li>
</ul>
</li>
<li><a class="reference internal" href="#profiles-for-api-extensibility">5.  Profiles for API Extensibility</a><ul>
<li><a class="reference internal" href="#protection-api-extensibility-profile">5.1.  Protection API Extensibility Profile</a></li>
<li><a class="reference internal" href="#authorization-api-extensibility-profile">5.2.  Authorization API Extensibility Profile</a></li>
<li><a class="reference internal" href="#resource-interface-extensibility-profile">5.3.  Resource Interface Extensibility Profile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specifying-additional-profiles">6.  Specifying Additional Profiles</a><ul>
<li><a class="reference internal" href="#specifying-profiles-of-uma">6.1.  Specifying Profiles of UMA</a></li>
<li><a class="reference internal" href="#specifying-rpt-profiles">6.2.  Specifying RPT Profiles</a></li>
<li><a class="reference internal" href="#specifying-claim-profiles">6.3.  Specifying Claim Profiles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations">7.  Security Considerations</a></li>
<li><a class="reference internal" href="#privacy-considerations">8.  Privacy Considerations</a></li>
<li><a class="reference internal" href="#conformance">9.  Conformance</a></li>
<li><a class="reference internal" href="#iana-considerations">10.  IANA Considerations</a></li>
<li><a class="reference internal" href="#acknowledgments">11.  Acknowledgments</a></li>
<li><a class="reference internal" href="#issues">12.  Issues</a><ul>
<li><a class="reference internal" href="#normative-references">12.1.  Normative References</a></li>
<li><a class="reference internal" href="#informative-references">12.2.  Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">13.  References</a><ul>
<li><a class="reference internal" href="#uma-core-13-1">13.1.  Normative References</a></li>
<li><a class="reference internal" href="#uma-core-13-2">13.2.  Informative References</a></li>
<li><a class="reference internal" href="#uris">13.3.  URIs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resource-set-descriptor-for-openid-connect">Resource Set Descriptor for OpenID Connect</a></li>
<li><a class="reference internal" href="#note-1-scopes-resource-sets-permissions-and-authorization">NOTE.1:  Scopes, Resource Sets, Permissions, and Authorization</a><ul>
<li><a class="reference internal" href="#id6">リソースセットとスコープタイプ</a></li>
<li><a class="reference internal" href="#id7">パーミッション</a></li>
</ul>
</li>
<li><a class="reference internal" href="#note-2-claims-gathering-flow-for-clients-operated-by-end-users">NOTE.2: Claims-Gathering Flow for Clients Operated by End-Users</a><ul>
<li><a class="reference internal" href="#openid-connect-claim-profile">OpenID Connect Claim Profile</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li><a href="messages.html"
         title="Previous Chapter: OpenID Connect Messages 1.0">&laquo; OpenID Connect M...</a></li>
  <li><a href="uma_trust.html"
         title="Next Chapter: Binding Obligations on User-Managed Access (UMA) Participants">Binding Obligati... &raquo;</a></li>
              
            
            
            
            
              <li>
<div id="sourcelink">
  <a href="sources/uma_core.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="user-managed-access-uma-profile-of-oauth-2-0-draft09">
<span id="uma-core-head"></span><h1>User-Managed Access (UMA) Profile of OAuth 2.0 : draft09<a class="headerlink" href="#user-managed-access-uma-profile-of-oauth-2-0-draft09" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Based on <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09</a></li>
</ul>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id8">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id9">1.  Introduction</a><ul>
<li><a class="reference internal" href="#overview" id="id10">Overview</a><ul>
<li><a class="reference internal" href="#pat-api" id="id11">リソース保護(PAT API)</a></li>
<li><a class="reference internal" href="#rpt" id="id12">認可発行(RPT発行)</a></li>
<li><a class="reference internal" href="#id1" id="id13">リソースアクセス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notational-conventions" id="id14">1.1.  Notational Conventions</a></li>
<li><a class="reference internal" href="#terminology" id="id15">1.2.  Terminology</a></li>
<li><a class="reference internal" href="#achieving-distributed-protection-through-apis-and-tokens" id="id16">1.3.  Achieving Distributed Protection Through APIs and Tokens</a><ul>
<li><a class="reference internal" href="#protection-api" id="id17">1.3.1.  Protection API</a></li>
<li><a class="reference internal" href="#authorization-api" id="id18">1.3.2.  Authorization API</a></li>
<li><a class="reference internal" href="#protected-resource-interface" id="id19">1.3.3.  Protected Resource Interface</a></li>
<li><a class="reference internal" href="#time-to-live-considerations" id="id20">1.3.4.  Time-to-Live Considerations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authorization-server-configuration-data" id="id21">1.4.  Authorization Server Configuration Data</a></li>
<li><a class="reference internal" href="#uma-core-1-5" id="id22">1.5. Authorization Server Configuration Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#protecting-a-resource" id="id23">2.  Protecting a Resource</a><ul>
<li><a class="reference internal" href="#resource-server-obtains-pat" id="id24">2.1. Resource Server Obtains PAT</a></li>
<li><a class="reference internal" href="#resource-server-registers-sets-of-resources-to-be-protected" id="id25">2.2. Resource Server Registers Sets of Resources to Be Protected</a></li>
<li><a class="reference internal" href="#host-obtains-protection-api-token" id="id26">2.3.  Host Obtains Protection API Token</a></li>
<li><a class="reference internal" href="#host-registers-sets-of-resources-to-be-protected" id="id27">2.4. Host Registers Sets of Resources to Be Protected</a><ul>
<li><a class="reference internal" href="#scope-descriptions" id="id28">2.4.1. Scope Descriptions</a></li>
<li><a class="reference internal" href="#resource-set-descriptions" id="id29">2.4.2. Resource Set Descriptions</a></li>
<li><a class="reference internal" href="#resource-set-registration-api" id="id30">2.4.3. Resource Set Registration API</a><ul>
<li><a class="reference internal" href="#create-resource-set-description" id="id31">2.4.3.1. Create Resource Set Description</a></li>
<li><a class="reference internal" href="#read-resource-set-description" id="id32">2.4.3.2.  Read Resource Set Description</a></li>
<li><a class="reference internal" href="#update-resource-set-description" id="id33">2.4.3.3.  Update Resource Set Description</a></li>
<li><a class="reference internal" href="#delete-resource-set-description" id="id34">2.4.3.4.  Delete Resource Set Description</a></li>
<li><a class="reference internal" href="#list-resource-set-descriptions" id="id35">2.4.3.5.  List Resource Set Descriptions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#getting-authorization-and-accessing-a-resource" id="id36">3. Getting Authorization and Accessing a Resource</a><ul>
<li><a class="reference internal" href="#client-attempts-to-access-protected-resource" id="id37">3.1.  Client Attempts to Access Protected Resource</a><ul>
<li><a class="reference internal" href="#client-presents-no-rpt" id="id38">3.1.1.  Client Presents No RPT</a></li>
<li><a class="reference internal" href="#client-presents-rpt" id="id39">3.1.2.  Client Presents RPT</a></li>
<li><a class="reference internal" href="#client-presents-a-valid-rpt-with-sufficient-authorization-data" id="id40">3.1.3. Client Presents a Valid RPT with Sufficient Authorization Data</a><ul>
<li><a class="reference internal" href="#requester-s-token-has-insufficient-permission" id="id41">3.1.3.1.  Requester&#8217;s Token Has Insufficient Permission</a></li>
<li><a class="reference internal" href="#requester-s-token-has-sufficient-permission" id="id42">3.1.3.2.  Requester&#8217;s Token Has Sufficient Permission</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#resource-server-registers-requested-permission-with-authorization-server" id="id43">3.2.  Resource Server Registers Requested Permission With Authorization Server</a></li>
<li><a class="reference internal" href="#resource-server-determines-rpt-s-status" id="id44">3.3.  Resource Server Determines RPT&#8217;s Status</a><ul>
<li><a class="reference internal" href="#token-introspection" id="id45">3.3.1.  Token Introspection</a></li>
<li><a class="reference internal" href="#rpt-profile-bearer" id="id46">3.3.2.  RPT Profile: Bearer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#client-seeks-authorization-for-access" id="id47">3.4.  Client Seeks Authorization for Access</a><ul>
<li><a class="reference internal" href="#client-obtains-rpt" id="id48">3.4.1. Client Obtains RPT</a></li>
<li><a class="reference internal" href="#client-asks-for-authorization-data" id="id49">3.4.2.  Client Asks for Authorization Data</a></li>
<li><a class="reference internal" href="#uma-core-3-4-3" id="id50">3.4.3. Client Asks for Authorization Data</a></li>
<li><a class="reference internal" href="#requester-obtains-requester-permission-token" id="id51">3.4.4.  Requester Obtains Requester Permission Token</a></li>
<li><a class="reference internal" href="#requester-asks-for-authorization-to-add-permission" id="id52">3.4.5.  Requester Asks for Authorization to Add Permission</a></li>
</ul>
</li>
<li><a class="reference internal" href="#claims-gathering-flows" id="id53">3.5. Claims-Gathering Flows</a></li>
<li><a class="reference internal" href="#authorization-flows" id="id54">3.6.  Authorization Flows</a><ul>
<li><a class="reference internal" href="#authorization-flow-for-requester-apps-operated-by-end-users" id="id55">3.6.1.  Authorization Flow for Requester Apps Operated by End-Users</a><ul>
<li><a class="reference internal" href="#gathering-claims-from-requesting-end-users-with-openid-connect" id="id56">3.6.1.1.  Gathering Claims from Requesting End-Users with OpenID Connect</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#error-messages" id="id57">4.  Error Messages</a><ul>
<li><a class="reference internal" href="#oauth-error-responses" id="id58">4.1.  OAuth Error Responses</a></li>
<li><a class="reference internal" href="#uma-error-responses" id="id59">4.2.  UMA Error Responses</a></li>
</ul>
</li>
<li><a class="reference internal" href="#profiles-for-api-extensibility" id="id60">5.  Profiles for API Extensibility</a><ul>
<li><a class="reference internal" href="#protection-api-extensibility-profile" id="id61">5.1.  Protection API Extensibility Profile</a></li>
<li><a class="reference internal" href="#authorization-api-extensibility-profile" id="id62">5.2.  Authorization API Extensibility Profile</a></li>
<li><a class="reference internal" href="#resource-interface-extensibility-profile" id="id63">5.3.  Resource Interface Extensibility Profile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specifying-additional-profiles" id="id64">6.  Specifying Additional Profiles</a><ul>
<li><a class="reference internal" href="#specifying-profiles-of-uma" id="id65">6.1.  Specifying Profiles of UMA</a></li>
<li><a class="reference internal" href="#specifying-rpt-profiles" id="id66">6.2.  Specifying RPT Profiles</a></li>
<li><a class="reference internal" href="#specifying-claim-profiles" id="id67">6.3.  Specifying Claim Profiles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations" id="id68">7.  Security Considerations</a></li>
<li><a class="reference internal" href="#privacy-considerations" id="id69">8.  Privacy Considerations</a></li>
<li><a class="reference internal" href="#conformance" id="id70">9.  Conformance</a></li>
<li><a class="reference internal" href="#iana-considerations" id="id71">10.  IANA Considerations</a></li>
<li><a class="reference internal" href="#acknowledgments" id="id72">11.  Acknowledgments</a></li>
<li><a class="reference internal" href="#issues" id="id73">12.  Issues</a><ul>
<li><a class="reference internal" href="#normative-references" id="id74">12.1.  Normative References</a></li>
<li><a class="reference internal" href="#informative-references" id="id75">12.2.  Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references" id="id76">13.  References</a><ul>
<li><a class="reference internal" href="#uma-core-13-1" id="id77">13.1.  Normative References</a></li>
<li><a class="reference internal" href="#uma-core-13-2" id="id78">13.2.  Informative References</a></li>
<li><a class="reference internal" href="#uris" id="id79">13.3.  URIs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resource-set-descriptor-for-openid-connect" id="id80">Resource Set Descriptor for OpenID Connect</a></li>
<li><a class="reference internal" href="#note-1-scopes-resource-sets-permissions-and-authorization" id="id81">NOTE.1:  Scopes, Resource Sets, Permissions, and Authorization</a><ul>
<li><a class="reference internal" href="#id6" id="id82">リソースセットとスコープタイプ</a></li>
<li><a class="reference internal" href="#id7" id="id83">パーミッション</a></li>
</ul>
</li>
<li><a class="reference internal" href="#note-2-claims-gathering-flow-for-clients-operated-by-end-users" id="id84">NOTE.2: Claims-Gathering Flow for Clients Operated by End-Users</a><ul>
<li><a class="reference internal" href="#openid-connect-claim-profile" id="id85">OpenID Connect Claim Profile</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="abstract">
<span id="uma-core-abstract"></span><h2><a class="toc-backref" href="#id8">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>User-Managed Access (UMA) is a profile of OAuth 2.0.</p>
<p>UMA defines how <em class="xref std std-ref">resource owners</em> can control <em class="xref std std-term">protected-resource access</em>
by <a class="reference internal" href="oauth.html#term-clients"><em class="xref std std-term">clients</em></a> operated by arbitrary <a class="reference internal" href="glossary.html#term-requesting-parties"><em class="xref std std-term">requesting parties</em></a>,
where the resources reside on any number of <a class="reference internal" href="oauth.html#term-resource-servers"><em class="xref std std-term">resource servers</em></a>,
and where a centralized <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> governs access
based on <a class="reference internal" href="#term-resource-owner"><em class="xref std std-term">resource owner</em></a> policy.Met at advisory in Feb 2014.</p>
<p>(draft09)</p>
</div>
<div class="section" id="introduction">
<span id="uma-core-1"></span><h2><a class="toc-backref" href="#id9">1.  Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>User-Managed Access (UMA) is a profile of OAuth 2.0 [OAuth2].</p>
<p>UMA defines how <a class="reference internal" href="oauth.html#term-resource-owners"><em class="xref std std-term">resource owners</em></a> can control protected-resource access
by clients operated by arbitrary requesting parties,
where the resources reside on any number of resource servers,
and where a centralized authorization server governs access
based on resource owner policy.
<a class="reference internal" href="oauth.html#term-resource-owners"><em class="xref std std-term">Resource owners</em></a> configure authorization servers with access policies
that serve as implicit authorization grants.
Thus, the UMA profile of OAuth can be considered to encompass an authorization grant flow.</p>
<p>UMA serves numerous use cases where a <a class="reference internal" href="#term-resource-owner"><em class="xref std std-term">resource owner</em></a> outsources
authorization for access to their resources,
potentially even without the run-time presence of the <a class="reference internal" href="#term-resource-owner"><em class="xref std std-term">resource owner</em></a>.
A typical example is the following:
a web user (an end-user resource owner) can authorize a web app (client)
to gain one-time or ongoing access to a protected resource
containing his home address stored at a &#8220;personal data store&#8221; service
(resource server),
by telling the resource server to respect access entitlements
issued by his chosen cloud-based authorization service (authorization server).
The requesting party operating the client might be the resource owner himself,
using a web or native app run by an e-commerce company that needs to know where
to ship a purchased item,
or it might be his friend who is using an online address book service
to collect contact information,
or it might be a survey company that uses an autonomous web service to
compile population demographics.
A variety of scenarios and use cases can be found in <a class="reference internal" href="#term-105"><em class="xref std std-term">[UMA-usecases]</em></a>
and <a class="reference internal" href="#term-104"><em class="xref std std-term">[UMA-casestudies]</em></a>.</p>
<p>Practical control of access among loosely coupled parties requires
more than just messaging protocols.
This specification defines only the technical &#8220;contract&#8221;
between UMA-conforming entities;
its companion <em class="xref std std-term">Binding Obligations specification</em> <a class="reference internal" href="#term-97"><em class="xref std std-term">[UMA-obligations]</em></a> defines
the expected behaviors of parties operating and using these entities.
Parties operating entities that claim to be UMA-conforming MUST
provide documentation affirmatively stating their acceptance of the
binding obligations contractual framework defined
in the Binding Obligations specification.</p>
<p>In enterprise settings,
application access management sometimes
involves letting back-office applications serve only as policy
enforcement points (PEPs),
depending entirely on access decisions coming from a central policy decision point (PDP)
to govern the access they give to requesters.
This separation eases auditing and allows policy administration
to scale in several dimensions.
UMA makes use of a separation similar to this,
letting the resource owner serve as a policy administrator
crafting authorization strategies for resources under their control.</p>
<p>In order to increase interoperable communication among the
authorization server, resource server, and client, UMA defines
several purpose-built APIs related to the outsourcing of
authorization, themselves protected by OAuth in embedded fashion.</p>
<div class="section" id="overview">
<h3><a class="toc-backref" href="#id10">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The UMA protocol has three broad phases, as shown in Figure 1.</p>
<div class="highlight-python"><pre>The Three Phases of the UMA Profile of OAuth
                                        +--------------+
                                        |   resource   |
       +---------manage (A)------------ |     owner    |
       |                                +--------------+
       |         Phase 1:                      |
       |         protect a                control (B)
       |         resource                      |
       v                                       v
+------------+               +----------+--------------+
|            |               |protection|              |
|  resource  |               |   API    | authorization|
|   server   |&lt;-protect (C)--|  (needs  |    server    |
|            |               |   PAT)   |              |
+------------+               +----------+--------------+
| protected  |                          | authorization|
| resource   |                          |     API      |
|(needs RPT) |                          |  (needs AAT) |
+------------+                          +--------------+
       ^                                       |
       |         Phases 2 and 3:         authorize (D)
       |         get authorization,            |
       |         access a resource             v
       |                                +--------------+
       +---------access (E)-------------|    client    |
                                        +--------------+

                                        requesting party

                           Figure 1</pre>
</div>
<p>The 1phases are as follows:</p>
<div class="section" id="pat-api">
<h4><a class="toc-backref" href="#id11">リソース保護(PAT API)</a><a class="headerlink" href="#pat-api" title="Permalink to this headline">¶</a></h4>
<p>Protect a resource  (Described in <a class="reference internal" href="#uma-core-2"><em>Section 2</em></a>.)</p>
<p>The <a class="reference internal" href="#term-resource-owner"><em class="xref std std-term">resource owner</em></a>, who manages online resources
at the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> (&#8220;A&#8221;),
introduces it to the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>
so that the latter can begin controlling the resources&#8217; protection.</p>
<p>To accomplish this protection,
the authorization server presents a protection API (&#8220;C&#8221;) to the resource server.</p>
<p>Out of band,
the resource owner configures the authorization server
with <a class="reference internal" href="glossary.html#term-policies"><em class="xref std std-term">policies</em></a> associated with the <em class="xref std std-term">registered resource sets</em> (&#8220;B&#8221;).</p>
</div>
<div class="section" id="rpt">
<h4><a class="toc-backref" href="#id12">認可発行(RPT発行)</a><a class="headerlink" href="#rpt" title="Permalink to this headline">¶</a></h4>
<p>Get authorization  (Described in <a class="reference internal" href="#uma-core-3"><em>Section 3</em></a>.)</p>
<p>The <a class="reference internal" href="#term-client"><em class="xref std std-term">client</em></a> approaches the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>
seeking access to an UMA-protected resource.</p>
<p>In order to access it successfully,
the client must first use the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>&#8216;s
<a class="reference internal" href="glossary.html#term-authorization-api"><em class="xref std std-term">authorization API</em></a> (&#8220;D&#8221;) to obtain a <em class="xref std std-term">requesting party token</em> (<em class="xref std std-term">RPT</em>)
on behalf of its <a class="reference internal" href="#term-requesting-party"><em class="xref std std-term">requesting party</em></a>,
and the <a class="reference internal" href="#term-requesting-party"><em class="xref std std-term">requesting party</em></a> must supply to the authorization server
any <em class="xref std std-term">identity claims</em> needed in order for
the server to associate sufficient <a class="reference internal" href="#term-authorization-data"><em class="xref std std-term">authorization data</em></a> with that RPT.</p>
<p>The API consists of an <em class="xref std std-term">RPT issuance endpoint</em>
and an <em class="xref std std-term">authorization request endpoint</em>.</p>
</div>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id13">リソースアクセス</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Access a resource  (Described along with Phase 2 in <a class="reference internal" href="#uma-core-3"><em>Section 3</em></a>.)</p>
<p>The client successfully presents an RPT
that has sufficient <a class="reference internal" href="#term-authorization-data"><em class="xref std std-term">authorization data</em></a> associated with it to the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>,
gaining access to the desired resource (&#8220;E&#8221;).</p>
<p>In this sense,
this phase is the &#8220;happy path&#8221; within phase 2.</p>
<p>The nature of the authorization data varies according to the RPT profile in use.</p>
<p>Implementers have the oportunity to develop profiles
(see <a class="reference internal" href="#uma-core-6"><em>Section 6</em></a>) that
specify and restrict various UMA protocol, RPT,
and identity claim options,
according to deployment and usage conditions.</p>
<p>( draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-1</a> )</p>
</div>
</div>
<div class="section" id="notational-conventions">
<span id="uma-core-1-1"></span><h3><a class="toc-backref" href="#id14">1.1.  Notational Conventions</a><a class="headerlink" href="#notational-conventions" title="Permalink to this headline">¶</a></h3>
<p>The key words &#8216;MUST&#8217;, &#8216;MUST NOT&#8217;, &#8216;REQUIRED&#8217;, &#8216;SHALL&#8217;, &#8216;SHALL NOT&#8217;,
&#8216;SHOULD&#8217;, &#8216;SHOULD NOT&#8217;, &#8216;RECOMMENDED&#8217;, &#8216;MAY&#8217;, and &#8216;OPTIONAL&#8217; in this
document are to be interpreted as described in [RFC2119].</p>
<p>Unless otherwise noted, all the protocol properties and values are
case sensitive.</p>
<p>( draft 06 <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.1</a> )</p>
</div>
<div class="section" id="terminology">
<span id="uma-core-1-2"></span><h3><a class="toc-backref" href="#id15">1.2.  Terminology</a><a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<p>UMA introduces the following new terms and enhancements of OAuth term definitions.</p>
<dl class="glossary docutils">
<dt id="term-resource-owner">resource owner</dt>
<dd>An OAuth resource that is the &#8220;user&#8221; in User-Managed Access.
This is typically an end-user (a natural person) but it can
also be a corporation or other legal person.</dd>
<dt id="term-requesting-party">requesting party</dt>
<dd>An end-user, or a corporation or other legal person, that uses
a client to seek access to a protected resource.  The
requesting party may or may not be the same party as the
resource owner.</dd>
<dt id="term-client">client</dt>
<dd>An application making protected resource requests with the
resource owner&#8217;s authorization and on the requesting party&#8217;s
behalf.</dd>
<dt id="term-claim">claim</dt>
<dd>A statement of the value or values of one or more identity
attributes of a requesting party.  A requesting party may need
to provide claims to an authorization server in order to
satisfy policy and gain permission for access to a protected
resource.</dd>
<dt id="term-resource-set">resource set</dt>
<dd><p class="first">A set of one or more protected resources.</p>
<p class="last">In authorization policy terminology,
a resource set is the &#8220;object&#8221; being protected.</p>
</dd>
<dt id="term-scope">scope</dt>
<dd>A bounded extent of access that is possible to perform on a
resource set.  In authorization policy terminology, a scope is
one of the potentially many &#8220;verbs&#8221; that can logically apply to
a resource set (&#8220;object&#8221;).  UMA associates scopes with labeled
resource sets.</dd>
<dt id="term-authorization-data">authorization data</dt>
<dd>Data associated with a requesting party token
that enables some combination of the authorization server and
resource server to determine the correct extent of access to
allow to a client.  Authorization data is a key part of the
definition of an RPT profile.</dd>
<dt id="term-permission">permission</dt>
<dd>A scope of access over a particular resource set at a
particular resource server that is being requested by, or
granted to, a requesting party.  In authorization policy
terminology, a permission is an entitlement that includes a
&#8220;subject&#8221; (requesting party), &#8220;verbs&#8221; (one or more scopes of
access), and an &#8220;object&#8221; (resource set).  A permission is one
example of authorization data that an authorization server may
issue.</dd>
<dt id="term-permission-ticket">permission ticket</dt>
<dd>A correlation handle that is conveyed from an
authorization server to a resource server, from a resource
server to a client, and ultimately from a client to an
authorization server, to enable the authorization server to
assess the correct resource owner policies to apply to a
request for an authorization grant.</dd>
</dl>
<p>( draft 7, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07#section-1.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07#section-1.2</a> )</p>
</div>
<div class="section" id="achieving-distributed-protection-through-apis-and-tokens">
<span id="uma-core-1-3"></span><h3><a class="toc-backref" href="#id16">1.3.  Achieving Distributed Protection Through APIs and Tokens</a><a class="headerlink" href="#achieving-distributed-protection-through-apis-and-tokens" title="Permalink to this headline">¶</a></h3>
<p>UMA&#8217;s <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>, <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>,
and <a class="reference internal" href="#term-client"><em class="xref std std-term">client</em></a> roles are designed to work
in an interoperable fashion
when each is operated by an entirely separate party
(for example, different organizations).</p>
<p>For this reason,
UMA specifies communications channels that the
authorization server MUST implement as HTTP-based APIs
that MUST use TLS and OAuth protection,
and that the resource server MUST implement as an HTTP-based interface.</p>
<p>UMA&#8217;s use of TLS transport-layer security is governed
by <a class="reference internal" href="oauth.html#oauth-1-6"><em>Section 1.6</em></a> of <a class="reference internal" href="#term-93"><em class="xref std std-term">[OAuth2]</em></a>,
which discusses deployment
and adoption characteristics of different TLS versions.</p>
<p>Three different types of access tokens are issued
and used for a variety of purposes as part of these inter-role interactions.</p>
<p>It is also REQUIRED, in turn, for resource servers and clients
on the requesting side of UMA interactions
to use these channels,
unless a profile is being used that enables API extensibility.</p>
<p>Profiles that enable such alternatives are described in <a class="reference internal" href="#uma-core-5"><em>Section 5</em></a>.</p>
<p>(draft09)</p>
<div class="section" id="protection-api">
<span id="uma-core-1-3-1"></span><h4><a class="toc-backref" href="#id17">1.3.1.  Protection API</a><a class="headerlink" href="#protection-api" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple">
<li>リソースセット登録</li>
<li>クライアント要求パーミッション登録</li>
<li>トークンイントロスペクション</li>
</ol>
</div>
<p>The authorization server MUST present an TLS- and OAuth-protected,
HTTP-based protection API for use by resource servers.</p>
<p>The authorization server thus has an OAuth token endpoint
and user authorization endpoint,
and has the option to issue an OAuth refresh token along
with any access tokens issued for these APIs.</p>
<p>The authorization server MUST declare
all of its protection API endpoints
in its configuration data (see <a class="reference internal" href="#uma-core-1-4"><em>Section 1.4</em></a>).</p>
<p>The protection API consists of three endpoints:</p>
<ul class="simple">
<li>OAuth <a class="reference internal" href="oauth_res_reg.html#term-resource-set-registration-endpoint"><em class="xref std std-term">resource set registration endpoint</em></a>
as defined by [OAuth-resource-reg]</li>
<li>Endpoint for <em class="xref std std-ref">registering client-requested permissions</em></li>
<li>OAuth token introspection endpoint
as defined by <a class="reference internal" href="#term-90"><em class="xref std std-term">[OAuth-introspection]</em></a>
and <a class="reference internal" href="#uma-core-3-3-1"><em>Section 3.3.1</em></a></li>
</ul>
<p>An entity seeking protection API access
MUST have the scope &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221;.</p>
<p>(This URI resolves to a JSON-encoded scope description,
as defined in <a class="reference internal" href="#term-91"><em class="xref std std-term">[OAuth-resource-reg]</em></a>.</p>
<p>The description is non-normative for UMA purposes.)</p>
<p>An access token with at least this scope is called
a <em class="xref std std-term">protection API token</em> (<em class="xref std std-term">PAT</em>)
and an entity with this scope is definitionally a resource server.</p>
<p>A single entity can serve in both resource server and client roles
if it has the appropriate OAuth scopes.</p>
<p>If a request to an endpoint fails due to an invalid,
missing, or expired PAT, or requires higher privileges
at this endpoint than provided by the PAT,
the authorization server responds with an OAuth error.</p>
<p>The authorization server MUST support the <em class="xref std std-term">OAuth bearer token profile</em>
for PAT issuance,
and MAY support other OAuth token profiles
(for example,
the SAML bearer token grant type <a class="reference internal" href="#term-100"><em class="xref std std-term">[OAuth-SAML]</em></a>).</p>
<p>It MUST declare all supported token profiles
and grant types for PAT issuance in its configuration data.</p>
<p>A PAT binds a resource owner,
a resource server the owner uses for resource management,
and an authorization server the owner uses
for protection of resources at this resource server.</p>
<p>It is not specific to any client or requesting party.</p>
<p>The issuance of a PAT represents the approval of the resource owner
for this resource server to trust this authorization server
for protecting its resources belonging to this resource owner.</p>
<p>(draft09)</p>
</div>
<div class="section" id="authorization-api">
<span id="uma-core-1-3-2"></span><h4><a class="toc-backref" href="#id18">1.3.2.  Authorization API</a><a class="headerlink" href="#authorization-api" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple">
<li>RPTの発行</li>
<li>認可要求</li>
</ol>
</div>
<p>The authorization server MUST present an TLS- and OAuth-protected,
HTTP-based authorization API for use by clients.</p>
<p>The authorization server thus has an OAuth token endpoint
and user authorization endpoint,
and has the option to issue an OAuth refresh token
along with any access tokens issued for these APIs.</p>
<p>The authorization server MUST declare
all of its authorization API endpoints
in its configuration data (see <a class="reference internal" href="#uma-core-1-4"><em>Section 1.4</em></a>).</p>
<p>The authorization API consists of two endpoints:</p>
<ul class="simple">
<li>Endpoint for RPT issuance</li>
<li>Endpoint for requesting authorization</li>
</ul>
<p>An entity seeking authorization API access MUST have
the scope &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authz.json">http://docs.kantarainitiative.org/uma/scopes/authz.json</a>&#8221;.</p>
<p>(This URI resolves to a JSON-encoded scope description,
as defined in <a class="reference internal" href="#term-91"><em class="xref std std-term">[OAuth-resource-reg]</em></a>.</p>
<p>The description is non-normative for UMA purposes.)</p>
<p>An access token with at least this scope
is called an <em class="xref std std-ref">authorization API token</em> (<em class="xref std std-term">AAT</em>)
and an entity with this scope is definitionally a client.</p>
<p>A single entity can serve in both resource server and client roles
if it has the appropriate OAuth scopes.</p>
<p>If a request to an endpoint fails
due to an invalid, missing, or expired AAT,
or requires higher privileges at this endpoint than provided by the AAT,
the authorization server responds with an OAuth error.</p>
<p>The authorization server MUST support the OAuth bearer token profile
for AAT issuance,
and MAY support other OAuth token profiles
(for example,
the SAML bearer token grant type <a class="reference internal" href="#term-100"><em class="xref std std-term">[OAuth-SAML]</em></a>).</p>
<p>It MUST declare all supported token profiles
and grant types for AAT issuance in its configuration data.</p>
<p>An AAT binds a requesting party,
a client being used by that party,
and an authorization server that protects resources
this client is seeking access to on this requesting party&#8217;s behalf.</p>
<p>It is not specific to any resource server or resource owner.</p>
<p>The issuance of an AAT represents the approval of this requesting party
for this client to engage with this authorization server
to supply claims,
ask for authorization,
and perform any other tasks needed
for obtaining authorization for access to resources
at all resource servers that use this authorization server.</p>
<p>The authorization server is able to manage future processes
of authorization and claims-caching efficiently
for this client/requesting party pair across all resource servers
they try to access;
however,
these management processes are outside the scope of this specification.</p>
<p>(drart09)</p>
</div>
<div class="section" id="protected-resource-interface">
<span id="uma-core-1-3-3"></span><h4><a class="toc-backref" href="#id19">1.3.3.  Protected Resource Interface</a><a class="headerlink" href="#protected-resource-interface" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> MAY present
to clients whatever HTTP-based APIs or endpoints it wishes.</p>
<p>To protect any of its resources available
in this fashion using UMA,
it MUST require a <em class="xref std std-term">requesting party token</em>
(RPT) with sufficient authorization data for access.</p>
<p>This specification defines one RPT profile,
call &#8220;bearer&#8221; (see <a class="reference internal" href="#uma-core-3-3-2"><em>Section 3.3.2</em></a>),
which the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> MUST support.</p>
<p>It MAY support additional RPT profiles,
and MUST declare all supported RPT profiles
in its configuration data (see <a class="reference internal" href="#uma-core-1-4"><em>Section 1.4</em></a>).</p>
<p>An RPT binds a <a class="reference internal" href="#term-requesting-party"><em class="xref std std-term">requesting party</em></a>,
the <a class="reference internal" href="#term-client"><em class="xref std std-term">client</em></a> being used by that party,
the resource server at which <a class="reference internal" href="glossary.html#term-protected-resources"><em class="xref std std-term">protected resources</em></a>
of interest reside,
and the authorization server that protects those resources.</p>
<p>It is not specific to a single resource owner,
though its internal components are likely
to be bound to individual resource owners,
depending on the RPT profile in use.</p>
<p>(draft09)</p>
</div>
<div class="section" id="time-to-live-considerations">
<span id="uma-core-1-3-4"></span><h4><a class="toc-backref" href="#id20">1.3.4.  Time-to-Live Considerations</a><a class="headerlink" href="#time-to-live-considerations" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>アクセストークンのTTL</li>
</ul>
</div>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> has
the opportunity to manage the validity periods of <a class="reference internal" href="glossary.html#term-access-tokens"><em class="xref std std-term">access tokens</em></a>
that it issues,
their corresponding <a class="reference internal" href="glossary.html#term-refresh-tokens"><em class="xref std std-term">refresh tokens</em></a> where applicable,
the individual data components associated
with RPTs where applicable,
and even the client credentials that it issues.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>リソースオーナーがTTLをコントロールできるようにすべき</li>
</ul>
</div>
<p>Different <strong>time-to-live</strong> strategies may be suitable for
different resources and scopes of access,
and the authorization server has the opportunity
to give the resource owner
control over lifetimes of tokens and <a class="reference internal" href="#term-authorization-data"><em class="xref std std-term">authorization data</em></a>
issued on their behalf through policy.</p>
<p>These options are all outside the scope of this specification.</p>
<p>(draft09)</p>
</div>
</div>
<div class="section" id="authorization-server-configuration-data">
<span id="uma-core-1-4"></span><h3><a class="toc-backref" href="#id21">1.4.  Authorization Server Configuration Data</a><a class="headerlink" href="#authorization-server-configuration-data" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>openid-configurationみたいなもの</li>
</ul>
</div>
<p>The authorization server MUST provide configuration data
in a JSON [RFC4627] document
that resides in an <strong>/uma-configuration</strong> directory
at at its <a class="reference internal" href="glossary.html#term-hostmeta"><em class="xref std std-term">hostmeta</em></a> <a class="reference internal" href="#term-hostmeta"><em class="xref std std-term">[hostmeta]</em></a> location.</p>
<p>The configuration data documents conformance options
and endpoints supported by the authorization server.</p>
<p>(At the appropriate time, this section will instead profile
whatever self-describing metadata specification OAuth adopts,
for example, <a class="reference internal" href="#term-101"><em class="xref std std-term">[OAuth-linktypes]</em></a> or <a class="reference internal" href="#term-102"><em class="xref std std-term">[OAuth-meta]</em></a>.)</p>
<p>The configuration data has the following properties.</p>
<dl class="glossary docutils">
<dt id="term-version">version</dt>
<dd>REQUIRED.  The version of the UMA core protocol to which this
authorization server conforms.  The value MUST be the string
&#8220;1.0&#8221;.</dd>
<dt id="term-issuer">issuer</dt>
<dd>REQUIRED.  A URI indicating the party operating the
authorization server.</dd>
<dt id="term-pat-profiles-supported">pat_profiles_supported</dt>
<dd>REQUIRED.  OAuth access token profiles supported by this
authorization server for PAT issuance.  The property value is
an array of string values, where each string value is either a
reserved keyword defined in this specification or a URI
identifying an access token profile defined elsewhere.  The
reserved keyword &#8220;bearer&#8221; as a value for this property stands
for the OAuth bearer token profile [OAuth-bearer].  The
authorization server is REQUIRED to support this profile, and
to supply this string value explicitly.  The authorization
server MAY declare its support for additional access token
profiles for PATs.</dd>
<dt id="term-aat-profiles-supported">aat_profiles_supported</dt>
<dd>REQUIRED.  OAuth access token profiles supported by this
authorization server for AAT issuance.  The property value is
an array of string values, where each string value is either a
reserved keyword defined in this specification or a URI
identifying an access token profile defined elsewhere.  The
reserved keyword &#8220;bearer&#8221; as a value for this property stands
for the OAuth bearer token profile [OAuth-bearer].  The
authorization server is REQUIRED to support this profile, and
to supply this string value explicitly.  The authorization
server MAY declare its support for additional access token
profiles for AATs.</dd>
<dt id="term-rpt-profiles-supported">rpt_profiles_supported</dt>
<dd>REQUIRED.  UMA RPT profiles supported by this authorization
server for RPT issuance.  The property value is an array of
string values, where each string value is either a reserved
keyword defined in this specification or a URI identifying an
RPT profile defined elsewhere.  The reserved keyword &#8220;bearer&#8221;
as a value for this property stands for the UMA bearer RPT
profile defined in [OAuth-bearer].  The authorization server is
REQUIRED to support this profile, and to supply this string
value explicitly.  The authorization server MAY declare its
support for additional RPT profiles.</dd>
<dt id="term-pat-grant-types-supported">pat_grant_types_supported</dt>
<dd>REQUIRED.  OAuth grant types supported by this authorization
server in issuing PATs.  The property value is an array of
string values.  Each string value MUST be one of the grant_type
values defined in [OAuth2], or alternatively a URI identifying
a grant type defined elsewhere.</dd>
<dt id="term-aat-grant-types-supported">aat_grant_types_supported</dt>
<dd>REQUIRED.  OAuth grant types supported by this authorization
server in issuing AATs.  The property value is an array of
string values.  Each string value MUST be one of the grant_type
values defined in [OAuth2], or alternatively a URI identifying
a grant type defined elsewhere.</dd>
<dt id="term-claim-profiles-supported">claim_profiles_supported</dt>
<dd>OPTIONAL.  Claim formats and associated sub-protocols for
gathering claims from requesting parties, as supported by this
authorization server.  The property value is an array of string
values, which each string value is either a reserved keyword
defined in this specification or a URI identifying a claim
profile defined elsewhere.</dd>
<dt id="term-uma-profiles-supported">uma_profiles_supported</dt>
<dd>OPTIONAL.  UMA profiles supported by this authorization server.
The property value is an array of string values, which each
string value is either a reserved keyword defined in this
specification or a URI identifying an UMA profile defined
elsewhere.  The reserved keywords &#8220;prot-ext&#8221;, &#8220;authz-ext&#8221;, and
&#8220;rsrc-ext&#8221; as values for this property stand for the
extensibility profiles defined, respectively, in Section 5.</dd>
<dt id="term-dynamic-client-endpoint">dynamic_client_endpoint</dt>
<dd>OPTIONAL.  The endpoint to use for performing dynamic client
registration.  Usage of this endpoint is defined by
[DynClientReg].  The presence of this property indicates
authorization server support for the dynamic client
registration feature and its absence indicates a lack of
support.</dd>
<dt id="term-token-endpoint">token_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server or
client asks the authorization server for a PAT or AAT,
respectively.  A requested scope of &#8220;<a class="reference external" href="http://">http://</a>
docs.kantarainitiative.org/uma/scopes/prot.json&#8221; results in a
PAT.  A requested scope of &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/">http://docs.kantarainitiative.org/</a>
uma/scopes/authz.json&#8221; results in an AAT.  Usage of this
endpoint is defined by [OAuth2].</dd>
<dt id="term-user-endpoint">user_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
gathers the consent of the end-user resource owner or the
client gathers the consent of the end-user requesting party, if
the &#8220;authorization_code&#8221; grant type is used.  Usage of this
endpoint is defined by [OAuth2].</dd>
<dt id="term-introspection-endpoint">introspection_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
introspects an RPT presented to it by a client.  Usage of this
endpoint is defined by [OAuth-introspection] and Section 3.3.1.
A valid PAT MUST accompany requests to this protected endpoint.</dd>
<dt id="term-resource-set-registration-endpoint">resource_set_registration_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
registers resource sets to put them under authorization manager
protection.  Usage of this endpoint is defined by
[OAuth-resource-reg] and Section 2.  A valid PAT MUST accompany
requests to this protected endpoint.</dd>
<dt id="term-permission-registration-endpoint">permission_registration_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
registers a client-requested permission with the authorization
server.  Usage of this endpoint is defined by Section 3.2.  A
valid PAT MUST accompany requests to this protected endpoint.</dd>
<dt id="term-rpt-endpoint">rpt_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the client asks the
authorization server for an RPT.  Usage of this endpoint is
defined by Section 3.4.1.  A valid AAT MUST accompany requests
to this protected endpoint.</dd>
<dt id="term-authorization-request-endpoint">authorization_request_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the client asks to have
authorization data associated with its RPT.  Usage of this
endpoint is defined in Section 3.4.2.  A valid AAT MUST
accompany requests to this protected endpoint.</dd>
</dl>
<p>Example of authorization server configuration data
that resides at <a class="reference external" href="https://example.com/.well-known/uma-configuration">https://example.com/.well-known/uma-configuration</a>
(note the use of https: for endpoints throughout):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
<span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="s2">&quot;issuer&quot;</span><span class="o">:</span><span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
<span class="s2">&quot;pat_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;bearer&quot;</span><span class="p">],</span>
<span class="s2">&quot;aat_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;bearer&quot;</span><span class="p">],</span>
<span class="s2">&quot;rpt_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;bearer&quot;</span><span class="p">],</span>
<span class="s2">&quot;pat_grant_types_supported&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;authorization_code&quot;</span><span class="p">],</span>
<span class="s2">&quot;aat_grant_types_supported&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;authorization_code&quot;</span><span class="p">],</span>
<span class="s2">&quot;claim_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;openid&quot;</span><span class="p">],</span>
<span class="s2">&quot;dynamic_client_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/dyn_client_reg_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;token_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/token_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;user_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/user_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;resource_set_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/rsrc_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;introspection_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/status_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;permission_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/perm_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;rpt_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/client/rpt_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;authorization_request_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/client/perm_uri&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Authorization server configuration data MAY contain
extension properties that are not defined in this specification.</p>
<p>Extension names that are unprotected from collisions are
outside the scope of this specification.</p>
<p>(draft09)</p>
</div>
<div class="section" id="uma-core-1-5">
<span id="id2"></span><h3><a class="toc-backref" href="#id22">1.5. Authorization Server Configuration Data</a><a class="headerlink" href="#uma-core-1-5" title="Permalink to this headline">¶</a></h3>
<p>The authorization server MUST provide configuration data to other
entities it interacts with in aJSON [RFC4627] document that resides
in an /uma-configuration directory at at its hostmeta [RFC6415]
location.</p>
<p>The configuration data documents major conformance options
supported by the authorization server
(described further in <a class="reference internal" href="#uma-core-8"><em>Section 8</em></a>)
and protection and authorization API endpoints (as described in <a class="reference internal" href="#uma-core-1-3"><em>Section 1.3</em></a>).
(At the appropriate time, this section will instead profile
whatever self-describing metadata specification OAuth adopts,
for example, <a class="reference internal" href="#term-101"><em class="xref std std-term">[OAuth-linktypes]</em></a> or <a class="reference internal" href="#term-102"><em class="xref std std-term">[OAuth-meta]</em></a>.)</p>
<p>The configuration data has the following properties.
All endpoint URIs supplied SHOULD require the use of
a transport-layer security mechanism such as TLS.</p>
<dl class="glossary docutils">
<dt id="term-26">version</dt>
<dd>REQUIRED.  The version of the UMA core protocol to which this
authorization server conforms.  The value MUST be the string
&#8220;1.0&#8221;.</dd>
<dt id="term-27">issuer</dt>
<dd>REQUIRED.  A URI indicating the party operating the
authorization server.</dd>
<dt id="term-28">dynamic_client_endpoint</dt>
<dd>OPTIONAL.  The endpoint to use for performing dynamic client
registration through . [DynClientReg]</dd>
<dt id="term-oauth-token-profiles-supported">oauth_token_profiles_supported</dt>
<dd>REQUIRED.  PAT and AAT profiles produced by this authorization
server.  The property value is an array of string values.
Currently the only string value for this property defined by
this specification is &#8220;bearer&#8221;, corresponding to the OAuth
bearer token profile [OAuth-bearer].  The authorization server
is REQUIRED to support this profile, and to supply this string
value explicitly.  The authorization server MAY declare its
support for additional access token profiles by providing a
unique absolute URI in a string value in the array for each
one.</dd>
<dt id="term-uma-token-profiles-supported">uma_token_profiles_supported</dt>
<dd>REQUIRED.  RPT types produced by this authorization server.
The property value is an array of string values.  Currently the
only string value for this property defined by this
specification is &#8220;bearer&#8221;, whose associations the resource
server MUST determine through a token introspection interaction
with the authorization server (see Section 3.3 for the
definition of this profile).  The authorization server is
REQUIRED to support the UMA bearer token profile, and to supply
this string value explicitly.  The authorization server MAY
declare its support for RPTs using additional RPT profiles by
providing a unique absolute URI in a string value in the array
for each one.</dd>
<dt id="term-oauth-grant-types-supported">oauth_grant_types_supported</dt>
<dd>REQUIRED.  OAuth grant types supported by this authorization
server in issuing PATs and AATs.  The property value is an
array of string values.  Each string value MUST be one of the
grant_type values defined in [OAuth2], or alternatively an
extension grant type indicated by a unique absolute URI.</dd>
<dt id="term-32">claim_profiles_supported</dt>
<dd>OPTIONAL.  Claim formats and associated sub-protocols for
gathering claims from requesting parties, as supported by this
authorization server.  The property value is an array of string
values.  Currently the only string value for this property
defined by this specification is &#8220;openid&#8221;, for which details
are supplied in Section 3.5.1.1.  The authorization server MAY
declare its support for additional claim profiles by assigning
a unique absolute URI in a string value in the array for each
one.</dd>
<dt id="term-33">token_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server or
client asks the authorization server for a PAT or AAT,
respectively.  A requested scope of
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221;
results in a PAT.  A requested scope of
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authorization">http://docs.kantarainitiative.org/uma/scopes/authorization</a>&#8221;
results in an AAT.  Available HTTP methods are as defined by
[OAuth2] for a token endpoint.</dd>
<dt id="term-34">user_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
gathers the consent of the end-user resource owner or the
client gathers the consent of the end-user requesting party, if
the &#8220;authorization_code&#8221; grant type is used.  Available HTTP
methods are as defined by [OAuth2] for an end-user
authorization endpoint.</dd>
<dt id="term-35">permission_registration_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
registers permissions with the authorization server for which a
client will be seeking authorization on its requesting party&#8217;s
behalf (see Section 3.2).  A PAT MUST accompany requests to
this protected endpoint.</dd>
<dt id="term-36">rpt_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the client ask the
authorization server for an RPT.  An AAT token MUST accompany
requests to this protected endpoint.</dd>
<dt id="term-rpt-status-endpoint">rpt_status_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
introspects an RPT presented to it by a client (see
Section 3.3).  A PAT MUST accompany requests to this protected
endpoint.</dd>
<dt id="term-permission-request-endpoint">permission_request_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the client asks, on its
requesting party&#8217;s behalf, to have authorization data
associated with its RPT.  An AAT MUST accompany requests to
this protected endpoint.</dd>
</dl>
<p>Example of authorization server configuration data that resides at
<a class="reference external" href="https://example.com/.well-known/uma-configuration">https://example.com/.well-known/uma-configuration</a> (note the use of
https: for endpoints throughout):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
<span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="s2">&quot;issuer&quot;</span><span class="o">:</span><span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
<span class="s2">&quot;dynamic_client_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/dyn_client_reg_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;oauth_token_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;bearer&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;uma_token_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;bearer&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;oauth_grant_types_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;authorization_code&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;claim_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;openid&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;token_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/token_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;user_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/user_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;resource_set_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/rsrc_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;rpt_status_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/status_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;permission_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/perm_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;rpt_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/client/rpt_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;permission_request_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/client/perm_uri&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Authorization server configuration data MAY contain extension
properties that are not defined in this specification.  Extension
names that are unprotected from collisions are outside the scope of
the current specification.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.5">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.5</a> )</p>
</div>
</div>
<div class="section" id="protecting-a-resource">
<span id="uma-core-2"></span><h2><a class="toc-backref" href="#id23">2.  Protecting a Resource</a><a class="headerlink" href="#protecting-a-resource" title="Permalink to this headline">¶</a></h2>
<p>The resource owner,
resource server,
and authorization server perform the following actions
to put resources under protection.</p>
<p>This list assumes that the resource server
has discovered the authorization server&#8217;s configuration data
and endpoints as needed.</p>
<ol class="arabic">
<li><p class="first">The authorization server issues <a class="reference internal" href="glossary.html#term-client-credentials"><em class="xref std std-term">client credentials</em></a>
to the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>.</p>
<p>It is OPTIONAL for the client credentials
to be provided dynamically through <a class="reference internal" href="#term-88"><em class="xref std std-term">[DynClientReg]</em></a>;
alternatively,
they MAY use a static process.</p>
</li>
<li><p class="first">The resource server acquires a PAT
from the authorization server.</p>
<p>It is OPTIONAL for the resource owner
to introduce the resource server
to the authorization server dynamically
(for example,
through a &#8220;NASCAR&#8221;-style user interface
where the resource owner selects a chosen authorization server);
alternatively,
they MAY use a static process that
may or may not directly involve the resource owner
at introduction time.</p>
</li>
<li><p class="first">In an ongoing fashion,
the resource server registers any resource sets
with the authorization server
for which it intends to outsource protection,
using the resource set registration endpoint
of the protection API (see <a class="reference internal" href="#term-91"><em class="xref std std-term">[OAuth-resource-reg]</em></a>).</p>
</li>
</ol>
<p>Note:
The resource server is free to offer the option
to protect any subset of the resource owner&#8217;s resources
using different authorization servers or other means entirely,
or to protect some resources and not others.</p>
<p>Additionally,
the choice of protection regimes can be made explicitly
by the resource owner or implicitly by the resource server.</p>
<p>Any such partitioning by the resource server or
owner is outside the scope of this specification.</p>
<p>Once a resource set has been placed
under authorization server protection
through the registration of a resource set description for it,
and until such a description&#8217;s deletion by the resource server,
the resource server MUST limit access to corresponding resources,
requiring sufficient authorization data associated
with client-presented RPTs by the authorization server
(see <a class="reference internal" href="#uma-core-3-1-2"><em>Section 3.1.2</em></a>).</p>
<p>(draft09)</p>
<table class="docutils field-list" frame="void" id="uma-core-2-1" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="resource-server-obtains-pat">
<h3><a class="toc-backref" href="#id24">2.1. Resource Server Obtains PAT</a><a class="headerlink" href="#resource-server-obtains-pat" title="Permalink to this headline">¶</a></h3>
<p>In this step,
the resource server acquires a PAT from the authorization server.</p>
<p>The token represents the approval of the
resource owner for this resource server to trust this authorization
server for protecting resources belonging to this resource owner.  It
is OPTIONAL for the resource owner to introduce the resource server
to the authorization server dynamically through the process defined
in <a class="reference internal" href="#term-91"><em class="xref std std-term">[OAuth-resource-reg]</em></a>);
alternatively,
they MAY use a static process that may or may not directly
involve the resource owner at introduction time.</p>
<p>The resource server MUST use OAuth 2.0 [OAuth2] to obtain the PAT.</p>
<p>Here the resource server acts in the role of an OAuth client
requesting the
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope, which
authorizes it to use the authorization server&#8217;s resource set
registration endpoint (as defined in <a class="reference internal" href="#term-91"><em class="xref std std-term">[OAuth-resource-reg]</em></a>)
as well as additional protection API endpoints.</p>
<p>Once the resource server has obtained its PAT,
it presents it to the authorization server at
various protection API endpoints.</p>
<p>(NOTE: The &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221;
scope keyword is a URI that resolves to a JSON-encoded scope
description, in the fashion of UMA scope types.  This scope
description is non-normative.)</p>
<p>The authorization server MAY support the use of any OAuth grant type for PAT issuance,
but MUST support the authorization_code grant type,
and SHOULD support the SAML bearer token grant type [OAuth-SAML]
(<a class="reference external" href="urn:ietf:params:oauth:grant-type:saml2-bearer">urn:ietf:params:oauth:grant-type:saml2-bearer</a>) if it anticipates
working with resource servers that are operating in environments
where the use of SAML is prevalent.  The authorization server MUST
indicate all grant types it supports for PAT issuance in its
configuration data.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.1</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-2-2" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="resource-server-registers-sets-of-resources-to-be-protected">
<h3><a class="toc-backref" href="#id25">2.2. Resource Server Registers Sets of Resources to Be Protected</a><a class="headerlink" href="#resource-server-registers-sets-of-resources-to-be-protected" title="Permalink to this headline">¶</a></h3>
<p>Once the resource server has received a PAT,
for any of the resource owner&#8217;s sets of resources that are to be protected by this
authorization server, it registers these resource sets in a timely fashion.
To do this, the resource server uses the resource set registration API defined in <a class="reference internal" href="#term-91"><em class="xref std std-term">[OAuth-resource-reg]</em></a>.</p>
<p>Note: The resource server is free to offer the option to protect any
subset of the resource owner&#8217;s resources using different
authorization servers or other means entirely, or to protect some
resources and not others.  Additionally, the choice of protection
regimes can be made explicitly by the resource owner or implicitly by
the resource server.  Any such partitioning by the resource server or
owner is outside the scope of this specification.</p>
<p>On successfully registering a resource set, the RS MUST use access
control mechanisms to limit access to any resources corresponding to
this resource set, relying on the AS to supply currently valid
permissions for authorized access.  The RS MUST outsource protection
to the AS according to the currently registered state of a resource
set.  This requirement holds true so long as the RS has one or more
registsred resource sets.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.2</a> )</p>
</div>
<div class="section" id="host-obtains-protection-api-token">
<span id="uma-core-2-3"></span><h3><a class="toc-backref" href="#id26">2.3.  Host Obtains Protection API Token</a><a class="headerlink" href="#host-obtains-protection-api-token" title="Permalink to this headline">¶</a></h3>
<p>In this step, the host acquires a PAT from the AM.  The token
represents the approval of the authorizing user for this host to
trust this AM for protecting resources belonging to this user.</p>
<p>The host MUST use OAuth 2.0 [OAuth2] to obtain the protection API
token.  Here the host acts in the role of an OAuth client requesting
the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope;
the authorizing user acts in the role of an OAuth end-user resource
owner; and the AM acts in the role of an OAuth authorization server.
Once the host has obtained its PAT, it presents it to the AM at
various protection API endpoints; in presenting these endpoints the
AM acts in the role of a resource server.</p>
<p>The AM MAY support the use of any grant type, but MUST support the
authorization_code grant type, and SHOULD support the SAML bearer
token grant type [OAuth-SAML]
(<a class="reference external" href="urn:ietf:params:oauth:grant-type:saml2-bearer">urn:ietf:params:oauth:grant-type:saml2-bearer</a>) if it anticipates
working with hosts that are operating in environments where the use
of SAML is prevalent.  The AM MUST indicate all grant types it
supports in its configuration data, as defined in Section 1.5.</p>
<p>The host has completed this step successfully when it possesses a PAT
it can use to get access to the AM&#8217;s protection API on this user&#8217;s
behalf.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="host-registers-sets-of-resources-to-be-protected">
<span id="uma-core-2-4"></span><h3><a class="toc-backref" href="#id27">2.4. Host Registers Sets of Resources to Be Protected</a><a class="headerlink" href="#host-registers-sets-of-resources-to-be-protected" title="Permalink to this headline">¶</a></h3>
<p>Once the host has received a PAT, for any of the user&#8217;s sets of
resources that are to be protected by this AM, it MUST register these
<a class="reference internal" href="glossary.html#term-resource-sets"><em class="xref std std-term">resource sets</em></a> at the AM&#8217;s <em class="xref std std-term">registration endpoint</em>.</p>
<p>Note that the host is free to offer the option to protect any subset
of the user&#8217;s resources using different AMs or other means entirely,
or to protect some resources and not others.  Additionally, the
choice of protection regimes can be made explicitly by the user or
implicitly by the host.  Any such partitioning by the host or user is
outside the scope of this specification.</p>
<p>See <a class="reference internal" href="#uma-core-10"><em>Section 10</em></a> for an extended example of registering <a class="reference internal" href="glossary.html#term-resource-sets"><em class="xref std std-term">resource sets</em></a>.</p>
<p>(draft 05)</p>
<div class="section" id="scope-descriptions">
<span id="uma-core-2-4-1"></span><h4><a class="toc-backref" href="#id28">2.4.1. Scope Descriptions</a><a class="headerlink" href="#scope-descriptions" title="Permalink to this headline">¶</a></h4>
<p>A <strong>scope</strong> is a bounded extent of access that is possible to perform on
a resource set.  A scope description is a JSON document with the
following properties and a Content-Type of <strong>application/uma-scope+json</strong>:</p>
<dl class="glossary docutils">
<dt id="term-name">name</dt>
<dd><p class="first">REQUIRED.</p>
<p>A human-readable string describing some scope (extent) of access.</p>
<p>This name is intended for ultimate use in the AM&#8217;s user interface
to assist the user in setting policies for protected resource sets
that have this available scope.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>「三井住友銀行:普通預金口座」とか、「三井住友銀号:お客様情報」とか</li>
</ul>
</div>
</dd>
<dt id="term-icon-uri">icon_uri</dt>
<dd><p class="first">OPTIONAL.</p>
<p>A URI for a graphic icon representing the scope.</p>
<p class="last">The referenced icon is intended for ultimate use in the AM&#8217;s user interface
to assist the user in setting policies for protected
resource sets that have this available scope.</p>
</dd>
</dl>
<p>For example, this description characterizes a scope that involves
reading or viewing resources (vs. creating them or editing them in
some fashion):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;View&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/reading-glasses&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Scope descriptions MAY contain extension properties
that are not defined in this specification.
Extension names that are unprotected
from collisions are outside the scope of the current specification.</p>
<p>A host MUST list a <a class="reference internal" href="#term-resource-set"><em class="xref std std-term">resource set</em></a>&#8216;s available scopes using URI references
(as defined in <a class="reference internal" href="#uma-core-2-4-2"><em>Section 2.4.2</em></a>).</p>
<p>The scopes available for use at any one host MUST have unique URI references
so that the host&#8217;s scope descriptions are uniquely distinguishable.
A scope URI reference MAY include a fragment identifier.
Scope descriptions MAY reside anywhere.
The host is not required to self-host scope descriptions
and may wish to point to standardized scope descriptions residing elsewhere.
Scope description documents MUST be accessible
to AMs through GET calls made to these URI references.</p>
<p>See <a class="reference internal" href="#uma-core-1-4"><em>Section 1.4</em></a> for further discussion of scope-related concepts, and
Section 10 for a long-form example of scopes used in resource set
registration.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="resource-set-descriptions">
<span id="uma-core-2-4-2"></span><h4><a class="toc-backref" href="#id29">2.4.2. Resource Set Descriptions</a><a class="headerlink" href="#resource-set-descriptions" title="Permalink to this headline">¶</a></h4>
<p>The host defines a resource set that needs protection
by registering a resource set description at the AM.
The host registers the description and manages its lifecycle at the AM&#8217;s host resource set
registration endpoint by using the resource set registration API,
as defined in Section 2.4.3.</p>
<p>A resource set description is a JSON document with the following
properties and a Content-Type of <strong>application/uma-resource-set+json:</strong></p>
<dl class="glossary docutils">
<dt id="term-41">name</dt>
<dd><p class="first">REQUIRED.</p>
<p>A human-readable string describing a set of one or more resources.
The AM SHOULD use the name in its user interface to assist the user
in setting policies for protecting this
resource set.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>「三井住友銀号:総合口座」とか</li>
</ul>
</div>
</dd>
<dt id="term-42">icon_uri</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">A URI for a graphic icon representing the
resource set.  If provided, the AM SHOULD use the referenced icon
in its user interface to assist the user in setting policies for
protecting this resource set.</p>
</dd>
<dt id="term-scopes">scopes</dt>
<dd><p class="first">REQUIRED.</p>
<p>An array providing the URI references of <em class="xref std std-ref">scope descriptions</em>
that are available for this resource set.</p>
<p>The AM SHOULD use the scope names and any icons defined as part of the
referenced scopes in its user interface to assist the user in
setting policies for protecting this resource set.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>「三井住友銀行:普通預金口座」、「三井住友銀行:お客様情報」、、、、、</li>
</ul>
</div>
</dd>
</dl>
<p>For example, this description characterizes a resource set (a photo
album) that can potentially be only viewed, or alternatively to which
full access can be granted; the URIs point to scope descriptions as
defined in <a class="reference internal" href="#uma-core-2-4-1"><em>Section 2.4.1</em></a>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Photo Album&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower.png&quot;</span><span class="p">,</span>
  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Resource set descriptions MAY contain extension properties that are
not defined in this specification.  Extension names that are
unprotected from collisions are outside the scope of the current
specification.</p>
<p>When a host creates or updates a resource set description
(see <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>),
the AM MUST attempt to retrieve the referenced scope
descriptions.  It MAY cache such descriptions as long as indicated in
the HTTP cache-control header for the scope description resource
unless the resource set description is subsequently updated within
the validity period.  At the beginning of an authorizing user&#8217;s login
session at the AM, the AM MUST attempt to re-retrieve scope
descriptions applying to that user whose cached versions have
expired.</p>
<p>(draft 05)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">For Connect Aggreated Claims,
following additional claims may be provided
for the AM to fetch resources in charge of the resource owner.</p>
<blockquote>
<div><ul class="simple">
<li>refresh_token(required)</li>
<li>access_token(potional)</li>
<li>token endpoint</li>
<li>resource endpoint</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">And, if aother API call is lengthy, following claims should be returned for
the <a class="reference internal" href="oauth.html#oauth-client-authentication"><em>client authentication</em></a> to
the token endpoint.</p>
<blockquote>
<div><ul class="simple">
<li>client identfiier</li>
<li>client secret</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Tokens&#8217; scope MUST be any in scopes of this resource set description.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="resource-set-registration-api">
<span id="uma-core-2-4-3"></span><h4><a class="toc-backref" href="#id30">2.4.3. Resource Set Registration API</a><a class="headerlink" href="#resource-set-registration-api" title="Permalink to this headline">¶</a></h4>
<p>The host uses the RESTful API at the AM&#8217;s resource set registration
endpoint to create, read, update, and delete resource set
descriptions, along with listing groups of such descriptions.  The
host MUST use its valid PAT obtained previously to gain access to this endpoint.
The resource set registration API is a subset of the protection API.</p>
<p>The host is free to use its own methods of identifying and describing resource sets.
The AM MUST treat them as opaque for the purpose of authorizing access,
other than associating them with the authorizing user
(as represented by the PAT used to access the API).
On successfully registering a resource set, the host MUST use UMA
mechanisms to limit access to any resources corresponding to this
resource set, relying on the AM to supply currently valid permissions
for authorized access.
The host MUST outsource protection to the AM according to the currently registered state of a resource set.  This
requirement holds true so long as the host has one or more registsred
resource sets.</p>
<p>(Note carefully the similar but distinct senses in which the word
&#8220;resource&#8221; is used in this section.  UMA resource set descriptions
are themselves managed as web resources at the AM through this API.)</p>
<p>The AM MUST present an API for registering resource set descriptions
at a set of URIs with the structure &#8220;<a class="reference internal" href="#term-rsreguri"><em class="xref std std-term">{rsreguri}</em></a>/resource_set/<a class="reference internal" href="#term-rsid"><em class="xref std std-term">{rsid}</em></a>&#8221;,
where the PAT provides sufficient context to distinguish between
identical resource set identifiers assigned by different hosts.</p>
<p>The components of these URIs are defined as follows:</p>
<dl class="glossary docutils">
<dt id="term-rsreguri">{rsreguri}</dt>
<dd>The AM&#8217;s resource set registration endpoint as advertised
in its configuration data (see Section 1.5).</dd>
<dt id="term-rsid">{rsid}</dt>
<dd>An identifier for a resource set description.</dd>
</dl>
<p>Without a specific resource set identifier path component, the URI
applies to the set of resource set descriptions already registered.</p>
<p>Following is a summary of the five registration operations the AM is
REQUIRED to support.  Each is defined in its own section below.  All
other methods are unsupported.  This API uses ETag and If-Match to
ensure the desired resource at the AM is targeted.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#uma-core-create-resource-set-description"><em>Create resource set description</em></a>: PUT /resource_set/{rsid}</li>
<li><a class="reference internal" href="#uma-core-read-resource-set-description"><em>Read resource set description</em></a>: GET /resource_set/{rsid}</li>
<li><a class="reference internal" href="#uma-core-update-resource-set-description"><em>Update resource set description</em></a>: PUT /resource_set/{rsid} with If-
Match</li>
<li><a class="reference internal" href="#uma-core-delete-resource-set-description"><em>Delete resource set description</em></a>: DELETE /resource_set/{rsid}</li>
<li><a class="reference internal" href="#uma-core-list-resource-set-descriptions"><em>List resource set descriptions</em></a>: GET /resource_set/ with If-Match</li>
</ul>
</div></blockquote>
<p>If the request to the resource set registration endpoint is incorrect,
then the AM responds with an error message (see <a class="reference internal" href="#uma-core-4-2"><em>Section 4.2</em></a>)
by including one of the following error codes with the response:</p>
<dl class="glossary docutils">
<dt id="term-unsupported-method-type">unsupported_method_type</dt>
<dd>The host request used an unsupported HTTP
method.  The AM MUST respond with the HTTP 405 (Method Not
Allowed) status code and MUST fail to act on the request.</dd>
<dt id="term-not-found">not_found</dt>
<dd>The resource set requested from the AM cannot be found.
The AM MUST respond with HTTP 404 (Not Found) status code.</dd>
<dt id="term-precondition-failed">precondition_failed</dt>
<dd>The resource set that was requested to be
deleted or updated at the AM did not match the If-Match value
present in the request.  The AM MUST respond with HTTP 412
(Precondition Failed) status code and MUST fail to act on the
request.</dd>
</dl>
<p>(draft 05)</p>
<div class="section" id="create-resource-set-description">
<span id="uma-core-create-resource-set-description"></span><span id="uma-core-2-4-3-1"></span><h5><a class="toc-backref" href="#id31">2.4.3.1. Create Resource Set Description</a><a class="headerlink" href="#create-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Adds a new resource set description using the PUT method,
thereby putting it under the AM&#8217;s protection.
If the request is successful,
the AM MUST respond with a status message
that includes an <em class="xref std std-term">ETag</em> header and <strong>_id</strong> and <strong>_rev</strong> properties
for managing resource set description versioning.</p>
<p>Form of a &#8220;create resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>PUT /resource_set/{rsid} HTTP/1.1
Content-Type: application/uma-resource-set+json
...

(body contains JSON resource set description to be created)</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: (matches "_rev" property in returned object)
...

{
  "status": "created",
  "_id": (id of created resource set),
  "_rev": (ETag of created resource set)
}</pre>
</div>
<p>On successful registration,
the AM MAY return a <em class="xref std std-term">redirect policy URI</em>
to the host in a property with the name &#8220;policy_uri&#8221;.
This URI allows the host to redirect the user to a specific user interface
within the AM where the user can immediately set or modify access policies
for the resource set that was just registered.</p>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: (matches "_rev" property in returned object)
...

{
  "status": "created",
  "_id": (id of created resource set),
  "_rev": (ETag of created resource set)
  "policy_uri":"http://am.example.com/host/222/resource/333/policy"
}</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="read-resource-set-description">
<span id="uma-core-read-resource-set-description"></span><span id="uma-core-2-4-3-2"></span><h5><a class="toc-backref" href="#id32">2.4.3.2.  Read Resource Set Description</a><a class="headerlink" href="#read-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Reads a previously registered resource set description using the GET
method.
If the request is successful,
the AM MUST respond with a status message
that includes an <em class="xref std std-term">ETag</em> header and <strong>_id</strong> and <strong>_rev</strong>
properties for managing resource set description versioning.</p>
<p>Form of a &#8220;read resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>GET /resource_set/{rsid} HTTP/1.1
...</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/uma-resource-set+json
...

(body contains JSON resource set description, including _id and _rev)</pre>
</div>
<p>If the referenced resource does not exist,
the AM MUST produce an error response with an error property value of &#8220;<strong>not_found</strong>&#8221;,
as defined in <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>.</p>
<p>On successful read,
the AM MAY return a redirect policy URI to the host in a property with the name &#8220;<a class="reference internal" href="reg.html#term-policy-uri"><em class="xref std std-term">policy_uri</em></a>&#8221;.
This URI allows the host to redirect the user to a specific user interface within the AM
where the user can immediately set or modify access policies for the resource set that was read.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>policy_uri seems to be a part of scope description JSON.....</li>
</ul>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="update-resource-set-description">
<span id="uma-core-update-resource-set-description"></span><span id="uma-core-2-4-3-3"></span><h5><a class="toc-backref" href="#id33">2.4.3.3.  Update Resource Set Description</a><a class="headerlink" href="#update-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Updates a previously registered resource set description using the
PUT method, thereby changing the resource set&#8217;s protection
characteristics.  If the request is successful, the AM MUST respond
with a status message that includes an <em class="xref std std-ref">ETag</em> header and <strong>_id</strong> and <strong>_rev</strong>
properties for managing resource set description versioning.</p>
<p>Form of an &#8220;update resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>PUT /resource_set/{rsid} HTTP/1.1
Content-Type: application/resource-set+json
If-Match: (entity tag of resource)
...

(body contains JSON resource set description to be updated)</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 204 No Content
ETag: "2"
...</pre>
</div>
<p>If the entity tag does not match, the AM MUST produce an error
response with an error property value of &#8220;precondition_failed&#8221;, as
defined in <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>.</p>
<p>On successful update, the AM MAY return a redirect policy URI to the
host in a property with the name &#8220;policy_uri&#8221;.  This URI allows the
host to redirect the user to a specific user interface within the AM
where the user can immediately set or modify access policies for the
resource set that was just updated.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>It is unclear where <strong>policy_uri</strong> should be returned. in header or paylaod ?</li>
</ul>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="delete-resource-set-description">
<span id="uma-core-delete-resource-set-description"></span><span id="uma-core-2-4-3-4"></span><h5><a class="toc-backref" href="#id34">2.4.3.4.  Delete Resource Set Description</a><a class="headerlink" href="#delete-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Deletes a previously registered resource set description using the
DELETE method, thereby removing it from the AM&#8217;s protection regime.</p>
<p>Form of a &#8220;delete resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>DELETE /resource_set/{rsid}
If-Match: (entity tag of resource)
...</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 204 No content
...</pre>
</div>
<p>As defined in <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>, if the referenced resource does not
exist the AM MUST produce an error response with an error property
value of &#8220;not_found&#8221;, and if the entity tag does not match the AM
MUST produce an error response with an error property value of
&#8220;precondition_failed&#8221;.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="list-resource-set-descriptions">
<span id="uma-core-list-resource-set-descriptions"></span><span id="uma-core-2-4-3-5"></span><h5><a class="toc-backref" href="#id35">2.4.3.5.  List Resource Set Descriptions</a><a class="headerlink" href="#list-resource-set-descriptions" title="Permalink to this headline">¶</a></h5>
<p>Lists all previously registered resource set identifiers for this
user using the GET method.  The AM MUST return the list in the form
of a JSON array of {rsid} values.</p>
<p>The host uses this method as a first step in checking whether its
understanding of protected resources is in full synchronization with
the AM&#8217;s understanding.</p>
<p>Form of a &#8220;list resource set descriptions&#8221; HTTP request:</p>
<div class="highlight-python"><pre>GET /resource_set HTTP/1.1
...</pre>
</div>
<p>HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
...

(body contains JSON array of {rsid} values)</pre>
</div>
<p>(draft 05)</p>
</div>
</div>
</div>
</div>
<div class="section" id="getting-authorization-and-accessing-a-resource">
<span id="uma-core-3"></span><h2><a class="toc-backref" href="#id36">3. Getting Authorization and Accessing a Resource</a><a class="headerlink" href="#getting-authorization-and-accessing-a-resource" title="Permalink to this headline">¶</a></h2>
<p>An <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> orchestrates
and controls <a class="reference internal" href="oauth.html#term-clients"><em class="xref std std-term">clients</em></a>&#8216; access
(on their <a class="reference internal" href="glossary.html#term-requesting-parties"><em class="xref std std-term">requesting parties</em></a>&#8216; behalf)
to a <a class="reference internal" href="#term-resource-owner"><em class="xref std std-term">resource owner</em></a>&#8216;s <a class="reference internal" href="glossary.html#term-protected-resources"><em class="xref std std-term">protected resources</em></a>
at a <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>,
under conditions dictated by that resource owner.</p>
<p>The process of getting authorization,
and accessing a resource always begins with
the client attempting access
at a <a class="reference internal" href="glossary.html#term-protected-resource"><em class="xref std std-term">protected resource</em></a> endpoint
at the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>.</p>
<p>How the client came to learn about this endpoint is
out of scope for this specification.</p>
<p>The <a class="reference internal" href="#term-resource-owner"><em class="xref std std-term">resource owner</em></a> might, for example,
have advertised its availability publicly
on a blog or other website,
listed it in a discovery service,
or emailed a link to a particular intended requesting party.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>ディスカバリをどうやるか？</li>
<li>「リソース名」でリソースエンドポイントをディスカバる？</li>
</ul>
</div>
</div></blockquote>
<p>The resource server responds to the client&#8217;s access request
with whatever its application-specific interface defines
as a success response,
either immediately or having first performed one
or more embedded interactions with the authorization server.</p>
<p>Depending on the nature of the resource server&#8217;s response
to an failed access attempt,
the client and its operator requesting party engage
in embedded interactions with the authorization server
before re-attempting access.</p>
<p>The interactions are as follows.</p>
<p>Each interaction MAY be the last,
if the client chooses not to continue pursuing the access attempt or
the resource server chooses not to continue facilitating it.</p>
<ul>
<li><p class="first">The client attempts to access a protected resource.</p>
<ul>
<li><p class="first">If the access attempt is unaccompanied by an RPT,
the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> responds immediately
with an <strong>HTTP 401 (Unauthorized)</strong> response
and instructions on where to go to obtain one.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>リソースなし 401</li>
</ul>
</div>
</li>
<li><p class="first">If the access attempt was accompanied by an <em class="xref std std-term">RPT</em>,
the resource server checks the RPT&#8217;s <strong>status</strong>.</p>
<ul>
<li><p class="first">If the RPT is <strong>invalid</strong>,
the resource server responds with an <strong>HTTP 401 (Unauthorized)</strong> response
and instructions on where to go to obtain a token.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>不正なRPT 401</li>
</ul>
</div>
</li>
<li><p class="first">If the RPT is valid but has <strong>insufficient</strong> authorization data,
the resource server registers a suitable requested permission
on the client&#8217;s behalf at the authorization server,
and then responds to the client with an <strong>HTTP 403 (Forbidden)</strong> response
and instructions on where to go to ask for authorization.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>パーミッションがない 403</li>
</ul>
</div>
</li>
<li><p class="first">If the RPT is <strong>valid</strong>,
and if the authorization data associated
with the token is sufficient for allowing access,
the resource server responds with an <strong>HTTP 2xx (Success)</strong>
response and a representation of the resource.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>リソース返答 200</li>
</ul>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p class="first">If the client (possessing no RPT or an invalid RPT) received a 401 response
and an authorization server&#8217;s location,
after looking up its configuration data and endpoints as necessary,
it requests an RPT from the RPT endpoint of the authorization API.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>401 をもらったらクライアントは RPT をAuthz Serverに要求</li>
</ul>
</div>
</li>
<li><p class="first">If the client (posessing a valid RPT) received a 403 response and
a permission ticket,
it asks the authorization server for authorization data
that matches the ticket
using the authorization request endpoint of the authorization API.</p>
<p>If the authorization server needs requesting party claims
in order to assess this
client&#8217;s authorization,
it engages in a claims-gathering flow.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>403 をもらったらクライアントは
Authz ServerにRPTへのパーミッションを要求</li>
</ul>
</div>
<ul>
<li><p class="first">If the client does not already have an AAT at the appropriate
authorization server to be able to use its authorization API,
it first obtains one.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>AATがなかったら、クライアントはAATの取得から始める</li>
</ul>
</div>
</li>
</ul>
</li>
</ul>
<p>The interactions are described in detail in the following sections.</p>
<p>(draft09 , <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3</a> )</p>
<div class="section" id="client-attempts-to-access-protected-resource">
<span id="uma-core-3-1"></span><h3><a class="toc-backref" href="#id37">3.1.  Client Attempts to Access Protected Resource</a><a class="headerlink" href="#client-attempts-to-access-protected-resource" title="Permalink to this headline">¶</a></h3>
<p>This interaction assumes that the resource server has previously
registered one or more resource sets that correspond to the resource
to which access is being attempted.</p>
<p>The client attempts to access a protected resource (for example, when
an end-user requesting party clicks on a thumbnail representation of
the resource to retrieve a larger version).
It is expected to cover, or be provisioned or configured with,
knowledge of the protected resource and its location out of band.</p>
<p>Further,
the client is expected to acquire its own knowledge
about the application-specific methods made available by the resource server
for operating on this protected resource
(such as viewing it with a GET method, or transforming it with some complex API)
and the possible scopes of access.</p>
<p>The access attempt either is or is not accompanied by an RPT.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">リソースはなんとかしてみつけろ(ディスカバリ?)</p>
</li>
<li><p class="first">取得手順は互いに取り決めろ</p>
</li>
<li><p class="first">リソースに対してのRPTが既にあったら指定してもいいし、無しでも良い</p>
<blockquote>
<div><ul class="simple">
<li>無いと 401</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<p>(draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.1</a> )</p>
<div class="section" id="client-presents-no-rpt">
<span id="uma-core-3-1-1"></span><h4><a class="toc-backref" href="#id38">3.1.1.  Client Presents No RPT</a><a class="headerlink" href="#client-presents-no-rpt" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>トークンが無いので、401を返す</li>
<li>WWW-Authenticatedヘッダーで、UMAスキームの認証が必要なことを教える</li>
<li>as_uri で AuthzServerのありかを教える</li>
<li>host_id で、AuthzServerでのリソースサーバー識別子を教える</li>
</ul>
</div>
<p>Example of a request carrying no RPT:</p>
<div class="highlight-python"><pre>GET /album/photo.jpg HTTP/1.1
Host: photoz.example.com
...</pre>
</div>
<p>If the client does not present an RPT with the request,
the resource server returns an HTTP 401 (Unauthorized) status code and
providing the authorization server&#8217;s URI in an &#8220;as_uri&#8221; property to
facilitate authorization server configuration data discovery,
including discovery of the endpoint
where the client can request an RPT (<a class="reference internal" href="#uma-core-3-4-1"><em>Section 3.4.1</em></a>).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
   WWW-Authenticate: UMA realm="example",
    host_id="photoz.example.com",
    as_uri="https://as.example.com"
   ...</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>scheme : &#8220;UMA&#8221;</li>
<li>realm : レルム</li>
<li>host_id : Resource Server 識別子</li>
<li>as_uri : Authz Server</li>
</ul>
</div>
<p>( draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.1.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.1.1</a> )</p>
</div>
<div class="section" id="client-presents-rpt">
<span id="uma-core-3-1-2"></span><h4><a class="toc-backref" href="#id39">3.1.2.  Client Presents RPT</a><a class="headerlink" href="#client-presents-rpt" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>ベアラRPTを提示してリソースアクセスする</li>
</ul>
</div>
<p>Example of a request carrying an RPT
using the UMA bearer RPT profile:</p>
<div class="highlight-python"><pre>GET /album/photo.jpg HTTP/1.1
Authorization: Bearer vF9dft4qmT
Host: photoz.example.com
...</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>トークンの検証すること</li>
</ul>
</div>
<p>If the client presents an RPT with its request,
the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> MUST determine the RPT&#8217;s status
(see <a class="reference internal" href="#uma-core-3-3"><em>Section 3.3</em></a>) before responding.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>不正トークン -&gt; 401</li>
<li><ul class="first">
<li>Authz Server URI &#8220;as_uri&#8221;</li>
</ul>
</li>
</ul>
</div>
<p>If the RPT is invalid,
the resource server applies <em class="xref std std-term">UMA protection</em> by
returning HTTP 401 (Unauthorized) status code
and providing the authorization server&#8217;s URI
in an &#8220;<em class="xref std std-term">as_uri</em>&#8221; property in the header,
similarly to the case where no RPT was presented.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>認可データが不足 -&gt; 403 + as_uri + チケット</li>
<li>要求されるパーミッションを追加 -&gt; チケット</li>
</ul>
</div>
<p>If the RPT is valid but has insufficient <a class="reference internal" href="#term-authorization-data"><em class="xref std std-term">authorization data</em></a>
for the type of access sought,
the resource server uses the <a class="reference internal" href="glossary.html#term-protection-api"><em class="xref std std-term">protection API</em></a>
to register a requested permission with the authorization server
that would suffice for that scope of access (see <a class="reference internal" href="#uma-core-3-2"><em>Section 3.2</em></a>).</p>
<p>It then responds with HTTP 403 (Forbidden) status code
and providing the authorization server&#8217;s URI in an &#8220;as_uri&#8221; property
in the header
and the permission ticket it just received from the AM in the body in a
JSON-encoded &#8220;<em class="xref std std-term">ticket</em>&#8221; property.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>スコープが足りないケースも403</li>
</ul>
</div>
<p>Example of the resource server&#8217;s response
after having registered a requested permission
and received a ticket:</p>
<div class="highlight-python"><pre>HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  as_uri="https://as.example.com"
  error="insufficient_scope"

{
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>トークンステータスがOKで認可データもアクセスするのに十分であれば
リソースを返す</li>
</ul>
</div>
<p>If the RPT&#8217;s status is associated with authorization data
that is sufficient for the access sought by the client,
the resource server MUST give access to the desired resource.</p>
<p>Example of the resource server&#8217;s response after having determined
that the RPT is valid and associated with sufficient authorization
data:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: image/jpeg
...


/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb</pre>
</div>
<p>The resource server MUST NOT give access where the token&#8217;s status is
not associated with sufficient authorization data for the attempted scope of access.</p>
<p>( draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.1.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.1.2</a> )</p>
</div>
<div class="section" id="client-presents-a-valid-rpt-with-sufficient-authorization-data">
<span id="uma-core-3-1-3"></span><h4><a class="toc-backref" href="#id40">3.1.3. Client Presents a Valid RPT with Sufficient Authorization Data</a><a class="headerlink" href="#client-presents-a-valid-rpt-with-sufficient-authorization-data" title="Permalink to this headline">¶</a></h4>
<p>If the RPT&#8217;s status is associated with authorization data
that is consistent with authorized access of the scope sought
by the client (see <a class="reference internal" href="#uma-core-3-3"><em>Section 3.3</em></a>),
the resource server MUST give access to the desired resource.</p>
<p>Example of the resource server&#8217;s response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb</pre>
</div>
<p>This response constitutes the conclusion of Phase 3 of UMA.</p>
<p>The resource server MUST NOT give access
where the token&#8217;s status is not associated with sufficient authorization data
for the attempted scope of access.</p>
<p>( draft 06,  <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.3</a> )</p>
<div class="section" id="requester-s-token-has-insufficient-permission">
<span id="uma-core-3-1-3-1"></span><h5><a class="toc-backref" href="#id41">3.1.3.1.  Requester&#8217;s Token Has Insufficient Permission</a><a class="headerlink" href="#requester-s-token-has-insufficient-permission" title="Permalink to this headline">¶</a></h5>
<p>If the <a class="reference internal" href="glossary.html#term-token-status"><em class="xref std std-term">token status</em></a> is not associated with any currently valid <a class="reference internal" href="#term-permission"><em class="xref std std-term">permission</em></a>
that applies to the <a class="reference internal" href="#term-scope"><em class="xref std std-term">scope</em></a> of access attempted by the <em class="xref std std-term">requester</em>,
the <a class="reference internal" href="glossary.html#term-host"><em class="xref std std-term">Host</em></a> SHOULD register a <a class="reference internal" href="#term-permission"><em class="xref std std-term">permission</em></a> with the <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a>
(see <a class="reference internal" href="#uma-core-3-4"><em>Section 3.4</em></a>) that would suffice for that scope of access,
and then respond to the <em class="xref std std-term">requester</em> with the HTTP 403 (Forbidden) status code,
along with providing the AM&#8217;s URI in the header of the message and
the <a class="reference internal" href="#term-permission-ticket"><em class="xref std std-term">permission ticket</em></a> it just received from the <strong>AM</strong> in the body of the JSON form.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  am_uri="http://am.example.com"

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">Host register a permmision. (<a class="reference internal" href="#uma-core-3-4"><em>3.4.  Client Seeks Authorization for Access</em></a> )</p>
</li>
<li><p class="first">Host get a ticket from AM for a permission registration. ( ticket is a JSON in response body from AM )</p>
</li>
<li><p class="first">Host return the ticket to the request in HTTP 403 for the resource request. ( described in this section)</p>
</li>
<li><p class="first">Requester ask AM to get access token with the ticket and other information(<a class="reference internal" href="#uma-core-3-5"><em>3.5. Claims-Gathering Flows</em></a> )</p>
<blockquote>
<div><ul class="simple">
<li>AM check the policy for the requester and its request with claims (<a class="reference internal" href="#uma-core-3-6"><em>3.6.  Authorization Flows</em></a> )</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>&#8220;A Requester has a valid access token&#8221; means that &#8220;Authrizing User allowed the reuqester to access a resource in the Host&#8221;</li>
<li>So &#8220;Host&#8221; may register permission to the scope on &#8220;AM&#8221; for the &#8220;Requester&#8221;.  This is proved by the &#8220;Ticket&#8221;</li>
<li>If the &#8220;Requester&#8221; provides a valid &#8220;Ticket&#8221; for the &#8220;Token&#8221;.  the &#8220;AM&#8221; issues a new token (Updated Token)</li>
</ul>
</div>
<p>(draft 03)</p>
</div>
<div class="section" id="requester-s-token-has-sufficient-permission">
<span id="uma-core-3-1-3-2"></span><h5><a class="toc-backref" href="#id42">3.1.3.2.  Requester&#8217;s Token Has Sufficient Permission</a><a class="headerlink" href="#requester-s-token-has-sufficient-permission" title="Permalink to this headline">¶</a></h5>
<p>If the token status is associated with at least one currently valid
permission that applies to the scope of access attempted by the
requester, the host MUST give access to the desired resource.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb</pre>
</div>
<p>This response constitutes the conclusion of Phase 3 of UMA.</p>
<p>The host MUST NOT give access where the token&#8217;s status is not
associated with at least one currently active permission hat suffices
for that scope of access.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
</div>
</div>
<div class="section" id="resource-server-registers-requested-permission-with-authorization-server">
<span id="uma-core-3-2"></span><h3><a class="toc-backref" href="#id43">3.2.  Resource Server Registers Requested Permission With Authorization Server</a><a class="headerlink" href="#resource-server-registers-requested-permission-with-authorization-server" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="simple">
<li>認可データが足りない時に、リソースサーバーはAuthz Serverに
「要求パーミッション」を登録します</li>
<li>ここでの登録は、リクエストパーティの動作コンテキストにある。
リソースサーバーがこのエンドポイントのリクエストに必要な</li>
</ul>
<p>　パーミッション(スコープ)を登録する。これが登録されると、
　リソースオーナーが許可したパーミッションの範囲でリクエスト
　が処理されるということ。</p>
<ul class="last simple">
<li>リソースオーナーが「削除」スコープをAuthzServerに登録していないのに、
リクエストパーティが&#8221;/delete&#8221; 要求をすると、リソースサーバーの
エンドポイントはトークンに対して削除スコープを登録しようとしても、
失敗するので、&#8221;invalid_scope&#8221; になって、リクエストが処理されない</li>
</ul>
</div>
<p>In response to receiving an access request
accompanied by an RPT that has insufficient authorization data,
the resource server uses the protection API&#8217;s <em class="xref std std-term">permission registration endpoint</em>
to register a permission with the authorization server
that would be sufficient for the type of access sought.</p>
<p>The authorization server returns a <a class="reference internal" href="#term-permission-ticket"><em class="xref std std-term">permission ticket</em></a>
for the resource server to give to the client in its response.</p>
<p>The PAT provided in the API request implicitly identifies
the resource owner (&#8220;subject&#8221;) to which the permission applies.</p>
<p>The resource server uses the POST method at the endpoint.</p>
<p>The body of the HTTP request message contains a JSON object
providing the requested permission,
using a format derived from the scope description format
specified in [OAuth-resource-reg], as follows.</p>
<p>The object has the following properties:</p>
<dl class="glossary docutils">
<dt id="term-resource-set-id">resource_set_id</dt>
<dd><p class="first">REQUIRED.</p>
<p>The identifier for a resource set to
which this client is seeking access.</p>
<p class="last">The identifier MUST correspond to
a resource set that was previously registered.</p>
</dd>
<dt id="term-50">scopes</dt>
<dd><p class="first">REQUIRED.</p>
<p>An array referencing one or more identifiers of scopes
to which access is needed for this resource set.</p>
<p class="last">Each scope identifier MUST correspond to a scope
that was registered by this resource server
for the referenced resource set.</p>
</dd>
</dl>
<p>Example of an HTTP request that registers a requested permission at
the authorization server&#8217;s permission registration endpoint:</p>
<div class="highlight-python"><pre>POST /host/scope_reg_uri/photoz.example.com HTTP/1.1
Content-Type: application/json
Host: as.example.com</pre>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;resource_set_id&quot;</span><span class="p">:</span> <span class="s">&quot;112210f47de98100&quot;</span><span class="p">,</span>
  <span class="s">&quot;scopes&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s">&quot;http://photoz.example.com/dev/actions/view&quot;</span><span class="p">,</span>
      <span class="s">&quot;http://photoz.example.com/dev/actions/all&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the registration request is successful,
the authorization server responds with an HTTP 201 (Created) status code
and includes the <em class="xref std std-term">Location</em> header
in its response as well as the &#8220;ticket&#8221; property in the JSON-formatted body.</p>
<p>The permission ticket is a short-lived opaque structure
whose form is determined by the authorization server.</p>
<p>The ticket value MUST be securely random
(for example,
not merely part of a predictable sequential series),
to avoid denial-of-service attacks.</p>
<p>Since the <em class="xref std std-term">ticket</em> is an opaque structure from the point of view of the client,
the authorization server is free to include information
regarding expiration time within the opaque ticket for its own consumption.</p>
<p>When the client subsequently uses the authorization API
to ask the authorization server for authorization data
to be associated with its RPT,
it will submit this ticket to the authorization server.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/json
Location: https://as.example.com/permreg/host/photoz.example.com/5454345rdsaa4543
...

{
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>登録リクエストが失敗したとき</li>
</ul>
</div>
<p>If the registration request is authenticated properly
but fails due to other reasons,
the authorization server responds with an HTTP 400 (Bad Request) status code
and includes one of the following UMA error codes (see <a class="reference internal" href="#uma-core-4-2"><em>Section 4.2</em></a>):</p>
<dl class="glossary docutils">
<dt id="term-invalid-resource-set-id">invalid_resource_set_id</dt>
<dd>The provided resource set identifier was not found at the authorization server.</dd>
<dt id="term-invalid-scope">invalid_scope</dt>
<dd>At least one of the scopes included in the request was
not registered previously by this resource server.</dd>
</dl>
<p>( draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.2</a> )</p>
</div>
<div class="section" id="resource-server-determines-rpt-s-status">
<span id="uma-core-3-3"></span><h3><a class="toc-backref" href="#id44">3.3.  Resource Server Determines RPT&#8217;s Status</a><a class="headerlink" href="#resource-server-determines-rpt-s-status" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>リソースサーバーがリクエストパーティトークンの状態を確認</li>
<li>有効か？</li>
<li>有効であれば認可データはあるか？</li>
</ul>
</div>
<p>The resource server MUST determines a received RPT&#8217;s status,
including both its <strong>validity</strong> and, if valid,
its associated <a class="reference internal" href="#term-authorization-data"><em class="xref std std-term">authorization data</em></a>,
before giving or refusing access to the client.</p>
<p>An RPT is associated with a set of authorization data
that governs whether the client is authorized for access.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>トークン自体に内容が含まれている</li>
<li>あるいはトークンの状態を発行者に聞く</li>
</ul>
</div>
<p>The token&#8217;s nature and format are dictated by its profile;
the profile might allow it to be self-contained,
such that the resource server is able to determine its status locally, or
might require or allow the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>
to make a run-time introspection request
of the authorization server that issued the token.</p>
<p>This specification makes one type of RPT REQUIRED
for the authorization server to support:
the <strong>UMA bearer token profile</strong>,
as defined in <em class="xref std std-term">Section 3.3.2</em>.</p>
<p>Implementers MAY define and use other RPT profiles.</p>
<p>( draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.3</a> )</p>
<div class="section" id="token-introspection">
<span id="uma-core-3-3-1"></span><h4><a class="toc-backref" href="#id45">3.3.1.  Token Introspection</a><a class="headerlink" href="#token-introspection" title="Permalink to this headline">¶</a></h4>
<p>Within any RPT profile,
when a <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> needs to introspect a token
in a non-self-contained way to determine its status,
it MAY require, allow, or prohibit
use of the OAuth token introspection endpoint
(defined by <a class="reference internal" href="#term-90"><em class="xref std std-term">[OAuth-introspection]</em></a>)
that is part of the protection API, and MAY profile its usage.</p>
<p>The resource server MUST use the POST method
in interacting with the endpoint,
not the GET method also defined by <a class="reference internal" href="#term-90"><em class="xref std std-term">[OAuth-introspection]</em></a>.</p>
<p>( draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.3.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.3.1</a> )</p>
</div>
<div class="section" id="rpt-profile-bearer">
<span id="uma-core-bearer"></span><span id="uma-core-3-3-2"></span><h4><a class="toc-backref" href="#id46">3.3.2.  RPT Profile: Bearer</a><a class="headerlink" href="#rpt-profile-bearer" title="Permalink to this headline">¶</a></h4>
<p>This section defines the UMA bearer token profile.
Following is a summary:</p>
<blockquote>
<div><ul class="simple">
<li>Identifying URI: <a class="reference external" href="http://docs.kantarainitiative.org/uma/profiles/uma-token-bearer-1.0">http://docs.kantarainitiative.org/uma/profiles/uma-token-bearer-1.0</a></li>
<li>Profile author and contact information: Thomas Hardjono (<a class="reference external" href="mailto:hardjono&#37;&#52;&#48;mit&#46;edu">hardjono<span>&#64;</span>mit<span>&#46;</span>edu</a>)</li>
<li>Updates or obsoletes: None; this profile is new.</li>
<li>Keyword in HTTP Authorization header: &#8220;Bearer&#8221;.</li>
<li>Syntax and semantics of token data: As defined below.  The token
data format mainly involves time-bounded permissions.</li>
<li>Token data association: The data associated to the on-the-wire
token by reference and retrieved at run time by the resource
server through profiled use of the OAuth token introspection
endpoint [OAuth-introspection], as defined below.</li>
<li>Token data processing: As defined in this section and throughout
Section 3 of this specification.</li>
<li>Grant type restrictions: None.</li>
<li>Error states: As defined below.</li>
<li>Security and privacy considerations: As defined in this section
and throughout Section 3 of this specification.</li>
<li>Binding obligations: Because this RPT profile is mandatory for
authorization servers to implement, binding obligations related to
the use of this token profile are documented in [UMA-obligations].</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Bearerトークンが来たらイントロスペクトすること</li>
</ul>
</div>
<p>On receiving an RPT of the &#8220;Bearer&#8221; type
in an authorization header from a client making an access attempt,
the resource server introspect the token by using token introspection endpoint
of the <a class="reference internal" href="glossary.html#term-protection-api"><em class="xref std std-term">protection API</em></a>.</p>
<p>The PAT used by the resource server to make
the introspection request provides resource-owner context to the
authorization server.</p>
<p>The authorization server responds with a JSON object with the
structure dictated by <a class="reference internal" href="#term-90"><em class="xref std std-term">[OAuth-introspection]</em></a>.</p>
<p>If the valid property has a &#8220;true&#8221; value, then the JSON object MUST also contain an
extension property with the name &#8220;permissions&#8221; that contains an array
of zero or more values, each of which is an object consisting of
these properties:</p>
<dl class="glossary docutils">
<dt id="term-53">resource_set_id</dt>
<dd><p class="first">REQUIRED.</p>
<p>A string that uniquely identifies the resource set,
access to which has been granted to this client
on behalf of this requesting party.</p>
<p class="last">The identifier MUST correspond
to a resource set that was previously registered as protected.</p>
</dd>
<dt id="term-54">scopes</dt>
<dd><p class="first">REQUIRED.</p>
<p>An array referencing one or more URIs of scopes to
which access was granted for this resource set.</p>
<p class="last">Each scope MUST correspond to a scope that was registered
by this resource server for the referenced resource set.</p>
</dd>
<dt id="term-expires-at">expires_at</dt>
<dd>REQUIRED.  Integer timestamp, measured in the number of
seconds since January 1 1970 UTC, indicating when this permission
will expire.</dd>
<dt id="term-issued-at">issued_at</dt>
<dd>OPTIONAL.  Integer timestamp, measured in the number of
seconds since January 1 1970 UTC, indicating when this permission
was originally issued.</dd>
</dl>
<p>Example:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
    "valid": true,
    "expires_at": "1256953732",
    "issued_at": "1256912345",
    "permissions": [
      {
        "resource_set_id": "112210f47de98100",
        "scopes": [
          "http://photoz.example.com/dev/actions/view",
          "http://photoz.example.com/dev/actions/all"
         ],
        "expires_at" : "1256923456"
      }
    ]
   }</pre>
</div>
<p>( draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.3.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.3.2</a> )</p>
</div>
</div>
<div class="section" id="client-seeks-authorization-for-access">
<span id="uma-core-3-4"></span><h3><a class="toc-backref" href="#id47">3.4.  Client Seeks Authorization for Access</a><a class="headerlink" href="#client-seeks-authorization-for-access" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>クライアントが認可を求める</li>
</ul>
</div>
<p>In order to access a protected resource successfully,
a client needs to present a valid <em class="xref std std-term">RPT</em>
with sufficient authorization data for access.</p>
<p>To get to this stage requires a number of previously successful steps:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The authorization server issues <strong>client credentials</strong> to the client.</p>
<p>It is OPTIONAL for the <a class="reference internal" href="glossary.html#term-client-credentials"><em class="xref std std-term">client credentials</em></a> to be provided
dynamically through <a class="reference internal" href="#term-88"><em class="xref std std-term">[DynClientReg]</em></a>;
alternatively, they MAY use a static process.</p>
</li>
<li><p class="first">The client acquires an <em class="xref std std-term">AAT</em>.</p>
</li>
<li><p class="first">The client uses the <a class="reference internal" href="glossary.html#term-authorization-api"><em class="xref std std-term">authorization API</em></a> to acquire an RPT.</p>
<p>See <a class="reference internal" href="#uma-core-3-4-1"><em>Section 3.4.1</em></a> for more detail.</p>
</li>
<li><p class="first">The client uses authorization API to ask for authorization,
providing the <a class="reference internal" href="#term-permission-ticket"><em class="xref std std-term">permission ticket</em></a> it got from the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>.</p>
<p>The authorization server associates <a class="reference internal" href="#term-authorization-data"><em class="xref std std-term">authorization data</em></a>
with the client&#8217;s <em class="xref std std-term">RPT</em> based on the <a class="reference internal" href="#term-permission-ticket"><em class="xref std std-term">permission ticket</em></a>,
the <a class="reference internal" href="#term-resource-owner"><em class="xref std std-term">resource owner</em></a>&#8216;s operative policies,
and the results of any claims-gathering flows.</p>
<p>See <a class="reference internal" href="#uma-core-3-4-2"><em>Section 3.4.2</em></a> for more detail.</p>
</li>
</ol>
</div></blockquote>
<p>( draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09</a> )</p>
<div class="section" id="client-obtains-rpt">
<span id="uma-core-3-4-1"></span><h4><a class="toc-backref" href="#id48">3.4.1. Client Obtains RPT</a><a class="headerlink" href="#client-obtains-rpt" title="Permalink to this headline">¶</a></h4>
<p>The client might need an RPT
if it has never before requested an RPT
for this combination of requesting party,
resource server, and authorization server,
or if it has lost control of a previously issued RPT
and needs a refreshed one.</p>
<p>It obtains an RPT by using the authorization API,
performing a POST on the RPT endpoint
and supplying its AAT in the header.</p>
<p>No body is expected;
if a body is present, the authorization server MAY ignore it.</p>
<p>Example of a request message containing an AAT:</p>
<div class="highlight-python"><pre>POST /rpt HTTP/1.1
Host: as.example.com
Authorization: Bearer jwfLG53^sad$#f
...</pre>
</div>
<p>The authorization server responds with an HTTP 201 (Created) status
code and provides a new RPT.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/json

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv"
}</pre>
</div>
<p>If the AAT provided in the header is the same as one provided
for a previously issued still-valid RPT by this authorization server,
the authorization server invalidates the old RPT and issues a new one.</p>
<p>On first issuance,
the RPT is associated with no authorization data
and thus does not convey any authorizations for access.</p>
<p>(draft09, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.4.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.4.1</a>)</p>
</div>
<div class="section" id="client-asks-for-authorization-data">
<span id="uma-core-3-4-2"></span><h4><a class="toc-backref" href="#id49">3.4.2.  Client Asks for Authorization Data</a><a class="headerlink" href="#client-asks-for-authorization-data" title="Permalink to this headline">¶</a></h4>
<p>Once in possession of an <em class="xref std std-term">AAT</em> for this authorization server,
an RPT that applies to this requesting party for this resource server
and this authorization server,
and a permission ticket,
the client uses the authorization API to ask the authorization server
to give it suitable authorization data for the sought-for access.</p>
<p>It performs a POST on the authorization request endpoint,
supplying its own AAT in the header and its <em class="xref std std-term">RPT</em> and the permission ticket
in a JSON object with properties &#8220;rpt&#8221; and ticket&#8221; respectively.</p>
<p>Example of a request message containing an AAT, an RPT,
and a permission ticket:</p>
<div class="highlight-python"><pre>POST /authz_request HTTP/1.1
Host: as.example.com
Authorization: Bearer jwfLG53^sad$#f
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>The authorization server uses the ticket to look up the details of
the previously registered requested permission, maps the requested
permission to operative resource owner policies based on the resource
set identifier and scopes in it, undergoes any claims-gathering flows
required (see Section 3.5), and ultimately responds to the request.
The resource owner&#8217;s policies at the authorization server amount to
an implicit authorization grant in governing the issuance of
authorization data.  (The authorization server is also free to enable
the resource owner to set policies that require the owner to provide
a run-time authorization grant in the form of a consent interaction,
mediated by the authorization server.  This setting of policies and
gathering of consent is outside the scope of this specification.)</p>
<p>The authorization server MUST base the addition of authorization data
to RPTs on user policies.</p>
<p>The nature of these policies is outside the scope of UMA,
but generally speaking,
they can be thought of as either independent of requesting-party features
(for example, time of day)
or dependent on requesting-party features
(for example, whether they are over 18).</p>
<p>Such requesting-party features can potentially be
collected in a claims-gathering flow.</p>
<p>If the authorization server does not add the requested authorization data,
it responds using the appropriate HTTP status code
and UMA error code (see <a class="reference internal" href="#uma-core-4-2"><em>Section 4.2</em></a>):</p>
<dl class="glossary docutils">
<dt id="term-invalid-ticket">invalid_ticket</dt>
<dd><p class="first">The provided ticket was not found at the authorization server.</p>
<p class="last">The authorization server SHOULD respond
with the HTTP 400 (Bad Request) status code.</p>
</dd>
<dt id="term-expired-ticket">expired_ticket</dt>
<dd>The provided ticket has expired.  The authorization
server SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-not-authorized-permission">not_authorized_permission</dt>
<dd><p class="first">The client is definitively not authorized
for this authorization according to user policy.</p>
<p class="last">The authorization server SHOULD respond with the HTTP 403
(Forbidden) status code.</p>
</dd>
<dt id="term-need-claims">need_claims</dt>
<dd><p class="first">The authorization server is unable to determine
whether the client is authorized for this permission without gathering
claims from the requesting party.</p>
<p>The authorization server SHOULD
respond with the HTTP 403 (Forbidden) status code.</p>
<p class="last">The client is therefore not authorized,
but has the opportunity to engage its operator
&#8211; the requesting party &#8211; in a claims-gathering flow
with the authorization server (see <a class="reference internal" href="#uma-core-3-5"><em>Section 3.5</em></a>)
to continue
seeking authorization.</p>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_ticket"
}</pre>
</div>
<p>(draft09,  <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.4.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-09#section-3.4.2</a>)</p>
</div>
<div class="section" id="uma-core-3-4-3">
<span id="id3"></span><h4><a class="toc-backref" href="#id50">3.4.3. Client Asks for Authorization Data</a><a class="headerlink" href="#uma-core-3-4-3" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>パーミションを要求</li>
<li>成功したら 200 OK が返る、って書いた方がいいんじゃない？</li>
</ul>
</div>
<p>Once in possession of an AAT for this authorization server,
an RPT that applies to this requesting party for this resource server
and this authorization server,
and a permission ticket,
the client asks the authorization server to give it suitable authorization data
for the sought-for access.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">Permission Request Endpoint でパーミッション要求する</p>
<blockquote>
<div><ul class="simple">
<li>AAT</li>
<li>RPT</li>
<li>permission ticket ( <a class="reference internal" href="#uma-core-3-2"><em>3.2.  Resource Server Registers Requested Permission With Authorization Server</em></a> )</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<p>The client performs a POST on the <em class="xref std std-term">permission request endpoint</em>,
supplying the items below.</p>
<p>The client MUST provide its own AAT in the header.</p>
<blockquote>
<div><ul class="simple">
<li>The <strong>permission ticket</strong> it received from the resource server</li>
<li>Its <em class="xref std std-term">RPT</em> for this resource server</li>
<li>Its own <em class="xref std std-term">AAT</em> in the header</li>
</ul>
</div></blockquote>
<p>Example of a request message containing a <a class="reference internal" href="#term-permission-ticket"><em class="xref std std-term">permission ticket</em></a> and RPT:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>In this interaction,
the client uses the authorization server&#8217;s <em class="xref std std-term">permission request endpoint</em>.</p>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> uses the <em class="xref std std-term">ticket</em> to look up the details of
the previously registered permission,
maps the requested permission to operative resource owner policies,
undergoes any authorization flows required (see <a class="reference internal" href="#uma-core-3-5"><em>Section 3.5</em></a>),
and ultimately responds to the request positively or negatively.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OK(200)かNG(401,400)を返す</li>
</ul>
</div>
<p>The resource owner&#8217;s policies at the authorization server amount
to an implicit authorization grant in governing the issuance of authorization data.
(The authorization server is also free to enable resource owners to set policies that
require them to provide a run-time explicit authorization grant mediated by the authorization server.
This setting of policies and gathering of authorization grants is outside the scope of this specification.)</p>
<p>If the request fails due to an invalid, missing, or expired AAT (or RPT)
or requires higher privileges at this endpoint than provided by the AAT,
the authorization server responds with an OAuth error (see <a class="reference internal" href="#uma-core-4-1"><em>Section 4.1</em></a>).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"</pre>
</div>
<p>If the authorization server does not add the requested authorization data,
it responds using the appropriate HTTP status code (typically 400 or 403),
and includes one of the following error codes in the response (see <a class="reference internal" href="#uma-core-4-2"><em>Section 4.2</em></a>):</p>
<blockquote>
<div><dl class="docutils">
<dt>invalid_requester_ticket  The provided ticket was not found at the</dt>
<dd>authorization server.  The authorization server SHOULD respond
with the HTTP 400 (Bad Request) status code.</dd>
<dt>expired_requester_ticket  The provided ticket has expired.  The</dt>
<dd>authorization server SHOULD respond with the HTTP 400 (Bad
Request) status code.</dd>
<dt>not_authorized_permission  The client is definitively not authorized</dt>
<dd>for this authorization according to user policy.  The
authorization server SHOULD respond with the HTTP 403 (Forbidden)
status code.</dd>
<dt>need_claims  The authorization server is unable to determine whether</dt>
<dd><p class="first">the client is authorized for this permission
without gathering claims from the requesting party.</p>
<p class="last">The authorization server SHOULD respond with the HTTP 403 (Forbidden) status code.
The client is therefore not authorized,
but has the opportunity to engage its operator &#8211; the requesting party &#8211;
in a claims-gathering flow with the authorization server
(see <a class="reference internal" href="#uma-core-3-5"><em>Section 3.5</em></a>) to potentially become authorized.</p>
</dd>
</dl>
</div></blockquote>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_requester_ticket"
}</pre>
</div>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.3</a> )</p>
</div>
<div class="section" id="requester-obtains-requester-permission-token">
<span id="uma-core-3-4-4"></span><h4><a class="toc-backref" href="#id51">3.4.4.  Requester Obtains Requester Permission Token</a><a class="headerlink" href="#requester-obtains-requester-permission-token" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>RPT</li>
</ul>
</div>
<p>In this step,
if the <em class="xref std std-term">requester</em> needs an RPT that applies to this <a class="reference internal" href="#term-requesting-party"><em class="xref std std-term">requesting party</em></a>
for this <a class="reference internal" href="glossary.html#term-host"><em class="xref std std-term">host</em></a> and this AM,
the <em class="xref std std-term">requester</em> obtains an RPT from the AM.</p>
<p>On first issuance the RPT is associated with no permissions and
thus does not convey any authorizations for access.</p>
<p>Once the <em class="xref std std-term">requester</em> obtains an RPT from the AM,
it can ask the AM for authorization to have permissions associated with the RPT
(see <a class="reference internal" href="#uma-core-3-4-5"><em>Section 3.4.5</em></a>).</p>
<p>The <em class="xref std std-term">requester</em> performs a POST on the <em class="xref std std-term">RPT endpoint</em>.
In doing so
the <em class="xref std std-term">requester</em> MUST provide its own <em class="xref std std-term">AAT</em> in the header in order to gain
access to the <em class="xref std std-term">RPT endpoint</em>.</p>
<p>Example of a request message containing an AAT:</p>
<div class="highlight-python"><pre>POST /rpt HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
Content-Type: application/json
...</pre>
</div>
<p>The AM responds with an HTTP 201 (Created) status code and provides a new RPT.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-rpt+json

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv"
}</pre>
</div>
<p>If the content-type of the request is not recognized by the AM, the
AM MUST produce an HTTP error.</p>
<p>The requester might need an RPT if it has never before requested an
RPT for this combination of requesting party, host, and AM, or if it
has lost control of a previous issued RPT and needs a refreshed one.
If the AAT provided in the header is the same as one provided for a
previously issued RPT by this AM, the AM invalidates the old RPT and
its permissions and issues a new RPT.</p>
<p>If the request fails due to missing or invalid parameters, or is
otherwise malformed, the AM SHOULD inform the requester of the error
by sending an HTTP error response.</p>
<p>If the request fails due to an invalid, missing, or expired AAT or
requires higher privileges at this endpoint than provided by the AAT,
the AM responds with an OAuth error (see Section 4.1).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="requester-asks-for-authorization-to-add-permission">
<span id="uma-core-3-4-5"></span><h4><a class="toc-backref" href="#id52">3.4.5.  Requester Asks for Authorization to Add Permission</a><a class="headerlink" href="#requester-asks-for-authorization-to-add-permission" title="Permalink to this headline">¶</a></h4>
<p>Once in possession of an AAT for this AM,
an RPT that applies to this <a class="reference internal" href="#term-requesting-party"><em class="xref std std-term">requesting party</em></a> for this <a class="reference internal" href="glossary.html#term-host"><em class="xref std std-term">host</em></a> and this AM,
and a <a class="reference internal" href="#term-permission-ticket"><em class="xref std std-term">permission ticket</em></a>,
the <em class="xref std std-term">requester</em> asks the AM to give it a permission for the sought-for access.
The requester performs a POST on the <em class="xref std std-term">permission request endpoint</em> at the AM,
supplying the items below.
In doing so
the requester MUST provide its own AAT
in order to gain access to the <em class="xref std std-term">permission request endpoint</em>.</p>
<ul class="simple">
<li>The permission ticket it received from the host</li>
<li>Its RPT for this host</li>
<li>Its own AAT in the header</li>
</ul>
<p>Example of a request message containing a permission ticket and RPT:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
Content-Type: application/json
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>In this interaction, the requester uses the AM&#8217;s permission request
endpoint.  The AM uses the ticket to look up the previously
registered permission, maps the requested permission to operative
user policies, undergoes any authorization flows required (see
Section 3.5), and ultimately responds to the request positively or
negatively.</p>
<p>If the request fails due to an invalid, missing, or expired AAT (or
RPT) or requires higher privileges at this endpoint than provided by
the AAT, the AM responds with an OAuth error (see Section 4.1).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"</pre>
</div>
<p>If the AM does not add the requested permission, it responds using
the appropriate HTTP status code (typically 400 or 403), and includes
one of the following error codes in the response (see Section 4.2):</p>
<dl class="glossary docutils">
<dt id="term-invalid-requester-ticket">invalid_requester_ticket</dt>
<dd>The provided ticket was not found at the AM.
The AM SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-expired-requester-ticket">expired_requester_ticket</dt>
<dd>The provided ticket has expired.
The AM SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-63">not_authorized_permission</dt>
<dd>The requester is definitively not
authorized for this permission according to user policy.
The AM SHOULD respond with the HTTP 403 (Forbidden) status code.</dd>
<dt id="term-64">need_claims</dt>
<dd>The AM is unable to determine whether the requester is
authorized for this permission without gathering claims from the
requesting party.  The AM SHOULD respond with the HTTP 403
(Forbidden) status code.  The requester is therefore not
authorized, but has the opportunity to engage the requesting party
in a claims-gathering flow with the AM (see Section 3.5) to
potentially become authorized.</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_requester_ticket"
}</pre>
</div>
<p>(draft 05)</p>
</div>
</div>
<div class="section" id="claims-gathering-flows">
<span id="uma-core-3-5"></span><h3><a class="toc-backref" href="#id53">3.5. Claims-Gathering Flows</a><a class="headerlink" href="#claims-gathering-flows" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>クレームを要求したり、渡したりする必要がある場合が考えられる</li>
<li>Requesting Party 固有のクレーム(年齢制限とか)と、それに依存しないクレームがある</li>
<li>Requesting Partyは個人、とそれ以外(ブラウザ、App、Bot...)</li>
</ul>
</div>
<p>The authorization server has a variety of options
for coming into possession of claims
in order to satisfy the resource owner&#8217;s policy;
this specification does not dictate a single answer.</p>
<p>For example,
the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> could interact
with the <a class="reference internal" href="#term-requesting-party"><em class="xref std std-term">requesting party</em></a> to gather claims,
or could accept claims delivered by a <a class="reference internal" href="#term-client"><em class="xref std std-term">client</em></a>,
or could perform a lookup in some external system.</p>
<p>The process for requesting and providing claims
is extensible and can have a variety of dependencies
on the type of requesting party
(for example, natural person or legal person)
and the type of client
(for example, browser, native app,
or autonomously running web service).</p>
<p>This specification provides a required framework
for extensibility through profiling.</p>
<p>The authorization server MAY support any number of claim profiles,
and SHOULD document the claim profiles it supports in its configuration data.</p>
<p>For the business-level and legal implications of different claim profiles,
see [UMA-obligations].  Optional claim profiles are defined in [UMAclaims].</p>
<p>A client is operated by an end-user in one of two typical situations:</p>
<ul class="simple">
<li>The requesting party is a natural person
(for example, a friend or family member of the resource owner);
the requesting party may even be the resource owner herself.</li>
<li>The requesting party is a legal person such as a corporation,
and the end-user operating the client is acting as an agent of that
legal person
(for example, a customer support specialist
representing a credit card company).</li>
</ul>
<p>Where a claim profile dictates end-user interaction,
a further variety of options is possible.</p>
<p>The end-user could be required to register for and/or log in
to an account or personal profile,
or fill in a questionnaire,
or complete a purchase.</p>
<p>Several of these operations could even be required,
where the order is treated as significant
for evaluating resource owner policies.</p>
<p>(draft09)</p>
</div>
<div class="section" id="authorization-flows">
<span id="uma-core-3-6"></span><h3><a class="toc-backref" href="#id54">3.6.  Authorization Flows</a><a class="headerlink" href="#authorization-flows" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a> MUST base its decisions to add permissions
to <a class="reference internal" href="glossary.html#term-requester-access-tokens"><em class="xref std std-term">requester access tokens</em></a> on <a class="reference internal" href="glossary.html#term-user-policies"><em class="xref std std-term">user policies</em></a>.
The nature of these policies is outside the scope of <a class="reference internal" href="glossary.html#term-uma"><em class="xref std std-term">UMA</em></a>,
but generally speaking,
they can be thought of
as either independent of requesting-party features (for example, time of day)
or dependent on requesting-party features
(for example, whether they are over 18).
This latter case requires the requesting party to
transmit identity claims to the AM in some fashion.</p>
<p>The process for requesting and providing claims is extensible
and may have a variety of dependencies on the type of requesting party
(for example, natural person or legal person)
and the type of requester application
(for example, browser, native app, or autonomously running web service).
UMA currently provides a framework for handling human-driven requester apps
and an optional solution for gathering standardized claims from that end-user,
and allows for extensions to support other solutions for this use case and other use cases.
The AM SHOULD document its claims-handling ability in its XRD configuration data
through the claim_types_supported property (see <a class="reference internal" href="#uma-core-1-5"><em>Section 1.5</em></a>).
For the business-level and legal implications of different technical authorization flows,
see [<em class="xref std std-term">UMA-trustmodel</em>].</p>
<p>(draft 03)</p>
<div class="section" id="authorization-flow-for-requester-apps-operated-by-end-users">
<span id="uma-core-3-6-1"></span><h4><a class="toc-backref" href="#id55">3.6.1.  Authorization Flow for Requester Apps Operated by End-Users</a><a class="headerlink" href="#authorization-flow-for-requester-apps-operated-by-end-users" title="Permalink to this headline">¶</a></h4>
<p>A requester app, whether browser-based or native, is operated by a
natural person (human end-user) in one of two typical situations:</p>
<blockquote>
<div><ul class="simple">
<li>The requesting party is a natural person (for example, a friend of
the authorizing user); the requesting party may even be the
authorizing user herself.</li>
<li>The requesting party is a legal person such as a corporation, and
the human being operating the requester app is acting as an agent
of that legal person (for example, a customer support specialist
representing a credit card company).</li>
</ul>
</div></blockquote>
<p>The AM has a variety of options at this point for satisfying the
authorizing user&#8217;s policy; this specification does not dictate a
single answer.  For example, the AM could require the end-user
operating the requester app to register for and/or log in to a local
AM account, or to fill in a questionnaire, or to complete a purchase.
It could even require several of these operations, where the order is
significant.</p>
<p>An end-user-driven requester app MUST redirect the end-user to the AM
to complete the process of authorization.  If the AM succeeds in
adding the requested permission, it MUST redirect the end-user
requesting party back to the requester app when reporting success.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
<div class="section" id="gathering-claims-from-requesting-end-users-with-openid-connect">
<span id="uma-core-3-6-1-1"></span><h5><a class="toc-backref" href="#id56">3.6.1.1.  Gathering Claims from Requesting End-Users with OpenID Connect</a><a class="headerlink" href="#gathering-claims-from-requesting-end-users-with-openid-connect" title="Permalink to this headline">¶</a></h5>
<p>An <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a> MAY use <a class="reference internal" href="glossary.html#term-openid-connect"><em class="xref std std-term">OpenID Connect</em></a>
as one means of gathering claims from an end-user requesting party,
leveraging <a class="reference internal" href="glossary.html#term-openid-connect"><em class="xref std std-term">OpenID Connect</em></a> mechanisms to transmit claims from distributed sources.
If it supports this option,
the <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a> MUST supply the &#8220;<a class="reference internal" href="messages.html#term-openid"><em class="xref std std-term">openid</em></a>&#8221; value for one of its <em class="xref std std-ref">claim_types_supported</em> values
in its <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a> configuration data (see <a class="reference internal" href="#uma-core-1-5"><em>Section 1.5</em></a> for how to formulate this data).</p>
<p>To conform to this option, the <em class="xref std std-ref">AM</em> MUST do the following:</p>
<blockquote>
<div><ul class="simple">
<li>Serve as a conforming OpenID Relying Party and Claims Client
according to [<em class="xref std std-term">OCStandard</em>]</li>
</ul>
<dl class="docutils">
<dt>o  Be able to utilize at least all of the reserved claims defined in</dt>
<dd>[<em class="xref std std-ref">OCMessages</em>] in assessing policy and granting permissions</dd>
</dl>
</div></blockquote>
<p>The AM can then use any conforming OpenID Connect mechanisms and
typical user interfaces for engaging with the UserInfo endpoints of
OpenID Providers and Claims Providers, potentially allowing for the
delivery of &#8220;trusted claims&#8221; (such as a verified email address or a
date or birth) on which authorization policy may depend.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
</div>
</div>
</div>
<div class="section" id="error-messages">
<span id="uma-core-4"></span><h2><a class="toc-backref" href="#id57">4.  Error Messages</a><a class="headerlink" href="#error-messages" title="Permalink to this headline">¶</a></h2>
<p>Ultimately the resource server is responsible for either granting the
access the client attempted, or returning an error response to the
client with a reason for the failure.  [OAuth2] defines several error
responses for a resource server to return.  UMA makes use of these
error responses, but requires the resource server to &#8220;outsource&#8221; the
determination of some error conditions to the authorization server.</p>
<p>This specification defines additional UMA-specific error responses
that the authorization server may give to the resource server and
client as they interact with it, and that the resource server may
give to the client.</p>
<p>(draft09)</p>
<div class="section" id="oauth-error-responses">
<span id="uma-core-4-1"></span><h3><a class="toc-backref" href="#id58">4.1.  OAuth Error Responses</a><a class="headerlink" href="#oauth-error-responses" title="Permalink to this headline">¶</a></h3>
<p>When a resource server or client
attempts to access one of the authorization server endpoints
or a client attempts to access a protected resource
at the resource server,
it has to make an authenticated request
by including an OAuth access token in the HTTP request
as described in [OAuth2] <a class="reference internal" href="oauth.html#oauth-7-2"><em>Section 7.2</em></a>.</p>
<p>If the request failed authentication,
the authorization server or the resource server responds
with an OAuth error message as described
throughout <a class="reference internal" href="#uma-core-2"><em>Section 2</em></a>
and <a class="reference internal" href="#uma-core-3"><em>Section 3</em></a>.</p>
<p>(draft09)</p>
</div>
<div class="section" id="uma-error-responses">
<span id="uma-core-4-2"></span><h3><a class="toc-backref" href="#id59">4.2.  UMA Error Responses</a><a class="headerlink" href="#uma-error-responses" title="Permalink to this headline">¶</a></h3>
<p>When a resource server or client attempts to access one of the
authorization server endpoints or a client attempts to access a
protected resource at the resource server, if the request is
successfully authenticated by OAuth means, but is invalid for another
reason, the authorization server or resource server responds with an
UMA error response by adding the following properties to the entity
body of the HTTP response:</p>
<dl class="glossary docutils">
<dt id="term-error-required-a-single-error-code-values-for-this-property-are">error  REQUIRED.  A single error code.  Values for this property are</dt>
<dd>defined throughout this specification.</dd>
<dt id="term-error-description-optional-human-readable-text-providing">error_description  OPTIONAL.  Human-readable text providing</dt>
<dd>additional information.</dd>
<dt id="term-error-uri-optional-a-uri-identifying-a-human-readable-web-page">error_uri  OPTIONAL.  A URI identifying a human-readable web page</dt>
<dd>with information about the error.</dd>
<dt id="term-the-following-is-a-common-error-code-that-applies-to-several-uma"><span id="term-specified-request-messages"></span><span id="term-invalid-request-the-request-is-missing-a-required-parameter"></span>The following is a common error code that applies to several UMA-<br />specified request messages:<br />invalid_request  The request is missing a required parameter,</dt>
<dd>includes an invalid parameter value, includes a parameter more
than once, or is otherwise malformed.  The authorization server
MUST respond with the HTTP 400 (Bad Request) status code.</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
...

{
  "error": "invalid_request",
  "error_description": "There is already a resource with this identifier.",
  "error_uri": "http://as.example.com/errors/resource_exists"
}</pre>
</div>
<p>(draft09)</p>
</div>
</div>
<div class="section" id="profiles-for-api-extensibility">
<span id="uma-core-5"></span><h2><a class="toc-backref" href="#id60">5.  Profiles for API Extensibility</a><a class="headerlink" href="#profiles-for-api-extensibility" title="Permalink to this headline">¶</a></h2>
<p>In some circumstances, it is desirable to couple UMA roles tightly.
For example, an authorization server application might also need to
act as a client application in order to retrieve protected resources
so that it can present to resource owners a dashboard-like user
interface that accurately guides the setting of policy; it might need
to access itself-as-authorization server for that purpose.  For
another example, the same organization might operate both an
authorization server and a resource server that communicate only with
each other behind a firewall, and it might seek more efficient
communication methods between them.</p>
<p>This section defines profiles that allow inter-role communications
channels and methods to vary in these specific circumstances.  This
specification still REQUIRES authorization servers to issue PATs,
AATs, and RPTs and associate authorization data with RPTs, and
REQUIRES resource servers to give clients access only when RPTs are
associated with sufficient authorization data.  This is because,
although tokens might not always appear on the wire in the normal
fashion in these cases, they represent binding obligations that might
involve additional parties unable to take part in these optimization
opportunities (see [UMA-obligations]).</p>
<p>In circumstances where alternate communications channels are being
used between independently implemented system entities, it is
RECOMMENDED, for reasons of implementation interoperability, to
define concrete extension profiles that build on these extensibility
profiles (see Section 6.1).</p>
<p>An authorization server using any of the opportunities afforded by
the protection and/or authorization API extensibility profile MUST
declare use of each profile by supplying the relevant
&#8220;uma_profiles_supported&#8221; values in its configuration data (see
Section 1.4).</p>
<p>(draft099</p>
<div class="section" id="protection-api-extensibility-profile">
<span id="uma-core-5-1"></span><h3><a class="toc-backref" href="#id61">5.1.  Protection API Extensibility Profile</a><a class="headerlink" href="#protection-api-extensibility-profile" title="Permalink to this headline">¶</a></h3>
<p>This section defines a profile for UMA where the authorization server
and resource server roles either reside in the same system entity or
otherwise have a privileged communications channel between them.
Following is a summary:</p>
<ul class="simple">
<li>Identifying URI: <a class="reference external" href="http://docs.kantarainitiative.org/uma/profiles/">http://docs.kantarainitiative.org/uma/profiles/</a>
prot-ext-1.0</li>
<li>Profile author and contact information: Mark Dobrinic
(<a class="reference external" href="mailto:mdobrinic&#37;&#52;&#48;cozmanova&#46;com">mdobrinic<span>&#64;</span>cozmanova<span>&#46;</span>com</a>)</li>
<li>Updates or obsoletes: None; this profile is new.</li>
<li>Security considerations: If the entities do not use TLS but
communicate across a transport layer as opposed to using internal
same-entity communication, it is STRONGLY RECOMMENDED to use an
alternate means of transport-layer security.</li>
<li>Privacy considerations: If the relationship between the roles is
established in a manner that does not involve the resource owner
at all, they each may maliciously leverage this relationship to
observe the resource owner&#8217;s personally identifiable information
held in each system.</li>
<li>Error states: See below.</li>
<li>Binding obligations: Any applicable binding obligations are
documented in [UMA-obligations].</li>
</ul>
<p>Using this profile, the resource server MAY use means other than the
TLS- and OAuth-protected HTTP-based protection API to communicate
with the authorization server.  This involves the following
opportunities:</p>
<ul class="simple">
<li>A PAT MAY be issued
without requiring an OAuth flow to establish one.</li>
<li>Resource sets MAY be registered (or configured) without requiring
explicit use of the resource set registration endpoint or
presentation of a PAT in any registration request.</li>
<li>Registration of requested permissions MAY be accomplished without
requiring explicit use of the permission registration endpoint or
presentation of a PAT in any registration request.</li>
<li>RPT introspection MAY be accomplished without requiring explicit
use of the token introspection endpoint or presentation of a PAT
in any introspection request.</li>
<li>Error states MAY arise and be reported in a different fashion from
any HTTP-, OAuth-, and UMA-defined errors related to the
protection API.</li>
</ul>
<p>An authorization server using any of the opportunities afforded by
this profile MUST declare use of this profile by supplying the &#8220;prot-
ext-1.0&#8221; value for one of its &#8220;uma_profiles_supported&#8221; values in its
configuration data (see Section 1.4).</p>
<p>(draft09)</p>
</div>
<div class="section" id="authorization-api-extensibility-profile">
<span id="uma-core-5-2"></span><h3><a class="toc-backref" href="#id62">5.2.  Authorization API Extensibility Profile</a><a class="headerlink" href="#authorization-api-extensibility-profile" title="Permalink to this headline">¶</a></h3>
<p>This section defines a profile for UMA where the authorization server
and client roles either reside in the same system entity or otherwise
have a privileged communications channel between them.  Following is
a summary:</p>
<ul class="simple">
<li>Identifying URI: <a class="reference external" href="http://docs.kantarainitiative.org/uma/profiles/">http://docs.kantarainitiative.org/uma/profiles/</a>
authz-ext-1.0</li>
<li>Profile author and contact information: Mark Dobrinic
(<a class="reference external" href="mailto:mdobrinic&#37;&#52;&#48;cozmanova&#46;com">mdobrinic<span>&#64;</span>cozmanova<span>&#46;</span>com</a>)</li>
<li>Updates or obsoletes: None; this profile is new.</li>
<li>Security considerations: If the entities do not use TLS but
communicate across a transport layer as opposed to using internal
same-entity communication, it is STRONGLY RECOMMENDED to use an
alternate means of transport-layer security.</li>
<li>Privacy considerations: If the relationship between the roles is
established in a manner that does not involve the requesting party
at all, they each may maliciously leverage this relationship to
observe the requesting party&#8217;s personally identifiable information
held in each system.</li>
<li>Error states: See below.</li>
<li>Binding obligations: Any applicable binding obligations are
documented in [UMA-obligations].</li>
</ul>
<p>Using this profile, the resource server MAY use means other than the
TLS- and OAuth-protected HTTP-based authorization API to communicate
with the authorization server.  This involves the following
opportunities:</p>
<ul class="simple">
<li>An AAT MAY be issued without requiring an OAuth flow to establish
one.</li>
<li>An RPT MAY be issued without requiring explicit use of the RPT
endpoint or presentation of an AAT in any RPT request.</li>
<li>Authorization data MAY be associated with the RPT without
requiring explicit use of the authorization request endpoint or
presentation of an AAT, RPT, or ticket in any request.</li>
<li>The client MAY use alternate means of initating a claims-gathering
flow with the authorization server.  (Any further profiling of
this profile might involve a claim profile as well; see
Section 6.3.)</li>
<li>Error states MAY arise and be reported in a different fashion from
any HTTP-, OAuth-, and UMA-defined errors related to the
authorization API.</li>
</ul>
<p>An authorization server using any of the opportunities afforded by
this profile MUST declare use of this profile by supplying the
&#8220;authz-ext-1.0&#8221; value for one of its &#8220;uma_profiles_supported&#8221; values
in its configuration data (see Section 1.4).</p>
<p>(draft09)</p>
</div>
<div class="section" id="resource-interface-extensibility-profile">
<span id="uma-core-5-3"></span><h3><a class="toc-backref" href="#id63">5.3.  Resource Interface Extensibility Profile</a><a class="headerlink" href="#resource-interface-extensibility-profile" title="Permalink to this headline">¶</a></h3>
<p>This section defines a profile for UMA where the resource server and
client roles either reside in the same system entity or otherwise
have a privileged communications channel between them.  Following is
a summary:</p>
<ul class="simple">
<li>Identifying URI: <a class="reference external" href="http://docs.kantarainitiative.org/uma/profiles/rsrc-ext-1.0">http://docs.kantarainitiative.org/uma/profiles/rsrc-ext-1.0</a></li>
<li>Profile author and contact information: Mark Dobrinic
(<a class="reference external" href="mailto:mdobrinic&#37;&#52;&#48;cozmanova&#46;com">mdobrinic<span>&#64;</span>cozmanova<span>&#46;</span>com</a>)</li>
<li>Updates or obsoletes: None; this profile is new.</li>
<li>Security considerations: If the entities do not use TLS but
communicate across a transport layer as opposed to using internal
same-entity communication, it is STRONGLY RECOMMENDED to use an
alternate means of transport-layer security.</li>
<li>Privacy considerations: If the relationship between the roles is
established in a manner that does not involve the authorization
server at all, they each may maliciously leverage this
relationship to observe the resource owner&#8217;s or requesting party&#8217;s
personally identifiable information held in each system.</li>
<li>Error states: See below.</li>
<li>Binding obligations: Any applicable binding obligations are
documented in [UMA-obligations].</li>
</ul>
<p>Using this profile, the resource server MAY use means other than an
HTTP-based resource interface to communicate with the authorization
server.  This involves the following opportunities:</p>
<ul class="simple">
<li>Resource access attempts MAY be accomplished without requiring
explicit use of the HTTP-based endpoint or presentation of an RPT.</li>
<li>Error states MAY arise and be reported in a different fashion from
any HTTP-, OAuth-, and UMA-defined errors related to the protected
resource&#8217;s interface.</li>
</ul>
<p>An authorization server involved in deployments where resource
servers and clients are known to be using opportunities afforded by
the resource interface extensibility profile MAY declare use of this
profile by supplying the &#8220;rsrc-ext-1.0&#8221; value for one of its
&#8220;uma_profiles_supported&#8221; values in its configuration data (see
Section 1.4).</p>
<p>(draft09)</p>
</div>
</div>
<div class="section" id="specifying-additional-profiles">
<span id="uma-core-6"></span><h2><a class="toc-backref" href="#id64">6.  Specifying Additional Profiles</a><a class="headerlink" href="#specifying-additional-profiles" title="Permalink to this headline">¶</a></h2>
<p>This specification defines a protocol that has optional features.
For implementation interoperability and to serve particular
deployment scenarios, including sector-specific ones such as
healthcare or e-government, third parties may want to define profiles
of UMA that restrict these options.</p>
<p>Further, this specification creates extensibility points for RPT
profiles and claim profiles, and third parties may likewise want to
define their own.  Different RPT profiles could be used, for example,
to change the dividing line between authorization server and resource
server responsibilities in controlling access.  Different claim
profiles could be used to customize sector-specific or population-
specific (such as individual vs. employee) claim types that drive the
types of policies resource owners could set.</p>
<p>It is not practical for this specification to standardize all desired
profiles.  However, to serve overall interoperability goals, the
following sections provide guidelines for third parties that wish to
specify UMA-related profiles.</p>
<p>(draft09)</p>
<div class="section" id="specifying-profiles-of-uma">
<span id="uma-core-6-1"></span><h3><a class="toc-backref" href="#id65">6.1.  Specifying Profiles of UMA</a><a class="headerlink" href="#specifying-profiles-of-uma" title="Permalink to this headline">¶</a></h3>
<p>It is RECOMMENDED that profiles of UMA document the following
information:</p>
<ol class="arabic simple">
<li>Specify a URI that uniquely identifies the profile.</li>
<li>Identify the responsible author and provide postal or electronic
contact information.</li>
<li>Supply references to previously defined profiles that the profile
updates or obsoletes.</li>
<li>Specify the set of interactions between endpoint entites involved
in the profile, calling out any restrictions on ordinary UMA-
conformant operations and any extension properties used in
message formats.</li>
<li>Identify the legally responsible parties involved in each
interaction and any new obligations imposed, in the fashion of
[UMA-obligations].</li>
<li>Define any additional or changed error states.</li>
<li>Supply any additional security and privacy considerations,
including analysis of threats and description of countermeasures.</li>
<li>Specify any conformance considerations.</li>
</ol>
<p>See Section 5 for examples.</p>
<p>(draft09)</p>
</div>
<div class="section" id="specifying-rpt-profiles">
<span id="uma-core-6-2"></span><h3><a class="toc-backref" href="#id66">6.2.  Specifying RPT Profiles</a><a class="headerlink" href="#specifying-rpt-profiles" title="Permalink to this headline">¶</a></h3>
<p>It is RECOMMENDED that RPT profiles document the following
information:</p>
<ol class="arabic simple">
<li>Specify a URI that uniquely identifies the token profile.</li>
<li>Identify the responsible author and provide postal or electronic
contact information.</li>
<li>Supply references to previously defined token profiles that the
token profile updates or obsoletes.</li>
<li>Specify the keyword to be used in HTTP Authorization headers
with tokens conforming to this profile.</li>
<li>Specify the syntax and semantics of the data that the
authorization server associates with the token.</li>
<li>Specify how the token data is associated with, contained within,
and/or retrieved by means of, the on-the-wire token string.</li>
<li>Specify processing rules for token data.</li>
<li>Identify any restrictions on grant types to be used with the
token profile.</li>
<li>Define any additional or changed error states.</li>
<li>Supply any additional security and privacy considerations.</li>
<li>Specify any obligations specific to the token profile, in the
fashion of [UMA-obligations].</li>
<li>Specify any conformance considerations.</li>
</ol>
<p>See Section 3.3.2 for an example.</p>
<p>(draft09)</p>
</div>
<div class="section" id="specifying-claim-profiles">
<span id="uma-core-6-3"></span><h3><a class="toc-backref" href="#id67">6.3.  Specifying Claim Profiles</a><a class="headerlink" href="#specifying-claim-profiles" title="Permalink to this headline">¶</a></h3>
<p>In addition to any requirements listed in Section 3.5, it is
RECOMMENDED that claim profiles document the following information:</p>
<ol class="arabic simple">
<li>Specify a URI that uniquely identifies the claim profile.</li>
<li>Identify the responsible author and provide postal or electronic
contact information.</li>
<li>Supply references to previously defined claim profiles that the
claim profile updates or obsoletes.</li>
<li>Specify the syntax and semantics of claim data and requests for
claim data.</li>
<li>Specify how an authorization server gathers the claims.</li>
<li>Define any additional or changed error states.</li>
<li>Supply any additional security and privacy considerations.</li>
<li>Specify any obligations specific to the claim profile, in the
fashion of [UMA-obligations].</li>
<li>Specify any conformance considerations.</li>
</ol>
<p>See <a class="reference internal" href="#term-umaclaims"><em class="xref std std-term">[UMAclaims]</em></a> for examples.</p>
<p>(draft09)</p>
</div>
</div>
<div class="section" id="security-considerations">
<span id="uma-core-7"></span><h2><a class="toc-backref" href="#id68">7.  Security Considerations</a><a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>This specification relies mainly on OAuth security mechanisms as well
as transport-level encryption for protecting the protection and
authorization API endpoints.  Most PATs and AATs are likely to use
OAuth bearer tokens.  See [OAuth-threat] for more information.</p>
<p>This specification defines a number of JSON-based data formats.  As a
subset of the JavaScript scripting language, JSON data SHOULD be
consumed through a process that does not dynamically execute it as
code, to avoid malicious code execution.  One way to achieve this is
to use a JavaScript interpreter rather than the built-in JavaScript
eval() function.</p>
<p>The issue of impersonation is a crucial aspect in UMA, particularly
when entities are wielding bearer tokens that preclude proof-of-
possession (of a secret or a cryptographic key).  As such, one way to
mitigate this risk is for the resource owner to require stronger
claims to accompany any access request.  For example, consider the
case where Alice sets policies at the authorization server governing
access to her resources by Bob. When Bob first seeks access and must
obtain an RPT (for which the default RPT profile specifies a bearer
token), Alice could set policies demanding that Bob prove his
identity by providing a set of strong claims issued by a trusted
attribute provider in order to get authorization data associated with
that token.</p>
<p>Another issue concerns the use of the [OAuth2] implicit flow.  In
this case, Bob will have exposure to the token, and may maliciously
pass the token to an unauthorized party.  To mitigate this weakness
and others, we recommend considering the following steps:</p>
<dl class="docutils">
<dt>o  Require that the Requesting Party (as defined in</dt>
<dd>[UMA-obligations], meaning this party is able to take on legal
obligations) legitimately represent the wielder of the bearer
token.  This solution is based on a legal or contractual approach,
and therefore does not reduce the risk from the technical
perspective.</dd>
<dt>o  The authorization server, possibly with input from the resource</dt>
<dd>owner, can implement tighter time-to-live strategies around the
authorization data in RPTs.  This is a classic approach with
bearer tokens that helps to limit a malicious party&#8217;s ability to
intercept and use the bearer token.  In the same vein, the
authorization server could require claims to have a reasonable
degree of freshness (which would require a custom claims profile).</dd>
<dt>o  The strongest strategy is to disallow bearer-type RPTs within the</dt>
<dd>UMA profile being deployed, by providing or requiring an RPT
profile that requires use of a holder-of-key approach.  In this
way, the wielder of the token must engage in a live session for
proof-of-possession.</dd>
</dl>
<p>For information about the additional technical, operational, and
legal elements of trust establishment between UMA entities and
parties, which affects security considerations, see
[UMA-obligations].</p>
<p>(draft09)</p>
</div>
<div class="section" id="privacy-considerations">
<span id="uma-core-8"></span><h2><a class="toc-backref" href="#id69">8.  Privacy Considerations</a><a class="headerlink" href="#privacy-considerations" title="Permalink to this headline">¶</a></h2>
<p>The authorization server comes to be in possession of resource set
information (such as names and icons) that may reveal information
about the resource owner, which the authorization server&#8217;s trust
relationship with the resource server is assumed to accommodate.
However, the client is a less-trusted party &#8211; in fact, entirely
untrustworthy until authorization data is associated with its RPT.
This specification depends on [OAuth-resource-reg], which recommends
obscuring resource set identifiers in order to avoid leaking
personally identifiable information to clients through the scope
mechanism.</p>
<p>For information about the technical, operational, and legal elements
of trust establishment between UMA entities and parties, which
affects privacy considerations, see [UMA-obligations].</p>
<p>Additional considerations
related to Privacy by Design concepts are discussed in <a class="reference internal" href="#term-uma-pbd"><em class="xref std std-term">[UMA-PbD]</em></a>.</p>
<p>(draft09)</p>
</div>
<div class="section" id="conformance">
<span id="uma-core-9"></span><h2><a class="toc-backref" href="#id70">9.  Conformance</a><a class="headerlink" href="#conformance" title="Permalink to this headline">¶</a></h2>
<p>This section outlines conformance requirements for various entities
implementing UMA endpoints.</p>
<p>This specification has dependencies on other specifications, as
referenced under the normative references listed in this
specification.</p>
<p>Its dependencies on some specifications,
such as OpenID Connect ([OIDCCore]), are optional depending
on whether the feature in question is used in the implementation.</p>
<p>The authorization server&#8217;s configuration data provides a machine-
readable method for it to indicate certain of the conformance options
it supports.  Several of the configuration data properties allow for
indicating extension features.  Where this specification does not
already require optional features to be documented, it is RECOMMENDED
that authorization server developers and deployers document any
profiled or extended features explicitly and use configuration data
to indicate their usage.  See Section 1.4 for information about
providing and extending the configuration data.</p>
<p>(draft09)</p>
</div>
<div class="section" id="iana-considerations">
<span id="uma-core-10"></span><h2><a class="toc-backref" href="#id71">10.  IANA Considerations</a><a class="headerlink" href="#iana-considerations" title="Permalink to this headline">¶</a></h2>
<p>This document makes no request of IANA.</p>
<p>(draft09)</p>
</div>
<div class="section" id="acknowledgments">
<span id="uma-core-11"></span><h2><a class="toc-backref" href="#id72">11.  Acknowledgments</a><a class="headerlink" href="#acknowledgments" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The current editor of this specification is Thomas Hardjono of MIT.
The following people are co-authors:</p>
<p>o  Paul C. Bryan, ForgeRock US, Inc. (former editor)</p>
<p>o  Domenico Catalano, Oracle Corp.</p>
<p>o  George Fletcher, AOL</p>
<p>o  Maciej Machulak, Newcastle University</p>
<p>o  Eve Maler, XMLgrrl.com</p>
<p>o  Lukasz Moren, Newcastle University</p>
<p>o  Christian Scholz, COMlounge GmbH (former editor)</p>
<p>o  Jacek Szpot, Newcastle University</p>
<p>Additional contributors to this specification include the Kantara UMA
Work Group participants, a list of whom can be found at
[UMAnitarians].</p>
</div></blockquote>
<p>(draft 05)</p>
</div>
<div class="section" id="issues">
<span id="uma-core-12"></span><h2><a class="toc-backref" href="#id73">12.  Issues</a><a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>All issues are now captured at the project&#8217;s GitHub site
(&lt;<a class="reference external" href="https://github.com/xmlgrrl/UMA-Specifications/issues">https://github.com/xmlgrrl/UMA-Specifications/issues</a>&gt;).</div></blockquote>
<p>(draft 05)</p>
<div class="section" id="normative-references">
<span id="uma-core-12-1"></span><h3><a class="toc-backref" href="#id74">12.1.  Normative References</a><a class="headerlink" href="#normative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-dynclientreg">[DynClientReg]</dt>
<dd>Richer, J., &#8220;OAuth Dynamic Client Registration Protocol&#8221;,
November 2012, &lt;<a class="reference external" href="https://datatracker.ietf.org/doc/">https://datatracker.ietf.org/doc/</a>
draft-ietf-oauth-dyn-reg/&gt;.</dd>
<dt id="term-oauth-saml">[OAuth-SAML]</dt>
<dd>Campbell, B., &#8220;SAML 2.0 Bearer Assertion Profiles for
OAuth 2.0&#8221;, November 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/">http://tools.ietf.org/html/</a>
draft-ietf-oauth-saml2-bearer&gt;.</dd>
<dt id="term-oauth-bearer">[OAuth-bearer]</dt>
<dd>&#8220;The OAuth 2.0 Authorization Framework: Bearer Token
Usage&#8221;, October 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6750">http://tools.ietf.org/html/rfc6750</a>&gt;.</dd>
<dt id="term-oauth-introspection">[OAuth-introspection]</dt>
<dd>Richer, J., &#8220;OAuth Token Introspection&#8221;, November 2012, &lt;h
ttp://tools.ietf.org/html/
draft-richer-oauth-introspection&gt;.</dd>
<dt id="term-oauth-resource-reg">[OAuth-resource-reg]</dt>
<dd>Hardjono, T., &#8220;OAuth 2.0 Resource Set Registration&#8221;,
December 2012.</dd>
<dt id="term-oauth2">[OAuth2]</dt>
<dd>Hardt, D., &#8220;The OAuth 2.0 Authorization Framework&#8221;,
October 2012, &lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6749">http://tools.ietf.org/html/rfc6749</a>&gt;.</dd>
<dt id="term-ocmessages">[OCMessages]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Messages 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-messages-1_0.html&gt;.</dd>
<dt id="term-ocstandard">[OCStandard]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Standard 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-standard-1_0.html&gt;.</dd>
<dt id="term-rfc2119">[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt id="term-rfc4627">[RFC4627]</dt>
<dd>Crockford, D., &#8220;The application/json Media Type for
JavaScript Object Notation (JSON)&#8221;, RFC 4627, July 2006.</dd>
<dt id="term-rfc6415">[RFC6415]</dt>
<dd>Hammer-Lahav, E., &#8220;Web Host Metadata&#8221;, October 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6415">http://tools.ietf.org/html/rfc6415</a>&gt;.</dd>
<dt id="term-uma-obligations">[UMA-obligations]</dt>
<dd>Maler, E., &#8220;<a class="reference internal" href="uma_trust.html"><em>Binding Obligations on UMA Participants</em></a>&#8221;,
April 2012,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model">http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model</a>&gt;.</dd>
</dl>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.1</a> )</p>
</div>
<div class="section" id="informative-references">
<span id="uma-core-12-2"></span><h3><a class="toc-backref" href="#id75">12.2.  Informative References</a><a class="headerlink" href="#informative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-oauth-linktypes">[OAuth-linktypes]</dt>
<dd>Mills, W., &#8220;Link Type Registrations for OAuth 2&#8221;,
October 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-wmills-oauth-lrdd">http://tools.ietf.org/html/draft-wmills-oauth-lrdd</a>&gt;.</dd>
<dt id="term-oauth-meta">[OAuth-meta]</dt>
<dd>Sakimura, N., &#8220;<a class="reference internal" href="oauth_meta.html"><em>JSON Metadata for OAuth Responses</em></a>&#8221;,
December 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-sakimura-oauth-meta">http://tools.ietf.org/html/draft-sakimura-oauth-meta</a>&gt;.</dd>
<dt id="term-uma-casestudies">[UMA-casestudies]</dt>
<dd>Maler, E., &#8220;UMA Case Studies&#8221;, December 2012,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/Case+Studies">http://kantarainitiative.org/confluence/display/uma/Case+Studies</a>&gt;.</dd>
<dt id="term-uma-usecases">[UMA-usecases]</dt>
<dd>Maler, E., &#8220;UMA Scenarios and Use Cases&#8221;, October 2010,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases">http://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases</a>&gt;.</dd>
<dt id="term-umanitarians">[UMAnitarians]</dt>
<dd>Maler, E., &#8220;UMA Participant Roster&#8221;, 2012,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/Participant+Roster">http://kantarainitiative.org/confluence/display/uma/Participant+Roster</a>&gt;.</dd>
</dl>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.2</a> )</p>
</div>
</div>
<div class="section" id="references">
<span id="uma-core-13"></span><h2><a class="toc-backref" href="#id76">13.  References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>(draft09)</p>
<div class="section" id="uma-core-13-1">
<span id="id4"></span><h3><a class="toc-backref" href="#id77">13.1.  Normative References</a><a class="headerlink" href="#uma-core-13-1" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-88">[DynClientReg]</dt>
<dd>Richer, J., &#8220;OAuth 2.0 Core Dynamic Client Registration&#8221;,
August 2013,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-richer-oauth-dyn-reg-core">http://tools.ietf.org/html/draft-richer-oauth-dyn-reg-core</a>&gt;.</dd>
<dt id="term-89">[OAuth-bearer]</dt>
<dd>&#8220;The OAuth 2.0 Authorization Framework: Bearer Token
Usage&#8221;, October 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6750">http://tools.ietf.org/html/rfc6750</a>&gt;.</dd>
<dt id="term-90">[OAuth-introspection]</dt>
<dd><p class="first">Richer, J., &#8220;OAuth Token Introspection&#8221;, May 2013,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-richer-oauth-introspection">http://tools.ietf.org/html/draft-richer-oauth-introspection</a>&gt;.</p>
<p class="last">(<a class="reference internal" href="oauth_introspect.html"><em>OAuth Token Introspection</em></a>)</p>
</dd>
<dt id="term-91">[OAuth-resource-reg]</dt>
<dd>Hardjono, T., &#8220;OAuth 2.0 Resource Set Registration&#8221;,
December 2012,
&lt;<a class="reference external" href="https://tools.ietf.org/html/draft-hardjono-oauth-resource-reg-01">https://tools.ietf.org/html/draft-hardjono-oauth-resource-reg-01</a>&gt;.</dd>
<dt id="term-oauth-threat">[OAuth-threat]</dt>
<dd>Lodderstedt, T., &#8220;OAuth 2.0 Threat Model and Security
Considerations&#8221;, January 2013,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6819">http://tools.ietf.org/html/rfc6819</a>&gt;.</dd>
<dt id="term-93">[OAuth2]</dt>
<dd>Hardt, D., &#8220;The OAuth 2.0 Authorization Framework&#8221;,
October 2012, &lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6749">http://tools.ietf.org/html/rfc6749</a>&gt;.</dd>
<dt id="term-oidccore">[OIDCCore]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Core 1.0&#8221;, December 2013,
&lt;<a class="reference external" href="http://openid.net/specs/openid-connect-core-1_0.html">http://openid.net/specs/openid-connect-core-1_0.html</a>&gt;.</dd>
<dt id="term-95">[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt id="term-96">[RFC4627]</dt>
<dd>Crockford, D., &#8220;The application/json Media Type for
JavaScript Object Notation (JSON)&#8221;, RFC 4627, July 2006.</dd>
<dt id="term-97">[UMA-obligations]</dt>
<dd>Maler, E., &#8220;Binding Obligations on UMA Participants&#8221;,
January 2013,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model">http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model</a>&gt;.</dd>
<dt id="term-umaclaims">[UMAclaims]</dt>
<dd>Catalano, D.,
&#8220;Claim Profiles for User-Managed Access (UMA)&#8221;, February 2014,
&lt;<a class="reference external" href="http://docs.kantarainitiative.org/uma/draft-uma-claim-profiles.html">http://docs.kantarainitiative.org/uma/draft-uma-claim-profiles.html</a>&gt;.</dd>
<dt id="term-hostmeta">[hostmeta]</dt>
<dd>Hammer-Lahav, E., &#8220;Web Host Metadata&#8221;, October 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6415">http://tools.ietf.org/html/rfc6415</a>&gt;.</dd>
</dl>
<p>(draft09)</p>
</div>
<div class="section" id="uma-core-13-2">
<span id="id5"></span><h3><a class="toc-backref" href="#id78">13.2.  Informative References</a><a class="headerlink" href="#uma-core-13-2" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-100">[OAuth-SAML]</dt>
<dd>Campbell, B., &#8220;SAML 2.0 Bearer Assertion Profiles for
OAuth 2.0&#8221;, December 2013, &lt;<a class="reference external" href="http://tools.ietf.org/html/">http://tools.ietf.org/html/</a>
draft-ietf-oauth-saml2-bearer&gt;.</dd>
<dt id="term-101">[OAuth-linktypes]</dt>
<dd>Mills, W., &#8220;Link Type Registrations for OAuth 2&#8221;, February
2013,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-wmills-oauth-lrdd">http://tools.ietf.org/html/draft-wmills-oauth-lrdd</a>&gt;.</dd>
<dt id="term-102">[OAuth-meta]</dt>
<dd>Sakimura, N., &#8220;JSON Metadata for OAuth Responses&#8221;,
February 2013,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-sakimura-oauth-meta">http://tools.ietf.org/html/draft-sakimura-oauth-meta</a>&gt;.</dd>
<dt id="term-uma-pbd">[UMA-PbD]</dt>
<dd>Maler, B., &#8220;Privacy by Design Implications of UMA&#8221;,
December 2013, &lt;<a class="reference external" href="http://kantarainitiative.org/confluence/">http://kantarainitiative.org/confluence/</a>
display/uma/Privacy+by+Design+Implications+of+UMA&gt;.</dd>
<dt id="term-104">[UMA-casestudies]</dt>
<dd>Maler, E., &#8220;UMA Case Studies&#8221;, March 2013,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/">http://kantarainitiative.org/confluence/display/uma/</a>
Case+Studies&gt;.</dd>
<dt id="term-105">[UMA-usecases]</dt>
<dd>Maler, E., &#8220;UMA Scenarios and Use Cases&#8221;, October 2010,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/">http://kantarainitiative.org/confluence/display/uma/</a>
UMA+Scenarios+and+Use+Cases&gt;.</dd>
<dt id="term-106">[UMAnitarians]</dt>
<dd>Maler, E., &#8220;UMA Participant Roster&#8221;, April 2013,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/">http://kantarainitiative.org/confluence/display/uma/</a>
Participant+Roster&gt;.</dd>
</dl>
<p>(draft09)</p>
</div>
<div class="section" id="uris">
<span id="uma-core-13-3"></span><h3><a class="toc-backref" href="#id79">13.3.  URIs</a><a class="headerlink" href="#uris" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>[1] <a class="reference external" href="https://github.com/xmlgrrl/UMA-Specifications/issues">https://github.com/xmlgrrl/UMA-Specifications/issues</a></p>
<p>[2] <a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/UMA+1.0+Core+Protocol">http://kantarainitiative.org/confluence/display/uma/UMA+1.0+Core+Protocol</a></p>
</div></blockquote>
<p>(draft09)</p>
</div>
</div>
<div class="section" id="resource-set-descriptor-for-openid-connect">
<span id="uma-core-connect-resset"></span><h2><a class="toc-backref" href="#id80">Resource Set Descriptor for OpenID Connect</a><a class="headerlink" href="#resource-set-descriptor-for-openid-connect" title="Permalink to this headline">¶</a></h2>
<p>If an OpenID Connect OP works as an UMA AM,  the OP can return the UserInfo
in which Users&#8217; resource at Host are included as an Aggregated Claim , or
OAuth Access Tokens to the Host endpoint are includde.</p>
<p>To make OpenID Connet OP as a middle man,
the Host gives extra parameters in UMA Resoure Set Description
for Protection API.</p>
<dl class="glossary docutils">
<dt id="term-107">token_endpoint</dt>
<dd>Connect OP ask the Host to issue an access token and an refresh token at this endpoint.
Requests are authenticated by OAuth Bear Token Profile with <strong>credentai_token</strong>.</dd>
<dt id="term-credential-token">credential_token</dt>
<dd>Token for the Token Endpoint request authtentiction</dd>
<dt id="term-refresh-token">refresh_token</dt>
<dd>Token to refresh an access token and the other reflesh token.</dd>
<dt id="term-resource-endpoint">resource_endpoint</dt>
<dd>Users resource is returned from this endpoint in exchange for access token.</dd>
</dl>
<p>The following JSON is an non-normative sample to be put by Host to Connect OP as AM
for Protecttion API.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Photo Album&quot;</span><span class="p">,</span>

  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower.png&quot;</span><span class="p">,</span>

  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">],</span>

  <span class="s2">&quot;token_endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://photoz.example.com/dev/token/&quot;</span><span class="p">,</span>
  <span class="s2">&quot;credential_token&quot;</span> <span class="o">:</span> <span class="s2">&quot;fdsafdsafdsafa&quot;</span><span class="p">,</span>
  <span class="s2">&quot;refresh_token&quot;</span> <span class="o">:</span> <span class="s2">&quot;432gsafgds9&quot;</span><span class="p">,</span>
  <span class="s2">&quot;resource_endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://photoz.example.com/dev/resource/&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the User configure to return his UserInfo including resource at Host,
the OP refreshes an access token in exchange for the <strong>refresh_tokne</strong> first,
then get the resource at <strong>token_endpoint</strong> in exchange for the access token.</p>
<p>After the resource is returned in JWT form to the OP, OP include it as an
Aggregated Claim in the UserInfo( which is to be returnd to the other RP).</p>
<p>If the User configure to return an access token to the Host in UserInfo,
OP includes the access token given by Host&#8217; <strong>token_endpoint</strong> in the UserInfo.</p>
</div>
<div class="section" id="note-1-scopes-resource-sets-permissions-and-authorization">
<span id="uma-core-note-1"></span><h2><a class="toc-backref" href="#id81">NOTE.1:  Scopes, Resource Sets, Permissions, and Authorization</a><a class="headerlink" href="#note-1-scopes-resource-sets-permissions-and-authorization" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>draft06 &#8220;1.4.  Scopes, Resource Sets, Permissions, and Authorization&#8221;</li>
</ul>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id82">リソースセットとスコープタイプ</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>UMA extends the OAuth concept of a &#8220;scope&#8221; by defining <em class="xref std std-term">scope types</em>
as applying to labeled resource sets,
rather than leaving the relevant resources
(such as API endpoints or URIs) implicit.</p>
<p>A resource set can have any number of scope types,
which together describe the universe of actions that _can <a href="#id86"><span class="problematic" id="id87">be_</span></a> taken
on this protected resource set.</p>
<p>For example,
a resource set representing a status update API might have scopes
that include adding an update or reading updates.
A resource set representing a photo album might have scopes that
include viewing a slideshow or printing the album.
Resource servers register resource sets and their scope types
when there is not yet any particular requesting party or client in the picture.</p>
<p>Resource sets and scope types have meaning only to resource servers
and their users,
in the same way that application-specific protected resource APIs
have meaning only to these entities.
The authorization server is merely a conveyor of labels and
descriptions for these constructs,
to help the resource owner set policies that guide eventual authorization processes.</p>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id83">パーミッション</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>A permission, in contrast to a <a class="reference internal" href="oauth_res_reg.html#term-scope-type"><em class="xref std std-term">scope type</em></a>,
reflects an _actual_ entitlement to access a <a class="reference internal" href="#term-resource-set"><em class="xref std std-term">resource set</em></a>
using one or more scope types,
as the result of an authorization process undergone by a specific <a class="reference internal" href="#term-requesting-party"><em class="xref std std-term">requesting party</em></a>.</p>
<p>A <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> registers a <em class="xref std std-term">permission request</em>
with an authorization server on behalf of a client
(and its requesting parties)
that has attempted access,
and transmits the resulting <a class="reference internal" href="#term-permission-ticket"><em class="xref std std-term">permission ticket</em></a> to the <a class="reference internal" href="#term-client"><em class="xref std std-term">client</em></a>.</p>
<p>The client subsequently asks the authorization server for <a class="reference internal" href="#term-authorization-data"><em class="xref std std-term">authorization data</em></a>
to be associated with its RPT.
If the <em class="xref std std-term">RPT profile</em> is in use,
the authorization server grants (or denies) the permission to the requesting party.
(If another token profile is in use,
the authorization server might generate a different type of authorization data,
such as an authorization decision or a package of the claims it has collected.)</p>
<p>An RPT is bound to a requesting party,
the client being used by that party,
the resource server at which protected resources of interest reside,
and the authorization server that protects those resources.</p>
<p>It becomes associated with as many pieces of authorization data
as are appropriate for gaining authorized access to resources protected
at that resource server by any single authorization server
(even if that data applies to resources managed by two or more different
resource owners at the same resource server using the same authorization server).</p>
<p>In the case of the UMA &#8220;bearer&#8221; token profile,
each individual permission is associated with the resource owner
whose policies drove the authorization process.
This enables meaningful, auditable, and potentially legally enforceable authorization
for access (see <a class="reference internal" href="#term-97"><em class="xref std std-term">[UMA-obligations]</em></a>).</p>
<p>Permissions have a validity period that the authorization server has
the opportunity to control (independently or with input from the resource owner).
These control options are outside the scope of this specification.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.4">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.4</a> )</p>
</div>
</div>
<div class="section" id="note-2-claims-gathering-flow-for-clients-operated-by-end-users">
<span id="uma-core-note-2"></span><h2><a class="toc-backref" href="#id84">NOTE.2: Claims-Gathering Flow for Clients Operated by End-Users</a><a class="headerlink" href="#note-2-claims-gathering-flow-for-clients-operated-by-end-users" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>&#8220;3.5.1. Claims-Gathering Flow for Clients Operated by End-Users&#8221;</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>自然人</li>
<li>組織人</li>
</ul>
</div>
<p>A client,
whether web-based or native, is operated by an end-user in
one of two typical situations:</p>
<blockquote>
<div><ul class="simple">
<li>The <a class="reference internal" href="#term-requesting-party"><em class="xref std std-term">requesting party</em></a> is a natural person
(for example, a friend of the resource owner);
the requesting party may even be the resource owner herself.</li>
<li>The requesting party is a legal person such as a corporation, and
the end-user operating the client is acting as an agent of that
legal person
(for example, a customer support specialist representing a credit card company).</li>
</ul>
</div></blockquote>
<p>For convenience,
this specification refers to the end-user as a &#8220;<em class="xref std std-term">requesting end-user</em>&#8221;
to cover both cases,
which differ only at the level of business agreements
(and potentially law), rather than technology.</p>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> has a variety of options
at this point for satisfying the resource owner&#8217;s policy;
this specification does not dictate a single answer.</p>
<p>For example,
the authorization server could require the requesting end-user to
register for and/or log in to a local authorization server account,
or to fill in a questionnaire, or to complete a purchase.
It could even require several of these operations,
where the order is treated as significant.
A variety of claim profiling can be defined to achieve these effects.</p>
<p>An end-user-driven client MUST redirect the requesting end-user to
the authorization server to complete the process of authorization.
The redirection MUST include a URI query parameter with the name
&#8220;<em class="xref std std-term">ticket</em>&#8221; whose value conveys the <a class="reference internal" href="#term-permission-ticket"><em class="xref std std-term">permission ticket</em></a>
for which the need_claims error was received;
for example,
&#8220;ticket=016f84e8-f9b9-11e0-bd6f-0021cc6004de&#8221;.</p>
<p>Each claim profile MUST provide the following capabilities:</p>
<dl class="glossary docutils">
<dt id="term-redirect-uri">redirect URI</dt>
<dd>A means by which the client MUST supply the URI to
which the authorization server MUST redirect
the <em class="xref std std-term">requesting end-user</em>
at the end of the claims-gathering process.</dd>
<dt id="term-callback-uri">callback URI</dt>
<dd>A means by which the client OPTIONALLY supplies a
callback URI for the authorization server to use.</dd>
<dt id="term-state">state</dt>
<dd>A means by which the client SHOULD supply an opaque value used
to maintain state between the request and the callback; this
serves as a protection against XSRF attacks.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Authz Requestの条件を言っているような...</li>
</ul>
</div>
<div class="section" id="openid-connect-claim-profile">
<h3><a class="toc-backref" href="#id85">OpenID Connect Claim Profile</a><a class="headerlink" href="#openid-connect-claim-profile" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>draft08, &#8220;3.5.1.1.  OpenID Connect Claim Profile&#8221;</li>
</ul>
</div>
<p>This section defines the OpenID Connect claim profile for UMA.</p>
<p>Following is a summary:</p>
<blockquote>
<div><ul class="simple">
<li>Identifying URI: <a class="reference external" href="http://docs.kantarainitiative.org/uma/profiles/uma-claim-openid-1.0">http://docs.kantarainitiative.org/uma/profiles/uma-claim-openid-1.0</a></li>
<li>Profile author and contact information: Thomas Hardjono
(<a class="reference external" href="mailto:hardjono&#37;&#52;&#48;mit&#46;edu">hardjono<span>&#64;</span>mit<span>&#46;</span>edu</a>)</li>
<li>Updates or obsoletes: None; this profile is new.</li>
<li>Syntax and semantics of claim data: As defined below.  The claim
data format leverages the OpenID Connect protocol and the reserved
claims defined in that specification.</li>
<li>Claims gathering method: As defined below.</li>
<li>Error states: None additional.</li>
<li>Security and privacy considerations: None additional.</li>
<li>Binding obligations: Binding obligations that apply to the use of
this claim profile are documented in <a class="reference internal" href="#term-97"><em class="xref std std-term">[UMA-obligations]</em></a>.</li>
</ul>
</div></blockquote>
<p>If an authorization server supports the OpenID Connect claim profile,
it MUST supply the &#8220;openid&#8221; value for one of its
&#8220;claim_profiles_supported&#8221; values in its configuration data.</p>
<p>To conform to this option, the authorization server MUST do the following:</p>
<blockquote>
<div><ul class="simple">
<li>Serve as a conforming OpenID Relying Party according to <a class="reference internal" href="#term-oidccore"><em class="xref std std-term">[OIDCCore]</em></a></li>
<li>Be able to utilize at least all of the reserved claims defined in
[OIDCCore] in evaluating policy and adding <a class="reference internal" href="#term-authorization-data"><em class="xref std std-term">authorization data</em></a> to RPTs</li>
<li>Use the OpenID Connect &#8220;redirect_uri&#8221; and &#8220;state&#8221; request parameters
as appropriate</li>
</ul>
</div></blockquote>
<p>The authorization server can then use any conforming OpenID Connect
mechanisms and typical user interfaces for engaging with the UserInfo
endpoints of OpenID Providers and Claims Providers, potentially
allowing for the delivery of &#8220;trusted claims&#8221; (such as a verified
email address or a date or birth) on which authorization policy for
access may depend.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
  <h2>HDKNR.COM</h2>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011, HDKNR.COM.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.<br/>
    </p>
  </div>
</footer>

  </body>
</html>