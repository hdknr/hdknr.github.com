

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>User-Managed Access (UMA) Core Protocol &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="UMA Trust Model" href="uma_trust.html" />
    <link rel="prev" title="OpenID Connect Session Management 1.0" href="session.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>identity 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>User-Managed Access (UMA) Core Protocol</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="session.html">OpenID Connect Session Management 1.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="uma_trust.html">UMA Trust Model</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="user-managed-access-uma-core-protocol">
<h1><a class="toc-backref" href="#id3">User-Managed Access (UMA) Core Protocol</a><a class="headerlink" href="#user-managed-access-uma-core-protocol" title="Permalink to this headline">¶</a></h1>
<p>Based on <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-05">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-05</a></p>
<div class="section" id="abstract">
<span id="uma-core-abstract"></span><h2><a class="toc-backref" href="#id4">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>This specification defines the User-Managed Access (UMA) core protocol.
This protocol provides a method for users to control access
to their protected resources,
residing on any number of host sites,
through an authorization manager that governs access decisions based on user policy.</p>
<p>(draft 05)</p>
<p class="seqdiag">
<img src="images/seqdiag-ac71d09e95068748828159bd0f0cd1e565acef9b.png" alt="None" width="832" height="4053" />
</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#user-managed-access-uma-core-protocol" id="id3">User-Managed Access (UMA) Core Protocol</a><ul>
<li><a class="reference internal" href="#abstract" id="id4">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id5">1.  Introduction</a><ul>
<li><a class="reference internal" href="#notational-conventions" id="id6">1.1.  Notational Conventions</a></li>
<li><a class="reference internal" href="#basic-terminology" id="id7">1.2.  Basic Terminology</a></li>
<li><a class="reference internal" href="#endpoints-endpoint-protection-and-tokens" id="id8">1.3.  Endpoints, Endpoint Protection, and Tokens</a></li>
<li><a class="reference internal" href="#scopes-resource-sets-permissions-and-authorization" id="id9">1.4.  Scopes, Resource Sets, Permissions, and Authorization</a></li>
<li><a class="reference internal" href="#am-configuration-data" id="id10">1.5.  AM Configuration Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#protecting-a-resource" id="id11">2. Protecting a Resource</a><ul>
<li><a class="reference internal" href="#host-looks-up-am-configuration-data" id="id12">2.1.  Host Looks Up AM Configuration Data</a></li>
<li><a class="reference internal" href="#host-registers-with-am" id="id13">2.2.  Host Registers with AM</a></li>
<li><a class="reference internal" href="#host-obtains-protection-api-token" id="id14">2.3.  Host Obtains Protection API Token</a></li>
<li><a class="reference internal" href="#host-registers-sets-of-resources-to-be-protected" id="id15">2.4. Host Registers Sets of Resources to Be Protected</a><ul>
<li><a class="reference internal" href="#scope-descriptions" id="id16">2.4.1. Scope Descriptions</a></li>
<li><a class="reference internal" href="#resource-set-descriptions" id="id17">2.4.2. Resource Set Descriptions</a></li>
<li><a class="reference internal" href="#resource-set-registration-api" id="id18">2.4.3. Resource Set Registration API</a><ul>
<li><a class="reference internal" href="#create-resource-set-description" id="id19">2.4.3.1. Create Resource Set Description</a></li>
<li><a class="reference internal" href="#read-resource-set-description" id="id20">2.4.3.2.  Read Resource Set Description</a></li>
<li><a class="reference internal" href="#update-resource-set-description" id="id21">2.4.3.3.  Update Resource Set Description</a></li>
<li><a class="reference internal" href="#delete-resource-set-description" id="id22">2.4.3.4.  Delete Resource Set Description</a></li>
<li><a class="reference internal" href="#list-resource-set-descriptions" id="id23">2.4.3.5.  List Resource Set Descriptions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#getting-authorization-and-accessing-a-resource" id="id24">3. Getting Authorization and Accessing a Resource</a><ul>
<li><a class="reference internal" href="#requester-host-attempt-access-at-protected-resource" id="id25">3.1.  Requester-Host: Attempt Access at Protected Resource</a><ul>
<li><a class="reference internal" href="#requester-presents-no-requester-permission-tokne" id="id26">3.1.1.  Requester Presents No Requester Permission Tokne</a></li>
<li><a class="reference internal" href="#requester-presents-a-requester-permission-token-that-has-insufficient-permission" id="id27">3.1.2.  Requester Presents a Requester Permission Token That Has Insufficient Permission</a></li>
<li><a class="reference internal" href="#requester-presents-a-valid-requester-permission-token-with-sufficient-permissions" id="id28">3.1.3.  Requester Presents a Valid Requester Permission Token with Sufficient Permissions</a><ul>
<li><a class="reference internal" href="#requester-s-token-has-insufficient-permission" id="id29">3.1.3.1.  Requester&#8217;s Token Has Insufficient Permission</a></li>
<li><a class="reference internal" href="#requester-s-token-has-sufficient-permission" id="id30">3.1.3.2.  Requester&#8217;s Token Has Sufficient Permission</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#host-am-register-a-permission" id="id31">3.2.  Host-AM: Register a Permission</a></li>
<li><a class="reference internal" href="#host-determines-the-requester-permission-token-status" id="id32">3.3.  Host Determines the Requester Permission Token Status</a><ul>
<li><a class="reference internal" href="#uma-bearer-token-profile" id="id33">3.3.1.  UMA Bearer Token Profile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#requester-am-ask-for-requester-permission-token-and-permission" id="id34">3.4.  Requester-AM: Ask for Requester Permission Token and Permission</a><ul>
<li><a class="reference internal" href="#requester-looks-up-am-configuration-data" id="id35">3.4.1.  Requester Looks Up AM Configuration Data</a></li>
<li><a class="reference internal" href="#requester-registers-with-am" id="id36">3.4.2.  Requester Registers with AM</a></li>
<li><a class="reference internal" href="#requester-obtains-authorization-api-token" id="id37">3.4.3.  Requester Obtains Authorization API Token</a></li>
<li><a class="reference internal" href="#requester-obtains-requester-permission-token" id="id38">3.4.4.  Requester Obtains Requester Permission Token</a></li>
<li><a class="reference internal" href="#requester-asks-for-authorization-to-add-permission" id="id39">3.4.5.  Requester Asks for Authorization to Add Permission</a></li>
</ul>
</li>
<li><a class="reference internal" href="#claims-gathering-flows" id="id40">3.5.  Claims-Gathering Flows</a><ul>
<li><a class="reference internal" href="#claims-gathering-flow-for-requester-apps-operated-by-end-users" id="id41">3.5.1.  Claims-Gathering Flow for Requester Apps Operated by End-Users</a><ul>
<li><a class="reference internal" href="#openid-connect-claim-profile" id="id42">3.5.1.1.  OpenID Connect Claim Profile</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#error-messages" id="id43">4.  Error Messages</a><ul>
<li><a class="reference internal" href="#oauth-error-responses" id="id44">4.1.  OAuth Error Responses</a></li>
<li><a class="reference internal" href="#uma-error-responses" id="id45">4.2.  UMA Error Responses</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification-of-additional-profiles" id="id46">5.  Specification of Additional Profiles</a><ul>
<li><a class="reference internal" href="#specifying-uma-profiles" id="id47">5.1.  Specifying UMA Profiles</a></li>
<li><a class="reference internal" href="#specifying-uma-token-profiles" id="id48">5.2.  Specifying UMA Token Profiles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations" id="id49">6.  Security Considerations</a></li>
<li><a class="reference internal" href="#privacy-considerations" id="id50">7.  Privacy Considerations</a></li>
<li><a class="reference internal" href="#conformance" id="id51">8.  Conformance</a></li>
<li><a class="reference internal" href="#iana-considerations" id="id52">9.  IANA Considerations</a></li>
<li><a class="reference internal" href="#example-of-registering-resource-sets" id="id53">10.  Example of Registering Resource Sets</a></li>
<li><a class="reference internal" href="#acknowledgments" id="id54">11.  Acknowledgments</a></li>
<li><a class="reference internal" href="#issues" id="id55">12.  Issues</a></li>
<li><a class="reference internal" href="#references" id="id56">13.  References</a><ul>
<li><a class="reference internal" href="#normative-references" id="id57">13.1.  Normative References</a></li>
<li><a class="reference internal" href="#informative-references" id="id58">13.2.  Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#note" id="id59">Note</a><ul>
<li><a class="reference internal" href="#resource-set-descriptor-for-openid-connect" id="id60">Resource Set Descriptor for OpenID Connect</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="introduction">
<span id="uma-core-1"></span><h2><a class="toc-backref" href="#id5">1.  Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The User-Managed Access (UMA) core protocol provides
a method based on OAuth 2.0 <a class="reference internal" href="backplane.html#term-47"><em class="xref std std-term">[OAuth2]</em></a>
for users to control access to their <a class="reference internal" href="glossary.html#term-protected-resources"><em class="xref std std-term">protected resources</em></a>,
residing on any number of host sites,
through a single <a class="reference internal" href="#term-authorization-manager"><em class="xref std std-term">authorization manager</em></a> (AM)
that governs access decisions based on <a class="reference internal" href="#term-user-policy"><em class="xref std std-term">user policy</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Access Control on User Resources</li>
<li>On any number of OAuth Resource Server</li>
<li>Authorization Manager</li>
<li>User Policy Base</li>
</ul>
</div>
<dl class="glossary docutils">
<dt id="term-user-policy">User Policy</dt>
<dd>(TDB)</dd>
</dl>
<p>There are numerous use cases for UMA,
where a <a class="reference internal" href="oauth.html#term-resource-owner"><em class="xref std std-term">resource owner</em></a> elects to have a third party
to control access to these resources potentially
without the real-time presence of the resource owner.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>user delegates to resource requesters to access his resource</li>
</ul>
</div>
<p>A typical example is the following:
a web user (<a class="reference internal" href="#term-authorizing-user"><em class="xref std std-term">authorizing user</em></a>) can authorize a web app :(term:<cite>requester)</cite>
to gain one-time or ongoing access to a resource
containing his home address stored at a &#8220;personal data store&#8221; service (<a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>),
by telling the host to act on access decisions
made by his authorization decision-making service (<a class="reference internal" href="#term-authorization-manager"><em class="xref std std-term">authorization manager</em></a> or <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Authorizing User  = Resource Owner..</li>
<li>Requester/Requesting Pary = Client</li>
<li>Host = (Resource) Server</li>
<li>Authorization(Access) Manager = Authorization Server, Connect OP</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Requesting Party</li>
</ul>
</div>
<p>The <a class="reference internal" href="#term-64"><em class="xref std std-term">requesting party</em></a> might be an <strong>e-commerce company</strong>
whose site is acting on behalf of the user himself
to assist him/her in arranging for shipping a purchased item,
or it might be his <strong>friend</strong> who is using an online address book service
to collect addresses,
or it might be a <strong>survey company</strong> that uses an online service
to compile population demographics.
Other scenarios and use cases for UMA usage can be found
in <a class="reference internal" href="#term-uma-usecases"><em class="xref std std-term">[UMA-usecases]</em></a> and <a class="reference internal" href="#term-uma-userstories"><em class="xref std std-term">[UMA-userstories]</em></a> .</p>
<dl class="glossary docutils">
<dt id="term-trust-model">Trust Model</dt>
<dd>(TBD)</dd>
</dl>
<p>Practical control of access among loosely coupled parties
requires more than just messaging protocols.
This specification defines only the technical &#8220;contract&#8221;
between UMA-compliant entities;
its companion <a class="reference internal" href="#term-trust-model"><em class="xref std std-term">Trust Model</em></a> specification <a class="reference internal" href="#term-uma-trustmodel"><em class="xref std std-term">[UMA-trustmodel]</em></a>
defines the expected behaviors of parties operating and
using these entities.
Parties operating entities that claim to be UMA-compliant
MUST provide documentation affirmatively stating their acceptance
of the binding obligations contractual framework
defined in the Trust Model specification.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>PEP &amp; PDP separation</li>
</ul>
</div>
<p>In enterprise settings,
application access management often involves letting back-office applications serve
only as policy enforcement points (<a class="reference internal" href="xacml.html#term-pep"><em class="xref std std-term">PEPs</em></a>),
depending entirely on access decisions
coming from a central policy decision point (<a class="reference internal" href="xacml.html#term-pdp"><em class="xref std std-term">PDP</em></a>)
to govern the access they give to requesters.
This separation eases auditing and allows policy administration
to scale in several dimensions.</p>
<p>UMA makes use of a separation similar to this,
letting the <a class="reference internal" href="#term-authorizing-user"><em class="xref std std-term">authorizing user</em></a> serve
as a policy administrator crafting authorization strategies on his or her own behalf.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Based on <a class="reference internal" href="glossary.html#term-oauth"><em class="xref std std-term">OAuth</em></a></p>
<blockquote class="last">
<div><ul class="simple">
<li>AM  = Authorization Server</li>
<li>host  = Resource Server</li>
<li>requester = client</li>
</ul>
</div></blockquote>
</div>
<p>The UMA protocol can be considered an advanced application of
<a class="reference internal" href="backplane.html#term-47"><em class="xref std std-term">[OAuth2]</em></a> in that it profiles, extends, and embeds OAuth
in various ways.
In the big picture,
an <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a> can be thought of as an enhanced OAuth authorization server;
a <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> as an enhanced resource server;
and a <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> as an enhanced client,
acquiring an access token and
the requisite authorization to access a <a class="reference internal" href="#term-protected-resource"><em class="xref std std-term">protected resource</em></a> at the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>.</p>
<p>The UMA protocol has three broad phases, as shown in Figure 1.</p>
<div class="highlight-python"><pre>The Three Phases of the UMA Protocol

                                  +-----+----------------+
                                  | UA  |  authorizing   |
              +-------Manage (A)--|     |      user      |
              |                   +-----+----------------+
              |   Phase 1:              |       UA       |
              |   protect a             +----------------+
              |   resource                      |
              |                            Control (B)
              |                                 |
              v                                 v
       +-----------+              +-----+----------------+
       |   host    |&lt;-Protect-(C)-|prot | authorization  |
       |           |              | API |  manager (AM)  |
       +-----------+              +-----+----------------+
       | protected |                    | authorization  |
       | resource  |                    |      API       |
       +-----------+                    +----------------+
              ^                                 |
              |   Phases 2 and 3:         Authorize (D)
              |   get authz and                 |
              |   access a resource             v
              |                         +----------------+
              +-------Access (E)--------|   requester    |
                                        +----------------+
                                        (requesting party)

                             Figure 1</pre>
</div>
<p>In broad strokes, the phases are as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Protect a resource (described in <a class="reference internal" href="#uma-core-2"><em>Section 2</em></a>).</li>
<li>Get authorization (described in <a class="reference internal" href="#uma-core-3"><em>Section 3</em></a>).</li>
<li>Access a resource (described along with Phase 2 in <a class="reference internal" href="#uma-core-3"><em>Section 3</em></a>).</li>
</ol>
</div></blockquote>
<p>In more detail, the phases work as follows:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first"><strong>Protect a resource</strong>:</p>
<p>The <a class="reference internal" href="#term-authorizing-user"><em class="xref std std-term">authorizing user</em></a> has chosen to use a <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>
for managing online resources (&#8220;A&#8221;),
and introduces this <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> to an <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>
using an <a class="reference internal" href="glossary.html#term-oauth"><em class="xref std std-term">OAuth</em></a>-mediated interaction
that results in the <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a> giving the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>
a <a class="reference internal" href="#term-protection-api-token"><em class="xref std std-term">protection API token</em></a> (<a class="reference internal" href="#term-pat"><em class="xref std std-term">PAT</em></a>).</p>
<p>The <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> uses <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>&#8216;s protection API
to tell the <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a> what sets of resources to protect (&#8220;C&#8221;).</p>
<p>Out of band of the <a class="reference internal" href="glossary.html#term-uma"><em class="xref std std-term">UMA</em></a> protocol,
the <a class="reference internal" href="#term-authorizing-user"><em class="xref std std-term">authorizing user</em></a> instructs the <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>
what policies to attach to the registered resource sets (&#8220;B&#8221;).</p>
<p>Requesters are not yet in the picture.</p>
</li>
<li><p class="first"><strong>Get authorization</strong>:</p>
<p>This phase involves the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> (along with its operator,
the requesting party or that party&#8217;s human agent),
<a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>, and <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>.</p>
<p>It may also involve synchronous action
by the <a class="reference internal" href="#term-authorizing-user"><em class="xref std std-term">authorizing user</em></a>
if this person is the same person as the requesting party.</p>
<p>This phase is dominated by a loop of activity
in which the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> approaches the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>
seeking access to a <a class="reference internal" href="#term-protected-resource"><em class="xref std std-term">protected resource</em></a> (&#8220;E&#8221;).</p>
<p>In order to access the <a class="reference internal" href="#term-protected-resource"><em class="xref std std-term">protected resource</em></a> at the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>,
the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> must obtain a <a class="reference internal" href="#term-requester-permission-token"><em class="xref std std-term">requester permission token</em></a> (<a class="reference internal" href="#term-rpt"><em class="xref std std-term">RPT</em></a>)
from the <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>.</p>
<p>The requester is then directed to the AM ask for authorization
for the permissions it seeks.</p>
<p>In doing so,
it must demonstrate to the AM
that it satisfies the resource owner&#8217;s authorization policy
governing the sought-for resource and scope of access
if it does not already have the required access permission (&#8220;D&#8221;).</p>
<p>To use the AM&#8217;s authorization API in the first place,
the requesting party has to consent to deal with the AM in providing claims,
which results in the requester obtaining an <a class="reference internal" href="#term-authorization-api-token"><em class="xref std std-term">authorization API token</em></a> (<a class="reference internal" href="#term-aat"><em class="xref std std-term">AAT</em></a>)
from the AM.</p>
</li>
<li><p class="first"><strong>Access a resource</strong>:</p>
<p>This phase involves the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> successfully presenting
an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a> that has sufficient permission
associated with it to the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> in order to gain access
to the desired resource (&#8220;E&#8221;).</p>
<p>In this sense, it is the &#8220;happy path&#8221; within phase 2.</p>
</li>
</ol>
</div></blockquote>
<p>In deploying UMA,
implementers are expected to develop one or more UMA Profiles
(described in <a class="reference internal" href="#uma-core-5"><em>Section 5</em></a>)
that specify and restrict the various UMA protocol options,
according to the deployment conditions.</p>
<dl class="glossary docutils">
<dt id="term-phase-1"><span id="term-uma-phase-1"></span>Phase 1<br />UMA Phase 1</dt>
<dd><p class="first">Resource Procection Phase.</p>
<p class="last">Resource is at <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>. Protected by <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a> with <a class="reference internal" href="glossary.html#term-uma"><em class="xref std std-term">UMA</em></a> protocol.</p>
</dd>
<dt id="term-phase-2"><span id="term-uma-phase-2"></span>Phase 2<br />UMA Phase 2</dt>
<dd><p class="first">Authorization Phase.</p>
<p class="last"><a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a> issues <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a> to <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> with <a class="reference internal" href="glossary.html#term-oauth"><em class="xref std std-term">OAuth</em></a> protocol.</p>
</dd>
<dt id="term-phase-3"><span id="term-uma-phase-3"></span>Phase 3<br />UMA Phase 3</dt>
<dd><p class="first">Resrouce Access Phase.</p>
<p class="last"><a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> as OAuth <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">client</em></a> ask the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> to return resources.</p>
</dd>
</dl>
<dl class="glossary docutils">
<dt id="term-pat"><span id="term-protection-api-token"></span>PAT<br />Protection API Token</dt>
<dd><ul class="first last simple">
<li>Host &#8212; (PAT) &#8211;&gt; AM</li>
</ul>
</dd>
<dt id="term-aat"><span id="term-authorization-api-token"></span>AAT<br />Authorization API Token</dt>
<dd><ul class="first last simple">
<li>Requester &#8212; (AAT) &#8212;&gt; AM</li>
</ul>
</dd>
<dt id="term-rpt"><span id="term-requester-permission-token"></span>RPT<br />Requester Permission Token</dt>
<dd><ul class="first simple">
<li>Requester &#8212; (RPT) &#8212;&gt; Host</li>
</ul>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Formerly known as <strong>Requester Access Token</strong></li>
</ul>
</div>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The requester access token has been split into two tokens
and all of the tokens have been renamed.</p>
<p>The host access token is now the PAT.   (HAT -&gt; PAT )</p>
<p>The requester access token used at the AM&#8217;s API is now the AAT,  (RAT -&gt; AAT)
and consists of vanilla OAuth.</p>
<p class="last">The requester access token used at the host is now the RPT.</p>
</div>
<p>(draft 05)</p>
<div class="section" id="notational-conventions">
<span id="uma-core-1-1"></span><h3><a class="toc-backref" href="#id6">1.1.  Notational Conventions</a><a class="headerlink" href="#notational-conventions" title="Permalink to this headline">¶</a></h3>
<p>The key words &#8216;MUST&#8217;, &#8216;MUST NOT&#8217;, &#8216;REQUIRED&#8217;, &#8216;SHALL&#8217;, &#8216;SHALL NOT&#8217;,
&#8216;SHOULD&#8217;, &#8216;SHOULD NOT&#8217;, &#8216;RECOMMENDED&#8217;, &#8216;MAY&#8217;, and &#8216;OPTIONAL&#8217; in this
document are to be interpreted as described in [RFC2119].</p>
<p>Unless otherwise noted, all the protocol properties and values are
case sensitive.</p>
<p>The assignment in this document of URI labels is temporary, awaiting
final standardization in the eventual standards body within which
this specification is taken up as a work item.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
<div class="section" id="basic-terminology">
<span id="uma-core-1-2"></span><h3><a class="toc-backref" href="#id7">1.2.  Basic Terminology</a><a class="headerlink" href="#basic-terminology" title="Permalink to this headline">¶</a></h3>
<p>UMA introduces the following terms, utilizing OAuth and other
identity and access management concepts.</p>
<dl class="glossary docutils">
<dt id="term-authorizing-user">authorizing user</dt>
<dd>An UMA-defined variant of an OAuth <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">end-user</em></a> <a class="reference internal" href="oauth.html#term-resource-owner"><em class="xref std std-term">resource owner</em></a>;
a web user who configures an <a class="reference internal" href="#term-authorization-manager"><em class="xref std std-term">authorization manager</em></a>
with <a class="reference internal" href="glossary.html#term-policies"><em class="xref std std-term">policies</em></a> that control how it assigns access <a class="reference internal" href="#term-permissions"><em class="xref std std-term">permissions</em></a>
to <a class="reference internal" href="#term-requesters"><em class="xref std std-term">requesters</em></a> for a <a class="reference internal" href="#term-protected-resource"><em class="xref std std-term">protected resource</em></a>.</dd>
<dt id="term-authorization-manager-am"><span id="term-authorization-manager"></span><span id="term-am"></span>authorization manager (AM)<br />authorization manager<br />AM</dt>
<dd>An UMA-defined variant of an OAuth <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> that
carries out an authorizing user&#8217;s <a class="reference internal" href="glossary.html#term-policies"><em class="xref std std-term">policies</em></a> governing access to
a <a class="reference internal" href="#term-protected-resource"><em class="xref std std-term">protected resource</em></a>.</dd>
<dt id="term-protected-resource">protected resource</dt>
<dd>An access-restricted resource at a <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>,
which is being policy- protected by an <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>.</dd>
<dt id="term-host">host</dt>
<dd>An UMA-defined variant of an OAuth <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> that
enforces access to the <a class="reference internal" href="glossary.html#term-protected-resources"><em class="xref std std-term">protected resources</em></a> it hosts,
as governed by an <a class="reference internal" href="#term-authorization-manager"><em class="xref std std-term">authorization manager</em></a>.</dd>
<dt id="term-claim">claim</dt>
<dd>A statement of the value or values of one or more identity attributes of
a <a class="reference internal" href="#term-64"><em class="xref std std-term">requesting party</em></a>.
A <a class="reference internal" href="#term-64"><em class="xref std std-term">requesting party</em></a> may need to provide claims
to an <a class="reference internal" href="#term-authorization-manager"><em class="xref std std-term">authorization manager</em></a> in order to
satisfy <a class="reference internal" href="glossary.html#term-policy"><em class="xref std std-term">policy</em></a> and gain <a class="reference internal" href="#term-permission"><em class="xref std std-term">permission</em></a>
for access to a <a class="reference internal" href="#term-protected-resource"><em class="xref std std-term">protected resource</em></a>.</dd>
<dt id="term-requester"><span id="term-requesters"></span>requester<br />requesters</dt>
<dd>An UMA-defined variant of an OAuth <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">client</em></a> that seeks access to
a <a class="reference internal" href="#term-protected-resource"><em class="xref std std-term">protected resource</em></a>.</dd>
<dt id="term-requesting-party">requesting party</dt>
<dd>A web user, or a corporation or other legal person, that uses a
<a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> to seek access to a <a class="reference internal" href="#term-protected-resource"><em class="xref std std-term">protected resource</em></a>.
If the requesting party is a natural person,
it may or may not be the same person as the <a class="reference internal" href="#term-authorizing-user"><em class="xref std std-term">authorizing user</em></a>.</dd>
<dt id="term-resource-set"><span id="term-resource-sets"></span>resource set<br />resource sets</dt>
<dd>A host-managed set of one or more resources to be AM-
protected.  In authorization policy terminology, a resource set
is the &#8220;object&#8221; being protected.</dd>
<dt id="term-scope">scope</dt>
<dd><p class="first">A <strong>bounded extent of access</strong> that is possible to perform
on a <a class="reference internal" href="#term-resource-set"><em class="xref std std-term">resource set</em></a>.
In authorization policy terminology,
a scope is one of the potentially many &#8220;<strong>verbs</strong>&#8221; that can logically apply to
a <a class="reference internal" href="#term-resource-set"><em class="xref std std-term">resource set</em></a>.</p>
<p class="last">Whereas OAuth scopes apply to resource sets that are <strong>implicit</strong>,
UMA associates scopes with explicitly labeled <a class="reference internal" href="#term-resource-sets"><em class="xref std std-term">resource sets</em></a> (&#8220;objects&#8221;).</p>
</dd>
<dt id="term-permission"><span id="term-permissions"></span>permission<br />permissions</dt>
<dd>A <a class="reference internal" href="#term-scope"><em class="xref std std-term">scope</em></a> of access over a particular <a class="reference internal" href="#term-resource-set"><em class="xref std std-term">resource set</em></a>
at a particular <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> that is being asked for by,
or being granted to, a <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a>.
In authorization policy terminology,
a permission is the &#8220;<strong>verb</strong>&#8221; portion of an entire policy that also
includes a &#8220;<a class="reference internal" href="wss_saml_token_profile.html#term-subject"><em class="xref std std-term">subject</em></a>&#8221; (<a class="reference internal" href="#term-64"><em class="xref std std-term">requesting party</em></a>) and an &#8220;<a class="reference internal" href="glossary.html#term-object"><em class="xref std std-term">object</em></a>&#8221;
(<a class="reference internal" href="#term-resource-set"><em class="xref std std-term">resource set</em></a>).</dd>
</dl>
<p>(draft 05)</p>
</div>
<div class="section" id="endpoints-endpoint-protection-and-tokens">
<span id="uma-core-1-3"></span><h3><a class="toc-backref" href="#id8">1.3.  Endpoints, Endpoint Protection, and Tokens</a><a class="headerlink" href="#endpoints-endpoint-protection-and-tokens" title="Permalink to this headline">¶</a></h3>
<p>Various <a class="reference internal" href="glossary.html#term-uma"><em class="xref std std-term">UMA</em></a> entities present APIs for other UMA entities to use.
These APIs are as follows:</p>
<ul class="simple">
<li>The <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a> presents a <a class="reference internal" href="glossary.html#term-protection-api"><em class="xref std std-term">protection API</em></a> to the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>,
as standardized by this specification.
This API is <a class="reference internal" href="glossary.html#term-oauth-protected"><em class="xref std std-term">OAuth-protected</em></a>,
requiring a host <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a> (issued by the <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>)
for successful access (see <a class="reference internal" href="#uma-core-2-3"><em>Section 2.3</em></a> for this issuance process).</li>
<li>The <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a> presents an <a class="reference internal" href="glossary.html#term-authorization-api"><em class="xref std std-term">authorization API</em></a> to the requester,
as standardized by this specification.
This API is <a class="reference internal" href="glossary.html#term-oauth-protected"><em class="xref std std-term">OAuth-protected</em></a>,
requiring a <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a> (issued by the <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>)
for successful access (see <a class="reference internal" href="#uma-core-3-2"><em>Section 3.2</em></a> for this issuance process).</li>
<li>The <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> presents a <a class="reference internal" href="#term-protected-resource"><em class="xref std std-term">protected resource</em></a> to the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a>,
which can be considered &#8211; and may in fact be &#8211;
an application-specific or proprietary API.
This API is <a class="reference internal" href="glossary.html#term-uma-protected"><em class="xref std std-term">UMA-protected</em></a>, requiring a <em class="xref std std-term">requester access token</em> (issued by the AM)
and sufficient permissions (also issued by the AM) for successful access
(see <a class="reference internal" href="#uma-core-3-5"><em>Section 3.5</em></a> for this latter issuance process).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>These are the &#8220;Protection API&#8221; endpoint set.</li>
</ul>
</div>
<p>The AM presents standard OAuth endpoints for token issuance
and user authorization in protecting its own UMA APIs, as follows.</p>
<p>Hosts asking to use the protection API would be issued a PAT.
Requesters asking to use the authorization API would be issued an AAT.</p>
<dl class="glossary docutils">
<dt id="term-token-endpoint">token endpoint</dt>
<dd><p class="first">Part of standard OAuth, as profiled by UMA.
The endpoint at which the host asks for a PAT and the requester
asks for an AAT.
(The AM may also choose to issue a <a class="reference internal" href="glossary.html#term-refresh-token"><em class="xref std std-term">refresh token</em></a>.)</p>
<p class="last">This specification makes the OAuth token profile &#8220;bearer&#8221; mandatory for the AM to implement.
The AM can declare its ability to handle other token profiles.</p>
</dd>
<dt id="term-user-authorization-endpoint">user authorization endpoint</dt>
<dd>Part of standard OAuth, as profiled by UMA.
The endpoint to which the host or requester redirects an authorizing user
or end-user requesting party, respectively,
to authorize it to use this AM in resource protection or authorization,
if the OAuth authorization code grant type
(mandatory for the AM to implement) is being used.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Bearer Token (MTI,Mandatory To Implement)</li>
<li>Code Flow (MTI)</li>
<li>Refresh Token (Optional)</li>
</ul>
</div>
<p>The AM presents the following endpoints to the host as part of its protection API;
these endpoints are OAuth-protected and require a PAT for access,
for which the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; OAuth scope is required:</p>
<dl class="glossary docutils">
<dt id="term-resource-set-registration-endpoint">resource set registration endpoint</dt>
<dd><p class="first">The endpoint at which the host
registers resource sets it wants the AM to protect.  The
operations available at this endpoint constitute a resource set
registration API that is a subset of the protection API (see Section 2.4.3).</p>
<p>ssion registration endpoint
The endpoint at which the host
registers permissions that it anticipates a requester will
shortly be asking for from the AM.</p>
<p>tatus endpoint</p>
<p class="last">The endpoint at which the host submits
(forwards) an RPT that has accompanied an access request, to
learn what currently valid permissions are associated with it.
This specification defines an UMA token profile, &#8220;bearer&#8221;,
which is mandatory for the AM to implement and which, if used,
REQUIRES the host to use this endpoint (see Section 3.3).</p>
</dd>
</dl>
<p>The AM presents the following endpoints to the requester as part of its authorization API;
these endpoints are OAuth-protected and requires an AAT for access,
for which the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authorization">http://docs.kantarainitiative.org/uma/scopes/authorization</a>&#8221; OAuth scope is required:</p>
<dl class="glossary docutils">
<dt id="term-rpt-endpoint">RPT endpoint</dt>
<dd>The endpoint at which the requester asks the AM for the
issuance of an RPT relating to this requesting party, host, and AM.</dd>
<dt id="term-permission-request-endpoint">permission request endpoint</dt>
<dd>The endpoint at which the requester asks
for authorization to have permissions associated with an RPT.</dd>
</dl>
<p>Similarly to OAuth authorization servers, an UMA AM has the
opportunity to manage the validity periods of the access tokens, the
corresponding refresh tokens (in the case of the PAT and AAT), and
even the client credentials that it issues.  Different lifetime
strategies may be suitable for different resources and scopes of
access, and the AM has the opportunity to give the authorizing user
control through policy.  These options are all outside the scope of
this specification.</p>
<ol class="arabic simple" start="5">
<li></li>
</ol>
</div>
<div class="section" id="scopes-resource-sets-permissions-and-authorization">
<span id="uma-core-1-4"></span><h3><a class="toc-backref" href="#id9">1.4.  Scopes, Resource Sets, Permissions, and Authorization</a><a class="headerlink" href="#scopes-resource-sets-permissions-and-authorization" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Scope</strong></p>
</div>
<p>UMA extends the OAuth concept of a &#8220;<a class="reference internal" href="#term-scope"><em class="xref std std-term">scope</em></a>&#8221;
by defining scopes as applying to particular labeled resource sets,
rather than leaving the relevant resources
(such as API endpoints or URIs) implicit.
A resource set can have any number of scopes,
which together describe the universe of actions that <strong>can be</strong>
taken on this protected resource set.
For example,
a resource set representing a status update API might have scopes
that include adding an update or reading updates.
A resource set representing a photo album might have scopes
that include viewing a slideshow or printing the album.
Hosts register resource sets and their scopes when there is not yet any
requesting party or requester in the picture.</p>
<p>Resource sets and scopes have meaning only to hosts and their users,
in the same way that application-specific host APIs have meaning only
to these entities.  The AM is merely a conveyor of labels and
descriptions for these constructs, to help the authorizing user set
policies that guide eventual authorization processes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Permission</strong></p>
</div>
<p>In contrast to an UMA scope,
an UMA permission reflects an <strong>actual</strong> authorization process
for a requester to access a particular resource set in a scoped (bounded) manner.
Hosts register permission requests on behalf of requesters that have attempted access.
Requesters subsequently ask AMs for (potentially multiple) permissions
to be associated with their tokens.  AMs grant (or deny) permissions to requesters.</p>
<p>A requester access token is bound to a single authorizing user,
a single host where protected resources controlled by that user reside,
a single AM that controls access to those resource sets, and a single requester.
Put another way, each requester access token is associated with as many permissions
as are appropriate for gaining authorized access to that user&#8217;s resources at that host,
protected by any single AM.
Thus, if an authorizing user happens to protect different resources at a host using two AMs,
any requester accessing resources on both sides of that &#8220;AM divide&#8221; would end up acquiring two access tokens.</p>
<p>In order to represent meaningful, auditable, and potentially legally
enforceable authorization (see [<em class="xref std std-term">UMA-trustmodel</em>]), a permission is
conceptually bound to a particular set of UMA entities and parties.
This includes the requesting party, the requester (so that the same
requesting party would have to go through the authorization process
for each client application they use), the host, the resource set on
which access is being attempted, and therefore also the AM protecting
it and the authorizing user who is controlling access.</p>
<p>Unlike scopes (but similarly to tokens themselves; see <a class="reference internal" href="#uma-core-1-3"><em>Section 1.3</em></a>),
permissions have a validity period.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
<div class="section" id="am-configuration-data">
<span id="uma-core-1-5"></span><h3><a class="toc-backref" href="#id10">1.5.  AM Configuration Data</a><a class="headerlink" href="#am-configuration-data" title="Permalink to this headline">¶</a></h3>
<p>The AM MUST provide configuration data to other entities it interacts
with in aJSON [RFC4627] document that resides in an /uma-
configuration directory at at its hostmeta [RFC6415] location.  The
configuration data documents major conformance options supported by
the AM (described further in <a class="reference internal" href="#uma-core-7"><em>Section 7</em></a>) and protection and
authorization API endpoints (as described in <em class="xref std std-ref">Section 1.3</em>).</p>
<p>The configuration data has the following properties and a Content-Type
of <strong>application/uma-configuration+json</strong>.
All endpoint URIs supplied SHOULD require the use of a transport-layer security mechanism such as TLS.</p>
<dl class="glossary docutils">
<dt id="term-version">version</dt>
<dd>REQUIRED.  The version of the UMA core protocol to which this
AM conforms.  The value MUST be the string &#8220;1.0&#8221;.</dd>
<dt id="term-issuer">issuer</dt>
<dd>REQUIRED.  A URI indicating the party operating the AM.</dd>
<dt id="term-dynamic-client-registration-supported">dynamic_client_registration_supported</dt>
<dd>OPTIONAL.  Whether dynamic client registration, such as through
[OCDynClientReg], is supported for both hosts and requesters.
The value, if this property is present, the value MUST be the
string &#8220;yes&#8221; (dynamic registration is supported, using an
unspecified method) or &#8220;no&#8221; (it is not supported; hosts and
requesters are required to pre-register).  The default is AM-
specific.  This property is not currently extensible.  (This
conformance option is largely a placeholder for now.)</dd>
<dt id="term-token-types-supported">token_types_supported</dt>
<dd><p class="first">REQUIRED.</p>
<p>Access token types produced by this AM.</p>
<p>The property value is an <strong>array</strong> of string values.
Currently the only string value for this property defined by this specification is &#8220;<a class="reference internal" href="glossary.html#term-artifact"><em class="xref std std-term">artifact</em></a>&#8221;,
meaning an <strong>opaque token string</strong> whose associations
the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> MUST determine through a token status interaction with the <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>
(see <a class="reference internal" href="#uma-core-3-3"><em>Section 3.3</em></a>).</p>
<p class="last">The AM is REQUIRED to support the <strong>artifact</strong> token type,
and to supply this string value explicitly.
The AM MAY declare its support for
additional access token types by assigning each one a unique
absolute URI in a string value in the array.</p>
</dd>
<dt id="term-host-grant-types-supported">host_grant_types_supported</dt>
<dd><p class="first">REQUIRED.</p>
<p><a class="reference internal" href="glossary.html#term-oauth-grant-types"><em class="xref std std-term">OAuth grant types</em></a> supported by this <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>.
The property value is an <strong>array of string values</strong>.</p>
<p>Each string value MUST be one of the <a class="reference internal" href="oauth.html#term-grant-type"><em class="xref std std-term">grant_type</em></a> values defined in [<a class="reference internal" href="glossary.html#term-oauth2"><em class="xref std std-term">OAuth2</em></a>],
or alternatively an <a class="reference internal" href="glossary.html#term-extension-grant-type"><em class="xref std std-term">extension grant type</em></a>
indicated by a <strong>unique absolute URI</strong>.</p>
<p>The AM is REQUIRED to support the &#8220;<a class="reference internal" href="glossary.html#term-341"><em class="xref std std-term">authorization_code</em></a>&#8221; and
&#8220;<a class="reference internal" href="glossary.html#term-344"><em class="xref std std-term">client_credentials</em></a>&#8221; <a class="reference internal" href="oauth.html#term-grant-types"><em class="xref std std-term">grant types</em></a>,
and to supply these values explicitly.</p>
<p class="last">The <a class="reference internal" href="glossary.html#term-341"><em class="xref std std-term">authorization_code</em></a> <a class="reference internal" href="glossary.html#term-grant-type"><em class="xref std std-term">grant type</em></a> is primarily intended for use with <a class="reference internal" href="glossary.html#term-hosts"><em class="xref std std-term">hosts</em></a>,
and the <a class="reference internal" href="glossary.html#term-344"><em class="xref std std-term">client_credentials</em></a> grant type is primarily intended for use with <a class="reference internal" href="#term-requesters"><em class="xref std std-term">requesters</em></a>. <a class="footnote-reference" href="#id2" id="id1">[1]</a></p>
</dd>
<dt id="term-claim-types-supported">claim_types_supported</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Claim formats and associated sub-protocols for gathering claims from requesting parties,
as supported by this AM.</p>
<p>The property value is an array of string values.</p>
<p>Currently the only string value for this property defined by this specification is &#8220;openid&#8221;,
for which details are supplied in <em class="xref std std-ref">Section 3.6.1.1</em>.</p>
<p class="last">The AM MAY declare its support for additional claim types
by assigning each one a unique absolute URI in a string value in the array.</p>
</dd>
<dt id="term-host-token-endpoint">host_token_endpoint</dt>
<dd>REQUIRED.  The property value is a string conveying the host
access token endpoint URI, at which the host asks for a host
access token.  Available HTTP methods are as defined by
[OAuth2] for a token endpoint.</dd>
<dt id="term-host-user-endpoint">host_user_endpoint</dt>
<dd>REQUIRED.  The property value is a string conveying the host
user authorization endpoint URI, at which the host gathers the
consent of the authorizing user for a host-AM relationship if
it is using the &#8220;authorization_code&#8221; grant type.  Available
HTTP methods are as defined by [OAuth2] for an end-user
authorization endpoint.</dd>
<dt id="term-42">resource_set_registration_endpoint</dt>
<dd>REQUIRED.  The property value is a string conveying the
resource set registration endpoint URI, at which the host
registers resource sets with the AM to put them under its
protection (see <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>).
Requests to this endpoint
require a host access token to be present.</dd>
<dt id="term-token-status-endpoint">token_status_endpoint</dt>
<dd>REQUIRED.  The property value is a string conveying the token
status endpoint URI, at which the host requests the status of
access tokens presented to them by requesters (see
Section 3.3).  Requests to this endpoint require a host access
token to be present.</dd>
<dt id="term-permission-registration-endpoint">permission_registration_endpoint</dt>
<dd>REQUIRED.  The property value is a string conveying the
permission registration endpoint URI, at which the host
registers permissions with the AM for which a requester will be
seeking authorization (see Section 3.4).  Requests to this
endpoint require a host access token to be present.</dd>
<dt id="term-requester-token-endpoint">requester_token_endpoint</dt>
<dd>REQUIRED.  The property value is a string conveying the
requester access token endpoint URI, at which the requester
asks for an access token.  Available HTTP methods are as
defined by [OAuth2] for a token issuance endpoint.</dd>
<dt id="term-46">permission_request_endpoint</dt>
<dd>REQUIRED.  The property value is a string conveying the
permission endpoint URI, at which the requester asks for
authorization to have a new permission associated with its
existing requester access token, which MUST accompany the
request (see Section 3.5).</dd>
</dl>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>I&#8217;m not quite sure what this state is intented for.
This configuration parameter is used for OAuth with host, AM and User.
Why is Requester talked about here? ... :-&lt;</td></tr>
</tbody>
</table>
<p>The following is an example of AM configuration data that resides at
<a class="reference external" href="https://example.com/.well-known/uma-configuration">https://example.com/.well-known/uma-configuration</a>:</p>
<p>Example of AM configuration data that resides at
<a class="reference external" href="https://example.com/.well-known/uma-configuration">https://example.com/.well-known/uma-configuration</a>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
<span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="s2">&quot;issuer&quot;</span><span class="o">:</span><span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
<span class="s2">&quot;dynamic_client_registration_supported&quot;</span><span class="o">:</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span>
<span class="s2">&quot;token_types_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;artifact&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;host_grant_types_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span>
  <span class="s2">&quot;client_credentials&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;claim_types_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;openid&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;host_token_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://am.example.com/host/token_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;host_user_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://am.example.com/host/user_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;resource_set_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://am.example.com/host/rsrc_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;token_status_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://am.example.com/host/status_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;permission_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://am.example.com/host/perm_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;requester_token_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://am.example.com/requester/token_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;permission_request_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://am.example.com/requester/perm_uri&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>AM configuration data MAY contain extension properties that are not
defined in this specification.  The names of extension properties
MUST consist of a fully qualified URL, or begin with &#8220;x-&#8221; or &#8220;X-&#8221;.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
</div>
<div class="section" id="protecting-a-resource">
<span id="uma-core-2"></span><h2><a class="toc-backref" href="#id11">2. Protecting a Resource</a><a class="headerlink" href="#protecting-a-resource" title="Permalink to this headline">¶</a></h2>
<p>Phase 1 of UMA is protecting a resource.
The <a class="reference internal" href="glossary.html#term-user"><em class="xref std std-term">user</em></a>, <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>, and <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>
perform the following steps in order to successfully complete Phase 1:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>
(having learned the general location of the relevant <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a> out of band)
looks up the AM&#8217;s configuration data and
learns about its relevant endpoints and supported formats.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">Discovery ( <a class="reference internal" href="discovery.html"><em>OpenID Connect Discovery 1.0</em></a> )? for</p>
<blockquote>
<div><ul class="simple">
<li>configuration parameters</li>
<li>endpoints</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</li>
<li><p class="first">If the host has not yet obtained a unique OAuth client identifier
and optional secret from the AM,
it registers with the AM as required.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">Dynamic Registration ( <a class="reference internal" href="reg.html"><em>OpenID Connect Dynamic Client Registration 1.0</em></a> ) ? to get</p>
<blockquote>
<div><ul class="simple">
<li>OAuth <a class="reference internal" href="oauth.html#term-client-identifier"><em class="xref std std-term">Client Identifier</em></a></li>
<li>OAuth <a class="reference internal" href="glossary.html#term-225"><em class="xref std std-term">Client Secret</em></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</li>
<li><p class="first">The host obtains a <a class="reference internal" href="#term-protection-api-token"><em class="xref std std-term">protection API token</em></a> (<a class="reference internal" href="#term-pat"><em class="xref std std-term">PAT</em></a>) from the AM with
the authorizing user&#8217;s consent, by asking for the
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OAuth Flow</li>
<li>optional scope : <a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a></li>
</ul>
</div>
</li>
<li><p class="first">The host registers any resource sets with the AM that are
intended to be protected.
(This step is repeated when and as needed.)</p>
</li>
</ol>
</div></blockquote>
<p>If the host undertakes these actions successfully, the results are as follows:</p>
<blockquote>
<div><ul class="simple">
<li>The host has received configuration data about the AM, such as
endpoints it needs to use in interacting with the AM.</li>
<li>The host has received a PAT that represents this authorizing
user&#8217;s approval for the host to work with the AM in protecting
resources.</li>
<li>The AM has acquired information about <a class="reference internal" href="#term-resource-sets"><em class="xref std std-term">resource sets</em></a>
at this host that it is supposed to protect on behalf of this authorizing user.</li>
</ul>
</div></blockquote>
<p>(draft 05 )</p>
<div class="section" id="host-looks-up-am-configuration-data">
<span id="uma-core-2-1"></span><h3><a class="toc-backref" href="#id12">2.1.  Host Looks Up AM Configuration Data</a><a class="headerlink" href="#host-looks-up-am-configuration-data" title="Permalink to this headline">¶</a></h3>
<p>The host needs to learn the AM&#8217;s protection API endpoints before they
can begin interacting.  To get the host started in this process, the
authorizing user might provide the AM&#8217;s location to it, for example,
by typing a URL into a web form field or clicking a button.
Alternatively, the host might already be configured to work with a
single AM without requiring any user input.  The exact process is
beyond the scope of this specification, and it is up to the host to
choose a method to learn the AM&#8217;s general location.</p>
<p>From the data provided, discovered, or configured, the host MUST
retrieve the AM&#8217;s hostmeta document, as described in Section 2 of
hostmeta [RFC6415].  For example, if the user supplied &#8220;example.com&#8221;
as the Authorization Manager&#8217;s domain, the host creates the URL
&#8220;<a class="reference external" href="https://example.com/.well-known/uma-configuration">https://example.com/.well-known/uma-configuration</a>&#8221; and performs a
GET request on it.  The AM MUST return content that includes UMA
protection API endpoints as defined in <a class="reference internal" href="#uma-core-1-5"><em>Section 1.5</em></a>.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
<div class="section" id="host-registers-with-am">
<span id="uma-core-2-2"></span><h3><a class="toc-backref" href="#id13">2.2.  Host Registers with AM</a><a class="headerlink" href="#host-registers-with-am" title="Permalink to this headline">¶</a></h3>
<p>If the host has not already obtained an OAuth client identifier and
optional secret from this AM, in this step it MUST do so in order to
engage in OAuth-based interactions with the AM.  It MAY do this using
[<em class="xref std std-term">OCDynClientReg</em>], if the AM supports it (see <a class="reference internal" href="#uma-core-1-5"><em>Section 1.5</em></a> for how the
AM MAY indicate support).</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
<div class="section" id="host-obtains-protection-api-token">
<span id="uma-core-2-3"></span><h3><a class="toc-backref" href="#id14">2.3.  Host Obtains Protection API Token</a><a class="headerlink" href="#host-obtains-protection-api-token" title="Permalink to this headline">¶</a></h3>
<p>In this step, the host acquires a PAT from the AM.  The token
represents the approval of the authorizing user for this host to
trust this AM for protecting resources belonging to this user.</p>
<p>The host MUST use OAuth 2.0 [OAuth2] to obtain the protection API
token.  Here the host acts in the role of an OAuth client requesting
the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope;
the authorizing user acts in the role of an OAuth end-user resource
owner; and the AM acts in the role of an OAuth authorization server.
Once the host has obtained its PAT, it presents it to the AM at
various protection API endpoints; in presenting these endpoints the
AM acts in the role of a resource server.</p>
<p>The AM MAY support the use of any grant type, but MUST support the
authorization_code grant type, and SHOULD support the SAML bearer
token grant type [OAuth-SAML]
(<a class="reference external" href="urn:ietf:params:oauth:grant-type:saml2-bearer">urn:ietf:params:oauth:grant-type:saml2-bearer</a>) if it anticipates
working with hosts that are operating in environments where the use
of SAML is prevalent.  The AM MUST indicate all grant types it
supports in its configuration data, as defined in Section 1.5.</p>
<p>The host has completed this step successfully when it possesses a PAT
it can use to get access to the AM&#8217;s protection API on this user&#8217;s
behalf.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="host-registers-sets-of-resources-to-be-protected">
<span id="uma-core-2-4"></span><h3><a class="toc-backref" href="#id15">2.4. Host Registers Sets of Resources to Be Protected</a><a class="headerlink" href="#host-registers-sets-of-resources-to-be-protected" title="Permalink to this headline">¶</a></h3>
<p>Once the host has received a PAT, for any of the user&#8217;s sets of
resources that are to be protected by this AM, it MUST register these
<a class="reference internal" href="#term-resource-sets"><em class="xref std std-term">resource sets</em></a> at the AM&#8217;s <em class="xref std std-term">registration endpoint</em>.</p>
<p>Note that the host is free to offer the option to protect any subset
of the user&#8217;s resources using different AMs or other means entirely,
or to protect some resources and not others.  Additionally, the
choice of protection regimes can be made explicitly by the user or
implicitly by the host.  Any such partitioning by the host or user is
outside the scope of this specification.</p>
<p>See <a class="reference internal" href="#uma-core-10"><em>Section 10</em></a> for an extended example of registering <a class="reference internal" href="#term-resource-sets"><em class="xref std std-term">resource sets</em></a>.</p>
<p>(draft 05)</p>
<div class="section" id="scope-descriptions">
<span id="uma-core-2-4-1"></span><h4><a class="toc-backref" href="#id16">2.4.1. Scope Descriptions</a><a class="headerlink" href="#scope-descriptions" title="Permalink to this headline">¶</a></h4>
<p>A <strong>scope</strong> is a bounded extent of access that is possible to perform on
a resource set.  A scope description is a JSON document with the
following properties and a Content-Type of <strong>application/uma-scope+json</strong>:</p>
<dl class="glossary docutils">
<dt id="term-name">name</dt>
<dd><p class="first">REQUIRED.</p>
<p>A human-readable string describing some scope (extent) of access.</p>
<p>This name is intended for ultimate use in the AM&#8217;s user interface
to assist the user in setting policies for protected resource sets
that have this available scope.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>「三井住友銀行:普通預金口座」とか、「三井住友銀号:お客様情報」とか</li>
</ul>
</div>
</dd>
<dt id="term-icon-uri">icon_uri</dt>
<dd><p class="first">OPTIONAL.</p>
<p>A URI for a graphic icon representing the scope.</p>
<p class="last">The referenced icon is intended for ultimate use in the AM&#8217;s user interface
to assist the user in setting policies for protected
resource sets that have this available scope.</p>
</dd>
</dl>
<p>For example, this description characterizes a scope that involves
reading or viewing resources (vs. creating them or editing them in
some fashion):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;View&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/reading-glasses&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Scope descriptions MAY contain extension properties
that are not defined in this specification.
Extension names that are unprotected
from collisions are outside the scope of the current specification.</p>
<p>A host MUST list a <a class="reference internal" href="#term-resource-set"><em class="xref std std-term">resource set</em></a>&#8216;s available scopes using URI references
(as defined in <a class="reference internal" href="#uma-core-2-4-2"><em>Section 2.4.2</em></a>).</p>
<p>The scopes available for use at any one host MUST have unique URI references
so that the host&#8217;s scope descriptions are uniquely distinguishable.
A scope URI reference MAY include a fragment identifier.
Scope descriptions MAY reside anywhere.
The host is not required to self-host scope descriptions
and may wish to point to standardized scope descriptions residing elsewhere.
Scope description documents MUST be accessible
to AMs through GET calls made to these URI references.</p>
<p>See <a class="reference internal" href="#uma-core-1-4"><em>Section 1.4</em></a> for further discussion of scope-related concepts, and
Section 10 for a long-form example of scopes used in resource set
registration.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="resource-set-descriptions">
<span id="uma-core-2-4-2"></span><h4><a class="toc-backref" href="#id17">2.4.2. Resource Set Descriptions</a><a class="headerlink" href="#resource-set-descriptions" title="Permalink to this headline">¶</a></h4>
<p>The host defines a resource set that needs protection
by registering a resource set description at the AM.
The host registers the description and manages its lifecycle at the AM&#8217;s host resource set
registration endpoint by using the resource set registration API,
as defined in Section 2.4.3.</p>
<p>A resource set description is a JSON document with the following
properties and a Content-Type of <strong>application/uma-resource-set+json:</strong></p>
<dl class="glossary docutils">
<dt id="term-49">name</dt>
<dd><p class="first">REQUIRED.</p>
<p>A human-readable string describing a set of one or more resources.
The AM SHOULD use the name in its user interface to assist the user
in setting policies for protecting this
resource set.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>「三井住友銀号:総合口座」とか</li>
</ul>
</div>
</dd>
<dt id="term-50">icon_uri</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">A URI for a graphic icon representing the
resource set.  If provided, the AM SHOULD use the referenced icon
in its user interface to assist the user in setting policies for
protecting this resource set.</p>
</dd>
<dt id="term-scopes">scopes</dt>
<dd><p class="first">REQUIRED.</p>
<p>An array providing the URI references of <em class="xref std std-ref">scope descriptions</em>
that are available for this resource set.</p>
<p>The AM SHOULD use the scope names and any icons defined as part of the
referenced scopes in its user interface to assist the user in
setting policies for protecting this resource set.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>「三井住友銀行:普通預金口座」、「三井住友銀行:お客様情報」、、、、、</li>
</ul>
</div>
</dd>
</dl>
<p>For example, this description characterizes a resource set (a photo
album) that can potentially be only viewed, or alternatively to which
full access can be granted; the URIs point to scope descriptions as
defined in <a class="reference internal" href="#uma-core-2-4-1"><em>Section 2.4.1</em></a>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Photo Album&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower.png&quot;</span><span class="p">,</span>
  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Resource set descriptions MAY contain extension properties that are
not defined in this specification.  Extension names that are
unprotected from collisions are outside the scope of the current
specification.</p>
<p>When a host creates or updates a resource set description
(see <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>),
the AM MUST attempt to retrieve the referenced scope
descriptions.  It MAY cache such descriptions as long as indicated in
the HTTP cache-control header for the scope description resource
unless the resource set description is subsequently updated within
the validity period.  At the beginning of an authorizing user&#8217;s login
session at the AM, the AM MUST attempt to re-retrieve scope
descriptions applying to that user whose cached versions have
expired.</p>
<p>(draft 05)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">For Connect Aggreated Claims,
following additional claims may be provided
for the AM to fetch resources in charge of the resource owner.</p>
<blockquote>
<div><ul class="simple">
<li>refresh_token(required)</li>
<li>access_token(potional)</li>
<li>token endpoint</li>
<li>resource endpoint</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">And, if aother API call is lengthy, following claims should be returned for
the <a class="reference internal" href="oauth.html#oauth-client-authentication"><em>client authentication</em></a> to
the token endpoint.</p>
<blockquote>
<div><ul class="simple">
<li>client identfiier</li>
<li>client secret</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Tokens&#8217; scope MUST be any in scopes of this resource set description.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="resource-set-registration-api">
<span id="uma-core-2-4-3"></span><h4><a class="toc-backref" href="#id18">2.4.3. Resource Set Registration API</a><a class="headerlink" href="#resource-set-registration-api" title="Permalink to this headline">¶</a></h4>
<p>The host uses the RESTful API at the AM&#8217;s resource set registration
endpoint to create, read, update, and delete resource set
descriptions, along with listing groups of such descriptions.  The
host MUST use its valid PAT obtained previously to gain access to this endpoint.
The resource set registration API is a subset of the protection API.</p>
<p>The host is free to use its own methods of identifying and describing resource sets.
The AM MUST treat them as opaque for the purpose of authorizing access,
other than associating them with the authorizing user
(as represented by the PAT used to access the API).
On successfully registering a resource set, the host MUST use UMA
mechanisms to limit access to any resources corresponding to this
resource set, relying on the AM to supply currently valid permissions
for authorized access.
The host MUST outsource protection to the AM according to the currently registered state of a resource set.  This
requirement holds true so long as the host has one or more registsred
resource sets.</p>
<p>(Note carefully the similar but distinct senses in which the word
&#8220;resource&#8221; is used in this section.  UMA resource set descriptions
are themselves managed as web resources at the AM through this API.)</p>
<p>The AM MUST present an API for registering resource set descriptions
at a set of URIs with the structure &#8220;<a class="reference internal" href="#term-rsreguri"><em class="xref std std-term">{rsreguri}</em></a>/resource_set/<a class="reference internal" href="#term-rsid"><em class="xref std std-term">{rsid}</em></a>&#8221;,
where the PAT provides sufficient context to distinguish between
identical resource set identifiers assigned by different hosts.</p>
<p>The components of these URIs are defined as follows:</p>
<dl class="glossary docutils">
<dt id="term-rsreguri">{rsreguri}</dt>
<dd>The AM&#8217;s resource set registration endpoint as advertised
in its configuration data (see Section 1.5).</dd>
<dt id="term-rsid">{rsid}</dt>
<dd>An identifier for a resource set description.</dd>
</dl>
<p>Without a specific resource set identifier path component, the URI
applies to the set of resource set descriptions already registered.</p>
<p>Following is a summary of the five registration operations the AM is
REQUIRED to support.  Each is defined in its own section below.  All
other methods are unsupported.  This API uses ETag and If-Match to
ensure the desired resource at the AM is targeted.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#uma-core-create-resource-set-description"><em>Create resource set description</em></a>: PUT /resource_set/{rsid}</li>
<li><a class="reference internal" href="#uma-core-read-resource-set-description"><em>Read resource set description</em></a>: GET /resource_set/{rsid}</li>
<li><a class="reference internal" href="#uma-core-update-resource-set-description"><em>Update resource set description</em></a>: PUT /resource_set/{rsid} with If-
Match</li>
<li><a class="reference internal" href="#uma-core-delete-resource-set-description"><em>Delete resource set description</em></a>: DELETE /resource_set/{rsid}</li>
<li><a class="reference internal" href="#uma-core-list-resource-set-descriptions"><em>List resource set descriptions</em></a>: GET /resource_set/ with If-Match</li>
</ul>
</div></blockquote>
<p>If the request to the resource set registration endpoint is incorrect,
then the AM responds with an error message (see <a class="reference internal" href="#uma-core-4-2"><em>Section 4.2</em></a>)
by including one of the following error codes with the response:</p>
<dl class="glossary docutils">
<dt id="term-unsupported-method-type">unsupported_method_type</dt>
<dd>The host request used an unsupported HTTP
method.  The AM MUST respond with the HTTP 405 (Method Not
Allowed) status code and MUST fail to act on the request.</dd>
<dt id="term-not-found">not_found</dt>
<dd>The resource set requested from the AM cannot be found.
The AM MUST respond with HTTP 404 (Not Found) status code.</dd>
<dt id="term-precondition-failed">precondition_failed</dt>
<dd>The resource set that was requested to be
deleted or updated at the AM did not match the If-Match value
present in the request.  The AM MUST respond with HTTP 412
(Precondition Failed) status code and MUST fail to act on the
request.</dd>
</dl>
<p>(draft 05)</p>
<div class="section" id="create-resource-set-description">
<span id="uma-core-create-resource-set-description"></span><span id="uma-core-2-4-3-1"></span><h5><a class="toc-backref" href="#id19">2.4.3.1. Create Resource Set Description</a><a class="headerlink" href="#create-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Adds a new resource set description using the PUT method,
thereby putting it under the AM&#8217;s protection.
If the request is successful,
the AM MUST respond with a status message
that includes an <em class="xref std std-term">ETag</em> header and <strong>_id</strong> and <strong>_rev</strong> properties
for managing resource set description versioning.</p>
<p>Form of a &#8220;create resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>PUT /resource_set/{rsid} HTTP/1.1
Content-Type: application/uma-resource-set+json
...

(body contains JSON resource set description to be created)</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: (matches "_rev" property in returned object)
...

{
  "status": "created",
  "_id": (id of created resource set),
  "_rev": (ETag of created resource set)
}</pre>
</div>
<p>On successful registration,
the AM MAY return a <em class="xref std std-term">redirect policy URI</em>
to the host in a property with the name &#8220;policy_uri&#8221;.
This URI allows the host to redirect the user to a specific user interface
within the AM where the user can immediately set or modify access policies
for the resource set that was just registered.</p>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: (matches "_rev" property in returned object)
...

{
  "status": "created",
  "_id": (id of created resource set),
  "_rev": (ETag of created resource set)
  "policy_uri":"http://am.example.com/host/222/resource/333/policy"
}</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="read-resource-set-description">
<span id="uma-core-read-resource-set-description"></span><span id="uma-core-2-4-3-2"></span><h5><a class="toc-backref" href="#id20">2.4.3.2.  Read Resource Set Description</a><a class="headerlink" href="#read-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Reads a previously registered resource set description using the GET
method.
If the request is successful,
the AM MUST respond with a status message
that includes an <em class="xref std std-term">ETag</em> header and <strong>_id</strong> and <strong>_rev</strong>
properties for managing resource set description versioning.</p>
<p>Form of a &#8220;read resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>GET /resource_set/{rsid} HTTP/1.1
...</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/uma-resource-set+json
...

(body contains JSON resource set description, including _id and _rev)</pre>
</div>
<p>If the referenced resource does not exist,
the AM MUST produce an error response with an error property value of &#8220;<strong>not_found</strong>&#8221;,
as defined in <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>.</p>
<p>On successful read,
the AM MAY return a redirect policy URI to the host in a property with the name &#8220;<em class="xref std std-term">policy_uri</em>&#8221;.
This URI allows the host to redirect the user to a specific user interface within the AM
where the user can immediately set or modify access policies for the resource set that was read.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>policy_uri seems to be a part of scope description JSON.....</li>
</ul>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="update-resource-set-description">
<span id="uma-core-update-resource-set-description"></span><span id="uma-core-2-4-3-3"></span><h5><a class="toc-backref" href="#id21">2.4.3.3.  Update Resource Set Description</a><a class="headerlink" href="#update-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Updates a previously registered resource set description using the
PUT method, thereby changing the resource set&#8217;s protection
characteristics.  If the request is successful, the AM MUST respond
with a status message that includes an <em class="xref std std-ref">ETag</em> header and <strong>_id</strong> and <strong>_rev</strong>
properties for managing resource set description versioning.</p>
<p>Form of an &#8220;update resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>PUT /resource_set/{rsid} HTTP/1.1
Content-Type: application/resource-set+json
If-Match: (entity tag of resource)
...

(body contains JSON resource set description to be updated)</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 204 No Content
ETag: "2"
...</pre>
</div>
<p>If the entity tag does not match, the AM MUST produce an error
response with an error property value of &#8220;precondition_failed&#8221;, as
defined in <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>.</p>
<p>On successful update, the AM MAY return a redirect policy URI to the
host in a property with the name &#8220;policy_uri&#8221;.  This URI allows the
host to redirect the user to a specific user interface within the AM
where the user can immediately set or modify access policies for the
resource set that was just updated.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>It is unclear where <strong>policy_uri</strong> should be returned. in header or paylaod ?</li>
</ul>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="delete-resource-set-description">
<span id="uma-core-delete-resource-set-description"></span><span id="uma-core-2-4-3-4"></span><h5><a class="toc-backref" href="#id22">2.4.3.4.  Delete Resource Set Description</a><a class="headerlink" href="#delete-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Deletes a previously registered resource set description using the
DELETE method, thereby removing it from the AM&#8217;s protection regime.</p>
<p>Form of a &#8220;delete resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>DELETE /resource_set/{rsid}
If-Match: (entity tag of resource)
...</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 204 No content
...</pre>
</div>
<p>As defined in <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>, if the referenced resource does not
exist the AM MUST produce an error response with an error property
value of &#8220;not_found&#8221;, and if the entity tag does not match the AM
MUST produce an error response with an error property value of
&#8220;precondition_failed&#8221;.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="list-resource-set-descriptions">
<span id="uma-core-list-resource-set-descriptions"></span><span id="uma-core-2-4-3-5"></span><h5><a class="toc-backref" href="#id23">2.4.3.5.  List Resource Set Descriptions</a><a class="headerlink" href="#list-resource-set-descriptions" title="Permalink to this headline">¶</a></h5>
<p>Lists all previously registered resource set identifiers for this
user using the GET method.  The AM MUST return the list in the form
of a JSON array of {rsid} values.</p>
<p>The host uses this method as a first step in checking whether its
understanding of protected resources is in full synchronization with
the AM&#8217;s understanding.</p>
<p>Form of a &#8220;list resource set descriptions&#8221; HTTP request:</p>
<div class="highlight-python"><pre>GET /resource_set HTTP/1.1
...</pre>
</div>
<p>HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
...

(body contains JSON array of {rsid} values)</pre>
</div>
<p>(draft 05)</p>
</div>
</div>
</div>
</div>
<div class="section" id="getting-authorization-and-accessing-a-resource">
<span id="uma-core-3"></span><h2><a class="toc-backref" href="#id24">3. Getting Authorization and Accessing a Resource</a><a class="headerlink" href="#getting-authorization-and-accessing-a-resource" title="Permalink to this headline">¶</a></h2>
<p>Phase 2 of UMA is getting authorization,
and Phase 3 is accessing a resource.
In these phases,
an AM orchestrates and controls requesting parties&#8217; access
to an authorizing user&#8217;s protected resources at a host,
under conditions dictated by that user.</p>
<p>Phase 3 is merely the successful completion of a requester&#8217;s access attempt
that initially involved several embedded interactions among the requester,
AM, and host in Phase 2.</p>
<p>Phase 2 always begins with the requester attempting access
at a protected resource endpoint at the host.
How the requester came to learn about this endpoint is out of scope for this specification.
The authorizing user might, for example, have advertised its availability publicly
on a blog or other website, listed it in a discovery service,
or emailed a link to a particular intended requesting party.</p>
<p>The host responds to the requester&#8217;s access request in one of several ways
depending on the circumstances of the request,
either immediately or having first performed one or more embedded interactions with the AM.
Depending on the nature of the host&#8217;s response to an failed access attempt,
the requester itself engages in embedded interactions
with the AM before re-attempting access.</p>
<p>The interactions are as follows.
Each interaction MAY be the last,
if the requester chooses not to continue pursuing the access attempt
or the host chooses not to continue facilitating it.</p>
<ol class="arabic">
<li><p class="first">The requester attempts access at a particular protected resource
at a host (see <a class="reference internal" href="#uma-core-3-1"><em>Section 3.1</em></a>).</p>
<ol class="upperalpha">
<li><p class="first">If the access attempt is unaccompanied
by a <em class="xref std std-term">requester access token</em>,
the host responds immediately with an HTTP 401 (Unauthorized) response
and instructions on where to go to obtain one (see <a class="reference internal" href="#uma-core-3-4-4"><em>Section 3.4.4</em></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Request with No Access Token -&gt; 401</p>
</div>
</li>
<li><p class="first">If the access attempt was accompanied by an <a class="reference internal" href="#term-rpt"><em class="xref std std-term">RPT</em></a>,
the host checks the RPT&#8217;s status (see <a class="reference internal" href="#uma-core-3-3"><em>Section 3.3</em></a>).</p>
<ol class="arabic">
<li><p class="first">If the <a class="reference internal" href="#term-rpt"><em class="xref std std-term">RPT</em></a> is invalid
(for example, it is not applicable to this host),
the host responds to the requester with an
HTTP 401 (Unauthorized) response and instructions on
where to go to obtain a token (see <a class="reference internal" href="#uma-core-3-4-4"><em>Section 3.4.4</em></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Invald Token -&gt; 401</p>
</div>
</li>
<li><p class="first">If the RPT is valid but has insufficient permission,
the host registers a suitable permission request on the requester&#8217;s behalf
at the AM (see <a class="reference internal" href="#uma-core-3-2"><em>Section 3.2</em></a>),
and then responds to the requester with an HTTP 403 (Forbidden) response
and instructions on where to go to request authorization
to associate that permission with its token
(see <a class="reference internal" href="#uma-core-3-1-2"><em>Section 3.1.2</em></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Valid Token , but no permission -&gt; 403 + Ticket</p>
</div>
</li>
<li><p class="first">If the RPT is valid, and at least one of the permissions
associated with the token matches the scope of attempted
access, the host responds to the requester&#8217;s access
attempt with an HTTP 200 (OK) response and a
representation of the resource (see <a class="reference internal" href="#uma-core-3-1-3"><em>Section 3.1.3</em></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Valid Token with enough Permission -&gt; 200 + Resource</p>
</div>
</li>
</ol>
</li>
</ol>
</li>
<li><p class="first">If the requester (possessing no RPT or an invalid RPT) received a
401 response and an RPT endpoint, it then requests an RPT from
that endpoint (see <a class="reference internal" href="#uma-core-3-4-4"><em>Section 3.4.4</em></a>).</p>
</li>
<li><p class="first">If the requester (posessing a valid RPT) received a 403 response
and a <em class="xref std std-term">permission ticket</em>,
it then requests from the AM the permission that matches the ticket (<a class="reference internal" href="#uma-core-3-4-5"><em>Section 3.4.5</em></a>).</p>
<p>If the AM needs requesting party claims
in order to assess this requester&#8217;s suitability to have the permission,
it engages in a claims-gathering flow with the requesting party (see <a class="reference internal" href="#uma-core-3-5"><em>Section 3.5</em></a>).</p>
<ol class="upperalpha simple">
<li>If the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> does not already have an <a class="reference internal" href="#term-aat"><em class="xref std std-term">AAT</em></a>
at the appropriate AM to be able to use its <a class="reference internal" href="#term-permission-request-endpoint"><em class="xref std std-term">permission request endpoint</em></a>,
it first engages in an OAuth grant flow to obtain one (see Section <a class="reference internal" href="#uma-core-3-4-3"><em>3.4.3</em></a>).</li>
</ol>
</li>
</ol>
<p>The interactions are described in detail in the following sections.</p>
<p>(draft 05)</p>
<div class="section" id="requester-host-attempt-access-at-protected-resource">
<span id="uma-core-3-1"></span><h3><a class="toc-backref" href="#id25">3.1.  Requester-Host: Attempt Access at Protected Resource</a><a class="headerlink" href="#requester-host-attempt-access-at-protected-resource" title="Permalink to this headline">¶</a></h3>
<p>This interaction assumes that the host has previously registered with
an AM one or more resource sets that correspond to the resource to
which access is being attempted, such that the host considers this
resource to be UMA-protected by a particular AM.</p>
<p>The requester typically attempts to access the desired resource at
the host directly (for example, when a human operator of the
requester software clicks on a thumbnail representation of the
resource).  The requester is expected to discover, or be provisioned
or configured with, knowledge of the protected resource and its
location out of band.  Further, the requester is expected to acquire
its own knowledge about the application-specific methods made
available by the host for operating on this protected resource (such
as viewing it with a GET method, or transforming it with some complex
API call) and the possible scopes of access.</p>
<p>The host responds in one of the following ways.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
<div class="section" id="requester-presents-no-requester-permission-tokne">
<span id="uma-core-3-1-1"></span><h4><a class="toc-backref" href="#id26">3.1.1.  Requester Presents No Requester Permission Tokne</a><a class="headerlink" href="#requester-presents-no-requester-permission-tokne" title="Permalink to this headline">¶</a></h4>
<p>If the requester does not present any access token with the request,
the host MUST return an HTTP 401 (Unauthorized) status code, along
with providing the AM&#8217;s URI in an &#8220;am_uri&#8221; property to facilitate AM
metadata discovery, including discovery of the endpoint where the
requester can request an RPT (Section 3.4.4), by the requester.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
   WWW-Authenticate: UMA realm="example",
   host_id="photoz.example.com",
   am_uri="http://am.example.com"
   ...</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="requester-presents-a-requester-permission-token-that-has-insufficient-permission">
<span id="uma-core-3-1-2"></span><h4><a class="toc-backref" href="#id27">3.1.2.  Requester Presents a Requester Permission Token That Has Insufficient Permission</a><a class="headerlink" href="#requester-presents-a-requester-permission-token-that-has-insufficient-permission" title="Permalink to this headline">¶</a></h4>
<p>If the requester presents an RPT with its request, the host SHOULD
determine the RPT&#8217;s status (see Section 3.3).  If the RPT is invalid,
the host redirects the requester to the RPT endpoint at the AM in
order to obtain a correct RPT (see Section 3.4.4).</p>
<p>If the RPT is valid but has insufficient permission for the type of
access sought, the Host SHOULD register a permission with the AM that
would suffice for that scope of access (see Section 3.2), and then
respond to the requester with the HTTP 403 (Forbidden) status code,
along with providing the AM&#8217;s URI in the header of the message and
the permission ticket it just received from the AM in the body in
JSON form.</p>
<p>Example of the host&#8217;s response:</p>
<div class="highlight-python"><pre>HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  am_uri="http://am.example.com"

{
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="requester-presents-a-valid-requester-permission-token-with-sufficient-permissions">
<span id="uma-core-3-1-3"></span><h4><a class="toc-backref" href="#id28">3.1.3.  Requester Presents a Valid Requester Permission Token with Sufficient Permissions</a><a class="headerlink" href="#requester-presents-a-valid-requester-permission-token-with-sufficient-permissions" title="Permalink to this headline">¶</a></h4>
<p>If the RPT&#8217;s status is associated with at least one currently valid
permission that applies to the scope of access attempted by the
requester (see Section 3.3), the host MUST give access to the desired
resource.</p>
<p>Example of the host&#8217;s response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb</pre>
</div>
<p>This response constitutes the conclusion of Phase 3 of UMA.</p>
<p>The host MUST NOT give access where the token&#8217;s status is not
associated with at least one currently active permission that
suffices for that scope of access.</p>
<p>(draft 05 )</p>
<div class="section" id="requester-s-token-has-insufficient-permission">
<span id="uma-core-3-1-3-1"></span><h5><a class="toc-backref" href="#id29">3.1.3.1.  Requester&#8217;s Token Has Insufficient Permission</a><a class="headerlink" href="#requester-s-token-has-insufficient-permission" title="Permalink to this headline">¶</a></h5>
<p>If the <a class="reference internal" href="glossary.html#term-token-status"><em class="xref std std-term">token status</em></a> is not associated with any currently valid <a class="reference internal" href="#term-permission"><em class="xref std std-term">permission</em></a>
that applies to the <a class="reference internal" href="#term-scope"><em class="xref std std-term">scope</em></a> of access attempted by the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a>,
the <a class="reference internal" href="#term-host"><em class="xref std std-term">Host</em></a> SHOULD register a <a class="reference internal" href="#term-permission"><em class="xref std std-term">permission</em></a> with the <a class="reference internal" href="#term-am"><em class="xref std std-term">AM</em></a>
(see <a class="reference internal" href="#uma-core-3-4"><em>Section 3.4</em></a>) that would suffice for that scope of access,
and then respond to the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> with the HTTP 403 (Forbidden) status code,
along with providing the AM&#8217;s URI in the header of the message and
the <em class="xref std std-term">permission ticket</em> it just received from the <strong>AM</strong> in the body of the JSON form.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  am_uri="http://am.example.com"

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">Host register a permmision. (<a class="reference internal" href="#uma-core-3-4"><em>3.4.  Requester-AM: Ask for Requester Permission Token and Permission</em></a> )</p>
</li>
<li><p class="first">Host get a ticket from AM for a permission registration. ( ticket is a JSON in response body from AM )</p>
</li>
<li><p class="first">Host return the ticket to the request in HTTP 403 for the resource request. ( described in this section)</p>
</li>
<li><p class="first">Requester ask AM to get access token with the ticket and other information(<a class="reference internal" href="#uma-core-3-5"><em>3.5.  Claims-Gathering Flows</em></a> )</p>
<blockquote>
<div><ul class="simple">
<li>AM check the policy for the requester and its request with claims (<em class="xref std std-ref">uma_core.3.6</em> )</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>&#8220;A Requester has a valid access token&#8221; means that &#8220;Authrizing User allowed the reuqester to access a resource in the Host&#8221;</li>
<li>So &#8220;Host&#8221; may register permission to the scope on &#8220;AM&#8221; for the &#8220;Requester&#8221;.  This is proved by the &#8220;Ticket&#8221;</li>
<li>If the &#8220;Requester&#8221; provides a valid &#8220;Ticket&#8221; for the &#8220;Token&#8221;.  the &#8220;AM&#8221; issues a new token (Updated Token)</li>
</ul>
</div>
<p>(draft 03)</p>
</div>
<div class="section" id="requester-s-token-has-sufficient-permission">
<span id="uma-core-3-1-3-2"></span><h5><a class="toc-backref" href="#id30">3.1.3.2.  Requester&#8217;s Token Has Sufficient Permission</a><a class="headerlink" href="#requester-s-token-has-sufficient-permission" title="Permalink to this headline">¶</a></h5>
<p>If the token status is associated with at least one currently valid
permission that applies to the scope of access attempted by the
requester, the host MUST give access to the desired resource.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb</pre>
</div>
<p>This response constitutes the conclusion of Phase 3 of UMA.</p>
<p>The host MUST NOT give access where the token&#8217;s status is not
associated with at least one currently active permission hat suffices
for that scope of access.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
</div>
</div>
<div class="section" id="host-am-register-a-permission">
<span id="uma-core-3-2"></span><h3><a class="toc-backref" href="#id31">3.2.  Host-AM: Register a Permission</a><a class="headerlink" href="#host-am-register-a-permission" title="Permalink to this headline">¶</a></h3>
<p>In response to receiving an access request accompanied by an RPT that
is invalid or has insufficient permissions, the host SHOULD register
a permission with the AM that would be sufficient for the type of
access sought.  The AM returns a permission ticket for the host to
give to the requester in its response.</p>
<p>The permission ticket is a short-lived opaque structure whose form is
determined by the AM.  The ticket value MUST be securely random (for
example, not merely part of a predictable sequential series), to
avoid denial-of-service attacks.  Since the ticket is an opaque
structure from the point of view of the requester, the AM is free to
include information regarding expiration time within the opaque
ticket for its own consumption.  When the requester subsequently asks
the AM to add permissions to its RPT, it will submit this ticket to
the AM.</p>
<p>The host registers the permission using the POST method at the AM&#8217;s
permission registration endpoint.  In doing so the host MUST provide
its PAT to the AM in order to get access to this endpoint.  The body
of the HTTP request message contains a JSON document providing the
requested permission.</p>
<p>The requested scope is an object with the name &#8220;requested_permission&#8221;
and the following properties:</p>
<dl class="glossary docutils">
<dt id="term-resource-set-id">resource_set_id</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">The identifier for a resource set, access
to which this requester is seeking access.  The identifier MUST
correspond to a resource set that was previously registered.</p>
</dd>
<dt id="term-58">scopes</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">An array referencing one or more identifiers of
scopes to which access is needed for this resource set.  Each
scope identifier MUST correspond to a scope that was registered by
this host for the referenced resource set.</p>
</dd>
</dl>
<p>Example of an HTTP request that registers a permission at the AM&#8217;s
permission registration endpoint:</p>
<div class="highlight-python"><pre>POST /host/scope_reg_uri/photoz.example.com HTTP/1.1
Content-Type: application/uma-requested-permission+json
Host: am.example.com

{
  "resource_set_id": "112210f47de98100",
  "scopes": [
      "http://photoz.example.com/dev/actions/view",
      "http://photoz.example.com/dev/actions/all"
  ]
}</pre>
</div>
<p>If the registration request is successful, the AM responds with an
HTTP 201 (Created) status code and includes the Location header in
its response as well as the &#8220;ticket&#8221; property in the JSON-formatted
body.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-permission-ticket+json
Location: https://am.example.com/permreg/host/photoz.example.com/5454345rdsaa4543
...

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>If the registration request is authenticated properly but fails due
to other reasons, the AM responds with an HTTP 400 (Bad Request)
status code and includes one of the following UMA error codes (see
Section 4.2):</p>
<dl class="glossary docutils">
<dt id="term-invalid-resource-set-id">invalid_resource_set_id</dt>
<dd>The provided resource set identifier was not found at the AM.</dd>
<dt id="term-invalid-scope">invalid_scope</dt>
<dd>At least one of the scopes included in the request was
not registered previously by this host.</dd>
</dl>
<p>(draft 05)</p>
</div>
<div class="section" id="host-determines-the-requester-permission-token-status">
<span id="uma-core-3-3"></span><h3><a class="toc-backref" href="#id32">3.3.  Host Determines the Requester Permission Token Status</a><a class="headerlink" href="#host-determines-the-requester-permission-token-status" title="Permalink to this headline">¶</a></h3>
<p>On receiving an RPT, the host MUST ascertain its status before
granting or denying access to the requester.  An RPT that a requester
provides to a host in order to get access is associated with a set of
permissions that govern whether the requester is authorized for
access.  The token&#8217;s nature and format are dictated by its defined
profile; the profile might allow it to be self-contained, such that
the host is able to ascertain its status locally, or might require or
allow the host to make a run-time status request of the AM that
issued the token.</p>
<p>This specification makes one type of RPT mandatory to implement: the
UMA bearer token profile, as defined in Section 3.3.1.  Alternate RPT
profiles MAY define their own unique token formats and MAY require,
allow, or prohibit use of the RPT status endpoint.</p>
<p>(draft 05)</p>
<div class="section" id="uma-bearer-token-profile">
<span id="uma-core-3-3-1"></span><h4><a class="toc-backref" href="#id33">3.3.1.  UMA Bearer Token Profile</a><a class="headerlink" href="#uma-bearer-token-profile" title="Permalink to this headline">¶</a></h4>
<p>This section defines the format and protocol requirements for the UMA
bearer token profile.  An AM MUST support the UMA bearer token
profile and must indicate its support in the
&#8220;uma_token_profiles_supported&#8221; property in the configuration data
(see Section 1.5).</p>
<p>On receiving an RPT of the &#8220;Bearer&#8221; type in an authorization header
from a requester making an access attempt, the host MUST ask the AM
for the RPT&#8217;s status unless it has an unexpired cached status
description for this RPT, which it MAY use instead.  In order to ask
the AM for an RPT&#8217;s status, the host makes the request to the AM with
a POST request to the AM&#8217;s RPT status endpoint.  The body of the HTTP
request message contains a JSON document providing the RPT.  The host
MUST provide its own PAT in the request in order to gain access to
the RPT status endpoint.</p>
<p>Note that although the host&#8217;s request is a safe operation, which
normally would use the GET operation, this specification dictates the
use of POST because it is advantageous for security of bearer tokens.
Since the host provides its own PAT in the authorization header of
the request, the RPT appears in the request body.  A GET operation
would expose the message to being recorded in AM access logs.</p>
<p>Example of a request to the RPT status endpoint that provides the PAT
in the header:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer vF9dft4qmT
Content-Type: application/json
...

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
  "resource_set_id": "112210f47de98100",
  "host_id": "photoz.example.com"
}</pre>
</div>
<p>The AM returns the RPT&#8217;s status in an HTTP response using the 200 OK
status code, containing a JSON document supplying the RPT status
description.  The RPT status description either contains all of the
permissions that are currently valid for this RPT or indicates that
the RPT is invalid (see Section 1.4).  The AM MAY set a cache period
for the returned RPT status description that allows the host to reuse
it over some period of time when it later sees the same RPT.</p>
<p>The status description for a valid RPT is a JSON array of zero or
more permission objects, each with the following properties:</p>
<dl class="glossary docutils">
<dt id="term-61">resource_set_id</dt>
<dd>REQUIRED.  A string that uniquely identifies the
resource set, access to which has been granted to this requester
on behalf of this requesting party.  The identifier MUST
correspond to a resource set that was previously registered as
protected.</dd>
<dt id="term-62">scopes</dt>
<dd>REQUIRED.  An array referencing one or more URIs of scopes to
which access was granted for this resource set.  Each scope MUST
correspond to a scope that was registered by this host for the
referenced resource set.</dd>
<dt id="term-exp">exp</dt>
<dd>REQUIRED.  An integer representing the expiration time on or
after which the permission MUST NOT be accepted for authorized
access.  The processing of the exp property requires that the
current date/time MUST be before the expiration date/time listed
in the exp claim.  Host implementers MAY provide for some small
leeway, usually no more than a few minutes, to account for clock
skew.</dd>
</dl>
<p>Example:</p>
<div class="highlight-python"><pre>  HTTP/1.1 200 OK
  Content-Type: application/uma-rpt-status+json
  Cache-Control: no-store
  ...

  [
    {
      "resource_set_id": "112210f47de98100",
      "scopes": [
        "http://photoz.example.com/dev/actions/view",
        "http://photoz.example.com/dev/actions/all"
      ],
      "exp": 1300819380
    }
  ]

The token status description for an invalid RPT is a JSON structure,
as follows.</pre>
</div>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/uma-rpt-status+json
...

{
  "rpt_status": "invalid"
}</pre>
</div>
<p>(draft 05)</p>
</div>
</div>
<div class="section" id="requester-am-ask-for-requester-permission-token-and-permission">
<span id="uma-core-3-4"></span><h3><a class="toc-backref" href="#id34">3.4.  Requester-AM: Ask for Requester Permission Token and Permission</a><a class="headerlink" href="#requester-am-ask-for-requester-permission-token-and-permission" title="Permalink to this headline">¶</a></h3>
<p>A <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> making an access attempt accompanied by no <a class="reference internal" href="#term-rpt"><em class="xref std std-term">RPT</em></a>
or by an <em class="xref std std-term">invalid RPT</em> will receive a <strong>401 response</strong> back from the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>,
along with the AM&#8217;s location from which it can learn the <a class="reference internal" href="#term-rpt-endpoint"><em class="xref std std-term">RPT endpoint</em></a>.</p>
<p>In this case,
the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> must obtain a valid RPT from the AM&#8217;s <a class="reference internal" href="#term-rpt-endpoint"><em class="xref std std-term">RPT endpoint</em></a> provided
in the response (see <a class="reference internal" href="#uma-core-3-4-4"><em>Section 3.4.4</em></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">AAT is required to get RPT.</p>
</div>
<p>A <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> making an access attempt with a valid RPT
that has insufficient permissions associated with it
will receive a 403 response back from the <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a>,
along with a <em class="xref std std-term">permission ticket</em>
and the AM&#8217;s location from which it can learn the <a class="reference internal" href="#term-permission-request-endpoint"><em class="xref std std-term">permission request endpoint</em></a>.</p>
<p>In this case,
the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> uses the <em class="xref std std-term">permission ticket</em>
to ask for the necessary permission to be associated with its RPT.
This process necessarily involves the <a class="reference internal" href="#term-64"><em class="xref std std-term">requesting party</em></a>
(the natural or legal person operating the requester application).</p>
<dl class="glossary docutils">
<dt id="term-64">Requesting Party</dt>
<dd>the natural or legal person operating the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> application</dd>
</dl>
<p>The <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> takes action in the following ways.</p>
<p>(draft 05)</p>
<div class="section" id="requester-looks-up-am-configuration-data">
<span id="uma-core-3-4-1"></span><h4><a class="toc-backref" href="#id35">3.4.1.  Requester Looks Up AM Configuration Data</a><a class="headerlink" href="#requester-looks-up-am-configuration-data" title="Permalink to this headline">¶</a></h4>
<p>The requester needs to learn the AM&#8217;s various authorization API
endpoints.  From the &#8220;am_uri&#8221; information provided in the host&#8217;s
response, the requester MUST retrieve the AM&#8217;s configuration data
document, as described in Section 2 of hostmeta [RFC6415].  For
example, if the &#8220;am_uri&#8221; is &#8220;example.com&#8221;, the requester creates the
URL &#8220;<a class="reference external" href="https://example.com/.well-known/uma-configuration">https://example.com/.well-known/uma-configuration</a>&#8221; and performs
a GET request on it.  The AM MUST return content that includes UMA
authorization API endpoints as defined in Section 1.5.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="requester-registers-with-am">
<span id="uma-core-3-4-2"></span><h4><a class="toc-backref" href="#id36">3.4.2.  Requester Registers with AM</a><a class="headerlink" href="#requester-registers-with-am" title="Permalink to this headline">¶</a></h4>
<p>If the requester has not already obtained an OAuth client identifier
and optional secret from this AM, in this step it MUST do so in order
to engage in OAuth-based interactions with the AM.  It MAY do this
using [DynClientReg], if the AM supports it (see Section 1.5 for how
the AM MAY indicate support).</p>
<p>(draft 05)</p>
</div>
<div class="section" id="requester-obtains-authorization-api-token">
<span id="uma-core-3-4-3"></span><h4><a class="toc-backref" href="#id37">3.4.3.  Requester Obtains Authorization API Token</a><a class="headerlink" href="#requester-obtains-authorization-api-token" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Requseter as an OAuth Client MUST get AAT ,</li>
<li>from the <a class="reference internal" href="#term-permission-request-endpoint"><em class="xref std std-term">permission request endpoint</em></a>,</li>
<li>at the AM as OAuth (Resource) Server.</li>
</ul>
</div>
<p>In this step,
the requester acquires an AAT from the AM.
The token represents the approval of this requesting party for this requester
to engage with this AM to supply claims, ask for permissions, and
perform any other tasks needed for obtaining authorization for access
to resources at all hosts that use this AM.</p>
<p>The requester MUST use OAuth 2.0 [OAuth2] to obtain the AAT.
Here the requester acts in the role of an OAuth client requesting the
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authz.json">http://docs.kantarainitiative.org/uma/scopes/authz.json</a>&#8221; scope; the
requesting party acts in the role of an OAuth resource owner; and the
AM acts in the role of an OAuth authorization server.  Once the
requester has obtained its AAT, it presents it to the AM at the
<a class="reference internal" href="#term-permission-request-endpoint"><em class="xref std std-term">permission request API endpoint</em></a>;
in presenting this endpoint the AM acts in the role of a <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>.</p>
<p>By virtue of being able to identify this <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a>/<a class="reference internal" href="#term-64"><em class="xref std std-term">requesting party</em></a>
pair uniquely across all hosts, the AM is able to manage the process
of authorization and claims-gathering efficiently.  These management
processes are outside the scope of this specificaiton.</p>
<p>The AM MAY support the use of any grant type, but MUST support the
authorization_code grant type, and SHOULD support the SAML bearer
token grant type [OAuth-SAML]
(<a class="reference external" href="urn:ietf:params:oauth:grant-type:saml2-bearer">urn:ietf:params:oauth:grant-type:saml2-bearer</a>) if it anticipates
working with requesters that are operating in environments where the
use of SAML is prevalent.  The AM MUST indicate all grant types it
supports in its configuration data, as defined in Section 1.5.</p>
<p>The requester has completed this step successfully when it possesses
a AAT it can use to get access to the AM&#8217;s authorization API on the
requesting party&#8217;s behalf.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="requester-obtains-requester-permission-token">
<span id="uma-core-3-4-4"></span><h4><a class="toc-backref" href="#id38">3.4.4.  Requester Obtains Requester Permission Token</a><a class="headerlink" href="#requester-obtains-requester-permission-token" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>RPT</li>
</ul>
</div>
<p>In this step,
if the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> needs an RPT that applies to this <a class="reference internal" href="#term-64"><em class="xref std std-term">requesting party</em></a>
for this <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> and this AM,
the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> obtains an RPT from the AM.</p>
<p>On first issuance the RPT is associated with no permissions and
thus does not convey any authorizations for access.</p>
<p>Once the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> obtains an RPT from the AM,
it can ask the AM for authorization to have permissions associated with the RPT
(see <a class="reference internal" href="#uma-core-3-4-5"><em>Section 3.4.5</em></a>).</p>
<p>The <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> performs a POST on the <a class="reference internal" href="#term-rpt-endpoint"><em class="xref std std-term">RPT endpoint</em></a>.
In doing so
the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> MUST provide its own <a class="reference internal" href="#term-aat"><em class="xref std std-term">AAT</em></a> in the header in order to gain
access to the <a class="reference internal" href="#term-rpt-endpoint"><em class="xref std std-term">RPT endpoint</em></a>.</p>
<p>Example of a request message containing an AAT:</p>
<div class="highlight-python"><pre>POST /rpt HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
Content-Type: application/json
...</pre>
</div>
<p>The AM responds with an HTTP 201 (Created) status code and provides a new RPT.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-rpt+json

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv"
}</pre>
</div>
<p>If the content-type of the request is not recognized by the AM, the
AM MUST produce an HTTP error.</p>
<p>The requester might need an RPT if it has never before requested an
RPT for this combination of requesting party, host, and AM, or if it
has lost control of a previous issued RPT and needs a refreshed one.
If the AAT provided in the header is the same as one provided for a
previously issued RPT by this AM, the AM invalidates the old RPT and
its permissions and issues a new RPT.</p>
<p>If the request fails due to missing or invalid parameters, or is
otherwise malformed, the AM SHOULD inform the requester of the error
by sending an HTTP error response.</p>
<p>If the request fails due to an invalid, missing, or expired AAT or
requires higher privileges at this endpoint than provided by the AAT,
the AM responds with an OAuth error (see Section 4.1).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="requester-asks-for-authorization-to-add-permission">
<span id="uma-core-3-4-5"></span><h4><a class="toc-backref" href="#id39">3.4.5.  Requester Asks for Authorization to Add Permission</a><a class="headerlink" href="#requester-asks-for-authorization-to-add-permission" title="Permalink to this headline">¶</a></h4>
<p>Once in possession of an AAT for this AM,
an RPT that applies to this <a class="reference internal" href="#term-64"><em class="xref std std-term">requesting party</em></a> for this <a class="reference internal" href="#term-host"><em class="xref std std-term">host</em></a> and this AM,
and a <em class="xref std std-term">permission ticket</em>,
the <a class="reference internal" href="#term-requester"><em class="xref std std-term">requester</em></a> asks the AM to give it a permission for the sought-for access.
The requester performs a POST on the <a class="reference internal" href="#term-permission-request-endpoint"><em class="xref std std-term">permission request endpoint</em></a> at the AM,
supplying the items below.
In doing so
the requester MUST provide its own AAT
in order to gain access to the <a class="reference internal" href="#term-permission-request-endpoint"><em class="xref std std-term">permission request endpoint</em></a>.</p>
<ul class="simple">
<li>The permission ticket it received from the host</li>
<li>Its RPT for this host</li>
<li>Its own AAT in the header</li>
</ul>
<p>Example of a request message containing a permission ticket and RPT:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
Content-Type: application/json
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>In this interaction, the requester uses the AM&#8217;s permission request
endpoint.  The AM uses the ticket to look up the previously
registered permission, maps the requested permission to operative
user policies, undergoes any authorization flows required (see
Section 3.5), and ultimately responds to the request positively or
negatively.</p>
<p>If the request fails due to an invalid, missing, or expired AAT (or
RPT) or requires higher privileges at this endpoint than provided by
the AAT, the AM responds with an OAuth error (see Section 4.1).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"</pre>
</div>
<p>If the AM does not add the requested permission, it responds using
the appropriate HTTP status code (typically 400 or 403), and includes
one of the following error codes in the response (see Section 4.2):</p>
<dl class="glossary docutils">
<dt id="term-invalid-requester-ticket">invalid_requester_ticket</dt>
<dd>The provided ticket was not found at the AM.
The AM SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-expired-requester-ticket">expired_requester_ticket</dt>
<dd>The provided ticket has expired.
The AM SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-not-authorized-permission">not_authorized_permission</dt>
<dd>The requester is definitively not
authorized for this permission according to user policy.
The AM SHOULD respond with the HTTP 403 (Forbidden) status code.</dd>
<dt id="term-need-claims">need_claims</dt>
<dd>The AM is unable to determine whether the requester is
authorized for this permission without gathering claims from the
requesting party.  The AM SHOULD respond with the HTTP 403
(Forbidden) status code.  The requester is therefore not
authorized, but has the opportunity to engage the requesting party
in a claims-gathering flow with the AM (see Section 3.5) to
potentially become authorized.</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_requester_ticket"
}</pre>
</div>
<p>(draft 05)</p>
</div>
</div>
<div class="section" id="claims-gathering-flows">
<span id="uma-core-3-5"></span><h3><a class="toc-backref" href="#id40">3.5.  Claims-Gathering Flows</a><a class="headerlink" href="#claims-gathering-flows" title="Permalink to this headline">¶</a></h3>
<p>The AM MUST base its decisions to add permissions to RPTs on user
policies.  The nature of these policies is outside the scope of UMA,
but generally speaking, they can be thought of as either independent
of requesting-party features (for example, time of day) or dependent
on requesting-party features (for example, whether they are over 18).
This latter case requires the requesting party to transmit identity
claims to the AM in some fashion.</p>
<p>The process for requesting and providing claims is extensible and may
have a variety of dependencies on the type of requesting party (for
example, natural person or legal person) and the type of requester
application (for example, browser, native app, or autonomously
running web service).  UMA currently provides a framework for
handling human-driven requester apps and an optional solution for
gathering standardized claims from that end-user, and allows for
extensions to support other solutions for this use case and other use
cases.  The AM SHOULD document its claims-handling ability in its
configuration data through the claim_profiles_supported property (see
Section 1.5).  For the business-level and legal implications of
different technical authorization flows, see [UMA-trustmodel].</p>
<p>(draft 05)</p>
<div class="section" id="claims-gathering-flow-for-requester-apps-operated-by-end-users">
<span id="uma-core-3-5-1"></span><h4><a class="toc-backref" href="#id41">3.5.1.  Claims-Gathering Flow for Requester Apps Operated by End-Users</a><a class="headerlink" href="#claims-gathering-flow-for-requester-apps-operated-by-end-users" title="Permalink to this headline">¶</a></h4>
<p>A requester app,
whether browser-based or native, is operated by a natural person
(human end-user) in one of two typical situations:</p>
<ul class="simple">
<li>The requesting party is a natural person (for example, a friend of
the authorizing user); the requesting party may even be the
authorizing user herself.</li>
<li>The requesting party is a legal person such as a corporation, and
the human being operating the requester app is acting as an agent
of that legal person (for example, a customer support specialist
representing a credit card company).</li>
</ul>
<p>For convenience, this specification refers to the human end-user as a
&#8220;requesting end-user&#8221; to cover both cases, which differ only at the
level of business agreements (and potentially law), rather than
technology.  The AM has a variety of options at this point for
satisfying the authorizing user&#8217;s policy; this specification does not
dictate a single answer.  For example, the AM could require the
requesting end-user to register for and/or log in to a local AM
account, or to fill in a questionnaire, or to complete a purchase.
It could even require several of these operations, where the order is
significant.</p>
<p>An end-user-driven requester app MUST redirect the end-user to the AM
to complete the process of authorization.  The redirection MUST
include a URI query parameter with the name &#8220;ticket&#8221; whose value
conveys the permission ticket for which the need_claims error was
received; for example, &#8220;ticket=016f84e8-f9b9-11e0-bd6f-0021cc6004de&#8221;.
Each claim profile MUST provide the following capabilities:</p>
<dl class="glossary docutils">
<dt id="term-redirect-uri">redirect URI</dt>
<dd>A means by which the requester MUST supply the URI to
which the AM MUST redirect the requesting end-user at the end of
the claims-gathering process.</dd>
<dt id="term-callback-uri">callback URI</dt>
<dd>A means by which the requester OPTIONALLY supplies a
callback URI for the AM to use.</dd>
<dt id="term-state">state</dt>
<dd>A means by which the requester SHOULD supply an opaque value
used to maintain state between the request and the callback;
serves as a protection against XSRF attacks.</dd>
</dl>
<p>An AM MAY support any number of claim profiles.  One potential such
profile is defined in this specification: the &#8220;openid&#8221; claim profile,
which leverages OpenID Connect for gathering generally useful user
claims (see Section 3.5.1.1).</p>
<p>(draft 05)</p>
<div class="section" id="openid-connect-claim-profile">
<span id="uma-core-3-5-1-1"></span><h5><a class="toc-backref" href="#id42">3.5.1.1.  OpenID Connect Claim Profile</a><a class="headerlink" href="#openid-connect-claim-profile" title="Permalink to this headline">¶</a></h5>
<p>If an AM supports the OpenID Connect claim profile, it MUST supply
the &#8220;openid&#8221; value for one of its claim_profiles_supported values in
its AM configuration data (see Section 1.5 for how to formulate this
data).</p>
<p>To conform to this option, the AM MUST do the following:</p>
<ul class="simple">
<li>Serve as a conforming OpenID Relying Party and Claims Client
according to [OCStandard]</li>
<li>Be able to utilize at least all of the reserved claims defined in
[OCMessages] in assessing policy and granting permissions</li>
<li>Use the OpenID Connect &#8220;redirect_uri&#8221; and &#8220;state&#8221; request
parameters as appropriate</li>
</ul>
<p>The AM can then use any conforming OpenID Connect mechanisms and
typical user interfaces for engaging with the UserInfo endpoints of
OpenID Providers and Claims Providers, potentially allowing for the
delivery of &#8220;trusted claims&#8221; (such as a verified email address or a
date or birth) on which authorization policy may depend.</p>
<p>(draft 05)</p>
</div>
</div>
</div>
</div>
<div class="section" id="error-messages">
<span id="uma-core-4"></span><h2><a class="toc-backref" href="#id43">4.  Error Messages</a><a class="headerlink" href="#error-messages" title="Permalink to this headline">¶</a></h2>
<p>Ultimately the host is responsible for either granting the access the
requester attempted, or returning an error response to the requester
with a reason for the failure.  [OAuth2] defines several error
responses for a resource server to return.  UMA makes use of these
error responses, but requires the host to &#8220;outsource&#8221; the
determination of some error conditions to the AM.  UMA defines its
own additional error responses that the AM may give to the host and
requester as they interact with it, and that the host may give to the
requester.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
<div class="section" id="oauth-error-responses">
<span id="uma-core-4-1"></span><h3><a class="toc-backref" href="#id44">4.1.  OAuth Error Responses</a><a class="headerlink" href="#oauth-error-responses" title="Permalink to this headline">¶</a></h3>
<p>When a client (host or requester) attempts to access one of the AM
endpoints Section 1.5 or a client (requester) attempts to access a
protected resource at the host, it has to make an authenticated
request by including an OAuth access token in the HTTP request as
described in [OAuth2] Section 7.</p>
<p>If the client&#8217;s request failed authentication, the AM or the host
responds with an OAuth error message as described throughout
Section 2 and Section 3.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
<div class="section" id="uma-error-responses">
<span id="uma-core-4-2"></span><h3><a class="toc-backref" href="#id45">4.2.  UMA Error Responses</a><a class="headerlink" href="#uma-error-responses" title="Permalink to this headline">¶</a></h3>
<p>When a client (host or requester) attempts to access one of the AM
endpoints Section 1.5 or a client (requester) attempts to access a
protected resource at the host, if the client request is successfully
authenticated by OAuth means, but is invalid for another reason, the
AM or host responds with an UMA error response by adding the
following properties to the entity body of the HTTP response using
the &#8220;application/json&#8221; media type:</p>
<dl class="glossary docutils">
<dt id="term-error">error</dt>
<dd>REQUIRED.  A single error code.  Value for this property is
defined in the specific AM endpoint description.</dd>
<dt id="term-error-description">error_description</dt>
<dd>OPTIONAL.  A human-readable text providing
additional information, used to assist in the understanding and
resolution of the error occurred.</dd>
<dt id="term-error-uri">error_uri</dt>
<dd>OPTIONAL.  A URI identifying a human-readable web page
with information about the error, used to provide the end-user
with additional information about the error.</dd>
</dl>
<p>Common error codes:</p>
<dl class="glossary docutils">
<dt id="term-invalid-request">invalid_request</dt>
<dd>The request is missing a required parameter or is
otherwise malformed.  The AM MUST respond with the HTTP 400 (Bad
Request) status code.</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "invalid_request",
  "error_description": "There is already a resource with this identifier.",
  "error_uri": "http://am.example.com/errors/resource_exists"
}</pre>
</div>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
</div>
<div class="section" id="specification-of-additional-profiles">
<span id="uma-core-5"></span><h2><a class="toc-backref" href="#id46">5.  Specification of Additional Profiles</a><a class="headerlink" href="#specification-of-additional-profiles" title="Permalink to this headline">¶</a></h2>
<p>This specification defines a selected set of profiles, but others
will possibly be developed in the future.  It is not possible for
this specification to standardize all of these additional profiles.
The following sections define rules for third parties that specify
UMA profiles.</p>
<p>(Get text from <a class="reference external" href="http://docs.oasis-open.org/security/saml/v2.0/">http://docs.oasis-open.org/security/saml/v2.0/</a>
saml-profiles-2.0-os.pdf .)</p>
<p>(Put references to this section in the appropriate places above, and
add a discussion of profiles somewhere in the intro.)</p>
<p>(draft 05)</p>
<div class="section" id="specifying-uma-profiles">
<span id="uma-core-5-1"></span><h3><a class="toc-backref" href="#id47">5.1.  Specifying UMA Profiles</a><a class="headerlink" href="#specifying-uma-profiles" title="Permalink to this headline">¶</a></h3>
<p>This section provides a checklist of issues that MUST be addressed by each profile.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Specify a URI that uniquely identifies the profile, postal or
electronic contact information for the author, and provide
reference to previously defined profiles that the new profile
updates or obsoletes.</li>
<li>Specify the set of interactions between parties involved in the
profile.  Any restrictions on applications used by each party and
the protocols involved in each interaction must be explicitly
called out.</li>
<li>Identify the parties involved in each interaction, including how
many parties are involved and whether intermediaries may be
involved.</li>
<li>Specify the method of authentication of parties involved in each
interaction, including whether authentication is required and
acceptable authentication types.</li>
<li>Identify the level of support for message integrity, including
the mechanisms used to ensure message integrity.</li>
<li>Identify the level of support for confidentiality, including
whether a third party may view the contents of UMA messages,
whether the profile requires confidentiality, and the mechanisms
recommended for achieving confidentiality.</li>
<li>Identify the error states, including the error states at each
participant, especially those that receive and process UMA
messages.</li>
<li>Identify security considerations, including analysis of threats
and description of countermeasures.</li>
<li>Identify relevant UMA metadata defined and/or utilized by the
profile.</li>
</ol>
</div></blockquote>
<p>(draft 05)</p>
</div>
<div class="section" id="specifying-uma-token-profiles">
<span id="uma-core-5-2"></span><h3><a class="toc-backref" href="#id48">5.2.  Specifying UMA Token Profiles</a><a class="headerlink" href="#specifying-uma-token-profiles" title="Permalink to this headline">¶</a></h3>
<p>This section provides a checklist of items that MUST in particular be
addressed by attribute profiles.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Specify a URI that uniquely identifies the profile, postal or
electronic contact information for the author, and provide
reference to previously defined profiles that the new profile
updates or obsoletes.</li>
<li>Identify the syntax and restrictions on the acceptable values for
the token profile.</li>
<li>Identify namespace restrictions that are meaningful in the
profile deployment scenario.</li>
<li>Identify rules in the processing of the fields within the token
profile.</li>
<li>Identify the scopes that are defined in the token profile (e.g.
grant types in JWT Bearer Token Profile).</li>
<li>Identify the error states, including the error states at each
participant, especially those that receive and process claims or
assertions expressed within the tokens.</li>
</ol>
</div></blockquote>
<p>(draft 05)</p>
</div>
</div>
<div class="section" id="security-considerations">
<span id="uma-core-6"></span><h2><a class="toc-backref" href="#id49">6.  Security Considerations</a><a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>This specification relies mainly on OAuth security mechanisms for
protecting the host registration endpoint at the AM so that only a
properly authorized host can access it on behalf of the intended
user.  For example, the host needs to use a valid protection API
token (PAT) issued through a user authorization process at the
endpoint, and the interaction SHOULD take place over TLS.  It is
expected that the host will protect its client secret (if it was
issued one) and its PAT, particularly if used in &#8220;bearer token&#8221;
fashion.</p>
<p>In addition, this specification dictates a binding between the PAT
and the host-specific registration area on the AM to prevent a host
from interacting with a registration area not its own.</p>
<p>This specification defines a number of JSON-based data formats.  As a
subset of the JavaScript scripting language, JSON data SHOULD be
consumed through a process that does not dynamically execute it as
code, to avoid malicious code execution.  One way to achieve this is
to use a JavaScript interpreter rather than the built-in JavaScript
eval() function.</p>
<p>For information about the technical, operational, and legal elements
of trust establishment between UMA entities and parties, which
affects security considerations, see [UMA-trustmodel].</p>
<p>(draft 05)</p>
</div>
<div class="section" id="privacy-considerations">
<span id="uma-core-7"></span><h2><a class="toc-backref" href="#id50">7.  Privacy Considerations</a><a class="headerlink" href="#privacy-considerations" title="Permalink to this headline">¶</a></h2>
<p>The AM comes to be in possession of resource set information (such as
names and icons) that may reveal information about the user, which
the AM&#8217;s trust relationship with the host is assumed to accommodate.
However, the requester is a less-trusted party (in fact, entirely
untrustworthy until it acquires permissions for an RPT in UMA
protocol phase 2.  This specification recommends obscuring resource
set identifiers in order to avoid leaking personally identifiable
information to requesters through the &#8220;scope&#8221; mechanism.</p>
<p>For information about the technical, operational, and legal elements
of trust establishment between UMA entities and parties, which
affects privacy considerations, see [UMA-trustmodel].</p>
<p>(draft 05)</p>
</div>
<div class="section" id="conformance">
<span id="uma-core-8"></span><h2><a class="toc-backref" href="#id51">8.  Conformance</a><a class="headerlink" href="#conformance" title="Permalink to this headline">¶</a></h2>
<p>This section outlines conformance requirements for various entities
implementing UMA endpoints.</p>
<p>This specification has dependencies on other specifications, as
follows:</p>
<blockquote>
<div><ul class="simple">
<li>OAuth 2.0: AMs, hosts, and requesters MUST support [OAuth2]
features named in this specification for conformance.  For
example, AMs MUST support the authorization_code and
client_credentials grant types.</li>
<li>hostmeta: AMs, hosts, and requesters MUST support the [RFC6415]
features named in this specification.</li>
<li>OpenID Connect: AMs MAY support [DynClientReg], and MAY choose to
conform to the &#8220;openid&#8221; claim format option, corresponding to the
OpenID Connect RP role defined in [OCStandard] and support for
OpenID Connect reserved claims defined in [OCMessages].</li>
</ul>
</div></blockquote>
<p>The AM&#8217;s configuration data provides a machine-readable method for an
AM to indicate certain of the conformance options it has chosen.
Several of the data properties allow for extensibility.  Where this
specification does not already require optional features to be
documented, it is RECOMMENDED that AM developers and deployers
document any profiled or extended features explicitly and use
configuration data to indicate their usage.  See Section 1.5 for
information about providing and extending AM configuration data.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="iana-considerations">
<span id="uma-core-9"></span><h2><a class="toc-backref" href="#id52">9.  IANA Considerations</a><a class="headerlink" href="#iana-considerations" title="Permalink to this headline">¶</a></h2>
<p>Several UMA-specific JSON-based media types are being proposed, as
follows: (TBS)</p>
<p>(draft 05)</p>
</div>
<div class="section" id="example-of-registering-resource-sets">
<span id="uma-core-10"></span><h2><a class="toc-backref" href="#id53">10.  Example of Registering Resource Sets</a><a class="headerlink" href="#example-of-registering-resource-sets" title="Permalink to this headline">¶</a></h2>
<p>The following example illustrates the intent and usage of resource
set descriptions and scope descriptions as part of resource set
registration.</p>
<p>This example contains some steps that are exclusively in the realm of
user experience rather than web protocol, to achieve realistic
illustration.  These steps are labeled &#8220;User experience only&#8221;.  Some
other steps are exclusively internal to the operation of the entity
being discussed.  These are labeled &#8220;Internal only&#8221;.</p>
<p>An authorizing user, Alice Adams, has just uploaded a photo of her
new puppy to a host, Photoz.example.com, and wants to ensure that
this specific photo is not publicly accessible.</p>
<p>Alice has already introduced this host to her AM,
CopMonkey.example.com, and thus Photoz has already obtained a PAT
from CopMonkey.  However, Alice has not previously instructed Photoz
to use CopMonkey to protect any other photos of hers.</p>
<p>Alice has previously visited CopMonkey to map a default &#8220;do not share
with anyone&#8221; policy to any resource sets registered by Photoz, until
such time as she maps some other more permissive policies to those
resources.  (User experience only.  This may have been done at the
time Alice introduced the host to the AM, and/or it could have been a
global or host-specific preference setting.  A different constraint
or no constraint at all might be associated with newly protected
resources.)  Other kinds of policies she may eventually map to
particular photos or albums might be &#8220;Share only with
<a class="reference external" href="mailto:husband&#37;&#52;&#48;email&#46;example&#46;net">husband<span>&#64;</span>email<span>&#46;</span>example<span>&#46;</span>net</a>&#8221; or &#8220;Share only with people in my &#8216;family&#8217;
group&#8221;.</p>
<p>Photoz itself has a publicly documented application-specific API that
offers two dozen different methods that apply to single photos, such
as &#8220;addTags&#8221; and &#8220;getSizes&#8221;, but rolls them up into two photo-related
scopes of access: &#8220;view&#8221; (consisting of various read-only operations)
and &#8220;all&#8221; (consisting of various reading, editing, and printing
operations).  It defines two scope descriptions that represent these
scopes, which it is able to reuse for all of its users (not just
Alice), and ensures that these scope description documents are
available through HTTP GET requests that may be made by AMs.</p>
<p>The &#8220;name&#8221; property values are intended to be seen by Alice when she
maps authorization constraints to specific resource sets and actions
while visiting CopMonkey, such that Alice would see the strings &#8220;View
Photo and Related Info&#8221; and &#8220;All Actions&#8221;, likely accompanied by the
referenced icons, in the CopMonkey interface.  (Other users of Photoz
might similarly see the same labels at CopMonkey or whatever other AM
they use.  Photoz could distinguish natural-language labels per user
if it wishes, by pointing to scopes with differently translated
names.)</p>
<p>Example of the viewing-related scope description document available
at <a class="reference external" href="http://photoz.example.com/dev/scopes/view">http://photoz.example.com/dev/scopes/view</a> with a Content-Type of
application/uma-scope+json:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;View Photo and Related Info&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/reading-glasses.png&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example of the broader scope description document available at
<a class="reference external" href="http://photoz.example.com/dev/scopes/all">http://photoz.example.com/dev/scopes/all</a>, likewise with a Content-
Type of application/uma-scope+json:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;All Actions&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/galaxy.png&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>While visiting Photoz, Alice selects a link or button that instructs
the site to &#8220;Protect&#8221; or &#8220;Share&#8221; this single photo (user experience
only; Photoz could have made this a default or preference setting).</p>
<p>As a result, Photoz defines for itself a resource set that represents
this photo (internal only; Photoz is the only application that knows
how to map a particular photo to a particular resource set).  Photoz
also prepares the following resource set description, which is
specific to Alice and her photo.  The &#8220;name&#8221; property value is
intended to be seen by Alice in mapping authorization policies to
specific resource sets and actions when she visits CopMonkey.  Alice
would see the string &#8220;Steve the puppy!&#8221;, likely accompanied by the
referenced icon, in the CopMonkey interface.  The possible scopes of
access on this resource set are indicated with URI references to the
scope descriptions, as shown just above.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Steve the puppy!&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower&quot;</span><span class="p">,</span>
  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Photoz uses the &#8220;create resource set description&#8221; method of
CopMonkey&#8217;s standard UMA resource set registration API, presenting
its Alice-specific PAT there, to register and assign an identifier to
the resource set description.</p>
<div class="highlight-python"><pre>PUT /resource_set/112210f47de98100 HTTP/1.1
Content-Type: application/uma-resource-set+json
...

{
  "name": "Steve the puppy!",
  "icon_uri": "http://www.example.com/icons/flower.png",
  "scopes": [
    "http://photoz.example.com/dev/scopes/view",
    "http://photoz.example.com/dev/scopes/all"
  ]
}</pre>
</div>
<p>If the registration attempt succeeds, CopMonkey responds in the
following fashion.</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: "1"
...

{
  "status": "created",
  "_id":  "112210f47de98100",
  "_rev": "1"
}</pre>
</div>
<p>At the time Alice indicates she would like this photo protected,
Photoz can choose to redirect Alice to CopMonkey for further policy
setting, access auditing, and other AM-related tasks (user experience
only).</p>
<p>Once it has successfully registered this description, Photoz is
responsible for outsourcing to CopMonkey all questions of
authorization for access attempts made to this photo.</p>
<p>Over time, as Alice uploads other photos and creates and organizes
photo albums, and as Photoz makes new action functionality available,
Photoz can use additional methods of the resource set registration
API to ensure that CopMonkey&#8217;s understanding of Alice&#8217;s protected
resources matches its own.</p>
<p>For example, if Photoz suspects that somehow its understanding of the
resource set has gotten out of sync with CopMonkey&#8217;s, it can ask to
read the resource set description as follows.</p>
<div class="highlight-python"><pre>GET /resource_set/112210f47de98100 HTTP/1.1
Host: am.example.com
...</pre>
</div>
<p>CopMonkey responds with the full content of the resource set
description, including its _id and its current _rev, as follows:</p>
<p>Example of an HTTP response to a &#8220;read resource set description&#8221;
request, containing a resource set description from the AM:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/uma-resource-set+json
ETag: "1"
...

{
  "_id":  "112210f47de98100",
  "_rev": "1",
  "name": "Photo album",
  "icon_uri": "http://www.example.com/icons/flower.png",
  "scopes": [
    "http://photoz.example.com/dev/scopes/view",
    "http://photoz.example.com/dev/scopes/all"
  ]
}</pre>
</div>
<p>If for some reason Photoz and CopMonkey have gotten dramatically out
of sync, Photoz can ask for the list of resource set identifiers
CopMonkey currently knows about:</p>
<div class="highlight-python"><pre>GET /resource_set HTTP/1.1
Host: am.example.com
...</pre>
</div>
<p>CopMonkey&#8217;s response might look as follows:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
...

[ "112210f47de98100", "34234df47eL95300" ]</pre>
</div>
<p>If Alice later changes the photo&#8217;s title (user experience only) on
Photoz from &#8220;Steve the puppy!&#8221; to &#8220;Steve on October 14, 2011&#8221;, Photoz
would use the &#8220;update resource set description&#8221; method to ensure that
Alice&#8217;s experience of policy-setting at CopMonkey remains consistent
with what she sees at Photoz.  Following is an example of this
request.</p>
<div class="highlight-python"><pre>PUT /resource_set/112210f47de98100 HTTP/1.1
Content-Type: application/uma-resource-set+json
Host: am.example.com
If-Match: "1"
...

{
  "name": "Steve on October 14, 2011",
  "icon_uri": "http://www.example.com/icons/flower.png",
  "scopes": [
    "http://photoz.example.com/dev/scopes/view",
    "http://photoz.example.com/dev/scopes/all"
  ]
}</pre>
</div>
<p>CopMonkey would respond as follows.</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: "2"
...

{
  "status": "updated",
  "_id":  "112210f47de98100",
  "_rev": "2"
}</pre>
</div>
<p>There are other reasons Photoz might want to update resource set
descriptions, having nothing to do with Alice&#8217;s actions or wishes.
For example, it might extend its API to include new features, and
want to add new scopes to all of Alice&#8217;s and other users&#8217; resource
set descriptions.</p>
<p>if Alice later decides to entirely remove sharing protection (user
experience only) on this photo while visiting Photoz, ensuring that
the public can get access without any UMA-based protection, Photoz is
responsible for deleting the relevant resource set registration, as
follows:</p>
<div class="highlight-python"><pre>DELETE /resource_set/112210f47de98100 HTTP/1.1
Host: am.example.com
If-Match: "2"
...</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="acknowledgments">
<span id="uma-core-11"></span><h2><a class="toc-backref" href="#id54">11.  Acknowledgments</a><a class="headerlink" href="#acknowledgments" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The current editor of this specification is Thomas Hardjono of MIT.
The following people are co-authors:</p>
<p>o  Paul C. Bryan, ForgeRock US, Inc. (former editor)</p>
<p>o  Domenico Catalano, Oracle Corp.</p>
<p>o  George Fletcher, AOL</p>
<p>o  Maciej Machulak, Newcastle University</p>
<p>o  Eve Maler, XMLgrrl.com</p>
<p>o  Lukasz Moren, Newcastle University</p>
<p>o  Christian Scholz, COMlounge GmbH (former editor)</p>
<p>o  Jacek Szpot, Newcastle University</p>
<p>Additional contributors to this specification include the Kantara UMA
Work Group participants, a list of whom can be found at
[UMAnitarians].</p>
</div></blockquote>
<p>(draft 05)</p>
</div>
<div class="section" id="issues">
<span id="uma-core-12"></span><h2><a class="toc-backref" href="#id55">12.  Issues</a><a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>All issues are now captured at the project&#8217;s GitHub site
(&lt;<a class="reference external" href="https://github.com/xmlgrrl/UMA-Specifications/issues">https://github.com/xmlgrrl/UMA-Specifications/issues</a>&gt;).</div></blockquote>
<p>(draft 05)</p>
</div>
<div class="section" id="references">
<span id="uma-core-13"></span><h2><a class="toc-backref" href="#id56">13.  References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>(draft 05)</p>
<div class="section" id="normative-references">
<span id="uma-core-13-1"></span><h3><a class="toc-backref" href="#id57">13.1.  Normative References</a><a class="headerlink" href="#normative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-dynclientreg">[DynClientReg]</dt>
<dd>Hardjono, T., &#8220;OAuth Dynamic Client Registration
Protocol&#8221;, May 2012, &lt;<a class="reference external" href="https://datatracker.ietf.org/doc/">https://datatracker.ietf.org/doc/</a>
draft-ietf-oauth-dyn-reg/&gt;.</dd>
<dt id="term-oauth-saml">[OAuth-SAML]</dt>
<dd>Campbell, B., &#8220;SAML 2.0 Bearer Assertion Grant Type
Profile for OAuth 2.0&#8221;, August 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/">http://tools.ietf.org/html/</a>
draft-ietf-oauth-saml2-bearer&gt;.</dd>
<dt id="term-oauth-bearer">[OAuth-bearer]</dt>
<dd>&#8220;The OAuth 2.0 Authorization Protocol: Bearer Tokens&#8221;,
March 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-bearer">http://tools.ietf.org/html/draft-ietf-oauth-v2-bearer</a>&gt;.</dd>
<dt id="term-oauth2-hammer-lahav-e-the-oauth-2-0-protocol">[OAuth2]   Hammer-Lahav, E., &#8220;The OAuth 2.0 Protocol&#8221;,</dt>
<dd>September 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2">http://tools.ietf.org/html/draft-ietf-oauth-v2</a>&gt;.</dd>
<dt id="term-ocmessages">[OCMessages]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Messages 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-messages-1_0.html&gt;.</dd>
<dt id="term-ocstandard">[OCStandard]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Standard 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-standard-1_0.html&gt;.</dd>
<dt id="term-rfc2119">[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt id="term-rfc4627">[RFC4627]</dt>
<dd>Crockford, D., &#8220;The application/json Media Type for
JavaScript Object Notation (JSON)&#8221;, RFC 4627, July 2006.</dd>
<dt id="term-rfc6415">[RFC6415]</dt>
<dd>Hammer-Lahav, E., &#8220;Web Host Metadata&#8221;, October 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6415">http://tools.ietf.org/html/rfc6415</a>&gt;.</dd>
<dt id="term-uma-trustmodel">[UMA-trustmodel]</dt>
<dd>Maler, E., &#8220;UMA Trust Model&#8221;, April 2012, &lt;<a class="reference external" href="http://">http://</a>
kantarainitiative.org/confluence/display/uma/
UMA+Trust+Model&gt;.</dd>
</dl>
<p>(draft 05)</p>
</div>
<div class="section" id="informative-references">
<span id="uma-core-13-2"></span><h3><a class="toc-backref" href="#id58">13.2.  Informative References</a><a class="headerlink" href="#informative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-uma-usecases">[UMA-usecases]</dt>
<dd>Maler, E., &#8220;UMA Scenarios and Use Cases&#8221;, October 2010, &lt;h
ttp://kantarainitiative.org/confluence/display/uma/
UMA+Scenarios+and+Use+Cases&gt;.</dd>
<dt id="term-uma-userstories">[UMA-userstories]</dt>
<dd>Maler, E., &#8220;UMA User Stories&#8221;, November 2010, &lt;<a class="reference external" href="http://">http://</a>
kantarainitiative.org/confluence/display/uma/
User+Stories&gt;.</dd>
<dt id="term-umanitarians">[UMAnitarians]</dt>
<dd>Maler, E., &#8220;UMA Participant Roster&#8221;, 2012, &lt;<a class="reference external" href="http://">http://</a>
kantarainitiative.org/confluence/display/uma/
Participant+Roster&gt;.</dd>
</dl>
<p>(draft 05)</p>
</div>
</div>
<div class="section" id="note">
<h2><a class="toc-backref" href="#id59">Note</a><a class="headerlink" href="#note" title="Permalink to this headline">¶</a></h2>
<div class="section" id="resource-set-descriptor-for-openid-connect">
<h3><a class="toc-backref" href="#id60">Resource Set Descriptor for OpenID Connect</a><a class="headerlink" href="#resource-set-descriptor-for-openid-connect" title="Permalink to this headline">¶</a></h3>
<p>If an OpenID Connect OP works as an UMA AM,  the OP can return the UserInfo
in which Users&#8217; resource at Host are included as an Aggregated Claim , or
OAuth Access Tokens to the Host endpoint are includde.</p>
<p>To make OpenID Connet OP as a middle man,
the Host gives extra parameters in UMA Resoure Set Description
for Protection API.</p>
<dl class="glossary docutils">
<dt id="term-89">token_endpoint</dt>
<dd>Connect OP ask the Host to issue an access token and an refresh token at this endpoint.
Requests are authenticated by OAuth Bear Token Profile with <strong>credentai_token</strong>.</dd>
<dt id="term-credential-token">credential_token</dt>
<dd>Token for the Token Endpoint request authtentiction</dd>
<dt id="term-refresh-token">refresh_token</dt>
<dd>Token to refresh an access token and the other reflesh token.</dd>
<dt id="term-resource-endpoint">resource_endpoint</dt>
<dd>Users resource is returned from this endpoint in exchange for access token.</dd>
</dl>
<p>The following JSON is an non-normative sample to be put by Host to Connect OP as AM
for Protecttion API.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Photo Album&quot;</span><span class="p">,</span>

  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower.png&quot;</span><span class="p">,</span>

  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">],</span>

  <span class="s2">&quot;token_endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://photoz.example.com/dev/token/&quot;</span><span class="p">,</span>
  <span class="s2">&quot;credential_token&quot;</span> <span class="o">:</span> <span class="s2">&quot;fdsafdsafdsafa&quot;</span><span class="p">,</span>
  <span class="s2">&quot;refresh_token&quot;</span> <span class="o">:</span> <span class="s2">&quot;432gsafgds9&quot;</span><span class="p">,</span>
  <span class="s2">&quot;resource_endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://photoz.example.com/dev/resource/&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the User configure to return his UserInfo including resource at Host,
the OP refreshes an access token in exchange for the <strong>refresh_tokne</strong> first,
then get the resource at <strong>token_endpoint</strong> in exchange for the access token.</p>
<p>After the resource is returned in JWT form to the OP, OP include it as an
Aggregated Claim in the UserInfo( which is to be returnd to the other RP).</p>
<p>If the User configure to return an access token to the Host in UserInfo,
OP includes the access token given by Host&#8217; <strong>token_endpoint</strong> in the UserInfo.</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="session.html">OpenID Connect Session Management 1.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="uma_trust.html">UMA Trust Model</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>