

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>User-Managed Access (UMA) Profile of OAuth 2.0 &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="Binding Obligations on User-Managed Access (UMA) Participants" href="uma_trust.html" />
    <link rel="prev" title="OpenID Connect Session Management 1.0" href="session.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>identity 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>User-Managed Access (UMA) Profile of OAuth 2.0</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="session.html">OpenID Connect Session Management 1.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="uma_trust.html">Binding Obligations on User-Managed Access (UMA) Participants</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="user-managed-access-uma-profile-of-oauth-2-0">
<h1>User-Managed Access (UMA) Profile of OAuth 2.0<a class="headerlink" href="#user-managed-access-uma-profile-of-oauth-2-0" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id137">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id138">1.  Introduction</a><ul>
<li><a class="reference internal" href="#id1" id="id139">概要</a><ul>
<li><a class="reference internal" href="#id2" id="id140">ポリシーベースアクセス制御</a></li>
<li><a class="reference internal" href="#id3" id="id141">ユースケース</a></li>
<li><a class="reference internal" href="#id4" id="id142">利用条件</a></li>
<li><a class="reference internal" href="#pdp-pep" id="id143">PDP/PEP</a></li>
<li><a class="reference internal" href="#oauth2" id="id144">OAuth2</a></li>
<li><a class="reference internal" href="#protocol" id="id145">Protocol</a><ul>
<li><a class="reference internal" href="#pat-api" id="id146">リソース保護(PAT API)</a></li>
<li><a class="reference internal" href="#rpt" id="id147">認可発行(RPT発行)</a></li>
<li><a class="reference internal" href="#id5" id="id148">リソースアクセス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6" id="id149">デプロイメント</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notational-conventions" id="id150">1.1.  Notational Conventions</a></li>
<li><a class="reference internal" href="#basic-terminology" id="id151">1.2.  Basic Terminology</a></li>
<li><a class="reference internal" href="#endpoints-endpoint-protection-and-tokens" id="id152">1.3. Endpoints, Endpoint Protection, and Tokens</a><ul>
<li><a class="reference internal" href="#api-pat" id="id153">保護API(PAT)</a></li>
<li><a class="reference internal" href="#api-aat" id="id154">認可API(AAT)</a></li>
<li><a class="reference internal" href="#api-rpt" id="id155">リソースAPI(RPT)</a></li>
<li><a class="reference internal" href="#oauth" id="id156">標準OAuth エンドポイント</a></li>
<li><a class="reference internal" href="#id7" id="id157">リソースサーバー向けエンドポイント</a></li>
<li><a class="reference internal" href="#id8" id="id158">クライアント向けエンドポイント</a></li>
<li><a class="reference internal" href="#id9" id="id159">リソースサーバーのクライアント向けエンドポイント</a></li>
<li><a class="reference internal" href="#id10" id="id160">トークン管理</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scopes-resource-sets-permissions-and-authorization" id="id161">1.4.  Scopes, Resource Sets, Permissions, and Authorization</a><ul>
<li><a class="reference internal" href="#id11" id="id162">リソースセットとスコープタイプ</a></li>
<li><a class="reference internal" href="#id12" id="id163">パーミッション</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authorization-server-configuration-data" id="id164">1.5. Authorization Server Configuration Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#protecting-a-resource" id="id165">2. Protecting a Resource</a><ul>
<li><a class="reference internal" href="#resource-server-obtains-pat" id="id166">2.1. Resource Server Obtains PAT</a></li>
<li><a class="reference internal" href="#resource-server-registers-sets-of-resources-to-be-protected" id="id167">2.2. Resource Server Registers Sets of Resources to Be Protected</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-authorization-and-accessing-a-resource" id="id168">3. Getting Authorization and Accessing a Resource</a><ul>
<li><a class="reference internal" href="#client-attempts-to-access-protected-resource" id="id169">3.1. Client Attempts to Access Protected Resource</a><ul>
<li><a class="reference internal" href="#client-presents-no-rpt" id="id170">3.1.1. Client Presents No RPT</a></li>
<li><a class="reference internal" href="#client-presents-an-rpt-that-has-insufficient-authorization-data" id="id171">3.1.2. Client Presents an RPT That Has Insufficient Authorization Data</a></li>
<li><a class="reference internal" href="#client-presents-a-valid-rpt-with-sufficient-authorization-data" id="id172">3.1.3. Client Presents a Valid RPT with Sufficient Authorization Data</a><ul>
<li><a class="reference internal" href="#requester-s-token-has-insufficient-permission" id="id173">3.1.3.1.  Requester&#8217;s Token Has Insufficient Permission</a></li>
<li><a class="reference internal" href="#requester-s-token-has-sufficient-permission" id="id174">3.1.3.2.  Requester&#8217;s Token Has Sufficient Permission</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#resource-server-registers-a-permission-with-authorization-server" id="id175">3.2. Resource Server Registers a Permission With Authorization Server</a><ul>
<li><a class="reference internal" href="#id13" id="id176">サンプル</a><ul>
<li><a class="reference internal" href="#id14" id="id177">リクエスト</a></li>
<li><a class="reference internal" href="#id15" id="id178">レスポンス</a></li>
<li><a class="reference internal" href="#id16" id="id179">エラー応答</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#resource-server-determines-the-rpt-status" id="id180">3.3. Resource Server Determines the RPT Status</a><ul>
<li><a class="reference internal" href="#uma-bearer-token-profile" id="id181">3.3.1. UMA Bearer Token Profile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#client-asks-authorization-server-for-rpt-and-authorization-data" id="id182">3.4. Client Asks Authorization Server for RPT and Authorization Data</a><ul>
<li><a class="reference internal" href="#client-obtains-aat" id="id183">3.4.1. Client Obtains AAT</a></li>
<li><a class="reference internal" href="#client-asks-for-authorization-data" id="id184">3.4.2.  Client Asks for Authorization Data</a></li>
<li><a class="reference internal" href="#uma-core-3-4-3" id="id185">3.4.3. Client Asks for Authorization Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#claims-gathering-flows" id="id186">3.5. Claims-Gathering Flows</a><ul>
<li><a class="reference internal" href="#claims-gathering-flow-for-clients-operated-by-end-users" id="id187">3.5.1. Claims-Gathering Flow for Clients Operated by End-Users</a><ul>
<li><a class="reference internal" href="#openid-connect-claim-profile" id="id188">3.5.1.1.  OpenID Connect Claim Profile</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#error-messages" id="id189">4.  Error Messages</a><ul>
<li><a class="reference internal" href="#oauth-error-responses" id="id190">4.1.  OAuth Error Responses</a></li>
<li><a class="reference internal" href="#uma-error-responses" id="id191">4.2.  UMA Error Responses</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification-of-additional-profiles" id="id192">5.  Specification of Additional Profiles</a><ul>
<li><a class="reference internal" href="#specifying-uma-profiles" id="id193">5.1.  Specifying UMA Profiles</a></li>
<li><a class="reference internal" href="#specifying-uma-token-profiles" id="id194">5.2.  Specifying UMA Token Profiles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations" id="id195">6.  Security Considerations</a></li>
<li><a class="reference internal" href="#privacy-considerations" id="id196">7.  Privacy Considerations</a></li>
<li><a class="reference internal" href="#conformance" id="id197">8.  Conformance</a></li>
<li><a class="reference internal" href="#iana-considerations" id="id198">9.  IANA Considerations</a></li>
<li><a class="reference internal" href="#example-of-registering-resource-sets" id="id199">10.  Example of Registering Resource Sets</a></li>
<li><a class="reference internal" href="#acknowledgments" id="id200">11.  Acknowledgments</a></li>
<li><a class="reference internal" href="#issues" id="id201">12.  Issues</a><ul>
<li><a class="reference internal" href="#normative-references" id="id202">12.1.  Normative References</a></li>
<li><a class="reference internal" href="#informative-references" id="id203">12.2.  Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references" id="id204">13.  References</a><ul>
<li><a class="reference internal" href="#uma-core-13-1" id="id205">13.1.  Normative References</a></li>
<li><a class="reference internal" href="#uma-core-13-2" id="id206">13.2.  Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#note" id="id207">Note</a><ul>
<li><a class="reference internal" href="#resource-set-descriptor-for-openid-connect" id="id208">Resource Set Descriptor for OpenID Connect</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Based on <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07</a></li>
</ul>
</div>
<div class="section" id="abstract">
<span id="uma-core-abstract"></span><h2><a class="toc-backref" href="#id137">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>User-Managed Access (UMA) is a profile of OAuth 2.0.</p>
<p>UMA defines how <a class="reference internal" href="#term-83"><em class="xref std std-term">resource owners</em></a> can control access to their <a class="reference internal" href="glossary.html#term-protected-resources"><em class="xref std std-term">protected resources</em></a>
made by <a class="reference internal" href="#term-87"><em class="xref std std-term">clients</em></a> operated by arbitrary rquesting parties,
where the resources reside on any number of resource servers,
and where a centralized <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> governs access
based on <em class="xref std std-term">resource owner policy</em>.</p>
<p>(draft 06)</p>
</div>
<div class="section" id="introduction">
<span id="uma-core-1"></span><h2><a class="toc-backref" href="#id138">1.  Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id139">概要</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id2">
<h4><a class="toc-backref" href="#id140">ポリシーベースアクセス制御</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>User-Managed Access (UMA) is a profile of OAuth 2.0 [OAuth2].
UMA defines how <a class="reference internal" href="#term-83"><em class="xref std std-term">resource owners</em></a> can control
access to their <a class="reference internal" href="glossary.html#term-protected-resources"><em class="xref std std-term">protected resources</em></a> made by <a class="reference internal" href="#term-87"><em class="xref std std-term">clients</em></a>
operated by arbitrary <a class="reference internal" href="#term-85"><em class="xref std std-term">requesting parties</em></a>,
where the resources reside on any number of <a class="reference internal" href="oauth.html#term-resource-servers"><em class="xref std std-term">resource servers</em></a>,
and where a centralized <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> governs access
based on resource owner <a class="reference internal" href="glossary.html#term-policy"><em class="xref std std-term">policy</em></a>.</p>
<p>Resource owners configure authorization servers with <em class="xref std std-term">access policies</em>
that serve as <em class="xref std std-term">implicit authorization grants</em>.
Thus,
the UMA profile of OAuth includes an authorization grant flow.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">access policies を定義しておくと(PDP)、認可が勝手にでる(PEP)</p>
</div>
</div>
<div class="section" id="id3">
<h4><a class="toc-backref" href="#id141">ユースケース</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>UMA serves numerous use cases where a resource owner outsources
authorization for access to their resources,
potentially even without the run-time presence of the resource owner.</p>
<p>A typical example is the following:
a web user (an end-user resource owner) can authorize
a web app (client) to gain one-time or ongoing access to a protected resource
containing his home address stored at a &#8220;personal data store&#8221; service (resource server),
by telling the resource server to respect access entitlements
issued by his authorization service (authorization server).</p>
<p>The requesting party operating the client might be the resource owner himself,
using a web or native app run by an e-commerce company
that needs to know where to ship a purchased item,
or it might be his friend who is using an online address book service
to collect contact information,
or it might be a survey company that uses an autonomous web service
to compile population demographics.</p>
<p>A variety of scenarios and use cases can be found
in <a class="reference internal" href="#term-171"><em class="xref std std-term">[UMA-usecases]</em></a> and <a class="reference internal" href="#term-158"><em class="xref std std-term">[UMA-casestudies]</em></a> .</p>
</div>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id142">利用条件</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Practical control of access among loosely coupled parties requires
more than just messaging protocols.
This specification defines only the technical &#8220;<strong>contract</strong>&#8221;
between UMA-conforming entities;
its companion <em class="xref std std-term">Binding Obligations specification</em> <a class="reference internal" href="#term-155"><em class="xref std std-term">[UMA-obligations]</em></a> defines
the expected behaviors of parties operating and using these entities.</p>
<p>Parties operating entities that claim to be UMA-conforming MUST
provide documentation affirmatively stating their acceptance of
the binding obligations contractual framework defined
in the Binding Obligations specification.</p>
</div>
<div class="section" id="pdp-pep">
<h4><a class="toc-backref" href="#id143">PDP/PEP</a><a class="headerlink" href="#pdp-pep" title="Permalink to this headline">¶</a></h4>
<p>In enterprise settings,
application access management often involves letting back-office applications serve
only as policy enforcement points (PEPs),
depending entirely on access decisions coming from a central policy decision point (PDP)
to govern the access they give to requesters.
This separation eases auditing and allows policy administration
to scale in several dimensions.
UMA makes use of a separation similar to this,
letting the resource owner serve as a policy administrator
crafting authorization strategies for resources under their control.</p>
</div>
<div class="section" id="oauth2">
<h4><a class="toc-backref" href="#id144">OAuth2</a><a class="headerlink" href="#oauth2" title="Permalink to this headline">¶</a></h4>
<p>The UMA protocol can be considered an advanced profile of <a class="reference internal" href="#term-149"><em class="xref std std-term">[OAuth2]</em></a>.
In order to increase interoperable communication among the authorization server,
resource server, and client, it defines several purpose-built APIs
related to the outsourcing of authorization,
themselves protected by OAuth in embedded fashion.</p>
</div>
<div class="section" id="protocol">
<h4><a class="toc-backref" href="#id145">Protocol</a><a class="headerlink" href="#protocol" title="Permalink to this headline">¶</a></h4>
<p>The UMA protocol has three broad phases, as shown in Figure 1.</p>
<div class="highlight-python"><pre>The Three Phases of the UMA Profile of OAuth
                                        +--------------+
                                        |   resource   |
       +---------manage (A)------------ |     owner    |
       |                                +--------------+
       |         Phase 1:                      |
       |         protect a                control (B)
       |         resource                      |
       v                                       v
+------------+               +----------+--------------+
|            |               |protection|              |
|  resource  |               |   API    | authorization|
|   server   |&lt;-protect (C)--|  (needs  |    server    |
|            |               |   PAT)   |              |
+------------+               +----------+--------------+
| protected  |                          | authorization|
| resource   |                          |     API      |
|(needs RPT) |                          |  (needs AAT) |
+------------+                          +--------------+
       ^                                       |
       |         Phases 2 and 3:         authorize (D)
       |         get authorization,            |
       |         access a resource             v
       |                                +--------------+
       +---------access (E)-------------|    client    |
                                        +--------------+

                                        requesting party

                           Figure 1</pre>
</div>
<p>In broad strokes,
the phases are as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Protect a resource (described in <em class="xref std std-ref">Section 2</em>).</li>
<li>Get authorization (described in <em class="xref std std-ref">Section 3</em>).</li>
<li>Access a resource (described along with Phase 2 in Section 3).</li>
</ol>
</div></blockquote>
<p>In more detail, the phases work as follows:</p>
<div class="section" id="pat-api">
<h5><a class="toc-backref" href="#id146">リソース保護(PAT API)</a><a class="headerlink" href="#pat-api" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic">
<li><p class="first">_Protect a resource:_</p>
<p>This phase accomplishes trust establishment
among the <a class="reference internal" href="#term-82"><em class="xref std std-term">resource owner</em></a>, <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>,
and <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>,
as well as enabling the resource server to register with
the authorization server descriptions of the resources to be protected.</p>
<p>This specification uses <a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a> to
enable dynamic introduction and resource registration.</p>
<p>In these circumstances,
where the resource owner has chosen to use a resource server
for managing online resources (&#8220;A&#8221;),
the resource owner introduces this resource server
to an authorization server using an OAuth-mediated interaction
that results in the authorization server
giving the resource server a <em class="xref std std-term">protection API token</em> (<em class="xref std std-term">PAT</em>).</p>
<p>The resource server then uses the authorization server&#8217;s protection API
to register sets of resources for which protection is being outsourced (&#8220;C&#8221;).
(Out of band of the UMA protocol,
the resource owner instructs the authorization server
what policies to associated with the registered resource sets (&#8220;B&#8221;).)</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="rpt">
<h5><a class="toc-backref" href="#id147">認可発行(RPT発行)</a><a class="headerlink" href="#rpt" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic" start="2">
<li><p class="first">_Get authorization:_</p>
<blockquote>
<div><p>This phase involves the client (along with its operator,
the &#8220;requesting party&#8221;) for the first time.</p>
<p>The client approaches the resource server seeking
access to a protected resource (&#8220;E&#8221;).</p>
<p>In order to access it,
the client must first obtain a requesting party token (RPT)
from the authorization server
on behalf of its requesting party.</p>
<p>The client and requesting party are then redirected
to the authorization server to ask for appropriate authorization data
(the form of this data depends on the RPT profile in use).</p>
<p>In doing so,
the requesting party must demonstrate to the authorization server
that it satisfies the resource owner&#8217;s policy
governing the sought-for resource and scope (&#8220;D&#8221;).</p>
<p>To use the authorization server&#8217;s authorization API in the first place,
the requesting party has to agree to communication with this server
for the purpose of seeking authorization,
which results in the client obtaining an authorization API token (AAT).</p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id5">
<h5><a class="toc-backref" href="#id148">リソースアクセス</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic simple" start="3">
<li>_Access a resource:_ This phase involves the client successfully
presenting an RPT that has sufficient authorization data
associated with it to the resource server in order to gain access
to the desired resource (&#8220;E&#8221;).  In this sense, it is the &#8220;happy
path&#8221; within phase 2.</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id149">デプロイメント</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>In deploying UMA,
implementers are expected to develop one or more profiles of UMA
(described in <em class="xref std std-ref">Section 5</em>)
that specify and restrict the various UMA protocol options,
according to the deployment conditions.</p>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1</a> )</p>
</div>
</div>
<div class="section" id="notational-conventions">
<span id="uma-core-1-1"></span><h3><a class="toc-backref" href="#id150">1.1.  Notational Conventions</a><a class="headerlink" href="#notational-conventions" title="Permalink to this headline">¶</a></h3>
<p>The key words &#8216;MUST&#8217;, &#8216;MUST NOT&#8217;, &#8216;REQUIRED&#8217;, &#8216;SHALL&#8217;, &#8216;SHALL NOT&#8217;,
&#8216;SHOULD&#8217;, &#8216;SHOULD NOT&#8217;, &#8216;RECOMMENDED&#8217;, &#8216;MAY&#8217;, and &#8216;OPTIONAL&#8217; in this
document are to be interpreted as described in [RFC2119].</p>
<p>Unless otherwise noted, all the protocol properties and values are
case sensitive.</p>
<p>( draft 06 <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.1</a> )</p>
</div>
<div class="section" id="basic-terminology">
<span id="uma-core-1-2"></span><h3><a class="toc-backref" href="#id151">1.2.  Basic Terminology</a><a class="headerlink" href="#basic-terminology" title="Permalink to this headline">¶</a></h3>
<p>UMA introduces the following new terms and enhancements of OAuth term
definitions.</p>
<dl class="glossary docutils">
<dt id="term-resource-owner"><span id="term-resource-owners"></span>resource owner<br />resource owners</dt>
<dd>The &#8220;user&#8221; in User-Managed Access; an OAuth resource owner.
This is typically an end-user (a natural person) but it can
also be a corporation or other legal person.</dd>
<dt id="term-requesting-party"><span id="term-requesting-parties"></span>requesting party<br />requesting parties</dt>
<dd>An end-user, or a corporation or other legal person, that uses
a client to seek access to a protected resource.  The
requesting party may or may not be the same party as the
resource owner.</dd>
<dt id="term-client"><span id="term-clients"></span>client<br />clients</dt>
<dd>An application making protected resource requests with the
resource owner&#8217;s authorization and on the requesting party&#8217;s
behalf.</dd>
<dt id="term-claim"><span id="term-claims"></span>claim<br />claims</dt>
<dd><p class="first">A statement of the value or values of one or more identity
attributes of a requesting party.</p>
<p class="last">A <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a> may need to provide claims
to an authorization server in order to satisfy policy
and gain permission for access to a protected
resource.</p>
</dd>
<dt id="term-resource-set"><span id="term-resource-sets"></span>resource set<br />resource sets</dt>
<dd><p class="first">A set of one or more protected resources.</p>
<p class="last">In authorization policy terminology,
a resource set is the &#8220;object&#8221; being protected.</p>
</dd>
<dt id="term-scope-type">scope type</dt>
<dd><p class="first">A bounded extent of access that is possible to perform on
a resource set.</p>
<p>In authorization policy terminology,
a scope type is one of the potentially many &#8220;verbs&#8221; that can logically
apply to a resource set (&#8220;object&#8221;).</p>
<p class="last">UMA associates scope types with labeled <a class="reference internal" href="#term-91"><em class="xref std std-term">resource sets</em></a>.</p>
</dd>
<dt id="term-authorization-data">authorization data</dt>
<dd><p class="first">Data associated with a requesting party token
that enables some combination of the authorization server and
resource server to determine the correct extent of access to
allow to a client.</p>
<p class="last">Authorization data is a key part of the definition of an RPT profile.</p>
</dd>
<dt id="term-permission">permission</dt>
<dd><p class="first">A scope of access over a particular <a class="reference internal" href="#term-90"><em class="xref std std-term">resource set</em></a>
at a particular resource server that is being asked for by,
or being granted to, a <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a>.</p>
<p>In authorization policy terminology,
a permission is an entitlement that includes a &#8220;subject&#8221; (requesting party),
&#8220;verbs&#8221; (one or more scopes of access), and an &#8220;object&#8221; (resource set).</p>
<p class="last">A permission is one example of authorization data
that an authorization server may grant.</p>
</dd>
<dt id="term-permission-ticket">permission ticket</dt>
<dd>A correlation <strong>handle</strong> that is conveyed from an
authorization server to a resource server,
from a resource server to a client,
and ultimately from a client to an authorization server,
to enable the authorization server to assess the correct resource owner policies
to apply to a request for an authorization grant.</dd>
</dl>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.2</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-1-3" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="endpoints-endpoint-protection-and-tokens">
<h3><a class="toc-backref" href="#id152">1.3. Endpoints, Endpoint Protection, and Tokens</a><a class="headerlink" href="#endpoints-endpoint-protection-and-tokens" title="Permalink to this headline">¶</a></h3>
<p>Various UMA entities present protected APIs for other entities to use.</p>
<p>These APIs are as follows:</p>
<div class="section" id="api-pat">
<h4><a class="toc-backref" href="#id153">保護API(PAT)</a><a class="headerlink" href="#api-pat" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p class="first">The authorization server presents a _protection <a href="#id295"><span class="problematic" id="id296">API_</span></a> to the
resource server, which encompasses the resource registration API
defined by the OAuth introduction specification
[OAuth-resource-reg], as well as additional functions standardized
by this specification.</p>
<p>This API is OAuth-protected,
requiring a resource server to obtain from the authorization server an OAuth
access token called a _protection API token (PAT)_.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="api-aat">
<h4><a class="toc-backref" href="#id154">認可API(AAT)</a><a class="headerlink" href="#api-aat" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p class="first">The authorization server presents an _authorization <a href="#id297"><span class="problematic" id="id298">API_</span></a> to the
client, as defined wholly by this specification.</p>
<p>This API is OAuth-protected,
requiring a client and its requesting party to obtain
from the authorization server an OAuth access token,
referred to in this specification
as an _authorization API token (AAT)_
to distinguish it from other tokens with other purposes.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="api-rpt">
<h4><a class="toc-backref" href="#id155">リソースAPI(RPT)</a><a class="headerlink" href="#api-rpt" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p class="first">The resource server presents a _protected <a href="#id299"><span class="problematic" id="id300">resource_</span></a> to the client,
which can be considered an application-specific or proprietary API.</p>
<p>This API is protected by the UMA profile of OAuth, requiring
a client to obtain from the authorization server an OAuth access token,
referred to in this specification as a _requesting party token (RPT)_
to distinguish it from other tokens with other purposes.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="oauth">
<h4><a class="toc-backref" href="#id156">標準OAuth エンドポイント</a><a class="headerlink" href="#oauth" title="Permalink to this headline">¶</a></h4>
<p>The authorization server presents standard OAuth endpoints
for token issuance and resource owner authorization
in protecting its own UMA APIs, as follows.</p>
<p>Resource servers asking to use the protection API would be issued a PAT.
Clients and requesting parties asking to use the authorization API would be issued an AAT.</p>
<dl class="glossary docutils">
<dt id="term-token-endpoint">token endpoint</dt>
<dd><p class="first">Part of standard OAuth, as profiled by UMA.</p>
<p class="last">The endpoint at which the resource server asks for a PAT on the
resource owner&#8217;s behalf.  Also the endpoint at which the client
asks for an AAT on the requesting party&#8217;s behalf.  (The
authorization server may also choose to issue a refresh token.)
This specification makes the OAuth token profile &#8220;bearer&#8221;
mandatory for the authorization server to implement.  It can
declare its ability to handle other token profiles.</p>
</dd>
<dt id="term-user-authorization-endpoint">user authorization endpoint</dt>
<dd>Part of standard OAuth, as profiled by UMA;
used when the authorization code grant type (REQUIRED for
the authorization server to implement) is being used.  The
endpoint to which the resource server redirects an end-user
resource owner to authorize the former to use this
authorization server in outsourcing resource protection.  Also
the endpoint to which the client redirects the end-user
requesting party to authorize the former to use this
authorization server in seeking access.</dd>
</dl>
</div>
<div class="section" id="id7">
<h4><a class="toc-backref" href="#id157">リソースサーバー向けエンドポイント</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>The authorization server presents the following endpoints
to the resource server as part of its protection API;
these endpoints MUST be OAuth-protected and require a PAT for access,
for which the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221;
OAuth scope is required:</p>
<dl class="glossary docutils">
<dt id="term-resource-set-registration-endpoint">resource set registration endpoint</dt>
<dd><p class="first">The endpoint at which the
resource server registers resource sets it wants the
authorization server to protect, as defined by
<a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>.</p>
<p class="last">The &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope
is a superset of the scope that governs usage of the resource
set registration endpoint.</p>
</dd>
<dt id="term-permission-registration-endpoint">permission registration endpoint</dt>
<dd>The endpoint at which
the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> registers permissions that
it anticipates a client will shortly be asking for from the authorization server.</dd>
<dt id="term-introspection-endpoint">introspection endpoint</dt>
<dd><p class="first">The endpoint at which the resource server
forwards an RPT that has accompanied an access request to learn
what authorization data is associated with it, as defined by
<a class="reference internal" href="#term-147"><em class="xref std std-term">[OAuth-introspection]</em></a>.</p>
<p>This specification defines an RPT profile, &#8220;bearer&#8221;,
which is mandatory for the authorization
server to implement and which, if used, REQUIRES the resource
server to use this endpoint (see <em class="xref std std-ref">Section 3.3</em>).</p>
<p class="last">The &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope
is a superset of the scope that governs usage of the token
introspection endpoint.</p>
</dd>
</dl>
</div>
<div class="section" id="id8">
<h4><a class="toc-backref" href="#id158">クライアント向けエンドポイント</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>The authorization server presents the following endpoints
to the client as part of its authorization API;
these endpoints are OAuth-protected and require an AAT for access,
for which the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authorization">http://docs.kantarainitiative.org/uma/scopes/authorization</a>&#8221;
OAuth scope is required:</p>
<dl class="glossary docutils">
<dt id="term-rpt-endpoint">RPT endpoint</dt>
<dd>The endpoint at which the client asks the authorization
server for the issuance of an RPT relating to this requesting
party, resource server, and authorization server.</dd>
<dt id="term-permission-request-endpoint">permission request endpoint</dt>
<dd>The endpoint at which the client asks
for authorization data to be associated with an RPT to enable
authorized access.</dd>
</dl>
</div>
<div class="section" id="id9">
<h4><a class="toc-backref" href="#id159">リソースサーバーのクライアント向けエンドポイント</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>The resource server presents one or more protected resource endpoints
to the client;
these endpoints are protected by the UMA profile of OAuth and
require an RPT with sufficient authorization data to permit access:</p>
<dl class="glossary docutils">
<dt id="term-protected-resource-endpoint">protected resource endpoint</dt>
<dd>An application-specific endpoint at
which a client attempts to access resources.
This can be a singular API endpoint, one of a set of API endpoints,
a URI corresponding to an HTML document, or any other URI.</dd>
</dl>
</div>
<div class="section" id="id10">
<h4><a class="toc-backref" href="#id160">トークン管理</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>The authorization server has the opportunity to manage the validity
periods of the access tokens, the corresponding refresh tokens where applicable,
and even the client credentials that it issues.</p>
<p>Different lifetime strategies may be suitable for different resources
and scopes of access, and the authorization server has the
opportunity to give the resource owner control through policy.</p>
<p>These options are all outside the scope of this specification.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.3</a> )</p>
</div>
</div>
<div class="section" id="scopes-resource-sets-permissions-and-authorization">
<span id="uma-core-1-4"></span><h3><a class="toc-backref" href="#id161">1.4.  Scopes, Resource Sets, Permissions, and Authorization</a><a class="headerlink" href="#scopes-resource-sets-permissions-and-authorization" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id11">
<h4><a class="toc-backref" href="#id162">リソースセットとスコープタイプ</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>UMA extends the OAuth concept of a &#8220;scope&#8221; by defining <em class="xref std std-term">scope types</em>
as applying to labeled resource sets,
rather than leaving the relevant resources
(such as API endpoints or URIs) implicit.</p>
<p>A resource set can have any number of scope types,
which together describe the universe of actions that _can <a href="#id301"><span class="problematic" id="id302">be_</span></a> taken
on this protected resource set.</p>
<p>For example,
a resource set representing a status update API might have scopes
that include adding an update or reading updates.
A resource set representing a photo album might have scopes that
include viewing a slideshow or printing the album.
Resource servers register resource sets and their scope types
when there is not yet any particular requesting party or client in the picture.</p>
<p>Resource sets and scope types have meaning only to resource servers
and their users,
in the same way that application-specific protected resource APIs
have meaning only to these entities.
The authorization server is merely a conveyor of labels and
descriptions for these constructs,
to help the resource owner set policies that guide eventual authorization processes.</p>
</div>
<div class="section" id="id12">
<h4><a class="toc-backref" href="#id163">パーミッション</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>A permission, in contrast to a <a class="reference internal" href="#term-92"><em class="xref std std-term">scope type</em></a>,
reflects an _actual_ entitlement to access a <a class="reference internal" href="#term-90"><em class="xref std std-term">resource set</em></a>
using one or more scope types,
as the result of an authorization process undergone by a specific <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a>.</p>
<p>A <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> registers a <em class="xref std std-term">permission request</em>
with an authorization server on behalf of a client
(and its requesting parties)
that has attempted access,
and transmits the resulting <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a> to the <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a>.</p>
<p>The client subsequently asks the authorization server for <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a>
to be associated with its RPT.
If the <em class="xref std std-term">RPT profile</em> is in use,
the authorization server grants (or denies) the permission to the requesting party.
(If another token profile is in use,
the authorization server might generate a different type of authorization data,
such as an authorization decision or a package of the claims it has collected.)</p>
<p>An RPT is bound to a requesting party,
the client being used by that party,
the resource server at which protected resources of interest reside,
and the authorization server that protects those resources.</p>
<p>It becomes associated with as many pieces of authorization data
as are appropriate for gaining authorized access to resources protected
at that resource server by any single authorization server
(even if that data applies to resources managed by two or more different
resource owners at the same resource server using the same authorization server).</p>
<p>In the case of the UMA &#8220;bearer&#8221; token profile,
each individual permission is associated with the resource owner
whose policies drove the authorization process.
This enables meaningful, auditable, and potentially legally enforceable authorization
for access (see <a class="reference internal" href="#term-155"><em class="xref std std-term">[UMA-obligations]</em></a>).</p>
<p>Permissions have a validity period that the authorization server has
the opportunity to control (independently or with input from the resource owner).
These control options are outside the scope of this specification.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.4">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.4</a> )</p>
</div>
</div>
<div class="section" id="authorization-server-configuration-data">
<span id="uma-core-1-5"></span><h3><a class="toc-backref" href="#id164">1.5. Authorization Server Configuration Data</a><a class="headerlink" href="#authorization-server-configuration-data" title="Permalink to this headline">¶</a></h3>
<p>The authorization server MUST provide configuration data to other
entities it interacts with in aJSON [RFC4627] document that resides
in an /uma-configuration directory at at its hostmeta [RFC6415]
location.</p>
<p>The configuration data documents major conformance options
supported by the authorization server
(described further in <em class="xref std std-ref">Section 8</em>)
and protection and authorization API endpoints (as described in <em class="xref std std-ref">Section 1.3</em>).
(At the appropriate time, this section will instead profile
whatever self-describing metadata specification OAuth adopts,
for example, <a class="reference internal" href="#term-156"><em class="xref std std-term">[OAuth-linktypes]</em></a> or <a class="reference internal" href="#term-157"><em class="xref std std-term">[OAuth-meta]</em></a>.)</p>
<p>The configuration data has the following properties.
All endpoint URIs supplied SHOULD require the use of
a transport-layer security mechanism such as TLS.</p>
<dl class="glossary docutils">
<dt id="term-version">version</dt>
<dd>REQUIRED.  The version of the UMA core protocol to which this
authorization server conforms.  The value MUST be the string
&#8220;1.0&#8221;.</dd>
<dt id="term-issuer">issuer</dt>
<dd>REQUIRED.  A URI indicating the party operating the
authorization server.</dd>
<dt id="term-dynamic-client-endpoint">dynamic_client_endpoint</dt>
<dd>OPTIONAL.  The endpoint to use for performing dynamic client
registration through . [DynClientReg]</dd>
<dt id="term-oauth-token-profiles-supported">oauth_token_profiles_supported</dt>
<dd>REQUIRED.  PAT and AAT profiles produced by this authorization
server.  The property value is an array of string values.
Currently the only string value for this property defined by
this specification is &#8220;bearer&#8221;, corresponding to the OAuth
bearer token profile [OAuth-bearer].  The authorization server
is REQUIRED to support this profile, and to supply this string
value explicitly.  The authorization server MAY declare its
support for additional access token profiles by providing a
unique absolute URI in a string value in the array for each
one.</dd>
<dt id="term-uma-token-profiles-supported">uma_token_profiles_supported</dt>
<dd>REQUIRED.  RPT types produced by this authorization server.
The property value is an array of string values.  Currently the
only string value for this property defined by this
specification is &#8220;bearer&#8221;, whose associations the resource
server MUST determine through a token introspection interaction
with the authorization server (see Section 3.3 for the
definition of this profile).  The authorization server is
REQUIRED to support the UMA bearer token profile, and to supply
this string value explicitly.  The authorization server MAY
declare its support for RPTs using additional RPT profiles by
providing a unique absolute URI in a string value in the array
for each one.</dd>
<dt id="term-oauth-grant-types-supported">oauth_grant_types_supported</dt>
<dd>REQUIRED.  OAuth grant types supported by this authorization
server in issuing PATs and AATs.  The property value is an
array of string values.  Each string value MUST be one of the
grant_type values defined in [OAuth2], or alternatively an
extension grant type indicated by a unique absolute URI.</dd>
<dt id="term-claim-profiles-supported">claim_profiles_supported</dt>
<dd>OPTIONAL.  Claim formats and associated sub-protocols for
gathering claims from requesting parties, as supported by this
authorization server.  The property value is an array of string
values.  Currently the only string value for this property
defined by this specification is &#8220;openid&#8221;, for which details
are supplied in Section 3.5.1.1.  The authorization server MAY
declare its support for additional claim profiles by assigning
a unique absolute URI in a string value in the array for each
one.</dd>
<dt id="term-29">token_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server or
client asks the authorization server for a PAT or AAT,
respectively.  A requested scope of
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221;
results in a PAT.  A requested scope of
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authorization">http://docs.kantarainitiative.org/uma/scopes/authorization</a>&#8221;
results in an AAT.  Available HTTP methods are as defined by
[OAuth2] for a token endpoint.</dd>
<dt id="term-user-endpoint">user_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
gathers the consent of the end-user resource owner or the
client gathers the consent of the end-user requesting party, if
the &#8220;authorization_code&#8221; grant type is used.  Available HTTP
methods are as defined by [OAuth2] for an end-user
authorization endpoint.</dd>
<dt id="term-31">permission_registration_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
registers permissions with the authorization server for which a
client will be seeking authorization on its requesting party&#8217;s
behalf (see Section 3.2).  A PAT MUST accompany requests to
this protected endpoint.</dd>
<dt id="term-32">rpt_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the client ask the
authorization server for an RPT.  An AAT token MUST accompany
requests to this protected endpoint.</dd>
<dt id="term-rpt-status-endpoint">rpt_status_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
introspects an RPT presented to it by a client (see
Section 3.3).  A PAT MUST accompany requests to this protected
endpoint.</dd>
<dt id="term-34">permission_request_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the client asks, on its
requesting party&#8217;s behalf, to have authorization data
associated with its RPT.  An AAT MUST accompany requests to
this protected endpoint.</dd>
</dl>
<p>Example of authorization server configuration data that resides at
<a class="reference external" href="https://example.com/.well-known/uma-configuration">https://example.com/.well-known/uma-configuration</a> (note the use of
https: for endpoints throughout):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
<span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="s2">&quot;issuer&quot;</span><span class="o">:</span><span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
<span class="s2">&quot;dynamic_client_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/dyn_client_reg_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;oauth_token_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;bearer&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;uma_token_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;bearer&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;oauth_grant_types_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;authorization_code&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;claim_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;openid&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;token_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/token_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;user_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/user_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;resource_set_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/rsrc_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;rpt_status_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/status_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;permission_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/perm_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;rpt_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/client/rpt_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;permission_request_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/client/perm_uri&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Authorization server configuration data MAY contain extension
properties that are not defined in this specification.  Extension
names that are unprotected from collisions are outside the scope of
the current specification.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.5">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.5</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-2" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="protecting-a-resource">
<h2><a class="toc-backref" href="#id165">2. Protecting a Resource</a><a class="headerlink" href="#protecting-a-resource" title="Permalink to this headline">¶</a></h2>
<p>Phase 1 of UMA is protecting a resource.</p>
<p>The resource owner,
resource server, and authorization server perform the following steps
to successfully complete Phase 1
(assuming that the resource server has discovered the authorization server&#8217;s configuration data
and endpoints as needed):</p>
<blockquote>
<div><ul>
<li><p class="first">The resource server and authorization server establish mutual
trust through the issuance of client credentials to the resource
server.</p>
<p>It is OPTIONAL for the client credentials to be provided
dynamically through <a class="reference internal" href="#term-161"><em class="xref std std-term">[DynClientReg]</em></a>);
alternatively, they MAY use a static process.</p>
</li>
<li><p class="first">The resource owner, resource server, and authorization server
establish three-way trust through the issuance of a PAT.</p>
<p>See <em class="xref std std-ref">Section 2.1</em> for additional details.</p>
</li>
<li><p class="first">The resource server registers any resource sets with the
authorization server that are intended to be protected.</p>
<p>See <em class="xref std std-ref">Section 2.2</em> for additional details.</p>
</li>
</ul>
</div></blockquote>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-2-1" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="resource-server-obtains-pat">
<h3><a class="toc-backref" href="#id166">2.1. Resource Server Obtains PAT</a><a class="headerlink" href="#resource-server-obtains-pat" title="Permalink to this headline">¶</a></h3>
<p>In this step,
the resource server acquires a PAT from the authorization server.</p>
<p>The token represents the approval of the
resource owner for this resource server to trust this authorization
server for protecting resources belonging to this resource owner.  It
is OPTIONAL for the resource owner to introduce the resource server
to the authorization server dynamically through the process defined
in <a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>);
alternatively,
they MAY use a static process that may or may not directly
involve the resource owner at introduction time.</p>
<p>The resource server MUST use OAuth 2.0 [OAuth2] to obtain the PAT.</p>
<p>Here the resource server acts in the role of an OAuth client
requesting the
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope, which
authorizes it to use the authorization server&#8217;s resource set
registration endpoint (as defined in <a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>)
as well as additional protection API endpoints.</p>
<p>Once the resource server has obtained its PAT,
it presents it to the authorization server at
various protection API endpoints.</p>
<p>(NOTE: The &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221;
scope keyword is a URI that resolves to a JSON-encoded scope
description, in the fashion of UMA scope types.  This scope
description is non-normative.)</p>
<p>The authorization server MAY support the use of any OAuth grant type for PAT issuance,
but MUST support the authorization_code grant type,
and SHOULD support the SAML bearer token grant type [OAuth-SAML]
(<a class="reference external" href="urn:ietf:params:oauth:grant-type:saml2-bearer">urn:ietf:params:oauth:grant-type:saml2-bearer</a>) if it anticipates
working with resource servers that are operating in environments
where the use of SAML is prevalent.  The authorization server MUST
indicate all grant types it supports for PAT issuance in its
configuration data.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.1</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-2-2" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="resource-server-registers-sets-of-resources-to-be-protected">
<h3><a class="toc-backref" href="#id167">2.2. Resource Server Registers Sets of Resources to Be Protected</a><a class="headerlink" href="#resource-server-registers-sets-of-resources-to-be-protected" title="Permalink to this headline">¶</a></h3>
<p>Once the resource server has received a PAT,
for any of the resource owner&#8217;s sets of resources that are to be protected by this
authorization server, it registers these resource sets in a timely fashion.
To do this, the resource server uses the resource set registration API defined in <a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>.</p>
<p>Note: The resource server is free to offer the option to protect any
subset of the resource owner&#8217;s resources using different
authorization servers or other means entirely, or to protect some
resources and not others.  Additionally, the choice of protection
regimes can be made explicitly by the resource owner or implicitly by
the resource server.  Any such partitioning by the resource server or
owner is outside the scope of this specification.</p>
<p>On successfully registering a resource set, the RS MUST use access
control mechanisms to limit access to any resources corresponding to
this resource set, relying on the AS to supply currently valid
permissions for authorized access.  The RS MUST outsource protection
to the AS according to the currently registered state of a resource
set.  This requirement holds true so long as the RS has one or more
registsred resource sets.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.2</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-3" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="getting-authorization-and-accessing-a-resource">
<h2><a class="toc-backref" href="#id168">3. Getting Authorization and Accessing a Resource</a><a class="headerlink" href="#getting-authorization-and-accessing-a-resource" title="Permalink to this headline">¶</a></h2>
<p>Phase 2 of UMA is getting authorization,
and phase 3 is accessing a resource.</p>
<p>In these phases,
an authorization server orchestrates and controls clients&#8217; access
(on their requesting parties&#8217; behalf)
to a resource owner&#8217;s protected resources at a resource server,
under conditions dictated by that resource owner.</p>
<p>Phase 3 is merely the successful completion of a client&#8217;s access attempt
that initially involved several embedded interactions among the <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a>,
<a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a>, <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>,
and <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> in phase 2.</p>
<p>Phase 2 always begins with the <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a> attempting access
at a <a class="reference internal" href="#term-103"><em class="xref std std-term">protected resource endpoint</em></a> at the resource server.
How the client came to learn about this endpoint is out of scope for this specification.
The resource owner might, for example,
have advertised its availability publicly on a blog or other website,
listed it in a discovery service, or emailed a link to a particular
intended requesting party.</p>
<p>The resource server responds to the client&#8217;s access request in one of
several ways depending on the circumstances of the request,
either immediately or having first performed one or more embedded
interactions with the authorization server.
Depending on the nature of the resource server&#8217;s response to an failed access attempt,
the client and its operator engage in embedded interactions
with the authorization server before re-attempting access.</p>
<p>The interactions are as follows.</p>
<p>Each interaction MAY be the last,
if the client chooses not to continue pursuing the access attempt or
the resource server chooses not to continue facilitating it.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The client attempts access at a particular protected resource at
a resource server (see <em class="xref std std-ref">Section 3.1</em>).</p>
<ol class="upperalpha">
<li><p class="first">If the access attempt is unaccompanied by an RPT,
the resource server responds immediately with an HTTP 401
(Unauthorized) response and instructions on where to go to
obtain one (see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>(RPTなし)</p>
</li>
<li><p class="first">If the access attempt was accompanied by an RPT,
the resource server checks the RPT&#8217;s status (see <em class="xref std std-ref">Section 3.3</em>).</p>
<ol class="arabic">
<li><p class="first">If the RPT is invalid
(for example, it is not applicable
to this resource server), the resource server responds to
the client with an HTTP 401 (Unauthorized) response and
instructions on where to go to obtain a token
(see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>(不正なRPT)</p>
</li>
<li><p class="first">If the RPT is valid but has insufficient permission,
the resource server registers a suitable permission request
on the client&#8217;s behalf at the authorization server
(see <em class="xref std std-ref">Section 3.2</em>),
and then responds to the client with an
HTTP 403 (Forbidden) response and instructions on where
to go to ask for authorization (see <em class="xref std std-ref">Section 3.1.2</em>).</p>
<p>(パーミッションが無いRPT)</p>
</li>
<li><p class="first">If the RPT is valid, and if the <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a>
associated with the token is consistent with allowing access,
the resource server responds to the client&#8217;s
access attempt with an HTTP 200 (OK) response and a
representation of the resource (see <em class="xref std std-ref">Section 3.1.3</em>).</p>
<p>(正常返答)</p>
</li>
</ol>
</li>
</ol>
</li>
<li><p class="first">If the client (possessing no RPT or an invalid RPT) received a
401 response and an RPT endpoint, it then requests an RPT from
that endpoint (see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>( 401の場合,RPT取り直し )</p>
</li>
<li><p class="first">If the client (posessing a valid RPT) received a 403 response and
a <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a>,
it then asks the authorization server for authorization data
that matches the ticket (<em class="xref std std-ref">Section 3.4.3</em>).</p>
<p>(パーミッション要求 )</p>
<p>If the authorization server needs requesting party claims
in order to assess this client&#8217;s authorization,
it engages in a claims-gathering flow with the requesting party
(see <em class="xref std std-ref">Section 3.5</em>).</p>
<p>(クレーム要求)</p>
<ol class="upperalpha">
<li><p class="first">If the client does not already have an AAT at the appropriate
authorization server to be able to use its permission request
endpoint, it first obtains one (see <em class="xref std std-ref">Section 3.4.1</em>).</p>
<p>(AATがない)</p>
</li>
</ol>
</li>
</ol>
</div></blockquote>
<p>The interactions are described in detail in the following sections.</p>
<p>(draft 06 , <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-3-1" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="client-attempts-to-access-protected-resource">
<h3><a class="toc-backref" href="#id169">3.1. Client Attempts to Access Protected Resource</a><a class="headerlink" href="#client-attempts-to-access-protected-resource" title="Permalink to this headline">¶</a></h3>
<p>This interaction assumes that
the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> has previously registered with an <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>
one or more <a class="reference internal" href="#term-91"><em class="xref std std-term">resource sets</em></a> that correspond to the resource
to which access is being attempted,
such that the resource server considers this resource to be protected
by a particular authorization server.</p>
<p>The client typically attempts to access the desired resource
at the resource server directly
(for example,
when an end-user requesting party clicks on a thumbnail representation of the resource).</p>
<p>The client is expected to discover,
or be provisioned or configured with,
knowledge of the protected resource and its location out of band.</p>
<p>Further,
the client is expected to acquire its own knowledge about
the application-specific methods made available by the resource
server for operating on this protected resource (such as viewing it
with a GET method,
or transforming it with some complex API call) and the possible scopes of access.</p>
<p>Example of a request carrying no RPT:</p>
<div class="highlight-python"><pre>GET /album/photo.jpg HTTP/1.1
Host: photoz.example.com
...</pre>
</div>
<p>Example of a request carrying an RPT using the UMA &#8220;bearer&#8221; token profile:</p>
<div class="highlight-python"><pre>GET /album/photo.jpg HTTP/1.1
Authorization: Bearer vF9dft4qmT
Host: photoz.example.com
...</pre>
</div>
<p>The resource server responds in one of the following ways.</p>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-3-1-1" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="client-presents-no-rpt">
<h4><a class="toc-backref" href="#id170">3.1.1. Client Presents No RPT</a><a class="headerlink" href="#client-presents-no-rpt" title="Permalink to this headline">¶</a></h4>
<p>If the client does not present any access token with the request,
the resource server MUST return an HTTP 401 (Unauthorized) status code,
along with providing the authorization server&#8217;s URI in an &#8220;as_uri&#8221;</p>
<blockquote>
<div><p>property to facilitate authorization server configuration data
discovery, including discovery of the endpoint where the client can
request an RPT (Section 3.4.2).</p>
<p>For example:</p>
<dl class="docutils">
<dt>HTTP/1.1 401 Unauthorized</dt>
<dd><dl class="first docutils">
<dt>WWW-Authenticate: UMA realm=&#8221;example&#8221;,</dt>
<dd>host_id=&#8221;photoz.example.com&#8221;,
as_uri=&#8221;<a class="reference external" href="http://am.example.com">http://am.example.com</a>&#8220;</dd>
</dl>
<p class="last">...</p>
</dd>
</dl>
</div></blockquote>
<p>( draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.1</a> )</p>
</div>
<div class="section" id="client-presents-an-rpt-that-has-insufficient-authorization-data">
<span id="uma-core-3-1-2"></span><h4><a class="toc-backref" href="#id171">3.1.2. Client Presents an RPT That Has Insufficient Authorization Data</a><a class="headerlink" href="#client-presents-an-rpt-that-has-insufficient-authorization-data" title="Permalink to this headline">¶</a></h4>
<p>If the client presents an RPT with its request, the resource server
SHOULD determine the RPT&#8217;s status (see <em class="xref std std-ref">Section 3.3</em>).</p>
<p>If the RPT is invalid,
the resource server redirects the client to the RPT endpoint
at the authorization server to obtain a correct RPT (see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>If the RPT is valid but has insufficient permission for the type of access sought,
the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> SHOULD register a <a class="reference internal" href="#term-94"><em class="xref std std-term">permission</em></a> with the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>
that would suffice for that scope of access (see <em class="xref std std-ref">Section 3.2</em>),
and then respond to the client with the HTTP 403 (Forbidden) status code,
along with providing the authorization server&#8217;s URI in the header of the message
and the permission ticket it just received from the authorization server in the body in JSON form.</p>
<p>Example of the host&#8217;s response:</p>
<div class="highlight-python"><pre>HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  as_uri="http://am.example.com"
  error="insufficient_scope"

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>( <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.2</a> )</p>
</div>
<div class="section" id="client-presents-a-valid-rpt-with-sufficient-authorization-data">
<span id="uma-core-3-1-3"></span><h4><a class="toc-backref" href="#id172">3.1.3. Client Presents a Valid RPT with Sufficient Authorization Data</a><a class="headerlink" href="#client-presents-a-valid-rpt-with-sufficient-authorization-data" title="Permalink to this headline">¶</a></h4>
<p>If the RPT&#8217;s status is associated with authorization data
that is consistent with authorized access of the scope sought
by the client (see <em class="xref std std-ref">Section 3.3</em>),
the resource server MUST give access to the desired resource.</p>
<p>Example of the resource server&#8217;s response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb</pre>
</div>
<p>This response constitutes the conclusion of Phase 3 of UMA.</p>
<p>The resource server MUST NOT give access
where the token&#8217;s status is not associated with sufficient authorization data
for the attempted scope of access.</p>
<p>( draft 06,  <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.3</a> )</p>
<div class="section" id="requester-s-token-has-insufficient-permission">
<span id="uma-core-3-1-3-1"></span><h5><a class="toc-backref" href="#id173">3.1.3.1.  Requester&#8217;s Token Has Insufficient Permission</a><a class="headerlink" href="#requester-s-token-has-insufficient-permission" title="Permalink to this headline">¶</a></h5>
<p>If the <a class="reference internal" href="glossary.html#term-token-status"><em class="xref std std-term">token status</em></a> is not associated with any currently valid <a class="reference internal" href="#term-94"><em class="xref std std-term">permission</em></a>
that applies to the <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> of access attempted by the <em class="xref std std-term">requester</em>,
the <a class="reference internal" href="discovery.html#term-host"><em class="xref std std-term">Host</em></a> SHOULD register a <a class="reference internal" href="#term-94"><em class="xref std std-term">permission</em></a> with the <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a>
(see <em class="xref std std-ref">Section 3.4</em>) that would suffice for that scope of access,
and then respond to the <em class="xref std std-term">requester</em> with the HTTP 403 (Forbidden) status code,
along with providing the AM&#8217;s URI in the header of the message and
the <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a> it just received from the <strong>AM</strong> in the body of the JSON form.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  am_uri="http://am.example.com"

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">Host register a permmision. (<em class="xref std std-ref">uma_core.3.4</em> )</p>
</li>
<li><p class="first">Host get a ticket from AM for a permission registration. ( ticket is a JSON in response body from AM )</p>
</li>
<li><p class="first">Host return the ticket to the request in HTTP 403 for the resource request. ( described in this section)</p>
</li>
<li><p class="first">Requester ask AM to get access token with the ticket and other information(<em class="xref std std-ref">uma_core.3.5</em> )</p>
<blockquote>
<div><ul class="simple">
<li>AM check the policy for the requester and its request with claims (<a class="reference internal" href="#uma-core-3-6"><em>3.6.  Authorization Flows</em></a> )</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>&#8220;A Requester has a valid access token&#8221; means that &#8220;Authrizing User allowed the reuqester to access a resource in the Host&#8221;</li>
<li>So &#8220;Host&#8221; may register permission to the scope on &#8220;AM&#8221; for the &#8220;Requester&#8221;.  This is proved by the &#8220;Ticket&#8221;</li>
<li>If the &#8220;Requester&#8221; provides a valid &#8220;Ticket&#8221; for the &#8220;Token&#8221;.  the &#8220;AM&#8221; issues a new token (Updated Token)</li>
</ul>
</div>
<p>(draft 03)</p>
</div>
<div class="section" id="requester-s-token-has-sufficient-permission">
<span id="uma-core-3-1-3-2"></span><h5><a class="toc-backref" href="#id174">3.1.3.2.  Requester&#8217;s Token Has Sufficient Permission</a><a class="headerlink" href="#requester-s-token-has-sufficient-permission" title="Permalink to this headline">¶</a></h5>
<p>If the token status is associated with at least one currently valid
permission that applies to the scope of access attempted by the
requester, the host MUST give access to the desired resource.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb</pre>
</div>
<p>This response constitutes the conclusion of Phase 3 of UMA.</p>
<p>The host MUST NOT give access where the token&#8217;s status is not
associated with at least one currently active permission hat suffices
for that scope of access.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
<table class="docutils field-list" frame="void" id="uma-core-3-2" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="resource-server-registers-a-permission-with-authorization-server">
<h3><a class="toc-backref" href="#id175">3.2. Resource Server Registers a Permission With Authorization Server</a><a class="headerlink" href="#resource-server-registers-a-permission-with-authorization-server" title="Permalink to this headline">¶</a></h3>
<p>In response to receiving an access request accompanied by an RPT that
is invalid or has insufficient authorization data,
the resource server SHOULD register a permission with the authorization server
that would be sufficient for the type of access sought.
The authorization server returns a permission ticket for the resource
server to give to the client in its response.</p>
<p>The permission ticket is a short-lived opaque structure whose form is
determined by the authorization server.
The ticket value MUST be securely random
(for example, not merely part of a predictable sequential series),
to avoid denial-of-service attacks.</p>
<p>Since the ticket is an opaque structure from the point of view of the client,
the authorization server is free to include information regarding expiration time
within the opaque ticket for its own consumption.
When the client subsequently asks the authorization server for authorization data
to be associated with its RPT,
it will submit this ticket to the authorization server.</p>
<p>The <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> registers the <a class="reference internal" href="#term-94"><em class="xref std std-term">permission</em></a>
using the POST method at the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>&#8216;s <a class="reference internal" href="#term-99"><em class="xref std std-term">permission registration endpoint</em></a>.
The resource server MUST provide its valid <strong>PAT</strong> in order to get access to this endpoint.</p>
<p>The body of the HTTP request message contains a JSON document providing the <em class="xref std std-term">requested permission</em>.</p>
<p>The <a class="reference internal" href="glossary.html#term-requested-scope"><em class="xref std std-term">requested scope</em></a> is an object with the name &#8220;requested_permission&#8221;
and the following properties:</p>
<blockquote>
<div><dl class="docutils">
<dt>resource_set_id</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">The identifier for a resource set, access
to which this client is seeking access.  The identifier MUST
correspond to a resource set that was previously registered.</p>
</dd>
<dt>scopes</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">An array referencing one or more identifiers of
scope types to which access is needed for this resource set.  Each
scope type identifier MUST correspond to a scope type that was
registered by this resource server for the referenced resource
set.</p>
</dd>
</dl>
</div></blockquote>
<div class="section" id="id13">
<h4><a class="toc-backref" href="#id176">サンプル</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id14">
<h5><a class="toc-backref" href="#id177">リクエスト</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h5>
<p>Example of an HTTP request that registers a permission at the
authorization server&#8217;s <a class="reference internal" href="#term-99"><em class="xref std std-term">permission registration endpoint</em></a>:</p>
<div class="highlight-python"><pre>POST /host/scope_reg_uri/photoz.example.com HTTP/1.1
Content-Type: application/json
Host: am.example.com

{
  "resource_set_id": "112210f47de98100",
  "scopes": [
      "http://photoz.example.com/dev/actions/view",
      "http://photoz.example.com/dev/actions/all"
  ]
}</pre>
</div>
</div>
<div class="section" id="id15">
<h5><a class="toc-backref" href="#id178">レスポンス</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h5>
<p>If the registration request is successful,
the authorization server responds with an <strong>HTTP 201 (Created)</strong> status code
and includes the <em class="xref std std-term">Location header</em> in its response
as well as the &#8220;ticket&#8221; property in the JSON-formatted body.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-permission-ticket+json
Location: https://am.example.com/permreg/host/photoz.example.com/5454345rdsaa4543
...

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><strong>Location</strong> ヘッダーで Client(最終的にticketが渡される)がパーミッション要求するURLを返答すること!</li>
<li><a class="reference external" href="http://bitly.com/bundles/hdknr/v">http://bitly.com/bundles/hdknr/v</a></li>
</ul>
</div>
</div>
<div class="section" id="id16">
<h5><a class="toc-backref" href="#id179">エラー応答</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
<p>If the registration request is authenticated properly but fails due
to other reasons,
the authorization server responds with an HTTP 400 (Bad Request) status code
and includes one of the following UMA error
codes (see <em class="xref std std-ref">Section 4.2</em>):</p>
<dl class="glossary docutils">
<dt id="term-invalid-resource-set-id">invalid_resource_set_id</dt>
<dd>The provided resource set identifier was not
found at the authorization server.</dd>
<dt id="term-invalid-scope">invalid_scope</dt>
<dd>At least one of the scopes included in the request was
not registered previously by this resource server.</dd>
</dl>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.2</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-3-3" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="resource-server-determines-the-rpt-status">
<h3><a class="toc-backref" href="#id180">3.3. Resource Server Determines the RPT Status</a><a class="headerlink" href="#resource-server-determines-the-rpt-status" title="Permalink to this headline">¶</a></h3>
<p>On receiving an RPT,
the resource server MUST ascertain its status before granting or denying access to the client.
An RPT is associated with a set of authorization data that governs
whether the client is authorized for access.</p>
<p>The token&#8217;s nature and format are dictated by its profile;
the profile might allow it to be self-contained,
such that the resource server is able to ascertain its status locally,
or might require or allow the resource server to make a run-time introspection request of the authorization server that
issued the token using [OAuth-introspection].</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>アサーションにする</li>
<li>イントロスペクトする</li>
</ul>
</div>
<p>This specification makes one type of RPT mandatory to implement:
the UMA bearer token profile, as defined in <em class="xref std std-ref">Section 3.3.1</em>.
Alternate RPT profiles MAY define their own unique token formats and MAY require,
allow, or prohibit use of the token introspection endpoint.</p>
<p>(draft 06:<a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.3</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-3-3-1" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="uma-bearer-token-profile">
<h4><a class="toc-backref" href="#id181">3.3.1. UMA Bearer Token Profile</a><a class="headerlink" href="#uma-bearer-token-profile" title="Permalink to this headline">¶</a></h4>
<p>This section defines the format and protocol requirements
for the UMA bearer token profile.</p>
<p>An authorization server MUST support the UMA bearer token profile
and MUST indicate its support in the &#8220;uma_token_profiles_supported&#8221; property
in its configuration data (see Section 1.5).</p>
<p>On receiving an RPT of the &#8220;Bearer&#8221; type in an authorization header
from a client making an access attempt,
the resource server MUST use the authorization server&#8217;s token introspection endpoint
[OAuth-introspection] to retrieve the RPT&#8217;s associated authorization data.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>authz のイントロスペクションエンドポイントで認可データをもらう</li>
</ul>
</div>
<p>In order to ask the authorization server for an RPT&#8217;s status,
the host makes the request to the authorization server with a POST
request to the authorization server&#8217;s token introspection endpoint.
The body of the HTTP request message contains a JSON document
providing the RPT.  The host MUST provide its own PAT in the request
in order to gain access to the RPT status endpoint.</p>
<p>Example of a request to the RPT status endpoint that provides the PAT
in the header:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer vF9dft4qmT
...

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
  "resource_set_id": "112210f47de98100",
  "host_id": "photoz.example.com"
}</pre>
</div>
<p>The authorization server returns the RPT&#8217;s status in an HTTP response
using the 200 OK status code, containing a JSON document supplying
the RPT&#8217;s associated permissions.  The RPT status description either
contains all of the permissions that are currently valid for this RPT
or indicates that the RPT is invalid (see Section 1.4).  The
authorization server MAY set a cache period for the returned RPT
status description that allows the host to reuse it over some period
of time when it later sees the same RPT.</p>
<p>The status description for a valid RPT is a JSON array of zero or
more permission objects, each with the following properties (this
needs to be synced up with the token introspection spec):</p>
<blockquote>
<div><dl class="docutils">
<dt>resource_set_id  REQUIRED.  A string that uniquely identifies the</dt>
<dd>resource set, access to which has been granted to this client on
behalf of this requesting party.  The identifier MUST correspond
to a resource set that was previously registered as protected.</dd>
<dt>scopes  REQUIRED.  An array referencing one or more URIs of scopes to</dt>
<dd>which access was granted for this resource set.  Each scope MUST
correspond to a scope that was registered by this host for the
referenced resource set.</dd>
<dt>exp  REQUIRED.  An integer representing the expiration time on or</dt>
<dd>after which the permission MUST NOT be accepted for authorized
access.  The processing of the exp property requires that the
current date/time MUST be before the expiration date/time listed
in the exp claim.  Host implementers MAY provide for some small
leeway, usually no more than a few minutes, to account for clock
skew.</dd>
</dl>
</div></blockquote>
<p>Example:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
...

[
  {
    "resource_set_id": "112210f47de98100",
    "scopes": [
      "http://photoz.example.com/dev/actions/view",
      "http://photoz.example.com/dev/actions/all"
    ],
    "exp": 1300819380
  }
]</pre>
</div>
<p>The token status description for an invalid RPT is a JSON structure, as follows.</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
...

{
  "rpt_status": "invalid"
}</pre>
</div>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.3.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.3.1</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-3-4" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="client-asks-authorization-server-for-rpt-and-authorization-data">
<h3><a class="toc-backref" href="#id182">3.4. Client Asks Authorization Server for RPT and Authorization Data</a><a class="headerlink" href="#client-asks-authorization-server-for-rpt-and-authorization-data" title="Permalink to this headline">¶</a></h3>
<p>A client making an access attempt accompanied by no RPT
or by an invalid RPT will receive a 401 response back from the resource server,
along with the authorization server&#8217;s location from which it can learn the RPT endpoint.</p>
<p>In this case,
the client must obtain a valid RPT from the authorization server&#8217;s RPT endpoint
provided in the response (see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>A client making an access attempt with a valid RPT
that has insufficient <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a>
associated with it will receive a 403 response back
from the resource server,
along with a <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a> and the authorization server&#8217;s location
from which it can learn the permission request endpoint.</p>
<p>In this case,
the client uses the <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a>
to ask for the necessary <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a> to be associated with its RPT.</p>
<p>This process necessarily involves the requesting party
because the authorization is sought on this party&#8217;s behalf.</p>
<p>The client takes action in the following ways
(assuming that it has discovered the authorization server&#8217;s configuration data and
endpoints as required):</p>
<blockquote>
<div><ul>
<li><p class="first">The client and authorization server establish mutual trust through
the issuance of <a class="reference internal" href="glossary.html#term-client-credentials"><em class="xref std std-term">client credentials</em></a> to the client.</p>
<p>It is OPTIONAL for the client credentials to be provided dynamically through
<a class="reference internal" href="#term-161"><em class="xref std std-term">[DynClientReg]</em></a> ); alternatively, they MAY use a static process.</p>
<p>(RPになるということ)</p>
</li>
<li><p class="first">The requesting party, client, and authorization server establish
three-way trust through the issuance of an AAT.</p>
<p>See <em class="xref std std-ref">Section 3.4.1</em> for additional details.</p>
<p>(AATを取得)</p>
</li>
<li><p class="first">The client obtains an RPT.</p>
<p>See <em class="xref std std-ref">Section 3.4.2</em> for additional details.</p>
<p>(RPTを取得)</p>
</li>
</ul>
</div></blockquote>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-3-4-1" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="client-obtains-aat">
<h4><a class="toc-backref" href="#id183">3.4.1. Client Obtains AAT</a><a class="headerlink" href="#client-obtains-aat" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OAuth セッション</li>
<li>End User = Requesting Party / User</li>
<li>scope = “<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authz.json">http://docs.kantarainitiative.org/uma/scopes/authz.json</a>”</li>
<li></li>
</ul>
</div>
<p>In this step,
the <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a> acquires an AAT from the authorization server
on the <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a>&#8216;s behalf.</p>
<p>The token represents the approval of this <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a> for this <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a>
to engage with this authorization server to supply claims,
ask for authorization,
and perform any other tasks needed for obtaining authorization
for access to resources at all resource servers that use this authorization server.</p>
<p>It is OPTIONAL for the requesting party to introduce the client
to the authorization server dynamically through the process defined in
<a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>);
alternatively, they MAY use a static process that does not directly involve the requesting party.</p>
<p>The client MUST use OAuth 2.0 <a class="reference internal" href="#term-149"><em class="xref std std-term">[OAuth2]</em></a> to obtain the AAT.
Here the client requests the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authz.json">http://docs.kantarainitiative.org/uma/scopes/authz.json</a>&#8221; scope.
Once the client has obtained its AAT,
it presents it to the authorization server at the <a class="reference internal" href="#term-102"><em class="xref std std-term">permission request endpoint</em></a>.</p>
<p>(NOTE: The &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authz.json">http://docs.kantarainitiative.org/uma/scopes/authz.json</a>&#8221;
scope keyword is a URI that resolves to a JSON-encoded scope
description, in the fashion of UMA scope types.
This scope description is non-normative.)</p>
<p>The authorization server MAY support the use of any OAuth grant type for AAT issuance,
but MUST support the <em class="xref std std-term">authorization_code grant type</em>,
and SHOULD support the <em class="xref std std-term">SAML bearer token grant type</em> <a class="reference internal" href="#term-162"><em class="xref std std-term">[OAuth-SAML]</em></a>
(<a class="reference external" href="urn:ietf:params:oauth:grant-type:saml2-bearer">urn:ietf:params:oauth:grant-type:saml2-bearer</a>)
if it anticipates working with clients that are operating in environments
where the use of SAML is prevalent.
The authorization server MUST indicate all grant types
it supports for AAT issuance in its configuration data.</p>
<p>By virtue of being able to identify this client/requesting party pair
uniquely across all resource servers whose resources it protects, the
authorization server is able to manage the process of authorization
and claims-gathering efficiently.  These management processes are
outside the scope of this specification.</p>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.1</a> )</p>
<table class="docutils field-list" frame="void" id="uma-core-3-4-2" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="client-asks-for-authorization-data">
<h4><a class="toc-backref" href="#id184">3.4.2.  Client Asks for Authorization Data</a><a class="headerlink" href="#client-asks-for-authorization-data" title="Permalink to this headline">¶</a></h4>
<p>Once in possession of an <em class="xref std std-term">AAT</em> for this authorization server,
an RPT that applies to this requesting party for this resource server
and this authorization server,
and a permission ticket,
the client asks the authorization server to give it suitable authorization data
for the sought-for access.</p>
<p>It performs a POST on the authorization request endpoint,
supplying its own AAT in the header and its <em class="xref std std-term">RPT</em> and the permission ticket
in a JSON object with properties &#8220;rpt&#8221; and ticket&#8221;, respectively.</p>
<p>Example of a request message containing an AAT, an RPT,
and a permission ticket:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: as.example.com
Authorization: Bearer jwfLG53^sad$#f
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>The authorization server uses the ticket to look up the details of
the previously registered requested permission, maps the requested
permission to operative resource owner policies based on the resource
set identifier and scopes in it, undergoes any claims-gathering flows
required (see Section 3.5), and ultimately responds to the request.
The resource owner&#8217;s policies at the authorization server amount to
an implicit authorization grant in governing the issuance of
authorization data.  (The authorization server is also free to enable
the resource owner to set policies that require the owner to provide
a run-time authorization grant in the form of a consent interaction,
mediated by the authorization server.  This setting of policies and
gathering of consent is outside the scope of this specification.)</p>
<p>The authorization server MUST base the addition of authorization data
to RPTs on user policies.  The nature of these policies is outside
the scope of UMA, but generally speaking, they can be thought of as
either independent of requesting-party features (for example, time of
day) or dependent on requesting-party features (for example, whether
they are over 18).  Such requesting-party features can potentially be
collected in a claims-gathering flow.  If the authorization server
does not add the requested authorization data, it responds using the
appropriate HTTP status code and UMA error code (see Section 4.2):</p>
<dl class="glossary docutils">
<dt id="term-invalid-ticket">invalid_ticket</dt>
<dd>The provided ticket was not found at the
authorization server.  The authorization server SHOULD respond
with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-expired-ticket">expired_ticket</dt>
<dd>The provided ticket has expired.  The authorization
server SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-not-authorized-permission-the-client-is-definitively-not-authorized">not_authorized_permission  The client is definitively not authorized</dt>
<dd>for this authorization according to user policy.  The
authorization server SHOULD respond with the HTTP 403 (Forbidden)
status code.</dd>
<dt id="term-need-claims">need_claims</dt>
<dd>The authorization server is unable to determine whether
the client is authorized for this permission without gathering
claims from the requesting party.  The authorization server SHOULD
respond with the HTTP 403 (Forbidden) status code.  The client is
therefore not authorized, but has the opportunity to engage its
operator &#8211; the requesting party &#8211; in a claims-gathering flow
with the authorization server (see Section 3.5) to continue
seeking authorization.</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_ticket"
}</pre>
</div>
<p>( draft 07, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07#section-3.4.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07#section-3.4.2</a> )</p>
</div>
<div class="section" id="uma-core-3-4-3">
<span id="id17"></span><h4><a class="toc-backref" href="#id185">3.4.3. Client Asks for Authorization Data</a><a class="headerlink" href="#uma-core-3-4-3" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>パーミションを要求</li>
<li>成功したら 200 OK が返る、って書いた方がいいんじゃない？</li>
</ul>
</div>
<p>Once in possession of an AAT for this authorization server,
an RPT that applies to this requesting party for this resource server
and this authorization server,
and a permission ticket,
the client asks the authorization server to give it suitable authorization data
for the sought-for access.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">Permission Request Endpoint でパーミッション要求する</p>
<blockquote>
<div><ul class="simple">
<li>AAT</li>
<li>RPT</li>
<li>permission ticket ( <em class="xref std std-ref">uma_core.3.2</em> )</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<p>The client performs a POST on the <a class="reference internal" href="#term-102"><em class="xref std std-term">permission request endpoint</em></a>,
supplying the items below.</p>
<p>The client MUST provide its own AAT in the header.</p>
<blockquote>
<div><ul class="simple">
<li>The <strong>permission ticket</strong> it received from the resource server</li>
<li>Its <em class="xref std std-term">RPT</em> for this resource server</li>
<li>Its own <em class="xref std std-term">AAT</em> in the header</li>
</ul>
</div></blockquote>
<p>Example of a request message containing a <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a> and RPT:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>In this interaction,
the client uses the authorization server&#8217;s <a class="reference internal" href="#term-102"><em class="xref std std-term">permission request endpoint</em></a>.</p>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> uses the <em class="xref std std-term">ticket</em> to look up the details of
the previously registered permission,
maps the requested permission to operative resource owner policies,
undergoes any authorization flows required (see <em class="xref std std-ref">Section 3.5</em>),
and ultimately responds to the request positively or negatively.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OK(200)かNG(401,400)を返す</li>
</ul>
</div>
<p>The resource owner&#8217;s policies at the authorization server amount
to an implicit authorization grant in governing the issuance of authorization data.
(The authorization server is also free to enable resource owners to set policies that
require them to provide a run-time explicit authorization grant mediated by the authorization server.
This setting of policies and gathering of authorization grants is outside the scope of this specification.)</p>
<p>If the request fails due to an invalid, missing, or expired AAT (or RPT)
or requires higher privileges at this endpoint than provided by the AAT,
the authorization server responds with an OAuth error (see <em class="xref std std-ref">Section 4.1</em>).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"</pre>
</div>
<p>If the authorization server does not add the requested authorization data,
it responds using the appropriate HTTP status code (typically 400 or 403),
and includes one of the following error codes in the response (see <em class="xref std std-ref">Section 4.2</em>):</p>
<blockquote>
<div><dl class="docutils">
<dt>invalid_requester_ticket  The provided ticket was not found at the</dt>
<dd>authorization server.  The authorization server SHOULD respond
with the HTTP 400 (Bad Request) status code.</dd>
<dt>expired_requester_ticket  The provided ticket has expired.  The</dt>
<dd>authorization server SHOULD respond with the HTTP 400 (Bad
Request) status code.</dd>
<dt>not_authorized_permission  The client is definitively not authorized</dt>
<dd>for this authorization according to user policy.  The
authorization server SHOULD respond with the HTTP 403 (Forbidden)
status code.</dd>
<dt>need_claims  The authorization server is unable to determine whether</dt>
<dd><p class="first">the client is authorized for this permission
without gathering claims from the requesting party.</p>
<p class="last">The authorization server SHOULD respond with the HTTP 403 (Forbidden) status code.
The client is therefore not authorized,
but has the opportunity to engage its operator &#8211; the requesting party &#8211;
in a claims-gathering flow with the authorization server
(see <em class="xref std std-ref">Section 3.5</em>) to potentially become authorized.</p>
</dd>
</dl>
</div></blockquote>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_requester_ticket"
}</pre>
</div>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.3</a> )</p>
</div>
</div>
<div class="section" id="claims-gathering-flows">
<span id="uma-core-3-5"></span><h3><a class="toc-backref" href="#id186">3.5. Claims-Gathering Flows</a><a class="headerlink" href="#claims-gathering-flows" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>クレームを要求したり、渡したりする必要がある場合が考えられる</li>
<li>Requesting Party 固有のクレームと、それに依存しないクレームがある</li>
<li>Requesting Partyは個人、とそれ以外(ブラウザ、App、Bot...)</li>
</ul>
</div>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> MUST base the addition of <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a>
to RPTs on user policies.</p>
<p>The nature of these policies is outside the scope of UMA,
but generally speaking,
they can be thought of as either independent of requesting-party features
(for example, time of day) or dependent on requesting-party features
(for example, whether they are over 18).
This latter case requires the <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a> to transmit identity claims
to the AM in some fashion.</p>
<p>The process for requesting and providing claims is extensible and
may have a variety of dependencies on the type of requesting party
(for example, natural person or legal person) and the type of client
(for example, browser, native app, or autonomously running web service).</p>
<p>UMA provides a framework for handling end-user-driven clients and
an optional solution for gathering standardized claims from such an end-user,
and allows for extensions to support other solutions for this use case and other use cases.</p>
<p>The authorization server SHOULD document its claims-handling ability
in its configuration data through the claim_profiles_supported property
(see <em class="xref std std-ref">Section 1.5</em>).</p>
<p>For the business-level and legal implications of different technical
authorization flows, see <a class="reference internal" href="#term-155"><em class="xref std std-term">[UMA-obligations]</em></a>.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5</a> )</p>
<div class="section" id="claims-gathering-flow-for-clients-operated-by-end-users">
<span id="uma-core-3-5-1"></span><h4><a class="toc-backref" href="#id187">3.5.1. Claims-Gathering Flow for Clients Operated by End-Users</a><a class="headerlink" href="#claims-gathering-flow-for-clients-operated-by-end-users" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>自然人</li>
<li>組織人</li>
</ul>
</div>
<p>A client,
whether web-based or native,
is operated by an end-user in
one of two typical situations:</p>
<blockquote>
<div><ul class="simple">
<li>The requesting party is a natural person (for example, a friend of
the resource owner); the requesting party may even be the resource
owner herself.</li>
<li>The requesting party is a legal person such as a corporation, and
the end-user operating the client is acting as an agent of that
legal person (for example, a customer support specialist
representing a credit card company).</li>
</ul>
</div></blockquote>
<p>For convenience,
this specification refers to the end-user as a &#8220;requesting end-user&#8221;
to cover both cases,
which differ only at the level of business agreements
(and potentially law), rather than technology.</p>
<p>The authorization server has a variety of options
at this point for satisfying the resource owner&#8217;s policy;
this specification does not dictate a single answer.</p>
<p>For example,
the authorization server could require the requesting end-user to
register for and/or log in to a local authorization server account,
or to fill in a questionnaire, or to complete a purchase.
It could even require several of these operations,
where the order is treated as significant.
A variety of claim profiling can be defined to achieve these effects.</p>
<p>An end-user-driven client MUST redirect the requesting end-user to
the authorization server to complete the process of authorization.
The redirection MUST include a URI query parameter with the name
&#8220;ticket&#8221; whose value conveys the <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a>
for which the need_claims error was received;
for example,
&#8220;ticket=016f84e8-f9b9-11e0-bd6f-0021cc6004de&#8221;.</p>
<p>Each claim profile MUST provide the following capabilities:</p>
<dl class="glossary docutils">
<dt id="term-redirect-uri">redirect URI</dt>
<dd>A means by which the client MUST supply the URI to
which the authorization server MUST redirect
the <em class="xref std std-term">requesting end-user</em>
at the end of the claims-gathering process.</dd>
<dt id="term-callback-uri">callback URI</dt>
<dd>A means by which the client OPTIONALLY supplies a
callback URI for the authorization server to use.</dd>
<dt id="term-state">state</dt>
<dd>A means by which the client SHOULD supply an opaque value used
to maintain state between the request and the callback; this
serves as a protection against XSRF attacks.</dd>
</dl>
<p>An authorization server MAY support any number of claim profiles.
One potential such profile is defined in this specification:
the &#8220;<strong>openid</strong>&#8221; claim profile,
which leverages OpenID Connect for gathering generally useful identity claims
(see <em class="xref std std-ref">Section 3.5.1.1</em>).</p>
<p>(defat 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5.1</a> )</p>
<div class="section" id="openid-connect-claim-profile">
<span id="uma-core-3-5-1-1"></span><h5><a class="toc-backref" href="#id188">3.5.1.1.  OpenID Connect Claim Profile</a><a class="headerlink" href="#openid-connect-claim-profile" title="Permalink to this headline">¶</a></h5>
<p>This section defines the OpenID Connect claim profile for UMA.</p>
<p>Following is a summary:</p>
<blockquote>
<div><ul>
<li><p class="first">Identifying URI:</p>
<p><a class="reference external" href="http://docs.kantarainitiative.org/uma/profiles/uma-claim-openid-1.0">http://docs.kantarainitiative.org/uma/profiles/uma-claim-openid-1.0</a></p>
</li>
<li><p class="first">Profile author and contact information:</p>
<p>Thomas Hardjono (<a class="reference external" href="mailto:hardjono&#37;&#52;&#48;mit&#46;edu">hardjono<span>&#64;</span>mit<span>&#46;</span>edu</a>)</p>
</li>
<li><p class="first">Updates or obsoletes:</p>
<p>None; this profile is new.</p>
</li>
<li><p class="first">Authorization server configuration data:</p>
<p>To indicate support,
supply the keyword &#8220;<strong>openid</strong>&#8221; in the &#8220;<a class="reference internal" href="#term-110"><em class="xref std std-term">claim_profiles_supported</em></a>&#8221;
property value.</p>
</li>
<li><p class="first">Syntax and semantics of claim data:</p>
<p>As defined below.</p>
<p>The claim data format leverages the OpenID Connect protocol and the reserved
claims defined in that specification.</p>
</li>
<li><p class="first">Claims gathering method:</p>
<p>As defined below.</p>
</li>
<li><p class="first">Error states:</p>
<p>None additional.</p>
</li>
<li><p class="first">Security and privacy considerations:</p>
<p>None additional.</p>
</li>
<li><p class="first">Binding obligations:</p>
<p>Binding obligations that apply to the use of
this claim profile are documented in <a class="reference internal" href="#term-155"><em class="xref std std-term">[UMA-obligations]</em></a>.</p>
</li>
</ul>
</div></blockquote>
<p>If an authorization server supports the OpenID Connect claim profile,
it MUST supply the &#8220;openid&#8221; value for one of its &#8220;claim_profiles_supported&#8221; values
in its configuration data.</p>
<p>To conform to this option,
the authorization server MUST do the following:</p>
<blockquote>
<div><ul class="simple">
<li>Serve as a conforming OpenID Relying Party and Claims Client
according to <a class="reference internal" href="#term-166"><em class="xref std std-term">[OCStandard]</em></a></li>
<li>Be able to utilize at least all of the reserved claims defined in
<a class="reference internal" href="#term-165"><em class="xref std std-term">[OCMessages]</em></a> in assessing policy and granting permissions</li>
<li>Use the OpenID Connect &#8220;redirect_uri&#8221; and &#8220;state&#8221; request
parameters as appropriate</li>
</ul>
</div></blockquote>
<p>The authorization server can then use any conforming OpenID Connect
mechanisms and typical user interfaces for engaging with the UserInfo
endpoints of OpenID Providers and Claims Providers,
potentially allowing for the delivery of &#8220;trusted claims&#8221;
(such as a verified email address or a date or birth)
on which authorization policy may depend.</p>
<p>( draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5.1.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5.1.1</a> )</p>
</div>
</div>
</div>
</div>
<div class="section" id="error-messages">
<span id="uma-core-4"></span><h2><a class="toc-backref" href="#id189">4.  Error Messages</a><a class="headerlink" href="#error-messages" title="Permalink to this headline">¶</a></h2>
<p>Ultimately the host is responsible for either granting the access the
requester attempted, or returning an error response to the requester
with a reason for the failure.  [OAuth2] defines several error
responses for a resource server to return.  UMA makes use of these
error responses, but requires the host to &#8220;outsource&#8221; the
determination of some error conditions to the AM.  UMA defines its
own additional error responses that the AM may give to the host and
requester as they interact with it, and that the host may give to the
requester.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
<div class="section" id="oauth-error-responses">
<span id="uma-core-4-1"></span><h3><a class="toc-backref" href="#id190">4.1.  OAuth Error Responses</a><a class="headerlink" href="#oauth-error-responses" title="Permalink to this headline">¶</a></h3>
<p>When a <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> or <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a> attempts to access
one of the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> endpoints <em class="xref std std-ref">Section 1.5</em>
or a client attempts to access a protected resource at the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>,
it has to make an authenticated request
by including an OAuth access token in the HTTP request
as described in <a class="reference internal" href="#term-149"><em class="xref std std-term">[OAuth2]</em></a> <a class="reference internal" href="oauth.html#oauth-7"><em>Section 7</em></a>.</p>
<p>If the request failed authentication, the authorization server
or the resource server responds with an OAuth error message
as described throughout <em class="xref std std-ref">Section 2</em> and <em class="xref std std-ref">Section 3</em>.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-4.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-4.1</a> )</p>
</div>
<div class="section" id="uma-error-responses">
<span id="uma-core-4-2"></span><h3><a class="toc-backref" href="#id191">4.2.  UMA Error Responses</a><a class="headerlink" href="#uma-error-responses" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>When a resource server or client attempts to access one of the</div></blockquote>
<p>authorization server endpoints <em class="xref std std-ref">Section 1.5</em>
or a client attempts to access a protected resource at the resource server,
if the request is successfully authenticated by OAuth means,
but is invalid for another reason,
the authorization server or resource server responds with an UMA error response
by adding the following properties to the entity body of the HTTP response:</p>
<dl class="glossary docutils">
<dt id="term-error">error</dt>
<dd>REQUIRED.  A single error code.  Value for this property is
defined in the specific authorization server endpoint description.</dd>
<dt id="term-error-description">error_description</dt>
<dd>OPTIONAL.  Human-readable text providing
additional information, used to assist in the understanding and
resolution of the error occurred.</dd>
<dt id="term-error-uri">error_uri</dt>
<dd>OPTIONAL.  A URI identifying a human-readable web page
with information about the error, used to provide the end-user
with additional information about the error.</dd>
</dl>
<p>Common error codes:</p>
<dl class="glossary docutils">
<dt id="term-invalid-request">invalid_request</dt>
<dd>The request is missing a required parameter or is
otherwise malformed.  The authorization server MUST respond with
the HTTP 400 (Bad Request) status code.</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "invalid_request",
  "error_description": "There is already a resource with this identifier.",
  "error_uri": "http://am.example.com/errors/resource_exists"
}</pre>
</div>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-4.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-4.2</a> )</p>
</div>
</div>
<div class="section" id="specification-of-additional-profiles">
<span id="uma-core-5"></span><h2><a class="toc-backref" href="#id192">5.  Specification of Additional Profiles</a><a class="headerlink" href="#specification-of-additional-profiles" title="Permalink to this headline">¶</a></h2>
<p>This specification defines a selected set of profiles, but others
will possibly be developed in the future.  It is not possible for
this specification to standardize all of these additional profiles.
The following sections define rules for third parties that specify
UMA profiles.</p>
<p>(Get text from <a class="reference external" href="http://docs.oasis-open.org/security/saml/v2.0/">http://docs.oasis-open.org/security/saml/v2.0/</a>
saml-profiles-2.0-os.pdf .)</p>
<p>(Put references to this section in the appropriate places above, and
add a discussion of profiles somewhere in the intro.)</p>
<p>(draft 05)</p>
<div class="section" id="specifying-uma-profiles">
<span id="uma-core-5-1"></span><h3><a class="toc-backref" href="#id193">5.1.  Specifying UMA Profiles</a><a class="headerlink" href="#specifying-uma-profiles" title="Permalink to this headline">¶</a></h3>
<p>This section provides a checklist of issues that MUST be addressed by each profile.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Specify a URI that uniquely identifies the profile, postal or
electronic contact information for the author, and provide
reference to previously defined profiles that the new profile
updates or obsoletes.</li>
<li>Specify the set of interactions between parties involved in the
profile.  Any restrictions on applications used by each party and
the protocols involved in each interaction must be explicitly
called out.</li>
<li>Identify the parties involved in each interaction, including how
many parties are involved and whether intermediaries may be
involved.</li>
<li>Specify the method of authentication of parties involved in each
interaction, including whether authentication is required and
acceptable authentication types.</li>
<li>Identify the level of support for message integrity, including
the mechanisms used to ensure message integrity.</li>
<li>Identify the level of support for confidentiality, including
whether a third party may view the contents of UMA messages,
whether the profile requires confidentiality, and the mechanisms
recommended for achieving confidentiality.</li>
<li>Identify the error states, including the error states at each
participant, especially those that receive and process UMA
messages.</li>
<li>Identify security considerations, including analysis of threats
and description of countermeasures.</li>
<li>Identify relevant UMA metadata defined and/or utilized by the
profile.</li>
</ol>
</div></blockquote>
<p>(draft 05)</p>
</div>
<div class="section" id="specifying-uma-token-profiles">
<span id="uma-core-5-2"></span><h3><a class="toc-backref" href="#id194">5.2.  Specifying UMA Token Profiles</a><a class="headerlink" href="#specifying-uma-token-profiles" title="Permalink to this headline">¶</a></h3>
<p>This section provides a checklist of items that MUST in particular be
addressed by attribute profiles.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Specify a URI that uniquely identifies the profile, postal or
electronic contact information for the author, and provide
reference to previously defined profiles that the new profile
updates or obsoletes.</li>
<li>Identify the syntax and restrictions on the acceptable values for
the token profile.</li>
<li>Identify namespace restrictions that are meaningful in the
profile deployment scenario.</li>
<li>Identify rules in the processing of the fields within the token
profile.</li>
<li>Identify the scopes that are defined in the token profile (e.g.
grant types in JWT Bearer Token Profile).</li>
<li>Identify the error states, including the error states at each
participant, especially those that receive and process claims or
assertions expressed within the tokens.</li>
</ol>
</div></blockquote>
<p>(draft 05)</p>
</div>
</div>
<div class="section" id="security-considerations">
<span id="uma-core-6"></span><h2><a class="toc-backref" href="#id195">6.  Security Considerations</a><a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>This specification relies mainly on OAuth security mechanisms for
protecting the host registration endpoint at the AM so that only a
properly authorized host can access it on behalf of the intended
user.  For example, the host needs to use a valid protection API
token (PAT) issued through a user authorization process at the
endpoint, and the interaction SHOULD take place over TLS.  It is
expected that the host will protect its client secret (if it was
issued one) and its PAT, particularly if used in &#8220;bearer token&#8221;
fashion.</p>
<p>In addition, this specification dictates a binding between the PAT
and the host-specific registration area on the AM to prevent a host
from interacting with a registration area not its own.</p>
<p>This specification defines a number of JSON-based data formats.  As a
subset of the JavaScript scripting language, JSON data SHOULD be
consumed through a process that does not dynamically execute it as
code, to avoid malicious code execution.  One way to achieve this is
to use a JavaScript interpreter rather than the built-in JavaScript
eval() function.</p>
<p>For information about the technical, operational, and legal elements
of trust establishment between UMA entities and parties, which
affects security considerations, see [UMA-trustmodel].</p>
<p>(draft 05)</p>
</div>
<div class="section" id="privacy-considerations">
<span id="uma-core-7"></span><h2><a class="toc-backref" href="#id196">7.  Privacy Considerations</a><a class="headerlink" href="#privacy-considerations" title="Permalink to this headline">¶</a></h2>
<p>The AM comes to be in possession of resource set information (such as
names and icons) that may reveal information about the user, which
the AM&#8217;s trust relationship with the host is assumed to accommodate.
However, the requester is a less-trusted party (in fact, entirely
untrustworthy until it acquires permissions for an RPT in UMA
protocol phase 2.  This specification recommends obscuring resource
set identifiers in order to avoid leaking personally identifiable
information to requesters through the &#8220;scope&#8221; mechanism.</p>
<p>For information about the technical, operational, and legal elements
of trust establishment between UMA entities and parties, which
affects privacy considerations, see [UMA-trustmodel].</p>
<p>(draft 05)</p>
</div>
<div class="section" id="conformance">
<span id="uma-core-8"></span><h2><a class="toc-backref" href="#id197">8.  Conformance</a><a class="headerlink" href="#conformance" title="Permalink to this headline">¶</a></h2>
<p>This section outlines conformance requirements for various entities
implementing UMA endpoints.</p>
<p>This specification has dependencies on other specifications, as
follows:</p>
<blockquote>
<div><ul class="simple">
<li>OAuth 2.0: AMs, hosts, and requesters MUST support [OAuth2]
features named in this specification for conformance.  For
example, AMs MUST support the authorization_code and
client_credentials grant types.</li>
<li>hostmeta: AMs, hosts, and requesters MUST support the [RFC6415]
features named in this specification.</li>
<li>OpenID Connect: AMs MAY support [DynClientReg], and MAY choose to
conform to the &#8220;openid&#8221; claim format option, corresponding to the
OpenID Connect RP role defined in [OCStandard] and support for
OpenID Connect reserved claims defined in [OCMessages].</li>
</ul>
</div></blockquote>
<p>The AM&#8217;s configuration data provides a machine-readable method for an
AM to indicate certain of the conformance options it has chosen.
Several of the data properties allow for extensibility.  Where this
specification does not already require optional features to be
documented, it is RECOMMENDED that AM developers and deployers
document any profiled or extended features explicitly and use
configuration data to indicate their usage.  See Section 1.5 for
information about providing and extending AM configuration data.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="iana-considerations">
<span id="uma-core-9"></span><h2><a class="toc-backref" href="#id198">9.  IANA Considerations</a><a class="headerlink" href="#iana-considerations" title="Permalink to this headline">¶</a></h2>
<p>Several UMA-specific JSON-based media types are being proposed, as
follows: (TBS)</p>
<p>(draft 05)</p>
</div>
<div class="section" id="example-of-registering-resource-sets">
<span id="uma-core-10"></span><h2><a class="toc-backref" href="#id199">10.  Example of Registering Resource Sets</a><a class="headerlink" href="#example-of-registering-resource-sets" title="Permalink to this headline">¶</a></h2>
<p>The following example illustrates the intent and usage of resource
set descriptions and scope descriptions as part of resource set
registration.</p>
<p>This example contains some steps that are exclusively in the realm of
user experience rather than web protocol, to achieve realistic
illustration.  These steps are labeled &#8220;User experience only&#8221;.  Some
other steps are exclusively internal to the operation of the entity
being discussed.  These are labeled &#8220;Internal only&#8221;.</p>
<p>An authorizing user, Alice Adams, has just uploaded a photo of her
new puppy to a host, Photoz.example.com, and wants to ensure that
this specific photo is not publicly accessible.</p>
<p>Alice has already introduced this host to her AM,
CopMonkey.example.com, and thus Photoz has already obtained a PAT
from CopMonkey.  However, Alice has not previously instructed Photoz
to use CopMonkey to protect any other photos of hers.</p>
<p>Alice has previously visited CopMonkey to map a default &#8220;do not share
with anyone&#8221; policy to any resource sets registered by Photoz, until
such time as she maps some other more permissive policies to those
resources.  (User experience only.  This may have been done at the
time Alice introduced the host to the AM, and/or it could have been a
global or host-specific preference setting.  A different constraint
or no constraint at all might be associated with newly protected
resources.)  Other kinds of policies she may eventually map to
particular photos or albums might be &#8220;Share only with
<a class="reference external" href="mailto:husband&#37;&#52;&#48;email&#46;example&#46;net">husband<span>&#64;</span>email<span>&#46;</span>example<span>&#46;</span>net</a>&#8221; or &#8220;Share only with people in my &#8216;family&#8217;
group&#8221;.</p>
<p>Photoz itself has a publicly documented application-specific API that
offers two dozen different methods that apply to single photos, such
as &#8220;addTags&#8221; and &#8220;getSizes&#8221;, but rolls them up into two photo-related
scopes of access: &#8220;view&#8221; (consisting of various read-only operations)
and &#8220;all&#8221; (consisting of various reading, editing, and printing
operations).  It defines two scope descriptions that represent these
scopes, which it is able to reuse for all of its users (not just
Alice), and ensures that these scope description documents are
available through HTTP GET requests that may be made by AMs.</p>
<p>The &#8220;name&#8221; property values are intended to be seen by Alice when she
maps authorization constraints to specific resource sets and actions
while visiting CopMonkey, such that Alice would see the strings &#8220;View
Photo and Related Info&#8221; and &#8220;All Actions&#8221;, likely accompanied by the
referenced icons, in the CopMonkey interface.  (Other users of Photoz
might similarly see the same labels at CopMonkey or whatever other AM
they use.  Photoz could distinguish natural-language labels per user
if it wishes, by pointing to scopes with differently translated
names.)</p>
<p>Example of the viewing-related scope description document available
at <a class="reference external" href="http://photoz.example.com/dev/scopes/view">http://photoz.example.com/dev/scopes/view</a> with a Content-Type of
application/uma-scope+json:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;View Photo and Related Info&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/reading-glasses.png&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example of the broader scope description document available at
<a class="reference external" href="http://photoz.example.com/dev/scopes/all">http://photoz.example.com/dev/scopes/all</a>, likewise with a Content-
Type of application/uma-scope+json:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;All Actions&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/galaxy.png&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>While visiting Photoz, Alice selects a link or button that instructs
the site to &#8220;Protect&#8221; or &#8220;Share&#8221; this single photo (user experience
only; Photoz could have made this a default or preference setting).</p>
<p>As a result, Photoz defines for itself a resource set that represents
this photo (internal only; Photoz is the only application that knows
how to map a particular photo to a particular resource set).  Photoz
also prepares the following resource set description, which is
specific to Alice and her photo.  The &#8220;name&#8221; property value is
intended to be seen by Alice in mapping authorization policies to
specific resource sets and actions when she visits CopMonkey.  Alice
would see the string &#8220;Steve the puppy!&#8221;, likely accompanied by the
referenced icon, in the CopMonkey interface.  The possible scopes of
access on this resource set are indicated with URI references to the
scope descriptions, as shown just above.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Steve the puppy!&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower&quot;</span><span class="p">,</span>
  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Photoz uses the &#8220;create resource set description&#8221; method of
CopMonkey&#8217;s standard UMA resource set registration API, presenting
its Alice-specific PAT there, to register and assign an identifier to
the resource set description.</p>
<div class="highlight-python"><pre>PUT /resource_set/112210f47de98100 HTTP/1.1
Content-Type: application/uma-resource-set+json
...

{
  "name": "Steve the puppy!",
  "icon_uri": "http://www.example.com/icons/flower.png",
  "scopes": [
    "http://photoz.example.com/dev/scopes/view",
    "http://photoz.example.com/dev/scopes/all"
  ]
}</pre>
</div>
<p>If the registration attempt succeeds, CopMonkey responds in the
following fashion.</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: "1"
...

{
  "status": "created",
  "_id":  "112210f47de98100",
  "_rev": "1"
}</pre>
</div>
<p>At the time Alice indicates she would like this photo protected,
Photoz can choose to redirect Alice to CopMonkey for further policy
setting, access auditing, and other AM-related tasks (user experience
only).</p>
<p>Once it has successfully registered this description, Photoz is
responsible for outsourcing to CopMonkey all questions of
authorization for access attempts made to this photo.</p>
<p>Over time, as Alice uploads other photos and creates and organizes
photo albums, and as Photoz makes new action functionality available,
Photoz can use additional methods of the resource set registration
API to ensure that CopMonkey&#8217;s understanding of Alice&#8217;s protected
resources matches its own.</p>
<p>For example, if Photoz suspects that somehow its understanding of the
resource set has gotten out of sync with CopMonkey&#8217;s, it can ask to
read the resource set description as follows.</p>
<div class="highlight-python"><pre>GET /resource_set/112210f47de98100 HTTP/1.1
Host: am.example.com
...</pre>
</div>
<p>CopMonkey responds with the full content of the resource set
description, including its _id and its current _rev, as follows:</p>
<p>Example of an HTTP response to a &#8220;read resource set description&#8221;
request, containing a resource set description from the AM:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/uma-resource-set+json
ETag: "1"
...

{
  "_id":  "112210f47de98100",
  "_rev": "1",
  "name": "Photo album",
  "icon_uri": "http://www.example.com/icons/flower.png",
  "scopes": [
    "http://photoz.example.com/dev/scopes/view",
    "http://photoz.example.com/dev/scopes/all"
  ]
}</pre>
</div>
<p>If for some reason Photoz and CopMonkey have gotten dramatically out
of sync, Photoz can ask for the list of resource set identifiers
CopMonkey currently knows about:</p>
<div class="highlight-python"><pre>GET /resource_set HTTP/1.1
Host: am.example.com
...</pre>
</div>
<p>CopMonkey&#8217;s response might look as follows:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
...

[ "112210f47de98100", "34234df47eL95300" ]</pre>
</div>
<p>If Alice later changes the photo&#8217;s title (user experience only) on
Photoz from &#8220;Steve the puppy!&#8221; to &#8220;Steve on October 14, 2011&#8221;, Photoz
would use the &#8220;update resource set description&#8221; method to ensure that
Alice&#8217;s experience of policy-setting at CopMonkey remains consistent
with what she sees at Photoz.  Following is an example of this
request.</p>
<div class="highlight-python"><pre>PUT /resource_set/112210f47de98100 HTTP/1.1
Content-Type: application/uma-resource-set+json
Host: am.example.com
If-Match: "1"
...

{
  "name": "Steve on October 14, 2011",
  "icon_uri": "http://www.example.com/icons/flower.png",
  "scopes": [
    "http://photoz.example.com/dev/scopes/view",
    "http://photoz.example.com/dev/scopes/all"
  ]
}</pre>
</div>
<p>CopMonkey would respond as follows.</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: "2"
...

{
  "status": "updated",
  "_id":  "112210f47de98100",
  "_rev": "2"
}</pre>
</div>
<p>There are other reasons Photoz might want to update resource set
descriptions, having nothing to do with Alice&#8217;s actions or wishes.
For example, it might extend its API to include new features, and
want to add new scopes to all of Alice&#8217;s and other users&#8217; resource
set descriptions.</p>
<p>if Alice later decides to entirely remove sharing protection (user
experience only) on this photo while visiting Photoz, ensuring that
the public can get access without any UMA-based protection, Photoz is
responsible for deleting the relevant resource set registration, as
follows:</p>
<div class="highlight-python"><pre>DELETE /resource_set/112210f47de98100 HTTP/1.1
Host: am.example.com
If-Match: "2"
...</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="acknowledgments">
<span id="uma-core-11"></span><h2><a class="toc-backref" href="#id200">11.  Acknowledgments</a><a class="headerlink" href="#acknowledgments" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The current editor of this specification is Thomas Hardjono of MIT.
The following people are co-authors:</p>
<p>o  Paul C. Bryan, ForgeRock US, Inc. (former editor)</p>
<p>o  Domenico Catalano, Oracle Corp.</p>
<p>o  George Fletcher, AOL</p>
<p>o  Maciej Machulak, Newcastle University</p>
<p>o  Eve Maler, XMLgrrl.com</p>
<p>o  Lukasz Moren, Newcastle University</p>
<p>o  Christian Scholz, COMlounge GmbH (former editor)</p>
<p>o  Jacek Szpot, Newcastle University</p>
<p>Additional contributors to this specification include the Kantara UMA
Work Group participants, a list of whom can be found at
[UMAnitarians].</p>
</div></blockquote>
<p>(draft 05)</p>
</div>
<div class="section" id="issues">
<span id="uma-core-12"></span><h2><a class="toc-backref" href="#id201">12.  Issues</a><a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>All issues are now captured at the project&#8217;s GitHub site
(&lt;<a class="reference external" href="https://github.com/xmlgrrl/UMA-Specifications/issues">https://github.com/xmlgrrl/UMA-Specifications/issues</a>&gt;).</div></blockquote>
<p>(draft 05)</p>
<div class="section" id="normative-references">
<span id="uma-core-12-1"></span><h3><a class="toc-backref" href="#id202">12.1.  Normative References</a><a class="headerlink" href="#normative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-dynclientreg">[DynClientReg]</dt>
<dd>Richer, J., &#8220;OAuth Dynamic Client Registration Protocol&#8221;,
November 2012, &lt;<a class="reference external" href="https://datatracker.ietf.org/doc/">https://datatracker.ietf.org/doc/</a>
draft-ietf-oauth-dyn-reg/&gt;.</dd>
<dt id="term-oauth-saml">[OAuth-SAML]</dt>
<dd>Campbell, B., &#8220;SAML 2.0 Bearer Assertion Profiles for
OAuth 2.0&#8221;, November 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/">http://tools.ietf.org/html/</a>
draft-ietf-oauth-saml2-bearer&gt;.</dd>
<dt id="term-oauth-bearer">[OAuth-bearer]</dt>
<dd>&#8220;The OAuth 2.0 Authorization Framework: Bearer Token
Usage&#8221;, October 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6750">http://tools.ietf.org/html/rfc6750</a>&gt;.</dd>
<dt id="term-oauth-introspection">[OAuth-introspection]</dt>
<dd>Richer, J., &#8220;OAuth Token Introspection&#8221;, November 2012, &lt;h
ttp://tools.ietf.org/html/
draft-richer-oauth-introspection&gt;.</dd>
<dt id="term-oauth-resource-reg">[OAuth-resource-reg]</dt>
<dd>Hardjono, T., &#8220;OAuth 2.0 Resource Set Registration&#8221;,
December 2012.</dd>
<dt id="term-oauth2">[OAuth2]</dt>
<dd>Hardt, D., &#8220;The OAuth 2.0 Authorization Framework&#8221;,
October 2012, &lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6749">http://tools.ietf.org/html/rfc6749</a>&gt;.</dd>
<dt id="term-ocmessages">[OCMessages]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Messages 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-messages-1_0.html&gt;.</dd>
<dt id="term-ocstandard">[OCStandard]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Standard 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-standard-1_0.html&gt;.</dd>
<dt id="term-rfc2119">[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt id="term-rfc4627">[RFC4627]</dt>
<dd>Crockford, D., &#8220;The application/json Media Type for
JavaScript Object Notation (JSON)&#8221;, RFC 4627, July 2006.</dd>
<dt id="term-rfc6415">[RFC6415]</dt>
<dd>Hammer-Lahav, E., &#8220;Web Host Metadata&#8221;, October 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6415">http://tools.ietf.org/html/rfc6415</a>&gt;.</dd>
<dt id="term-uma-obligations">[UMA-obligations]</dt>
<dd>Maler, E., &#8220;<a class="reference internal" href="uma_trust.html"><em>Binding Obligations on UMA Participants</em></a>&#8221;,
April 2012,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model">http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model</a>&gt;.</dd>
</dl>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.1</a> )</p>
</div>
<div class="section" id="informative-references">
<span id="uma-core-12-2"></span><h3><a class="toc-backref" href="#id203">12.2.  Informative References</a><a class="headerlink" href="#informative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-oauth-linktypes">[OAuth-linktypes]</dt>
<dd>Mills, W., &#8220;Link Type Registrations for OAuth 2&#8221;,
October 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-wmills-oauth-lrdd">http://tools.ietf.org/html/draft-wmills-oauth-lrdd</a>&gt;.</dd>
<dt id="term-oauth-meta">[OAuth-meta]</dt>
<dd>Sakimura, N., &#8220;<a class="reference internal" href="oauth_meta.html"><em>JSON Metadata for OAuth Responses</em></a>&#8221;,
December 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-sakimura-oauth-meta">http://tools.ietf.org/html/draft-sakimura-oauth-meta</a>&gt;.</dd>
<dt id="term-uma-casestudies">[UMA-casestudies]</dt>
<dd>Maler, E., &#8220;UMA Case Studies&#8221;, December 2012,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/Case+Studies">http://kantarainitiative.org/confluence/display/uma/Case+Studies</a>&gt;.</dd>
<dt id="term-uma-usecases">[UMA-usecases]</dt>
<dd>Maler, E., &#8220;UMA Scenarios and Use Cases&#8221;, October 2010,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases">http://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases</a>&gt;.</dd>
<dt id="term-umanitarians">[UMAnitarians]</dt>
<dd>Maler, E., &#8220;UMA Participant Roster&#8221;, 2012,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/Participant+Roster">http://kantarainitiative.org/confluence/display/uma/Participant+Roster</a>&gt;.</dd>
</dl>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.2</a> )</p>
</div>
</div>
<div class="section" id="references">
<span id="uma-core-13"></span><h2><a class="toc-backref" href="#id204">13.  References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>(draft 05)</p>
<div class="section" id="uma-core-13-1">
<span id="id18"></span><h3><a class="toc-backref" href="#id205">13.1.  Normative References</a><a class="headerlink" href="#uma-core-13-1" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-65">[DynClientReg]</dt>
<dd>Hardjono, T., &#8220;OAuth Dynamic Client Registration
Protocol&#8221;, May 2012, &lt;<a class="reference external" href="https://datatracker.ietf.org/doc/">https://datatracker.ietf.org/doc/</a>
draft-ietf-oauth-dyn-reg/&gt;.</dd>
<dt id="term-66">[OAuth-SAML]</dt>
<dd>Campbell, B., &#8220;SAML 2.0 Bearer Assertion Grant Type
Profile for OAuth 2.0&#8221;, August 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/">http://tools.ietf.org/html/</a>
draft-ietf-oauth-saml2-bearer&gt;.</dd>
<dt id="term-67">[OAuth-bearer]</dt>
<dd>&#8220;The OAuth 2.0 Authorization Protocol: Bearer Tokens&#8221;,
March 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-bearer">http://tools.ietf.org/html/draft-ietf-oauth-v2-bearer</a>&gt;.</dd>
<dt id="term-oauth2-hammer-lahav-e-the-oauth-2-0-protocol">[OAuth2]   Hammer-Lahav, E., &#8220;The OAuth 2.0 Protocol&#8221;,</dt>
<dd>September 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2">http://tools.ietf.org/html/draft-ietf-oauth-v2</a>&gt;.</dd>
<dt id="term-69">[OCMessages]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Messages 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-messages-1_0.html&gt;.</dd>
<dt id="term-70">[OCStandard]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Standard 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-standard-1_0.html&gt;.</dd>
<dt id="term-71">[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt id="term-72">[RFC4627]</dt>
<dd>Crockford, D., &#8220;The application/json Media Type for
JavaScript Object Notation (JSON)&#8221;, RFC 4627, July 2006.</dd>
<dt id="term-73">[RFC6415]</dt>
<dd>Hammer-Lahav, E., &#8220;Web Host Metadata&#8221;, October 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6415">http://tools.ietf.org/html/rfc6415</a>&gt;.</dd>
<dt id="term-uma-trustmodel">[UMA-trustmodel]</dt>
<dd>Maler, E., &#8220;UMA Trust Model&#8221;, April 2012, &lt;<a class="reference external" href="http://">http://</a>
kantarainitiative.org/confluence/display/uma/
UMA+Trust+Model&gt;.</dd>
</dl>
<p>(draft 05)</p>
</div>
<div class="section" id="uma-core-13-2">
<span id="id19"></span><h3><a class="toc-backref" href="#id206">13.2.  Informative References</a><a class="headerlink" href="#uma-core-13-2" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-75">[UMA-usecases]</dt>
<dd>Maler, E., &#8220;UMA Scenarios and Use Cases&#8221;, October 2010, &lt;h
ttp://kantarainitiative.org/confluence/display/uma/
UMA+Scenarios+and+Use+Cases&gt;.</dd>
<dt id="term-uma-userstories">[UMA-userstories]</dt>
<dd>Maler, E., &#8220;UMA User Stories&#8221;, November 2010, &lt;<a class="reference external" href="http://">http://</a>
kantarainitiative.org/confluence/display/uma/
User+Stories&gt;.</dd>
<dt id="term-77">[UMAnitarians]</dt>
<dd>Maler, E., &#8220;UMA Participant Roster&#8221;, 2012, &lt;<a class="reference external" href="http://">http://</a>
kantarainitiative.org/confluence/display/uma/
Participant+Roster&gt;.</dd>
</dl>
<p>(draft 05)</p>
</div>
</div>
<div class="section" id="note">
<h2><a class="toc-backref" href="#id207">Note</a><a class="headerlink" href="#note" title="Permalink to this headline">¶</a></h2>
<div class="section" id="resource-set-descriptor-for-openid-connect">
<h3><a class="toc-backref" href="#id208">Resource Set Descriptor for OpenID Connect</a><a class="headerlink" href="#resource-set-descriptor-for-openid-connect" title="Permalink to this headline">¶</a></h3>
<p>If an OpenID Connect OP works as an UMA AM,  the OP can return the UserInfo
in which Users&#8217; resource at Host are included as an Aggregated Claim , or
OAuth Access Tokens to the Host endpoint are includde.</p>
<p>To make OpenID Connet OP as a middle man,
the Host gives extra parameters in UMA Resoure Set Description
for Protection API.</p>
<dl class="glossary docutils">
<dt id="term-78">token_endpoint</dt>
<dd>Connect OP ask the Host to issue an access token and an refresh token at this endpoint.
Requests are authenticated by OAuth Bear Token Profile with <strong>credentai_token</strong>.</dd>
<dt id="term-credential-token">credential_token</dt>
<dd>Token for the Token Endpoint request authtentiction</dd>
<dt id="term-refresh-token">refresh_token</dt>
<dd>Token to refresh an access token and the other reflesh token.</dd>
<dt id="term-resource-endpoint">resource_endpoint</dt>
<dd>Users resource is returned from this endpoint in exchange for access token.</dd>
</dl>
<p>The following JSON is an non-normative sample to be put by Host to Connect OP as AM
for Protecttion API.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Photo Album&quot;</span><span class="p">,</span>

  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower.png&quot;</span><span class="p">,</span>

  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">],</span>

  <span class="s2">&quot;token_endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://photoz.example.com/dev/token/&quot;</span><span class="p">,</span>
  <span class="s2">&quot;credential_token&quot;</span> <span class="o">:</span> <span class="s2">&quot;fdsafdsafdsafa&quot;</span><span class="p">,</span>
  <span class="s2">&quot;refresh_token&quot;</span> <span class="o">:</span> <span class="s2">&quot;432gsafgds9&quot;</span><span class="p">,</span>
  <span class="s2">&quot;resource_endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://photoz.example.com/dev/resource/&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the User configure to return his UserInfo including resource at Host,
the OP refreshes an access token in exchange for the <strong>refresh_tokne</strong> first,
then get the resource at <strong>token_endpoint</strong> in exchange for the access token.</p>
<p>After the resource is returned in JWT form to the OP, OP include it as an
Aggregated Claim in the UserInfo( which is to be returnd to the other RP).</p>
<p>If the User configure to return an access token to the Host in UserInfo,
OP includes the access token given by Host&#8217; <strong>token_endpoint</strong> in the UserInfo.</p>
</div>
</div>
</div>
<div class="section" id="uma-core-head">
<span id="id20"></span><h1>User-Managed Access (UMA) Profile of OAuth 2.0<a class="headerlink" href="#uma-core-head" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#id21" id="id209">Abstract</a></li>
<li><a class="reference internal" href="#id23" id="id210">1.  Introduction</a><ul>
<li><a class="reference internal" href="#id25" id="id211">概要</a><ul>
<li><a class="reference internal" href="#id26" id="id212">ポリシーベースアクセス制御</a></li>
<li><a class="reference internal" href="#id27" id="id213">ユースケース</a></li>
<li><a class="reference internal" href="#id28" id="id214">利用条件</a></li>
<li><a class="reference internal" href="#id29" id="id215">PDP/PEP</a></li>
<li><a class="reference internal" href="#id30" id="id216">OAuth2</a></li>
<li><a class="reference internal" href="#id31" id="id217">Protocol</a><ul>
<li><a class="reference internal" href="#id32" id="id218">リソース保護(PAT API)</a></li>
<li><a class="reference internal" href="#id33" id="id219">認可発行(RPT発行)</a></li>
<li><a class="reference internal" href="#id34" id="id220">リソースアクセス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id35" id="id221">デプロイメント</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id36" id="id222">1.1.  Notational Conventions</a></li>
<li><a class="reference internal" href="#id38" id="id223">1.2.  Basic Terminology</a></li>
<li><a class="reference internal" href="#id41" id="id224">1.3. Endpoints, Endpoint Protection, and Tokens</a><ul>
<li><a class="reference internal" href="#id42" id="id225">保護API(PAT)</a></li>
<li><a class="reference internal" href="#id43" id="id226">認可API(AAT)</a></li>
<li><a class="reference internal" href="#id44" id="id227">リソースAPI(RPT)</a></li>
<li><a class="reference internal" href="#id45" id="id228">標準OAuth エンドポイント</a></li>
<li><a class="reference internal" href="#id46" id="id229">リソースサーバー向けエンドポイント</a></li>
<li><a class="reference internal" href="#id47" id="id230">クライアント向けエンドポイント</a></li>
<li><a class="reference internal" href="#id48" id="id231">リソースサーバーのクライアント向けエンドポイント</a></li>
<li><a class="reference internal" href="#id49" id="id232">トークン管理</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id50" id="id233">1.4.  Scopes, Resource Sets, Permissions, and Authorization</a><ul>
<li><a class="reference internal" href="#id52" id="id234">リソースセットとスコープタイプ</a></li>
<li><a class="reference internal" href="#id53" id="id235">パーミッション</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id54" id="id236">1.5. Authorization Server Configuration Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id57" id="id237">2. Protecting a Resource</a><ul>
<li><a class="reference internal" href="#id59" id="id238">2.1. Resource Server Obtains PAT</a></li>
<li><a class="reference internal" href="#id61" id="id239">2.2. Resource Server Registers Sets of Resources to Be Protected</a></li>
<li><a class="reference internal" href="#host-obtains-protection-api-token" id="id240">2.3.  Host Obtains Protection API Token</a></li>
<li><a class="reference internal" href="#host-registers-sets-of-resources-to-be-protected" id="id241">2.4. Host Registers Sets of Resources to Be Protected</a><ul>
<li><a class="reference internal" href="#scope-descriptions" id="id242">2.4.1. Scope Descriptions</a></li>
<li><a class="reference internal" href="#resource-set-descriptions" id="id243">2.4.2. Resource Set Descriptions</a></li>
<li><a class="reference internal" href="#resource-set-registration-api" id="id244">2.4.3. Resource Set Registration API</a><ul>
<li><a class="reference internal" href="#create-resource-set-description" id="id245">2.4.3.1. Create Resource Set Description</a></li>
<li><a class="reference internal" href="#read-resource-set-description" id="id246">2.4.3.2.  Read Resource Set Description</a></li>
<li><a class="reference internal" href="#update-resource-set-description" id="id247">2.4.3.3.  Update Resource Set Description</a></li>
<li><a class="reference internal" href="#delete-resource-set-description" id="id248">2.4.3.4.  Delete Resource Set Description</a></li>
<li><a class="reference internal" href="#list-resource-set-descriptions" id="id249">2.4.3.5.  List Resource Set Descriptions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id63" id="id250">3. Getting Authorization and Accessing a Resource</a><ul>
<li><a class="reference internal" href="#id65" id="id251">3.1. Client Attempts to Access Protected Resource</a><ul>
<li><a class="reference internal" href="#id67" id="id252">3.1.1. Client Presents No RPT</a></li>
<li><a class="reference internal" href="#id68" id="id253">3.1.2. Client Presents an RPT That Has Insufficient Authorization Data</a></li>
<li><a class="reference internal" href="#id70" id="id254">3.1.3. Client Presents a Valid RPT with Sufficient Authorization Data</a><ul>
<li><a class="reference internal" href="#id72" id="id255">3.1.3.1.  Requester&#8217;s Token Has Insufficient Permission</a></li>
<li><a class="reference internal" href="#id74" id="id256">3.1.3.2.  Requester&#8217;s Token Has Sufficient Permission</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id77" id="id257">3.2. Resource Server Registers a Permission With Authorization Server</a><ul>
<li><a class="reference internal" href="#id78" id="id258">サンプル</a><ul>
<li><a class="reference internal" href="#id79" id="id259">リクエスト</a></li>
<li><a class="reference internal" href="#id80" id="id260">レスポンス</a></li>
<li><a class="reference internal" href="#id81" id="id261">エラー応答</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id83" id="id262">3.3. Resource Server Determines the RPT Status</a><ul>
<li><a class="reference internal" href="#id85" id="id263">3.3.1. UMA Bearer Token Profile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id87" id="id264">3.4. Client Asks Authorization Server for RPT and Authorization Data</a><ul>
<li><a class="reference internal" href="#id89" id="id265">3.4.1. Client Obtains AAT</a></li>
<li><a class="reference internal" href="#id91" id="id266">3.4.2.  Client Asks for Authorization Data</a></li>
<li><a class="reference internal" href="#id92" id="id267">3.4.3. Client Asks for Authorization Data</a></li>
<li><a class="reference internal" href="#requester-obtains-requester-permission-token" id="id268">3.4.4.  Requester Obtains Requester Permission Token</a></li>
<li><a class="reference internal" href="#requester-asks-for-authorization-to-add-permission" id="id269">3.4.5.  Requester Asks for Authorization to Add Permission</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id94" id="id270">3.5. Claims-Gathering Flows</a><ul>
<li><a class="reference internal" href="#id96" id="id271">3.5.1. Claims-Gathering Flow for Clients Operated by End-Users</a><ul>
<li><a class="reference internal" href="#id98" id="id272">3.5.1.1.  OpenID Connect Claim Profile</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#authorization-flows" id="id273">3.6.  Authorization Flows</a><ul>
<li><a class="reference internal" href="#authorization-flow-for-requester-apps-operated-by-end-users" id="id274">3.6.1.  Authorization Flow for Requester Apps Operated by End-Users</a><ul>
<li><a class="reference internal" href="#gathering-claims-from-requesting-end-users-with-openid-connect" id="id275">3.6.1.1.  Gathering Claims from Requesting End-Users with OpenID Connect</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id100" id="id276">4.  Error Messages</a><ul>
<li><a class="reference internal" href="#id102" id="id277">4.1.  OAuth Error Responses</a></li>
<li><a class="reference internal" href="#id104" id="id278">4.2.  UMA Error Responses</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id106" id="id279">5.  Specification of Additional Profiles</a><ul>
<li><a class="reference internal" href="#id108" id="id280">5.1.  Specifying UMA Profiles</a></li>
<li><a class="reference internal" href="#id110" id="id281">5.2.  Specifying UMA Token Profiles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id112" id="id282">6.  Security Considerations</a></li>
<li><a class="reference internal" href="#id114" id="id283">7.  Privacy Considerations</a></li>
<li><a class="reference internal" href="#id116" id="id284">8.  Conformance</a></li>
<li><a class="reference internal" href="#id118" id="id285">9.  IANA Considerations</a></li>
<li><a class="reference internal" href="#id120" id="id286">10.  Example of Registering Resource Sets</a></li>
<li><a class="reference internal" href="#id122" id="id287">11.  Acknowledgments</a></li>
<li><a class="reference internal" href="#id124" id="id288">12.  Issues</a><ul>
<li><a class="reference internal" href="#id126" id="id289">12.1.  Normative References</a></li>
<li><a class="reference internal" href="#id128" id="id290">12.2.  Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id130" id="id291">13.  References</a><ul>
<li><a class="reference internal" href="#id132" id="id292">13.1.  Normative References</a></li>
<li><a class="reference internal" href="#id134" id="id293">13.2.  Informative References</a></li>
<li><a class="reference internal" href="#uma-core-connect-resset" id="id294">Resource Set Descriptor for OpenID Connect</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Based on <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07</a></li>
</ul>
</div>
<div class="section" id="id21">
<span id="id22"></span><h2><a class="toc-backref" href="#id209">Abstract</a><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<p>User-Managed Access (UMA) is a profile of OAuth 2.0.</p>
<p>UMA defines how <a class="reference internal" href="#term-83"><em class="xref std std-term">resource owners</em></a> can control access to their <a class="reference internal" href="glossary.html#term-protected-resources"><em class="xref std std-term">protected resources</em></a>
made by <a class="reference internal" href="#term-87"><em class="xref std std-term">clients</em></a> operated by arbitrary rquesting parties,
where the resources reside on any number of resource servers,
and where a centralized <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> governs access
based on <em class="xref std std-term">resource owner policy</em>.</p>
<p>(draft 06)</p>
</div>
<div class="section" id="id23">
<span id="id24"></span><h2><a class="toc-backref" href="#id210">1.  Introduction</a><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id25">
<h3><a class="toc-backref" href="#id211">概要</a><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id26">
<h4><a class="toc-backref" href="#id212">ポリシーベースアクセス制御</a><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<p>User-Managed Access (UMA) is a profile of OAuth 2.0 [OAuth2].
UMA defines how <a class="reference internal" href="#term-83"><em class="xref std std-term">resource owners</em></a> can control
access to their <a class="reference internal" href="glossary.html#term-protected-resources"><em class="xref std std-term">protected resources</em></a> made by <a class="reference internal" href="#term-87"><em class="xref std std-term">clients</em></a>
operated by arbitrary <a class="reference internal" href="#term-85"><em class="xref std std-term">requesting parties</em></a>,
where the resources reside on any number of <a class="reference internal" href="oauth.html#term-resource-servers"><em class="xref std std-term">resource servers</em></a>,
and where a centralized <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> governs access
based on resource owner <a class="reference internal" href="glossary.html#term-policy"><em class="xref std std-term">policy</em></a>.</p>
<p>Resource owners configure authorization servers with <em class="xref std std-term">access policies</em>
that serve as <em class="xref std std-term">implicit authorization grants</em>.
Thus,
the UMA profile of OAuth includes an authorization grant flow.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">access policies を定義しておくと(PDP)、認可が勝手にでる(PEP)</p>
</div>
</div>
<div class="section" id="id27">
<h4><a class="toc-backref" href="#id213">ユースケース</a><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p>UMA serves numerous use cases where a resource owner outsources
authorization for access to their resources,
potentially even without the run-time presence of the resource owner.</p>
<p>A typical example is the following:
a web user (an end-user resource owner) can authorize
a web app (client) to gain one-time or ongoing access to a protected resource
containing his home address stored at a &#8220;personal data store&#8221; service (resource server),
by telling the resource server to respect access entitlements
issued by his authorization service (authorization server).</p>
<p>The requesting party operating the client might be the resource owner himself,
using a web or native app run by an e-commerce company
that needs to know where to ship a purchased item,
or it might be his friend who is using an online address book service
to collect contact information,
or it might be a survey company that uses an autonomous web service
to compile population demographics.</p>
<p>A variety of scenarios and use cases can be found
in <a class="reference internal" href="#term-171"><em class="xref std std-term">[UMA-usecases]</em></a> and <a class="reference internal" href="#term-158"><em class="xref std std-term">[UMA-casestudies]</em></a> .</p>
</div>
<div class="section" id="id28">
<h4><a class="toc-backref" href="#id214">利用条件</a><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p>Practical control of access among loosely coupled parties requires
more than just messaging protocols.
This specification defines only the technical &#8220;<strong>contract</strong>&#8221;
between UMA-conforming entities;
its companion <em class="xref std std-term">Binding Obligations specification</em> <a class="reference internal" href="#term-155"><em class="xref std std-term">[UMA-obligations]</em></a> defines
the expected behaviors of parties operating and using these entities.</p>
<p>Parties operating entities that claim to be UMA-conforming MUST
provide documentation affirmatively stating their acceptance of
the binding obligations contractual framework defined
in the Binding Obligations specification.</p>
</div>
<div class="section" id="id29">
<h4><a class="toc-backref" href="#id215">PDP/PEP</a><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<p>In enterprise settings,
application access management often involves letting back-office applications serve
only as policy enforcement points (PEPs),
depending entirely on access decisions coming from a central policy decision point (PDP)
to govern the access they give to requesters.
This separation eases auditing and allows policy administration
to scale in several dimensions.
UMA makes use of a separation similar to this,
letting the resource owner serve as a policy administrator
crafting authorization strategies for resources under their control.</p>
</div>
<div class="section" id="id30">
<h4><a class="toc-backref" href="#id216">OAuth2</a><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<p>The UMA protocol can be considered an advanced profile of <a class="reference internal" href="#term-149"><em class="xref std std-term">[OAuth2]</em></a>.
In order to increase interoperable communication among the authorization server,
resource server, and client, it defines several purpose-built APIs
related to the outsourcing of authorization,
themselves protected by OAuth in embedded fashion.</p>
</div>
<div class="section" id="id31">
<h4><a class="toc-backref" href="#id217">Protocol</a><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<p>The UMA protocol has three broad phases, as shown in Figure 1.</p>
<div class="highlight-python"><pre>The Three Phases of the UMA Profile of OAuth
                                        +--------------+
                                        |   resource   |
       +---------manage (A)------------ |     owner    |
       |                                +--------------+
       |         Phase 1:                      |
       |         protect a                control (B)
       |         resource                      |
       v                                       v
+------------+               +----------+--------------+
|            |               |protection|              |
|  resource  |               |   API    | authorization|
|   server   |&lt;-protect (C)--|  (needs  |    server    |
|            |               |   PAT)   |              |
+------------+               +----------+--------------+
| protected  |                          | authorization|
| resource   |                          |     API      |
|(needs RPT) |                          |  (needs AAT) |
+------------+                          +--------------+
       ^                                       |
       |         Phases 2 and 3:         authorize (D)
       |         get authorization,            |
       |         access a resource             v
       |                                +--------------+
       +---------access (E)-------------|    client    |
                                        +--------------+

                                        requesting party

                           Figure 1</pre>
</div>
<p>In broad strokes,
the phases are as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Protect a resource (described in <em class="xref std std-ref">Section 2</em>).</li>
<li>Get authorization (described in <em class="xref std std-ref">Section 3</em>).</li>
<li>Access a resource (described along with Phase 2 in Section 3).</li>
</ol>
</div></blockquote>
<p>In more detail, the phases work as follows:</p>
<div class="section" id="id32">
<h5><a class="toc-backref" href="#id218">リソース保護(PAT API)</a><a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic">
<li><p class="first">_Protect a resource:_</p>
<p>This phase accomplishes trust establishment
among the <a class="reference internal" href="#term-82"><em class="xref std std-term">resource owner</em></a>, <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>,
and <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>,
as well as enabling the resource server to register with
the authorization server descriptions of the resources to be protected.</p>
<p>This specification uses <a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a> to
enable dynamic introduction and resource registration.</p>
<p>In these circumstances,
where the resource owner has chosen to use a resource server
for managing online resources (&#8220;A&#8221;),
the resource owner introduces this resource server
to an authorization server using an OAuth-mediated interaction
that results in the authorization server
giving the resource server a <em class="xref std std-term">protection API token</em> (<em class="xref std std-term">PAT</em>).</p>
<p>The resource server then uses the authorization server&#8217;s protection API
to register sets of resources for which protection is being outsourced (&#8220;C&#8221;).
(Out of band of the UMA protocol,
the resource owner instructs the authorization server
what policies to associated with the registered resource sets (&#8220;B&#8221;).)</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id33">
<h5><a class="toc-backref" href="#id219">認可発行(RPT発行)</a><a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic" start="2">
<li><p class="first">_Get authorization:_</p>
<blockquote>
<div><p>This phase involves the client (along with its operator,
the &#8220;requesting party&#8221;) for the first time.</p>
<p>The client approaches the resource server seeking
access to a protected resource (&#8220;E&#8221;).</p>
<p>In order to access it,
the client must first obtain a requesting party token (RPT)
from the authorization server
on behalf of its requesting party.</p>
<p>The client and requesting party are then redirected
to the authorization server to ask for appropriate authorization data
(the form of this data depends on the RPT profile in use).</p>
<p>In doing so,
the requesting party must demonstrate to the authorization server
that it satisfies the resource owner&#8217;s policy
governing the sought-for resource and scope (&#8220;D&#8221;).</p>
<p>To use the authorization server&#8217;s authorization API in the first place,
the requesting party has to agree to communication with this server
for the purpose of seeking authorization,
which results in the client obtaining an authorization API token (AAT).</p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id34">
<h5><a class="toc-backref" href="#id220">リソースアクセス</a><a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic simple" start="3">
<li>_Access a resource:_ This phase involves the client successfully
presenting an RPT that has sufficient authorization data
associated with it to the resource server in order to gain access
to the desired resource (&#8220;E&#8221;).  In this sense, it is the &#8220;happy
path&#8221; within phase 2.</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="id35">
<h4><a class="toc-backref" href="#id221">デプロイメント</a><a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p>In deploying UMA,
implementers are expected to develop one or more profiles of UMA
(described in <em class="xref std std-ref">Section 5</em>)
that specify and restrict the various UMA protocol options,
according to the deployment conditions.</p>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1</a> )</p>
</div>
</div>
<div class="section" id="id36">
<span id="id37"></span><h3><a class="toc-backref" href="#id222">1.1.  Notational Conventions</a><a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>The key words &#8216;MUST&#8217;, &#8216;MUST NOT&#8217;, &#8216;REQUIRED&#8217;, &#8216;SHALL&#8217;, &#8216;SHALL NOT&#8217;,
&#8216;SHOULD&#8217;, &#8216;SHOULD NOT&#8217;, &#8216;RECOMMENDED&#8217;, &#8216;MAY&#8217;, and &#8216;OPTIONAL&#8217; in this
document are to be interpreted as described in [RFC2119].</p>
<p>Unless otherwise noted, all the protocol properties and values are
case sensitive.</p>
<p>( draft 06 <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.1</a> )</p>
</div>
<div class="section" id="id38">
<span id="id39"></span><h3><a class="toc-backref" href="#id223">1.2.  Basic Terminology</a><a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<p>UMA introduces the following new terms and enhancements of OAuth term
definitions.</p>
<dl class="glossary docutils">
<dt id="term-82"><span id="term-83"></span>resource owner<br />resource owners</dt>
<dd>The &#8220;user&#8221; in User-Managed Access; an OAuth resource owner.
This is typically an end-user (a natural person) but it can
also be a corporation or other legal person.</dd>
<dt id="term-84"><span id="term-85"></span>requesting party<br />requesting parties</dt>
<dd>An end-user, or a corporation or other legal person, that uses
a client to seek access to a protected resource.  The
requesting party may or may not be the same party as the
resource owner.</dd>
<dt id="term-86"><span id="term-87"></span>client<br />clients</dt>
<dd>An application making protected resource requests with the
resource owner&#8217;s authorization and on the requesting party&#8217;s
behalf.</dd>
<dt id="term-88"><span id="term-89"></span>claim<br />claims</dt>
<dd><p class="first">A statement of the value or values of one or more identity
attributes of a requesting party.</p>
<p class="last">A <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a> may need to provide claims
to an authorization server in order to satisfy policy
and gain permission for access to a protected
resource.</p>
</dd>
<dt id="term-90"><span id="term-91"></span>resource set<br />resource sets</dt>
<dd><p class="first">A set of one or more protected resources.</p>
<p class="last">In authorization policy terminology,
a resource set is the &#8220;object&#8221; being protected.</p>
</dd>
<dt id="term-92">scope type</dt>
<dd><p class="first">A bounded extent of access that is possible to perform on
a resource set.</p>
<p>In authorization policy terminology,
a scope type is one of the potentially many &#8220;verbs&#8221; that can logically
apply to a resource set (&#8220;object&#8221;).</p>
<p class="last">UMA associates scope types with labeled <a class="reference internal" href="#term-91"><em class="xref std std-term">resource sets</em></a>.</p>
</dd>
<dt id="term-93">authorization data</dt>
<dd><p class="first">Data associated with a requesting party token
that enables some combination of the authorization server and
resource server to determine the correct extent of access to
allow to a client.</p>
<p class="last">Authorization data is a key part of the definition of an RPT profile.</p>
</dd>
<dt id="term-94">permission</dt>
<dd><p class="first">A scope of access over a particular <a class="reference internal" href="#term-90"><em class="xref std std-term">resource set</em></a>
at a particular resource server that is being asked for by,
or being granted to, a <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a>.</p>
<p>In authorization policy terminology,
a permission is an entitlement that includes a &#8220;subject&#8221; (requesting party),
&#8220;verbs&#8221; (one or more scopes of access), and an &#8220;object&#8221; (resource set).</p>
<p class="last">A permission is one example of authorization data
that an authorization server may grant.</p>
</dd>
<dt id="term-95">permission ticket</dt>
<dd>A correlation <strong>handle</strong> that is conveyed from an
authorization server to a resource server,
from a resource server to a client,
and ultimately from a client to an authorization server,
to enable the authorization server to assess the correct resource owner policies
to apply to a request for an authorization grant.</dd>
</dl>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.2</a> )</p>
<table class="docutils field-list" frame="void" id="id40" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id41">
<h3><a class="toc-backref" href="#id224">1.3. Endpoints, Endpoint Protection, and Tokens</a><a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h3>
<p>Various UMA entities present protected APIs for other entities to use.</p>
<p>These APIs are as follows:</p>
<div class="section" id="id42">
<h4><a class="toc-backref" href="#id225">保護API(PAT)</a><a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p class="first">The authorization server presents a _protection <a href="#id303"><span class="problematic" id="id304">API_</span></a> to the
resource server, which encompasses the resource registration API
defined by the OAuth introduction specification
[OAuth-resource-reg], as well as additional functions standardized
by this specification.</p>
<p>This API is OAuth-protected,
requiring a resource server to obtain from the authorization server an OAuth
access token called a _protection API token (PAT)_.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id43">
<h4><a class="toc-backref" href="#id226">認可API(AAT)</a><a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p class="first">The authorization server presents an _authorization <a href="#id305"><span class="problematic" id="id306">API_</span></a> to the
client, as defined wholly by this specification.</p>
<p>This API is OAuth-protected,
requiring a client and its requesting party to obtain
from the authorization server an OAuth access token,
referred to in this specification
as an _authorization API token (AAT)_
to distinguish it from other tokens with other purposes.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id44">
<h4><a class="toc-backref" href="#id227">リソースAPI(RPT)</a><a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p class="first">The resource server presents a _protected <a href="#id307"><span class="problematic" id="id308">resource_</span></a> to the client,
which can be considered an application-specific or proprietary API.</p>
<p>This API is protected by the UMA profile of OAuth, requiring
a client to obtain from the authorization server an OAuth access token,
referred to in this specification as a _requesting party token (RPT)_
to distinguish it from other tokens with other purposes.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id45">
<h4><a class="toc-backref" href="#id228">標準OAuth エンドポイント</a><a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<p>The authorization server presents standard OAuth endpoints
for token issuance and resource owner authorization
in protecting its own UMA APIs, as follows.</p>
<p>Resource servers asking to use the protection API would be issued a PAT.
Clients and requesting parties asking to use the authorization API would be issued an AAT.</p>
<dl class="glossary docutils">
<dt id="term-96">token endpoint</dt>
<dd><p class="first">Part of standard OAuth, as profiled by UMA.</p>
<p class="last">The endpoint at which the resource server asks for a PAT on the
resource owner&#8217;s behalf.  Also the endpoint at which the client
asks for an AAT on the requesting party&#8217;s behalf.  (The
authorization server may also choose to issue a refresh token.)
This specification makes the OAuth token profile &#8220;bearer&#8221;
mandatory for the authorization server to implement.  It can
declare its ability to handle other token profiles.</p>
</dd>
<dt id="term-97">user authorization endpoint</dt>
<dd>Part of standard OAuth, as profiled by UMA;
used when the authorization code grant type (REQUIRED for
the authorization server to implement) is being used.  The
endpoint to which the resource server redirects an end-user
resource owner to authorize the former to use this
authorization server in outsourcing resource protection.  Also
the endpoint to which the client redirects the end-user
requesting party to authorize the former to use this
authorization server in seeking access.</dd>
</dl>
</div>
<div class="section" id="id46">
<h4><a class="toc-backref" href="#id229">リソースサーバー向けエンドポイント</a><a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h4>
<p>The authorization server presents the following endpoints
to the resource server as part of its protection API;
these endpoints MUST be OAuth-protected and require a PAT for access,
for which the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221;
OAuth scope is required:</p>
<dl class="glossary docutils">
<dt id="term-98">resource set registration endpoint</dt>
<dd><p class="first">The endpoint at which the
resource server registers resource sets it wants the
authorization server to protect, as defined by
<a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>.</p>
<p class="last">The &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope
is a superset of the scope that governs usage of the resource
set registration endpoint.</p>
</dd>
<dt id="term-99">permission registration endpoint</dt>
<dd>The endpoint at which
the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> registers permissions that
it anticipates a client will shortly be asking for from the authorization server.</dd>
<dt id="term-100">introspection endpoint</dt>
<dd><p class="first">The endpoint at which the resource server
forwards an RPT that has accompanied an access request to learn
what authorization data is associated with it, as defined by
<a class="reference internal" href="#term-147"><em class="xref std std-term">[OAuth-introspection]</em></a>.</p>
<p>This specification defines an RPT profile, &#8220;bearer&#8221;,
which is mandatory for the authorization
server to implement and which, if used, REQUIRES the resource
server to use this endpoint (see <em class="xref std std-ref">Section 3.3</em>).</p>
<p class="last">The &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope
is a superset of the scope that governs usage of the token
introspection endpoint.</p>
</dd>
</dl>
</div>
<div class="section" id="id47">
<h4><a class="toc-backref" href="#id230">クライアント向けエンドポイント</a><a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h4>
<p>The authorization server presents the following endpoints
to the client as part of its authorization API;
these endpoints are OAuth-protected and require an AAT for access,
for which the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authorization">http://docs.kantarainitiative.org/uma/scopes/authorization</a>&#8221;
OAuth scope is required:</p>
<dl class="glossary docutils">
<dt id="term-101">RPT endpoint</dt>
<dd>The endpoint at which the client asks the authorization
server for the issuance of an RPT relating to this requesting
party, resource server, and authorization server.</dd>
<dt id="term-102">permission request endpoint</dt>
<dd>The endpoint at which the client asks
for authorization data to be associated with an RPT to enable
authorized access.</dd>
</dl>
</div>
<div class="section" id="id48">
<h4><a class="toc-backref" href="#id231">リソースサーバーのクライアント向けエンドポイント</a><a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<p>The resource server presents one or more protected resource endpoints
to the client;
these endpoints are protected by the UMA profile of OAuth and
require an RPT with sufficient authorization data to permit access:</p>
<dl class="glossary docutils">
<dt id="term-103">protected resource endpoint</dt>
<dd>An application-specific endpoint at
which a client attempts to access resources.
This can be a singular API endpoint, one of a set of API endpoints,
a URI corresponding to an HTML document, or any other URI.</dd>
</dl>
</div>
<div class="section" id="id49">
<h4><a class="toc-backref" href="#id232">トークン管理</a><a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h4>
<p>The authorization server has the opportunity to manage the validity
periods of the access tokens, the corresponding refresh tokens where applicable,
and even the client credentials that it issues.</p>
<p>Different lifetime strategies may be suitable for different resources
and scopes of access, and the authorization server has the
opportunity to give the resource owner control through policy.</p>
<p>These options are all outside the scope of this specification.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.3</a> )</p>
</div>
</div>
<div class="section" id="id50">
<span id="id51"></span><h3><a class="toc-backref" href="#id233">1.4.  Scopes, Resource Sets, Permissions, and Authorization</a><a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id52">
<h4><a class="toc-backref" href="#id234">リソースセットとスコープタイプ</a><a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h4>
<p>UMA extends the OAuth concept of a &#8220;scope&#8221; by defining <em class="xref std std-term">scope types</em>
as applying to labeled resource sets,
rather than leaving the relevant resources
(such as API endpoints or URIs) implicit.</p>
<p>A resource set can have any number of scope types,
which together describe the universe of actions that _can <a href="#id309"><span class="problematic" id="id310">be_</span></a> taken
on this protected resource set.</p>
<p>For example,
a resource set representing a status update API might have scopes
that include adding an update or reading updates.
A resource set representing a photo album might have scopes that
include viewing a slideshow or printing the album.
Resource servers register resource sets and their scope types
when there is not yet any particular requesting party or client in the picture.</p>
<p>Resource sets and scope types have meaning only to resource servers
and their users,
in the same way that application-specific protected resource APIs
have meaning only to these entities.
The authorization server is merely a conveyor of labels and
descriptions for these constructs,
to help the resource owner set policies that guide eventual authorization processes.</p>
</div>
<div class="section" id="id53">
<h4><a class="toc-backref" href="#id235">パーミッション</a><a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h4>
<p>A permission, in contrast to a <a class="reference internal" href="#term-92"><em class="xref std std-term">scope type</em></a>,
reflects an _actual_ entitlement to access a <a class="reference internal" href="#term-90"><em class="xref std std-term">resource set</em></a>
using one or more scope types,
as the result of an authorization process undergone by a specific <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a>.</p>
<p>A <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> registers a <em class="xref std std-term">permission request</em>
with an authorization server on behalf of a client
(and its requesting parties)
that has attempted access,
and transmits the resulting <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a> to the <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a>.</p>
<p>The client subsequently asks the authorization server for <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a>
to be associated with its RPT.
If the <em class="xref std std-term">RPT profile</em> is in use,
the authorization server grants (or denies) the permission to the requesting party.
(If another token profile is in use,
the authorization server might generate a different type of authorization data,
such as an authorization decision or a package of the claims it has collected.)</p>
<p>An RPT is bound to a requesting party,
the client being used by that party,
the resource server at which protected resources of interest reside,
and the authorization server that protects those resources.</p>
<p>It becomes associated with as many pieces of authorization data
as are appropriate for gaining authorized access to resources protected
at that resource server by any single authorization server
(even if that data applies to resources managed by two or more different
resource owners at the same resource server using the same authorization server).</p>
<p>In the case of the UMA &#8220;bearer&#8221; token profile,
each individual permission is associated with the resource owner
whose policies drove the authorization process.
This enables meaningful, auditable, and potentially legally enforceable authorization
for access (see <a class="reference internal" href="#term-155"><em class="xref std std-term">[UMA-obligations]</em></a>).</p>
<p>Permissions have a validity period that the authorization server has
the opportunity to control (independently or with input from the resource owner).
These control options are outside the scope of this specification.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.4">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.4</a> )</p>
</div>
</div>
<div class="section" id="id54">
<span id="id55"></span><h3><a class="toc-backref" href="#id236">1.5. Authorization Server Configuration Data</a><a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h3>
<p>The authorization server MUST provide configuration data to other
entities it interacts with in aJSON [RFC4627] document that resides
in an /uma-configuration directory at at its hostmeta [RFC6415]
location.</p>
<p>The configuration data documents major conformance options
supported by the authorization server
(described further in <em class="xref std std-ref">Section 8</em>)
and protection and authorization API endpoints (as described in <em class="xref std std-ref">Section 1.3</em>).
(At the appropriate time, this section will instead profile
whatever self-describing metadata specification OAuth adopts,
for example, <a class="reference internal" href="#term-156"><em class="xref std std-term">[OAuth-linktypes]</em></a> or <a class="reference internal" href="#term-157"><em class="xref std std-term">[OAuth-meta]</em></a>.)</p>
<p>The configuration data has the following properties.
All endpoint URIs supplied SHOULD require the use of
a transport-layer security mechanism such as TLS.</p>
<dl class="glossary docutils">
<dt id="term-104">version</dt>
<dd>REQUIRED.  The version of the UMA core protocol to which this
authorization server conforms.  The value MUST be the string
&#8220;1.0&#8221;.</dd>
<dt id="term-105">issuer</dt>
<dd>REQUIRED.  A URI indicating the party operating the
authorization server.</dd>
<dt id="term-106">dynamic_client_endpoint</dt>
<dd>OPTIONAL.  The endpoint to use for performing dynamic client
registration through . [DynClientReg]</dd>
<dt id="term-107">oauth_token_profiles_supported</dt>
<dd>REQUIRED.  PAT and AAT profiles produced by this authorization
server.  The property value is an array of string values.
Currently the only string value for this property defined by
this specification is &#8220;bearer&#8221;, corresponding to the OAuth
bearer token profile [OAuth-bearer].  The authorization server
is REQUIRED to support this profile, and to supply this string
value explicitly.  The authorization server MAY declare its
support for additional access token profiles by providing a
unique absolute URI in a string value in the array for each
one.</dd>
<dt id="term-108">uma_token_profiles_supported</dt>
<dd>REQUIRED.  RPT types produced by this authorization server.
The property value is an array of string values.  Currently the
only string value for this property defined by this
specification is &#8220;bearer&#8221;, whose associations the resource
server MUST determine through a token introspection interaction
with the authorization server (see Section 3.3 for the
definition of this profile).  The authorization server is
REQUIRED to support the UMA bearer token profile, and to supply
this string value explicitly.  The authorization server MAY
declare its support for RPTs using additional RPT profiles by
providing a unique absolute URI in a string value in the array
for each one.</dd>
<dt id="term-109">oauth_grant_types_supported</dt>
<dd>REQUIRED.  OAuth grant types supported by this authorization
server in issuing PATs and AATs.  The property value is an
array of string values.  Each string value MUST be one of the
grant_type values defined in [OAuth2], or alternatively an
extension grant type indicated by a unique absolute URI.</dd>
<dt id="term-110">claim_profiles_supported</dt>
<dd>OPTIONAL.  Claim formats and associated sub-protocols for
gathering claims from requesting parties, as supported by this
authorization server.  The property value is an array of string
values.  Currently the only string value for this property
defined by this specification is &#8220;openid&#8221;, for which details
are supplied in Section 3.5.1.1.  The authorization server MAY
declare its support for additional claim profiles by assigning
a unique absolute URI in a string value in the array for each
one.</dd>
<dt id="term-111">token_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server or
client asks the authorization server for a PAT or AAT,
respectively.  A requested scope of
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221;
results in a PAT.  A requested scope of
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authorization">http://docs.kantarainitiative.org/uma/scopes/authorization</a>&#8221;
results in an AAT.  Available HTTP methods are as defined by
[OAuth2] for a token endpoint.</dd>
<dt id="term-112">user_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
gathers the consent of the end-user resource owner or the
client gathers the consent of the end-user requesting party, if
the &#8220;authorization_code&#8221; grant type is used.  Available HTTP
methods are as defined by [OAuth2] for an end-user
authorization endpoint.</dd>
<dt id="term-113">permission_registration_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
registers permissions with the authorization server for which a
client will be seeking authorization on its requesting party&#8217;s
behalf (see Section 3.2).  A PAT MUST accompany requests to
this protected endpoint.</dd>
<dt id="term-114">rpt_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the client ask the
authorization server for an RPT.  An AAT token MUST accompany
requests to this protected endpoint.</dd>
<dt id="term-115">rpt_status_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the resource server
introspects an RPT presented to it by a client (see
Section 3.3).  A PAT MUST accompany requests to this protected
endpoint.</dd>
<dt id="term-116">permission_request_endpoint</dt>
<dd>REQUIRED.  The endpoint URI at which the client asks, on its
requesting party&#8217;s behalf, to have authorization data
associated with its RPT.  An AAT MUST accompany requests to
this protected endpoint.</dd>
</dl>
<p>Example of authorization server configuration data that resides at
<a class="reference external" href="https://example.com/.well-known/uma-configuration">https://example.com/.well-known/uma-configuration</a> (note the use of
https: for endpoints throughout):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
<span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="s2">&quot;issuer&quot;</span><span class="o">:</span><span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
<span class="s2">&quot;dynamic_client_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/dyn_client_reg_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;oauth_token_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;bearer&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;uma_token_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;bearer&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;oauth_grant_types_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;authorization_code&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;claim_profiles_supported&quot;</span><span class="o">:</span><span class="p">[</span>
  <span class="s2">&quot;openid&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;token_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/token_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;user_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/user_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;resource_set_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/rsrc_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;rpt_status_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/status_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;permission_registration_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/rs/perm_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;rpt_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/client/rpt_uri&quot;</span><span class="p">,</span>
<span class="s2">&quot;permission_request_endpoint&quot;</span><span class="o">:</span><span class="s2">&quot;https://as.example.com/client/perm_uri&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Authorization server configuration data MAY contain extension
properties that are not defined in this specification.  Extension
names that are unprotected from collisions are outside the scope of
the current specification.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.5">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-1.5</a> )</p>
<table class="docutils field-list" frame="void" id="id56" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id57">
<h2><a class="toc-backref" href="#id237">2. Protecting a Resource</a><a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h2>
<p>Phase 1 of UMA is protecting a resource.</p>
<p>The resource owner,
resource server, and authorization server perform the following steps
to successfully complete Phase 1
(assuming that the resource server has discovered the authorization server&#8217;s configuration data
and endpoints as needed):</p>
<blockquote>
<div><ul>
<li><p class="first">The resource server and authorization server establish mutual
trust through the issuance of client credentials to the resource
server.</p>
<p>It is OPTIONAL for the client credentials to be provided
dynamically through <a class="reference internal" href="#term-161"><em class="xref std std-term">[DynClientReg]</em></a>);
alternatively, they MAY use a static process.</p>
</li>
<li><p class="first">The resource owner, resource server, and authorization server
establish three-way trust through the issuance of a PAT.</p>
<p>See <em class="xref std std-ref">Section 2.1</em> for additional details.</p>
</li>
<li><p class="first">The resource server registers any resource sets with the
authorization server that are intended to be protected.</p>
<p>See <em class="xref std std-ref">Section 2.2</em> for additional details.</p>
</li>
</ul>
</div></blockquote>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2</a> )</p>
<table class="docutils field-list" frame="void" id="id58" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="id59">
<h3><a class="toc-backref" href="#id238">2.1. Resource Server Obtains PAT</a><a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h3>
<p>In this step,
the resource server acquires a PAT from the authorization server.</p>
<p>The token represents the approval of the
resource owner for this resource server to trust this authorization
server for protecting resources belonging to this resource owner.  It
is OPTIONAL for the resource owner to introduce the resource server
to the authorization server dynamically through the process defined
in <a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>);
alternatively,
they MAY use a static process that may or may not directly
involve the resource owner at introduction time.</p>
<p>The resource server MUST use OAuth 2.0 [OAuth2] to obtain the PAT.</p>
<p>Here the resource server acts in the role of an OAuth client
requesting the
&#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope, which
authorizes it to use the authorization server&#8217;s resource set
registration endpoint (as defined in <a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>)
as well as additional protection API endpoints.</p>
<p>Once the resource server has obtained its PAT,
it presents it to the authorization server at
various protection API endpoints.</p>
<p>(NOTE: The &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221;
scope keyword is a URI that resolves to a JSON-encoded scope
description, in the fashion of UMA scope types.  This scope
description is non-normative.)</p>
<p>The authorization server MAY support the use of any OAuth grant type for PAT issuance,
but MUST support the authorization_code grant type,
and SHOULD support the SAML bearer token grant type [OAuth-SAML]
(<a class="reference external" href="urn:ietf:params:oauth:grant-type:saml2-bearer">urn:ietf:params:oauth:grant-type:saml2-bearer</a>) if it anticipates
working with resource servers that are operating in environments
where the use of SAML is prevalent.  The authorization server MUST
indicate all grant types it supports for PAT issuance in its
configuration data.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.1</a> )</p>
<table class="docutils field-list" frame="void" id="id60" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id61">
<h3><a class="toc-backref" href="#id239">2.2. Resource Server Registers Sets of Resources to Be Protected</a><a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h3>
<p>Once the resource server has received a PAT,
for any of the resource owner&#8217;s sets of resources that are to be protected by this
authorization server, it registers these resource sets in a timely fashion.
To do this, the resource server uses the resource set registration API defined in <a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>.</p>
<p>Note: The resource server is free to offer the option to protect any
subset of the resource owner&#8217;s resources using different
authorization servers or other means entirely, or to protect some
resources and not others.  Additionally, the choice of protection
regimes can be made explicitly by the resource owner or implicitly by
the resource server.  Any such partitioning by the resource server or
owner is outside the scope of this specification.</p>
<p>On successfully registering a resource set, the RS MUST use access
control mechanisms to limit access to any resources corresponding to
this resource set, relying on the AS to supply currently valid
permissions for authorized access.  The RS MUST outsource protection
to the AS according to the currently registered state of a resource
set.  This requirement holds true so long as the RS has one or more
registsred resource sets.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-2.2</a> )</p>
</div>
<div class="section" id="host-obtains-protection-api-token">
<span id="uma-core-2-3"></span><h3><a class="toc-backref" href="#id240">2.3.  Host Obtains Protection API Token</a><a class="headerlink" href="#host-obtains-protection-api-token" title="Permalink to this headline">¶</a></h3>
<p>In this step, the host acquires a PAT from the AM.  The token
represents the approval of the authorizing user for this host to
trust this AM for protecting resources belonging to this user.</p>
<p>The host MUST use OAuth 2.0 [OAuth2] to obtain the protection API
token.  Here the host acts in the role of an OAuth client requesting
the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/prot.json">http://docs.kantarainitiative.org/uma/scopes/prot.json</a>&#8221; scope;
the authorizing user acts in the role of an OAuth end-user resource
owner; and the AM acts in the role of an OAuth authorization server.
Once the host has obtained its PAT, it presents it to the AM at
various protection API endpoints; in presenting these endpoints the
AM acts in the role of a resource server.</p>
<p>The AM MAY support the use of any grant type, but MUST support the
authorization_code grant type, and SHOULD support the SAML bearer
token grant type [OAuth-SAML]
(<a class="reference external" href="urn:ietf:params:oauth:grant-type:saml2-bearer">urn:ietf:params:oauth:grant-type:saml2-bearer</a>) if it anticipates
working with hosts that are operating in environments where the use
of SAML is prevalent.  The AM MUST indicate all grant types it
supports in its configuration data, as defined in Section 1.5.</p>
<p>The host has completed this step successfully when it possesses a PAT
it can use to get access to the AM&#8217;s protection API on this user&#8217;s
behalf.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="host-registers-sets-of-resources-to-be-protected">
<span id="uma-core-2-4"></span><h3><a class="toc-backref" href="#id241">2.4. Host Registers Sets of Resources to Be Protected</a><a class="headerlink" href="#host-registers-sets-of-resources-to-be-protected" title="Permalink to this headline">¶</a></h3>
<p>Once the host has received a PAT, for any of the user&#8217;s sets of
resources that are to be protected by this AM, it MUST register these
<a class="reference internal" href="#term-91"><em class="xref std std-term">resource sets</em></a> at the AM&#8217;s <em class="xref std std-term">registration endpoint</em>.</p>
<p>Note that the host is free to offer the option to protect any subset
of the user&#8217;s resources using different AMs or other means entirely,
or to protect some resources and not others.  Additionally, the
choice of protection regimes can be made explicitly by the user or
implicitly by the host.  Any such partitioning by the host or user is
outside the scope of this specification.</p>
<p>See <em class="xref std std-ref">Section 10</em> for an extended example of registering <a class="reference internal" href="#term-91"><em class="xref std std-term">resource sets</em></a>.</p>
<p>(draft 05)</p>
<div class="section" id="scope-descriptions">
<span id="uma-core-2-4-1"></span><h4><a class="toc-backref" href="#id242">2.4.1. Scope Descriptions</a><a class="headerlink" href="#scope-descriptions" title="Permalink to this headline">¶</a></h4>
<p>A <strong>scope</strong> is a bounded extent of access that is possible to perform on
a resource set.  A scope description is a JSON document with the
following properties and a Content-Type of <strong>application/uma-scope+json</strong>:</p>
<dl class="glossary docutils">
<dt id="term-name">name</dt>
<dd><p class="first">REQUIRED.</p>
<p>A human-readable string describing some scope (extent) of access.</p>
<p>This name is intended for ultimate use in the AM&#8217;s user interface
to assist the user in setting policies for protected resource sets
that have this available scope.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>「三井住友銀行:普通預金口座」とか、「三井住友銀号:お客様情報」とか</li>
</ul>
</div>
</dd>
<dt id="term-icon-uri">icon_uri</dt>
<dd><p class="first">OPTIONAL.</p>
<p>A URI for a graphic icon representing the scope.</p>
<p class="last">The referenced icon is intended for ultimate use in the AM&#8217;s user interface
to assist the user in setting policies for protected
resource sets that have this available scope.</p>
</dd>
</dl>
<p>For example, this description characterizes a scope that involves
reading or viewing resources (vs. creating them or editing them in
some fashion):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;View&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/reading-glasses&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Scope descriptions MAY contain extension properties
that are not defined in this specification.
Extension names that are unprotected
from collisions are outside the scope of the current specification.</p>
<p>A host MUST list a <a class="reference internal" href="#term-90"><em class="xref std std-term">resource set</em></a>&#8216;s available scopes using URI references
(as defined in <a class="reference internal" href="#uma-core-2-4-2"><em>Section 2.4.2</em></a>).</p>
<p>The scopes available for use at any one host MUST have unique URI references
so that the host&#8217;s scope descriptions are uniquely distinguishable.
A scope URI reference MAY include a fragment identifier.
Scope descriptions MAY reside anywhere.
The host is not required to self-host scope descriptions
and may wish to point to standardized scope descriptions residing elsewhere.
Scope description documents MUST be accessible
to AMs through GET calls made to these URI references.</p>
<p>See <em class="xref std std-ref">Section 1.4</em> for further discussion of scope-related concepts, and
Section 10 for a long-form example of scopes used in resource set
registration.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="resource-set-descriptions">
<span id="uma-core-2-4-2"></span><h4><a class="toc-backref" href="#id243">2.4.2. Resource Set Descriptions</a><a class="headerlink" href="#resource-set-descriptions" title="Permalink to this headline">¶</a></h4>
<p>The host defines a resource set that needs protection
by registering a resource set description at the AM.
The host registers the description and manages its lifecycle at the AM&#8217;s host resource set
registration endpoint by using the resource set registration API,
as defined in Section 2.4.3.</p>
<p>A resource set description is a JSON document with the following
properties and a Content-Type of <strong>application/uma-resource-set+json:</strong></p>
<dl class="glossary docutils">
<dt id="term-119">name</dt>
<dd><p class="first">REQUIRED.</p>
<p>A human-readable string describing a set of one or more resources.
The AM SHOULD use the name in its user interface to assist the user
in setting policies for protecting this
resource set.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>「三井住友銀号:総合口座」とか</li>
</ul>
</div>
</dd>
<dt id="term-120">icon_uri</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">A URI for a graphic icon representing the
resource set.  If provided, the AM SHOULD use the referenced icon
in its user interface to assist the user in setting policies for
protecting this resource set.</p>
</dd>
<dt id="term-scopes">scopes</dt>
<dd><p class="first">REQUIRED.</p>
<p>An array providing the URI references of <em class="xref std std-ref">scope descriptions</em>
that are available for this resource set.</p>
<p>The AM SHOULD use the scope names and any icons defined as part of the
referenced scopes in its user interface to assist the user in
setting policies for protecting this resource set.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>「三井住友銀行:普通預金口座」、「三井住友銀行:お客様情報」、、、、、</li>
</ul>
</div>
</dd>
</dl>
<p>For example, this description characterizes a resource set (a photo
album) that can potentially be only viewed, or alternatively to which
full access can be granted; the URIs point to scope descriptions as
defined in <a class="reference internal" href="#uma-core-2-4-1"><em>Section 2.4.1</em></a>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Photo Album&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower.png&quot;</span><span class="p">,</span>
  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Resource set descriptions MAY contain extension properties that are
not defined in this specification.  Extension names that are
unprotected from collisions are outside the scope of the current
specification.</p>
<p>When a host creates or updates a resource set description
(see <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>),
the AM MUST attempt to retrieve the referenced scope
descriptions.  It MAY cache such descriptions as long as indicated in
the HTTP cache-control header for the scope description resource
unless the resource set description is subsequently updated within
the validity period.  At the beginning of an authorizing user&#8217;s login
session at the AM, the AM MUST attempt to re-retrieve scope
descriptions applying to that user whose cached versions have
expired.</p>
<p>(draft 05)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">For Connect Aggreated Claims,
following additional claims may be provided
for the AM to fetch resources in charge of the resource owner.</p>
<blockquote>
<div><ul class="simple">
<li>refresh_token(required)</li>
<li>access_token(potional)</li>
<li>token endpoint</li>
<li>resource endpoint</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">And, if aother API call is lengthy, following claims should be returned for
the <a class="reference internal" href="oauth.html#oauth-client-authentication"><em>client authentication</em></a> to
the token endpoint.</p>
<blockquote>
<div><ul class="simple">
<li>client identfiier</li>
<li>client secret</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Tokens&#8217; scope MUST be any in scopes of this resource set description.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="resource-set-registration-api">
<span id="uma-core-2-4-3"></span><h4><a class="toc-backref" href="#id244">2.4.3. Resource Set Registration API</a><a class="headerlink" href="#resource-set-registration-api" title="Permalink to this headline">¶</a></h4>
<p>The host uses the RESTful API at the AM&#8217;s resource set registration
endpoint to create, read, update, and delete resource set
descriptions, along with listing groups of such descriptions.  The
host MUST use its valid PAT obtained previously to gain access to this endpoint.
The resource set registration API is a subset of the protection API.</p>
<p>The host is free to use its own methods of identifying and describing resource sets.
The AM MUST treat them as opaque for the purpose of authorizing access,
other than associating them with the authorizing user
(as represented by the PAT used to access the API).
On successfully registering a resource set, the host MUST use UMA
mechanisms to limit access to any resources corresponding to this
resource set, relying on the AM to supply currently valid permissions
for authorized access.
The host MUST outsource protection to the AM according to the currently registered state of a resource set.  This
requirement holds true so long as the host has one or more registsred
resource sets.</p>
<p>(Note carefully the similar but distinct senses in which the word
&#8220;resource&#8221; is used in this section.  UMA resource set descriptions
are themselves managed as web resources at the AM through this API.)</p>
<p>The AM MUST present an API for registering resource set descriptions
at a set of URIs with the structure &#8220;<a class="reference internal" href="#term-rsreguri"><em class="xref std std-term">{rsreguri}</em></a>/resource_set/<a class="reference internal" href="#term-rsid"><em class="xref std std-term">{rsid}</em></a>&#8221;,
where the PAT provides sufficient context to distinguish between
identical resource set identifiers assigned by different hosts.</p>
<p>The components of these URIs are defined as follows:</p>
<dl class="glossary docutils">
<dt id="term-rsreguri">{rsreguri}</dt>
<dd>The AM&#8217;s resource set registration endpoint as advertised
in its configuration data (see Section 1.5).</dd>
<dt id="term-rsid">{rsid}</dt>
<dd>An identifier for a resource set description.</dd>
</dl>
<p>Without a specific resource set identifier path component, the URI
applies to the set of resource set descriptions already registered.</p>
<p>Following is a summary of the five registration operations the AM is
REQUIRED to support.  Each is defined in its own section below.  All
other methods are unsupported.  This API uses ETag and If-Match to
ensure the desired resource at the AM is targeted.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#uma-core-create-resource-set-description"><em>Create resource set description</em></a>: PUT /resource_set/{rsid}</li>
<li><a class="reference internal" href="#uma-core-read-resource-set-description"><em>Read resource set description</em></a>: GET /resource_set/{rsid}</li>
<li><a class="reference internal" href="#uma-core-update-resource-set-description"><em>Update resource set description</em></a>: PUT /resource_set/{rsid} with If-
Match</li>
<li><a class="reference internal" href="#uma-core-delete-resource-set-description"><em>Delete resource set description</em></a>: DELETE /resource_set/{rsid}</li>
<li><a class="reference internal" href="#uma-core-list-resource-set-descriptions"><em>List resource set descriptions</em></a>: GET /resource_set/ with If-Match</li>
</ul>
</div></blockquote>
<p>If the request to the resource set registration endpoint is incorrect,
then the AM responds with an error message (see <em class="xref std std-ref">Section 4.2</em>)
by including one of the following error codes with the response:</p>
<dl class="glossary docutils">
<dt id="term-unsupported-method-type">unsupported_method_type</dt>
<dd>The host request used an unsupported HTTP
method.  The AM MUST respond with the HTTP 405 (Method Not
Allowed) status code and MUST fail to act on the request.</dd>
<dt id="term-not-found">not_found</dt>
<dd>The resource set requested from the AM cannot be found.
The AM MUST respond with HTTP 404 (Not Found) status code.</dd>
<dt id="term-precondition-failed">precondition_failed</dt>
<dd>The resource set that was requested to be
deleted or updated at the AM did not match the If-Match value
present in the request.  The AM MUST respond with HTTP 412
(Precondition Failed) status code and MUST fail to act on the
request.</dd>
</dl>
<p>(draft 05)</p>
<div class="section" id="create-resource-set-description">
<span id="uma-core-create-resource-set-description"></span><span id="uma-core-2-4-3-1"></span><h5><a class="toc-backref" href="#id245">2.4.3.1. Create Resource Set Description</a><a class="headerlink" href="#create-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Adds a new resource set description using the PUT method,
thereby putting it under the AM&#8217;s protection.
If the request is successful,
the AM MUST respond with a status message
that includes an <em class="xref std std-term">ETag</em> header and <strong>_id</strong> and <strong>_rev</strong> properties
for managing resource set description versioning.</p>
<p>Form of a &#8220;create resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>PUT /resource_set/{rsid} HTTP/1.1
Content-Type: application/uma-resource-set+json
...

(body contains JSON resource set description to be created)</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: (matches "_rev" property in returned object)
...

{
  "status": "created",
  "_id": (id of created resource set),
  "_rev": (ETag of created resource set)
}</pre>
</div>
<p>On successful registration,
the AM MAY return a <em class="xref std std-term">redirect policy URI</em>
to the host in a property with the name &#8220;policy_uri&#8221;.
This URI allows the host to redirect the user to a specific user interface
within the AM where the user can immediately set or modify access policies
for the resource set that was just registered.</p>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: (matches "_rev" property in returned object)
...

{
  "status": "created",
  "_id": (id of created resource set),
  "_rev": (ETag of created resource set)
  "policy_uri":"http://am.example.com/host/222/resource/333/policy"
}</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="read-resource-set-description">
<span id="uma-core-read-resource-set-description"></span><span id="uma-core-2-4-3-2"></span><h5><a class="toc-backref" href="#id246">2.4.3.2.  Read Resource Set Description</a><a class="headerlink" href="#read-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Reads a previously registered resource set description using the GET
method.
If the request is successful,
the AM MUST respond with a status message
that includes an <em class="xref std std-term">ETag</em> header and <strong>_id</strong> and <strong>_rev</strong>
properties for managing resource set description versioning.</p>
<p>Form of a &#8220;read resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>GET /resource_set/{rsid} HTTP/1.1
...</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/uma-resource-set+json
...

(body contains JSON resource set description, including _id and _rev)</pre>
</div>
<p>If the referenced resource does not exist,
the AM MUST produce an error response with an error property value of &#8220;<strong>not_found</strong>&#8221;,
as defined in <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>.</p>
<p>On successful read,
the AM MAY return a redirect policy URI to the host in a property with the name &#8220;<a class="reference internal" href="reg.html#term-policy-uri"><em class="xref std std-term">policy_uri</em></a>&#8221;.
This URI allows the host to redirect the user to a specific user interface within the AM
where the user can immediately set or modify access policies for the resource set that was read.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>policy_uri seems to be a part of scope description JSON.....</li>
</ul>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="update-resource-set-description">
<span id="uma-core-update-resource-set-description"></span><span id="uma-core-2-4-3-3"></span><h5><a class="toc-backref" href="#id247">2.4.3.3.  Update Resource Set Description</a><a class="headerlink" href="#update-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Updates a previously registered resource set description using the
PUT method, thereby changing the resource set&#8217;s protection
characteristics.  If the request is successful, the AM MUST respond
with a status message that includes an <em class="xref std std-ref">ETag</em> header and <strong>_id</strong> and <strong>_rev</strong>
properties for managing resource set description versioning.</p>
<p>Form of an &#8220;update resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>PUT /resource_set/{rsid} HTTP/1.1
Content-Type: application/resource-set+json
If-Match: (entity tag of resource)
...

(body contains JSON resource set description to be updated)</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 204 No Content
ETag: "2"
...</pre>
</div>
<p>If the entity tag does not match, the AM MUST produce an error
response with an error property value of &#8220;precondition_failed&#8221;, as
defined in <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>.</p>
<p>On successful update, the AM MAY return a redirect policy URI to the
host in a property with the name &#8220;policy_uri&#8221;.  This URI allows the
host to redirect the user to a specific user interface within the AM
where the user can immediately set or modify access policies for the
resource set that was just updated.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>It is unclear where <strong>policy_uri</strong> should be returned. in header or paylaod ?</li>
</ul>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="delete-resource-set-description">
<span id="uma-core-delete-resource-set-description"></span><span id="uma-core-2-4-3-4"></span><h5><a class="toc-backref" href="#id248">2.4.3.4.  Delete Resource Set Description</a><a class="headerlink" href="#delete-resource-set-description" title="Permalink to this headline">¶</a></h5>
<p>Deletes a previously registered resource set description using the
DELETE method, thereby removing it from the AM&#8217;s protection regime.</p>
<p>Form of a &#8220;delete resource set description&#8221; HTTP request:</p>
<div class="highlight-python"><pre>DELETE /resource_set/{rsid}
If-Match: (entity tag of resource)
...</pre>
</div>
<p>Form of a successful HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 204 No content
...</pre>
</div>
<p>As defined in <a class="reference internal" href="#uma-core-2-4-3"><em>Section 2.4.3</em></a>, if the referenced resource does not
exist the AM MUST produce an error response with an error property
value of &#8220;not_found&#8221;, and if the entity tag does not match the AM
MUST produce an error response with an error property value of
&#8220;precondition_failed&#8221;.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="list-resource-set-descriptions">
<span id="uma-core-list-resource-set-descriptions"></span><span id="uma-core-2-4-3-5"></span><h5><a class="toc-backref" href="#id249">2.4.3.5.  List Resource Set Descriptions</a><a class="headerlink" href="#list-resource-set-descriptions" title="Permalink to this headline">¶</a></h5>
<p>Lists all previously registered resource set identifiers for this
user using the GET method.  The AM MUST return the list in the form
of a JSON array of {rsid} values.</p>
<p>The host uses this method as a first step in checking whether its
understanding of protected resources is in full synchronization with
the AM&#8217;s understanding.</p>
<p>Form of a &#8220;list resource set descriptions&#8221; HTTP request:</p>
<div class="highlight-python"><pre>GET /resource_set HTTP/1.1
...</pre>
</div>
<p>HTTP response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
...

(body contains JSON array of {rsid} values)</pre>
</div>
<p>(draft 05)</p>
<table class="docutils field-list" frame="void" id="id62" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="section" id="id63">
<h2><a class="toc-backref" href="#id250">3. Getting Authorization and Accessing a Resource</a><a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h2>
<p>Phase 2 of UMA is getting authorization,
and phase 3 is accessing a resource.</p>
<p>In these phases,
an authorization server orchestrates and controls clients&#8217; access
(on their requesting parties&#8217; behalf)
to a resource owner&#8217;s protected resources at a resource server,
under conditions dictated by that resource owner.</p>
<p>Phase 3 is merely the successful completion of a client&#8217;s access attempt
that initially involved several embedded interactions among the <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a>,
<a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a>, <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>,
and <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> in phase 2.</p>
<p>Phase 2 always begins with the <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a> attempting access
at a <a class="reference internal" href="#term-103"><em class="xref std std-term">protected resource endpoint</em></a> at the resource server.
How the client came to learn about this endpoint is out of scope for this specification.
The resource owner might, for example,
have advertised its availability publicly on a blog or other website,
listed it in a discovery service, or emailed a link to a particular
intended requesting party.</p>
<p>The resource server responds to the client&#8217;s access request in one of
several ways depending on the circumstances of the request,
either immediately or having first performed one or more embedded
interactions with the authorization server.
Depending on the nature of the resource server&#8217;s response to an failed access attempt,
the client and its operator engage in embedded interactions
with the authorization server before re-attempting access.</p>
<p>The interactions are as follows.</p>
<p>Each interaction MAY be the last,
if the client chooses not to continue pursuing the access attempt or
the resource server chooses not to continue facilitating it.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The client attempts access at a particular protected resource at
a resource server (see <em class="xref std std-ref">Section 3.1</em>).</p>
<ol class="upperalpha">
<li><p class="first">If the access attempt is unaccompanied by an RPT,
the resource server responds immediately with an HTTP 401
(Unauthorized) response and instructions on where to go to
obtain one (see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>(RPTなし)</p>
</li>
<li><p class="first">If the access attempt was accompanied by an RPT,
the resource server checks the RPT&#8217;s status (see <em class="xref std std-ref">Section 3.3</em>).</p>
<ol class="arabic">
<li><p class="first">If the RPT is invalid
(for example, it is not applicable
to this resource server), the resource server responds to
the client with an HTTP 401 (Unauthorized) response and
instructions on where to go to obtain a token
(see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>(不正なRPT)</p>
</li>
<li><p class="first">If the RPT is valid but has insufficient permission,
the resource server registers a suitable permission request
on the client&#8217;s behalf at the authorization server
(see <em class="xref std std-ref">Section 3.2</em>),
and then responds to the client with an
HTTP 403 (Forbidden) response and instructions on where
to go to ask for authorization (see <em class="xref std std-ref">Section 3.1.2</em>).</p>
<p>(パーミッションが無いRPT)</p>
</li>
<li><p class="first">If the RPT is valid, and if the <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a>
associated with the token is consistent with allowing access,
the resource server responds to the client&#8217;s
access attempt with an HTTP 200 (OK) response and a
representation of the resource (see <em class="xref std std-ref">Section 3.1.3</em>).</p>
<p>(正常返答)</p>
</li>
</ol>
</li>
</ol>
</li>
<li><p class="first">If the client (possessing no RPT or an invalid RPT) received a
401 response and an RPT endpoint, it then requests an RPT from
that endpoint (see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>( 401の場合,RPT取り直し )</p>
</li>
<li><p class="first">If the client (posessing a valid RPT) received a 403 response and
a <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a>,
it then asks the authorization server for authorization data
that matches the ticket (<em class="xref std std-ref">Section 3.4.3</em>).</p>
<p>(パーミッション要求 )</p>
<p>If the authorization server needs requesting party claims
in order to assess this client&#8217;s authorization,
it engages in a claims-gathering flow with the requesting party
(see <em class="xref std std-ref">Section 3.5</em>).</p>
<p>(クレーム要求)</p>
<ol class="upperalpha">
<li><p class="first">If the client does not already have an AAT at the appropriate
authorization server to be able to use its permission request
endpoint, it first obtains one (see <em class="xref std std-ref">Section 3.4.1</em>).</p>
<p>(AATがない)</p>
</li>
</ol>
</li>
</ol>
</div></blockquote>
<p>The interactions are described in detail in the following sections.</p>
<p>(draft 06 , <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3</a> )</p>
<table class="docutils field-list" frame="void" id="id64" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="id65">
<h3><a class="toc-backref" href="#id251">3.1. Client Attempts to Access Protected Resource</a><a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h3>
<p>This interaction assumes that
the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> has previously registered with an <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>
one or more <a class="reference internal" href="#term-91"><em class="xref std std-term">resource sets</em></a> that correspond to the resource
to which access is being attempted,
such that the resource server considers this resource to be protected
by a particular authorization server.</p>
<p>The client typically attempts to access the desired resource
at the resource server directly
(for example,
when an end-user requesting party clicks on a thumbnail representation of the resource).</p>
<p>The client is expected to discover,
or be provisioned or configured with,
knowledge of the protected resource and its location out of band.</p>
<p>Further,
the client is expected to acquire its own knowledge about
the application-specific methods made available by the resource
server for operating on this protected resource (such as viewing it
with a GET method,
or transforming it with some complex API call) and the possible scopes of access.</p>
<p>Example of a request carrying no RPT:</p>
<div class="highlight-python"><pre>GET /album/photo.jpg HTTP/1.1
Host: photoz.example.com
...</pre>
</div>
<p>Example of a request carrying an RPT using the UMA &#8220;bearer&#8221; token profile:</p>
<div class="highlight-python"><pre>GET /album/photo.jpg HTTP/1.1
Authorization: Bearer vF9dft4qmT
Host: photoz.example.com
...</pre>
</div>
<p>The resource server responds in one of the following ways.</p>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1</a> )</p>
<table class="docutils field-list" frame="void" id="id66" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="id67">
<h4><a class="toc-backref" href="#id252">3.1.1. Client Presents No RPT</a><a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h4>
<p>If the client does not present any access token with the request,
the resource server MUST return an HTTP 401 (Unauthorized) status code,
along with providing the authorization server&#8217;s URI in an &#8220;as_uri&#8221;</p>
<blockquote>
<div><p>property to facilitate authorization server configuration data
discovery, including discovery of the endpoint where the client can
request an RPT (Section 3.4.2).</p>
<p>For example:</p>
<dl class="docutils">
<dt>HTTP/1.1 401 Unauthorized</dt>
<dd><dl class="first docutils">
<dt>WWW-Authenticate: UMA realm=&#8221;example&#8221;,</dt>
<dd>host_id=&#8221;photoz.example.com&#8221;,
as_uri=&#8221;<a class="reference external" href="http://am.example.com">http://am.example.com</a>&#8220;</dd>
</dl>
<p class="last">...</p>
</dd>
</dl>
</div></blockquote>
<p>( draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.1</a> )</p>
</div>
<div class="section" id="id68">
<span id="id69"></span><h4><a class="toc-backref" href="#id253">3.1.2. Client Presents an RPT That Has Insufficient Authorization Data</a><a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h4>
<p>If the client presents an RPT with its request, the resource server
SHOULD determine the RPT&#8217;s status (see <em class="xref std std-ref">Section 3.3</em>).</p>
<p>If the RPT is invalid,
the resource server redirects the client to the RPT endpoint
at the authorization server to obtain a correct RPT (see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>If the RPT is valid but has insufficient permission for the type of access sought,
the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> SHOULD register a <a class="reference internal" href="#term-94"><em class="xref std std-term">permission</em></a> with the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>
that would suffice for that scope of access (see <em class="xref std std-ref">Section 3.2</em>),
and then respond to the client with the HTTP 403 (Forbidden) status code,
along with providing the authorization server&#8217;s URI in the header of the message
and the permission ticket it just received from the authorization server in the body in JSON form.</p>
<p>Example of the host&#8217;s response:</p>
<div class="highlight-python"><pre>HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  as_uri="http://am.example.com"
  error="insufficient_scope"

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>( <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.2</a> )</p>
</div>
<div class="section" id="id70">
<span id="id71"></span><h4><a class="toc-backref" href="#id254">3.1.3. Client Presents a Valid RPT with Sufficient Authorization Data</a><a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h4>
<p>If the RPT&#8217;s status is associated with authorization data
that is consistent with authorized access of the scope sought
by the client (see <em class="xref std std-ref">Section 3.3</em>),
the resource server MUST give access to the desired resource.</p>
<p>Example of the resource server&#8217;s response:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb</pre>
</div>
<p>This response constitutes the conclusion of Phase 3 of UMA.</p>
<p>The resource server MUST NOT give access
where the token&#8217;s status is not associated with sufficient authorization data
for the attempted scope of access.</p>
<p>( draft 06,  <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.1.3</a> )</p>
<div class="section" id="id72">
<span id="id73"></span><h5><a class="toc-backref" href="#id255">3.1.3.1.  Requester&#8217;s Token Has Insufficient Permission</a><a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h5>
<p>If the <a class="reference internal" href="glossary.html#term-token-status"><em class="xref std std-term">token status</em></a> is not associated with any currently valid <a class="reference internal" href="#term-94"><em class="xref std std-term">permission</em></a>
that applies to the <a class="reference internal" href="messages.html#term-61"><em class="xref std std-term">scope</em></a> of access attempted by the <em class="xref std std-term">requester</em>,
the <a class="reference internal" href="discovery.html#term-host"><em class="xref std std-term">Host</em></a> SHOULD register a <a class="reference internal" href="#term-94"><em class="xref std std-term">permission</em></a> with the <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a>
(see <em class="xref std std-ref">Section 3.4</em>) that would suffice for that scope of access,
and then respond to the <em class="xref std std-term">requester</em> with the HTTP 403 (Forbidden) status code,
along with providing the AM&#8217;s URI in the header of the message and
the <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a> it just received from the <strong>AM</strong> in the body of the JSON form.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  am_uri="http://am.example.com"

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">Host register a permmision. (<em class="xref std std-ref">uma_core.3.4</em> )</p>
</li>
<li><p class="first">Host get a ticket from AM for a permission registration. ( ticket is a JSON in response body from AM )</p>
</li>
<li><p class="first">Host return the ticket to the request in HTTP 403 for the resource request. ( described in this section)</p>
</li>
<li><p class="first">Requester ask AM to get access token with the ticket and other information(<em class="xref std std-ref">uma_core.3.5</em> )</p>
<blockquote>
<div><ul class="simple">
<li>AM check the policy for the requester and its request with claims (<a class="reference internal" href="#uma-core-3-6"><em>3.6.  Authorization Flows</em></a> )</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>&#8220;A Requester has a valid access token&#8221; means that &#8220;Authrizing User allowed the reuqester to access a resource in the Host&#8221;</li>
<li>So &#8220;Host&#8221; may register permission to the scope on &#8220;AM&#8221; for the &#8220;Requester&#8221;.  This is proved by the &#8220;Ticket&#8221;</li>
<li>If the &#8220;Requester&#8221; provides a valid &#8220;Ticket&#8221; for the &#8220;Token&#8221;.  the &#8220;AM&#8221; issues a new token (Updated Token)</li>
</ul>
</div>
<p>(draft 03)</p>
</div>
<div class="section" id="id74">
<span id="id75"></span><h5><a class="toc-backref" href="#id256">3.1.3.2.  Requester&#8217;s Token Has Sufficient Permission</a><a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h5>
<p>If the token status is associated with at least one currently valid
permission that applies to the scope of access attempted by the
requester, the host MUST give access to the desired resource.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb</pre>
</div>
<p>This response constitutes the conclusion of Phase 3 of UMA.</p>
<p>The host MUST NOT give access where the token&#8217;s status is not
associated with at least one currently active permission hat suffices
for that scope of access.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
<table class="docutils field-list" frame="void" id="id76" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="id77">
<h3><a class="toc-backref" href="#id257">3.2. Resource Server Registers a Permission With Authorization Server</a><a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h3>
<p>In response to receiving an access request accompanied by an RPT that
is invalid or has insufficient authorization data,
the resource server SHOULD register a permission with the authorization server
that would be sufficient for the type of access sought.
The authorization server returns a permission ticket for the resource
server to give to the client in its response.</p>
<p>The permission ticket is a short-lived opaque structure whose form is
determined by the authorization server.
The ticket value MUST be securely random
(for example, not merely part of a predictable sequential series),
to avoid denial-of-service attacks.</p>
<p>Since the ticket is an opaque structure from the point of view of the client,
the authorization server is free to include information regarding expiration time
within the opaque ticket for its own consumption.
When the client subsequently asks the authorization server for authorization data
to be associated with its RPT,
it will submit this ticket to the authorization server.</p>
<p>The <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> registers the <a class="reference internal" href="#term-94"><em class="xref std std-term">permission</em></a>
using the POST method at the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>&#8216;s <a class="reference internal" href="#term-99"><em class="xref std std-term">permission registration endpoint</em></a>.
The resource server MUST provide its valid <strong>PAT</strong> in order to get access to this endpoint.</p>
<p>The body of the HTTP request message contains a JSON document providing the <em class="xref std std-term">requested permission</em>.</p>
<p>The <a class="reference internal" href="glossary.html#term-requested-scope"><em class="xref std std-term">requested scope</em></a> is an object with the name &#8220;requested_permission&#8221;
and the following properties:</p>
<blockquote>
<div><dl class="docutils">
<dt>resource_set_id</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">The identifier for a resource set, access
to which this client is seeking access.  The identifier MUST
correspond to a resource set that was previously registered.</p>
</dd>
<dt>scopes</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">An array referencing one or more identifiers of
scope types to which access is needed for this resource set.  Each
scope type identifier MUST correspond to a scope type that was
registered by this resource server for the referenced resource
set.</p>
</dd>
</dl>
</div></blockquote>
<div class="section" id="id78">
<h4><a class="toc-backref" href="#id258">サンプル</a><a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id79">
<h5><a class="toc-backref" href="#id259">リクエスト</a><a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h5>
<p>Example of an HTTP request that registers a permission at the
authorization server&#8217;s <a class="reference internal" href="#term-99"><em class="xref std std-term">permission registration endpoint</em></a>:</p>
<div class="highlight-python"><pre>POST /host/scope_reg_uri/photoz.example.com HTTP/1.1
Content-Type: application/json
Host: am.example.com

{
  "resource_set_id": "112210f47de98100",
  "scopes": [
      "http://photoz.example.com/dev/actions/view",
      "http://photoz.example.com/dev/actions/all"
  ]
}</pre>
</div>
</div>
<div class="section" id="id80">
<h5><a class="toc-backref" href="#id260">レスポンス</a><a class="headerlink" href="#id80" title="Permalink to this headline">¶</a></h5>
<p>If the registration request is successful,
the authorization server responds with an <strong>HTTP 201 (Created)</strong> status code
and includes the <em class="xref std std-term">Location header</em> in its response
as well as the &#8220;ticket&#8221; property in the JSON-formatted body.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-permission-ticket+json
Location: https://am.example.com/permreg/host/photoz.example.com/5454345rdsaa4543
...

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><strong>Location</strong> ヘッダーで Client(最終的にticketが渡される)がパーミッション要求するURLを返答すること!</li>
<li><a class="reference external" href="http://bitly.com/bundles/hdknr/v">http://bitly.com/bundles/hdknr/v</a></li>
</ul>
</div>
</div>
<div class="section" id="id81">
<h5><a class="toc-backref" href="#id261">エラー応答</a><a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h5>
<p>If the registration request is authenticated properly but fails due
to other reasons,
the authorization server responds with an HTTP 400 (Bad Request) status code
and includes one of the following UMA error
codes (see <em class="xref std std-ref">Section 4.2</em>):</p>
<dl class="glossary docutils">
<dt id="term-127">invalid_resource_set_id</dt>
<dd>The provided resource set identifier was not
found at the authorization server.</dd>
<dt id="term-128">invalid_scope</dt>
<dd>At least one of the scopes included in the request was
not registered previously by this resource server.</dd>
</dl>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.2</a> )</p>
<table class="docutils field-list" frame="void" id="id82" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="id83">
<h3><a class="toc-backref" href="#id262">3.3. Resource Server Determines the RPT Status</a><a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h3>
<p>On receiving an RPT,
the resource server MUST ascertain its status before granting or denying access to the client.
An RPT is associated with a set of authorization data that governs
whether the client is authorized for access.</p>
<p>The token&#8217;s nature and format are dictated by its profile;
the profile might allow it to be self-contained,
such that the resource server is able to ascertain its status locally,
or might require or allow the resource server to make a run-time introspection request of the authorization server that
issued the token using [OAuth-introspection].</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>アサーションにする</li>
<li>イントロスペクトする</li>
</ul>
</div>
<p>This specification makes one type of RPT mandatory to implement:
the UMA bearer token profile, as defined in <em class="xref std std-ref">Section 3.3.1</em>.
Alternate RPT profiles MAY define their own unique token formats and MAY require,
allow, or prohibit use of the token introspection endpoint.</p>
<p>(draft 06:<a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.3</a> )</p>
<table class="docutils field-list" frame="void" id="id84" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="id85">
<h4><a class="toc-backref" href="#id263">3.3.1. UMA Bearer Token Profile</a><a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h4>
<p>This section defines the format and protocol requirements
for the UMA bearer token profile.</p>
<p>An authorization server MUST support the UMA bearer token profile
and MUST indicate its support in the &#8220;uma_token_profiles_supported&#8221; property
in its configuration data (see Section 1.5).</p>
<p>On receiving an RPT of the &#8220;Bearer&#8221; type in an authorization header
from a client making an access attempt,
the resource server MUST use the authorization server&#8217;s token introspection endpoint
[OAuth-introspection] to retrieve the RPT&#8217;s associated authorization data.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>authz のイントロスペクションエンドポイントで認可データをもらう</li>
</ul>
</div>
<p>In order to ask the authorization server for an RPT&#8217;s status,
the host makes the request to the authorization server with a POST
request to the authorization server&#8217;s token introspection endpoint.
The body of the HTTP request message contains a JSON document
providing the RPT.  The host MUST provide its own PAT in the request
in order to gain access to the RPT status endpoint.</p>
<p>Example of a request to the RPT status endpoint that provides the PAT
in the header:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer vF9dft4qmT
...

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
  "resource_set_id": "112210f47de98100",
  "host_id": "photoz.example.com"
}</pre>
</div>
<p>The authorization server returns the RPT&#8217;s status in an HTTP response
using the 200 OK status code, containing a JSON document supplying
the RPT&#8217;s associated permissions.  The RPT status description either
contains all of the permissions that are currently valid for this RPT
or indicates that the RPT is invalid (see Section 1.4).  The
authorization server MAY set a cache period for the returned RPT
status description that allows the host to reuse it over some period
of time when it later sees the same RPT.</p>
<p>The status description for a valid RPT is a JSON array of zero or
more permission objects, each with the following properties (this
needs to be synced up with the token introspection spec):</p>
<blockquote>
<div><dl class="docutils">
<dt>resource_set_id  REQUIRED.  A string that uniquely identifies the</dt>
<dd>resource set, access to which has been granted to this client on
behalf of this requesting party.  The identifier MUST correspond
to a resource set that was previously registered as protected.</dd>
<dt>scopes  REQUIRED.  An array referencing one or more URIs of scopes to</dt>
<dd>which access was granted for this resource set.  Each scope MUST
correspond to a scope that was registered by this host for the
referenced resource set.</dd>
<dt>exp  REQUIRED.  An integer representing the expiration time on or</dt>
<dd>after which the permission MUST NOT be accepted for authorized
access.  The processing of the exp property requires that the
current date/time MUST be before the expiration date/time listed
in the exp claim.  Host implementers MAY provide for some small
leeway, usually no more than a few minutes, to account for clock
skew.</dd>
</dl>
</div></blockquote>
<p>Example:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
...

[
  {
    "resource_set_id": "112210f47de98100",
    "scopes": [
      "http://photoz.example.com/dev/actions/view",
      "http://photoz.example.com/dev/actions/all"
    ],
    "exp": 1300819380
  }
]</pre>
</div>
<p>The token status description for an invalid RPT is a JSON structure, as follows.</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
...

{
  "rpt_status": "invalid"
}</pre>
</div>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.3.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.3.1</a> )</p>
<table class="docutils field-list" frame="void" id="id86" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id87">
<h3><a class="toc-backref" href="#id264">3.4. Client Asks Authorization Server for RPT and Authorization Data</a><a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h3>
<p>A client making an access attempt accompanied by no RPT
or by an invalid RPT will receive a 401 response back from the resource server,
along with the authorization server&#8217;s location from which it can learn the RPT endpoint.</p>
<p>In this case,
the client must obtain a valid RPT from the authorization server&#8217;s RPT endpoint
provided in the response (see <em class="xref std std-ref">Section 3.4.2</em>).</p>
<p>A client making an access attempt with a valid RPT
that has insufficient <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a>
associated with it will receive a 403 response back
from the resource server,
along with a <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a> and the authorization server&#8217;s location
from which it can learn the permission request endpoint.</p>
<p>In this case,
the client uses the <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a>
to ask for the necessary <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a> to be associated with its RPT.</p>
<p>This process necessarily involves the requesting party
because the authorization is sought on this party&#8217;s behalf.</p>
<p>The client takes action in the following ways
(assuming that it has discovered the authorization server&#8217;s configuration data and
endpoints as required):</p>
<blockquote>
<div><ul>
<li><p class="first">The client and authorization server establish mutual trust through
the issuance of <a class="reference internal" href="glossary.html#term-client-credentials"><em class="xref std std-term">client credentials</em></a> to the client.</p>
<p>It is OPTIONAL for the client credentials to be provided dynamically through
<a class="reference internal" href="#term-161"><em class="xref std std-term">[DynClientReg]</em></a> ); alternatively, they MAY use a static process.</p>
<p>(RPになるということ)</p>
</li>
<li><p class="first">The requesting party, client, and authorization server establish
three-way trust through the issuance of an AAT.</p>
<p>See <em class="xref std std-ref">Section 3.4.1</em> for additional details.</p>
<p>(AATを取得)</p>
</li>
<li><p class="first">The client obtains an RPT.</p>
<p>See <em class="xref std std-ref">Section 3.4.2</em> for additional details.</p>
<p>(RPTを取得)</p>
</li>
</ul>
</div></blockquote>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4</a> )</p>
<table class="docutils field-list" frame="void" id="id88" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="id89">
<h4><a class="toc-backref" href="#id265">3.4.1. Client Obtains AAT</a><a class="headerlink" href="#id89" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OAuth セッション</li>
<li>End User = Requesting Party / User</li>
<li>scope = “<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authz.json">http://docs.kantarainitiative.org/uma/scopes/authz.json</a>”</li>
<li></li>
</ul>
</div>
<p>In this step,
the <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a> acquires an AAT from the authorization server
on the <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a>&#8216;s behalf.</p>
<p>The token represents the approval of this <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a> for this <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a>
to engage with this authorization server to supply claims,
ask for authorization,
and perform any other tasks needed for obtaining authorization
for access to resources at all resource servers that use this authorization server.</p>
<p>It is OPTIONAL for the requesting party to introduce the client
to the authorization server dynamically through the process defined in
<a class="reference internal" href="#term-148"><em class="xref std std-term">[OAuth-resource-reg]</em></a>);
alternatively, they MAY use a static process that does not directly involve the requesting party.</p>
<p>The client MUST use OAuth 2.0 <a class="reference internal" href="#term-149"><em class="xref std std-term">[OAuth2]</em></a> to obtain the AAT.
Here the client requests the &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authz.json">http://docs.kantarainitiative.org/uma/scopes/authz.json</a>&#8221; scope.
Once the client has obtained its AAT,
it presents it to the authorization server at the <a class="reference internal" href="#term-102"><em class="xref std std-term">permission request endpoint</em></a>.</p>
<p>(NOTE: The &#8220;<a class="reference external" href="http://docs.kantarainitiative.org/uma/scopes/authz.json">http://docs.kantarainitiative.org/uma/scopes/authz.json</a>&#8221;
scope keyword is a URI that resolves to a JSON-encoded scope
description, in the fashion of UMA scope types.
This scope description is non-normative.)</p>
<p>The authorization server MAY support the use of any OAuth grant type for AAT issuance,
but MUST support the <em class="xref std std-term">authorization_code grant type</em>,
and SHOULD support the <em class="xref std std-term">SAML bearer token grant type</em> <a class="reference internal" href="#term-162"><em class="xref std std-term">[OAuth-SAML]</em></a>
(<a class="reference external" href="urn:ietf:params:oauth:grant-type:saml2-bearer">urn:ietf:params:oauth:grant-type:saml2-bearer</a>)
if it anticipates working with clients that are operating in environments
where the use of SAML is prevalent.
The authorization server MUST indicate all grant types
it supports for AAT issuance in its configuration data.</p>
<p>By virtue of being able to identify this client/requesting party pair
uniquely across all resource servers whose resources it protects, the
authorization server is able to manage the process of authorization
and claims-gathering efficiently.  These management processes are
outside the scope of this specification.</p>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.1</a> )</p>
<table class="docutils field-list" frame="void" id="id90" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id91">
<h4><a class="toc-backref" href="#id266">3.4.2.  Client Asks for Authorization Data</a><a class="headerlink" href="#id91" title="Permalink to this headline">¶</a></h4>
<p>Once in possession of an <em class="xref std std-term">AAT</em> for this authorization server,
an RPT that applies to this requesting party for this resource server
and this authorization server,
and a permission ticket,
the client asks the authorization server to give it suitable authorization data
for the sought-for access.</p>
<p>It performs a POST on the authorization request endpoint,
supplying its own AAT in the header and its <em class="xref std std-term">RPT</em> and the permission ticket
in a JSON object with properties &#8220;rpt&#8221; and ticket&#8221;, respectively.</p>
<p>Example of a request message containing an AAT, an RPT,
and a permission ticket:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: as.example.com
Authorization: Bearer jwfLG53^sad$#f
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>The authorization server uses the ticket to look up the details of
the previously registered requested permission, maps the requested
permission to operative resource owner policies based on the resource
set identifier and scopes in it, undergoes any claims-gathering flows
required (see Section 3.5), and ultimately responds to the request.
The resource owner&#8217;s policies at the authorization server amount to
an implicit authorization grant in governing the issuance of
authorization data.  (The authorization server is also free to enable
the resource owner to set policies that require the owner to provide
a run-time authorization grant in the form of a consent interaction,
mediated by the authorization server.  This setting of policies and
gathering of consent is outside the scope of this specification.)</p>
<p>The authorization server MUST base the addition of authorization data
to RPTs on user policies.  The nature of these policies is outside
the scope of UMA, but generally speaking, they can be thought of as
either independent of requesting-party features (for example, time of
day) or dependent on requesting-party features (for example, whether
they are over 18).  Such requesting-party features can potentially be
collected in a claims-gathering flow.  If the authorization server
does not add the requested authorization data, it responds using the
appropriate HTTP status code and UMA error code (see Section 4.2):</p>
<dl class="glossary docutils">
<dt id="term-129">invalid_ticket</dt>
<dd>The provided ticket was not found at the
authorization server.  The authorization server SHOULD respond
with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-130">expired_ticket</dt>
<dd>The provided ticket has expired.  The authorization
server SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-131">not_authorized_permission  The client is definitively not authorized</dt>
<dd>for this authorization according to user policy.  The
authorization server SHOULD respond with the HTTP 403 (Forbidden)
status code.</dd>
<dt id="term-132">need_claims</dt>
<dd>The authorization server is unable to determine whether
the client is authorized for this permission without gathering
claims from the requesting party.  The authorization server SHOULD
respond with the HTTP 403 (Forbidden) status code.  The client is
therefore not authorized, but has the opportunity to engage its
operator &#8211; the requesting party &#8211; in a claims-gathering flow
with the authorization server (see Section 3.5) to continue
seeking authorization.</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_ticket"
}</pre>
</div>
<p>( draft 07, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07#section-3.4.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-07#section-3.4.2</a> )</p>
</div>
<div class="section" id="id92">
<span id="id93"></span><h4><a class="toc-backref" href="#id267">3.4.3. Client Asks for Authorization Data</a><a class="headerlink" href="#id92" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>パーミションを要求</li>
<li>成功したら 200 OK が返る、って書いた方がいいんじゃない？</li>
</ul>
</div>
<p>Once in possession of an AAT for this authorization server,
an RPT that applies to this requesting party for this resource server
and this authorization server,
and a permission ticket,
the client asks the authorization server to give it suitable authorization data
for the sought-for access.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">Permission Request Endpoint でパーミッション要求する</p>
<blockquote>
<div><ul class="simple">
<li>AAT</li>
<li>RPT</li>
<li>permission ticket ( <em class="xref std std-ref">uma_core.3.2</em> )</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<p>The client performs a POST on the <a class="reference internal" href="#term-102"><em class="xref std std-term">permission request endpoint</em></a>,
supplying the items below.</p>
<p>The client MUST provide its own AAT in the header.</p>
<blockquote>
<div><ul class="simple">
<li>The <strong>permission ticket</strong> it received from the resource server</li>
<li>Its <em class="xref std std-term">RPT</em> for this resource server</li>
<li>Its own <em class="xref std std-term">AAT</em> in the header</li>
</ul>
</div></blockquote>
<p>Example of a request message containing a <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a> and RPT:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>In this interaction,
the client uses the authorization server&#8217;s <a class="reference internal" href="#term-102"><em class="xref std std-term">permission request endpoint</em></a>.</p>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> uses the <em class="xref std std-term">ticket</em> to look up the details of
the previously registered permission,
maps the requested permission to operative resource owner policies,
undergoes any authorization flows required (see <em class="xref std std-ref">Section 3.5</em>),
and ultimately responds to the request positively or negatively.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OK(200)かNG(401,400)を返す</li>
</ul>
</div>
<p>The resource owner&#8217;s policies at the authorization server amount
to an implicit authorization grant in governing the issuance of authorization data.
(The authorization server is also free to enable resource owners to set policies that
require them to provide a run-time explicit authorization grant mediated by the authorization server.
This setting of policies and gathering of authorization grants is outside the scope of this specification.)</p>
<p>If the request fails due to an invalid, missing, or expired AAT (or RPT)
or requires higher privileges at this endpoint than provided by the AAT,
the authorization server responds with an OAuth error (see <em class="xref std std-ref">Section 4.1</em>).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"</pre>
</div>
<p>If the authorization server does not add the requested authorization data,
it responds using the appropriate HTTP status code (typically 400 or 403),
and includes one of the following error codes in the response (see <em class="xref std std-ref">Section 4.2</em>):</p>
<blockquote>
<div><dl class="docutils">
<dt>invalid_requester_ticket  The provided ticket was not found at the</dt>
<dd>authorization server.  The authorization server SHOULD respond
with the HTTP 400 (Bad Request) status code.</dd>
<dt>expired_requester_ticket  The provided ticket has expired.  The</dt>
<dd>authorization server SHOULD respond with the HTTP 400 (Bad
Request) status code.</dd>
<dt>not_authorized_permission  The client is definitively not authorized</dt>
<dd>for this authorization according to user policy.  The
authorization server SHOULD respond with the HTTP 403 (Forbidden)
status code.</dd>
<dt>need_claims  The authorization server is unable to determine whether</dt>
<dd><p class="first">the client is authorized for this permission
without gathering claims from the requesting party.</p>
<p class="last">The authorization server SHOULD respond with the HTTP 403 (Forbidden) status code.
The client is therefore not authorized,
but has the opportunity to engage its operator &#8211; the requesting party &#8211;
in a claims-gathering flow with the authorization server
(see <em class="xref std std-ref">Section 3.5</em>) to potentially become authorized.</p>
</dd>
</dl>
</div></blockquote>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_requester_ticket"
}</pre>
</div>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.3">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.4.3</a> )</p>
</div>
<div class="section" id="requester-obtains-requester-permission-token">
<span id="uma-core-3-4-4"></span><h4><a class="toc-backref" href="#id268">3.4.4.  Requester Obtains Requester Permission Token</a><a class="headerlink" href="#requester-obtains-requester-permission-token" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>RPT</li>
</ul>
</div>
<p>In this step,
if the <em class="xref std std-term">requester</em> needs an RPT that applies to this <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a>
for this <a class="reference internal" href="discovery.html#term-host"><em class="xref std std-term">host</em></a> and this AM,
the <em class="xref std std-term">requester</em> obtains an RPT from the AM.</p>
<p>On first issuance the RPT is associated with no permissions and
thus does not convey any authorizations for access.</p>
<p>Once the <em class="xref std std-term">requester</em> obtains an RPT from the AM,
it can ask the AM for authorization to have permissions associated with the RPT
(see <a class="reference internal" href="#uma-core-3-4-5"><em>Section 3.4.5</em></a>).</p>
<p>The <em class="xref std std-term">requester</em> performs a POST on the <a class="reference internal" href="#term-101"><em class="xref std std-term">RPT endpoint</em></a>.
In doing so
the <em class="xref std std-term">requester</em> MUST provide its own <em class="xref std std-term">AAT</em> in the header in order to gain
access to the <a class="reference internal" href="#term-101"><em class="xref std std-term">RPT endpoint</em></a>.</p>
<p>Example of a request message containing an AAT:</p>
<div class="highlight-python"><pre>POST /rpt HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
Content-Type: application/json
...</pre>
</div>
<p>The AM responds with an HTTP 201 (Created) status code and provides a new RPT.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-rpt+json

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv"
}</pre>
</div>
<p>If the content-type of the request is not recognized by the AM, the
AM MUST produce an HTTP error.</p>
<p>The requester might need an RPT if it has never before requested an
RPT for this combination of requesting party, host, and AM, or if it
has lost control of a previous issued RPT and needs a refreshed one.
If the AAT provided in the header is the same as one provided for a
previously issued RPT by this AM, the AM invalidates the old RPT and
its permissions and issues a new RPT.</p>
<p>If the request fails due to missing or invalid parameters, or is
otherwise malformed, the AM SHOULD inform the requester of the error
by sending an HTTP error response.</p>
<p>If the request fails due to an invalid, missing, or expired AAT or
requires higher privileges at this endpoint than provided by the AAT,
the AM responds with an OAuth error (see Section 4.1).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="requester-asks-for-authorization-to-add-permission">
<span id="uma-core-3-4-5"></span><h4><a class="toc-backref" href="#id269">3.4.5.  Requester Asks for Authorization to Add Permission</a><a class="headerlink" href="#requester-asks-for-authorization-to-add-permission" title="Permalink to this headline">¶</a></h4>
<p>Once in possession of an AAT for this AM,
an RPT that applies to this <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a> for this <a class="reference internal" href="discovery.html#term-host"><em class="xref std std-term">host</em></a> and this AM,
and a <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a>,
the <em class="xref std std-term">requester</em> asks the AM to give it a permission for the sought-for access.
The requester performs a POST on the <a class="reference internal" href="#term-102"><em class="xref std std-term">permission request endpoint</em></a> at the AM,
supplying the items below.
In doing so
the requester MUST provide its own AAT
in order to gain access to the <a class="reference internal" href="#term-102"><em class="xref std std-term">permission request endpoint</em></a>.</p>
<ul class="simple">
<li>The permission ticket it received from the host</li>
<li>Its RPT for this host</li>
<li>Its own AAT in the header</li>
</ul>
<p>Example of a request message containing a permission ticket and RPT:</p>
<div class="highlight-python"><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
Content-Type: application/json
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
</div>
<p>In this interaction, the requester uses the AM&#8217;s permission request
endpoint.  The AM uses the ticket to look up the previously
registered permission, maps the requested permission to operative
user policies, undergoes any authorization flows required (see
Section 3.5), and ultimately responds to the request positively or
negatively.</p>
<p>If the request fails due to an invalid, missing, or expired AAT (or
RPT) or requires higher privileges at this endpoint than provided by
the AAT, the AM responds with an OAuth error (see Section 4.1).</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"</pre>
</div>
<p>If the AM does not add the requested permission, it responds using
the appropriate HTTP status code (typically 400 or 403), and includes
one of the following error codes in the response (see Section 4.2):</p>
<dl class="glossary docutils">
<dt id="term-invalid-requester-ticket">invalid_requester_ticket</dt>
<dd>The provided ticket was not found at the AM.
The AM SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-expired-requester-ticket">expired_requester_ticket</dt>
<dd>The provided ticket has expired.
The AM SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
<dt id="term-not-authorized-permission">not_authorized_permission</dt>
<dd>The requester is definitively not
authorized for this permission according to user policy.
The AM SHOULD respond with the HTTP 403 (Forbidden) status code.</dd>
<dt id="term-136">need_claims</dt>
<dd>The AM is unable to determine whether the requester is
authorized for this permission without gathering claims from the
requesting party.  The AM SHOULD respond with the HTTP 403
(Forbidden) status code.  The requester is therefore not
authorized, but has the opportunity to engage the requesting party
in a claims-gathering flow with the AM (see Section 3.5) to
potentially become authorized.</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_requester_ticket"
}</pre>
</div>
<p>(draft 05)</p>
</div>
</div>
<div class="section" id="id94">
<span id="id95"></span><h3><a class="toc-backref" href="#id270">3.5. Claims-Gathering Flows</a><a class="headerlink" href="#id94" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>クレームを要求したり、渡したりする必要がある場合が考えられる</li>
<li>Requesting Party 固有のクレームと、それに依存しないクレームがある</li>
<li>Requesting Partyは個人、とそれ以外(ブラウザ、App、Bot...)</li>
</ul>
</div>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> MUST base the addition of <a class="reference internal" href="#term-93"><em class="xref std std-term">authorization data</em></a>
to RPTs on user policies.</p>
<p>The nature of these policies is outside the scope of UMA,
but generally speaking,
they can be thought of as either independent of requesting-party features
(for example, time of day) or dependent on requesting-party features
(for example, whether they are over 18).
This latter case requires the <a class="reference internal" href="#term-84"><em class="xref std std-term">requesting party</em></a> to transmit identity claims
to the AM in some fashion.</p>
<p>The process for requesting and providing claims is extensible and
may have a variety of dependencies on the type of requesting party
(for example, natural person or legal person) and the type of client
(for example, browser, native app, or autonomously running web service).</p>
<p>UMA provides a framework for handling end-user-driven clients and
an optional solution for gathering standardized claims from such an end-user,
and allows for extensions to support other solutions for this use case and other use cases.</p>
<p>The authorization server SHOULD document its claims-handling ability
in its configuration data through the claim_profiles_supported property
(see <em class="xref std std-ref">Section 1.5</em>).</p>
<p>For the business-level and legal implications of different technical
authorization flows, see <a class="reference internal" href="#term-155"><em class="xref std std-term">[UMA-obligations]</em></a>.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5</a> )</p>
<div class="section" id="id96">
<span id="id97"></span><h4><a class="toc-backref" href="#id271">3.5.1. Claims-Gathering Flow for Clients Operated by End-Users</a><a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>自然人</li>
<li>組織人</li>
</ul>
</div>
<p>A client,
whether web-based or native,
is operated by an end-user in
one of two typical situations:</p>
<blockquote>
<div><ul class="simple">
<li>The requesting party is a natural person (for example, a friend of
the resource owner); the requesting party may even be the resource
owner herself.</li>
<li>The requesting party is a legal person such as a corporation, and
the end-user operating the client is acting as an agent of that
legal person (for example, a customer support specialist
representing a credit card company).</li>
</ul>
</div></blockquote>
<p>For convenience,
this specification refers to the end-user as a &#8220;requesting end-user&#8221;
to cover both cases,
which differ only at the level of business agreements
(and potentially law), rather than technology.</p>
<p>The authorization server has a variety of options
at this point for satisfying the resource owner&#8217;s policy;
this specification does not dictate a single answer.</p>
<p>For example,
the authorization server could require the requesting end-user to
register for and/or log in to a local authorization server account,
or to fill in a questionnaire, or to complete a purchase.
It could even require several of these operations,
where the order is treated as significant.
A variety of claim profiling can be defined to achieve these effects.</p>
<p>An end-user-driven client MUST redirect the requesting end-user to
the authorization server to complete the process of authorization.
The redirection MUST include a URI query parameter with the name
&#8220;ticket&#8221; whose value conveys the <a class="reference internal" href="#term-95"><em class="xref std std-term">permission ticket</em></a>
for which the need_claims error was received;
for example,
&#8220;ticket=016f84e8-f9b9-11e0-bd6f-0021cc6004de&#8221;.</p>
<p>Each claim profile MUST provide the following capabilities:</p>
<dl class="glossary docutils">
<dt id="term-137">redirect URI</dt>
<dd>A means by which the client MUST supply the URI to
which the authorization server MUST redirect
the <em class="xref std std-term">requesting end-user</em>
at the end of the claims-gathering process.</dd>
<dt id="term-138">callback URI</dt>
<dd>A means by which the client OPTIONALLY supplies a
callback URI for the authorization server to use.</dd>
<dt id="term-139">state</dt>
<dd>A means by which the client SHOULD supply an opaque value used
to maintain state between the request and the callback; this
serves as a protection against XSRF attacks.</dd>
</dl>
<p>An authorization server MAY support any number of claim profiles.
One potential such profile is defined in this specification:
the &#8220;<strong>openid</strong>&#8221; claim profile,
which leverages OpenID Connect for gathering generally useful identity claims
(see <em class="xref std std-ref">Section 3.5.1.1</em>).</p>
<p>(defat 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5.1</a> )</p>
<div class="section" id="id98">
<span id="id99"></span><h5><a class="toc-backref" href="#id272">3.5.1.1.  OpenID Connect Claim Profile</a><a class="headerlink" href="#id98" title="Permalink to this headline">¶</a></h5>
<p>This section defines the OpenID Connect claim profile for UMA.</p>
<p>Following is a summary:</p>
<blockquote>
<div><ul>
<li><p class="first">Identifying URI:</p>
<p><a class="reference external" href="http://docs.kantarainitiative.org/uma/profiles/uma-claim-openid-1.0">http://docs.kantarainitiative.org/uma/profiles/uma-claim-openid-1.0</a></p>
</li>
<li><p class="first">Profile author and contact information:</p>
<p>Thomas Hardjono (<a class="reference external" href="mailto:hardjono&#37;&#52;&#48;mit&#46;edu">hardjono<span>&#64;</span>mit<span>&#46;</span>edu</a>)</p>
</li>
<li><p class="first">Updates or obsoletes:</p>
<p>None; this profile is new.</p>
</li>
<li><p class="first">Authorization server configuration data:</p>
<p>To indicate support,
supply the keyword &#8220;<strong>openid</strong>&#8221; in the &#8220;<a class="reference internal" href="#term-110"><em class="xref std std-term">claim_profiles_supported</em></a>&#8221;
property value.</p>
</li>
<li><p class="first">Syntax and semantics of claim data:</p>
<p>As defined below.</p>
<p>The claim data format leverages the OpenID Connect protocol and the reserved
claims defined in that specification.</p>
</li>
<li><p class="first">Claims gathering method:</p>
<p>As defined below.</p>
</li>
<li><p class="first">Error states:</p>
<p>None additional.</p>
</li>
<li><p class="first">Security and privacy considerations:</p>
<p>None additional.</p>
</li>
<li><p class="first">Binding obligations:</p>
<p>Binding obligations that apply to the use of
this claim profile are documented in <a class="reference internal" href="#term-155"><em class="xref std std-term">[UMA-obligations]</em></a>.</p>
</li>
</ul>
</div></blockquote>
<p>If an authorization server supports the OpenID Connect claim profile,
it MUST supply the &#8220;openid&#8221; value for one of its &#8220;claim_profiles_supported&#8221; values
in its configuration data.</p>
<p>To conform to this option,
the authorization server MUST do the following:</p>
<blockquote>
<div><ul class="simple">
<li>Serve as a conforming OpenID Relying Party and Claims Client
according to <a class="reference internal" href="#term-166"><em class="xref std std-term">[OCStandard]</em></a></li>
<li>Be able to utilize at least all of the reserved claims defined in
<a class="reference internal" href="#term-165"><em class="xref std std-term">[OCMessages]</em></a> in assessing policy and granting permissions</li>
<li>Use the OpenID Connect &#8220;redirect_uri&#8221; and &#8220;state&#8221; request
parameters as appropriate</li>
</ul>
</div></blockquote>
<p>The authorization server can then use any conforming OpenID Connect
mechanisms and typical user interfaces for engaging with the UserInfo
endpoints of OpenID Providers and Claims Providers,
potentially allowing for the delivery of &#8220;trusted claims&#8221;
(such as a verified email address or a date or birth)
on which authorization policy may depend.</p>
<p>( draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5.1.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-3.5.1.1</a> )</p>
</div>
</div>
</div>
<div class="section" id="authorization-flows">
<span id="uma-core-3-6"></span><h3><a class="toc-backref" href="#id273">3.6.  Authorization Flows</a><a class="headerlink" href="#authorization-flows" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a> MUST base its decisions to add permissions
to <a class="reference internal" href="glossary.html#term-requester-access-tokens"><em class="xref std std-term">requester access tokens</em></a> on <a class="reference internal" href="glossary.html#term-user-policies"><em class="xref std std-term">user policies</em></a>.
The nature of these policies is outside the scope of <a class="reference internal" href="glossary.html#term-uma"><em class="xref std std-term">UMA</em></a>,
but generally speaking,
they can be thought of
as either independent of requesting-party features (for example, time of day)
or dependent on requesting-party features
(for example, whether they are over 18).
This latter case requires the requesting party to
transmit identity claims to the AM in some fashion.</p>
<p>The process for requesting and providing claims is extensible
and may have a variety of dependencies on the type of requesting party
(for example, natural person or legal person)
and the type of requester application
(for example, browser, native app, or autonomously running web service).
UMA currently provides a framework for handling human-driven requester apps
and an optional solution for gathering standardized claims from that end-user,
and allows for extensions to support other solutions for this use case and other use cases.
The AM SHOULD document its claims-handling ability in its XRD configuration data
through the claim_types_supported property (see <em class="xref std std-ref">Section 1.5</em>).
For the business-level and legal implications of different technical authorization flows,
see [<em class="xref std std-term">UMA-trustmodel</em>].</p>
<p>(draft 03)</p>
<div class="section" id="authorization-flow-for-requester-apps-operated-by-end-users">
<span id="uma-core-3-6-1"></span><h4><a class="toc-backref" href="#id274">3.6.1.  Authorization Flow for Requester Apps Operated by End-Users</a><a class="headerlink" href="#authorization-flow-for-requester-apps-operated-by-end-users" title="Permalink to this headline">¶</a></h4>
<p>A requester app, whether browser-based or native, is operated by a
natural person (human end-user) in one of two typical situations:</p>
<blockquote>
<div><ul class="simple">
<li>The requesting party is a natural person (for example, a friend of
the authorizing user); the requesting party may even be the
authorizing user herself.</li>
<li>The requesting party is a legal person such as a corporation, and
the human being operating the requester app is acting as an agent
of that legal person (for example, a customer support specialist
representing a credit card company).</li>
</ul>
</div></blockquote>
<p>The AM has a variety of options at this point for satisfying the
authorizing user&#8217;s policy; this specification does not dictate a
single answer.  For example, the AM could require the end-user
operating the requester app to register for and/or log in to a local
AM account, or to fill in a questionnaire, or to complete a purchase.
It could even require several of these operations, where the order is
significant.</p>
<p>An end-user-driven requester app MUST redirect the end-user to the AM
to complete the process of authorization.  If the AM succeeds in
adding the requested permission, it MUST redirect the end-user
requesting party back to the requester app when reporting success.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
<div class="section" id="gathering-claims-from-requesting-end-users-with-openid-connect">
<span id="uma-core-3-6-1-1"></span><h5><a class="toc-backref" href="#id275">3.6.1.1.  Gathering Claims from Requesting End-Users with OpenID Connect</a><a class="headerlink" href="#gathering-claims-from-requesting-end-users-with-openid-connect" title="Permalink to this headline">¶</a></h5>
<p>An <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a> MAY use <a class="reference internal" href="glossary.html#term-openid-connect"><em class="xref std std-term">OpenID Connect</em></a>
as one means of gathering claims from an end-user requesting party,
leveraging <a class="reference internal" href="glossary.html#term-openid-connect"><em class="xref std std-term">OpenID Connect</em></a> mechanisms to transmit claims from distributed sources.
If it supports this option,
the <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a> MUST supply the &#8220;<a class="reference internal" href="messages.html#term-openid"><em class="xref std std-term">openid</em></a>&#8221; value for one of its <em class="xref std std-ref">claim_types_supported</em> values
in its <a class="reference internal" href="glossary.html#term-am"><em class="xref std std-term">AM</em></a> configuration data (see <em class="xref std std-ref">Section 1.5</em> for how to formulate this data).</p>
<p>To conform to this option, the <em class="xref std std-ref">AM</em> MUST do the following:</p>
<blockquote>
<div><ul class="simple">
<li>Serve as a conforming OpenID Relying Party and Claims Client
according to [<em class="xref std std-term">OCStandard</em>]</li>
</ul>
<dl class="docutils">
<dt>o  Be able to utilize at least all of the reserved claims defined in</dt>
<dd>[<em class="xref std std-ref">OCMessages</em>] in assessing policy and granting permissions</dd>
</dl>
</div></blockquote>
<p>The AM can then use any conforming OpenID Connect mechanisms and
typical user interfaces for engaging with the UserInfo endpoints of
OpenID Providers and Claims Providers, potentially allowing for the
delivery of &#8220;trusted claims&#8221; (such as a verified email address or a
date or birth) on which authorization policy may depend.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
</div>
</div>
</div>
</div>
<div class="section" id="id100">
<span id="id101"></span><h2><a class="toc-backref" href="#id276">4.  Error Messages</a><a class="headerlink" href="#id100" title="Permalink to this headline">¶</a></h2>
<p>Ultimately the host is responsible for either granting the access the
requester attempted, or returning an error response to the requester
with a reason for the failure.  [OAuth2] defines several error
responses for a resource server to return.  UMA makes use of these
error responses, but requires the host to &#8220;outsource&#8221; the
determination of some error conditions to the AM.  UMA defines its
own additional error responses that the AM may give to the host and
requester as they interact with it, and that the host may give to the
requester.</p>
<ol class="arabic simple" start="3">
<li></li>
</ol>
<div class="section" id="id102">
<span id="id103"></span><h3><a class="toc-backref" href="#id277">4.1.  OAuth Error Responses</a><a class="headerlink" href="#id102" title="Permalink to this headline">¶</a></h3>
<p>When a <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> or <a class="reference internal" href="#term-86"><em class="xref std std-term">client</em></a> attempts to access
one of the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> endpoints <em class="xref std std-ref">Section 1.5</em>
or a client attempts to access a protected resource at the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>,
it has to make an authenticated request
by including an OAuth access token in the HTTP request
as described in <a class="reference internal" href="#term-149"><em class="xref std std-term">[OAuth2]</em></a> <a class="reference internal" href="oauth.html#oauth-7"><em>Section 7</em></a>.</p>
<p>If the request failed authentication, the authorization server
or the resource server responds with an OAuth error message
as described throughout <em class="xref std std-ref">Section 2</em> and <em class="xref std std-ref">Section 3</em>.</p>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-4.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-4.1</a> )</p>
</div>
<div class="section" id="id104">
<span id="id105"></span><h3><a class="toc-backref" href="#id278">4.2.  UMA Error Responses</a><a class="headerlink" href="#id104" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>When a resource server or client attempts to access one of the</div></blockquote>
<p>authorization server endpoints <em class="xref std std-ref">Section 1.5</em>
or a client attempts to access a protected resource at the resource server,
if the request is successfully authenticated by OAuth means,
but is invalid for another reason,
the authorization server or resource server responds with an UMA error response
by adding the following properties to the entity body of the HTTP response:</p>
<dl class="glossary docutils">
<dt id="term-140">error</dt>
<dd>REQUIRED.  A single error code.  Value for this property is
defined in the specific authorization server endpoint description.</dd>
<dt id="term-141">error_description</dt>
<dd>OPTIONAL.  Human-readable text providing
additional information, used to assist in the understanding and
resolution of the error occurred.</dd>
<dt id="term-142">error_uri</dt>
<dd>OPTIONAL.  A URI identifying a human-readable web page
with information about the error, used to provide the end-user
with additional information about the error.</dd>
</dl>
<p>Common error codes:</p>
<dl class="glossary docutils">
<dt id="term-143">invalid_request</dt>
<dd>The request is missing a required parameter or is
otherwise malformed.  The authorization server MUST respond with
the HTTP 400 (Bad Request) status code.</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "invalid_request",
  "error_description": "There is already a resource with this identifier.",
  "error_uri": "http://am.example.com/errors/resource_exists"
}</pre>
</div>
<p>(draft 06, <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-4.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-4.2</a> )</p>
</div>
</div>
<div class="section" id="id106">
<span id="id107"></span><h2><a class="toc-backref" href="#id279">5.  Specification of Additional Profiles</a><a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h2>
<p>This specification defines a selected set of profiles, but others
will possibly be developed in the future.  It is not possible for
this specification to standardize all of these additional profiles.
The following sections define rules for third parties that specify
UMA profiles.</p>
<p>(Get text from <a class="reference external" href="http://docs.oasis-open.org/security/saml/v2.0/">http://docs.oasis-open.org/security/saml/v2.0/</a>
saml-profiles-2.0-os.pdf .)</p>
<p>(Put references to this section in the appropriate places above, and
add a discussion of profiles somewhere in the intro.)</p>
<p>(draft 05)</p>
<div class="section" id="id108">
<span id="id109"></span><h3><a class="toc-backref" href="#id280">5.1.  Specifying UMA Profiles</a><a class="headerlink" href="#id108" title="Permalink to this headline">¶</a></h3>
<p>This section provides a checklist of issues that MUST be addressed by each profile.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Specify a URI that uniquely identifies the profile, postal or
electronic contact information for the author, and provide
reference to previously defined profiles that the new profile
updates or obsoletes.</li>
<li>Specify the set of interactions between parties involved in the
profile.  Any restrictions on applications used by each party and
the protocols involved in each interaction must be explicitly
called out.</li>
<li>Identify the parties involved in each interaction, including how
many parties are involved and whether intermediaries may be
involved.</li>
<li>Specify the method of authentication of parties involved in each
interaction, including whether authentication is required and
acceptable authentication types.</li>
<li>Identify the level of support for message integrity, including
the mechanisms used to ensure message integrity.</li>
<li>Identify the level of support for confidentiality, including
whether a third party may view the contents of UMA messages,
whether the profile requires confidentiality, and the mechanisms
recommended for achieving confidentiality.</li>
<li>Identify the error states, including the error states at each
participant, especially those that receive and process UMA
messages.</li>
<li>Identify security considerations, including analysis of threats
and description of countermeasures.</li>
<li>Identify relevant UMA metadata defined and/or utilized by the
profile.</li>
</ol>
</div></blockquote>
<p>(draft 05)</p>
</div>
<div class="section" id="id110">
<span id="id111"></span><h3><a class="toc-backref" href="#id281">5.2.  Specifying UMA Token Profiles</a><a class="headerlink" href="#id110" title="Permalink to this headline">¶</a></h3>
<p>This section provides a checklist of items that MUST in particular be
addressed by attribute profiles.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Specify a URI that uniquely identifies the profile, postal or
electronic contact information for the author, and provide
reference to previously defined profiles that the new profile
updates or obsoletes.</li>
<li>Identify the syntax and restrictions on the acceptable values for
the token profile.</li>
<li>Identify namespace restrictions that are meaningful in the
profile deployment scenario.</li>
<li>Identify rules in the processing of the fields within the token
profile.</li>
<li>Identify the scopes that are defined in the token profile (e.g.
grant types in JWT Bearer Token Profile).</li>
<li>Identify the error states, including the error states at each
participant, especially those that receive and process claims or
assertions expressed within the tokens.</li>
</ol>
</div></blockquote>
<p>(draft 05)</p>
</div>
</div>
<div class="section" id="id112">
<span id="id113"></span><h2><a class="toc-backref" href="#id282">6.  Security Considerations</a><a class="headerlink" href="#id112" title="Permalink to this headline">¶</a></h2>
<p>This specification relies mainly on OAuth security mechanisms for
protecting the host registration endpoint at the AM so that only a
properly authorized host can access it on behalf of the intended
user.  For example, the host needs to use a valid protection API
token (PAT) issued through a user authorization process at the
endpoint, and the interaction SHOULD take place over TLS.  It is
expected that the host will protect its client secret (if it was
issued one) and its PAT, particularly if used in &#8220;bearer token&#8221;
fashion.</p>
<p>In addition, this specification dictates a binding between the PAT
and the host-specific registration area on the AM to prevent a host
from interacting with a registration area not its own.</p>
<p>This specification defines a number of JSON-based data formats.  As a
subset of the JavaScript scripting language, JSON data SHOULD be
consumed through a process that does not dynamically execute it as
code, to avoid malicious code execution.  One way to achieve this is
to use a JavaScript interpreter rather than the built-in JavaScript
eval() function.</p>
<p>For information about the technical, operational, and legal elements
of trust establishment between UMA entities and parties, which
affects security considerations, see [UMA-trustmodel].</p>
<p>(draft 05)</p>
</div>
<div class="section" id="id114">
<span id="id115"></span><h2><a class="toc-backref" href="#id283">7.  Privacy Considerations</a><a class="headerlink" href="#id114" title="Permalink to this headline">¶</a></h2>
<p>The AM comes to be in possession of resource set information (such as
names and icons) that may reveal information about the user, which
the AM&#8217;s trust relationship with the host is assumed to accommodate.
However, the requester is a less-trusted party (in fact, entirely
untrustworthy until it acquires permissions for an RPT in UMA
protocol phase 2.  This specification recommends obscuring resource
set identifiers in order to avoid leaking personally identifiable
information to requesters through the &#8220;scope&#8221; mechanism.</p>
<p>For information about the technical, operational, and legal elements
of trust establishment between UMA entities and parties, which
affects privacy considerations, see [UMA-trustmodel].</p>
<p>(draft 05)</p>
</div>
<div class="section" id="id116">
<span id="id117"></span><h2><a class="toc-backref" href="#id284">8.  Conformance</a><a class="headerlink" href="#id116" title="Permalink to this headline">¶</a></h2>
<p>This section outlines conformance requirements for various entities
implementing UMA endpoints.</p>
<p>This specification has dependencies on other specifications, as
follows:</p>
<blockquote>
<div><ul class="simple">
<li>OAuth 2.0: AMs, hosts, and requesters MUST support [OAuth2]
features named in this specification for conformance.  For
example, AMs MUST support the authorization_code and
client_credentials grant types.</li>
<li>hostmeta: AMs, hosts, and requesters MUST support the [RFC6415]
features named in this specification.</li>
<li>OpenID Connect: AMs MAY support [DynClientReg], and MAY choose to
conform to the &#8220;openid&#8221; claim format option, corresponding to the
OpenID Connect RP role defined in [OCStandard] and support for
OpenID Connect reserved claims defined in [OCMessages].</li>
</ul>
</div></blockquote>
<p>The AM&#8217;s configuration data provides a machine-readable method for an
AM to indicate certain of the conformance options it has chosen.
Several of the data properties allow for extensibility.  Where this
specification does not already require optional features to be
documented, it is RECOMMENDED that AM developers and deployers
document any profiled or extended features explicitly and use
configuration data to indicate their usage.  See Section 1.5 for
information about providing and extending AM configuration data.</p>
<p>(draft 05)</p>
</div>
<div class="section" id="id118">
<span id="id119"></span><h2><a class="toc-backref" href="#id285">9.  IANA Considerations</a><a class="headerlink" href="#id118" title="Permalink to this headline">¶</a></h2>
<p>Several UMA-specific JSON-based media types are being proposed, as
follows: (TBS)</p>
<p>(draft 05)</p>
</div>
<div class="section" id="id120">
<span id="id121"></span><h2><a class="toc-backref" href="#id286">10.  Example of Registering Resource Sets</a><a class="headerlink" href="#id120" title="Permalink to this headline">¶</a></h2>
<p>The following example illustrates the intent and usage of resource
set descriptions and scope descriptions as part of resource set
registration.</p>
<p>This example contains some steps that are exclusively in the realm of
user experience rather than web protocol, to achieve realistic
illustration.  These steps are labeled &#8220;User experience only&#8221;.  Some
other steps are exclusively internal to the operation of the entity
being discussed.  These are labeled &#8220;Internal only&#8221;.</p>
<p>An authorizing user, Alice Adams, has just uploaded a photo of her
new puppy to a host, Photoz.example.com, and wants to ensure that
this specific photo is not publicly accessible.</p>
<p>Alice has already introduced this host to her AM,
CopMonkey.example.com, and thus Photoz has already obtained a PAT
from CopMonkey.  However, Alice has not previously instructed Photoz
to use CopMonkey to protect any other photos of hers.</p>
<p>Alice has previously visited CopMonkey to map a default &#8220;do not share
with anyone&#8221; policy to any resource sets registered by Photoz, until
such time as she maps some other more permissive policies to those
resources.  (User experience only.  This may have been done at the
time Alice introduced the host to the AM, and/or it could have been a
global or host-specific preference setting.  A different constraint
or no constraint at all might be associated with newly protected
resources.)  Other kinds of policies she may eventually map to
particular photos or albums might be &#8220;Share only with
<a class="reference external" href="mailto:husband&#37;&#52;&#48;email&#46;example&#46;net">husband<span>&#64;</span>email<span>&#46;</span>example<span>&#46;</span>net</a>&#8221; or &#8220;Share only with people in my &#8216;family&#8217;
group&#8221;.</p>
<p>Photoz itself has a publicly documented application-specific API that
offers two dozen different methods that apply to single photos, such
as &#8220;addTags&#8221; and &#8220;getSizes&#8221;, but rolls them up into two photo-related
scopes of access: &#8220;view&#8221; (consisting of various read-only operations)
and &#8220;all&#8221; (consisting of various reading, editing, and printing
operations).  It defines two scope descriptions that represent these
scopes, which it is able to reuse for all of its users (not just
Alice), and ensures that these scope description documents are
available through HTTP GET requests that may be made by AMs.</p>
<p>The &#8220;name&#8221; property values are intended to be seen by Alice when she
maps authorization constraints to specific resource sets and actions
while visiting CopMonkey, such that Alice would see the strings &#8220;View
Photo and Related Info&#8221; and &#8220;All Actions&#8221;, likely accompanied by the
referenced icons, in the CopMonkey interface.  (Other users of Photoz
might similarly see the same labels at CopMonkey or whatever other AM
they use.  Photoz could distinguish natural-language labels per user
if it wishes, by pointing to scopes with differently translated
names.)</p>
<p>Example of the viewing-related scope description document available
at <a class="reference external" href="http://photoz.example.com/dev/scopes/view">http://photoz.example.com/dev/scopes/view</a> with a Content-Type of
application/uma-scope+json:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;View Photo and Related Info&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/reading-glasses.png&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example of the broader scope description document available at
<a class="reference external" href="http://photoz.example.com/dev/scopes/all">http://photoz.example.com/dev/scopes/all</a>, likewise with a Content-
Type of application/uma-scope+json:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;All Actions&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/galaxy.png&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>While visiting Photoz, Alice selects a link or button that instructs
the site to &#8220;Protect&#8221; or &#8220;Share&#8221; this single photo (user experience
only; Photoz could have made this a default or preference setting).</p>
<p>As a result, Photoz defines for itself a resource set that represents
this photo (internal only; Photoz is the only application that knows
how to map a particular photo to a particular resource set).  Photoz
also prepares the following resource set description, which is
specific to Alice and her photo.  The &#8220;name&#8221; property value is
intended to be seen by Alice in mapping authorization policies to
specific resource sets and actions when she visits CopMonkey.  Alice
would see the string &#8220;Steve the puppy!&#8221;, likely accompanied by the
referenced icon, in the CopMonkey interface.  The possible scopes of
access on this resource set are indicated with URI references to the
scope descriptions, as shown just above.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Steve the puppy!&quot;</span><span class="p">,</span>
  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower&quot;</span><span class="p">,</span>
  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Photoz uses the &#8220;create resource set description&#8221; method of
CopMonkey&#8217;s standard UMA resource set registration API, presenting
its Alice-specific PAT there, to register and assign an identifier to
the resource set description.</p>
<div class="highlight-python"><pre>PUT /resource_set/112210f47de98100 HTTP/1.1
Content-Type: application/uma-resource-set+json
...

{
  "name": "Steve the puppy!",
  "icon_uri": "http://www.example.com/icons/flower.png",
  "scopes": [
    "http://photoz.example.com/dev/scopes/view",
    "http://photoz.example.com/dev/scopes/all"
  ]
}</pre>
</div>
<p>If the registration attempt succeeds, CopMonkey responds in the
following fashion.</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: "1"
...

{
  "status": "created",
  "_id":  "112210f47de98100",
  "_rev": "1"
}</pre>
</div>
<p>At the time Alice indicates she would like this photo protected,
Photoz can choose to redirect Alice to CopMonkey for further policy
setting, access auditing, and other AM-related tasks (user experience
only).</p>
<p>Once it has successfully registered this description, Photoz is
responsible for outsourcing to CopMonkey all questions of
authorization for access attempts made to this photo.</p>
<p>Over time, as Alice uploads other photos and creates and organizes
photo albums, and as Photoz makes new action functionality available,
Photoz can use additional methods of the resource set registration
API to ensure that CopMonkey&#8217;s understanding of Alice&#8217;s protected
resources matches its own.</p>
<p>For example, if Photoz suspects that somehow its understanding of the
resource set has gotten out of sync with CopMonkey&#8217;s, it can ask to
read the resource set description as follows.</p>
<div class="highlight-python"><pre>GET /resource_set/112210f47de98100 HTTP/1.1
Host: am.example.com
...</pre>
</div>
<p>CopMonkey responds with the full content of the resource set
description, including its _id and its current _rev, as follows:</p>
<p>Example of an HTTP response to a &#8220;read resource set description&#8221;
request, containing a resource set description from the AM:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/uma-resource-set+json
ETag: "1"
...

{
  "_id":  "112210f47de98100",
  "_rev": "1",
  "name": "Photo album",
  "icon_uri": "http://www.example.com/icons/flower.png",
  "scopes": [
    "http://photoz.example.com/dev/scopes/view",
    "http://photoz.example.com/dev/scopes/all"
  ]
}</pre>
</div>
<p>If for some reason Photoz and CopMonkey have gotten dramatically out
of sync, Photoz can ask for the list of resource set identifiers
CopMonkey currently knows about:</p>
<div class="highlight-python"><pre>GET /resource_set HTTP/1.1
Host: am.example.com
...</pre>
</div>
<p>CopMonkey&#8217;s response might look as follows:</p>
<div class="highlight-python"><pre>HTTP/1.1 200 OK
Content-Type: application/json
...

[ "112210f47de98100", "34234df47eL95300" ]</pre>
</div>
<p>If Alice later changes the photo&#8217;s title (user experience only) on
Photoz from &#8220;Steve the puppy!&#8221; to &#8220;Steve on October 14, 2011&#8221;, Photoz
would use the &#8220;update resource set description&#8221; method to ensure that
Alice&#8217;s experience of policy-setting at CopMonkey remains consistent
with what she sees at Photoz.  Following is an example of this
request.</p>
<div class="highlight-python"><pre>PUT /resource_set/112210f47de98100 HTTP/1.1
Content-Type: application/uma-resource-set+json
Host: am.example.com
If-Match: "1"
...

{
  "name": "Steve on October 14, 2011",
  "icon_uri": "http://www.example.com/icons/flower.png",
  "scopes": [
    "http://photoz.example.com/dev/scopes/view",
    "http://photoz.example.com/dev/scopes/all"
  ]
}</pre>
</div>
<p>CopMonkey would respond as follows.</p>
<div class="highlight-python"><pre>HTTP/1.1 201 Created
Content-Type: application/uma-status+json
ETag: "2"
...

{
  "status": "updated",
  "_id":  "112210f47de98100",
  "_rev": "2"
}</pre>
</div>
<p>There are other reasons Photoz might want to update resource set
descriptions, having nothing to do with Alice&#8217;s actions or wishes.
For example, it might extend its API to include new features, and
want to add new scopes to all of Alice&#8217;s and other users&#8217; resource
set descriptions.</p>
<p>if Alice later decides to entirely remove sharing protection (user
experience only) on this photo while visiting Photoz, ensuring that
the public can get access without any UMA-based protection, Photoz is
responsible for deleting the relevant resource set registration, as
follows:</p>
<div class="highlight-python"><pre>DELETE /resource_set/112210f47de98100 HTTP/1.1
Host: am.example.com
If-Match: "2"
...</pre>
</div>
<p>(draft 05)</p>
</div>
<div class="section" id="id122">
<span id="id123"></span><h2><a class="toc-backref" href="#id287">11.  Acknowledgments</a><a class="headerlink" href="#id122" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The current editor of this specification is Thomas Hardjono of MIT.
The following people are co-authors:</p>
<p>o  Paul C. Bryan, ForgeRock US, Inc. (former editor)</p>
<p>o  Domenico Catalano, Oracle Corp.</p>
<p>o  George Fletcher, AOL</p>
<p>o  Maciej Machulak, Newcastle University</p>
<p>o  Eve Maler, XMLgrrl.com</p>
<p>o  Lukasz Moren, Newcastle University</p>
<p>o  Christian Scholz, COMlounge GmbH (former editor)</p>
<p>o  Jacek Szpot, Newcastle University</p>
<p>Additional contributors to this specification include the Kantara UMA
Work Group participants, a list of whom can be found at
[UMAnitarians].</p>
</div></blockquote>
<p>(draft 05)</p>
</div>
<div class="section" id="id124">
<span id="id125"></span><h2><a class="toc-backref" href="#id288">12.  Issues</a><a class="headerlink" href="#id124" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>All issues are now captured at the project&#8217;s GitHub site
(&lt;<a class="reference external" href="https://github.com/xmlgrrl/UMA-Specifications/issues">https://github.com/xmlgrrl/UMA-Specifications/issues</a>&gt;).</div></blockquote>
<p>(draft 05)</p>
<div class="section" id="id126">
<span id="id127"></span><h3><a class="toc-backref" href="#id289">12.1.  Normative References</a><a class="headerlink" href="#id126" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-144">[DynClientReg]</dt>
<dd>Richer, J., &#8220;OAuth Dynamic Client Registration Protocol&#8221;,
November 2012, &lt;<a class="reference external" href="https://datatracker.ietf.org/doc/">https://datatracker.ietf.org/doc/</a>
draft-ietf-oauth-dyn-reg/&gt;.</dd>
<dt id="term-145">[OAuth-SAML]</dt>
<dd>Campbell, B., &#8220;SAML 2.0 Bearer Assertion Profiles for
OAuth 2.0&#8221;, November 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/">http://tools.ietf.org/html/</a>
draft-ietf-oauth-saml2-bearer&gt;.</dd>
<dt id="term-146">[OAuth-bearer]</dt>
<dd>&#8220;The OAuth 2.0 Authorization Framework: Bearer Token
Usage&#8221;, October 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6750">http://tools.ietf.org/html/rfc6750</a>&gt;.</dd>
<dt id="term-147">[OAuth-introspection]</dt>
<dd>Richer, J., &#8220;OAuth Token Introspection&#8221;, November 2012, &lt;h
ttp://tools.ietf.org/html/
draft-richer-oauth-introspection&gt;.</dd>
<dt id="term-148">[OAuth-resource-reg]</dt>
<dd>Hardjono, T., &#8220;OAuth 2.0 Resource Set Registration&#8221;,
December 2012.</dd>
<dt id="term-149">[OAuth2]</dt>
<dd>Hardt, D., &#8220;The OAuth 2.0 Authorization Framework&#8221;,
October 2012, &lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6749">http://tools.ietf.org/html/rfc6749</a>&gt;.</dd>
<dt id="term-150">[OCMessages]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Messages 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-messages-1_0.html&gt;.</dd>
<dt id="term-151">[OCStandard]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Standard 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-standard-1_0.html&gt;.</dd>
<dt id="term-152">[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt id="term-153">[RFC4627]</dt>
<dd>Crockford, D., &#8220;The application/json Media Type for
JavaScript Object Notation (JSON)&#8221;, RFC 4627, July 2006.</dd>
<dt id="term-154">[RFC6415]</dt>
<dd>Hammer-Lahav, E., &#8220;Web Host Metadata&#8221;, October 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6415">http://tools.ietf.org/html/rfc6415</a>&gt;.</dd>
<dt id="term-155">[UMA-obligations]</dt>
<dd>Maler, E., &#8220;<a class="reference internal" href="uma_trust.html"><em>Binding Obligations on UMA Participants</em></a>&#8221;,
April 2012,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model">http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model</a>&gt;.</dd>
</dl>
<p>(draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.1">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.1</a> )</p>
</div>
<div class="section" id="id128">
<span id="id129"></span><h3><a class="toc-backref" href="#id290">12.2.  Informative References</a><a class="headerlink" href="#id128" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-156">[OAuth-linktypes]</dt>
<dd>Mills, W., &#8220;Link Type Registrations for OAuth 2&#8221;,
October 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-wmills-oauth-lrdd">http://tools.ietf.org/html/draft-wmills-oauth-lrdd</a>&gt;.</dd>
<dt id="term-157">[OAuth-meta]</dt>
<dd>Sakimura, N., &#8220;<a class="reference internal" href="oauth_meta.html"><em>JSON Metadata for OAuth Responses</em></a>&#8221;,
December 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-sakimura-oauth-meta">http://tools.ietf.org/html/draft-sakimura-oauth-meta</a>&gt;.</dd>
<dt id="term-158">[UMA-casestudies]</dt>
<dd>Maler, E., &#8220;UMA Case Studies&#8221;, December 2012,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/Case+Studies">http://kantarainitiative.org/confluence/display/uma/Case+Studies</a>&gt;.</dd>
<dt id="term-159">[UMA-usecases]</dt>
<dd>Maler, E., &#8220;UMA Scenarios and Use Cases&#8221;, October 2010,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases">http://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases</a>&gt;.</dd>
<dt id="term-160">[UMAnitarians]</dt>
<dd>Maler, E., &#8220;UMA Participant Roster&#8221;, 2012,
&lt;<a class="reference external" href="http://kantarainitiative.org/confluence/display/uma/Participant+Roster">http://kantarainitiative.org/confluence/display/uma/Participant+Roster</a>&gt;.</dd>
</dl>
<p>( draft 06 : <a class="reference external" href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.2">http://tools.ietf.org/html/draft-hardjono-oauth-umacore-06#section-12.2</a> )</p>
</div>
</div>
<div class="section" id="id130">
<span id="id131"></span><h2><a class="toc-backref" href="#id291">13.  References</a><a class="headerlink" href="#id130" title="Permalink to this headline">¶</a></h2>
<p>(draft 05)</p>
<div class="section" id="id132">
<span id="id133"></span><h3><a class="toc-backref" href="#id292">13.1.  Normative References</a><a class="headerlink" href="#id132" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-161">[DynClientReg]</dt>
<dd>Hardjono, T., &#8220;OAuth Dynamic Client Registration
Protocol&#8221;, May 2012, &lt;<a class="reference external" href="https://datatracker.ietf.org/doc/">https://datatracker.ietf.org/doc/</a>
draft-ietf-oauth-dyn-reg/&gt;.</dd>
<dt id="term-162">[OAuth-SAML]</dt>
<dd>Campbell, B., &#8220;SAML 2.0 Bearer Assertion Grant Type
Profile for OAuth 2.0&#8221;, August 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/">http://tools.ietf.org/html/</a>
draft-ietf-oauth-saml2-bearer&gt;.</dd>
<dt id="term-163">[OAuth-bearer]</dt>
<dd>&#8220;The OAuth 2.0 Authorization Protocol: Bearer Tokens&#8221;,
March 2012,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-bearer">http://tools.ietf.org/html/draft-ietf-oauth-v2-bearer</a>&gt;.</dd>
<dt id="term-164">[OAuth2]   Hammer-Lahav, E., &#8220;The OAuth 2.0 Protocol&#8221;,</dt>
<dd>September 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2">http://tools.ietf.org/html/draft-ietf-oauth-v2</a>&gt;.</dd>
<dt id="term-165">[OCMessages]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Messages 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-messages-1_0.html&gt;.</dd>
<dt id="term-166">[OCStandard]</dt>
<dd>Sakimura, N., &#8220;OpenID Connect Standard 1.0&#8221;,
September 2011,
&lt;<a class="reference external" href="http://openid.net/specs/">http://openid.net/specs/</a>
openid-connect-standard-1_0.html&gt;.</dd>
<dt id="term-167">[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
<dt id="term-168">[RFC4627]</dt>
<dd>Crockford, D., &#8220;The application/json Media Type for
JavaScript Object Notation (JSON)&#8221;, RFC 4627, July 2006.</dd>
<dt id="term-169">[RFC6415]</dt>
<dd>Hammer-Lahav, E., &#8220;Web Host Metadata&#8221;, October 2011,
&lt;<a class="reference external" href="http://tools.ietf.org/html/rfc6415">http://tools.ietf.org/html/rfc6415</a>&gt;.</dd>
<dt id="term-170">[UMA-trustmodel]</dt>
<dd>Maler, E., &#8220;UMA Trust Model&#8221;, April 2012, &lt;<a class="reference external" href="http://">http://</a>
kantarainitiative.org/confluence/display/uma/
UMA+Trust+Model&gt;.</dd>
</dl>
<p>(draft 05)</p>
</div>
<div class="section" id="id134">
<span id="id135"></span><h3><a class="toc-backref" href="#id293">13.2.  Informative References</a><a class="headerlink" href="#id134" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-171">[UMA-usecases]</dt>
<dd>Maler, E., &#8220;UMA Scenarios and Use Cases&#8221;, October 2010, &lt;h
ttp://kantarainitiative.org/confluence/display/uma/
UMA+Scenarios+and+Use+Cases&gt;.</dd>
<dt id="term-172">[UMA-userstories]</dt>
<dd>Maler, E., &#8220;UMA User Stories&#8221;, November 2010, &lt;<a class="reference external" href="http://">http://</a>
kantarainitiative.org/confluence/display/uma/
User+Stories&gt;.</dd>
<dt id="term-173">[UMAnitarians]</dt>
<dd>Maler, E., &#8220;UMA Participant Roster&#8221;, 2012, &lt;<a class="reference external" href="http://">http://</a>
kantarainitiative.org/confluence/display/uma/
Participant+Roster&gt;.</dd>
</dl>
<p>(draft 05)</p>
</div>
<div class="section" id="uma-core-connect-resset">
<span id="id136"></span><h3><a class="toc-backref" href="#id294">Resource Set Descriptor for OpenID Connect</a><a class="headerlink" href="#uma-core-connect-resset" title="Permalink to this headline">¶</a></h3>
<p>If an OpenID Connect OP works as an UMA AM,  the OP can return the UserInfo
in which Users&#8217; resource at Host are included as an Aggregated Claim , or
OAuth Access Tokens to the Host endpoint are includde.</p>
<p>To make OpenID Connet OP as a middle man,
the Host gives extra parameters in UMA Resoure Set Description
for Protection API.</p>
<dl class="glossary docutils">
<dt id="term-174">token_endpoint</dt>
<dd>Connect OP ask the Host to issue an access token and an refresh token at this endpoint.
Requests are authenticated by OAuth Bear Token Profile with <strong>credentai_token</strong>.</dd>
<dt id="term-175">credential_token</dt>
<dd>Token for the Token Endpoint request authtentiction</dd>
<dt id="term-176">refresh_token</dt>
<dd>Token to refresh an access token and the other reflesh token.</dd>
<dt id="term-177">resource_endpoint</dt>
<dd>Users resource is returned from this endpoint in exchange for access token.</dd>
</dl>
<p>The following JSON is an non-normative sample to be put by Host to Connect OP as AM
for Protecttion API.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Photo Album&quot;</span><span class="p">,</span>

  <span class="s2">&quot;icon_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.example.com/icons/flower.png&quot;</span><span class="p">,</span>

  <span class="s2">&quot;scopes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;http://photoz.example.com/dev/scopes/all&quot;</span>
  <span class="p">],</span>

  <span class="s2">&quot;token_endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://photoz.example.com/dev/token/&quot;</span><span class="p">,</span>
  <span class="s2">&quot;credential_token&quot;</span> <span class="o">:</span> <span class="s2">&quot;fdsafdsafdsafa&quot;</span><span class="p">,</span>
  <span class="s2">&quot;refresh_token&quot;</span> <span class="o">:</span> <span class="s2">&quot;432gsafgds9&quot;</span><span class="p">,</span>
  <span class="s2">&quot;resource_endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://photoz.example.com/dev/resource/&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the User configure to return his UserInfo including resource at Host,
the OP refreshes an access token in exchange for the <strong>refresh_tokne</strong> first,
then get the resource at <strong>token_endpoint</strong> in exchange for the access token.</p>
<p>After the resource is returned in JWT form to the OP, OP include it as an
Aggregated Claim in the UserInfo( which is to be returnd to the other RP).</p>
<p>If the User configure to return an access token to the Host in UserInfo,
OP includes the access token given by Host&#8217; <strong>token_endpoint</strong> in the UserInfo.</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="session.html">OpenID Connect Session Management 1.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="uma_trust.html">Binding Obligations on User-Managed Access (UMA) Participants</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, HDKNR.COM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>