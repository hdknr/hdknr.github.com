

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OpenID Connect Messages 1.0 &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="OpenID Connect Dynamic Client Registration 1.0" href="reg.html" />
    <link rel="prev" title="OpenID Connect Standard 1.0" href="standard.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>identity 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>OpenID Connect Messages 1.0</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="standard.html">OpenID Connect Standard 1.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="reg.html">OpenID Connect Dynamic Client Registration 1.0</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="openid-connect-messages-1-0">
<h1><a class="toc-backref" href="#id23">OpenID Connect Messages 1.0</a><a class="headerlink" href="#openid-connect-messages-1-0" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#openid-connect-messages-1-0" id="id23">OpenID Connect Messages 1.0</a><ul>
<li><a class="reference internal" href="#abstract" id="id24">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id25">1.  Introduction</a><ul>
<li><a class="reference internal" href="#requirements-notation-and-conventions" id="id26">1.1.  Requirements Notation and Conventions</a></li>
<li><a class="reference internal" href="#terminology" id="id27">1.2.  Terminology</a></li>
<li><a class="reference internal" href="#overview" id="id28">1.3.  Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#messages" id="id29">2.  Messages</a><ul>
<li><a class="reference internal" href="#authorization-endpoint" id="id30">2.1.  Authorization Endpoint</a><ul>
<li><a class="reference internal" href="#authorization-request" id="id31">2.1.1.  Authorization Request</a><ul>
<li><a class="reference internal" href="#openid-request-object" id="id32">2.1.1.1.  OpenID Request Object</a><ul>
<li><a class="reference internal" href="#userinfo-member" id="id33">2.1.1.1.1.  &#8220;userinfo&#8221; member</a></li>
<li><a class="reference internal" href="#messages-2-1-1-1-2" id="id34">2.1.1.1.2.  &#8220;id_token&#8221; member</a></li>
<li><a class="reference internal" href="#claims-member-with-userinfo-and-id-token-members" id="id35">2.1.1.1.3.  &#8220;claims&#8221; member with &#8220;userinfo&#8221; and &#8220;id_token&#8221; members</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#messages-2-1-2" id="id36">2.1.2.  Authorization Request</a><ul>
<li><a class="reference internal" href="#id-token" id="id37">2.1.2.1.  ID Token</a><ul>
<li><a class="reference internal" href="#messages-2-1-2-1-1" id="id38">2.1.2.1.1.  &#8220;userinfo&#8221; member</a></li>
<li><a class="reference internal" href="#messages-2-1-2-1-2" id="id39">2.1.2.1.2.  &#8220;id_token&#8221; member</a></li>
<li><a class="reference internal" href="#messages-2-1-2-1-3" id="id40">2.1.2.1.3.  &#8220;claims&#8221; member with &#8220;userinfo&#8221; and &#8220;id_token&#8221; members</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#authorization-response" id="id41">2.1.3.  Authorization Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#token-endpoint" id="id42">2.2.  Token Endpoint</a><ul>
<li><a class="reference internal" href="#client-authentication" id="id43">2.2.1.  Client Authentication</a></li>
<li><a class="reference internal" href="#access-token-request" id="id44">2.2.2.  Access Token Request</a></li>
<li><a class="reference internal" href="#access-token-response" id="id45">2.2.3.  Access Token Response</a></li>
<li><a class="reference internal" href="#token-error-response" id="id46">2.2.4.  Token Error Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#userinfo-endpoint" id="id47">2.3.  UserInfo Endpoint</a><ul>
<li><a class="reference internal" href="#userinfo-request" id="id48">2.3.1.  UserInfo Request</a></li>
<li><a class="reference internal" href="#userinfo-response" id="id49">2.3.2.  UserInfo Response</a><ul>
<li><a class="reference internal" href="#address-claim" id="id50">2.3.2.1.  Address Claim</a></li>
<li><a class="reference internal" href="#claim-stability-and-uniqueness" id="id51">2.3.2.2.  Claim Stability and Uniqueness</a></li>
</ul>
</li>
<li><a class="reference internal" href="#userinfo-error-response" id="id52">2.3.3.  UserInfo Error Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#messages-2-4" id="id53">2.4.  UserInfo Endpoint</a><ul>
<li><a class="reference internal" href="#messages-2-4-1" id="id54">2.4.1.  UserInfo Request</a></li>
<li><a class="reference internal" href="#messages-2-4-2" id="id55">2.4.2.  UserInfo Response</a><ul>
<li><a class="reference internal" href="#messages-2-4-2-1" id="id56">2.4.2.1.  Address Claim</a></li>
</ul>
</li>
<li><a class="reference internal" href="#messages-2-4-3" id="id57">2.4.3.  UserInfo Error Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#claim-types" id="id58">2.5.  Claim Types</a><ul>
<li><a class="reference internal" href="#normal-claims" id="id59">2.5.1.  Normal Claims</a></li>
<li><a class="reference internal" href="#aggregated-and-distributed-claims" id="id60">2.5.2.  Aggregated and Distributed Claims</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11" id="id61">2.7.  Claim Types</a><ul>
<li><a class="reference internal" href="#messages-2-7-1" id="id62">2.7.1.  Normal Claims</a></li>
<li><a class="reference internal" href="#messages-2-7-2" id="id63">2.7.2.  Aggregated and Distributed Claims</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#serializations" id="id64">3.  Serializations</a><ul>
<li><a class="reference internal" href="#json-serialization" id="id65">3.1.  JSON Serialization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#signatures-and-encryption" id="id66">4.  Signatures and Encryption</a><ul>
<li><a class="reference internal" href="#supported-algorithms" id="id67">4.1.  Supported Algorithms</a></li>
<li><a class="reference internal" href="#keys" id="id68">4.2.  Keys</a></li>
<li><a class="reference internal" href="#signing" id="id69">4.3.  Signing</a></li>
<li><a class="reference internal" href="#encryption" id="id70">4.4.  Encryption</a></li>
</ul>
</li>
<li><a class="reference internal" href="#verification" id="id71">5.  Verification</a><ul>
<li><a class="reference internal" href="#authorization-request-verification" id="id72">5.1.  Authorization Request Verification</a><ul>
<li><a class="reference internal" href="#encrypted-request-object" id="id73">5.1.1.  Encrypted Request Object</a></li>
<li><a class="reference internal" href="#signed-request-object" id="id74">5.1.2.  Signed Request Object</a></li>
<li><a class="reference internal" href="#parameter-verification" id="id75">5.1.3.  Parameter Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#messages-5-2" id="id76">5.2.  ID Token Verification</a></li>
<li><a class="reference internal" href="#check-id-request-verification" id="id77">5.3.  Check ID Request Verification</a></li>
<li><a class="reference internal" href="#check-id-response-verification" id="id78">5.4.  Check ID Response Verification</a></li>
<li><a class="reference internal" href="#userinfo-response-verification" id="id79">5.5.  UserInfo Response Verification</a></li>
<li><a class="reference internal" href="#access-token-verification" id="id80">5.6.  Access Token Verification</a></li>
<li><a class="reference internal" href="#code-verification" id="id81">5.7.  Code Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#string-operations" id="id82">6.  String Operations</a></li>
<li><a class="reference internal" href="#related-specifications" id="id83">7.  Related Specifications</a></li>
<li><a class="reference internal" href="#security-considerations" id="id84">8.  Security Considerations</a><ul>
<li><a class="reference internal" href="#assertion-manufacture-modification" id="id85">8.1.  Assertion Manufacture/Modification</a></li>
<li><a class="reference internal" href="#assertion-disclosure" id="id86">8.2.  Assertion Disclosure</a></li>
<li><a class="reference internal" href="#assertion-repudiation" id="id87">8.3.  Assertion Repudiation</a></li>
<li><a class="reference internal" href="#assertion-redirect" id="id88">8.4.  Assertion Redirect</a></li>
<li><a class="reference internal" href="#assertion-reuse" id="id89">8.5.  Assertion Reuse</a></li>
<li><a class="reference internal" href="#secondary-authenticator-manufacture" id="id90">8.6.  Secondary Authenticator Manufacture</a></li>
<li><a class="reference internal" href="#secondary-authenticator-capture" id="id91">8.7.  Secondary Authenticator Capture</a></li>
<li><a class="reference internal" href="#assertion-substitution" id="id92">8.8.  Assertion Substitution</a></li>
<li><a class="reference internal" href="#authentication-request-disclosure" id="id93">8.9.  Authentication Request Disclosure</a></li>
<li><a class="reference internal" href="#timing-attack" id="id94">8.10.  Timing Attack</a></li>
<li><a class="reference internal" href="#authentication-process-threats" id="id95">8.11.  Authentication Process Threats</a></li>
<li><a class="reference internal" href="#other-crypto-related-attacks" id="id96">8.12.  Other Crypto Related Attacks</a></li>
<li><a class="reference internal" href="#signing-and-encryption-order" id="id97">8.13.  Signing and Encryption order</a></li>
<li><a class="reference internal" href="#issuer-identifier" id="id98">8.14.  Issuer Identifier</a></li>
<li><a class="reference internal" href="#tls-requirements" id="id99">8.15.  TLS Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#privacy-considerations" id="id100">9.  Privacy Considerations</a><ul>
<li><a class="reference internal" href="#refresh-token-and-access-token-lifetime" id="id101">9.1.  Refresh Token, and Access Token Lifetime</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iana-considerations" id="id102">10.  IANA Considerations</a></li>
<li><a class="reference internal" href="#references" id="id103">11.  References</a><ul>
<li><a class="reference internal" href="#normative-references" id="id104">11.1. Normative References</a></li>
<li><a class="reference internal" href="#informative-references" id="id105">11.2. Informative References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#my-note" id="id106">My Note</a><ul>
<li><a class="reference internal" href="#id22" id="id107">2.5.2.  Aggregated and Distributed Claims</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>Based on <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html">OpenID Connect Messages 1.0 - draft 15</a>
( January 22, 2013 )</p>
<div class="section" id="abstract">
<span id="messages-abstract"></span><h2><a class="toc-backref" href="#id24">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>OpenID Connect 1.0 is a simple identity layer on top of the <a class="reference internal" href="glossary.html#term-oauth-2-0"><em class="xref std std-term">OAuth 2.0</em></a> protocol.
It allows <a class="reference internal" href="oauth.html#term-clients"><em class="xref std std-term">Clients</em></a> to verify the <a class="reference internal" href="glossary.html#term-identity"><em class="xref std std-term">identity</em></a> of the <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">End-User</em></a>
based on the <a class="reference internal" href="#term-authentication"><em class="xref std std-term">authentication</em></a> performed by an <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>,
as well as to obtain basic profile information about the <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">End-User</em></a> in an interoperable and <a class="reference internal" href="glossary.html#term-restful-manner"><em class="xref std std-term">RESTful manner</em></a>.</p>
<p>This specification only defines the <a class="reference internal" href="glossary.html#term-endpoints"><em class="xref std std-term">endpoints</em></a> and the associated message formats.
The actual use MUST be based on one of the companion protocol bindings specifications
such as <a class="reference internal" href="standard.html"><em>OpenID Connect Standard</em></a>.</p>
<p>(draft 07)</p>
</div>
<div class="section" id="introduction">
<span id="messages-1"></span><h2><a class="toc-backref" href="#id25">1.  Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>(draft 07)</p>
<div class="section" id="requirements-notation-and-conventions">
<span id="messages-1-1"></span><h3><a class="toc-backref" href="#id26">1.1.  Requirements Notation and Conventions</a><a class="headerlink" href="#requirements-notation-and-conventions" title="Permalink to this headline">¶</a></h3>
<p>The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in RFC 2119 [RFC2119].</p>
<p>Throughout this document, values are quoted to indicate that they are to be taken literally. When using these values in protocol messages, the quotes MUST NOT be used as part of the value.</p>
<p>(drat 07)</p>
</div>
<div class="section" id="terminology">
<span id="messages-1-2"></span><h3><a class="toc-backref" href="#id27">1.2.  Terminology</a><a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<p>This specification uses the terms
&#8220;<a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>&#8221;,
&#8220;<a class="reference internal" href="glossary.html#term-refresh-token"><em class="xref std std-term">Refresh Token</em></a>&#8221;,
&#8220;<a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a>&#8221;,
&#8220;<em class="xref std std-term">Authorization Grant</em>&#8221;,
&#8220;<a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>&#8221;,
&#8220;<a class="reference internal" href="oauth_responses.html#term-authorization-endpoint"><em class="xref std std-term">Authorization Endpoint</em></a>&#8221;,
&#8220;<a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a>&#8221;,
&#8220;<a class="reference internal" href="oauth.html#term-client-identifier"><em class="xref std std-term">Client Identifier</em></a>&#8221;,
&#8220;<a class="reference internal" href="glossary.html#term-225"><em class="xref std std-term">Client Secret</em></a>&#8221;,
&#8220;<a class="reference internal" href="uma_core.html#term-protected-resource"><em class="xref std std-term">Protected Resource</em></a>&#8221;,
&#8220;<a class="reference internal" href="oauth.html#term-resource-owner"><em class="xref std std-term">Resource Owner</em></a>&#8221;,
&#8220;<a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">Resource Server</em></a>&#8221;,
&#8220;<a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a>&#8221; defined by OAuth 2.0 [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>],
&#8220;<em class="xref std std-term">Claim Values</em>&#8221; defined by JSON Web Token (JWT) [<a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a>].</p>
<p>This specification also defines the following terms:</p>
<dl class="glossary docutils">
<dt id="term-authentication">Authentication</dt>
<dd>An act of verifying End-User&#8217;s posession of the previously provisioned credential.</dd>
<dt id="term-claim">Claim</dt>
<dd>A piece of information about an Entity that a Claims Provider asserts about that Entity.</dd>
<dt id="term-claims-provider">Claims Provider</dt>
<dd>An Authorization Server that can return Claims about an Entity.</dd>
<dt id="term-end-user">End-User</dt>
<dd>A human Resource Owner.</dd>
<dt id="term-entity">Entity</dt>
<dd>Something that has a separate and distinct existence and that can be identified in context. An End-User is one example of an Entity.</dd>
<dt id="term-personally-identifiable-information-pii">Personally Identifiable Information (PII)</dt>
<dd>Any information that (a) can be used to identify the natural person to whom such information relates,
or (b) is or might be directly or indirectly linked to a natural person to whom such information relates.</dd>
<dt id="term-pairwise-pseudonymous-identifier-ppid">Pairwise Pseudonymous Identifier (PPID)</dt>
<dd>An identifier that identifies the Entity to a Relying Party.
An Entity&#8217;s PPID at one Relying Party cannot be correlated with the Entity&#8217;s PPID at another Relying Party.</dd>
<dt id="term-id-token">ID Token</dt>
<dd>A token that contains Claims about the authentication event.</dd>
<dt id="term-issuer">Issuer</dt>
<dd>An Entity that issues a set of Claims.</dd>
<dt id="term-issuer-identifier">Issuer Identifier</dt>
<dd>A verifiable identifier for an Issuer.
An Issuer Identifier is an HTTPS URL that only contains scheme,
host, and OPTIONALLY, port number components. (No path component may be present.)</dd>
<dt id="term-message">Message</dt>
<dd>A request or a response between an OpenID Relying Party and an OpenID Provider.</dd>
<dt id="term-openid-provider-op">OpenID Provider (OP)</dt>
<dd>A service capable of providing Claims to a Relying Party.</dd>
<dt id="term-op-endpoints">OP Endpoints</dt>
<dd>Authorization Endpoint, Token Endpoint, and UserInfo Endpoint.</dd>
<dt id="term-openid-request-object">OpenID Request Object</dt>
<dd>A JSON object that holds the OpenID request parameters.</dd>
<dt id="term-relying-party-rp">Relying Party (RP)</dt>
<dd>An application requiring Claims from an OpenID Provider.</dd>
<dt id="term-check-id-endpoint">Check ID Endpoint</dt>
<dd>A resource that, when presented with an ID Token by the Client,
returns Claims about the user session represented by that ID Token.</dd>
<dt id="term-userinfo-endpoint">UserInfo Endpoint</dt>
<dd>A Protected Resource that, when presented with an Access Token by the Client,
returns Claims about the End-User represented by that Access Token.</dd>
</dl>
<p>(draft 07)</p>
</div>
<div class="section" id="overview">
<span id="messages-1-3"></span><h3><a class="toc-backref" href="#id28">1.3.  Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The OpenID Connect protocol, in abstract, follows the following steps.</p>
<blockquote>
<div><ol class="arabic simple">
<li>The <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> sends a request to the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>&#8216;s <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">End-User</em></a> <a class="reference internal" href="oauth_responses.html#term-authorization-endpoint"><em class="xref std std-term">Authorization Endpoint</em></a>.</li>
<li>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> authenticates the <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">End-User</em></a> and obtains appropriate authorization.</li>
<li>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> responds with an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>, an <a class="reference internal" href="#term-id-token"><em class="xref std std-term">Id Token</em></a>, and a few other variables.</li>
<li>The <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> sends a request with the <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a> to the <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a>.</li>
<li><a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> returns the additional <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">End-User</em></a> information supported by the <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">Resource Server</em></a>.</li>
<li>Optionally, the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> sends a request with the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> to the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>&#8216;s <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a>.</li>
<li>Optionally, the <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a> responds with authentication information pertaining to the supplied <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>.</li>
</ol>
</div></blockquote>
<p>This specification only defines the abstract message flow and message formats.
The actual use MUST be based on one of the companion protocol bindings specifications
such as OpenID Connect Basic Client [<a class="reference internal" href="#term-openid-basic"><em class="xref std std-term">OpenID.Basic</em></a>] or OpenID Connect Standard [<a class="reference internal" href="#term-openid-standard"><em class="xref std std-term">OpenID.Standard</em></a>].</p>
<p>(draft 07)</p>
</div>
</div>
<div class="section" id="messages">
<span id="messages-2"></span><h2><a class="toc-backref" href="#id29">2.  Messages</a><a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h2>
<p>In OpenID Connect protocols, in abstract,
the process proceeds by the RP interacting with endpoints.
There are a number of endpoints involved.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Authorization Endpoint:</p>
<p>The RP sends a request to the OP at the Authorization Endpoint.
The OP then authenticates the End-User to find out
if he is eligible to make the authorization.</p>
<p>Then, upon the authorization action of the End-User,
the Authorization Server returns an Authorization Response
that includes Authorization Code, code.</p>
<p>For some Clients,
Implicit Grant may be used to obtain access_token without using code.
In this case, response_type MUST include token.
When id_token was specified in the response_type,
then the id_token is returned from this endpoint as well.</p>
</li>
<li><p class="first">Token Endpoint:</p>
<p>The Client sends the Access Token Request to the Token Endpoint
to obtain an Access Token Response which includes an access_token.</p>
</li>
<li><p class="first">UserInfo Endpoint:</p>
<p>The access_token MAY be sent to the UserInfo Endpoint
to obtain Claims about the End-User.</p>
</li>
</ol>
</div></blockquote>
<p>(draft 13, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor3">http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor3</a> )</p>
<div class="section" id="authorization-endpoint">
<span id="messages-2-1"></span><h3><a class="toc-backref" href="#id30">2.1.  Authorization Endpoint</a><a class="headerlink" href="#authorization-endpoint" title="Permalink to this headline">¶</a></h3>
<p>The RP sends an Authorization Request
to the Authorization Endpoint of the OP
to obtain either an Authorization Response
or an ID Token
or both depending on response_type and scope.</p>
<p>( draft 13, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor4">http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor4</a> )</p>
<div class="section" id="authorization-request">
<span id="messages-2-1-1"></span><h4><a class="toc-backref" href="#id31">2.1.1.  Authorization Request</a><a class="headerlink" href="#authorization-request" title="Permalink to this headline">¶</a></h4>
<p>An Authorization Request is a message sent from an RP
to the OP&#8217;s Authorization Endpoint.
It is an extended OAuth 2.0 [OAuth2.0] Authorization Request.
<a class="reference internal" href="oauth.html#oauth-4-1-1"><em>Section 4.1.1</em></a> and <em class="xref std std-ref">4.2.1</em> of OAuth 2.0 [OAuth2.0]
defines the OAuth 2.0 Authorization Request parameters.</p>
<p>In this specification, the values to the parameters are defined as follows.</p>
<dl class="glossary docutils">
<dt id="term-response-type">response_type</dt>
<dd><p class="first">This parameter controls the parameters returned in the response from the Authorization Endpoint.
The OAuth 2.0 specification documents two response types:</p>
<blockquote>
<div><dl class="docutils">
<dt>code</dt>
<dd><p class="first">When supplied as the value for the response_type parameter,
a successful response MUST include an Authorization Code as defined in the OAuth 2.0 specification.</p>
<p class="last">Both successful and error responses MUST be added as parameters to the query component of the response.
All tokens are returned from the Token Endpoint.
Authorization Servers MUST support this response_type.</p>
</dd>
<dt>token</dt>
<dd><p class="first">When supplied as the value for the response_type parameter,
a successful response MUST include an Access Token
as defined in the OAuth 2.0 specification.</p>
<p>Both successful and error responses MUST be fragment-encoded.</p>
<p class="last">No ID Token is provided to the Client.</p>
</dd>
</dl>
</div></blockquote>
<p>OpenID Connect supports these additional response types [OAuth.Responses] that have been registered:</p>
<blockquote>
<div><dl class="docutils">
<dt>id_token</dt>
<dd>When supplied as the value for the response_type parameter,
a successful response MUST include an ID Token.
Both successful and error responses SHOULD be fragment-encoded.
Authorization Servers SHOULD support this response_type.</dd>
<dt>id_token token</dt>
<dd><p class="first">When supplied as the value for the response_type parameter,
a successful response MUST include both an Access Token
as well as an ID Token.</p>
<p class="last">Both successful and error responses SHOULD be fragment-encoded.
Authorization Servers MUST support this response_type.</p>
</dd>
<dt>code token</dt>
<dd><p class="first">When supplied as the value for the response_type parameter,
a successful response MUST include both an Access Token
and an Authorization Code as defined in the OAuth 2.0 specification.</p>
<p class="last">Both successful and error responses SHOULD be fragment-encoded.</p>
</dd>
<dt>code id_token</dt>
<dd><p class="first">When supplied as the value for the response_type parameter,
a successful response MUST include both an Authorization Code
as well as an ID Token.</p>
<p class="last">Both successful and error responses SHOULD be fragment-encoded.</p>
</dd>
<dt>code id_token token</dt>
<dd><p class="first">When supplied as the value for the response_type parameter,
a successful response MUST include an Authorization Code, an ID Token,
and an Access Token.</p>
<p class="last">Both successful and error responses SHOULD be fragment-encoded.</p>
</dd>
</dl>
</div></blockquote>
<p class="last">The Authorization Server MUST support all three of the code, id_token, and id_token token values for response_type.
The Client may request any OAuth 2.0 registered response type supported by the Authorization Server.</p>
</dd>
<dt id="term-scope">scope</dt>
<dd><p class="first">A space delimited, case sensitive list of ASCII string values.
The values specify an additive list of voluntary Claims that are returned from the UserInfo Endpoint.
The following scope values are defined:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>openid</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">Informs the Authorization Server that the Client is making an OpenID Connect request.
If the openid scope value is not present,
the request <strong>MUST NOT</strong> be treated as an OpenID Connect request.
This scope value requests access to the user_id Claim at the UserInfo Endpoint.</p>
</dd>
<dt>profile</dt>
<dd><p class="first">OPTIONAL.</p>
<p>This scope value requests that access to the End-User&#8217;s default profile Claims
at the UserInfo Endpoint be granted by the issued Access Token.</p>
<p class="last">These claims are: name, family_name, given_name, middle_name,
nickname, preferred_username, profile, picture, website, gender,
birthdate, zoneinfo, locale, and updated_time.</p>
</dd>
<dt>email</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">This scope value requests that access to the email and email_verified Claims
at the UserInfo Endpoint be granted by the issued Access Token.</p>
</dd>
<dt>address</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">This scope value requests that access to address Claim
at the UserInfo Endpoint be granted by the issued Access Token.</p>
</dd>
<dt>phone</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">This scope value requests that access to the phone_number Claim
at the UserInfo Endpoint be granted by the issued Access Token.</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>Other REQUIRED OAuth 2.0 parameters in the request include:</p>
<dl class="glossary docutils">
<dt id="term-client-id">client_id</dt>
<dd>The OAuth 2.0 Client Identifier.</dd>
<dt id="term-redirect-uri">redirect_uri</dt>
<dd>A redirection URI where the response will be sent.</dd>
</dl>
<p>The request MAY contain the following OAuth 2.0 parameters:</p>
<dl class="glossary docutils">
<dt id="term-state">state</dt>
<dd><p class="first">RECOMMENDED.</p>
<p class="last">An opaque value used to maintain state between the request and the callback;
it can serve as a protection against XSRF attacks, among other uses.</p>
</dd>
</dl>
<p>The following extension parameters are also defined:</p>
<dl class="glossary docutils">
<dt id="term-nonce">nonce</dt>
<dd><p class="first">A random, unique string value used to mitigate replay attacks.</p>
<p>Use of the nonce is REQUIRED when using the implicit flow and OPTIONAL when using the code flow.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference internal" href="openid_connect.html#term-implicit"><em class="xref std std-term">implicit</em></a> flow &lt;= <a class="reference internal" href="#term-63"><em class="xref std std-term">nonce</em></a></li>
</ul>
</div>
</dd>
<dt id="term-display">display</dt>
<dd><p class="first">OPTIONAL.</p>
<p>An ASCII string value that specifies
how the Authorization Server displays the authentication and consent user interface pages to the End-User.</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>page</dt>
<dd><p class="first">The Authorization Server SHOULD display authentication
and consent UI consistent with a full user-agent page view.</p>
<p class="last">If the display parameter is not specified this is the default display mode.</p>
</dd>
<dt>popup</dt>
<dd><p class="first">The Authorization Server SHOULD display authentication and consent UI consistent
with a popup user-agent window.</p>
<p class="last">The popup user-agent window SHOULD be 450 pixels wide and 500 pixels tall.</p>
</dd>
<dt>touch</dt>
<dd><p class="first">The Authorization Server SHOULD display authentication and consent UI consistent
with a device that leverages a touch interface.</p>
<p class="last">The Authorization Server MAY attempt to detect the touch device and further customize the interface.</p>
</dd>
<dt>wap</dt>
<dd>The Authorization Server SHOULD display authentication and consent UI consistent
with a &#8220;feature phone&#8221; type display.</dd>
</dl>
</div></blockquote>
</dd>
<dt id="term-prompt">prompt</dt>
<dd><p class="first">OPTIONAL.</p>
<p>A space delimited, case sensitive list of ASCII string values that specifies
whether the Authorization Server prompts the End-User for reauthentication and consent.
The possible values are:</p>
<dl class="glossary docutils">
<dt id="term-none">none</dt>
<dd><p class="first">The Authorization Server MUST NOT display any authentication or
consent user interface pages.</p>
<p>An error is returned if the End-User is not already authenticated or
the Client does not have pre-configured consent for the requested scopes.</p>
<p class="last">This can be used as a method to check for existing authentication and/or consent.</p>
</dd>
<dt id="term-login">login</dt>
<dd>The Authorization Server MUST prompt the End-User for reauthentication.</dd>
<dt id="term-consent">consent</dt>
<dd>The Authorization Server MUST prompt the End-User for consent
before returning information to the Client.</dd>
<dt id="term-select-account">select_account</dt>
<dd>The Authorization Server MUST prompt the End-User to select a user account.
This allows a user who has multiple accounts at the Authorization Server
to select amongst the multiple accounts that they may have current sessions for.</dd>
</dl>
<p>The prompt parameter can be used by the Client
to make sure that the End-User is still present for the current session
or to bring attention to the request.</p>
<p class="last">If this parameter contains none with any other value, an error is returned.</p>
</dd>
<dt id="term-request">request</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">An OpenID Request Object value.</p>
</dd>
<dt id="term-request-uri">request_uri</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">An URL that points to an OpenID Request Object. This is used to pass an OpenID Request Object by reference.</p>
</dd>
<dt id="term-id-token-hint">id_token_hint</dt>
<dd><p class="first">OPTIONAL.</p>
<p>An ID Token passed to the Authorization server
as a hint about the user&#8217;s current or past authenticated session
with the client.</p>
<p>This SHOULD be present if prompt=none is sent.
The value is a JWS [JWS] encoded ID token as signed by the issuer,
the JWS [JWS] may be JWE [JWE] encrypted by the public key
of the issuer for additional confidentiality.</p>
<p>If the id_token received by the RP was encrypted,
the Client MUST decrypt the signed id_token (JWS [JWS]).</p>
<p class="last">The Client MAY re-encrypt using the key that the server is capable of decrypting.</p>
</dd>
<dt id="term-login-hint">login_hint</dt>
<dd><p class="first">OPTIONAL.</p>
<p>A hint to the authorization service as to the login identifier
the user may use to authenticate at the authorization service (if necessary).</p>
<p>This hint can be used by an RP if it first asks the user
for their email address (or other identifier) and
then wants to pass that value as a hint to the discovered authorization service.</p>
<p class="last">It is recommended that the hint value match the value used for discovery.
The use of this parameter is up to the IdP&#8217;s discretion.</p>
</dd>
</dl>
<p>(draft 13, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#auth_req">http://openid.bitbucket.org/openid-connect-messages-1_0.html#auth_req</a> )</p>
<div class="section" id="openid-request-object">
<span id="messages-2-1-1-1"></span><h5><a class="toc-backref" href="#id32">2.1.1.1.  OpenID Request Object</a><a class="headerlink" href="#openid-request-object" title="Permalink to this headline">¶</a></h5>
<p>The OpenID Request Object is used to provide OpenID request parameters
that MAY differ from the default ones.
Implementing support for the OpenID Request Object is OPTIONAL.
Supporting it is necessary for implementations that need to request
or provide sets of Claims other than the default UserInfo, and ID Token Claim sets.</p>
<p>The OpenID Request Object is a JWS [JWS] signed base64url encoded JSON object
that is passed as the value of the &#8220;request&#8221; parameter in the Authorization Request.
The OpenID Request Object MAY also be encrypted using JWE [JWE]
after signing, with nesting performed in the same manner as specified for JWTs [JWT].
The OpenID Request Object MAY alternatively be sent by reference
using request_uri parameter. Parameters that affect the information returned
from the UserInfo Endpoint are in the &#8220;userinfo&#8221; member.
Parameters that affect the information returned in the ID Token are in the &#8220;id_token&#8221; member.</p>
<p>Authorization Request parameters that are included in the OAuth 2.0 Authorization Request
MAY also be included in the OpenID Request Object
(so that they can be part of the signed request).
All parameter values that are present both in the OAuth 2.0 Authorization Request
and in the OpenID Request Object MUST exactly match.</p>
<p>Authorization Request parameters that are OPTIONAL in the OAuth 2.0 specification
MAY be included in the OpenID Request Object without also passing them
as OAuth 2.0 Authorization Request parameters,
with one exception:
The <a class="reference internal" href="oauth_introspect.html#term-scope"><em class="xref std std-term">scope</em></a> parameter MUST always be present in OAuth 2.0 Authorization Request parameters
(so that the OAuth 2.0 implementation has access to the openid scope value).
However,
the request and request_uri parameters MUST NOT be included in the OpenID Request Object.</p>
<p>The OpenID Request Object MAY contain other members
that are not defined by this specification.
With only one exception,
OpenID Request Object members MUST be understood by both parties;
that exception is that OpenID Providers MAY ignore requests for Claims
they cannot provide or do not understand; however,
Relying Parties MAY also consider it an error condition
if all requested required Claims are not provided.</p>
<p>The OpenID Request Object MAY be signed or unsigned (plaintext).
When it is plaintext,
this is indicated by use of the none algorithm [JWA] in the JWS header.
If signed,
the OpenID Request Object SHOULD contain the Claims iss (issuer)
and aud (audience) as members,
with their semantics being the same as defined in the JWT [JWT] specification.</p>
<p>The OpenID Request Object members defined by this specification are:</p>
<dl class="glossary docutils">
<dt id="term-userinfo">userinfo</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">(UserInfo request):
Requests affecting the values to be returned from the UserInfo Endpoint.
If not present,
the UserInfo Endpoint behaves in the default manner.</p>
</dd>
<dt id="term-34">id_token</dt>
<dd><p class="first">OPTIONAL.</p>
<p>(ID Token request):
Requests affecting the values to be to be returned in the ID Token.
If not present, the default ID Token contents are used.</p>
<p class="last">If present,
these parameters are used to request additional Claims incremental to the default Claims of the ID Token.</p>
</dd>
<dt id="term-registration">registration</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">(Registration request):
Requests the client to be to be registered at the authorization server for the self-issued case.
The value is the key-values defined in section 2.1 of the OpenID Connect Registration
[OpenID.Registration] serialized into JSON.</p>
</dd>
</dl>
<p>An example OpenID Request Object body before base64url encoding and JWS signing is as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;response_type&quot;</span><span class="o">:</span> <span class="s2">&quot;code id_token&quot;</span><span class="p">,</span>
 <span class="s2">&quot;client_id&quot;</span><span class="o">:</span> <span class="s2">&quot;s6BhdRkqt3&quot;</span><span class="p">,</span>
 <span class="s2">&quot;redirect_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;https://client.example.org/cb&quot;</span><span class="p">,</span>
 <span class="s2">&quot;scope&quot;</span><span class="o">:</span> <span class="s2">&quot;openid profile&quot;</span><span class="p">,</span>
 <span class="s2">&quot;state&quot;</span><span class="o">:</span> <span class="s2">&quot;af0ifjsldkj&quot;</span><span class="p">,</span>
 <span class="s2">&quot;login_hint&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.org&quot;</span><span class="p">,</span>
 <span class="s2">&quot;userinfo&quot;</span><span class="o">:</span>
   <span class="p">{</span>
     <span class="s2">&quot;claims&quot;</span><span class="o">:</span>
       <span class="p">{</span>
         <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
         <span class="s2">&quot;nickname&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
         <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
         <span class="s2">&quot;email_verified&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
         <span class="s2">&quot;picture&quot;</span><span class="o">:</span> <span class="kc">null</span>
       <span class="p">}</span>
   <span class="p">},</span>
 <span class="s2">&quot;id_token&quot;</span><span class="o">:</span>
   <span class="p">{</span>
     <span class="s2">&quot;claims&quot;</span><span class="o">:</span>
       <span class="p">{</span>
        <span class="s2">&quot;auth_time&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;essential&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="s2">&quot;acr&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;values&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">]</span> <span class="p">}</span>
       <span class="p">},</span>
     <span class="s2">&quot;max_age&quot;</span><span class="o">:</span> <span class="mi">86400</span>
   <span class="p">}</span>
 <span class="s2">&quot;registration&quot;</span><span class="o">:</span>
   <span class="p">{</span>
    <span class="s2">&quot;redirect_uris&quot;</span><span class="o">:</span> <span class="s2">&quot;https://rp.com/authz/callback&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logo_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https://rp.com/logo.png&quot;</span><span class="p">,</span>
    <span class="s2">&quot;jwk_url&quot;</span><span class="o">=</span><span class="s2">&quot;https://rp.com/public_key.jwk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id_token_encrypted_response_alg&quot;</span><span class="o">:</span> <span class="s2">&quot;RSA1_5 A128CBC&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 13, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#OpenID_Request_Object">http://openid.bitbucket.org/openid-connect-messages-1_0.html#OpenID_Request_Object</a> )</p>
<div class="section" id="userinfo-member">
<span id="messages-2-1-1-1-1"></span><h6><a class="toc-backref" href="#id33">2.1.1.1.1.  &#8220;userinfo&#8221; member</a><a class="headerlink" href="#userinfo-member" title="Permalink to this headline">¶</a></h6>
<p>The structure of the userinfo (UserInfo Request) member is a JSON object that MAY contain the following members:</p>
<dl class="glossary docutils">
<dt id="term-claims">claims</dt>
<dd><p class="first">OPTIONAL.</p>
<p>(Requested Claims):
A JSON object containing a set of individual Claims
being requested from the UserInfo Endpoint
in addition to those requested by the scope values used.</p>
<p>If not present,
only the UserInfo Claims held by the OP that are requested
by the scope values used are returned.</p>
<p class="last">For details about this claim,
refer to &#8220;claims&#8221; member in &#8220;userinfo&#8221; and &#8220;id_token&#8221; section.</p>
</dd>
<dt id="term-preferred-locales">preferred_locales</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">A list of preferred languages and scripts for the entire Claims request,
represented as a JSON array of BCP47 [RFC5646] language tag values, ordered by preference.</p>
</dd>
</dl>
<p>All members of the userinfo object are OPTIONAL. Other members MAY be present and if so, SHOULD understood by both parties.</p>
<p>(draft 13 )</p>
</div>
<div class="section" id="messages-2-1-1-1-2">
<span id="id-token-member"></span><h6><a class="toc-backref" href="#id34">2.1.1.1.2.  &#8220;id_token&#8221; member</a><a class="headerlink" href="#messages-2-1-1-1-2" title="Permalink to this headline">¶</a></h6>
<p>The structure and function of the id_token (ID Token request) member
of the OpenID Request Object is similar to that of the userinfo member.
It MAY include the OPTIONAL claims and preferred_locales members.</p>
<p>The structure of these members is the same as that for the userinfo member.
If the claims member is present in the id_token object,
the Claims requested within it augment the Claim set that would otherwise be returned in the ID Token.</p>
<p>Following Claims,
in addition to the claims described in &#8220;claims&#8221; member
in &#8220;userinfo&#8221; and &#8220;id_token&#8221; section.,
MAY be requested in the ID Token by specifying it in the claims member:</p>
<dl class="glossary docutils">
<dt id="term-user-id">user_id</dt>
<dd><p class="first">OPTIONAL.</p>
<p>(User Identifier):
The User Identifier for which an ID Token is being requested.
If the specified user is not currently authenticated to the Authorization Server,
they may be prompted for authenticated,
unless the <a class="reference internal" href="#term-52"><em class="xref std std-term">prompt</em></a> parameter in the Authorization Request is set to <a class="reference internal" href="#term-none"><em class="xref std std-term">none</em></a>.
The Claim Value in the request is an object containing the single element value.</p>
<div class="last highlight-javascript"><div class="highlight"><pre><span class="s2">&quot;user_id&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="o">:</span><span class="s2">&quot;248289761001&quot;</span><span class="p">}</span>
</pre></div>
</div>
</dd>
<dt id="term-auth-time">auth_time</dt>
<dd><p class="first">OPTIONAL.</p>
<p>(authenticated at):
Requests that the <a class="reference internal" href="#term-71"><em class="xref std std-term">auth_time</em></a> Claim be present in the ID Token response.
The Claim Value in the request must be {&#8220;essential&#8221;: true}
to require auth_time in the response.</p>
<p class="last">If the Claim Value in the request is null the has the option
of not including the claim in the response.</p>
</dd>
<dt id="term-acr">acr</dt>
<dd><p class="first">OPTIONAL.</p>
<p>(<a class="reference internal" href="glossary.html#term-16"><em class="xref std std-term">Authentication Context Class Reference</em></a>):
Requests the desired Authentication Context Class References.
The element values is an ordered array of strings
representing acceptable <a class="reference internal" href="glossary.html#term-16"><em class="xref std std-term">Authentication Context Class Reference</em></a> values appearing in order of preference.</p>
<div class="last highlight-javascript"><div class="highlight"><pre><span class="s2">&quot;acr&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;values&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;http://id.incommon.org/assurance/bronze&quot;</span><span class="p">]}</span>
</pre></div>
</div>
</dd>
</dl>
<p>In addition to the claims member,
these additional members are defined
within the <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> member of the OpenID Request Object:</p>
<dl class="glossary docutils">
<dt id="term-max-age">max_age</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">(max authentication age):
Specifies that the End-User must be actively authenticated
if any present authentication is older than the specified number of seconds.
(The max_age request parameter corresponds to the OpenID 2.0 PAPE [OpenID.PAPE] max_auth_age request parameter.)</p>
</dd>
</dl>
<p>It is anticipated that
additional id_token parameters MAY be defined to request
that additional properties hold for the authentication -
for instance, that
certain authentication policies be applied
(in the same spirit of the OpenID 2.0 PAPE <em class="xref std std-term">[OpenID.PAPE]</em> <em class="xref std std-term">auth_policies</em> values),
or that the authentication conform to the policies
defined by a specified trust framework.
These parameters MAY be defined by extension specifications.</p>
<p>All members of the id_token object are OPTIONAL.
Other members MAY be present and if so, SHOULD be understood by both parties.</p>
<p>(draft 13)</p>
</div>
<div class="section" id="claims-member-with-userinfo-and-id-token-members">
<span id="messages-2-1-1-1-3"></span><h6><a class="toc-backref" href="#id35">2.1.1.1.3.  &#8220;claims&#8221; member with &#8220;userinfo&#8221; and &#8220;id_token&#8221; members</a><a class="headerlink" href="#claims-member-with-userinfo-and-id-token-members" title="Permalink to this headline">¶</a></h6>
<p>The claims member is a JSON object with a member for each requested Claim.
The member names are the requested Claim names. Each Claim MAY either be an essential claim or voluntary claim. The default is voluntary.</p>
<p>By requesting Claims as essential, the client indicates to the user that releasing these claims will ensure a smooth authorization for the specific task requested by the user. Note that even if the claims are not available because the user did not authorize their release or they are not present, the Authorization Server MUST NOT generate an error when essential claims are not returned.</p>
<p>The Client may request additional Claims on voluntary basis that it requires to perform other tasks offered to the user.</p>
<p>The member values MAY be either:</p>
<dl class="glossary docutils">
<dt id="term-null">null</dt>
<dd>This indicates that this Claim is being requested in the default manner. In particular, this is a voluntary Claim.</dd>
<dt id="term-a-json-object">A JSON Object</dt>
<dd><p class="first">This is used to provide additional information about the Claim being requested. This specification defines the following member:</p>
<dl class="glossary docutils">
<dt id="term-essential">essential</dt>
<dd>OPTIONAL.
If the value is set to true, this indicates that the claim being requested is an essential claim.
If the value is set to false, it indicates that it is a voluntary claim. The default is false.</dd>
</dl>
<p class="last">Other members MAY be defined to provide additional information about the requested Claim.</p>
</dd>
</dl>
<p>The Claims MAY be represented in multiple languages and scripts. To specify languages and scripts for the Claim request, BCP47 [RFC5646] language tags delimited by a &#8220;#&#8221; MUST be added to each requested Claim Name for which a particular language and script is requested. For example, the Claim family_name#ja-Kana-JP is used for expressing Family Name in Katakana in Japanese, which is commonly used to index and represent the phonetics of the Kanji representation of the same value represented as family_name#ja-Hani-JP.</p>
<p>All members of the claims object are OPTIONAL.</p>
<p>(draft 13)</p>
</div>
</div>
</div>
<div class="section" id="messages-2-1-2">
<span id="id1"></span><h4><a class="toc-backref" href="#id36">2.1.2.  Authorization Request</a><a class="headerlink" href="#messages-2-1-2" title="Permalink to this headline">¶</a></h4>
<p>An <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a> is a message sent from an RP
to the OP&#8217;s <a class="reference internal" href="oauth_responses.html#term-authorization-endpoint"><em class="xref std std-term">Authorization Endpoint</em></a>.
It is an extended OAuth 2.0 [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>] <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a>.</p>
<p>Section <em class="xref std std-ref">4.1.1</em> and <a class="reference internal" href="oauth.html#oauth-4-2-1"><em>4.2.1</em></a>
of OAuth 2.0 [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>]
defines the OAuth <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a> parameters.
In this specification,
the values to the parameters are defined as follows.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a> : <em class="xref std std-ref">4.1.1</em></li>
<li><a class="reference internal" href="openid_connect.html#term-implicit"><em class="xref std std-term">Implicit</em></a> : <a class="reference internal" href="oauth.html#oauth-4-2-1"><em>4.2.1</em></a></li>
</ul>
</div>
<dl class="glossary docutils">
<dt id="term-45">response_type</dt>
<dd><p class="first">This parameter controls the parameters returned
in the response from the <a class="reference internal" href="oauth_responses.html#term-authorization-endpoint"><em class="xref std std-term">Authorization Endpoint</em></a>.
The OAuth 2.0 specification documents two response types:</p>
<blockquote>
<div><dl class="docutils">
<dt>code</dt>
<dd><p class="first">When supplied as the value for the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> parameter,
a successful response MUST include an <a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a>
as defined in the OAuth 2.0 specification.</p>
<p>Both successful and error responses MUST be added as parameters
to the <a class="reference internal" href="glossary.html#term-query-component"><em class="xref std std-term">query component</em></a> of the response.</p>
<p>All tokens are returned from the <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a>.</p>
<p class="last"><a class="reference internal" href="oauth.html#term-authorization-servers"><em class="xref std std-term">Authorization Servers</em></a> <strong>MUST</strong> support this <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a>.</p>
</dd>
<dt>token</dt>
<dd><p class="first">When supplied as the value for the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> parameter,
a successful response MUST include an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>
as defined in the OAuth 2.0 specification.</p>
<p>Both successful and error responses MUST be <em class="xref std std-term">fragment-encoded</em>.</p>
<p class="last">No <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> is provided to the Client.</p>
</dd>
</dl>
</div></blockquote>
<p>OpenID Connect supports these additional response types
[<a class="reference internal" href="#term-oauth-responses"><em class="xref std std-term">OAuth.Responses</em></a>] that have been registered:</p>
<blockquote>
<div><dl class="docutils">
<dt>id_token</dt>
<dd><p class="first">When supplied as the value for the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> parameter,
a successful response MUST include an <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>.</p>
<p>Both successful and error responses SHOULD be <em class="xref std std-term">fragment-encoded</em>.</p>
<p class="last">Authorization Servers SHOULD support this response_type.</p>
</dd>
<dt>id_token token</dt>
<dd><p class="first">When supplied as the value for the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> parameter,
a successful response MUST include both an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>
as well as an <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>.</p>
<p>Both successful and error responses SHOULD be <em class="xref std std-term">fragment-encoded</em>.</p>
<p class="last">Authorization Servers MUST support this response_type.</p>
</dd>
<dt>code token</dt>
<dd><p class="first">When supplied as the value for the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> parameter,
a successful response MUST include both an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a> and an <a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a>
as defined in the OAuth 2.0 specification.</p>
<p class="last">Both successful and error responses SHOULD be <em class="xref std std-term">fragment-encoded</em>.</p>
</dd>
<dt>code id_token</dt>
<dd><p class="first">When supplied as the value for the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> parameter,
a successful response MUST include both an <a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a> as well as an <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>.</p>
<p class="last">Both successful and error responses SHOULD be <em class="xref std std-term">fragment-encoded</em>.</p>
</dd>
<dt>code id_token token</dt>
<dd><p class="first">When supplied as the value for the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> parameter,
a successful response MUST include an <a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a>,
an <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>, and an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>.</p>
<p class="last">Both successful and error responses SHOULD be <em class="xref std std-term">fragment-encoded</em>.</p>
</dd>
</dl>
</div></blockquote>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST support all three of the
<a class="reference internal" href="oauth.html#term-code"><em class="xref std std-term">code</em></a>, <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a>, and <a class="reference internal" href="standard.html#term-id-token-token"><em class="xref std std-term">id_token token</em></a> values for <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a>.</p>
<p class="last">The Client may request any OAuth 2.0 registered response type
supported by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.</p>
</dd>
<dt id="term-46">scope</dt>
<dd><p class="first">A <strong>space delimited</strong>,
<strong>case sensitive</strong> list of ASCII string values.</p>
<p>The values specify an additive list of <em class="xref std std-term">voluntary Claims</em>
that are returned from the <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a>
unless the <em class="xref std std-term">claims_in_id_token</em> scope value is used,
in which case the requested claims are instead returned in the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>.</p>
<p>The following scope values are defined:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>openid</dt>
<dd><p class="first">REQUIRED.
Informs the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> that
the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> is making an OpenID Connect request.
If the <a class="reference internal" href="glossary.html#term-openid"><em class="xref std std-term">openid</em></a> scope is not present,
the request <strong>MUST NOT be treated as an OpenID Connect request</strong>.</p>
<p class="last">This scope value requests access to the <a class="reference internal" href="#term-94"><em class="xref std std-term">user_id</em></a> Claim
at the <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a>.</p>
</dd>
<dt>profile</dt>
<dd>OPTIONAL.
This scope value requests that access to the End-User&#8217;s default profile Claims
at the UserInfo Endpoint be granted by the issued Access Token.
These claims are:
name, family_name, given_name, middle_name, nickname, profile, picture,
website, gender, birthday, zoneinfo, locale, and updated_time.</dd>
<dt>email</dt>
<dd>OPTIONAL.
This scope value requests that access to the email and email_verified Claims
at the UserInfo Endpoint be granted by the issued Access Token.</dd>
<dt>address</dt>
<dd>OPTIONAL.
This scope value requests that access to address Claim
at the UserInfo Endpoint be granted by the issued Access Token.</dd>
<dt>phone</dt>
<dd>OPTIONAL.
This scope value requests that access to the phone_number Claim
at the UserInfo Endpoint be granted by the issued Access Token.</dd>
<dt>claims_in_id_token</dt>
<dd><p class="first">OPTIONAL.
Use of this scope value switches where the Claims requested
via other scope values are returned.</p>
<p>If this scope value is present,
the voluntary claims that are requested with the profile, email, address,
and phone scope values are returned in the ID Token,
rather than from the UserInfo Endpoint.</p>
<p class="last">If finer grained control is required, an OpenID Request Object MUST be used.</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>Other REQUIRED OAuth 2.0 parameters in the request include:</p>
<dl class="glossary docutils">
<dt id="term-47">client_id</dt>
<dd>The OAuth 2.0 Client Identifier.</dd>
<dt id="term-48">redirect_uri</dt>
<dd>A redirection URI where the response will be sent.</dd>
</dl>
<p>The request MAY contain the following OAuth 2.0 parameters:</p>
<dl class="glossary docutils">
<dt id="term-49">state</dt>
<dd>RECOMMENDED.
An opaque value used to maintain state between the request and the callback; it can serve as a protection against XSRF attacks, among other uses.</dd>
</dl>
<p>The following extension parameters are also defined:</p>
<dl class="glossary docutils">
<dt id="term-50">nonce</dt>
<dd>A random, unique string value used to mitigate replay attacks.
Use of the nonce is REQUIRED when using the implicit flow and OPTIONAL when using the code flow.</dd>
<dt id="term-51">display</dt>
<dd><p class="first">OPTIONAL.
An ASCII string value that specifies how the Authorization Server displays
the authentication and consent user interface pages to the End-User.</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>page</dt>
<dd>The Authorization Server SHOULD display authentication and consent UI consistent
with a full user-agent page view.
If the display parameter is not specified this is the default display mode.</dd>
<dt>popup</dt>
<dd>The Authorization Server SHOULD display authentication and consent UI consistent
with a popup user-agent window.
The popup user-agent window SHOULD be 450 pixels wide and 500 pixels tall.</dd>
<dt>touch</dt>
<dd><p class="first">The Authorization Server SHOULD display authentication and consent UI consistent
with a device that leverages a touch interface.</p>
<p class="last">The Authorization Server MAY attempt to detect the touch device and further customize the interface.</p>
</dd>
<dt>wap</dt>
<dd>The Authorization Server SHOULD display authentication and consent UI consistent
with a &#8220;feature phone&#8221; type display.</dd>
</dl>
</div></blockquote>
</dd>
<dt id="term-52">prompt</dt>
<dd><p class="first">OPTIONAL.
A space delimited,
case sensitive list of ASCII string values that specifies
whether the Authorization Server prompts the End-User for reauthentication and consent.</p>
<p>The possible values are:</p>
<blockquote>
<div><dl class="docutils">
<dt>none</dt>
<dd><p class="first">The Authorization Server MUST NOT display any authentication
or consent user interface pages. An error is returned
if the End-User is not already authenticated
or the Client does not have pre-configured consent for the requested scopes.</p>
<p class="last">This can be used as a method to check for existing authentication and/or consent.</p>
</dd>
<dt>login</dt>
<dd>The Authorization Server MUST prompt the End-User for reauthentication.</dd>
<dt>consent</dt>
<dd>The Authorization Server MUST prompt the End-User for consent before returning information to the Client.</dd>
<dt>select_account</dt>
<dd>The Authorization Server MUST prompt the End-User to select a user account.
This allows a user who has multiple accounts at the Authorization Server
to select amongst the multiple accounts that they may have current sessions for.</dd>
</dl>
</div></blockquote>
<p>The prompt parameter can be used by the Client
to make sure that the End-User is still present for the current session
or to bring attention to the request.</p>
<p class="last">If this parameter contains <strong>none</strong> with any other value, an <strong>error</strong> is returned.</p>
</dd>
<dt id="term-53">request</dt>
<dd>OPTIONAL. An OpenID Request Object value.</dd>
<dt id="term-54">request_uri</dt>
<dd>OPTIONAL. An URL that points to an OpenID Request Object.
This is used to pass an OpenID Request Object by reference.</dd>
<dt id="term-55">id_token</dt>
<dd><p class="first">OPTIONAL.
An <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> passed to the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>
as a hint about the user&#8217;s current or past authenticated session
with the client.</p>
<p class="last">This SHOULD be present if <strong>prompt=none</strong> is sent.</p>
</dd>
</dl>
<p>(draft 10)</p>
<table class="docutils field-list" frame="void" id="messages-2-1-2-1" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="id-token">
<h5><a class="toc-backref" href="#id37">2.1.2.1.  ID Token</a><a class="headerlink" href="#id-token" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li><p class="first">認証イベントに関するクレームを含んでいます</p>
<blockquote>
<div><ul class="simple">
<li>iss (<a class="reference internal" href="glossary.html#term-server"><em class="xref std std-term">Server</em></a> )</li>
<li>sub (<em class="xref std std-term">End User</em> )</li>
<li>aud  (<a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a>, <a class="reference internal" href="oauth_introspect.html#term-client-id"><em class="xref std std-term">client_id</em></a> in <a class="reference internal" href="oauth.html"><em>The OAuth 2.0 Authorization Framework</em></a> )</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">リプレーされないようになっています</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#term-63"><em class="xref std std-term">nonce</em></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">access_tokenとしても使えます</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#term-azp"><em class="xref std std-term">azp</em></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<p>The ID Token is a <em class="xref std std-term">security token</em>
that contains Claims about the <strong>authentication event</strong> and other requested Claims.
The ID Token is represented as a JSON Web Token (JWT) <a class="reference internal" href="jws.html#term-jwt"><em class="xref std std-term">[JWT]</em></a>.</p>
<p>The ID Token is used to manage the authentication event and user identifier
and is scoped to a <strong>particular Client</strong> via the <a class="reference internal" href="#term-aud"><em class="xref std std-term">aud</em></a> (<a class="reference internal" href="oauth_introspect.html#term-audience"><em class="xref std std-term">audience</em></a>)
and <a class="reference internal" href="#term-63"><em class="xref std std-term">nonce</em></a> Claims.</p>
<p>The following Claims are REQUIRED and OPTIONAL within the ID Token:</p>
<dl class="glossary docutils">
<dt id="term-iss">iss</dt>
<dd><p class="first">REQUIRED.</p>
<p class="last">Issuer Identifier for the Issuer of the response.</p>
</dd>
<dt id="term-sub">sub</dt>
<dd><p class="first">REQUIRED.</p>
<p>Subject identifier.</p>
<p>A locally unique and never reassigned identifier within the Issuer for the End-User,
which is intended to be consumed by the Client.
e.g. 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4.</p>
<p class="last">It MUST NOT exceed 255 ASCII characters in length.</p>
</dd>
<dt id="term-aud">aud</dt>
<dd><p class="first">REQUIRED.</p>
<p>Audience that this ID Token is intended for.</p>
<p class="last">It MUST contain the OAuth 2.0 client_id of the Client.</p>
</dd>
<dt id="term-azp">azp</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Authorized Party.</p>
<p>This member identifies an OAuth 2.0 client authorized
to use this ID Token as an OAuth access token,
if different than the Client that requested the ID Token.</p>
<p class="last">It MUST contain the client_id of the authorized party.</p>
</dd>
<dt id="term-exp">exp</dt>
<dd><p class="first">REQUIRED.</p>
<p>Expiration time on or after which the ID Token MUST NOT be accepted for processing.</p>
<p>The processing of this parameter requires that the current date/time
MUST be before the expiration date/time listed in the value.</p>
<p>Implementers MAY provide for some small leeway,
usually no more than a few minutes, to account for clock skew.
The value is the number of seconds from 1970-01-01T0:0:0Z as measured in UTC
until the desired date/time.</p>
<p class="last">See RFC 3339 [RFC3339] for details regarding date/times in general and UTC in particular.</p>
</dd>
<dt id="term-iat">iat</dt>
<dd><p class="first">REQUIRED.</p>
<p>Time at which the JWT was issued.
The value is the number of seconds from 1970-01-01T0:0:0Z as measured in UTC
until the desired date/time.</p>
<p class="last">See RFC 3339 [RFC3339] for details regarding date/times in general and UTC in particular.</p>
</dd>
<dt id="term-62">acr</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Authentication Context Class Reference.</p>
<p>String specifying an Authentication Context Class Reference value.</p>
<p>The values &#8220;1&#8221;, &#8220;2&#8221;, &#8220;3&#8221;, and &#8220;4&#8221; map to the ITU-T X.1254 | ISO/IEC 29115 [ISO29115]
entity authentication assurance level of the authentication performed.</p>
<p>The value &#8220;0&#8221; indicates the End-User authentication did not meet the requirements
of ISO/IEC 29115 level 1.</p>
<p>Authentication using a long-lived browser cookie, for instance,
is one example where the use of &#8220;level 0&#8221; is appropriate.</p>
<p>Authentications with level 0 should never be used to authorize access
to any resource of any monetary value.</p>
<p class="last">(This corresponds to the OpenID 2.0 PAPE [OpenID.PAPE] nist_auth_level 0.)
An absolute URI or a registered name [RFC6711] MAY be used as an acr value.</p>
</dd>
<dt id="term-63">nonce</dt>
<dd><p class="first">String value used to associate a Client session with an ID Token,
and to mitigate replay attacks.</p>
<p>The value is passed through unmodified from the Authorization Request to the ID Token.
If present in the ID Token,
clients MUST verify that the nonce Claim value is equal to the value of the nonce parameter
sent in the Authorization Request.</p>
<p>If present in the Authorization Request,
Authorization Servers MUST include a nonce Claim in the ID Token with the Claim value
being the nonce value sent in the Authorization Request.</p>
<p>Use of the nonce is REQUIRED for all requests where an ID Token is returned directly
from the Authorization Endpoint.</p>
<p class="last">It is OPTIONAL if the ID Token is returned from the Token Endpoint.</p>
</dd>
<dt id="term-64">auth_time</dt>
<dd>OPTIONAL. Time when the End-User authentication occurred, specified as the number of seconds from 1970-01-01T0:0:0Z as measured in UTC. If the id_token member of the OpenID Request Object contains the Claim request auth_time with a parameter of {&#8220;essential&#8221;: true}, then this Claim is REQUIRED. (The auth_time Claim semantically corresponds to the OpenID 2.0 PAPE [OpenID.PAPE] auth_time response parameter.)</dd>
<dt id="term-at-hash">at_hash</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Access Token hash value.</p>
<p>If the ID Token is issued from the Authorization endpoint with an access_token,
this is REQUIRED.</p>
<p>This is OPTIONAL if the ID Token is issued from the Token Endpoint.</p>
<p>The value is produced by base64url encoding the left-most half of the hash
created by hashing the access_token with the hash algorithm specified in JWS [JWA]
for the alg parameter in the JWS [JWS] header.</p>
<p class="last">For instance, if the alg is RS256,
hash access_token with SHA-256
, then take the left-most 128 bits and base64url encode them.</p>
</dd>
<dt id="term-c-hash">c_hash</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Code hash value.</p>
<p>If the ID Token is issued from the Authorization endpoint with a code,
this is REQUIRED.</p>
<p>This is OPTIONAL if the ID Token is issued from the Token Endpoint.</p>
<p>The value is produced by base64url encoding the left-most half of the hash
created by hashing the code with the hash algorithm specified in JWS [JWA]
for the alg parameter in the JWS [JWS] header.</p>
<p class="last">For instance,
if the alg is HS512,
hash code with SHA-512,
then take the left-most 256 bits and base64url encode them.</p>
</dd>
<dt id="term-sub-jwk">sub_jwk</dt>
<dd><p class="first">OPTIONAL.</p>
<p>Public key value used to check the signature of an ID Token
issued by a self-issued OpenID Provider,
as specified in Section 5 of OpenID Connect Standard 1.0 [OpenID.Standard].</p>
<p>The key is in JWK format.</p>
<p class="last">Use of the sub_jwk Claim is REQUIRED
when the OP is a self-issued OP and is NOT RECOMMENDED when the OP is not self-issued.</p>
</dd>
</dl>
<p>ID Tokens MUST be signed using JWS [JWS] and OPTIONALLY both signed and encrypted using JWS [JWS] and JWE [JWE] respectively, thereby providing authentication, integrity, non-repudiation, and optionally, confidentiality.</p>
<p>Clients MUST directly validate the ID Token per ID Token Validation.</p>
<p>The following is a non-normative example of a base64url decoded ID Token (with line wraps for display purposes only):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;iss&quot;</span><span class="o">:</span> <span class="s2">&quot;https://server.example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;sub&quot;</span><span class="o">:</span> <span class="s2">&quot;24400320&quot;</span><span class="p">,</span>
 <span class="s2">&quot;aud&quot;</span><span class="o">:</span> <span class="s2">&quot;s6BhdRkqt3&quot;</span><span class="p">,</span>
 <span class="s2">&quot;nonce&quot;</span><span class="o">:</span> <span class="s2">&quot;n-0S6_WzA2Mj&quot;</span><span class="p">,</span>
 <span class="s2">&quot;exp&quot;</span><span class="o">:</span> <span class="mi">1311281970</span><span class="p">,</span>
 <span class="s2">&quot;iat&quot;</span><span class="o">:</span> <span class="mi">1311280970</span><span class="p">,</span>
 <span class="s2">&quot;auth_time&quot;</span><span class="o">:</span> <span class="mi">1311280969</span><span class="p">,</span>
 <span class="s2">&quot;acr&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
 <span class="s2">&quot;at_hash&quot;</span><span class="o">:</span> <span class="s2">&quot;MTIzNDU2Nzg5MDEyMzQ1Ng&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 15)</p>
<div class="section" id="messages-2-1-2-1-1">
<span id="id2"></span><h6><a class="toc-backref" href="#id38">2.1.2.1.1.  &#8220;userinfo&#8221; member</a><a class="headerlink" href="#messages-2-1-2-1-1" title="Permalink to this headline">¶</a></h6>
<p>The structure of the userinfo (UserInfo Request) member is a JSON object that MAY contain the following members:</p>
<dl class="glossary docutils">
<dt id="term-68">claims</dt>
<dd><p class="first">OPTIONAL.</p>
<p>(Requested Claims):
A JSON object containing a set of individual Claims
being requested from the <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a>
in addition to those requested by the scope values used.</p>
<p class="last">If not present,
only the UserInfo Claims held by the OP
that are requested by the scope values used are returned.
For details about this claim,
refer to &#8220;claims&#8221; member in &#8220;userinfo&#8221; and &#8220;id_token&#8221; section.</p>
</dd>
<dt id="term-69">preferred_locales</dt>
<dd><p class="first">OPTIONAL.</p>
<p class="last">A list of preferred languages and scripts for the entire Claims request,
represented as a JSON array of BCP47 [RFC5646] language tag values,
ordered by preference.</p>
</dd>
</dl>
<p>All members of the <a class="reference internal" href="#term-userinfo"><em class="xref std std-term">userinfo</em></a> object are OPTIONAL.
Other members MAY be present and if so, SHOULD understood by both parties</p>
<p>(draft 10)</p>
</div>
<div class="section" id="messages-2-1-2-1-2">
<span id="id3"></span><h6><a class="toc-backref" href="#id39">2.1.2.1.2.  &#8220;id_token&#8221; member</a><a class="headerlink" href="#messages-2-1-2-1-2" title="Permalink to this headline">¶</a></h6>
<p>The structure and function of the <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> (ID Token request) member of
the <a class="reference internal" href="#term-openid-request-object"><em class="xref std std-term">OpenID Request Object</em></a> is similar to that of the <a class="reference internal" href="#term-userinfo"><em class="xref std std-term">userinfo</em></a> member.
It MAY include the OPTIONAL <a class="reference internal" href="#term-68"><em class="xref std std-term">claims</em></a> and <a class="reference internal" href="#term-69"><em class="xref std std-term">preferred_locales</em></a> members.
The structure of these members is the same as that for the <a class="reference internal" href="#term-userinfo"><em class="xref std std-term">userinfo</em></a> member.
If the <a class="reference internal" href="#term-68"><em class="xref std std-term">claims</em></a> member is present in the <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> object,
the Claims requested within it modify the Claim set that would otherwise be returned in the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>.
Unlike for the <a class="reference internal" href="#term-userinfo"><em class="xref std std-term">userinfo</em></a> member,
typically these Claims will augment, rather than override the default set.</p>
<p>Following Claims
in addition to the claims described in &#8220;claims&#8221; member
in &#8220;<a class="reference internal" href="#term-userinfo"><em class="xref std std-term">userinfo</em></a>&#8221; and &#8220;<a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a>&#8221; section.,
MAY be requested in the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> by specifying it in the <a class="reference internal" href="#term-68"><em class="xref std std-term">claims</em></a> member:</p>
<dl class="glossary docutils">
<dt id="term-70">user_id</dt>
<dd><p class="first">OPTIONAL.
(User Identifier):
The <a class="reference internal" href="glossary.html#term-user-identifier"><em class="xref std std-term">User Identifier</em></a> for which an <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> is being requested.
If the specified user is not currently authenticated to the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>,
they may be prompted for authenticated,
unless the prompt parameter in the <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a> is set to <a class="reference internal" href="#term-none"><em class="xref std std-term">none</em></a>.</p>
<p>The Claim Value in the request is an object containing the single element value.</p>
<div class="last highlight-python"><pre>"user_id": {"value":"248289761001"}</pre>
</div>
</dd>
<dt id="term-71">auth_time</dt>
<dd>OPTIONAL.
(authenticated at):
Requests that the <a class="reference internal" href="#term-71"><em class="xref std std-term">auth_time</em></a> Claim be present in the &#8220;id_token&#8221; response.
The Claim Value in the request is null.</dd>
<dt id="term-72">acr</dt>
<dd><p class="first">OPTIONAL.
(<a class="reference internal" href="glossary.html#term-16"><em class="xref std std-term">Authentication Context Class Reference</em></a>):
Requests the desired <a class="reference internal" href="glossary.html#term-authentication-context-class-references"><em class="xref std std-term">Authentication Context Class References</em></a>.
The element values is an <strong>ordered array</strong> of strings
representing acceptable <a class="reference internal" href="glossary.html#term-16"><em class="xref std std-term">Authentication Context Class Reference</em></a> values
appearing in order of preference.</p>
<div class="last highlight-python"><pre>"acr": {"values":["2","http://id.incommon.org/assurance/bronze"]}</pre>
</div>
</dd>
</dl>
<p>In addition to the claims member, these additional members are defined within the id_token member of the OpenID Request Object:</p>
<dl class="glossary docutils">
<dt id="term-73">max_age</dt>
<dd><p class="first">OPTIONAL.
(max authentication age):
Specifies that the <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">End-User</em></a> must be actively authenticated
if any present authentication is older than
the specified number of seconds.</p>
<p class="last">(The max_age request parameter corresponds to the OpenID 2.0 PAPE <em class="xref std std-term">max_auth_age</em> request parameter.)</p>
</dd>
</dl>
<p>It is anticipated that additional <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> parameters MAY be defined
to request that additional properties hold for the authentication - for instance,
that certain authentication policies be applied
(in the same spirit of the OpenID 2.0 PAPE auth_policies values),
or that the authentication conform to the policies defined by a specified trust framework.
These parameters MAY be defined by extension specifications.</p>
<p>All members of the <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> object are OPTIONAL.
Other members MAY be present and if so, SHOULD be understood by both parties.</p>
<p>(draft 10)</p>
</div>
<div class="section" id="messages-2-1-2-1-3">
<span id="id4"></span><h6><a class="toc-backref" href="#id40">2.1.2.1.3.  &#8220;claims&#8221; member with &#8220;userinfo&#8221; and &#8220;id_token&#8221; members</a><a class="headerlink" href="#messages-2-1-2-1-3" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#term-68"><em class="xref std std-term">claims</em></a> member is a JSON object with a member for each requested Claim.
The member names are the requested Claim names.
Each Claim MAY either be an <em class="xref std std-term">essential claim</em> or <em class="xref std std-term">voluntary claim</em>.
The default is <em class="xref std std-term">voluntary</em>.</p>
<p>By requesting Claims as essential,
the client indicates to the user that
releasing these claims will ensure a smooth authorization
for the specific task requested by the user.
Note that
even if the claims are not available
because the user did not authorize their release or they are not present,
the Authorization Server MUST NOT generate an error
when essential claims are not returned.</p>
<p>The Client may request additional Claims on voluntary basis
that it requires to perform other tasks offered to the user.</p>
<p>The member values MAY be either:</p>
<dl class="glossary docutils">
<dt id="term-74">null</dt>
<dd>This indicates that this Claim is being requested in the default manner.
In particular, this is a voluntary Claim.</dd>
<dt id="term-75">A JSON Object</dt>
<dd><p class="first">This is used to provide additional information about the Claim being requested.
This specification defines the following member:</p>
<blockquote>
<div><dl class="docutils">
<dt>essential</dt>
<dd>OPTIONAL.
If the value is set to true, this indicates that the claim being requested is an essential claim.
If the value is set to false, it indicates that it is a voluntary claim. The default is false.</dd>
</dl>
</div></blockquote>
<p class="last">Other members MAY be defined to provide additional information about the requested Claim.</p>
</dd>
</dl>
<p>The Claims MAY be represented in multiple languages and scripts.
To specify languages and scripts for the Claim request,
BCP47 [RFC5646] language tags delimited by a &#8220;#&#8221; MUST be added to each requested Claim Name for which a particular language and script is requested. For example, the Claim family_name#ja-Kana-JP is used for expressing Family Name in Katakana in Japanese, which is commonly used to index and represent the phonetics of the Kanji representation of the same value represented as family_name#ja-Hani-JP.</p>
<p>All members of the claims object are OPTIONAL.</p>
<p>(draft 10)</p>
</div>
</div>
</div>
<div class="section" id="authorization-response">
<span id="messages-2-1-3"></span><h4><a class="toc-backref" href="#id41">2.1.3.  Authorization Response</a><a class="headerlink" href="#authorization-response" title="Permalink to this headline">¶</a></h4>
<p>When the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> in the request is <a class="reference internal" href="oauth_introspect.html#term-token"><em class="xref std std-term">token</em></a>,
the <a class="reference internal" href="glossary.html#term-authorization-response"><em class="xref std std-term">Authorization Response</em></a> MUST return the parameters defined
in <a class="reference internal" href="oauth.html#oauth-4-2-2"><em>section 4.2.2 of OAuth 2.0</em></a> [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>].
This specification only supports <a class="reference internal" href="oauth_bearer.html#term-bearer-tokens"><em class="xref std std-term">Bearer Tokens</em></a> [<a class="reference internal" href="#term-oauth-bearer"><em class="xref std std-term">OAuth.Bearer</em></a>].
The OAuth 2.0 response parameter &#8220;<a class="reference internal" href="oauth.html#term-token-type"><em class="xref std std-term">token_type</em></a>&#8221; MUST be set to &#8220;<a class="reference internal" href="glossary.html#term-bearer"><em class="xref std std-term">Bearer</em></a>&#8221;.</p>
<p>When the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> in the request is <a class="reference internal" href="oauth.html#term-code"><em class="xref std std-term">code</em></a>,
the <a class="reference internal" href="glossary.html#term-authorization-response"><em class="xref std std-term">Authorization Response</em></a> MUST return the parameters defined
in <em class="xref std std-ref">section 4.1.2 of OAuth 2.0</em> [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>].</p>
<p>When the <a class="reference internal" href="oauth.html#term-20"><em class="xref std std-term">response_type</em></a> includes other values,
they must be returned as defined by their registration.
The <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> return type is defined
in OAuth 2.0 Multiple Response Type Encoding Practices [<a class="reference internal" href="#term-oauth-responses"><em class="xref std std-term">OAuth.Responses</em></a>].</p>
<p>(draft 07)</p>
</div>
</div>
<div class="section" id="token-endpoint">
<span id="messages-2-2"></span><h3><a class="toc-backref" href="#id42">2.2.  Token Endpoint</a><a class="headerlink" href="#token-endpoint" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> sends an <a class="reference internal" href="glossary.html#term-access-token-request"><em class="xref std std-term">Access Token Request</em></a>
to the <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a> to obtain <a class="reference internal" href="glossary.html#term-access-token-response"><em class="xref std std-term">Access Token Response</em></a>,
which MAY include <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>, <a class="reference internal" href="glossary.html#term-refresh-token"><em class="xref std std-term">Refresh Token</em></a>, <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>, and other variables.</p>
<p>(draft 07)</p>
<div class="section" id="client-authentication">
<span id="messages-2-2-1"></span><h4><a class="toc-backref" href="#id43">2.2.1.  Client Authentication</a><a class="headerlink" href="#client-authentication" title="Permalink to this headline">¶</a></h4>
<p>During <a class="reference internal" href="glossary.html#term-client-registration"><em class="xref std std-term">Client Registration</em></a>,
the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> MAY register an authentication method.
If no method is registered,
the default method of <a class="reference internal" href="#term-client-secret-basic"><em class="xref std std-term">client_secret_basic</em></a> MUST be used.</p>
<p>The Supported options are:</p>
<dl class="glossary docutils">
<dt id="term-client-secret-basic">client_secret_basic</dt>
<dd><a class="reference internal" href="oauth.html#term-clients"><em class="xref std std-term">Clients</em></a> in possession of a client password authenticate
with the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> in accordance with
<em class="xref std std-ref">section 3.2.1 of OAuth 2.0</em> [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>]
using HTTP Basic authentication scheme.</dd>
<dt id="term-client-secret-post">client_secret_post</dt>
<dd><a class="reference internal" href="oauth.html#term-clients"><em class="xref std std-term">Clients</em></a> in possession of a client password authenticate
with the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> in accordance with
<em class="xref std std-ref">section 3.2.1 of OAuth 2.0</em> [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>]
by including the client credentials in the request body.</dd>
<dt id="term-client-secret-jwt">client_secret_jwt</dt>
<dd><p class="first">Clients in possession of a client password create a JWT using the HS256 algorithm. The HMAC (Hash-based Message Authentication Code) is calculated using the client_secret as the shared key. The client Authenticates in accordance with section 2.2 of (JWT) Bearer Token Profiles [OAuth.JWT] and OAuth 2.0 Assertion Profile [OAuth.Assertions]. The JWT MUST contain the Claims:</p>
<blockquote>
<div><dl class="docutils">
<dt>iss</dt>
<dd>REQUIRED. The iss (issuer) claim. This MUST contain the client_id of the OAuth client.</dd>
<dt>prn</dt>
<dd>REQUIRED. The prn (principal) claim. This MUST contain the client_id of the OAuth client.</dd>
<dt>aud</dt>
<dd>REQUIRED. The aud (audience) claim. A value that identifies the Authorization Server as the intended audience. The Authorization Server MUST verify that it is an intended audience for the token. The Audience SHOULD be the URL of the Authorization Server&#8217;s Token Endpoint.</dd>
<dt>jti</dt>
<dd>REQUIRED. The jti (JWT ID) claim. A unique identifier for the token. The JWT ID MAY be used by implementations requiring message de-duplication for one-time use assertions.</dd>
<dt>exp</dt>
<dd>REQUIRED. The exp (expiration) claim that limits the time window during which the JWT can be used.</dd>
<dt>iat</dt>
<dd>OPTIONAL. The iat (issued at) claim that identifies the time at which the JWT was issued.</dd>
</dl>
</div></blockquote>
<p class="last">The authentication token MUST be sent as the value of the client_assertion parameter.
The value of &#8220;client_assertion_type&#8221; parameter MUST be &#8220;<a class="reference external" href="urn:ietf:params:oauth:client-assertion-type:jwt-bearer">urn:ietf:params:oauth:client-assertion-type:jwt-bearer</a>&#8221;.</p>
</dd>
<dt id="term-private-key-jwt">private_key_jwt</dt>
<dd><p class="first">Clients that have registered a public key sign a JWT using the RS256 algorithm if a RSA key was registered or the ES256 algorithm if a EC key was registered. The client Authenticates in accordance with section 2.2 of (JWT) Bearer Token Profiles [OAuth.JWT] and OAuth 2.0 Assertion Profile [OAuth.Assertions]. The JWT MUST contain the Claims:</p>
<blockquote>
<div><dl class="docutils">
<dt>iss</dt>
<dd>REQUIRED. The iss (issuer) claim. This MUST contain the client_id of the OAuth client.</dd>
<dt>prn</dt>
<dd>REQUIRED. The prn (principal) claim. This MUST contain the client_id of the OAuth client.</dd>
<dt>aud</dt>
<dd>REQUIRED. The aud (audience) claim. A value that identifies the Authorization Server as the intended audience. The Authorization Server MUST verify that it is an intended audience for the assertion. The Audience SHOULD be the URL of the Authorization Server&#8217;s Token Endpoint.</dd>
<dt>jti</dt>
<dd>REQUIRED. The jti (JWT ID) claim. A unique identifier for the token. The token ID MAY be used by implementations requiring message de-duplication for one-time use assertions.</dd>
<dt>exp</dt>
<dd>REQUIRED. The exp (expiration) claim that limits the time window during which the JWT can be used.</dd>
<dt>iat</dt>
<dd>OPTIONAL. The iat (issued at) claim that identifies the time at which the JWT was issued.</dd>
</dl>
</div></blockquote>
<p>The authentication token MUST be sent as the value of the client_assertion parameter.
The value of &#8220;client_assertion_type&#8221; parameter MUST be &#8220;<a class="reference external" href="urn:ietf:params:oauth:client-assertion-type:jwt-bearer">urn:ietf:params:oauth:client-assertion-type:jwt-bearer</a>&#8221;.</p>
<div class="last highlight-python"><pre>For example:

POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;
code=i1WsRn1uB1&amp;
client_id=s6BhdRkqt3&amp;
client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&amp;
client_assertion=PHNhbWxwOl...[omitted for brevity]...ZT</pre>
</div>
</dd>
</dl>
<p>(draft 07)</p>
</div>
<div class="section" id="access-token-request">
<span id="messages-2-2-2"></span><h4><a class="toc-backref" href="#id44">2.2.2.  Access Token Request</a><a class="headerlink" href="#access-token-request" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> obtains an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>
by authenticating with the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>
and presenting its <a class="reference internal" href="glossary.html#term-access-grant"><em class="xref std std-term">access grant</em></a>
(in the form of an <a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a>, or <a class="reference internal" href="glossary.html#term-refresh-token"><em class="xref std std-term">Refresh Token</em></a>).</p>
<p>In addition to the <a class="reference internal" href="glossary.html#term-client-authentication-parameters"><em class="xref std std-term">client authentication parameters</em></a>,
if this is a <a class="reference internal" href="glossary.html#term-refresh-token-request"><em class="xref std std-term">Refresh Token Request</em></a>,
the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> MUST send the additional parameters specified
in <a class="reference internal" href="oauth.html#oauth-6"><em>Section 6</em></a> of OAuth 2.0 [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>].</p>
<p>Otherwise
the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> MUST send the request parameter for the <a class="reference internal" href="glossary.html#term-access-token-endpoint"><em class="xref std std-term">Access Token Endpoint</em></a>
as specified in <a class="reference internal" href="oauth.html#oauth-4-1-3"><em>section 4.1.3</em></a> of OAuth 2.0 [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>].</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In short, follow the OAuth 2.0.</p>
</div>
<p>(draft 07)</p>
</div>
<div class="section" id="access-token-response">
<span id="messages-2-2-3"></span><h4><a class="toc-backref" href="#id45">2.2.3.  Access Token Response</a><a class="headerlink" href="#access-token-response" title="Permalink to this headline">¶</a></h4>
<p>After receiving and verifying a valid
and authorized <a class="reference internal" href="glossary.html#term-access-token-request"><em class="xref std std-term">Access Token Request</em></a> from the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a>,
the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> returns a successful response
that includes an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a> and an <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>.
The parameters in the successful response are defined in <a class="reference internal" href="oauth.html#oauth-4-1-4"><em>Section 4.1.4</em></a> of OAuth 2.0 [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>].</p>
<p>This specification further constrains that
only <a class="reference internal" href="oauth_bearer.html#term-bearer-tokens"><em class="xref std std-term">Bearer Tokens</em></a> [<a class="reference internal" href="#term-oauth-bearer"><em class="xref std std-term">OAuth.Bearer</em></a>] are issued at the <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a>.
The OAuth 2.0 response parameter &#8220;<a class="reference internal" href="oauth.html#term-token-type"><em class="xref std std-term">token_type</em></a>&#8221; MUST be set to &#8220;<a class="reference internal" href="glossary.html#term-bearer"><em class="xref std std-term">Bearer</em></a>&#8221;.</p>
<p>In addition to the <a class="reference internal" href="glossary.html#term-oauth-2-0"><em class="xref std std-term">OAuth 2.0</em></a> response parameters,
the following parameters MUST be included in the response
if the <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a> <a class="reference internal" href="oauth_introspect.html#term-scope"><em class="xref std std-term">scope</em></a> parameter contains <a class="reference internal" href="glossary.html#term-openid"><em class="xref std std-term">openid</em></a>:</p>
<p>Note that id_token MUST NOT be returned if the grant_type is not authorization_code.</p>
<dl class="glossary docutils">
<dt id="term-80">id_token</dt>
<dd>The <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> value associated with the authentication session.</dd>
</dl>
<p>Following is a non-normative example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
 <span class="s">&quot;access_token&quot;</span><span class="p">:</span> <span class="s">&quot;SlAV32hkKG&quot;</span><span class="p">,</span>
 <span class="s">&quot;token_type&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer&quot;</span><span class="p">,</span>
 <span class="s">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s">&quot;8xLOxBtZp8&quot;</span><span class="p">,</span>
 <span class="s">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
 <span class="s">&quot;id_token&quot;</span><span class="p">:</span> <span class="s">&quot;eyJ0 ... NiJ9.eyJ1c ... I6IjIifX0.DeWt4Qu ... ZXso&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As in the OAuth 2.0 [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>],
<a class="reference internal" href="oauth.html#term-clients"><em class="xref std std-term">Clients</em></a> SHOULD ignore unrecognized response parameters.</p>
<p>(draft 12)</p>
</div>
<div class="section" id="token-error-response">
<span id="messages-2-2-4"></span><h4><a class="toc-backref" href="#id46">2.2.4.  Token Error Response</a><a class="headerlink" href="#token-error-response" title="Permalink to this headline">¶</a></h4>
<p>If the token request is invalid or unauthorized,
the Authorization Server constructs the error response.
The parameters of the Token Error Response are defined as
in <a class="reference internal" href="oauth.html#oauth-5-2"><em>Section 5.2 of OAuth 2.0</em></a> [OAuth2.0].</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference internal" href="standard.html#standard-3-1-3"><em>3.1.3.  Access Token Error Response</em></a></li>
</ul>
</div>
<p>(draft 12, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor7">http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor7</a> )</p>
</div>
</div>
<div class="section" id="userinfo-endpoint">
<span id="messages-2-3"></span><h3><a class="toc-backref" href="#id47">2.3.  UserInfo Endpoint</a><a class="headerlink" href="#userinfo-endpoint" title="Permalink to this headline">¶</a></h3>
<p>The UserInfo Endpoint is a Protected Resource
that returns Claims about the authenticated End-User.</p>
<p>Claims are represented by a JSON object
that contains a collection of name and value pairs for the Claims.</p>
<p>(Draft 12, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#userinfo_ep">http://openid.bitbucket.org/openid-connect-messages-1_0.html#userinfo_ep</a> )</p>
<div class="section" id="userinfo-request">
<span id="messages-2-3-1"></span><h4><a class="toc-backref" href="#id48">2.3.1.  UserInfo Request</a><a class="headerlink" href="#userinfo-request" title="Permalink to this headline">¶</a></h4>
<p>Clients MAY send requests with the following parameters
to the UserInfo Endpoint
to obtain further information about the End-User.</p>
<dl class="glossary docutils">
<dt id="term-access-token">access_token</dt>
<dd>REQUIRED. The Access Token obtained from an OpenID Connect Authorization Request.</dd>
<dt id="term-schema">schema</dt>
<dd>REQUIRED. The schema in which the data is to be returned. The only defined value is openid.</dd>
<dt id="term-id">id</dt>
<dd>This identifier is reserved. It MUST be ignored by the endpoint when the openid schema is used.</dd>
</dl>
<p>(draft 12, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor8">http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor8</a> )</p>
</div>
<div class="section" id="userinfo-response">
<span id="messages-2-3-2"></span><h4><a class="toc-backref" href="#id49">2.3.2.  UserInfo Response</a><a class="headerlink" href="#userinfo-response" title="Permalink to this headline">¶</a></h4>
<p>If the requested schema is <a class="reference internal" href="glossary.html#term-openid"><em class="xref std std-term">openid</em></a>,
the response MUST return a JSON object
that contains the full set or subset of Claims
that are defined below.
Additional Claims (not specified below) MAY also be returned.</p>
<p>If a Claim is not returned,
that Claim Name SHOULD be omitted from the JSON object representing the Claims;
it <strong>SHOULD NOT</strong> be present with a <strong>null</strong> or <strong>empty string value</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Drop claims if you don&#8217;t want to return.</p>
</div>
<p>The members MAY be represented in multiple languages and scripts.
To specify the languages and scripts,
BCP47 [<a class="reference internal" href="#term-rfc5646"><em class="xref std std-term">RFC5646</em></a>] language tags MUST be added to each member names delimited by a #, e.g., familyName#ja-Kana-JP for expressing Family Name in Katakana in Japanese, which is commonly used to index and represent the phonetics of the Kanji representation of the same represented as familyName#ja-Hani-JP.</p>
<table border="1" class="docutils" id="messages-table-1">
<caption>Reserved Member Definitions</caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Member</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>user_id</td>
<td>string</td>
<td><strong>REQUIRED</strong> Identifier for the End-User at the Issuer.</td>
</tr>
<tr class="row-odd"><td>name</td>
<td>string</td>
<td>End-User&#8217;s full name in displayable form including all name parts, ordered according to End-User&#8217;s locale and preferences.</td>
</tr>
<tr class="row-even"><td>given_name</td>
<td>string</td>
<td>Given name or first name of the End-User.</td>
</tr>
<tr class="row-odd"><td>family_name</td>
<td>string</td>
<td>Surname or last name of the End-User.</td>
</tr>
<tr class="row-even"><td>middle_name</td>
<td>string</td>
<td>Middle name of the End-User.</td>
</tr>
<tr class="row-odd"><td>nickname</td>
<td>string</td>
<td>Casual name of the End-User that may or may not be the same as the given_name. For instance, a nickname value of Mike might be returned alongside a given_name value of Michael.</td>
</tr>
<tr class="row-even"><td>preferred_username</td>
<td>string</td>
<td><p class="first">Shorthand name that the End-User wishes to be referred to at the RP,
such as <strong>janedoe</strong> or <strong>j.doe</strong>.</p>
<p class="last">This value MAY be any valid JSON string including special characters such as &#64;, /, or whitespace.
This value MUST NOT be relied upon to be unique by the RP. (See <a class="reference internal" href="#messages-2-3-2-2"><em>Section 2.3.2.2</em></a>.)</p>
</td>
</tr>
<tr class="row-odd"><td>profile</td>
<td>string</td>
<td>URL of End-User&#8217;s profile page.</td>
</tr>
<tr class="row-even"><td>picture</td>
<td>string</td>
<td>URL of the End-User&#8217;s profile picture.</td>
</tr>
<tr class="row-odd"><td>website</td>
<td>string</td>
<td>URL of End-User&#8217;s web page or blog.</td>
</tr>
<tr class="row-even"><td>email</td>
<td>string</td>
<td>The End-User&#8217;s preferred e-mail address.</td>
</tr>
<tr class="row-odd"><td>email_verified</td>
<td>boolean</td>
<td>True if the End-User&#8217;s e-mail address has been verified; otherwise false.</td>
</tr>
<tr class="row-even"><td>gender</td>
<td>string</td>
<td>The End-User&#8217;s gender: Values defined by this specification are female and male. Other values MAY be used when neither of the defined values are applicable.</td>
</tr>
<tr class="row-odd"><td>birthday</td>
<td>string</td>
<td>The End-User&#8217;s birthday, represented as a date string in MM/DD/YYYY format. The year MAY be 0000, indicating that it is omitted.</td>
</tr>
<tr class="row-even"><td>zoneinfo</td>
<td>string</td>
<td>String from zoneinfo [zoneinfo] time zone database. For example, Europe/Paris or America/Los_Angeles.</td>
</tr>
<tr class="row-odd"><td>locale</td>
<td>string</td>
<td>The End-User&#8217;s locale, represented as a BCP47 [RFC5646] language tag. This is typically an ISO 639-1 Alpha-2 [ISO639‑1] language code in lowercase and an ISO 3166-1 Alpha-2 [ISO3166‑1] country code in uppercase, separated by a dash. For example, en-US or fr-CA. As a compatibility note, some implementations have used an underscore as the separator rather than a dash, for example, en_US; Implementations MAY choose to accept this locale syntax as well.</td>
</tr>
<tr class="row-even"><td>phone_number</td>
<td>string</td>
<td>The End-User&#8217;s preferred telephone number. E.164 [E.164] is RECOMMENDED as the format of this Claim. For example, +1 (425) 555-1212 or +56 (2) 687 2400.</td>
</tr>
<tr class="row-odd"><td>address</td>
<td>JSON object</td>
<td>The End-User&#8217;s preferred address. The value of the address member is a JSON [RFC4627] structure containing some or all of the members defined in Section 2.4.2.1.</td>
</tr>
<tr class="row-even"><td>updated_time</td>
<td>string</td>
<td>Time the End-User&#8217;s information was last updated, represented as a RFC 3339 [RFC3339] datetime. For example, 2011-01-03T23:58:42+0000.</td>
</tr>
</tbody>
</table>
<p>For privacy reasons,
OpenID Providers MAY elect to not provide values
for some schema elements as part of the <a class="reference internal" href="glossary.html#term-openid"><em class="xref std std-term">openid</em></a> scope.</p>
<p>The <a class="reference internal" href="#term-94"><em class="xref std std-term">user_id</em></a> Claim in the UserInfo Endpoint response
MUST exactly match the <a class="reference internal" href="#term-94"><em class="xref std std-term">user_id</em></a> Claim in the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>,
before using additional UserInfo Endpoint Claims.</p>
<p>The UserInfo Endpoint MUST return Claims in JSON format
unless a different format was specified
during OpenID Connect Dynamic Client Registration 1.0 [<a class="reference internal" href="#term-openid-registration"><em class="xref std std-term">OpenID.Registration</em></a>].</p>
<p>The UserInfo Endpoint MAY return Claims in <a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a> format,
which can be <strong>signed</strong> and/or <strong>encrypted</strong>.
The UserInfo Endpoint MUST return a <strong>content-type</strong> header
to indicate the format that is being returned.
The following are accepted content types:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Content-Type</td>
<td>Format Returned</td>
</tr>
<tr class="row-even"><td>application/json</td>
<td>plain text JSON object</td>
</tr>
<tr class="row-odd"><td>application/jwt</td>
<td>A JWT</td>
</tr>
</tbody>
</table>
<p>Following is a non-normative example of such response:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;user_id&quot;</span><span class="o">:</span> <span class="s2">&quot;248289761001&quot;</span><span class="p">,</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;picture&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/janedoe/me.jpg&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 12, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor9">http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor9</a> )</p>
<div class="section" id="address-claim">
<span id="messages-2-3-2-1"></span><h5><a class="toc-backref" href="#id50">2.3.2.1.  Address Claim</a><a class="headerlink" href="#address-claim" title="Permalink to this headline">¶</a></h5>
<p>The components of a physical mailing address.
Implementations MAY return only a subset of the fields of an address,
depending upon the information available and the End-User&#8217;s privacy preferences.</p>
<p>For example,
the country and region might be returned
without returning more fine-grained address information.</p>
<p>Implementations MAY return just the full address as a single string in the formatted sub-field,
or they MAY return just the individual component fields using the other sub-fields,
or they MAY return both.
If both variants are returned,
they SHOULD be describing the same address,
with the formatted address indicating how the component fields should be combined.</p>
<dl class="glossary docutils">
<dt id="term-formatted">formatted</dt>
<dd>The full mailing address, formatted for display or use with a mailing label. This field MAY contain newlines. This is the Primary Sub-Field for this field, for the purposes of sorting and filtering.</dd>
<dt id="term-street-address">street_address</dt>
<dd>The full street address component, which may include house number, street name, PO BOX, and multi-line extended street address information. This field MAY contain newlines.</dd>
<dt id="term-locality">locality</dt>
<dd>The city or locality component.</dd>
<dt id="term-region">region</dt>
<dd>The state, province, prefecture or region component.</dd>
<dt id="term-postal-code">postal_code</dt>
<dd>The zip code or postal code component.</dd>
<dt id="term-country">country</dt>
<dd>The country name component.</dd>
</dl>
<p>(draft 12, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#address_claim">http://openid.bitbucket.org/openid-connect-messages-1_0.html#address_claim</a> )</p>
</div>
<div class="section" id="claim-stability-and-uniqueness">
<span id="messages-2-3-2-2"></span><h5><a class="toc-backref" href="#id51">2.3.2.2.  Claim Stability and Uniqueness</a><a class="headerlink" href="#claim-stability-and-uniqueness" title="Permalink to this headline">¶</a></h5>
<p>The user_id claim is the only claim that a client can rely upon to be stable,
since the user_id claim MUST be <strong>locally unique</strong> and <strong>never reassigned within the Issuer</strong>
for a particular End-User, as described in <a class="reference internal" href="#messages-2-1-1"><em>Section 2.1.1</em></a>.</p>
<p>Therefore,
the only guaranteed unique identifier for a given End-User is
a combination of the <a class="reference internal" href="#term-issuer"><em class="xref std std-term">Issuer</em></a>&#8216;s identifier and the user_id claim;
other fields such as preferred_username and email MUST NOT be used as unique identifiers for a given End-User.</p>
<p>All other claims carry no such guarantees across different issuers
in terms of stability over time or uniqueness across users,
and Issuers are permitted to apply local restrictions and policies.
For instance,
an Issuer MAY re-use a given <em class="xref std std-term">preferred_username</em> or email address claim
across different End-Users at different points in time,
and the claimed <em class="xref std std-term">preferred_username</em> or email address for a given End-User MAY change over time.</p>
<p>(draft 12, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#claim.stability">http://openid.bitbucket.org/openid-connect-messages-1_0.html#claim.stability</a> )</p>
</div>
</div>
<div class="section" id="userinfo-error-response">
<span id="messages-2-3-3"></span><h4><a class="toc-backref" href="#id52">2.3.3.  UserInfo Error Response</a><a class="headerlink" href="#userinfo-error-response" title="Permalink to this headline">¶</a></h4>
<p>When an error condition occurs,
the UserInfo Endpoint returns an Error Response.
In addition to the error codes defined in <em class="xref std std-ref">Section 3.1 of OAuth 2.0 Bearer Tokens</em> [OAuth.Bearer],
this specification defines the following error codes:</p>
<dl class="glossary docutils">
<dt id="term-invalid-schema">invalid_schema</dt>
<dd>The requested schema is invalid or unsupported.</dd>
</dl>
<p>(draft 12, <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor10">http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor10</a> )</p>
</div>
</div>
<div class="section" id="messages-2-4">
<span id="id5"></span><h3><a class="toc-backref" href="#id53">2.4.  UserInfo Endpoint</a><a class="headerlink" href="#messages-2-4" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> is a <a class="reference internal" href="uma_core.html#term-protected-resource"><em class="xref std std-term">Protected Resource</em></a>
that returns Claims about the authenticated End-User.
Claims are represented by a JSON object that contains a collection of name and value pairs for the Claims.</p>
<p>(draft 07 : <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#userinfo_ep">http://openid.bitbucket.org/openid-connect-messages-1_0.html#userinfo_ep</a> )</p>
<div class="section" id="messages-2-4-1">
<span id="id6"></span><h4><a class="toc-backref" href="#id54">2.4.1.  UserInfo Request</a><a class="headerlink" href="#messages-2-4-1" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="oauth.html#term-clients"><em class="xref std std-term">Clients</em></a> MAY send requests with the following parameters
to the <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> to obtain further information about the <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">End-User</em></a>.</p>
<dl class="glossary docutils">
<dt id="term-91">access_token</dt>
<dd>REQUIRED.
The <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a> obtained from an OpenID Connect <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a>.
This parameter MUST NOT be sent
if the <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a> is sent in the HTTP Authorization header
as described in <a class="reference internal" href="oauth.html#oauth-7-1"><em>Section 7.1 of OAuth 2.0</em></a> [<a class="reference internal" href="#term-oauth2-0"><em class="xref std std-term">OAuth2.0</em></a>].
<a class="reference internal" href="glossary.html#term-access-tokens"><em class="xref std std-term">Access Tokens</em></a> sent in the authorization header MUST be <a class="reference internal" href="glossary.html#term-bearer"><em class="xref std std-term">Bearer</em></a> tokens [<a class="reference internal" href="#term-oauth-bearer"><em class="xref std std-term">OAuth.Bearer</em></a>].</dd>
<dt id="term-92">schema</dt>
<dd>REQUIRED.
The schema in which the data is to be returned.
The only defined value is openid.</dd>
<dt id="term-93">id</dt>
<dd>This identifier is reserved.
It MUST be ignored by the endpoint when the openid schema is used.</dd>
</dl>
<p>(draft 07)</p>
</div>
<div class="section" id="messages-2-4-2">
<span id="id7"></span><h4><a class="toc-backref" href="#id55">2.4.2.  UserInfo Response</a><a class="headerlink" href="#messages-2-4-2" title="Permalink to this headline">¶</a></h4>
<p>If the requested schema is <a class="reference internal" href="glossary.html#term-openid"><em class="xref std std-term">openid</em></a>,
the response MUST return a JSON object
that contains the full set or a subset of the Claims that are defined below.
Additional Claims (not specified below) MAY also be returned.</p>
<p>If a Claim is not returned,
that Claim Name SHOULD be omitted from the JSON object representing the Claims;
it SHOULD NOT be present with a null or empty string value.</p>
<p>The members MAY be represented in multiple languages and scripts.
To specify the languages and scripts,
BCP47 [<a class="reference internal" href="#term-rfc5646"><em class="xref std std-term">RFC5646</em></a>] language tags MUST be added to each member names delimited by a #,
e.g., familyName#ja-Kana-JP for expressing Family Name in Katakana in Japanese,
which is commonly used to index
and represent the phonetics of the Kanji representation of the same represented as familyName#ja-Hani-JP.</p>
<table border="1" class="docutils" id="id8">
<caption>Table 1: Reserved Member Definitions</caption>
<colgroup>
<col width="29%" />
<col width="19%" />
<col width="52%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Member</td>
<td>Type</td>
<td>Description</td>
</tr>
</tbody>
</table>
<dl class="glossary docutils">
<dt id="term-94">user_id</dt>
<dd><p class="first">string</p>
<p class="last">REQUIRED Identifier for the End-User at the Issuer.</p>
</dd>
<dt id="term-name">name</dt>
<dd><p class="first">string</p>
<p class="last">End-User&#8217;s full name in displayable form including all name parts, ordered according to End-User&#8217;s locale and preferences.</p>
</dd>
<dt id="term-given-name">given_name</dt>
<dd><p class="first">string</p>
<p class="last">Given name or first name of the End-User.</p>
</dd>
<dt id="term-family-name">family_name</dt>
<dd><p class="first">string</p>
<p class="last">Surname or last name of the End-User.</p>
</dd>
<dt id="term-middle-name">middle_name</dt>
<dd><p class="first">string</p>
<p class="last">Middle name of the End-User.</p>
</dd>
<dt id="term-nickname">nickname</dt>
<dd><p class="first">string</p>
<p class="last">Casual name of the End-User that MAY or MAY not be the same as the given_name.
For instance, a nickname value of Mike might be returned alongside a given_name value of Michael.</p>
</dd>
<dt id="term-profile">profile</dt>
<dd><p class="first">string</p>
<p class="last">URL of End-User&#8217;s profile page.</p>
</dd>
<dt id="term-picture">picture</dt>
<dd><p class="first">string</p>
<p class="last">URL of the End-User&#8217;s profile picture.</p>
</dd>
<dt id="term-website">website</dt>
<dd><p class="first">string</p>
<p class="last">URL of End-User&#8217;s web page or blog.</p>
</dd>
<dt id="term-email">email</dt>
<dd><p class="first">string</p>
<p class="last">The End-User&#8217;s preferred e-mail address.</p>
</dd>
<dt id="term-verified">verified</dt>
<dd><p class="first">boolean</p>
<p class="last">True if the End-User&#8217;s e-mail address has been verified; otherwise false.</p>
</dd>
<dt id="term-gender">gender</dt>
<dd><p class="first">string</p>
<p class="last">The End-User&#8217;s gender: Values defined by this specification are female and male. Other values MAY be used when neither of the defined values are applicable.</p>
</dd>
<dt id="term-birthday">birthday</dt>
<dd><p class="first">string</p>
<p class="last">The End-User&#8217;s birthday, represented as a date string in MM/DD/YYYY format. The year MAY be 0000, indicating that it is omitted.</p>
</dd>
<dt id="term-zoneinfo">zoneinfo</dt>
<dd><p class="first">string</p>
<p class="last">String from zoneinfo [zoneinfo] time zone database. For example, Europe/Paris or America/Los_Angeles.</p>
</dd>
<dt id="term-locale">locale</dt>
<dd><p class="first">string</p>
<p class="last">The End-User&#8217;s locale,
represented as a BCP47 [<a class="reference internal" href="#term-rfc5646"><em class="xref std std-term">RFC5646</em></a>] language tag.
This is typically an ISO 639-1 Alpha-2 [<em class="xref std std-term">ISO639‑1</em>] language code
in lowercase and an ISO 3166-1 Alpha-2 [<em class="xref std std-term">ISO3166‑1</em>] country code in uppercase,
separated by a dash.
For example, en-US or fr-CA.
As a compatibility note,
some implementations have used an underscore as the separator rather than a dash,
for example, en_US; Implementations MAY choose to accept this locale syntax as well.</p>
</dd>
<dt id="term-phone-number">phone_number</dt>
<dd><p class="first">string</p>
<p class="last">The End-User&#8217;s preferred telephone number.
E.164 [<a class="reference internal" href="#term-e-164"><em class="xref std std-term">E.164</em></a>] is RECOMMENDED as the format of this claim.
For example, +1 (425) 555-1212 or +56 (2) 687 2400.</p>
</dd>
<dt id="term-address">address</dt>
<dd><p class="first">JSON object</p>
<p class="last">The End-User&#8217;s preferred address.
The value of the address member is a JSON [<a class="reference internal" href="oauth.html#term-rfc4627"><em class="xref std std-term">RFC4627</em></a>] structure containing some
or all of the members defined in <a class="reference internal" href="#messages-2-4-2-1"><em>Section 2.4.2.1</em></a>.</p>
</dd>
<dt id="term-updated-time">updated_time</dt>
<dd><p class="first">string</p>
<p class="last">Time the End-User&#8217;s information was last updated,
represented as a RFC 3339 [<a class="reference internal" href="#term-rfc3339"><em class="xref std std-term">RFC3339</em></a>] datetime.
For example, 2011-01-03T23:58:42+0000.</p>
</dd>
</dl>
<p>For privacy reasons,
<a class="reference internal" href="glossary.html#term-openid-providers"><em class="xref std std-term">OpenID Providers</em></a> MAY elect to not provide values for some schema elements as part of the <a class="reference internal" href="glossary.html#term-openid"><em class="xref std std-term">openid</em></a> scope.</p>
<p>The <a class="reference internal" href="#term-94"><em class="xref std std-term">user_id</em></a> claim in the <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> response MUST exactly match
the <a class="reference internal" href="#term-94"><em class="xref std std-term">user_id</em></a> claim in the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>, before using additional <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> claims.</p>
<p>The <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> MUST return Claims in JSON format
unless a different format was specified during OpenID Connect Dynamic Client Registration 1.0 [<a class="reference internal" href="#term-openid-registration"><em class="xref std std-term">OpenID.Registration</em></a>].
The <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> MAY return Claims in <a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a> format,
which can be signed and/or encrypted.
The <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> MUST return a content-type header
to indicate the format that is being returned.
The following are accepted content types:</p>
<table border="1" class="docutils">
<caption>Accepted Content Types for UserInfo Endpoint response</caption>
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Content-Type</th>
<th class="head">Format Returned</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>application/json</td>
<td>plain text JSON object</td>
</tr>
<tr class="row-odd"><td>application/jwt</td>
<td>A JWT</td>
</tr>
</tbody>
</table>
<p>The following is a non-normative example of such a response:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;user_id&quot;</span><span class="o">:</span> <span class="s2">&quot;248289761001&quot;</span><span class="p">,</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;picture&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/janedoe/me.jpg&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 07 : <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor14">http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor14</a> )</p>
<div class="section" id="messages-2-4-2-1">
<span id="id9"></span><h5><a class="toc-backref" href="#id56">2.4.2.1.  Address Claim</a><a class="headerlink" href="#messages-2-4-2-1" title="Permalink to this headline">¶</a></h5>
<p>The components of a physical mailing address.
Implementations MAY return only a subset of the fields of an <a class="reference internal" href="#term-address"><em class="xref std std-term">address</em></a>,
depending upon the information available and the End-User&#8217;s privacy preferences.
For example,
the <a class="reference internal" href="#term-117"><em class="xref std std-term">country</em></a> and <a class="reference internal" href="#term-115"><em class="xref std std-term">region</em></a> might be returned without returning more fine-grained address information.</p>
<p>Implementations MAY return just the full address as a single string in the formatted sub-field,
or they MAY return just the individual component fields
using the other sub-fields,
or they MAY return both.
If both variants are returned,
they SHOULD be describing the same address,
with the formatted address indicating how the component fields should be combined.</p>
<dl class="glossary docutils">
<dt id="term-112">formatted</dt>
<dd>The full mailing address,
formatted for display or use with a mailing label.
This field MAY contain newlines.
This is the Primary Sub-Field for this field, for the purposes of sorting and filtering.</dd>
<dt id="term-113">street_address</dt>
<dd>The full street address component,
which may include house number, street name, PO BOX, and multi-line extended street address information.
This field MAY contain newlines.</dd>
<dt id="term-114">locality</dt>
<dd>The city or locality component.</dd>
<dt id="term-115">region</dt>
<dd>The state, province, prefecture or region component.</dd>
<dt id="term-116">postal_code</dt>
<dd>The zip code or postal code component.</dd>
<dt id="term-117">country</dt>
<dd>The country name component.</dd>
</dl>
<p>(draft 07: <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#address_claim">http://openid.bitbucket.org/openid-connect-messages-1_0.html#address_claim</a> )</p>
</div>
</div>
<div class="section" id="messages-2-4-3">
<span id="id10"></span><h4><a class="toc-backref" href="#id57">2.4.3.  UserInfo Error Response</a><a class="headerlink" href="#messages-2-4-3" title="Permalink to this headline">¶</a></h4>
<p>When an error condition occurs,
the <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> returns an <a class="reference internal" href="glossary.html#term-error-response"><em class="xref std std-term">Error Response</em></a>.
In addition to the error codes
defined in <em class="xref std std-ref">section 3.1 of OAuth 2.0 Bearer Tokens</em> [<a class="reference internal" href="#term-oauth-bearer"><em class="xref std std-term">OAuth.Bearer</em></a>],
this specification defines the following error codes:</p>
<dl class="glossary docutils">
<dt id="term-118">invalid_schema</dt>
<dd>The requested schema is invalid or unsupported.</dd>
</dl>
<p>(draft 07)</p>
</div>
</div>
<div class="section" id="claim-types">
<span id="messages-2-5"></span><h3><a class="toc-backref" href="#id58">2.5.  Claim Types</a><a class="headerlink" href="#claim-types" title="Permalink to this headline">¶</a></h3>
<p>The UserInfo Endpoint MAY return the following three types of Claims:</p>
<dl class="glossary docutils">
<dt id="term-normal-claims">Normal Claims</dt>
<dd>Claims that are directly asserted by the OpenID Provider.</dd>
<dt id="term-aggregated-claims">Aggregated Claims</dt>
<dd>Claims that are asserted by a Claims Provider other than the OpenID Provider but are returned by OpenID Provider.</dd>
<dt id="term-distributed-claims">Distributed Claims</dt>
<dd>Claims that are asserted by a Claims Provider other than the OpenID Provider but are returned as references by the OpenID Provider.</dd>
</dl>
<p>The UserInfo endpoint MUST support normal Claims.</p>
<p>Aggregated and Distributed Claims support is OPTIONAL.</p>
<p>(draft 13)</p>
<div class="section" id="normal-claims">
<span id="messages-2-5-1"></span><h4><a class="toc-backref" href="#id59">2.5.1.  Normal Claims</a><a class="headerlink" href="#normal-claims" title="Permalink to this headline">¶</a></h4>
<p>Normal Claims are represented as members in a JSON object. The Claim Name is the member name and the Claim Value is the member value.</p>
<p>The following is a non-normative normal Claims response:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;picture&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/janedoe/me.jpg&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft13)</p>
</div>
<div class="section" id="aggregated-and-distributed-claims">
<span id="messages-2-5-2"></span><h4><a class="toc-backref" href="#id60">2.5.2.  Aggregated and Distributed Claims</a><a class="headerlink" href="#aggregated-and-distributed-claims" title="Permalink to this headline">¶</a></h4>
<p>Aggregated and distributed Claims are represented by
using special <a class="reference internal" href="#term-127"><em class="xref std std-term">_claim_names</em></a> and <a class="reference internal" href="#term-128"><em class="xref std std-term">_claim_sources</em></a> members of the JSON object containing the Claims.</p>
<dl class="glossary docutils">
<dt id="term-claim-names">_claim_names</dt>
<dd><p class="first">This value is a JSON object
whose member names are the Claim Names
for the Aggregated and Distributed Claims.</p>
<p class="last">The member values are references to the member names
in the <a class="reference internal" href="#term-128"><em class="xref std std-term">_claim_sources</em></a> member from
which the actual Claim Values can be retrieved.</p>
</dd>
<dt id="term-claim-sources">_claim_sources</dt>
<dd><p class="first">This value is a JSON object
whose member names are referenced by the member values
of the <a class="reference internal" href="#term-127"><em class="xref std std-term">_claim_names</em></a> member.</p>
<p>The member values contain sets of Aggregated Claims
or reference locations for Distributed Claims.</p>
<p>The member values can have one of the following formats
depending on whether it is providing Aggregated or Distributed Claims:</p>
<blockquote>
<div><dl class="docutils">
<dt>Aggregated Claims</dt>
<dd><p class="first">A JSON object that MUST contain the JWT member whose value is a JWT [JWT]
that MUST contain all the Claims in the <a class="reference internal" href="#term-127"><em class="xref std std-term">_claim_names</em></a> object
that references the corresponding <a class="reference internal" href="#term-128"><em class="xref std std-term">_claim_sources</em></a> member.</p>
<p>Other members MAY be present if they are understood by both parties.</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>JWT</dt>
<dd>REQUIRED. JWT Value.</dd>
</dl>
</div></blockquote>
</dd>
<dt>Distributed Claims</dt>
<dd><p class="first">A JSON object that contains the following members and values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>endpoint</dt>
<dd>REQUIRED.
The value is the OAuth 2.0 resource endpoint from which the associated Claim can be retrieved.
The endpoint URL MUST return the Claim as a JWT.</dd>
<dt>access_token</dt>
<dd><p class="first">OPTIONAL.
Access Token enabling retrieval of the Claims from the endpoint URL
by using the OAuth 2.0 Bearer [OAuth.Bearer] scheme.</p>
<p>Claims SHOULD be requested using the Authorization Request header field
and Claims Sources MUST support this method.</p>
<p class="last">If the Access Token is not available,
Clients MAY need to retrieve the Access Token out of band
or use an a priori Access Token that was negotiated
between the Claim Source and Client,
or the Claim Source MAY reauthenticate the End-User and/or reauthorize the Client.</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</div></blockquote>
<p class="last">Other members MAY be present, if understood by both parties.</p>
</dd>
</dl>
<p>The following is a non-normative response with Aggregated Claims:</p>
<p>Claims Provider A contains the following Claims for Jane Doe:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;address&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;street_address&quot;</span><span class="o">:</span> <span class="s2">&quot;1234 Hollywood Blvd.&quot;</span><span class="p">,</span>
   <span class="s2">&quot;locality&quot;</span><span class="o">:</span> <span class="s2">&quot;Los Angeles&quot;</span><span class="p">,</span>
   <span class="s2">&quot;region&quot;</span><span class="o">:</span> <span class="s2">&quot;CA&quot;</span><span class="p">,</span>
   <span class="s2">&quot;postal_code&quot;</span><span class="o">:</span> <span class="s2">&quot;90210&quot;</span><span class="p">,</span>
   <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;US&quot;</span><span class="p">},</span>
 <span class="s2">&quot;phone_number&quot;</span><span class="o">:</span> <span class="s2">&quot;+1 (310) 123-4567&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Claims Provider A signs the JSON Claims, resulting in a signed JWT:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">jwt_header</span><span class="o">.</span><span class="n">jwt_part2</span><span class="o">.</span><span class="n">jwt_part3</span>
</pre></div>
</div>
<p>Authorization Server returns Jane Doe&#8217;s Aggregated Claims from
Claims Provider A:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;birthdate&quot;</span><span class="o">:</span> <span class="s2">&quot;2001-03-23&quot;</span><span class="p">,</span>
 <span class="s2">&quot;eye_color&quot;</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>

 <span class="s2">&quot;_claim_names&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;address&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;phone_number&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span>

 <span class="p">},</span>
 <span class="s2">&quot;_claim_sources&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;src1&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;JWT&quot;</span><span class="o">:</span> <span class="s2">&quot;jwt_header.jwt_part2.jwt_part3&quot;</span><span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following is a non-normative response with Distributed Claims:</p>
<p>Claims Provider A (Jane Doe&#8217;s Bank) contains the following Claims
for Jane Doe:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;shipping_address&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;street_address&quot;</span><span class="o">:</span> <span class="s2">&quot;1234 Hollywood Blvd.&quot;</span><span class="p">,</span>
   <span class="s2">&quot;locality&quot;</span><span class="o">:</span> <span class="s2">&quot;Los Angeles&quot;</span><span class="p">,</span>
   <span class="s2">&quot;region&quot;</span><span class="o">:</span> <span class="s2">&quot;CA&quot;</span><span class="p">,</span>
   <span class="s2">&quot;postal_code&quot;</span><span class="o">:</span> <span class="s2">&quot;90210&quot;</span><span class="p">,</span>
   <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;US&quot;</span><span class="p">},</span>
 <span class="s2">&quot;payment_info&quot;</span><span class="o">:</span> <span class="s2">&quot;Some_Card 1234 5678 90123 4562&quot;</span><span class="p">,</span>
 <span class="s2">&quot;phone_number&quot;</span><span class="o">:</span> <span class="s2">&quot;+1 (310) 123-4567&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A Claims Provider B (Credit Agency) contains the following Claims
for Jane Doe:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;credit_score&quot;</span><span class="o">:</span> <span class="s2">&quot;650&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Authorization Server returns Jane Doe&#8217;s Claims along with the
Distributed Claims from Claims Provider A and B by sending the Access
Tokens and URL locations where the Claims may be retrieved:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;birthdate&quot;</span><span class="o">:</span> <span class="s2">&quot;2001-03-23&quot;</span><span class="p">,</span>
 <span class="s2">&quot;eye_color&quot;</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
 <span class="s2">&quot;_claim_names&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;payment_info&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;shipping_address&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;credit_score&quot;</span><span class="o">:</span> <span class="s2">&quot;src2&quot;</span>
 <span class="p">},</span>
 <span class="s2">&quot;_claim_sources&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;src1&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://bank.example.com/claimsource&quot;</span><span class="p">},</span>
  <span class="s2">&quot;src2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;endpoint&quot;</span><span class="o">:</span> <span class="s2">&quot;https://creditagency.example.com/claimshere&quot;</span><span class="p">,</span>
           <span class="s2">&quot;access_token&quot;</span><span class="o">:</span> <span class="s2">&quot;ksj3n283dke&quot;</span><span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" id="messages-2-7" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">orphan:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id61">2.7.  Claim Types</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>The UserInfo Endpoint MAY return the following three types of Claims:</p>
<dl class="glossary docutils">
<dt id="term-124">Normal Claims</dt>
<dd>Claims that are directly asserted by the OpenID Provider.</dd>
<dt id="term-125">Aggregated Claims</dt>
<dd>Claims that are asserted by a Claims Provider other than the OpenID Provider
but are returned by OpenID Provider.</dd>
<dt id="term-126">Distributed Claims</dt>
<dd>Claims that are asserted by a Claims Provider other than the OpenID Provider
but are returned as references by the OpenID Provider.</dd>
</dl>
<p>The UserInfo endpoint MUST support normal Claims.</p>
<p>Aggregated and Distributed Claims support is OPTIONAL.</p>
<p>(draft 15)</p>
<div class="section" id="messages-2-7-1">
<span id="id12"></span><h4><a class="toc-backref" href="#id62">2.7.1.  Normal Claims</a><a class="headerlink" href="#messages-2-7-1" title="Permalink to this headline">¶</a></h4>
<p>Normal Claims are represented as members in a JSON object.
The Claim Name is the member name and the Claim Value is the member value.</p>
<p>The following is a non-normative normal Claims response:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;picture&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/janedoe/me.jpg&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 15)</p>
</div>
<div class="section" id="messages-2-7-2">
<span id="id13"></span><h4><a class="toc-backref" href="#id63">2.7.2.  Aggregated and Distributed Claims</a><a class="headerlink" href="#messages-2-7-2" title="Permalink to this headline">¶</a></h4>
<p>Aggregated and distributed Claims are represented by using special _claim_names and _claim_sources members of the JSON object containing the Claims.</p>
<dl class="glossary docutils">
<dt id="term-127">_claim_names</dt>
<dd>JSON object whose member names are the Claim Names for the Aggregated and Distributed Claims.
The member values are references to the member names in the _claim_sources member from which the actual Claim Values can be retrieved.</dd>
<dt id="term-128">_claim_sources</dt>
<dd><p class="first">JSON object whose member names are referenced by the member values of the _claim_names member.
The member values contain sets of Aggregated Claims or reference locations for Distributed Claims.
The member values can have one of the following formats depending on whether it is providing Aggregated or Distributed Claims:</p>
<blockquote>
<div><dl class="docutils">
<dt>Aggregated Claims</dt>
<dd><p class="first">JSON object that MUST contain the JWT member whose value is a JWT [JWT] that MUST contain all the Claims in the _claim_names object that references the corresponding _claim_sources member. Other members MAY be present if they are understood by both parties.</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>JWT</dt>
<dd>REQUIRED. JWT value containing claim values.</dd>
</dl>
</div></blockquote>
</dd>
<dt>Distributed Claims</dt>
<dd><p class="first">JSON object that contains the following members and values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>endpoint</dt>
<dd>REQUIRED. OAuth 2.0 resource endpoint from which the associated Claim can be retrieved. The endpoint URL MUST return the Claim as a JWT.</dd>
<dt>access_token</dt>
<dd>OPTIONAL. Access Token enabling retrieval of the Claims from the endpoint URL by using the OAuth 2.0 Bearer Token Usage [RFC6750] protocol. Claims SHOULD be requested using the Authorization Request header field and Claims Sources MUST support this method. If the Access Token is not available, Clients MAY need to retrieve the Access Token out of band or use an a priori Access Token that was negotiated between the Claim Source and Client, or the Claim Source MAY reauthenticate the End-User and/or reauthorize the Client.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</div></blockquote>
<p class="last">Other members MAY be present, if understood by both parties.</p>
</dd>
</dl>
<p>The following is a non-normative response with Aggregated Claims:</p>
<p>Claims Provider A contains the following Claims for Jane Doe:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;address&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;street_address&quot;</span><span class="o">:</span> <span class="s2">&quot;1234 Hollywood Blvd.&quot;</span><span class="p">,</span>
   <span class="s2">&quot;locality&quot;</span><span class="o">:</span> <span class="s2">&quot;Los Angeles&quot;</span><span class="p">,</span>
   <span class="s2">&quot;region&quot;</span><span class="o">:</span> <span class="s2">&quot;CA&quot;</span><span class="p">,</span>
   <span class="s2">&quot;postal_code&quot;</span><span class="o">:</span> <span class="s2">&quot;90210&quot;</span><span class="p">,</span>
   <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;US&quot;</span><span class="p">},</span>
 <span class="s2">&quot;phone_number&quot;</span><span class="o">:</span> <span class="s2">&quot;+1 (310) 123-4567&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Claims Provider A signs the JSON Claims, resulting in a signed JWT:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">jwt_header</span><span class="o">.</span><span class="n">jwt_part2</span><span class="o">.</span><span class="n">jwt_part3</span>
</pre></div>
</div>
<p>Authorization Server returns Jane Doe&#8217;s Aggregated Claims from
Claims Provider A:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;birthdate&quot;</span><span class="o">:</span> <span class="s2">&quot;2001-03-23&quot;</span><span class="p">,</span>
 <span class="s2">&quot;eye_color&quot;</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;_claim_names&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;address&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;phone_number&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span>
 <span class="p">},</span>
 <span class="s2">&quot;_claim_sources&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;src1&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;JWT&quot;</span><span class="o">:</span> <span class="s2">&quot;jwt_header.jwt_part2.jwt_part3&quot;</span><span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following is a non-normative response with Distributed Claims:</p>
<p>Claims Provider A (Jane Doe&#8217;s Bank) contains the following Claims
for Jane Doe:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;shipping_address&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;street_address&quot;</span><span class="o">:</span> <span class="s2">&quot;1234 Hollywood Blvd.&quot;</span><span class="p">,</span>
   <span class="s2">&quot;locality&quot;</span><span class="o">:</span> <span class="s2">&quot;Los Angeles&quot;</span><span class="p">,</span>
   <span class="s2">&quot;region&quot;</span><span class="o">:</span> <span class="s2">&quot;CA&quot;</span><span class="p">,</span>
   <span class="s2">&quot;postal_code&quot;</span><span class="o">:</span> <span class="s2">&quot;90210&quot;</span><span class="p">,</span>
   <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;US&quot;</span><span class="p">},</span>
 <span class="s2">&quot;payment_info&quot;</span><span class="o">:</span> <span class="s2">&quot;Some_Card 1234 5678 90123 4562&quot;</span><span class="p">,</span>
 <span class="s2">&quot;phone_number&quot;</span><span class="o">:</span> <span class="s2">&quot;+1 (310) 123-4567&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Claims Provider B (Credit Agency) contains the following Claims
for Jane Doe:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;credit_score&quot;</span><span class="o">:</span> <span class="s2">&quot;650&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Authorization Server returns Jane Doe&#8217;s Claims along with the
Distributed Claims from Claims Provider A and Claims Provider B
by sending the Access Tokens and URL locations where the Claims
may be retrieved:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;given_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
 <span class="s2">&quot;family_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
 <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;janedoe@example.com&quot;</span><span class="p">,</span>
 <span class="s2">&quot;birthdate&quot;</span><span class="o">:</span> <span class="s2">&quot;2001-03-23&quot;</span><span class="p">,</span>
 <span class="s2">&quot;eye_color&quot;</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
 <span class="s2">&quot;_claim_names&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;payment_info&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;shipping_address&quot;</span><span class="o">:</span> <span class="s2">&quot;src1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;credit_score&quot;</span><span class="o">:</span> <span class="s2">&quot;src2&quot;</span>
  <span class="p">},</span>
 <span class="s2">&quot;_claim_sources&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;src1&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;endpoint&quot;</span><span class="o">:</span>
              <span class="s2">&quot;https://bank.example.com/claimsource&quot;</span><span class="p">},</span>
   <span class="s2">&quot;src2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;endpoint&quot;</span><span class="o">:</span>
              <span class="s2">&quot;https://creditagency.example.com/claimshere&quot;</span><span class="p">,</span>
            <span class="s2">&quot;access_token&quot;</span><span class="o">:</span> <span class="s2">&quot;ksj3n283dke&quot;</span><span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 15)</p>
</div>
</div>
</div>
<div class="section" id="serializations">
<span id="messages-3"></span><h2><a class="toc-backref" href="#id64">3.  Serializations</a><a class="headerlink" href="#serializations" title="Permalink to this headline">¶</a></h2>
<p>Parameter names and values MAY be JSON serialized into a JSON structure.</p>
<p>(draft 07: <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#Serializations">http://openid.bitbucket.org/openid-connect-messages-1_0.html#Serializations</a> )</p>
<div class="section" id="json-serialization">
<span id="messages-3-1"></span><h3><a class="toc-backref" href="#id65">3.1.  JSON Serialization</a><a class="headerlink" href="#json-serialization" title="Permalink to this headline">¶</a></h3>
<p>The parameters are serialized into a JSON structure by adding each parameter at the highest structure level.
Parameter names and string values are included as JSON strings.
Numerical values are included as JSON numbers.
Each parameter MAY have JSON Structure as its value.</p>
<p>Following is a non-normative example of such serialization:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">&quot;access_token&quot;</span><span class="o">:</span><span class="s2">&quot;SlAV32hkKG&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expires_in&quot;</span><span class="o">:</span><span class="mi">3600</span><span class="p">,</span>
 <span class="s2">&quot;refresh_token&quot;</span><span class="o">:</span><span class="s2">&quot;8xLOxBtZp8&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(draft 07: <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#js">http://openid.bitbucket.org/openid-connect-messages-1_0.html#js</a> )</p>
</div>
</div>
<div class="section" id="signatures-and-encryption">
<span id="messages-4"></span><h2><a class="toc-backref" href="#id66">4.  Signatures and Encryption</a><a class="headerlink" href="#signatures-and-encryption" title="Permalink to this headline">¶</a></h2>
<p>Depending on the transport through which the messages are sent,
the integrity of the message may not be guaranteed and
the originator of the message may not be authenticated.
To mitigate these risks,
OpenID Connect messages MAY utilize JSON Web Signature (JWS) [<a class="reference internal" href="#term-jws"><em class="xref std std-term">JWS</em></a>] to sign the content.</p>
<p>To achieve message confidentiality,
OpenID Connect messages MAY use JSON Web Encryption (JWE) [<a class="reference internal" href="#term-jwe"><em class="xref std std-term">JWE</em></a>] to encrypt the content.</p>
<p>When the message is both signed and encrypted,
it MUST be signed first then encrypted. The
value of the typ parameter in the enclosing JWT header MUST be &#8220;JWS&#8221;</p>
<p>(draft 07: <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#sigenc">http://openid.bitbucket.org/openid-connect-messages-1_0.html#sigenc</a> )</p>
<div class="section" id="supported-algorithms">
<span id="messages-4-1"></span><h3><a class="toc-backref" href="#id67">4.1.  Supported Algorithms</a><a class="headerlink" href="#supported-algorithms" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="glossary.html#term-server"><em class="xref std std-term">server</em></a> advertises its supported signing and encryption algorithms in its discovery document. The related elements are:</p>
<dl class="glossary docutils">
<dt id="term-userinfo-algs-supported">userinfo_algs_supported</dt>
<dd>A JSON array containing a list of the JWS [JWS] and JWE [JWE]
signing and encryption algorithms supported by the UserInfo Endpoint.</dd>
<dt id="term-id-token-algs-supported">id_token_algs_supported</dt>
<dd>A JSON array containing a list of the JWS [JWS] and JWE [JWE]
signing and encryption algorithms supported by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> for the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>.</dd>
<dt id="term-request-object-algs-supported">request_object_algs_supported</dt>
<dd>A JSON array containing a list of the JWS [JWS] and JWE [JWE]
signing and encryption algorithms supported by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> for the <a class="reference internal" href="#term-openid-request-object"><em class="xref std std-term">OpenID Request Object</em></a>.
Servers SHOULD support <a class="reference internal" href="glossary.html#term-hs256"><em class="xref std std-term">HS256</em></a>.</dd>
<dt id="term-token-endpoint-auth-algs-supported">token_endpoint_auth_algs_supported</dt>
<dd>A JSON array containing a list of the JWS [JWS]
signing algorithms supported by the <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a> for the <a class="reference internal" href="#term-private-key-jwt"><em class="xref std std-term">private_key_jwt</em></a> method.
Servers SHOULD support <a class="reference internal" href="glossary.html#term-rs256"><em class="xref std std-term">RS256</em></a>.</dd>
</dl>
<p>The <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> registers its required algorithms for Signing and Encryption using the following Registration parameters:</p>
<dl class="glossary docutils">
<dt id="term-require-signed-request-object">require_signed_request_object</dt>
<dd>OPTIONAL.
The JWS [JWS] signature algorithm that MUST be required by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.
All OpenID Request Objects from this <a class="reference internal" href="oauth_introspect.html#term-client-id"><em class="xref std std-term">client_id</em></a> MUST be rejected if not signed by this algorithm.</dd>
<dt id="term-userinfo-signed-response-algs">userinfo_signed_response_algs</dt>
<dd>OPTIONAL.
The JWS [JWS] signature algorithm required for userinfo responses.
If this is specified the response will be JWT [JWT] serialized.</dd>
<dt id="term-userinfo-encrypted-response-algs">userinfo_encrypted_response_algs</dt>
<dd>OPTIONAL.
A space separated list of the JWE [JWE] alg and enc algorithms required for userinfo responses.
If this is requested in combination with signing the response MUST signed first then encrypted.
If this is specified the response will be JWT [JWT] serialized.</dd>
<dt id="term-id-token-signed-response-algs">id_token_signed_response_algs</dt>
<dd>OPTIONAL.
The JWS [JWS] signing algorithm required for <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> issued to this <a class="reference internal" href="oauth_introspect.html#term-client-id"><em class="xref std std-term">client_id</em></a>.
The default if not specified is HS256 using the provided client_secret as the shared key.</dd>
<dt id="term-id-token-encrypted-response-algs">id_token_encrypted_response_algs</dt>
<dd>OPTIONAL.
A space separated list of the JWE [JWE] alg and enc algorithms required for :term`id_token` issued to this <a class="reference internal" href="oauth_introspect.html#term-client-id"><em class="xref std std-term">client_id</em></a>.
If this is requested the response MUST be signed then encrypted.
The default if not specified is no encryption.</dd>
</dl>
<p>(defat 07: <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#sigenc.alg">http://openid.bitbucket.org/openid-connect-messages-1_0.html#sigenc.alg</a> )</p>
</div>
<div class="section" id="keys">
<span id="messages-4-2"></span><h3><a class="toc-backref" href="#id68">4.2.  Keys</a><a class="headerlink" href="#keys" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="glossary.html#term-server"><em class="xref std std-term">Server</em></a> advertises its supported signing and encryption algorithms
in its discovery document. The related elements are:</p>
<p>The Provider provides its public Keys during Discovery in the following elements:</p>
<dl class="glossary docutils">
<dt id="term-jwk-url">jwk_url</dt>
<dd>URL of the OP&#8217;s JSON Web Key [<a class="reference internal" href="#term-jwk"><em class="xref std std-term">JWK</em></a>] document that
contains the Server&#8217;s signing key that is used for <a class="reference internal" href="#term-jws"><em class="xref std std-term">JWS</em></a> signing the <a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a>.
It MAY also be used by the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> to JWE encrypt the JWT to the Server
if <a class="reference internal" href="#term-145"><em class="xref std std-term">x509_encryption_url</em></a> or <a class="reference internal" href="#term-143"><em class="xref std std-term">jwk_encryption_url</em></a> is not specified,
but this is discouraged.
A separate encryption key SHOULD be used.</dd>
<dt id="term-jwk-encryption-url">jwk_encryption_url</dt>
<dd>URL of the OP&#8217;s JSON Web Key [<a class="reference internal" href="#term-jwk"><em class="xref std std-term">JWK</em></a>] document
that contains the Server&#8217;s encryption key that is used by the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> to JWE encrypt the JWT to the Server.
If it is not present, its value is the same as the URL provided by <a class="reference internal" href="#term-142"><em class="xref std std-term">jwk_url</em></a>.</dd>
<dt id="term-x509-url">x509_url</dt>
<dd>URL of the OP&#8217;s X.509 certificates in <a class="reference internal" href="glossary.html#term-288"><em class="xref std std-term">PEM</em></a> format that are used by the <a class="reference internal" href="glossary.html#term-server"><em class="xref std std-term">Server</em></a> for Signing the JWT.
It MAY also be used by the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> to JWE Encrypt the JWT to the Server
if <a class="reference internal" href="#term-145"><em class="xref std std-term">x509_encryption_url</em></a> is not specified and the key usage includes <a class="reference internal" href="glossary.html#term-keyencipherment"><em class="xref std std-term">keyEncipherment</em></a>.</dd>
<dt id="term-x509-encryption-url">x509_encryption_url</dt>
<dd>URL of the OP&#8217;s X.509 certificates in <a class="reference internal" href="glossary.html#term-288"><em class="xref std std-term">PEM</em></a> format
that contains the Server&#8217;s encryption key that is used by the Client to JWE encrypt the JWT to the Server.
If it is not present,
the URL provided by the <a class="reference internal" href="#term-144"><em class="xref std std-term">x509_url</em></a> is used instead.
The certificate MUST include <a class="reference internal" href="glossary.html#term-keyencipherment"><em class="xref std std-term">keyEncipherment</em></a> in the key usage.</dd>
</dl>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last"><a class="reference internal" href="glossary.html#term-keyencipherment"><em class="xref std std-term">keyEncipherment</em></a> seems to be abrupt here. X.509 Key Usage for Connect should be described somewhere.</p>
</div>
<p>The <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> provides its public Keys during Registration,
in the following elements:</p>
<dl class="glossary docutils">
<dt id="term-142">jwk_url</dt>
<dd>OPTIONAL. URL for the Client&#8217;s JSON Web Key [JWK] document that is used for JWS [JWS] signing of the Request Objects. If jwk_encryption_url is not provided, it is also used by the Server for JWE [JWE] encryption of JWT [JWT] to the Client.</dd>
<dt id="term-143">jwk_encryption_url</dt>
<dd>OPTIONAL. URL for the Client&#8217;s JSON Web Key [JWK]. It is used by the Server for JWE [JWE] encryption of the response objects.</dd>
<dt id="term-144">x509_url</dt>
<dd>OPTIONAL. URL for the Client&#8217;s PEM encoded X.509 Certificate or Certificate chain. It is used by the Client for JWS [JWS] signing of the request objects. If x509_encryption_url is not present, it is also used for JWE [JWE] encryption of the JWT [JWT] to the Client if the key usage includes keyEncipherment.</dd>
<dt id="term-145">x509_encryption_url</dt>
<dd>OPTIONAL. URL for the Client&#8217;s PEM encoded X.509 Certificate or Certificate chain, used for JWE [JWE] encryption of JWT [JWT] to the Client.</dd>
</dl>
<p>If keys are specified in both x509 and jwk, they MUST be the same keys.</p>
<p>Key algorithms like Elliptic Curve signing and key agreement require separate keys for signing and encryption for security. For RSA a single key MAY be used for both, but it is good practice to separate them.</p>
<p>(draft 07: <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#sigenc.key">http://openid.bitbucket.org/openid-connect-messages-1_0.html#sigenc.key</a> )</p>
</div>
<div class="section" id="signing">
<span id="messages-4-3"></span><h3><a class="toc-backref" href="#id69">4.3.  Signing</a><a class="headerlink" href="#signing" title="Permalink to this headline">¶</a></h3>
<p>The signing party MUST select a <a class="reference internal" href="glossary.html#term-signature-algorithm"><em class="xref std std-term">signature algorithm</em></a>
based on the supported algorithms of the recipient in <a class="reference internal" href="#messages-4-1"><em>Section 4.1</em></a>.</p>
<dl class="glossary docutils">
<dt id="term-symmetric-signatures">Symmetric Signatures</dt>
<dd>When using <a class="reference internal" href="glossary.html#term-hmac-signatures"><em class="xref std std-term">HMAC Signatures</em></a>,
the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> Claim of the <a class="reference internal" href="jws.html#term-jws-header"><em class="xref std std-term">JWS header</em></a> MUST be set to the appropriate algorithm
as defined in JSON Web Signature [<a class="reference internal" href="#term-jws"><em class="xref std std-term">JWS</em></a>].
The <a class="reference internal" href="oauth.html#term-client-secret"><em class="xref std std-term">client_secret</em></a> MUST be used as the signature key.</dd>
<dt id="term-asymmetric-signatures">Asymmetric Signatures</dt>
<dd><p class="first">When using <a class="reference internal" href="glossary.html#term-rsa"><em class="xref std std-term">RSA</em></a> or <a class="reference internal" href="glossary.html#term-ecdsa-signatures"><em class="xref std std-term">ECDSA Signatures</em></a>,
the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> Claim of the <a class="reference internal" href="jws.html#term-jws-header"><em class="xref std std-term">JWS header</em></a> MUST be set to the appropriate algorithm
as defined in JSON Web Signature [<a class="reference internal" href="#term-jws"><em class="xref std std-term">JWS</em></a>].</p>
<p>The private key MUST be the one associated with the <a class="reference internal" href="glossary.html#term-public-signing-key"><em class="xref std std-term">Public Signing Key</em></a>
provided in <a class="reference internal" href="#messages-4-2"><em>Section 4.2</em></a>.</p>
<p>If there are multiple keys in the referenced <a class="reference internal" href="jwk.html"><em>JWK document</em></a> ,
the <em class="xref std std-term">kid</em> MUST be specified in the <a class="reference internal" href="jws.html#term-jws-header"><em class="xref std std-term">JWS header</em></a>.</p>
<p class="last">If there are multiple certificates at the referenced certificate location,
then <em class="xref std std-term">x5t</em> MUST be specified in the <a class="reference internal" href="jws.html#term-jws-header"><em class="xref std std-term">JWS header</em></a>.
The key usage of the respective keys MUST include signature.
In particular,
if the key found through <em class="xref std std-term">x5u</em> is used,
the key usage MUST include <a class="reference internal" href="glossary.html#term-digitalsignature"><em class="xref std std-term">digitalSignature</em></a>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Key Usage &#8220;<a class="reference internal" href="glossary.html#term-digitalsignature"><em class="xref std std-term">digitalSignature</em></a>&#8221; should be described with more words.</p>
</div>
<p>( draft 07: <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#sigs">http://openid.bitbucket.org/openid-connect-messages-1_0.html#sigs</a> )</p>
</div>
<div class="section" id="encryption">
<span id="messages-4-4"></span><h3><a class="toc-backref" href="#id70">4.4.  Encryption</a><a class="headerlink" href="#encryption" title="Permalink to this headline">¶</a></h3>
<p>The encrypting party MUST select an <a class="reference internal" href="glossary.html#term-encryption-algorithm"><em class="xref std std-term">encryption algorithm</em></a>
based on the supported algorithms of the recipient in <a class="reference internal" href="#messages-4-1"><em>Section 4.1</em></a>.</p>
<p>All <a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a> MUST be <strong>signed before encryption</strong> to provide <a class="reference internal" href="glossary.html#term-integrity"><em class="xref std std-term">integrity</em></a>
and to verify the <a class="reference internal" href="#term-issuer"><em class="xref std std-term">Issuer</em></a>.</p>
<p><a class="reference internal" href="#term-symmetric-encryption"><em class="xref std std-term">Symmetric Encryption</em></a> algorithms
that provide an <a class="reference internal" href="glossary.html#term-integrated-integrity-check"><em class="xref std std-term">integrated integrity check</em></a> MUST be used
if supported by both the sender and receiver.
The <a class="reference internal" href="glossary.html#term-a128gcm"><em class="xref std std-term">A128GCM</em></a> and <a class="reference internal" href="glossary.html#term-a256gcm"><em class="xref std std-term">A256GCM</em></a> algorithms support this.</p>
<dl class="glossary docutils">
<dt id="term-symmetric-encryption">Symmetric Encryption</dt>
<dd>Use the <a class="reference internal" href="oauth.html#term-client-secret"><em class="xref std std-term">client_secret</em></a> to <a class="reference internal" href="glossary.html#term-keywrap"><em class="xref std std-term">KeyWrap</em></a>
a random <a class="reference internal" href="jwa.html#term-content-encryption-key"><em class="xref std std-term">Content Encryption Key</em></a> to be used for encrypting the signed <a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a>.</dd>
<dt id="term-asymmetric-encryption-rsa">Asymmetric Encryption RSA</dt>
<dd><p class="first">Use the link registered/discovered in <a class="reference internal" href="#messages-4-2"><em>Section 4.2</em></a>
to retrieve the relevant key.
The <a class="reference internal" href="#term-143"><em class="xref std std-term">jwk_encryption_url</em></a> or <a class="reference internal" href="#term-145"><em class="xref std std-term">x509_encryption_url</em></a> link MUST be used if provided.</p>
<p>If there are multiple keys in the referenced <a class="reference internal" href="jwk.html"><em>JWK document</em></a>,
the <em class="xref std std-term">kid</em> MUST be specified in the <a class="reference internal" href="jws.html#term-jws-header"><em class="xref std std-term">JWS header</em></a>.</p>
<p>If there are multiple certificates at the referenced certificate location,
then <em class="xref std std-term">x5t</em> MUST be specified in the <a class="reference internal" href="jws.html#term-jws-header"><em class="xref std std-term">JWS header</em></a>.
Use the supported RSA <a class="reference internal" href="glossary.html#term-keywrap"><em class="xref std std-term">KeyWrap</em></a> algorithm
to <a class="reference internal" href="glossary.html#term-keywrap"><em class="xref std std-term">KeyWrap</em></a> a random <a class="reference internal" href="jwa.html#term-content-encryption-key"><em class="xref std std-term">Content Encryption Key</em></a> to be used for encrypting
the signed <a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a>.</p>
<p class="last">The <a class="reference internal" href="glossary.html#term-key-usage"><em class="xref std std-term">key usage</em></a> of the respective keys MUST include encryption.
In particular,
if the key found through <em class="xref std std-term">x5u</em> is used,
the key usage MUST include <a class="reference internal" href="glossary.html#term-keyencipherment"><em class="xref std std-term">keyEncipherment</em></a>.</p>
</dd>
<dt id="term-asymmetric-encryption-elliptic-curve">Asymmetric Encryption Elliptic Curve</dt>
<dd><p class="first">Create an ephemeral Elliptic Curve public key for the <em class="xref std std-term">epk</em> element of
the <a class="reference internal" href="jwe.html#term-jwe-header"><em class="xref std std-term">JWE header</em></a>.
Use the link registered/discovered in <a class="reference internal" href="#messages-4-2"><em>Section 4.2</em></a>
to retrieve the relevant key.</p>
<p>The <a class="reference internal" href="#term-143"><em class="xref std std-term">jwk_encryption_url</em></a> or <a class="reference internal" href="#term-145"><em class="xref std std-term">x509_encryption_url</em></a> link
MUST be used if provided.</p>
<p>If there are multiple keys in the referenced <a class="reference internal" href="jwk.html"><em>JWK document</em></a>,
the <em class="xref std std-term">kid</em> MUST be specified in the <a class="reference internal" href="jwe.html#term-jwe-header"><em class="xref std std-term">JWE header</em></a>.</p>
<p>If there are multiple certificates at the referenced certificate location,
then <em class="xref std std-term">x5t</em> MUST be specified in the <a class="reference internal" href="jws.html#term-jws-header"><em class="xref std std-term">JWS header</em></a>.</p>
<p>Use the <a class="reference internal" href="glossary.html#term-ecdh-es"><em class="xref std std-term">ECDH-ES</em></a> algorithm
to <a class="reference internal" href="glossary.html#term-keywrap"><em class="xref std std-term">KeyWrap</em></a> a random <a class="reference internal" href="jwa.html#term-content-encryption-key"><em class="xref std std-term">Content Encryption Key</em></a> to be used
for encrypting the signed <a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a>.</p>
<p class="last">The <a class="reference internal" href="glossary.html#term-key-usage"><em class="xref std std-term">key usage</em></a> of the respective keys MUST include encryption.
In particular,
if the key found through <em class="xref std std-term">x5u</em> is used,
the key usage MUST include <a class="reference internal" href="glossary.html#term-keyencipherment"><em class="xref std std-term">keyEncipherment</em></a>.</p>
</dd>
</dl>
<p>( draft 07 : <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#enc">http://openid.bitbucket.org/openid-connect-messages-1_0.html#enc</a> )</p>
</div>
</div>
<div class="section" id="verification">
<span id="messages-5"></span><h2><a class="toc-backref" href="#id71">5.  Verification</a><a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h2>
<p>(draft 07)</p>
<div class="section" id="authorization-request-verification">
<span id="messages-5-1"></span><h3><a class="toc-backref" href="#id72">5.1.  Authorization Request Verification</a><a class="headerlink" href="#authorization-request-verification" title="Permalink to this headline">¶</a></h3>
<p>Authorization Request Verification consists of two main steps.
(1) Encryption and Signature validation of the value of request or the content of <a class="reference internal" href="#term-54"><em class="xref std std-term">request_uri</em></a>,
(2) Parameter verification.</p>
<p>If an <a class="reference internal" href="#term-openid-request-object"><em class="xref std std-term">OpenID Request Object</em></a> was sent in the request parameter
or by reference in the <a class="reference internal" href="#term-54"><em class="xref std std-term">request_uri</em></a> parameter,
the <a class="reference internal" href="glossary.html#term-request-object"><em class="xref std std-term">Request Object</em></a> MUST verify as JWS [<a class="reference internal" href="#term-jws"><em class="xref std std-term">JWS</em></a>] or JWE [<a class="reference internal" href="#term-jwe"><em class="xref std std-term">JWE</em></a>] objects
that are encoded in the JWT [<a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a>].</p>
<p>(draft 07 : <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor20">http://openid.bitbucket.org/openid-connect-messages-1_0.html#anchor20</a>)</p>
<div class="section" id="encrypted-request-object">
<span id="messages-5-1-1"></span><h4><a class="toc-backref" href="#id73">5.1.1.  Encrypted Request Object</a><a class="headerlink" href="#encrypted-request-object" title="Permalink to this headline">¶</a></h4>
<p>If the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> has advertised <a class="reference internal" href="#term-jwe"><em class="xref std std-term">JWE</em></a> encryption algorithms
in the <a class="reference internal" href="#term-request-object-algs-supported"><em class="xref std std-term">request_object_algs_supported</em></a> element of its <a class="reference internal" href="glossary.html#term-discovery-document"><em class="xref std std-term">Discovery Document</em></a>,
these are used by the Client to JWE encrypt the JWT.</p>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST decode the <a class="reference internal" href="#term-jwt"><em class="xref std std-term">JWT</em></a>
in accordance with JSON Web Encryption [<a class="reference internal" href="#term-jwe"><em class="xref std std-term">JWE</em></a>] specification.
The result MAY be either <a class="reference internal" href="#term-openid-request-object"><em class="xref std std-term">OpenID Request Object</em></a> or a <a class="reference internal" href="glossary.html#term-jws-signed-jwt"><em class="xref std std-term">JWS Signed JWT</em></a>.
In the latter case,
the signature verification MUST be performed as defined in <a class="reference internal" href="glossary.html#term-signed-request-object"><em class="xref std std-term">Signed Request Object</em></a>.</p>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST return the error if there is a decryption error.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Decription error should be JWE decription error. Look at <tt class="xref doc docutils literal"><span class="pre">JWE</span></tt> error.</p>
</div>
<p>( draft 07  )</p>
</div>
<div class="section" id="signed-request-object">
<span id="messages-5-1-2"></span><h4><a class="toc-backref" href="#id74">5.1.2.  Signed Request Object</a><a class="headerlink" href="#signed-request-object" title="Permalink to this headline">¶</a></h4>
<p>To perform <a class="reference internal" href="glossary.html#term-signature-verification"><em class="xref std std-term">Signature Verification</em></a>,
the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> parameter in the <a class="reference internal" href="jwt.html#term-jwt-header"><em class="xref std std-term">JWT header</em></a> MUST match
the value of the <a class="reference internal" href="#term-require-signed-request-object"><em class="xref std std-term">require_signed_request_object</em></a> set
during <a class="reference internal" href="glossary.html#term-client-registration"><em class="xref std std-term">Client Registration</em></a> [<a class="reference internal" href="#term-openid-registration"><em class="xref std std-term">OpenID.Registration</em></a>]
or otherwise pre-registered value.</p>
<p>The signature must be validated against the key registered for that <a class="reference internal" href="oauth_introspect.html#term-client-id"><em class="xref std std-term">client_id</em></a> and algorithm,
in accordance with the JSON Web Signature [<a class="reference internal" href="#term-jws"><em class="xref std std-term">JWS</em></a>] specification.</p>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST return the error authorization response
if there is a signature validation error.</p>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Signature validation error should be looked at <a class="reference internal" href="jws.html"><em>JSON Web Signature (JWS)</em></a>.</p>
</div>
<p>( draft 07 )</p>
</div>
<div class="section" id="parameter-verification">
<span id="messages-5-1-3"></span><h4><a class="toc-backref" href="#id75">5.1.3.  Parameter Verification</a><a class="headerlink" href="#parameter-verification" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST construct the <a class="reference internal" href="glossary.html#term-authorization-request-message"><em class="xref std std-term">Authorization Request Message</em></a>
from the <a class="reference internal" href="#term-openid-request-object"><em class="xref std std-term">OpenID Request Object</em></a> and other parameters.
Note that
if the same parameter exists both in the <a class="reference internal" href="#term-openid-request-object"><em class="xref std std-term">OpenID Request Object</em></a>
and other parameters, the former takes precedence.
Using this <a class="reference internal" href="glossary.html#term-authorization-request-message"><em class="xref std std-term">Authorization Request Message</em></a>,
the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> performs the following steps of the request verification:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST understand
all the parameters except for the unsupported claims.
If there is any parameters that it does not understand except
for the unsupported claims, it MUST return an error response.</p>
</li>
<li><p class="first">The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST verify that all the OAuth 2.0 variables
according to <a class="reference internal" href="oauth.html"><em>OAuth 2.0</em></a>.</p>
</li>
<li><p class="first">The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST verify that all the required parameters are present.</p>
</li>
<li><p class="first">If the <a class="reference internal" href="glossary.html#term-user-id-claim"><em class="xref std std-term">User ID claim</em></a> as a member of <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> claim is requested
with a specific value,
the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST only send a positive response
if that user has an active session with the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>.</p>
<p>The Authorization server MUST not reply with an <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> or <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>
for a different user,
even if they have an active session with the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.</p>
</li>
<li><p class="first">If the <a class="reference internal" href="#term-72"><em class="xref std std-term">acr</em></a> required claim is requested as a member of <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> member
with values as a paramater,
the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST return a <a class="reference internal" href="#term-72"><em class="xref std std-term">acr</em></a> claim value
that matches one of the requested values.
The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization server</em></a> MAY ask the user to re-authenticate
with additional factors to meet the requirements.</p>
<p>If this is a required claim and the requirement cannot be met,
then the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST return an error.</p>
<p>The client MAY make this claim optional
by including &#8220;optional&#8221;: true in the acr object.</p>
<p>If the claim is optional and the requested value for the user cannot be provided,
the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization server</em></a> SHOULD return the sessions current <a class="reference internal" href="#term-72"><em class="xref std std-term">acr</em></a>
as the value of the <a class="reference internal" href="#term-72"><em class="xref std std-term">acr</em></a> claim.</p>
<p>If the claim is optional the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization server</em></a> is not requited
to provide this claim in it&#8217;s response.</p>
</li>
</ol>
</div></blockquote>
<p>If the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> encounters any error,
it MUST return the error response.</p>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last">Check error response... JW*?  Connect bindings?</p>
</div>
<p>( draft 07)</p>
</div>
</div>
<div class="section" id="messages-5-2">
<span id="id-token-verification"></span><h3><a class="toc-backref" href="#id76">5.2.  ID Token Verification</a><a class="headerlink" href="#messages-5-2" title="Permalink to this headline">¶</a></h3>
<p>To verify the validity of <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>
in the Authorization or Token Endpoint Response,
the Client MUST do the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>If the Client has provided an <a class="reference internal" href="#term-id-token-encrypted-response-algs"><em class="xref std std-term">id_token_encrypted_response_algs</em></a> parameter
during <a class="reference internal" href="#term-registration"><em class="xref std std-term">Registration</em></a>,
decrypt the <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> [<a class="reference internal" href="#term-jwe"><em class="xref std std-term">JWE</em></a>],
using the key pair specified during <a class="reference internal" href="#term-registration"><em class="xref std std-term">Registration</em></a>.</li>
<li>The Client MUST validate that the <a class="reference internal" href="oauth_introspect.html#term-client-id"><em class="xref std std-term">client_id</em></a> in the <a class="reference internal" href="#term-aud"><em class="xref std std-term">aud</em></a> (audience) Claim
is one it has registered for the <a class="reference internal" href="#term-issuer"><em class="xref std std-term">Issuer</em></a> identified
by the value in the <a class="reference internal" href="#term-iss"><em class="xref std std-term">iss</em></a> (issuer) Claim.
The <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> MUST be rejected
if the value of <a class="reference internal" href="#term-aud"><em class="xref std std-term">aud</em></a> (audience) is not valid for the <a class="reference internal" href="#term-issuer"><em class="xref std std-term">Issuer</em></a>.</li>
<li>The Client MUST verify the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> signature
according to <a class="reference internal" href="jws.html#jws-5"><em>Section 5 of JWS</em></a> [<a class="reference internal" href="#term-jws"><em class="xref std std-term">JWS</em></a>]
using the algorithm specified in the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> parameter of the <a class="reference internal" href="jwt.html#term-jwt-header"><em class="xref std std-term">JWT header</em></a>.</li>
<li>The value of <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> SHOULD be the algorithm sent by the Client
in the <a class="reference internal" href="#term-id-token-signed-response-algs"><em class="xref std std-term">id_token_signed_response_algs</em></a> parameter during <a class="reference internal" href="#term-registration"><em class="xref std std-term">Registration</em></a>.</li>
<li>If the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> parameter of the <a class="reference internal" href="jwt.html#term-jwt-header"><em class="xref std std-term">JWT header</em></a> is
one of <a class="reference internal" href="glossary.html#term-hs256"><em class="xref std std-term">HS256</em></a>, <a class="reference internal" href="glossary.html#term-hs384"><em class="xref std std-term">HS384</em></a>, or <a class="reference internal" href="glossary.html#term-hs512"><em class="xref std std-term">HS512</em></a>,
the <a class="reference internal" href="oauth.html#term-client-secret"><em class="xref std std-term">client_secret</em></a> for the <a class="reference internal" href="oauth_introspect.html#term-client-id"><em class="xref std std-term">client_id</em></a> contained in the <a class="reference internal" href="#term-aud"><em class="xref std std-term">aud</em></a> (audience) Claim
is used to validate the signature.</li>
<li>For other <a class="reference internal" href="glossary.html#term-signing-algorithms"><em class="xref std std-term">Signing algorithms</em></a>
the Client must use the signing key provided in <a class="reference internal" href="openid_connect.html#term-discovery"><em class="xref std std-term">Discovery</em></a>
by the <a class="reference internal" href="#term-issuer"><em class="xref std std-term">Issuer</em></a> exactly matching the value of the <a class="reference internal" href="#term-iss"><em class="xref std std-term">iss</em></a> (issuer) Claim.</li>
<li>The current time MUST be less than the value of the <a class="reference internal" href="#term-exp"><em class="xref std std-term">exp</em></a> Claim.</li>
<li>The value of the <a class="reference internal" href="#term-63"><em class="xref std std-term">nonce</em></a> Claim MUST be checked
to verify that it is the same value as the one
that was sent in the <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a>.
The Client SHOULD check the nonce value for <a class="reference internal" href="glossary.html#term-replay-attacks"><em class="xref std std-term">replay attacks</em></a>.
The precise method for detecting <a class="reference internal" href="glossary.html#term-replay-attacks"><em class="xref std std-term">replay attacks</em></a> is client specific.</li>
<li>If the <a class="reference internal" href="#term-72"><em class="xref std std-term">acr</em></a> Claim was requested,
the Client SHOULD check that the asserted Claim Value is appropriate.
The meaning and processing of <a class="reference internal" href="#term-72"><em class="xref std std-term">acr</em></a> Claim Values is out of scope for this specification.</li>
<li>If the <a class="reference internal" href="#term-71"><em class="xref std std-term">auth_time</em></a> Claim was requested,
the Client SHOULD check the value and request re-authentication
if it determines too much time has elapsed since the last user authentication.</li>
</ol>
</div></blockquote>
<p>(draft 07)</p>
</div>
<div class="section" id="check-id-request-verification">
<span id="messages-5-3"></span><h3><a class="toc-backref" href="#id77">5.3.  Check ID Request Verification</a><a class="headerlink" href="#check-id-request-verification" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST check
that the <a class="reference internal" href="oauth.html#term-access-token"><em class="xref std std-term">access_token</em></a> is present in the request and if it is signed,
it MUST verify the signature according to <a class="reference internal" href="jws.html#jws-5"><em>Section 5 of JWS</em></a> [<a class="reference internal" href="#term-jws"><em class="xref std std-term">JWS</em></a>].</p>
<p>If the JWS algorithm is symmetric,
such as the default <a class="reference internal" href="glossary.html#term-hs256"><em class="xref std std-term">HS256</em></a> for <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a>,
the <a class="reference internal" href="oauth.html#term-client-secret"><em class="xref std std-term">client_secret</em></a> for the <a class="reference internal" href="oauth_introspect.html#term-client-id"><em class="xref std std-term">client_id</em></a>
contained in the <a class="reference internal" href="#term-aud"><em class="xref std std-term">aud</em></a> (audience) Claim MUST be used to validate the signature.</p>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST check that the <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a>
provided as the <a class="reference internal" href="oauth.html#term-access-token"><em class="xref std std-term">access_token</em></a> contains all REQUIRED Claims.</p>
<p>(draft 07)</p>
</div>
<div class="section" id="check-id-response-verification">
<span id="messages-5-4"></span><h3><a class="toc-backref" href="#id78">5.4.  Check ID Response Verification</a><a class="headerlink" href="#check-id-response-verification" title="Permalink to this headline">¶</a></h3>
<p>If the Client does not directly verify the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> signature,
it MUST make a request to the <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a> to validate the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple">
<li>OP server</li>
<li>client_id = aud = RP = Client</li>
<li>iss = OP</li>
<li>exp</li>
<li>nonce</li>
<li>acr</li>
<li>auth_time</li>
<li>response error</li>
<li>issuer identifier</li>
</ol>
</div>
<p>To verify the validity of the <a class="reference internal" href="glossary.html#term-token-response"><em class="xref std std-term">Token response</em></a>,
the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> MUST do the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Check that the OP that responded was really the intended OP <a class="footnote-reference" href="#id16" id="id14">[1]</a>.</li>
<li>The Client MUST validate that the <a class="reference internal" href="oauth_introspect.html#term-client-id"><em class="xref std std-term">client_id</em></a>
in the <a class="reference internal" href="#term-aud"><em class="xref std std-term">aud</em></a> (audience) Claim is one
it has registered for the <a class="reference internal" href="#term-issuer"><em class="xref std std-term">Issuer</em></a>
identified by the value in the <a class="reference internal" href="#term-iss"><em class="xref std std-term">iss</em></a> (issuer) Claim.  <a class="footnote-reference" href="#id17" id="id15">[2]</a>
The <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> MUST be rejected if the value of <a class="reference internal" href="#term-aud"><em class="xref std std-term">aud</em></a> (audience) is not valid for the Issuer.</li>
<li>The value of the <a class="reference internal" href="#term-iss"><em class="xref std std-term">iss</em></a> (issuer) Claim must match the <a class="reference internal" href="#term-issuer"><em class="xref std std-term">Issuer</em></a>
for the <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a>&#8220;</li>
</ol>
<p>4   The current time MUST be less than the value of the <a class="reference internal" href="#term-exp"><em class="xref std std-term">exp</em></a> Claim.</p>
<ol class="arabic simple" start="5">
<li>The value of the <a class="reference internal" href="#term-63"><em class="xref std std-term">nonce</em></a> Claim MUST be checked to verify
that it is the same value as the one that was sent in the <a class="reference internal" href="glossary.html#term-authorization-request"><em class="xref std std-term">Authorization Request</em></a>.
The Client SHOULD check the <a class="reference internal" href="#term-63"><em class="xref std std-term">nonce</em></a> value for <a class="reference internal" href="glossary.html#term-replay-attacks"><em class="xref std std-term">replay attacks</em></a>.
The precise method for detecting <a class="reference internal" href="glossary.html#term-replay-attacks"><em class="xref std std-term">replay attacks</em></a> is client specific.</li>
<li>If the <a class="reference internal" href="#term-72"><em class="xref std std-term">acr</em></a> Claim was requested,
the Client SHOULD check that the asserted Claim Value is appropriate.
The meaning and processing of <a class="reference internal" href="#term-72"><em class="xref std std-term">acr</em></a> Claim Values is out of scope for this specification.</li>
<li>If the <a class="reference internal" href="#term-71"><em class="xref std std-term">auth_time</em></a> Claim was requested,
the Client SHOULD check the value and request re-authentication
if it determines too much time has elapsed since the last user authentication.</li>
<li>The <a class="reference internal" href="#term-check-id-endpoint"><em class="xref std std-term">Check ID Endpoint</em></a> has not returned an error
for the <a class="reference internal" href="#term-id-token"><em class="xref std std-term">ID Token</em></a> being expired or invalid.</li>
<li>Check that the <a class="reference internal" href="#term-iss"><em class="xref std std-term">iss</em></a> (issuer) is equal to that of the pre-configured
or discovered <a class="reference internal" href="#term-issuer-identifier"><em class="xref std std-term">Issuer Identifier</em></a> for the user session.</li>
</ol>
</div></blockquote>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id14">[1]</a></td><td>RP(Client) is the subject of this sentense.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id15">[2]</a></td><td>iss = Issuer = OP. aud = Audience = RP = Client</td></tr>
</tbody>
</table>
<p>(draft 07)</p>
</div>
<div class="section" id="userinfo-response-verification">
<span id="messages-5-5"></span><h3><a class="toc-backref" href="#id79">5.5.  UserInfo Response Verification</a><a class="headerlink" href="#userinfo-response-verification" title="Permalink to this headline">¶</a></h3>
<p>To verify the validity of the <a class="reference internal" href="glossary.html#term-userinfo-response"><em class="xref std std-term">UserInfo response</em></a>,
the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> MUST do the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>If the Client has provided a <a class="reference internal" href="#term-userinfo-encrypted-response-algs"><em class="xref std std-term">userinfo_encrypted_response_algs</em></a> parameter
during <a class="reference internal" href="#term-registration"><em class="xref std std-term">Registration</em></a>,
decrypt the <a class="reference internal" href="#term-80"><em class="xref std std-term">id_token</em></a> [<a class="reference internal" href="#term-jwe"><em class="xref std std-term">JWE</em></a>],
using the key pair specified during <a class="reference internal" href="#term-registration"><em class="xref std std-term">Registration</em></a>.</li>
<li>If the response was signed,
the Client SHOULD validate the signature according to <a class="reference internal" href="jws.html#jws-5"><em>Section 5 of JWS</em></a> [<a class="reference internal" href="#term-jws"><em class="xref std std-term">JWS</em></a>].</li>
<li>Check that the OP that responded was really the intended OP
through a TLS/SSL server certificate check, per RFC 6125 [<a class="reference internal" href="#term-rfc6125"><em class="xref std std-term">RFC6125</em></a>].</li>
</ol>
</div></blockquote>
<p>( draft 07 )</p>
</div>
<div class="section" id="access-token-verification">
<span id="messages-5-6"></span><h3><a class="toc-backref" href="#id80">5.6.  Access Token Verification</a><a class="headerlink" href="#access-token-verification" title="Permalink to this headline">¶</a></h3>
<p>To verify the validity of an Access Token issued with an ID Token in the implicit flow,
the client SHOULD do the following:</p>
<p>Hash the <a class="reference internal" href="oauth.html#term-access-token"><em class="xref std std-term">access_token</em></a> with the SHA hash algorithm of the same length
as the hash used in the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> paramater of the JWS header of the ID Token.</p>
<p>Take the left-most half of the hash and base64url encode it.
The value of <a class="reference internal" href="#term-at-hash"><em class="xref std std-term">at_hash</em></a> in the ID Token MUST match the value produced in step 3 above if at_hash is present in the ID Token.</p>
<p>(Draft 09)
( <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#access.token.verification">http://openid.bitbucket.org/openid-connect-messages-1_0.html#access.token.verification</a> )</p>
</div>
<div class="section" id="code-verification">
<span id="messages-5-7"></span><h3><a class="toc-backref" href="#id81">5.7.  Code Verification</a><a class="headerlink" href="#code-verification" title="Permalink to this headline">¶</a></h3>
<p>To verify the validity of a code issued with an ID Token in the implicit flow,
the client SHOULD do the following:</p>
<p>Hash the code with the SHA hash algorithm of the same length
as the hash used in the <a class="reference internal" href="glossary.html#term-alg"><em class="xref std std-term">alg</em></a> paramater of the JWS header of the ID Token.</p>
<p>Take the left-most half of the hash and base64url encode it.
The value of <a class="reference internal" href="#term-c-hash"><em class="xref std std-term">c_hash</em></a> in the ID Token
MUST match the value produced in step 3 above if <a class="reference internal" href="#term-c-hash"><em class="xref std std-term">c_hash</em></a> is present in the ID Token.</p>
<p>(Draft 09)
( <a class="reference external" href="http://openid.bitbucket.org/openid-connect-messages-1_0.html#code.verification">http://openid.bitbucket.org/openid-connect-messages-1_0.html#code.verification</a> )</p>
</div>
</div>
<div class="section" id="string-operations">
<span id="messages-6"></span><h2><a class="toc-backref" href="#id82">6.  String Operations</a><a class="headerlink" href="#string-operations" title="Permalink to this headline">¶</a></h2>
<p>Processing some OpenID Connect messages requires comparing values
in the messages to known values.
For example,
the Claim Names returned by the <a class="reference internal" href="#term-userinfo-endpoint"><em class="xref std std-term">UserInfo Endpoint</em></a> might be compared to specific Claim Names
such as <a class="reference internal" href="#term-94"><em class="xref std std-term">user_id</em></a>.
Comparing Unicode strings, however, has significant <strong>security implications</strong>.</p>
<p>Therefore, comparisons between JSON strings and other Unicode strings MUST be performed as specified below:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Remove any JSON applied escaping to produce an array of Unicode code points.</li>
<li>Unicode Normalization [<a class="reference internal" href="#term-usa15"><em class="xref std std-term">USA15</em></a>] MUST NOT be applied at any point
to either the JSON string or to the string it is to be compared against.</li>
<li>Comparisons between the two strings MUST be performed
as a Unicode code point to code point equality comparison.</li>
</ol>
</div></blockquote>
<p>In several places,
this specification uses space delimited lists of strings.
In all such cases,
only the ASCII space character (0x20) MAY be used for this purpose.</p>
<p>( draft 07 )</p>
</div>
<div class="section" id="related-specifications">
<span id="messages-7"></span><h2><a class="toc-backref" href="#id83">7.  Related Specifications</a><a class="headerlink" href="#related-specifications" title="Permalink to this headline">¶</a></h2>
<p>This specification is an abstract specification.
It needs to be bound to a protocol to be used in practice.
One such example of protocol binding is:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="standard.html"><em>OpenID Connect Standard 1.0</em></a> [<a class="reference internal" href="#term-openid-standard"><em class="xref std std-term">OpenID.Standard</em></a>] - Protocol binding for the full set of OpenID Connect messages</li>
</ul>
</div></blockquote>
<p>These related OpenID Connect specifications MAY OPTIONALLY be used in combination with this specification to provide additional functionality:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="discovery.html"><em>OpenID Connect Discovery 1.0</em></a> [<a class="reference internal" href="#term-openid-discovery"><em class="xref std std-term">OpenID.Discovery</em></a>] - Dynamic discovery for user and Authorization Server endpoints and information</li>
<li><a class="reference internal" href="reg.html"><em>OpenID Connect Dynamic Client Registration 1.0</em></a> [<a class="reference internal" href="#term-openid-registration"><em class="xref std std-term">OpenID.Registration</em></a>] - Dynamic registration of OpenID Connect Clients with OpenID Providers</li>
<li><a class="reference internal" href="basic.html"><em>OpenID Connect Basic Client 1.0</em></a> [<a class="reference internal" href="#term-openid-basic"><em class="xref std std-term">OpenID.Basic</em></a>] - Protocol binding for a subset of the OpenID Connect Messages which is intended for use by basic Relying Parties.</li>
<li><a class="reference internal" href="session.html"><em>OpenID Connect Session Management 1.0</em></a> [<a class="reference internal" href="#term-openid-session"><em class="xref std std-term">OpenID.Session</em></a>] - Session management for OpenID Connect sessions</li>
</ul>
</div></blockquote>
<p>(draft 07)</p>
</div>
<div class="section" id="security-considerations">
<span id="messages-8"></span><h2><a class="toc-backref" href="#id84">8.  Security Considerations</a><a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="oauth_threat.html"><em>OAuth 2.0 Threat Model and Security Considerations</em></a> [<a class="reference internal" href="#term-oauth-threat"><em class="xref std std-term">OAuth.Threat</em></a>] provides
an extensive list of threats and controls that applies to this standard as well.
In addition, this standard provides additional control measures listed below.</p>
<p>(draft 07)</p>
<div class="section" id="assertion-manufacture-modification">
<span id="messages-8-1"></span><h3><a class="toc-backref" href="#id85">8.1.  Assertion Manufacture/Modification</a><a class="headerlink" href="#assertion-manufacture-modification" title="Permalink to this headline">¶</a></h3>
<p>To mitigate this attack, there are two ways to mitigate it.</p>
<blockquote>
<div><ul class="simple">
<li>The assertion may be digitally signed by the OP.
The Relying Party SHOULD check the digital signature to verify that it was issued by a legitimate OP.</li>
<li>The assertion may be sent over a protected channel such as TLS/SSL.
In order to protect the integrity of assertions from malicious attack, the OP MUST be authenticated.
In this specification, the assertion is always sent over TLS/SSL protected channel.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="assertion-disclosure">
<span id="messages-8-2"></span><h3><a class="toc-backref" href="#id86">8.2.  Assertion Disclosure</a><a class="headerlink" href="#assertion-disclosure" title="Permalink to this headline">¶</a></h3>
<p>The Assertion disclosure can be mitigated in the following two ways.</p>
<blockquote>
<div><ul class="simple">
<li>Assertion is sent over TLS/SSL protected channel, where RP is authenticated by &#8220;<strong>client_id</strong>&#8221; and &#8220;<strong>client_secret</strong>&#8221;.</li>
<li>Signed Assertion is encrypted by the RP&#8217;s public key.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="assertion-repudiation">
<span id="messages-8-3"></span><h3><a class="toc-backref" href="#id87">8.3.  Assertion Repudiation</a><a class="headerlink" href="#assertion-repudiation" title="Permalink to this headline">¶</a></h3>
<p>To mitigate this threat,
the assertion may be digitally signed by the OP using a key that supports non-repudiation.
The RP SHOULD check the digital signature to verify that it was issued by a legitimate OP.</p>
</div>
<div class="section" id="assertion-redirect">
<span id="messages-8-4"></span><h3><a class="toc-backref" href="#id88">8.4.  Assertion Redirect</a><a class="headerlink" href="#assertion-redirect" title="Permalink to this headline">¶</a></h3>
<p>To mitigate this threat,
the assertion includes the identity of the RP for whom it was generated as &#8220;<strong>client_id</strong>&#8221;.
The RP verifies that incoming assertions include its identity as the recipient of the assertion.</p>
</div>
<div class="section" id="assertion-reuse">
<span id="messages-8-5"></span><h3><a class="toc-backref" href="#id89">8.5.  Assertion Reuse</a><a class="headerlink" href="#assertion-reuse" title="Permalink to this headline">¶</a></h3>
<p>The assertion includes a <strong>timestamp</strong> and a short lifetime of validity.
The Relying Party checks the <strong>timestamp</strong> and <strong>lifetime</strong> values to ensure that the assertion is currently valid.</p>
</div>
<div class="section" id="secondary-authenticator-manufacture">
<span id="messages-8-6"></span><h3><a class="toc-backref" href="#id90">8.6.  Secondary Authenticator Manufacture</a><a class="headerlink" href="#secondary-authenticator-manufacture" title="Permalink to this headline">¶</a></h3>
<p>Due to the large entropy requirement of the Artifact (&#8220;<strong>code</strong>&#8221;) and short life nature of its validity,
the success probability of this attack is extremely low.</p>
</div>
<div class="section" id="secondary-authenticator-capture">
<span id="messages-8-7"></span><h3><a class="toc-backref" href="#id91">8.7.  Secondary Authenticator Capture</a><a class="headerlink" href="#secondary-authenticator-capture" title="Permalink to this headline">¶</a></h3>
<p>Secondary authenticator (=&#8221;<strong>code</strong>&#8221;) is transmitted only through HTTPS,
thus it is protected between the OP and the User-Agent, and User-Agent and the RP.</p>
<p>Only the place it can be captured is the User-Agent where the TLS session is terminated,
and is possible if the User-Agent is infested by malwares.
However, it renders no usefulness as long as the profile in use either RP authentication or assertion encryption.</p>
</div>
<div class="section" id="assertion-substitution">
<span id="messages-8-8"></span><h3><a class="toc-backref" href="#id92">8.8.  Assertion Substitution</a><a class="headerlink" href="#assertion-substitution" title="Permalink to this headline">¶</a></h3>
<p>Responses to assertion requests is bound to the corresponding requests by message order in HTTP,
as both assertions and requests are protected by TLS that can detect and disallow malicious reordering of packets.</p>
</div>
<div class="section" id="authentication-request-disclosure">
<span id="messages-8-9"></span><h3><a class="toc-backref" href="#id93">8.9.  Authentication Request Disclosure</a><a class="headerlink" href="#authentication-request-disclosure" title="Permalink to this headline">¶</a></h3>
<p>If the authentication request is POSTed directly through a protected channel,
it is not possible to disclose the authentication request.</p>
<p>If the Request File is encrypted by the OP&#8217;s public key,
the authentication request will not be disclosed
unless OP&#8217;s private key gets compromised or the encryption algorithm becomes vulnerable.</p>
</div>
<div class="section" id="timing-attack">
<span id="messages-8-10"></span><h3><a class="toc-backref" href="#id94">8.10.  Timing Attack</a><a class="headerlink" href="#timing-attack" title="Permalink to this headline">¶</a></h3>
<p>Timing attacks <a class="footnote-reference" href="#id19" id="id18">[3]</a>  can be used to reduce the effective key length of the signature
if the time required to return the response in case of a signature error and a correct signature differs.
Care should be taken in the implementation to avoid this attack.</p>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id18">[3]</a></td><td><a class="reference external" href="http://en.wikipedia.org/wiki/Timing_attack">http://en.wikipedia.org/wiki/Timing_attack</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="authentication-process-threats">
<span id="messages-8-11"></span><h3><a class="toc-backref" href="#id95">8.11.  Authentication Process Threats</a><a class="headerlink" href="#authentication-process-threats" title="Permalink to this headline">¶</a></h3>
<p>In the category of Authentication Process Threats, following threats exists.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="glossary.html#term-online-guessing"><em class="xref std std-term">Online guessing</em></a></li>
<li><a class="reference internal" href="glossary.html#term-phishing"><em class="xref std std-term">Phishing</em></a></li>
<li><a class="reference internal" href="glossary.html#term-pharming"><em class="xref std std-term">Pharming</em></a></li>
<li><a class="reference internal" href="glossary.html#term-eavesdropping"><em class="xref std std-term">Eavesdropping</em></a></li>
<li><a class="reference internal" href="glossary.html#term-replay"><em class="xref std std-term">Replay</em></a></li>
<li><a class="reference internal" href="glossary.html#term-session-hijack"><em class="xref std std-term">Session hijack</em></a></li>
<li><a class="reference internal" href="glossary.html#term-man-in-the-middle"><em class="xref std std-term">Man-in-the-middle</em></a></li>
</ul>
</div></blockquote>
<p>Authentication process per se as described in <a class="reference internal" href="glossary.html#term-nist"><em class="xref std std-term">NIST</em></a> <a class="reference internal" href="glossary.html#term-sp800-63"><em class="xref std std-term">SP800-63-rev1</em></a> is out of scope for this protocol,
but care SHOULD be taken to achieve appropriate protection.</p>
</div>
<div class="section" id="other-crypto-related-attacks">
<span id="messages-8-12"></span><h3><a class="toc-backref" href="#id96">8.12.  Other Crypto Related Attacks</a><a class="headerlink" href="#other-crypto-related-attacks" title="Permalink to this headline">¶</a></h3>
<p>There are various crypto related attacks possible depending on the method used for encryption and signature / integrity checking.</p>
<p>Implementation should consult the security consideration around the JWS [JWS], JWE [JWE] and JWT [JWT] to avoid the vulnerability around these specifications.</p>
<p>(draft 07)</p>
</div>
<div class="section" id="signing-and-encryption-order">
<span id="messages-8-13"></span><h3><a class="toc-backref" href="#id97">8.13.  Signing and Encryption order</a><a class="headerlink" href="#signing-and-encryption-order" title="Permalink to this headline">¶</a></h3>
<p>Signatures over encrypted text are not considered valid in many jurisdictions.
For the integrity of non-repudiation this specification requires signing of the plain text JSON.</p>
<p>It is however strongly RECOMMENDED that the selected Encryption algorithm include integrity to protect against padding oracle and other decryption attacks.</p>
<p>Implementation should consult the security consideration around the JWE [JWE] to avoid the vulnerability around these specifications.</p>
<p>(draft 07)</p>
</div>
<div class="section" id="issuer-identifier">
<span id="messages-8-14"></span><h3><a class="toc-backref" href="#id98">8.14.  Issuer Identifier</a><a class="headerlink" href="#issuer-identifier" title="Permalink to this headline">¶</a></h3>
<p>OpenID Connect supports a single issuer per Host and Port combination.</p>
<p>It is RECOMMENDED that only a single issuer per host be used.
<a class="reference internal" href="glossary.html#term-simple-web-discovery"><em class="xref std std-term">Simple Web Discovery</em></a> treats the <a class="reference internal" href="glossary.html#term-path-component"><em class="xref std std-term">path component</em></a> of any URI as part of the user identifier.</p>
<p>(draft 07)</p>
</div>
<div class="section" id="tls-requirements">
<span id="messages-8-15"></span><h3><a class="toc-backref" href="#id99">8.15.  TLS Requirements</a><a class="headerlink" href="#tls-requirements" title="Permalink to this headline">¶</a></h3>
<p>Implementations MUST support TLS.
Which version(s) ought to be implemented will vary over time,
and depend on the widespread deployment
and known security vulnerabilities at the time of implementation.
At the time of this writing,
TLS version 1.2 [<a class="reference internal" href="oauth_bearer.html#term-rfc5246"><em class="xref std std-term">RFC5246</em></a>] is the most recent version,
but has very limited actual deployment,
and might not be readily available in implementation toolkits.
TLS version 1.0 [<a class="reference internal" href="oauth_bearer.html#term-rfc2246"><em class="xref std std-term">RFC2246</em></a>] is the most widely deployed version,
and will give the broadest interoperability.</p>
<p>To protect against information disclosure and tampering,
confidentiality protection MUST be applied using TLS with a ciphersuite that provides confidentiality and integrity protection.</p>
<p>(draft 07)</p>
</div>
</div>
<div class="section" id="privacy-considerations">
<span id="messages-9"></span><h2><a class="toc-backref" href="#id100">9.  Privacy Considerations</a><a class="headerlink" href="#privacy-considerations" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="glossary.html#term-userinfo-response"><em class="xref std std-term">UserInfo response</em></a> typically contains <a class="reference internal" href="glossary.html#term-personally-identifiable-information"><em class="xref std std-term">Personally Identifiable Information</em></a>.
As such,
<a class="reference internal" href="glossary.html#term-end-user-consent"><em class="xref std std-term">End-User consent</em></a> for the release of the information
for the specified purpose SHOULD be obtained at
or prior to the authorization time in accordance with relevant regulations.
The purpose of use is typically registered in association with the <a class="reference internal" href="oauth_reg.html#term-24"><em class="xref std std-term">redirect_uris</em></a>.</p>
<p>Only necessary <a class="reference internal" href="glossary.html#term-userinfo-data"><em class="xref std std-term">UserInfo data</em></a> should be stored at the Client
and the <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> SHOULD associate the received data with the purpose of use statement.</p>
<p>The <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">Resource Server</em></a> SHOULD make the <a class="reference internal" href="glossary.html#term-userinfo-access-log"><em class="xref std std-term">UserInfo access log</em></a> available to the <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">End-User</em></a>
so that the <a class="reference internal" href="oauth.html#term-end-user"><em class="xref std std-term">End-User</em></a> can monitor who accessed his data.</p>
<p>To protect the End-User from a possible correlation among Clients,
the use of a <a class="reference internal" href="glossary.html#term-pairwise-pseudonymous-identifier"><em class="xref std std-term">Pairwise Pseudonymous Identifier</em></a> (<a class="reference internal" href="glossary.html#term-ppid"><em class="xref std std-term">PPID</em></a>) as the <a class="reference internal" href="#term-94"><em class="xref std std-term">user_id</em></a> SHOULD be considered.</p>
<p>(draft 07)</p>
<div class="section" id="refresh-token-and-access-token-lifetime">
<span id="messages-9-1"></span><h3><a class="toc-backref" href="#id101">9.1.  Refresh Token, and Access Token Lifetime</a><a class="headerlink" href="#refresh-token-and-access-token-lifetime" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="glossary.html#term-access-token-grants"><em class="xref std std-term">Access Token grants</em></a> are not revocable by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.
<a class="reference internal" href="glossary.html#term-access-token-grant-lifetimes"><em class="xref std std-term">Access Token grant lifetimes</em></a> SHOULD be kept to <strong>single use</strong> or <strong>very short lifetimes</strong>.</p>
<p>If access to the <a class="reference internal" href="glossary.html#term-user-info-endpoint"><em class="xref std std-term">User Info Endpoint</em></a> or other protected resources is required,
a <a class="reference internal" href="glossary.html#term-refresh-token"><em class="xref std std-term">Refresh Token</em></a> should be used.
The <a class="reference internal" href="oauth.html#term-client"><em class="xref std std-term">Client</em></a> may then exchange the <a class="reference internal" href="glossary.html#term-refresh-token"><em class="xref std std-term">Refresh Token</em></a> at the <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a>
for a fresh short lived <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">Access Token</em></a>,
that can be used to access the resource.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the Client accesses the User Info Endpoint or other portected resource sometime later
after the grant lifetime is over, .....</p>
</div>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> SHOULD clearly identify long term grants to the <a class="reference internal" href="glossary.html#term-user"><em class="xref std std-term">User</em></a> during <a class="reference internal" href="glossary.html#term-authorization"><em class="xref std std-term">Authorization</em></a>. <a class="footnote-reference" href="#id21" id="id20">[4]</a></p>
<table class="docutils footnote" frame="void" id="id21" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id20">[4]</a></td><td>Difficult to grasp.</td></tr>
</tbody>
</table>
<p>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST provide a mechanisim for the user to revoke <a class="reference internal" href="glossary.html#term-refresh-tokens"><em class="xref std std-term">Refresh Tokens</em></a> granted to a client.</p>
<p>(draft 07)</p>
</div>
</div>
<div class="section" id="iana-considerations">
<span id="messages-10"></span><h2><a class="toc-backref" href="#id102">10.  IANA Considerations</a><a class="headerlink" href="#iana-considerations" title="Permalink to this headline">¶</a></h2>
<p>This document makes no requests of IANA.</p>
<p>(draft 07)</p>
</div>
<div class="section" id="references">
<span id="messages-11"></span><h2><a class="toc-backref" href="#id103">11.  References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>(draft 07)</p>
<div class="section" id="normative-references">
<span id="messages-11-1"></span><h3><a class="toc-backref" href="#id104">11.1. Normative References</a><a class="headerlink" href="#normative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-e-164">E.164</dt>
<dd>International Telecommunication Union, “E.164 : The international public telecommunication numbering plan,” 2010.</dd>
<dt id="term-iso29115">ISO29115</dt>
<dd>McCallister, E., “ITU-T Recommendation X.1254 | ISO/IEC DIS 29115 &#8211; Information technology - Security techniques - Entity authentication assurance framework,” ISO/IEC 29115, November 2011.</dd>
<dt id="term-iso3166-1">ISO3166-1</dt>
<dd>International Organization for Standardization, “ISO 3166-1:1997. Codes for the representation of names of countries and their subdivisions &#8211; Part 1: Country codes,” 1997.</dd>
<dt id="term-iso639-1">ISO639-1</dt>
<dd>International Organization for Standardization, “ISO 639-1:2002. Codes for the representation of names of languages &#8211; Part 1: Alpha-2 code,” 2002.</dd>
<dt id="term-jwe">JWE</dt>
<dd>Jones, M., Rescorla, E., and J. Hildebrand, “JSON Web Encryption (JWE),” December 2011.</dd>
<dt id="term-jwk">JWK</dt>
<dd>Jones, M., “JSON Web Key (JWK),” December 2011.</dd>
<dt id="term-jws">JWS</dt>
<dd>Jones, M., Balfanz, D., Bradley, J., Goland, Y., Panzer, J., Sakimura, N., and P. Tarjan, “JSON Web Signature,” December 2011.</dd>
<dt id="term-jwt">JWT</dt>
<dd>Jones, M., Balfanz, D., Bradley, J., Goland, Y., Panzer, J., Sakimura, N., and P. Tarjan, “JSON Web Token,” December 2011.</dd>
<dt id="term-loa-registry">LoA.Registry</dt>
<dd>Johansson, L., “An IANA registry for SAML 2.0 Level of Assurance Context Classes,” June 2011.</dd>
<dt id="term-oauth-assertions">OAuth.Assertions</dt>
<dd>Mortimore, C., Ed., Campbell, B., Jones, M., and Y. Goland, “OAuth 2.0 Assertion Profile,” October 2011.</dd>
<dt id="term-oauth-bearer">OAuth.Bearer</dt>
<dd>Jones, M., Hardt, D., and D. Recordon, “OAuth 2.0 Protocol: Bearer Tokens,” December 2011.</dd>
<dt id="term-oauth-jwt">OAuth.JWT</dt>
<dd>Jones, M., Campbell, B., and C. Mortimore, “JSON Web Token (JWT) Bearer Token Profiles for OAuth 2.0,” December 2011.</dd>
<dt id="term-oauth-responses">OAuth.Responses</dt>
<dd>de Medeiros, B., Scurtescu, M., and P. Tarjan, “OAuth 2.0 Multiple Response Type Encoding Practices,” December 2011.</dd>
<dt id="term-oauth-threat">OAuth.Threat</dt>
<dd>Lodderstedt, T., Ed., McGloin, M., and P. Hunt, “OAuth 2.0 Threat Model and Security Considerations,” October 2011.</dd>
<dt id="term-oauth2-0">OAuth2.0</dt>
<dd>Hammer-Lahav, E., Ed., Recordon, D., and D. Hardt, “OAuth 2.0 Authorization Protocol,” September 2011.</dd>
<dt id="term-openid-basic">OpenID.Basic</dt>
<dd>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., Mortimore, C., and E. Jay, “OpenID Connect Basic Client 1.0,” December 2011.</dd>
<dt id="term-openid-discovery">OpenID.Discovery</dt>
<dd>Sakimura, N., Bradley, J., Jones, M., and E. Jay, “OpenID Connect Discovery 1.0,” December 2011.</dd>
<dt id="term-openid-registration">OpenID.Registration</dt>
<dd>Sakimura, N., Bradley, J., and M. Jones, “OpenID Connect Dynamic Client Registration 1.0,” December 2011.</dd>
<dt id="term-openid-session">OpenID.Session</dt>
<dd>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., Mortimore, C., and E. Jay, “OpenID Connect Session Management 1.0,” December 2011.</dd>
<dt id="term-openid-standard">OpenID.Standard</dt>
<dd>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., Mortimore, C., and E. Jay, “OpenID Connect Standard 1.0,” December 2011.</dd>
<dt id="term-rfc2119">RFC2119</dt>
<dd>Bradner, S., “Key words for use in RFCs to Indicate Requirement Levels,” BCP 14, RFC 2119, March 1997 (TXT, HTML, XML).</dd>
<dt id="term-rfc2246">RFC2246</dt>
<dd>Dierks, T. and C. Allen, “The TLS Protocol Version 1.0,” RFC 2246, January 1999 (TXT).</dd>
<dt id="term-rfc3339">RFC3339</dt>
<dd>Klyne, G., Ed. and C. Newman, “Date and Time on the Internet: Timestamps,” RFC 3339, July 2002 (TXT, HTML, XML).</dd>
<dt id="term-rfc4627">RFC4627</dt>
<dd>Crockford, D., “The application/json Media Type for JavaScript Object Notation (JSON),” RFC 4627, July 2006 (TXT).</dd>
<dt id="term-rfc5246">RFC5246</dt>
<dd>Dierks, T. and E. Rescorla, “The Transport Layer Security (TLS) Protocol Version 1.2,” RFC 5246, August 2008 (TXT).</dd>
<dt id="term-rfc5646">RFC5646</dt>
<dd>Phillips, A. and M. Davis, “Tags for Identifying Languages,” BCP 47, RFC 5646, September 2009 (TXT).</dd>
<dt id="term-rfc6125">RFC6125</dt>
<dd>Saint-Andre, P. and J. Hodges, “Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS),” RFC 6125, March 2011 (TXT).</dd>
<dt id="term-usa15">USA15</dt>
<dd>Davis, M., Whistler, K., and M. Dürst, “Unicode Normalization Forms,” Unicode Standard Annex 15, 09 2009.</dd>
<dt id="term-179">zoneinfo</dt>
<dd>Public Domain, “The tz database,” June 2011.</dd>
</dl>
<p>( draft 07 )</p>
</div>
<div class="section" id="informative-references">
<span id="messages-11-2"></span><h3><a class="toc-backref" href="#id105">11.2. Informative References</a><a class="headerlink" href="#informative-references" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-openid-2-0">OpenID.2.0</dt>
<dd><a class="reference external" href="mailto:specs&#37;&#52;&#48;openid&#46;net">specs<span>&#64;</span>openid<span>&#46;</span>net</a>, “OpenID Authentication 2.0,” 2007 (TXT, HTML).</dd>
<dt id="term-response-types">RESPONSE.TYPES</dt>
<dd>de Medeiros, B., Scurtescu, M., and P. Tarjan, “OAuth 2.0 Multiple Response Type Encoding Practices,” October 2011.</dd>
</dl>
<p>(draft 07)</p>
</div>
</div>
<div class="section" id="my-note">
<h2><a class="toc-backref" href="#id106">My Note</a><a class="headerlink" href="#my-note" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Simplified version of Aggregated and Distributed Claim</li>
</ul>
</div>
<div class="section" id="id22">
<h3><a class="toc-backref" href="#id107">2.5.2.  Aggregated and Distributed Claims</a><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>Aggregated and distributed Claims are represented by a JSON object including folowing claims:</p>
<dl class="glossary docutils">
<dt id="term-source">_source</dt>
<dd><p class="first">For Aggregated claim, this value is JWT string to contain the name of the claim.</p>
<p>For Distributed clamin, this value is URL of the endpoint to get JSON.</p>
<p class="last">Otherwise, value is  a key in &#8220;_sources&#8221; mapper in JSON.</p>
</dd>
<dt id="term-183">_access_token</dt>
<dd>REQUIRED if this claim is distributed.</dd>
</dl>
<p>And at the same JSON node level, a mapper can be used to  define Aggreated and Distributed Claims:</p>
<dl class="glossary docutils">
<dt id="term-sources">_sources</dt>
<dd>Disctionay JSON object. Keys MUST be unique for other A &amp; D Claims to index.
Values are concrete A &amp; D Claims.</dd>
</dl>
<p>The following is a non-normative response:</p>
<div class="highlight-json"><pre>{
    ....
    "address"        : { "_source": "jwt_header.jwt_2nd.jwt_3rd" },
    "pension_number" : { "_source": "http://japan.inc/pension/number", "_access_token" :  "ksj3n283dke"},
    ....
}</pre>
</div>
<p>If a single source holds multiple claims, a dictinaly &#8220;_sources&#8221; can hold this JSON objects:</p>
<div class="highlight-json"><pre>{
    ....
    "address":       : { "_source": "mybank" },
    "bank_account"   : { "_source": "mybank" },
    "pension_number" : { "_source": "mypension"},
    "pension_office" : { "_source": "mypension"},
    ....

    "_sources" : {
      "mybank" : { "_source": "jwt_header.jwt_2nd.jwt_3rd" },
      "mypension" : { "_source": "http://japan.inc/pension/number", "_access_token" :  "ksj3n283dke"}
    }
}</pre>
</div>
<p>Where a aggregated JWT, contains the following JSON:</p>
<div class="highlight-json"><pre>{
    "address" : {
        "country" : "Japan",
        "postal_code : "1500053",
        "region" : "Tokyo",
        .....
    },
    "bank_account" :  "0000-1111-2222"
}</pre>
</div>
<p>and the distributed endpoint returns the following JSON:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
    <span class="nt">&quot;pension_number&quot;</span> <span class="p">:</span> <span class="s2">&quot;1432143&quot;</span><span class="p">,</span>
    <span class="nt">&quot;pension_office&quot;</span> <span class="p">:</span> <span class="s2">&quot;Shibuya,Tokyo&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="standard.html">OpenID Connect Standard 1.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="reg.html">OpenID Connect Dynamic Client Registration 1.0</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>