
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>RFC3394:Advanced Encryption Standard (AES) Key Wrap Algorithm &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/basic.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.0.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/bootstrap-sphinx.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="NIST SP 800-56A:Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography" href="nist-sp-800-59a.html" />
    <link rel="prev" title="The ‘acct’ URI Scheme" href="acct.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">identity</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="oauth.html">RFC6759:The OAuth 2.0 Authorization Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_bearer.html">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_threat.html">Auth 2.0 Threat Model and Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_revocation.html">RFC7009:Token Revocation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_jwt_bearer.html">JSON Web Token (JWT) Bearer Token Profiles for OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_saml2_bearer.html">SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_assertion.html">Assertion Framework for OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_mac.html">HTTP Authentication: MAC Access Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_reg.html">OAuth Dynamic Client Registration Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_introspect.html">OAuth Token Introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_meta.html">JSON Metadata for OAuth Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_res_reg.html">OAuth 2.0 Resource Set Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth-lrdd.html">Link relation Type Registrations for OAuth 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_auth.html">OAuth 2.0 User Authentication and Consent For Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_responses.html">OAuth 2.0 Multiple Response Type Encoding Practices - draft 11</a></li>
<li class="toctree-l1"><a class="reference internal" href="oauth_post.html">OAuth 2.0 Form Post Response Mode - draft 01</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oauth_res.html">OAuth Resoure</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="openid_connect.html">OpenID Connect</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">OpenID Connect Core 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="reg.html">OpenID Connect Dynamic Client Registration 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="discovery.html">OpenID Connect Discovery 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="session.html">OpenID Connect Session Management 1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic.html">OpenID Connect Basic Client Profile 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="implicit.html">OpenID Connect Implicit Client Implementer&#8217;s Guide 1.0 - draft 14</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="standard.html">OpenID Connect Standard 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">OpenID Connect Messages 1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="uma_core.html">User-Managed Access (UMA) Profile of OAuth 2.0 : draft09</a></li>
<li class="toctree-l1"><a class="reference internal" href="uma_trust.html">Binding Obligations on User-Managed Access (UMA) Participants</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="jose.html">Terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwa.html">JSON Web Algorithms (JWA) : draft21</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwt.html">JSON Web Token (JWT) : draft19</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws.html">JSON Web Signature (JWS) : draft25</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws_hok.html">Holder-of-Key JSON Web Signature (JWS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwe.html">JSON Web Encryption (JWE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwk.html">JSON Web Key (JWK) : draft24</a></li>
<li class="toctree-l1"><a class="reference internal" href="jws_js.html">JSON Web Signature JSON Serialization (JWS-JS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jwe_js.html">JSON Web Encryption JSON Serialization (JWE-JS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jose_usecase.html">Use Cases and Requirements for JSON Object Signing and Encryption (JOSE)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hostmeta.html">Web Host Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="webfinger.html">WebFinger</a></li>
<li class="toctree-l1"><a class="reference internal" href="swd.html">Simple Web Discovery (SWD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="acct.html">The &#8216;acct&#8217; URI Scheme</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">RFC3394:Advanced Encryption Standard (AES) Key Wrap Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="nist-sp-800-59a.html">NIST SP 800-56A:Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="nist-sp-800-63.html">Electronic Authentication Guideline</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="backplane.html">Backplane</a></li>
<li class="toctree-l1"><a class="reference internal" href="backplane.html#backplane-2-0">Backplane 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="lrdd.html">LRDD: Link-based Resource Descriptor Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="revoke.html">Token Revocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="poco.html">Portable Contacts 1.0 Draft C</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Terms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="saml.html">SAML</a></li>
<li class="toctree-l1"><a class="reference internal" href="xacml.html">XACML</a></li>
<li class="toctree-l1"><a class="reference internal" href="shibboleth.html">Shibboleth</a></li>
<li class="toctree-l1"><a class="reference internal" href="SamlHokProfile.html">SAML V2.0 Holder-of-Key Assertion Profile Version 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="SamlHokWebSsoProfile.html">SAML V2.0 Holder-of-Key Web Browser SSO Profile Version 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="wss_saml_token_profile.html">Web Services Security SAML Token Profile Version 1.1.1</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scim_rest.html">Simple Cloud Identity Management: Protocol 1.0 (REST API 1.0)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="active_directory.html">Active Directory &amp; Connect</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO/TBD</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource.html">Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion.html">Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="signed_nonce.html">Decoupling Identity and Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="adtech.html">AdTech</a></li>
<li class="toctree-l1"><a class="reference internal" href="technight_9.html">Technight #9</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="well-known.html">RFC5783: Defining Well-Known Uniform Resource Identifiers (URIs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rfc5988.html">RFC5988:Web Linking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="impl_id_token.html">ID Token:Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="impl_jws.html">JOSE JWS:Implementation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">RFC3394:Advanced Encryption Standard (AES) Key Wrap Algorithm</a><ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#introduction">1. Introduction</a></li>
<li><a class="reference internal" href="#overview">2. Overview</a><ul>
<li><a class="reference internal" href="#notation-and-definitions">2.1 Notation and Definitions</a></li>
<li><a class="reference internal" href="#algorithms">2.2 Algorithms</a><ul>
<li><a class="reference internal" href="#key-wrap">2.2.1 Key Wrap</a></li>
<li><a class="reference internal" href="#key-unwrap">2.2.2 Key Unwrap</a></li>
<li><a class="reference internal" href="#key-data-integrity-the-initial-value">2.2.3 Key Data Integrity &#8211; the Initial Value</a><ul>
<li><a class="reference internal" href="#default-initial-value">2.2.3.1 Default Initial Value</a></li>
<li><a class="reference internal" href="#alternative-initial-values">2.2.3.2 Alternative Initial Values</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li><a href="acct.html"
         title="Previous Chapter: The ‘acct’ URI Scheme">&laquo; The ‘acct’ URI S...</a></li>
  <li><a href="nist-sp-800-59a.html"
         title="Next Chapter: NIST SP 800-56A:Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography">NIST SP 800-56A:... &raquo;</a></li>
              
            
            
            
            
              <li>
<div id="sourcelink">
  <a href="sources/rfc3394.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="rfc3394-advanced-encryption-standard-aes-key-wrap-algorithm">
<span id="rfc3394-head"></span><h1>RFC3394:Advanced Encryption Standard (AES) Key Wrap Algorithm<a class="headerlink" href="#rfc3394-advanced-encryption-standard-aes-key-wrap-algorithm" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3394.html"><strong>RFC 3394</strong></a></li>
</ul>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id1">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id2">1. Introduction</a></li>
<li><a class="reference internal" href="#overview" id="id3">2. Overview</a><ul>
<li><a class="reference internal" href="#notation-and-definitions" id="id4">2.1 Notation and Definitions</a></li>
<li><a class="reference internal" href="#algorithms" id="id5">2.2 Algorithms</a><ul>
<li><a class="reference internal" href="#key-wrap" id="id6">2.2.1 Key Wrap</a></li>
<li><a class="reference internal" href="#key-unwrap" id="id7">2.2.2 Key Unwrap</a></li>
<li><a class="reference internal" href="#key-data-integrity-the-initial-value" id="id8">2.2.3 Key Data Integrity &#8211; the Initial Value</a><ul>
<li><a class="reference internal" href="#default-initial-value" id="id9">2.2.3.1 Default Initial Value</a></li>
<li><a class="reference internal" href="#alternative-initial-values" id="id10">2.2.3.2 Alternative Initial Values</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="abstract">
<span id="rfc3394-abstract"></span><h2><a class="toc-backref" href="#id1">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>The purpose of this document is to make
the Advanced Encryption Standard (AES) Key Wrap algorithm
conveniently available to the Internet community.</p>
<p>The United States of America has adopted AES
as the new encryption standard.</p>
<p>The AES Key Wrap algorithm will probably
be adopted by the USA for encryption of AES keys.</p>
<p>The authors took most of the text
in this document from the draft AES Key Wrap posted by NIST.</p>
</div>
<div class="section" id="introduction">
<span id="rfc3394-1"></span><h2><a class="toc-backref" href="#id2">1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>NOTE: Most of the following text is taken from <em class="xref std std-term">[AES-WRAP]</em>,
and the assertions regarding the security of the AES Key Wrap algorithm
are made by the US Government,
not by the authors of this document.</p>
<p>This specification is intended to satisfy
the National Institute of Standards and Technology (<em class="xref std std-ref">NIST</em>)
Key Wrap requirement to:
Design a cryptographic algorithm called a Key Wrap
that uses the Advanced Encryption Standard (AES)
as a primitive to securely encrypt plaintext key(s)
with any associated integrity information and data,
such that the combination could be longer than
the width of the AES block size (128-bits).</p>
<p>Each ciphertext bit should be a highly non-linear function
of each plaintext bit,
and (when unwrapping) each plaintext bit should be
a highly non-linear function of each ciphertext bit.</p>
<p>It is sufficient to approximate
an <strong>ideal pseudorandom permutation</strong> to the degree
that exploitation of undesirable phenomena is as unlikely
as guessing the AES engine key.</p>
<p>This key wrap algorithm needs to provide
ample security to protect keys in the context of prudently
designed key management architecture.</p>
<p>Throughout this document,
any data being wrapped will be referred to as the key data.</p>
<p>It makes no difference to the algorithm
whether the data being wrapped is a key;
in fact there is often good reason to include other data with the key,
to wrap multiple keys together, or
to wrap data that isn&#8217;t strictly a key.</p>
<p>So,
the term &#8220;key data&#8221; is used broadly to mean any data being wrapped,
but particularly keys,
since this is primarily a key wrap algorithm.</p>
<p>The key used to do the wrapping will be referred to
as the <em class="xref std std-term">key-encryption key</em> (<em class="xref std std-term">KEK</em>).</p>
<p>In this document a KEK can be any valid key
supported by the AES codebook.</p>
<p>That is, a KEK can be
a 128-bit key, a 192-bit key, or a 256-bit key.</p>
</div>
<div class="section" id="overview">
<span id="rfc3394-2"></span><h2><a class="toc-backref" href="#id3">2. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The AES key wrap algorithm is designed to wrap or encrypt key data.</p>
<p>The key wrap operates on blocks of 64 bits.</p>
<p>Before being wrapped,
the key data is parsed into n blocks of 64 bits.</p>
<p>The only restriction the key wrap algorithm places
on <strong>n</strong> is that <strong>n</strong> be at least two.</p>
<p>(For key data with length less than or
equal to 64 bits,
the constant field used in this specification and
the key data form a single 128-bit codebook input
making this key wrap unnecessary.)</p>
<p>The key wrap algorithm accommodates all supported AES key sizes.</p>
<p>However,
other cryptographic values often need to be wrapped.</p>
<p>One such value is the seed of the random number generator for DSS.</p>
<p>This seed value requires <strong>n</strong> to be greater than four.</p>
<p>Undoubtedly other values require this type of protection.
Therefore,
no upper bound is imposed on <strong>n</strong>.</p>
<p>The AES key wrap can be configured
to use any of the three key sizes supported by the AES codebook.</p>
<p>The choice of a key size affects the overall security
provided by the key wrap,
but it does not alter the description of the key wrap algorithm.</p>
<p>Therefore,
in the description that follows,
the key wrap is described generically;
no key size is specified for the KEK.</p>
<div class="section" id="notation-and-definitions">
<span id="rfc3394-2-1"></span><h3><a class="toc-backref" href="#id4">2.1 Notation and Definitions</a><a class="headerlink" href="#notation-and-definitions" title="Permalink to this headline">¶</a></h3>
<p>The following notation is used in the description of
the key wrapping algorithms:</p>
<div class="highlight-python"><pre>AES(K, W)     Encrypt W using the AES codebook with key K
AES-1(K, W)   Decrypt W using the AES codebook with key K
MSB(j, W)     Return the most significant j bits of W
LSB(j, W)     Return the least significant j bits of W
B1 ^ B2       The bitwise exclusive or (XOR) of B1 and B2
B1 | B2       Concatenate B1 and B2
K             The key-encryption key K
n             The number of 64-bit key data blocks
s             The number of steps in the wrapping process, s = 6n
P[i]          The ith plaintext key data block
C[i]          The ith ciphertext data block
A             The 64-bit integrity check register
R[i]          An array of 64-bit registers where i = 0, 1, 2, ..., n

A[t], R[i][t] The contents of registers A and R[i] after encryption step t.

IV            The 64-bit initial value used during the wrapping process.</pre>
</div>
<p>In the key wrap algorithm, the concatenation function will be used to
concatenate 64-bit quantities to form the 128-bit input to the AES
codebook.  The extraction functions will be used to split the 128-bit
output from the AES codebook into two 64-bit quantities.</p>
</div>
<div class="section" id="algorithms">
<span id="rfc3394-2-2"></span><h3><a class="toc-backref" href="#id5">2.2 Algorithms</a><a class="headerlink" href="#algorithms" title="Permalink to this headline">¶</a></h3>
<p>The specification of the key wrap algorithm requires
the use of the AES codebook [AES].</p>
<p>The next three sections will describe
the <a class="reference internal" href="#rfc3394-2-2-1"><em>key wrap algorithm</em></a>,
the <a class="reference internal" href="#rfc3394-2-2-2"><em>key unwrap algorithm</em></a>, and
the <a class="reference internal" href="#rfc3394-2-2-3"><em>inherent data integrity check</em></a>.</p>
<div class="section" id="key-wrap">
<span id="rfc3394-2-2-1"></span><h4><a class="toc-backref" href="#id6">2.2.1 Key Wrap</a><a class="headerlink" href="#key-wrap" title="Permalink to this headline">¶</a></h4>
<p>The inputs to the key wrapping process are
the KEK and the plaintext to be wrapped.</p>
<p>The plaintext consists of n 64-bit blocks,
containing the key data being wrapped.</p>
<p>The key wrapping process is described below.</p>
<dl class="docutils">
<dt>Inputs:      Plaintext, n 64-bit values {P1, P2, ..., Pn}, and</dt>
<dd>Key, K (the KEK).</dd>
</dl>
<p>Outputs:     Ciphertext, (n+1) 64-bit values {C0, C1, ..., Cn}.</p>
<ol class="arabic">
<li><p class="first">Initialize variables.</p>
<blockquote>
<div><p>Set A0 to an initial value (see <a class="reference internal" href="#rfc3394-2-2-3"><em>2.2.3</em></a>)</p>
</div></blockquote>
</li>
</ol>
<div class="highlight-python"><pre>For i = 1 to n
     R[0][i] = P[i]</pre>
</div>
<ol class="arabic simple" start="2">
<li>Calculate intermediate values.</li>
</ol>
<div class="highlight-python"><pre>For t = 1 to s, where s = 6n
    A[t] = MSB(64, AES(K, A[t-1] | R[t-1][1])) ^ t
    For i = 1 to n-1
        R[t][i] = R[t-1][i+1]
    R[t][n] = LSB(64, AES(K, A[t-1] | R[t-1][1]))</pre>
</div>
<ol class="arabic simple" start="3">
<li>Output the results.</li>
</ol>
<div class="highlight-python"><pre>Set C[0] = A[t]
For i = 1 to n
    C[i] = R[t][i]</pre>
</div>
<p>An alternative description of the key wrap algorithm involves
indexing rather than shifting.</p>
<p>This approach allows one to calculate the wrapped key in place,
avoiding the rotation in the previous description.</p>
<p>This produces identical results and is more easily
implemented in software.</p>
<dl class="docutils">
<dt>Inputs:  Plaintext, n 64-bit values {P1, P2, ..., Pn}, and</dt>
<dd>Key, K (the KEK).</dd>
</dl>
<p>Outputs: Ciphertext, (n+1) 64-bit values {C0, C1, ..., Cn}.</p>
<ol class="arabic simple">
<li>Initialize variables.</li>
</ol>
<div class="highlight-python"><pre>Set A = IV, an initial value (see 2.2.3)
For i = 1 to n
    R[i] = P[i]</pre>
</div>
<ol class="arabic simple" start="2">
<li>Calculate intermediate values.</li>
</ol>
<div class="highlight-python"><pre>For j = 0 to 5
    For i=1 to n
        B = AES(K, A | R[i])
        A = MSB(64, B) ^ t where t = (n*j)+i
        R[i] = LSB(64, B)</pre>
</div>
<ol class="arabic simple" start="3">
<li>Output the results.</li>
</ol>
<div class="highlight-python"><pre>Set C[0] = A
For i = 1 to n
    C[i] = R[i]</pre>
</div>
</div>
<div class="section" id="key-unwrap">
<span id="rfc3394-2-2-2"></span><h4><a class="toc-backref" href="#id7">2.2.2 Key Unwrap</a><a class="headerlink" href="#key-unwrap" title="Permalink to this headline">¶</a></h4>
<p>The inputs to the unwrap process are
the KEK and (n+1) 64-bit blocks of ciphertext
consisting of previously wrapped key.</p>
<p>It returns <strong>n blocks</strong> of plaintext
consisting of the <strong>n 64-bit blocks</strong> of the decrypted key data.</p>
<dl class="docutils">
<dt>Inputs:  Ciphertext, (n+1) 64-bit values {C0, C1, ..., Cn}, and</dt>
<dd>Key, K (the KEK).</dd>
</dl>
<p>Outputs: Plaintext, n 64-bit values {P1, P2, ..., Pn}.</p>
<ol class="arabic simple">
<li>Initialize variables.</li>
</ol>
<div class="highlight-python"><pre>Set A[s] = C[0] where s = 6n
For i = 1 to n
    R[s][i] = C[i]</pre>
</div>
<ol class="arabic simple" start="2">
<li>Calculate the intermediate values.</li>
</ol>
<div class="highlight-python"><pre>For t = s to 1
    A[t-1] = MSB(64, AES-1(K, ((A[t] ^ t) | R[t][n]))
    R[t-1][1] = LSB(64, AES-1(K, ((A[t]^t) | R[t][n]))
    For i = 2 to n
        R[t-1][i] = R[t][i-1]</pre>
</div>
<ol class="arabic simple" start="3">
<li>Output the results.</li>
</ol>
<div class="highlight-python"><pre>If A[0] is an appropriate initial value (see 2.2.3),

Then
    For i = 1 to n
        P[i] = R[0][i]
Else
    Return an error</pre>
</div>
<p>The unwrap algorithm can also be specified
as an index based operation,
allowing the calculations to be carried out in place.</p>
<p>Again,
this produces the same results as the register shifting approach.</p>
<dl class="docutils">
<dt>Inputs:  Ciphertext, (n+1) 64-bit values {C0, C1, ..., Cn}, and</dt>
<dd>Key, K (the KEK).</dd>
</dl>
<p>Outputs: Plaintext, n 64-bit values {P0, P1, K, Pn}.</p>
<ol class="arabic simple">
<li>Initialize variables.</li>
</ol>
<div class="highlight-python"><pre>Set A = C[0]
For i = 1 to n
    R[i] = C[i]</pre>
</div>
<ol class="arabic simple" start="2">
<li>Compute intermediate values.</li>
</ol>
<div class="highlight-python"><pre>For j = 5 to 0
    For i = n to 1
        B = AES-1(K, (A ^ t) | R[i]) where t = n*j+i
        A = MSB(64, B)
        R[i] = LSB(64, B)</pre>
</div>
<ol class="arabic simple" start="3">
<li>Output results.</li>
</ol>
<div class="highlight-python"><pre>If A is an appropriate initial value (see 2.2.3),
Then
    For i = 1 to n
        P[i] = R[i]
Else
    Return an error</pre>
</div>
</div>
<div class="section" id="key-data-integrity-the-initial-value">
<span id="rfc3394-2-2-3"></span><h4><a class="toc-backref" href="#id8">2.2.3 Key Data Integrity &#8211; the Initial Value</a><a class="headerlink" href="#key-data-integrity-the-initial-value" title="Permalink to this headline">¶</a></h4>
<p>The initial value (IV) refers to
the value assigned to <strong>A[0]</strong>
in the first step of the wrapping process.</p>
<p>This value is used to obtain
an integrity check on the key data.</p>
<p>In the final step of the unwrapping process,
the recovered value of A[0] is compared
to the expected value of A[0].</p>
<p>If there is a match,
the key is accepted as valid,
and the unwrapping algorithm returns it.</p>
<p>If there is not a match,
then the key is rejected,
and the unwrapping algorithm returns an error.</p>
<p>The exact properties achieved
by this integrity check depend
on the definition of the initial value.</p>
<p>Different applications may call for
somewhat different properties;
for example,
whether there is need to determine
the integrity of key data
throughout its lifecycle or just when it is unwrapped.</p>
<p>This specification defines a default initial value
that supports integrity of the key data
during the period it is wrapped (<a class="reference internal" href="#rfc3394-2-2-3-1"><em>2.2.3.1</em></a>).</p>
<p>Provision is also made to support
alternative initial values (in <a class="reference internal" href="#rfc3394-2-2-3-1"><em>2.2.3.2</em></a>).</p>
<div class="section" id="default-initial-value">
<span id="rfc3394-2-2-3-1"></span><h5><a class="toc-backref" href="#id9">2.2.3.1 Default Initial Value</a><a class="headerlink" href="#default-initial-value" title="Permalink to this headline">¶</a></h5>
<p>The default initial value (IV) is defined to be the hexadecimal
constant:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">IV</span> <span class="o">=</span> <span class="n">A6A6A6A6A6A6A6A6</span>
</pre></div>
</div>
<p>The use of a constant as the IV supports
a strong integrity check on the key data
during the period that it is wrapped.</p>
<p>If unwrapping produces A[0] = A6A6A6A6A6A6A6A6,
then the chance that the key data is corrupt is 2^-64.</p>
<p>If unwrapping produces A[0] any other value,
then the unwrap must return an error
and not return any key data.</p>
</div>
<div class="section" id="alternative-initial-values">
<span id="rfc3394-2-2-3-2"></span><h5><a class="toc-backref" href="#id10">2.2.3.2 Alternative Initial Values</a><a class="headerlink" href="#alternative-initial-values" title="Permalink to this headline">¶</a></h5>
<p>When the key wrap is used
as part of a larger key management protocol or system,
the desired scope for data integrity
may be more than just the key data
or the desired duration for more than just the period
that it is wrapped.</p>
<p>Also,
if the key data is not just an AES key,
it may not always be a multiple of 64 bits.</p>
<p>Alternative definitions of the initial value
can be used to address such problems.</p>
<p>NIST will define alternative initial values
in future key management publications as needed.</p>
<p>In order to accommodate a set of alternatives
that may evolve over time,
key wrap implementations that are not application-specific
will require some flexibility in the way
that the initial value is set and tested.</p>
</div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
  <h2>HDKNR.COM</h2>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011, HDKNR.COM.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.<br/>
    </p>
  </div>
</footer>

  </body>
</html>