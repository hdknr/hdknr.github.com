

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>15.5.3. Redirect URI Fragment Handling Implementation Notes &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    <link rel="stylesheet" href="../static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>identity 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>15.5.3. Redirect URI Fragment Handling Implementation Notes</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="redirect-uri-fragment-handling-implementation-notes">
<h1>15.5.3.  Redirect URI Fragment Handling Implementation Notes<a class="headerlink" href="#redirect-uri-fragment-handling-implementation-notes" title="Permalink to this headline">Â¶</a></h1>
<p>When response parameters are returned
in the Redirection URI <a class="reference internal" href="../glossary.html#term-fragment"><em class="xref std std-term">fragment</em></a> value,
the Client needs to have the User Agent parse the fragment encoded values
and pass them to on to the Client&#8217;s processing logic for consumption.</p>
<p>User Agents that have direct access to cryptographic APIs
may be able to be self-contained, for instance,
with all Client code being written in JavaScript.</p>
<p>However,
if the Client does not run entirely in the User Agent,
one way to achieve this is to post them
to a Web Server Client for validation.</p>
<p>The following is an example of a JavaScript file
that a Client might host at its <a class="reference internal" href="../messages.html#term-63"><em class="xref std std-term">redirect_uri</em></a>.</p>
<p>This is loaded by the redirect from the Authorization Server.
The <em class="xref std std-term">fragment component</em> is parsed and
then sent by POST to a URI that will validate
and use the information received.</p>
<p>Following is a non-normative example of a Redirect URI response:</p>
<div class="highlight-python"><pre>GET /cb HTTP/1.1
Host: client.example.org

HTTP/1.1 200 OK
Content-Type: text/html

&lt;script type="text/javascript"&gt;

// First, parse the query string
var params = {}, postBody = location.hash.substring(1),
    regex = /([^&amp;=]+)=([^&amp;]*)/g, m;
while (m = regex.exec(postBody)) {
  params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
}

// And send the token over to the server
var req = new XMLHttpRequest();
// using POST so query isn't logged
req.open('POST', 'https://' + window.location.host +
                 '/catch_response', true);
req.setRequestHeader('Content-Type',
                     'application/x-www-form-urlencoded');

req.onreadystatechange = function (e) {
  if (req.readyState == 4) {
    if (req.status == 200) {
// If the response from the POST is 200 OK, perform a redirect
      window.location = 'https://'
        + window.location.host + '/redirect_after_login'
    }
// if the OAuth response is invalid, generate an error message
    else if (req.status == 400) {
      alert('There was an error processing the token')
    } else {
      alert('Something other than 200 was returned')
    }
  }
};
req.send(postBody);</pre>
</div>
<p>(draft17)</p>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, HDKNR.COM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>