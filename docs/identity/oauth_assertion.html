

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Assertion Framework for OAuth 2.0 &mdash; identity 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <link rel="stylesheet" href="static/openid.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="identity 1.0 documentation" href="index.html" />
    <link rel="next" title="OAuth 2.0 Multiple Response Type Encoding Practices" href="oauth_responses.html" />
    <link rel="prev" title="SAML 2.0 Bearer Assertion Profiles for OAuth 2.0" href="oauth_saml2_bearer.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>identity 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>Assertion Framework for OAuth 2.0</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="oauth_saml2_bearer.html">SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="oauth_responses.html">OAuth 2.0 Multiple Response Type Encoding Practices</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="assertion-framework-for-oauth-2-0">
<h1>Assertion Framework for OAuth 2.0<a class="headerlink" href="#assertion-framework-for-oauth-2-0" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id3">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id4">1.  Introduction</a></li>
<li><a class="reference internal" href="#overview" id="id5">2.  Overview</a></li>
<li><a class="reference internal" href="#framework" id="id6">3.  Framework</a><ul>
<li><a class="reference internal" href="#third-party-created-assertion" id="id7">Third Party Created Assertion</a></li>
<li><a class="reference internal" href="#self-issued-assertion" id="id8">Self-Issued Assertion</a></li>
<li><a class="reference internal" href="#assertion-types-bearer-hok" id="id9">Assertion Types(Bearer/HoK)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transporting-assertions" id="id10">4.  Transporting Assertions</a><ul>
<li><a class="reference internal" href="#using-assertions-for-client-authentication" id="id11">4.1.  Using Assertions for Client Authentication</a></li>
<li><a class="reference internal" href="#using-assertions-as-authorization-grants" id="id12">4.2.  Using Assertions as Authorization Grants</a></li>
</ul>
</li>
<li><a class="reference internal" href="#assertion-content-and-processing" id="id13">5.  Assertion Content and Processing</a><ul>
<li><a class="reference internal" href="#assertion-metamodel" id="id14">5.1.  Assertion Metamodel</a></li>
<li><a class="reference internal" href="#general-assertion-format-and-processing-rules" id="id15">5.2.  General Assertion Format and Processing Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specific-assertion-format-and-processing-rules" id="id16">6.  Specific Assertion Format and Processing Rules</a><ul>
<li><a class="reference internal" href="#client-authentication" id="id17">6.1.  Client authentication</a></li>
<li><a class="reference internal" href="#client-acting-on-behalf-of-itself" id="id18">6.2.  Client acting on behalf of itself</a></li>
<li><a class="reference internal" href="#client-acting-on-behalf-of-a-user" id="id19">6.3.  Client acting on behalf of a user</a></li>
<li><a class="reference internal" href="#client-acting-on-behalf-of-an-anonymous-user" id="id20">6.4.  Client acting on behalf of an anonymous user</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-responses" id="id21">7.  Error Responses</a></li>
<li><a class="reference internal" href="#security-considerations" id="id22">8.  Security Considerations</a></li>
<li><a class="reference internal" href="#iana-considerations" id="id23">9.  IANA Considerations</a><ul>
<li><a class="reference internal" href="#parameter-registration-request" id="id24">9.1.  Parameter Registration Request</a></li>
<li><a class="reference internal" href="#oauth-assertion-9-2" id="id25">9.2.  Parameter Registration Request</a></li>
<li><a class="reference internal" href="#oauth-assertion-9-3" id="id26">9.3.  Parameter Registration Request</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgements" id="id27">10.  Acknowledgements</a></li>
<li><a class="reference internal" href="#normative-references" id="id28">11.  Normative References</a></li>
</ul>
</div>
<p><a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-assertions-09">http://tools.ietf.org/html/draft-ietf-oauth-assertions-09</a></p>
<div class="section" id="abstract">
<span id="oauth-assertion-abstract"></span><h2><a class="toc-backref" href="#id3">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>This specification provides a framework for the use of assertions
with OAuth 2.0 in the form of a new client authentication mechanism
and a new authorization grant type.
Mechanisms are specified for
transporting assertions during interactions with a token endpoint, as
well as general processing rules.</p>
<p>The intent of this specification is to provide a common framework for
OAuth 2.0 to interwork with other identity systems using assertions,
and to provide alternative client authentication mechanisms.</p>
<p>Note that this specification only defines abstract message flows and
processing rules.  In order to be implementable, companion
specifications are necessary to provide the corresponding concrete
instantiations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Abstract message flow and assertion content for</p>
<blockquote>
<div><ul class="simple">
<li><em class="xref std std-term">client credeintial</em></li>
<li><em class="xref std std-term">authorization grant</em></li>
</ul>
</div></blockquote>
<p>Token in OAuth can be in two type of generic format (&#8220;<a class="reference internal" href="oauth_threat.html#oauth-threat-3-1"><em>3.1.  Tokens</em></a> &#8221;):</p>
<blockquote class="last">
<div><ul class="simple">
<li>Handle - &#8220;artifact&#8221;</li>
<li>Assertion - &#8220;self-contained token&#8221;</li>
</ul>
</div></blockquote>
</div>
<p>(draft 09)</p>
</div>
<div class="section" id="introduction">
<span id="oauth-assertion-1"></span><h2><a class="toc-backref" href="#id4">1.  Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>OAuth 2.0 <a class="reference internal" href="oauth_saml2_bearer.html#term-rfc6749"><em class="xref std std-term">[RFC6749]</em></a> is an authorization framework that enables a
third-party application to obtain limited access to a protected HTTP resource.
In OAuth,
those third-party applications are called <a class="reference internal" href="uma_core.html#term-clients"><em class="xref std std-term">clients</em></a>;
they access <a class="reference internal" href="glossary.html#term-protected-resources"><em class="xref std std-term">protected resources</em></a>
by presenting an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a> to the HTTP resource.
Access tokens are issued to clients by
an <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> with the (sometimes implicit) approval of the
<a class="reference internal" href="uma_core.html#term-resource-owner"><em class="xref std std-term">resource owner</em></a>.
These access tokens are typically obtained by
exchanging an <em class="xref std std-term">authorization grant</em>,
which represents the authorization granted by the resource owner
(or by a privileged administrator).
Several authorization grant types are defined to support a wide range
of <em class="xref std std-term">client types</em> and <em class="xref std std-term">user experiences</em>.
OAuth also provides an extensibility mechanism
for defining additional <a class="reference internal" href="oauth.html#term-grant-types"><em class="xref std std-term">grant types</em></a>,
which can serve as a bridge between OAuth and other protocol frameworks.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Grant Typeを追加することで、他のプロトコルフレームワークにブリッジできる。</li>
</ul>
</div>
<p>This specification provides a general framework
for the use of <em class="xref std std-term">assertions</em> as <em class="xref std std-term">authorization grants</em> with OAuth 2.0.
It also provides a framework for assertions to be used for <a class="reference internal" href="glossary.html#term-client-authentication"><em class="xref std std-term">client authentication</em></a>.
It provides generic mechanisms for transporting assertions during
interactions with an authorization server&#8217;s token endpoint,
as well as general rules for the content and processing of those assertions.
The intent is to provide an alternative client authentication
mechanism (one that doesn&#8217;t send client secrets),
as well as to facilitate the use of OAuth 2.0 in client-server integration scenarios,
where the end-user may not be present.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OAuth 2.0 でアサーションを認可交付(認可証?)として使う為のフレームワーク</li>
<li>また、クライアント認証でアサーションを使う時のフレームワーク</li>
</ul>
</div>
<p>This specification only defines abstract message flows and processing rules.
In order to be implementable,
companion specifications are necessary to provide the corresponding concrete instantiations.
For instance,
<strong>SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</strong> <em class="xref std std-term">[I-D.ietf-oauth-saml2-bearer]</em>
defines a concrete instantiation for SAML 2.0 tokens
and JSON Web Token (JWT) Bearer Token Profiles for OAuth 2.0 <em class="xref std std-term">[I-D.ietf-oauth-jwt-bearer]</em>
defines a concrete instantiation for JWT tokens.</p>
<p>Note: The use of <em class="xref std std-term">assertions</em> for <a class="reference internal" href="glossary.html#term-client-authentication"><em class="xref std std-term">client authentication</em></a> is orthogonal
to and separable from using assertions as an authorization grant.
They can be used either in combination or separately.
Client assertion authentication is nothing more than an alternative way for
a client to authenticate to the token endpoint and must be used in
conjunction with some grant type to form a complete and meaningful
protocol request.  Assertion authorization grants may be used with or
without client authentication or identification.  Whether or not
client authentication is needed in conjunction with an assertion
authorization grant, as well as the supported types of client
authentication, are policy decisions at the discretion of the
authorization server.</p>
<p>( <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-assertions-09#section-1">http://tools.ietf.org/html/draft-ietf-oauth-assertions-09#section-1</a> )</p>
</div>
<div class="section" id="overview">
<span id="oauth-assertion-2"></span><h2><a class="toc-backref" href="#id5">2.  Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Assertions in this spec are for:</p>
<blockquote>
<div><ul class="simple">
<li><em class="xref std std-term">clent credential</em> ( for 3rd party <strong>authentication</strong> )</li>
<li><em class="xref std std-term">authorization grant</em></li>
</ul>
</div></blockquote>
<p>Definitions are for:</p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>abstract message flow</strong>  ( <a class="reference internal" href="#oauth-assertion-4"><em>4.  Transporting Assertions</em></a> )</li>
<li><strong>assertion content</strong>  ( <a class="reference internal" href="#oauth-assertion-5"><em>5.  Assertion Content and Processing</em></a> )</li>
</ul>
</div></blockquote>
</div>
<p>The <a class="reference internal" href="oauth.html"><em>OAuth 2.0 Authorization Protocol [I-D.ietf.oauth-v2]</em></a> provides
a method for making authenticated HTTP requests
to a resource using an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a>.
Access tokens are issued to clients by an <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>
with the (sometimes implicit) approval of the <a class="reference internal" href="uma_core.html#term-resource-owner"><em class="xref std std-term">resource owner</em></a>.
These access tokens are typically obtained
by exchanging an <em class="xref std std-term">authorization grant</em>
representing authorization by the resource owner or privileged administrator.
Several authorization <a class="reference internal" href="oauth.html#term-grant-types"><em class="xref std std-term">grant types</em></a> are defined
to support a wide range of <em class="xref std std-term">client types</em>
and user experiences.
OAuth also allows for the definition of new extension grant types
to support additional clients or to provide a bridge between OAuth and other trust frameworks.
Finally, OAuth allows the definition of additional authentication mechanisms
to be used by clients when interacting with the authorization server.</p>
<p>In scenarios where security is at a premium one wants
to avoid sending secrets across the Internet,
even on encrypted connections.
Instead one wants to send values derived from the secret
that prove to the receiver that the sender is in possession of the secret
without actually sending the secret.
Typically the way derived values are created is by generating an assertion
that is then either HMAC&#8217;ed or digitally signed using an agreed upon secret.
By validating the <a class="reference internal" href="glossary.html#term-hmac"><em class="xref std std-term">HMAC</em></a> or <em class="xref std std-term">digital signature</em> on the <a class="reference internal" href="#term-assertion"><em class="xref std std-term">assertion</em></a>,
the receiver can prove to themselves that the entity
that generated the assertion was in possession of the secret without actually communicating the secret directly.</p>
<p>This specification provides a general framework for the use of assertions
as <a class="reference internal" href="glossary.html#term-client-credentials"><em class="xref std std-term">client credentials</em></a> and/or <em class="xref std std-term">authorization grants</em> with OAuth 2.0.
It includes a generic mechanism for transporting assertions during interactions with a token endpoint,
as wells as rules for the content and processing of those assertions.
The intent is to provide an enhanced security profile
by using derived values such as signatures or HMACs,
as well as facilitate the use of OAuth 2.0 in client-server integration scenarios
where the end-user may not be present.</p>
<p>This specification only defines <strong>abstract message flow</strong> and <strong>assertion content</strong>.
Actual use requires implementation of a companion protocol binding specification.
Additional profile documents provide standard representations in formats such as <em class="xref std std-term">SAML</em> and <a class="reference internal" href="standard.html#term-jwt"><em class="xref std std-term">JWT</em></a>.</p>
</div>
<div class="section" id="framework">
<span id="oauth-assertion-3"></span><h2><a class="toc-backref" href="#id6">3.  Framework</a><a class="headerlink" href="#framework" title="Permalink to this headline">¶</a></h2>
<p>An assertion is a package of information that allows identity and
security information to be shared across security domains.  An
assertion typically contains information about a subject or
principal, information about the party that issued the assertion and
when was it issued, as well as the conditions under which the
assertion is to be considered valid, such as when and where it can be
used.</p>
<p>The entity that creates and signs the assertion is typically known as
the &#8220;Issuer&#8221; and the entity that consumes the assertion and relies on
its information is typically known as the &#8220;Relying Party&#8221;.  In the
context of this document, the authorization server acts as a relying
party.</p>
<p>Assertions used in the protocol exchanges defined by this
specification MUST always be protected against tampering using a
digital signature or a keyed message digest applied by the issuer.
An assertion MAY additionally be encrypted, preventing unauthorized
parties from inspecting the content.</p>
<p>Although this document does not define the processes by which the
client obtains the assertion (prior to sending it to the
authorization server), there are two common patterns described below.</p>
<div class="section" id="third-party-created-assertion">
<h3><a class="toc-backref" href="#id7">Third Party Created Assertion</a><a class="headerlink" href="#third-party-created-assertion" title="Permalink to this headline">¶</a></h3>
<p>In the first pattern, depicted in Figure 1,
the client obtains an assertion from a third party entity capable of issuing,
renewing, transforming, and validating security tokens.
Typically such an entity is known as a &#8220;<em class="xref std std-term">Security Token Service</em>&#8221; (<em class="xref std std-term">STS</em>) or
just &#8220;<em class="xref std std-term">Token Service</em>&#8221; and a trust relationship
(usually manifested in the exchange of some kind of key material)
exists between the token service and the relying party.
The token service is the assertion issuer; its role is
to fulfill requests from clients,
which present various credentials,
and mint assertions as requested, fill them with appropriate information,
and sign them.</p>
<p>WS-Trust [OASIS.WS-Trust] is one available standard
for requesting security tokens (assertions).</p>
<div class="highlight-python"><pre>Relying
Party                     Client                   Token Service
|                          |                         |
|                          |  1) Request Assertion   |
|                          |------------------------&gt;|
|                          |                         |
|                          |  2) Assertion           |
|                          |&lt;------------------------|
|    3) Assertion          |                         |
|&lt;-------------------------|                         |
|                          |                         |
|    4) OK or Failure      |                         |
|-------------------------&gt;|                         |
|                          |                         |
|                          |                         |</pre>
</div>
<p>Figure 1: Third Party Created Assertion</p>
</div>
<div class="section" id="self-issued-assertion">
<h3><a class="toc-backref" href="#id8">Self-Issued Assertion</a><a class="headerlink" href="#self-issued-assertion" title="Permalink to this headline">¶</a></h3>
<p>In the second pattern,
depicted in Figure 2,
the client creates assertions locally.
To sign the assertions,
it has to obtain key material:
either symmetric keys or asymmetric key pairs.
The mechanisms for obtaining this key material are beyond the scope of
this specification.</p>
<p>Although assertions are usually used to convey identity and security information,
self-issued assertions can also serve a different purpose.
They can be used to demonstrate knowledge of some secret,
such as a client secret, without actually communicating the secret
directly in the transaction.  In that case, additional information
included in the assertion by the client itself will be of limited
value to the relying party and, for this reason, only a bare minimum
of information is typically included in such an assertion, such as
information about issuing and usage conditions.</p>
<div class="highlight-python"><pre>Relying
Party                     Client
|                          |
|                          | 1) Create
|                          |    Assertion
|                          |--------------+
|                          |              |
|                          | 2) Assertion |
|                          |&lt;-------------+
|    3) Assertion          |
|&lt;-------------------------|
|                          |
|    4) OK or Failure      |
|-------------------------&gt;|
|                          |
|                          |</pre>
</div>
<p>Figure 2: Self-Issued Assertion</p>
<p>Deployments need to determine the appropriate variant to use based on
the required level of security, the trust relationship between the
entities, and other factors.</p>
</div>
<div class="section" id="assertion-types-bearer-hok">
<h3><a class="toc-backref" href="#id9">Assertion Types(Bearer/HoK)</a><a class="headerlink" href="#assertion-types-bearer-hok" title="Permalink to this headline">¶</a></h3>
<p>From the perspective of what must be done by the entity presenting
the assertion, there are two general types of assertions:</p>
<p>1.  <em class="xref std std-term">Bearer Assertions</em>: Any entity in possession of a bearer assertion
(e.g. the bearer) can use it to get access to the associated
resources (without demonstrating possession of a cryptographic
key).  To prevent misuse, bearer assertions need to be protected
from disclosure in storage and in transport.  A secure
communication channel is required between all entities to avoid
leaking the assertion to unauthorized parties.</p>
<p>2.  <a class="reference internal" href="glossary.html#term-holder-of-key-assertions"><em class="xref std std-term">Holder-of-Key Assertions</em></a>: To access the associated resources, the
entity presenting the assertion must demonstrate possession of
additional cryptographic material.  The token service thereby
binds a key identifier to the assertion and the client has to
demonstrate to the relying party that it knows the key
corresponding to that identifier when presenting the assertion.
This mechanism provides additional security properties.</p>
<p>The protocol parameters and processing rules defined in this document
are intended to support a client presenting a bearer assertion to an
authorization server.  The use of holder-of-key assertions are not
precluded by this document, but additional protocol details would
need to be specified.</p>
<p>( <a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-assertions-09#section-3">http://tools.ietf.org/html/draft-ietf-oauth-assertions-09#section-3</a> )</p>
</div>
</div>
<div class="section" id="transporting-assertions">
<span id="oauth-assertion-4"></span><h2><a class="toc-backref" href="#id10">4.  Transporting Assertions</a><a class="headerlink" href="#transporting-assertions" title="Permalink to this headline">¶</a></h2>
<p>This section defines generic HTTP parameters for transporting assertions
during interactions with a <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">token endpoint</em></a>.</p>
<p>Transportations:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#oauth-assertion-4-1"><em>4.1.  Using Assertions for Client Authentication</em></a></li>
<li><a class="reference internal" href="#oauth-assertion-4-2"><em>4.2.  Using Assertions as Authorization Grants</em></a></li>
</ul>
</div></blockquote>
<div class="section" id="using-assertions-for-client-authentication">
<span id="oauth-assertion-4-1"></span><h3><a class="toc-backref" href="#id11">4.1.  Using Assertions for Client Authentication</a><a class="headerlink" href="#using-assertions-for-client-authentication" title="Permalink to this headline">¶</a></h3>
<p>In scenarios
where one wants to avoid sending secrets,
one wants to send values derived from the secret
that prove to the receiver that the sender is in <strong>possession of the secret</strong>
without actually sending the secret.</p>
<p>For example,
a client can establish a secret using an out-of-band mechanism with a <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a>.
As part of this out-of-band communication the client and <a class="reference internal" href="oauth.html#term-resource-server"><em class="xref std std-term">resource server</em></a> agree
that the client will authenticate itself using an assertion with agreed upon parameters
that will be signed by the provisioned secret.
Later on, the client might send an access token request to the token endpoint
for the resource server that includes an authorization code,
as well as a <a class="reference internal" href="#term-client-assertion"><em class="xref std std-term">client_assertion</em></a>
that is signed with the previously agreed key and parameters.
The <a class="reference internal" href="#term-client-assertion"><em class="xref std std-term">client_assertion</em></a> proves to the <em class="xref std std-ref">token endpoint</em> the <strong>identity of the client</strong>
and the <a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">authorization code</em></a> provides the link to the end-user authorization.</p>
<p>The following section defines the use of assertions as <a class="reference internal" href="glossary.html#term-client-credentials"><em class="xref std std-term">client credentials</em></a>
as an extension of <em class="xref std std-ref">Section 3.2 of OAuth 2.0 [I-D.ietf.oauth-v2]</em>.
When using assertions as client credentials,
the <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> MUST include the assertion
using the following HTTP request parameters:</p>
<dl class="glossary docutils">
<dt id="term-client-id">client_id</dt>
<dd>OPTIONAL.
The <a class="reference internal" href="session.html#term-client-identifier"><em class="xref std std-term">client identifier</em></a> as described in <a class="reference internal" href="oauth.html#oauth-3"><em>Section 3 of OAuth 2.0 [I-D.ietf.oauth-v2]</em></a>.</dd>
<dt id="term-client-assertion-type">client_assertion_type</dt>
<dd>REQUIRED.
The <strong>format</strong> of the assertion as defined by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>.
The value MUST be an <em class="xref std std-term">absolute URI</em>.</dd>
<dt id="term-client-assertion">client_assertion</dt>
<dd>REQUIRED.
The assertion being used to authenticate the client.
Specific serialization of the assertion is defined by profile documents.
The serialization MUST be encoded for transport within HTTP forms.
It is RECOMMENDED that <strong>base64url</strong> be used.</dd>
</dl>
<p>The following non-normative example demonstrates
a <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> authenticating using an assertion during an <a class="reference internal" href="glossary.html#term-authorization-code"><em class="xref std std-term">Authorization Code</em></a>
<a class="reference internal" href="glossary.html#term-access-token-request"><em class="xref std std-term">Access Token Request</em></a> as defined in <em class="xref std std-ref">Section 4.1.3 of OAuth 2.0 [I-D.ietf.oauth-v2]</em>.
(line breaks are for display purposes only):</p>
<div class="highlight-python"><pre>POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;
code=i1WsRn1uB1&amp;
client_id=s6BhdRkqt3&amp;
client_assertion_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
client_assertion=PHNhbWxwOl...[omitted for brevity]...ZT</pre>
</div>
<p>The <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> MUST NOT include the <em class="xref std std-term">client_credential</em> using more than one mechanism.
Token endpoints can differentiate between client assertion credentials
and other client credential types by looking for the presence of the <a class="reference internal" href="#term-client-assertion"><em class="xref std std-term">client_assertion</em></a> and
<a class="reference internal" href="#term-client-assertion-type"><em class="xref std std-term">client_assertion_type</em></a> attributes which will only be present with client assertion credentials.
See <a class="reference internal" href="#oauth-assertion-7"><em>section 7</em></a> for more details</p>
</div>
<div class="section" id="using-assertions-as-authorization-grants">
<span id="oauth-assertion-4-2"></span><h3><a class="toc-backref" href="#id12">4.2.  Using Assertions as Authorization Grants</a><a class="headerlink" href="#using-assertions-as-authorization-grants" title="Permalink to this headline">¶</a></h3>
<p>An assertion can be used to request an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a>
when a <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> wishes to utilize an existing trust relationship.
This may be done through the semantics of
(and a <em class="xref std std-term">digital signature</em>/<a class="reference internal" href="glossary.html#term-hmac"><em class="xref std std-term">HMAC</em></a> calculated over) the assertion,
and expressed to the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> through an extension <a class="reference internal" href="glossary.html#term-authorization-grant-type"><em class="xref std std-term">authorization grant type</em></a>.
The processes by which authorization is previously granted,
and by which the client obtains the assertion
prior to exchanging it with the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>, are out of scope.</p>
<p>The following defines the use of assertions as <em class="xref std std-term">authorization grants</em>
as an extension of <a class="reference internal" href="oauth.html#oauth-4-5"><em>OAuth 2.0 [I-D.ietf.oauth-v2], section 4.5</em></a>.
When using assertions as authorization grants,
the <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> MUST include the assertion using the following HTTP request parameters:</p>
<dl class="glossary docutils">
<dt id="term-3">client_id</dt>
<dd>OPTIONAL.
The client identifier as described in <a class="reference internal" href="oauth.html#oauth-3"><em>Section 3 of OAuth 2.0 [I-D.ietf.oauth-v2]</em></a>.</dd>
<dt id="term-grant-type">grant_type</dt>
<dd>REQUIRED.
The format of the assertion as defined by the authorization server.
The value MUST be an absolute URI.</dd>
<dt id="term-assertion">assertion</dt>
<dd>REQUIRED.
The assertion being used as an authorization grant.
Specific serialization of the assertion is defined by profile documents.
The serialization MUST be encoded for transport within HTTP forms.
It is RECOMMENDED that base64url be used.</dd>
<dt id="term-scope">scope</dt>
<dd>OPTIONAL.
The request MAY contain a &#8220;scope&#8221; parameter.
The scope of the access request is expressed as a list of space-delimited strings.
The value is defined by the authorization server.
If the value contains multiple space-delimited strings,
their order does not matter, and each string adds an additional access range to the requested scope.
When exchanging assertions for access_tokens,
the authorization for the token has been previously granted through some other mechanism.
As such, the requested scope SHOULD be equal or lesser than the scope
originally granted to the authorized accessor.
If the scope parameter and/or value is omitted,
the scope SHOULD be treated as equal to the scope originally granted to the authorized accessor.
The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> SHOULD limit the scope of the issued access token to be equal
or lesser than the scope originally granted to the authorized accessor.</dd>
</dl>
<p>The following non-normative example demonstrates an assertion being used as an authorization grant.
(line breaks are for display purposes only):</p>
<div class="highlight-python"><pre>POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3&amp;
grant_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
assertion=PHNhbWxwOl...[omitted for brevity]...ZT4</pre>
</div>
</div>
</div>
<div class="section" id="assertion-content-and-processing">
<span id="oauth-assertion-5"></span><h2><a class="toc-backref" href="#id13">5.  Assertion Content and Processing</a><a class="headerlink" href="#assertion-content-and-processing" title="Permalink to this headline">¶</a></h2>
<p>This section provides a general content and processing model
for the use of assertions in OAuth 2.0 [I-D.ietf.oauth-v2].</p>
<p>Formats:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#oauth-assertion-5-1"><em>5.1.  Assertion Metamodel</em></a></li>
<li><a class="reference internal" href="#oauth-assertion-5-2"><em>5.2.  General Assertion Format and Processing Rules</em></a></li>
</ul>
</div></blockquote>
<div class="section" id="assertion-metamodel">
<span id="oauth-assertion-5-1"></span><h3><a class="toc-backref" href="#id14">5.1.  Assertion Metamodel</a><a class="headerlink" href="#assertion-metamodel" title="Permalink to this headline">¶</a></h3>
<p>The following are entities and metadata involved in the issuance,
exchange and processing of assertions in OAuth 2.0.  These are
general terms, abstract from any particular assertion format.
Mappings of these terms into specific representations are provided by
profiles of this specification.</p>
<dl class="glossary docutils">
<dt id="term-issuer">Issuer</dt>
<dd>The unique identifier for the entity that issued the
assertion.  Generally this is the entity that holds the keying
material used to generate the assertion.  In some use-cases
Issuers may be either OAuth Clients (when assertions are self-
asserted ) or a Security Token Service (an entity capable of
issuing, renewing, transforming and validating of security
tokens).</dd>
<dt id="term-principal">Principal</dt>
<dd>A unique identifier for the subject of the assertion.
When using assertions for client authentication, the Principal
SHOULD be the client_id of the OAuth client.  When using
assertions as an authorization grant, the Principal MUST identify
an authorized accessor for whom the access token is being
requested (typically the resource owner, or an authorized
delegate).</dd>
<dt id="term-audience">Audience</dt>
<dd>A URI that identifies the party intended to process the assertion.
The audience SHOULD be the URL of the Token Endpoint
as defined in <em class="xref std std-ref">section 2.2 of OAuth 2.0 [I-D.ietf.oauth-v2]</em>.</dd>
<dt id="term-issued-at">Issued At</dt>
<dd>The time at which the assertion was issued.  While the
serialization may differ by assertion format, this is always
expressed in UTC with no time zone component.</dd>
<dt id="term-expires-at">Expires At</dt>
<dd>The time at which the assertion expires.  While the
serialization may differ by assertion format, this is always
expressed in UTC with no time zone component.</dd>
<dt id="term-assertion-id">Assertion ID</dt>
<dd>A nonce or unique identifier for the assertion.  The
Assertion ID may be used by implementations requiring message de-
duplication for one-time use assertions.  Any entity that assigns
an identifier MUST ensure that there is negligible probability
that that entity or any other entity will accidentally assign the
same identifier to a different data object.</dd>
</dl>
</div>
<div class="section" id="general-assertion-format-and-processing-rules">
<span id="oauth-assertion-5-2"></span><h3><a class="toc-backref" href="#id15">5.2.  General Assertion Format and Processing Rules</a><a class="headerlink" href="#general-assertion-format-and-processing-rules" title="Permalink to this headline">¶</a></h3>
<p>The following are general format and processing rules for the use of
assertions in OAuth:</p>
<blockquote>
<div><ul class="simple">
<li>The assertion MUST contain an Issuer.  The Issuer MUST identify
the entity that issued the assertion as recognized by the
Authorization Server.  If an assertion is self-asserted, the
Issuer SHOULD be the client_id.</li>
<li>The assertion SHOULD contain a Principal.  The Principal MUST
identify an authorized accessor for whom the access token is being
requested ( typically the resource owner, or an authorized
delegate ) When the client is acting on behalf of itself, the
Principal SHOULD be the client_id.</li>
<li>The assertion MUST contain an Audience that identifies the
Authorization Server as the intended audience.  The Authorization
Server MUST verify that it is an intended audience for the
assertion.  The Audience SHOULD be the URL of the Authorization
Server&#8217;s Token Endpoint.</li>
<li>The assertion MUST contain an Expires At entity that limits the
time window during which the assertion can be used.  The
authorization server MUST verify that the expiration time has not
passed, subject to allowable clock skew between systems.  The
authorization server SHOULD reject assertions with an Expires At
attribute value that is unreasonably far in the future.</li>
<li>The assertion MAY contain an Issued At entity containing the UTC
time at which the assertion was issued.</li>
<li>The assertion MAY contain an Assertion ID.  An Authorization
Server MAY dictate that Assertion ID is mandatory.</li>
<li>The Authorization Server MUST validate the assertion in order to
establish a mapping between the Issuer and the secret used to
generate the assertion.  The algorithm used to validate the
assertion, and the mechanism for designating the secret used to
generate the assertion is out-of-scope for this specification.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="specific-assertion-format-and-processing-rules">
<span id="oauth-assertion-6"></span><h2><a class="toc-backref" href="#id16">6.  Specific Assertion Format and Processing Rules</a><a class="headerlink" href="#specific-assertion-format-and-processing-rules" title="Permalink to this headline">¶</a></h2>
<p>The following clarifies the format and processing rules
defined in <a class="reference internal" href="#oauth-assertion-4"><em>section 4</em></a>
and <a class="reference internal" href="#oauth-assertion-5"><em>section 5</em></a> for a number of common use-cases:</p>
<a class="reference internal image-reference" href="images/6.png"><img alt="images/6.png" src="images/6.png" style="width: 600px;" /></a>
<p>Format and Rules:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#oauth-assertion-6-1"><em>6.1.  Client authentication</em></a></li>
<li><a class="reference internal" href="#oauth-assertion-6-2"><em>6.2.  Client acting on behalf of itself</em></a></li>
<li><a class="reference internal" href="#oauth-assertion-6-3"><em>6.3.  Client acting on behalf of a user</em></a></li>
<li><a class="reference internal" href="#oauth-assertion-6-4"><em>6.4.  Client acting on behalf of an anonymous user</em></a></li>
</ul>
</div></blockquote>
<div class="section" id="client-authentication">
<span id="oauth-assertion-6-1"></span><h3><a class="toc-backref" href="#id17">6.1.  Client authentication</a><a class="headerlink" href="#client-authentication" title="Permalink to this headline">¶</a></h3>
<p>When a <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> authenticates to a token service using an assertion,
it SHOULD do so according to <a class="reference internal" href="#oauth-assertion-4-1"><em>section 4.1</em></a>.
The following format and processing rules SHOULD be applied:</p>
<blockquote>
<div><ul class="simple">
<li>The <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a> HTTP parameter SHOULD identify the <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> to the
<a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>.</li>
<li>The <a class="reference internal" href="#term-client-assertion-type"><em class="xref std std-term">client_assertion_type</em></a> HTTP parameter MUST identify the
<em class="xref std std-term">assertion format</em> being used for authentication.</li>
<li>The <a class="reference internal" href="#term-client-assertion"><em class="xref std std-term">client_assertion</em></a> HTTP parameter MUST contain the serialized
assertion in a format indicated by the <a class="reference internal" href="#term-client-assertion-type"><em class="xref std std-term">client_assertion_type</em></a> parameter.</li>
<li>The <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> of the assertion MUST identify the entity
that issued the assertion as recognized by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.
If the assertion is self-asserted, the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> SHOULD be the <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a>.</li>
<li>The <a class="reference internal" href="#term-principal"><em class="xref std std-term">Principal</em></a> MUST identify an <em class="xref std std-term">authorized accessor</em>.
If the assertion is self-issued, the <a class="reference internal" href="#term-principal"><em class="xref std std-term">Principal</em></a> SHOULD be the <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a>.</li>
<li>The <a class="reference internal" href="oauth_introspect.html#term-audience"><em class="xref std std-term">Audience</em></a> of the assertion MUST identify the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>
and SHOULD be the URL of the <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a>.</li>
<li>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST validate the assertion in order to
establish a mapping between the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> and the secret used to
generate the assertion.</li>
</ul>
</div></blockquote>
<p>The following non-normative example demonstrates the use of a client authentication using an assertion
during an <em class="xref std std-term">Authorization Code Access Token Request</em> as
defined in <em class="xref std std-ref">Section 4.1.3 of OAuth 2.0 [I-D.ietf.oauth-v2]</em>.
(line breaks are for display purposes only):</p>
<div class="highlight-python"><pre>POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;
code=i1WsRn1uB1&amp;
client_id=s6BhdRkqt3&amp;
client_assertion_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
client_assertion=PHNhbWxwOl...[omitted for brevity]...ZT4</pre>
</div>
</div>
<div class="section" id="client-acting-on-behalf-of-itself">
<span id="oauth-assertion-6-2"></span><h3><a class="toc-backref" href="#id18">6.2.  Client acting on behalf of itself</a><a class="headerlink" href="#client-acting-on-behalf-of-itself" title="Permalink to this headline">¶</a></h3>
<p>When a <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> is accessing resources on behalf of itself,
it SHOULD do so in a manner analogous to the Client Credentials flow
defined in <em class="xref std std-ref">Section 4.4 of OAuth 2.0 [I-D.ietf.oauth-v2]</em>.
This is a special case that combines
both the authentication and <em class="xref std std-term">authorization grant</em> usage patterns.
In this case,
the interactions with the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> SHOULD be treated
as using an assertion for Client Authentication according to <a class="reference internal" href="#oauth-assertion-4-1"><em>section 4.1</em></a>,
with the addition of a <a class="reference internal" href="#term-grant-type"><em class="xref std std-term">grant_type</em></a> parameter.</p>
<p>The following format and processing rules SHOULD be applied.</p>
<blockquote>
<div><ul class="simple">
<li>The <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a> HTTP parameter SHOULD identify the client to the
<a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>.</li>
<li>The <a class="reference internal" href="#term-grant-type"><em class="xref std std-term">grant_type</em></a> HTTP request parameter MUST be
&#8220;<a class="reference internal" href="glossary.html#term-344"><em class="xref std std-term">client_credentials</em></a>&#8221;.</li>
<li>The <a class="reference internal" href="#term-client-assertion-type"><em class="xref std std-term">client_assertion_type</em></a> HTTP parameter MUST identify the assertion format.</li>
<li>The <a class="reference internal" href="#term-client-assertion"><em class="xref std std-term">client_assertion</em></a> HTTP parameter MUST contain the serialized assertion
as in a format indicated by the <a class="reference internal" href="#term-client-assertion-type"><em class="xref std std-term">client_assertion_type</em></a> parameter.</li>
<li>The <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> of the assertion MUST identify the entity that issued the assertion
as recognized by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.
If the assertion is self-asserted, the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> SHOULD be the <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a>.
If the assertion was issued by a <em class="xref std std-term">Security Token Service</em>,
the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> SHOULD identify the <em class="xref std std-term">STS</em> as recognized by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.</li>
<li>The <a class="reference internal" href="#term-principal"><em class="xref std std-term">Principal</em></a> SHOULD be the <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a>.</li>
<li>The <a class="reference internal" href="oauth_introspect.html#term-audience"><em class="xref std std-term">Audience</em></a> of the assertion MUST identify the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>
and SHOULD be the URL of the <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a>.</li>
<li>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST validate the assertion in order to
establish a mapping between the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> and the secret used to generate the assertion.</li>
</ul>
</div></blockquote>
<p>The following non-normative example demonstrates the use of a sample assertion
being used for a <em class="xref std std-term">Client Credentials Access Token Request</em>
as defined in <em class="xref std std-ref">Section 4.4.2 of OAuth 2.0 [I-D.ietf.oauth-v2]</em>.
(line breaks are for display purposes only):</p>
<div class="highlight-python"><pre>POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3&amp;
grant_type=client_credentials&amp;
client_assertion_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
client_assertion=PHNhbWxwOl...[omitted for brevity]...ZT4%3D</pre>
</div>
</div>
<div class="section" id="client-acting-on-behalf-of-a-user">
<span id="oauth-assertion-6-3"></span><h3><a class="toc-backref" href="#id19">6.3.  Client acting on behalf of a user</a><a class="headerlink" href="#client-acting-on-behalf-of-a-user" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">I&#8217;m not quite sure what use case is taken accounted into....</p>
</div>
<p>When a <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> is accessing resources on behalf of a user,
it SHOULD be treated as using an assertion as an <em class="xref std std-term">Authorization Grant</em>
according to <a class="reference internal" href="#oauth-assertion-4-2"><em>section 4.2</em></a>.
The following format and processing rules SHOULD be applied:</p>
<blockquote>
<div><ul class="simple">
<li>The <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a> HTTP parameter MUST identify the <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a>
to the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>.</li>
<li>The <a class="reference internal" href="#term-grant-type"><em class="xref std std-term">grant_type</em></a> HTTP request parameter MUST indicate the assertion format.</li>
<li>The <a class="reference internal" href="#term-assertion"><em class="xref std std-term">assertion</em></a> HTTP parameter MUST contain the serialized assertion
as in a format indicated by the <a class="reference internal" href="#term-grant-type"><em class="xref std std-term">grant_type</em></a> parameter.</li>
<li>The <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> of the assertion MUST identify the entity that issued the assertion
as recognized by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.
If the assertion is self-asserted, the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> SHOULD be the <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a>.
If the assertion was issued by a <em class="xref std std-term">STS</em>,
the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> SHOULD identify the <em class="xref std std-term">STS</em> as recognized by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.</li>
<li>The <a class="reference internal" href="#term-principal"><em class="xref std std-term">Principal</em></a> MUST identify an authorized accessor for whom
the <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a> is being requested
(typically the <a class="reference internal" href="uma_core.html#term-resource-owner"><em class="xref std std-term">resource owner</em></a>, or an authorized delegate).</li>
<li>The <a class="reference internal" href="oauth_introspect.html#term-audience"><em class="xref std std-term">Audience</em></a> of the assertion MUST identify the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>
and MAY be the URL of the <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a>.</li>
<li>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST validate the assertion
in order to establish a mapping between the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> and the secret used to
generate the assertion.</li>
</ul>
</div></blockquote>
<p>The following non-normative example demonstrates the use of a client
authenticating using an assertion during an <em class="xref std std-term">Authorization Code Access Token Request</em>
as defined in <em class="xref std std-ref">Section 4.1.3 of OAuth 2.0 [I-D.ietf.oauth-v2]</em>.
(line breaks are for display purposes only):</p>
<div class="highlight-python"><pre>POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3&amp;
grant_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
assertion=PHNhbWxwOl...[omitted for brevity]...ZT4%3D</pre>
</div>
</div>
<div class="section" id="client-acting-on-behalf-of-an-anonymous-user">
<span id="oauth-assertion-6-4"></span><h3><a class="toc-backref" href="#id20">6.4.  Client acting on behalf of an anonymous user</a><a class="headerlink" href="#client-acting-on-behalf-of-an-anonymous-user" title="Permalink to this headline">¶</a></h3>
<p>When a <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> is accessing resources on behalf of an anonymous user,
the following format and processing rules SHOULD be applied:</p>
<blockquote>
<div><ul class="simple">
<li>The <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a> HTTP parameter MUST identify the <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> to the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>.</li>
<li>The <a class="reference internal" href="#term-grant-type"><em class="xref std std-term">grant_type</em></a> HTTP request parameter MUST indicate the <strong>assertion format</strong>.</li>
<li>The <a class="reference internal" href="#term-assertion"><em class="xref std std-term">assertion</em></a> HTTP parameter MUST contain the serialized assertion
as in a format indicated by the <a class="reference internal" href="#term-grant-type"><em class="xref std std-term">grant_type</em></a> parameter.</li>
<li>The <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> of the assertion MUST identify the entity that issued the assertion
as recognized by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.
If the assertion is self-asserted, the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> SHOULD be the <a class="reference internal" href="standard.html#term-client-id"><em class="xref std std-term">client_id</em></a>.
If the assertion was issued by a Security Token Service,
the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> SHOULD identify the <em class="xref std std-term">STS</em> as recognized by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.</li>
<li>The <a class="reference internal" href="#term-principal"><em class="xref std std-term">Principal</em></a> SHOULD indicate to the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>
that the <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> is acting on-behalf of an anonymous user
as defined by the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>.
It is implied that authorization is based
upon additional criteria, such as additional attributes or claims
provided in the assertion.
For example, a <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> may present an assertion from a trusted issuer asserting
that the bearer is over 18 via an included claim.
In this case, no additional information about the user&#8217;s identity is included yet all the data needed to
issue an <a class="reference internal" href="glossary.html#term-access-token"><em class="xref std std-term">access token</em></a> is present.</li>
<li>The <a class="reference internal" href="oauth_introspect.html#term-audience"><em class="xref std std-term">Audience</em></a> of the assertion MUST identify the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a>
and MAY be the URL of the <a class="reference internal" href="uma_core.html#term-token-endpoint"><em class="xref std std-term">Token Endpoint</em></a>.</li>
<li>The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST validate the assertion in order to
establish a mapping between the <a class="reference internal" href="uma_core.html#term-issuer"><em class="xref std std-term">Issuer</em></a> and the secret used to
generate the assertion.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="error-responses">
<span id="oauth-assertion-7"></span><h2><a class="toc-backref" href="#id21">7.  Error Responses</a><a class="headerlink" href="#error-responses" title="Permalink to this headline">¶</a></h2>
<p>If an assertion is not valid or has expired,
the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST construct an error response
as defined in <a class="reference internal" href="oauth.html"><em>OAuth 2.0 [I-D.ietf.oauth-v2]</em></a>.
The value of the error parameter MUST be the &#8220;<em class="xref std std-term">invalid_grant</em>&#8221; error code.
The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> MAY include additional information
regarding the reasons the assertion was considered invalid
using the &#8220;<a class="reference internal" href="uma_core.html#term-error-description"><em class="xref std std-term">error_description</em></a>&#8221; or &#8220;<a class="reference internal" href="uma_core.html#term-error-uri"><em class="xref std std-term">error_uri</em></a>&#8221; parameters.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store

{
"error":"invalid_grant",
"error_description":"Audience validation failed"
}</pre>
</div>
<p>A <a class="reference internal" href="uma_core.html#term-client"><em class="xref std std-term">client</em></a> MUST NOT include <a class="reference internal" href="glossary.html#term-client-credentials"><em class="xref std std-term">client credentials</em></a> using more than one mechanism.
<em class="xref std std-term">Token endpoints</em> can differentiate between assertion based credentials
and other <em class="xref std std-term">client credential types</em> by looking for the presence of the <a class="reference internal" href="#term-client-assertion"><em class="xref std std-term">client_assertion</em></a>
and <a class="reference internal" href="#term-client-assertion-type"><em class="xref std std-term">client_assertion_type</em></a> attributes which will only be present
when using assertions for <strong>client authentication</strong>.</p>
<p>If more than one mechanism is used,
the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">Authorization Server</em></a> MUST construct an error response as defined in <a class="reference internal" href="oauth.html"><em>OAuth 2.0 [I-D.ietf.oauth-v2]</em></a>.
The value of the error parameter MUST be the &#8220;<em class="xref std std-term">invalid_client</em>&#8221; error code.
The <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a> MAY include additional information
regarding the reasons the client was considered invalid using the &#8220;<a class="reference internal" href="uma_core.html#term-error-description"><em class="xref std std-term">error_description</em></a>&#8221; or &#8220;<a class="reference internal" href="uma_core.html#term-error-uri"><em class="xref std std-term">error_uri</em></a>&#8221; parameters.</p>
<p>For example:</p>
<div class="highlight-python"><pre>HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store

{
"error":"invalid_client"
"error_description":"Multiple Credentials Not Allowed"
}</pre>
</div>
</div>
<div class="section" id="security-considerations">
<span id="oauth-assertion-8"></span><h2><a class="toc-backref" href="#id22">8.  Security Considerations</a><a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>Authorization Providers concerned with preventing replay attacks
may choose to implement using replay detection
using a combination of the <em class="xref std std-term">AssertionID</em> and <em class="xref std std-term">IssuedAt</em>/<em class="xref std std-term">ExpiredAt</em> attributes.
Previously processed assertions MAY be de-duped and rejected based on the <em class="xref std std-term">AssertionID</em>.</p>
<p>The addition of the validity window relieves the <a class="reference internal" href="oauth.html#term-authorization-server"><em class="xref std std-term">authorization server</em></a>
from maintaining an infinite state table of processed assertion IDs.</p>
<p><a class="reference internal" href="oauth.html#term-authorization-servers"><em class="xref std std-term">Authorization Servers</em></a> SHOULD consider the amount of information exposed in error responses,
and the risk associated with exposing details of specific processing errors.
In addition, <a class="reference internal" href="oauth.html#term-authorization-servers"><em class="xref std std-term">Authorization Servers</em></a> SHOULD prevent <em class="xref std std-term">timing attacks</em>
related to cryptographic processing of the assertion.</p>
<p>No additional considerations beyond those described
within the <em class="xref std std-ref">OAuth 2.0 Protocol Framework, Section 10 [I-D.ietf.oauth-v2]</em>.</p>
</div>
<div class="section" id="iana-considerations">
<span id="oauth-assertion-9"></span><h2><a class="toc-backref" href="#id23">9.  IANA Considerations</a><a class="headerlink" href="#iana-considerations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="parameter-registration-request">
<span id="oauth-assertion-9-1"></span><h3><a class="toc-backref" href="#id24">9.1.  Parameter Registration Request</a><a class="headerlink" href="#parameter-registration-request" title="Permalink to this headline">¶</a></h3>
<p>The following is the parameter registration request,
as defined in <em class="xref std std-ref">The OAuth Parameters Registry of The OAuth 2.0 Authorization Protocol [I-D.ietf.oauth-v2]</em>,
for the &#8220;<a class="reference internal" href="#term-assertion"><em class="xref std std-term">assertion</em></a>&#8221; parameter:</p>
<blockquote>
<div><ul class="simple">
<li>Parameter name: assertion</li>
<li>Parameter usage location: client authentication, token request</li>
<li>Change controller: IETF</li>
<li>Specification document(s): [[this document]]</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="oauth-assertion-9-2">
<span id="id1"></span><h3><a class="toc-backref" href="#id25">9.2.  Parameter Registration Request</a><a class="headerlink" href="#oauth-assertion-9-2" title="Permalink to this headline">¶</a></h3>
<p>The following is the parameter registration request,
as defined in <em class="xref std std-ref">The OAuth Parameters Registry of The OAuth 2.0 Authorization Protocol [I-D.ietf.oauth-v2]</em>,
for the &#8220;<a class="reference internal" href="#term-client-assertion"><em class="xref std std-term">client_assertion</em></a>&#8221; parameter:</p>
<blockquote>
<div><ul class="simple">
<li>Parameter name: client_assertion</li>
<li>Parameter usage location: client authentication, token request</li>
<li>Change controller: IETF</li>
<li>Specification document(s): [[this document]]</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="oauth-assertion-9-3">
<span id="id2"></span><h3><a class="toc-backref" href="#id26">9.3.  Parameter Registration Request</a><a class="headerlink" href="#oauth-assertion-9-3" title="Permalink to this headline">¶</a></h3>
<p>The following is the parameter registration request,
as defined in <em class="xref std std-ref">The OAuth Parameters Registry of The OAuth 2.0 Authorization Protocol [I-D.ietf.oauth-v2]</em>,
for the &#8220;<a class="reference internal" href="#term-client-assertion-type"><em class="xref std std-term">client_assertion_type</em></a>&#8221; parameter:</p>
<blockquote>
<div><ul class="simple">
<li>Parameter name: client_assertion_type</li>
<li>Parameter usage location: client authentication, token request</li>
<li>Change controller: IETF</li>
<li>Specification document(s): [[this document]]</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="acknowledgements">
<span id="oauth-assertion-10"></span><h2><a class="toc-backref" href="#id27">10.  Acknowledgements</a><a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>The authors wish to thank the following people that have influenced
or contributed this specification: Paul Madsen, Eric Sachs, Jian Cai,
Tony Nadalin, the authors of OAuth WRAP, and those in the OAuth 2
working group.</p>
</div>
<div class="section" id="normative-references">
<span id="oauth-assertion-11"></span><h2><a class="toc-backref" href="#id28">11.  Normative References</a><a class="headerlink" href="#normative-references" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><dl class="docutils">
<dt>[I-D.ietf.oauth-v2]</dt>
<dd>Hammer-Lahav, E., &#8220;The OAuth 2.0 Authorization Protocol&#8221;,
September 2011.</dd>
<dt>[RFC2119]</dt>
<dd>Bradner, S., &#8220;Key words for use in RFCs to Indicate
Requirement Levels&#8221;, BCP 14, RFC 2119, March 1997.</dd>
</dl>
</div></blockquote>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="oauth_saml2_bearer.html">SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="oauth_responses.html">OAuth 2.0 Multiple Response Type Encoding Practices</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, HDKNR.COM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>