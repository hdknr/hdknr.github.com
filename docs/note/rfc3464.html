

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>RFC3464:An Extensible Message Format for Delivery Status Notifications &mdash; Note 1 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/theme_extras.js"></script>
    <link rel="top" title="Note 1 documentation" href="index.html" />
    <link rel="next" title="VERP:Variable envelope return path" href="verp.html" />
    <link rel="prev" title="sentry" href="sentry.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Note 1 documentation</span></a></h1>
        <h2 class="heading"><span>RFC3464:An Extensible Message Format for Delivery Status Notifications</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="sentry.html">sentry</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="verp.html">VERP:Variable envelope return path</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="rfc3464-an-extensible-message-format-for-delivery-status-notifications">
<h1>RFC3464:An Extensible Message Format for Delivery Status Notifications<a class="headerlink" href="#rfc3464-an-extensible-message-format-for-delivery-status-notifications" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3464.html"><strong>RFC 3464</strong></a></li>
<li>Updated by: <span class="target" id="index-1"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc4865.html"><strong>RFC 4865</strong></a>, <span class="target" id="index-2"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc5337.html"><strong>RFC 5337</strong></a>, <span class="target" id="index-3"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc6533.html"><strong>RFC 6533</strong></a></li>
</ul>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id1">Abstract</a></li>
<li><a class="reference internal" href="#introduction" id="id2">1. Introduction</a><ul>
<li><a class="reference internal" href="#purposes" id="id3">1.1 Purposes</a></li>
<li><a class="reference internal" href="#requirements" id="id4">1.2 Requirements</a></li>
<li><a class="reference internal" href="#terminology" id="id5">1.3 Terminology</a></li>
</ul>
</li>
<li><a class="reference internal" href="#format-of-a-delivery-status-notification" id="id6">2. Format of a Delivery Status Notification</a><ul>
<li><a class="reference internal" href="#the-message-delivery-status-content-type" id="id7">2.1 The message/delivery-status content-type</a></li>
</ul>
</li>
</ul>
</div>
<dl class="glossary docutils">
<dt id="term-dsn">DSN</dt>
<dd>Deslivery Status Notifications</dd>
</dl>
<div class="section" id="abstract">
<h2><a class="toc-backref" href="#id1">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>This memo defines a Multipurpose Internet Mail Extensions (<em class="xref std std-term">MIME</em>) content-type
that may be used by a message transfer agent (<em class="xref std std-term">MTA</em>) or
electronic mail gateway to report the result of an attempt
to deliver a message to one or more recipients.</p>
<p>This content-type is intended as a machine-processable replacement
for the various types of delivery status notifications currently
used in Internet electronic mail.</p>
<p>Because many messages are sent between the Internet and other messaging systems
(such as X.400 or the so-called &#8220;Local Area Network (LAN)-based&#8221; systems),
the Delivery Status Notification (DSN) protocol is designed to be useful
in a multi-protocol messaging environment.</p>
<p>To this end,
the protocol described in this memo provides
for the carriage of <strong>&#8220;foreign&#8221; addresses</strong> and <strong>error codes</strong>,
in addition to those normally used in Internet mail.
Additional attributes may also be defined to support &#8220;tunneling&#8221; of
foreign notifications through Internet mail.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>&#8220;to this end&#8221;  = To achieve the previously specified goal.</li>
</ul>
</div>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This memo defines a Multipurpose Internet Mail Extensions (MIME) <em class="xref std std-term">[MIME1]</em>
content-type for Delivery Status Notifications (DSNs).
A DSN can be used to notify the sender of a message of any of several conditions:
failed delivery,
delayed delivery,
successful delivery,
or the gatewaying of a message into an environment
that may not support DSNs.</p>
<p>The &#8220;<strong>message/delivery-status</strong>&#8221; content-type defined herein
is intended for use within the framework of the &#8220;<strong>multipart/report</strong>&#8221; content type
defined in <strong>[REPORT]</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>message/delivery-status</li>
<li>multipart/report</li>
</ul>
</div>
<p>This memo defines only the format of the notifications.
An extension to the Simple Message Transfer Protocol (SMTP) <em class="xref std std-term">[SMTP]</em>
to fully support such notifications is the subject of a separate memo <em class="xref std std-term">[DRPT]</em>.</p>
<p>Document Conventions</p>
<blockquote>
<div>The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;,
&#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this
document are to be interpreted as described in BCP 14, RFC 2119
[RFC2119].</div></blockquote>
<div class="section" id="purposes">
<h3><a class="toc-backref" href="#id3">1.1 Purposes</a><a class="headerlink" href="#purposes" title="Permalink to this headline">¶</a></h3>
<p>The DSNs defined in this memo are expected to serve several purposes:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>Inform human beings of the status of message delivery processing,
as well as the reasons for any delivery problems or outright
failures, in a manner that is largely independent of human
language and media;</li>
<li>Allow mail user agents to keep track of the delivery status of
messages sent, by associating returned DSNs with earlier message
transmissions;</li>
<li>Allow mailing list exploders to automatically maintain their
subscriber lists when delivery attempts repeatedly fail;</li>
<li>Convey delivery and non-delivery notifications resulting from
attempts to deliver messages to &#8220;foreign&#8221; mail systems via a
gateway;</li>
<li>Allow &#8220;foreign&#8221; notifications to be tunneled through a MIME-
capable message system and back into the original messaging
system that issued the original notification, or even to a third
messaging system;</li>
<li>Allow language-independent and medium-independent, yet reasonably
precise, indications of the reason for the failure of a message
to be delivered; and</li>
<li>Provide sufficient information to remote MTA maintainers (via
&#8220;trouble tickets&#8221;) so that they can understand the nature of
reported errors.  This feature is used in the case that failure
to deliver a message is due to the malfunction of a remote MTA
and the sender wants to report the problem to the remote MTA
administrator.</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="requirements">
<h3><a class="toc-backref" href="#id4">1.2 Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>These purposes place the following constraints on the notification
protocol:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>It must be readable by <strong>humans</strong> as well as being <strong>machine-parsable</strong>.</li>
<li>It must provide <strong>enough information</strong> to allow message senders
(or the user agents) to unambiguously associate a DSN with the
message that was sent and the original recipient address for
which the DSN is issued (if such information is available), even
if the message was forwarded to another recipient address.</li>
<li>It must be able to <strong>preserve the reason</strong> for the success or failure
of a delivery attempt in a remote messaging system, using the
&#8220;language&#8221; (mailbox addresses and status codes) of that remote system.</li>
<li>It must also be able to <strong>describe the reason</strong> for the success or
failure of a delivery attempt, independent of any particular
human language or of the &#8220;language&#8221; of any particular mail
system.</li>
<li>It must preserve enough information to allow the maintainer of a
remote MTA to understand (and if possible, reproduce) the
conditions that caused a delivery failure at that MTA.</li>
<li>For any notifications issued by foreign mail systems, which are
translated by a mail gateway to the DSN format, the DSN must
preserve the &#8220;type&#8221; of the foreign addresses and error codes, so
that these may be correctly interpreted by gateways.</li>
</ol>
</div></blockquote>
<p>A <a class="reference internal" href="#term-dsn"><em class="xref std std-term">DSN</em></a> contains a set of per-message fields
that identify the message and the transaction during which the message was submitted,
along with other fields that apply to all delivery attempts
described by the DSN.</p>
<p>The DSN also includes a set of per-recipient fields
to convey the result of the attempt
to deliver the message to each of one or more recipients.</p>
</div>
<div class="section" id="terminology">
<h3><a class="toc-backref" href="#id5">1.3 Terminology</a><a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<p>A message may be transmitted through several message transfer agents (MTAs)
on its way to a recipient.
For a variety of reasons,
recipient addresses may be rewritten during this process,
so each MTA may potentially see a different recipient address.
Depending on the purpose for which a DSN is used,
different formats of a particular recipient address will be needed.</p>
<p>Several DSN fields are defined in terms of the view from a particular
MTA in the transmission.  The MTAs are assigned the following names:</p>
<blockquote>
<div><ol class="loweralpha">
<li><p class="first">Original MTA</p>
<p>The Original MTA is the one to which the message is submitted for
delivery by the <strong>sender</strong> of the message.</p>
</li>
<li><p class="first">Reporting MTA</p>
<p>For any DSN, the Reporting MTA is the one which is reporting the
results of delivery attempts described in the DSN.</p>
<p>If the delivery attempts described occurred in a &#8220;foreign&#8221; (non-
Internet) mail system, and the DSN was produced by translating
the foreign notice into DSN format, the Reporting MTA will still
identify the &#8220;foreign&#8221; MTA where the delivery attempts occurred.</p>
</li>
<li><p class="first">Received-From MTA</p>
<p>The Received-From MTA is the MTA from which the Reporting MTA
received the message, and accepted responsibility for delivery of
the message.</p>
</li>
<li><p class="first">Remote MTA</p>
<p>If an MTA determines that it must relay a message to one or more
recipients, but the message cannot be transferred to its &#8220;next
hop&#8221; MTA, or if the &#8220;next hop&#8221; MTA refuses to accept
responsibility for delivery of the message to one or more of its
intended recipients, the relaying MTA may need to issue a DSN on
behalf of the recipients for whom the message cannot be
delivered.  In this case the relaying MTA is the Reporting MTA,
and the &#8220;next hop&#8221; MTA is known as the Remote MTA.</p>
</li>
</ol>
</div></blockquote>
<p>Figure 1 illustrates the relationship between the various MTAs.</p>
<div class="highlight-python"><pre>+-----+    +--------+           +---------+    +---------+      +------+
|     |    |        |           |Received-|    |         |      |      |
|     | =&gt; |Original| =&gt; ... =&gt; |  From   | =&gt; |Reporting| ===&gt; |Remote|
| user|    |   MTA  |           |   MTA   |    |   MTA   | &lt;No! |  MTA |
|agent|    +--------+           +---------+    +----v----+      +------+
|     |                                             |
|     | &lt;-------------------------------------------+
+-----+      (DSN returned to sender by Reporting MTA)

 Figure 1. Original, Received-From, Reporting and Remote MTAs</pre>
</div>
<p>Each of these MTAs may provide information that is useful in a DSN:</p>
<blockquote>
<div><ul>
<li><p class="first">Ideally, the DSN will contain the address of each recipient as
originally specified to the Original MTA by the sender of the
message.</p>
<p>This version of the address is needed (rather than a forwarding
address or some modified version of the original address) so that
the sender may compare the recipient address in the DSN with the
address in the sender&#8217;s records (e.g., an address book for an
individual, the list of subscribers for a mailing list) and take
appropriate action.</p>
<p>Similarly, the DSN might contain an &#8220;envelope identifier&#8221; that was
known to both the sender&#8217;s user agent and the Original MTA at the
time of message submission, and which, if included in the DSN, can
be used by the sender to keep track of which messages were or were
not delivered.</p>
</li>
<li><p class="first">If a message was (a) forwarded to a different address than that
specified by the sender, (b) gatewayed to a different mail system
than that used by the sender, or (c) subjected to address rewriting
during transmission, the &#8220;final&#8221; form of the recipient address
(i.e., the one seen by the Reporting MTA) will be different than
the original (sender-specified) recipient address.  Just as the
sender&#8217;s user agent (or the sender) prefers the original recipient
address, so the &#8220;final&#8221; address is needed when reporting a problem
to the postmaster of the site where message delivery failed,
because only the final recipient address will allow her to
reproduce the conditions that caused the failure.</p>
</li>
<li><p class="first">A &#8220;failed&#8221; DSN should contain the most accurate explanation for the
delivery failure that is available.  For ease of interpretation,
this information should be a format that is independent of the mail
transport system that issued the DSN.  However, if a foreign error
code is translated into some transport-independent format, some
information may be lost.  It is therefore desirable to provide both
a transport-independent status code and a mechanism for reporting
transport-specific codes.  Depending on the circumstances that
produced delivery failure, the transport-specific code might be
obtained from either the Reporting MTA or the Remote MTA.</p>
</li>
</ul>
<p>Since different values for &#8220;recipient address&#8221; and &#8220;delivery status
code&#8221; are needed according to the circumstance in which a DSN will be
used, and since the MTA that issues the DSN cannot anticipate those
circumstances, the DSN format described here may contain both the
original and final forms of a recipient address, and both a
transport-independent and a transport-specific indication of delivery
status.</p>
</div></blockquote>
<p>Extension fields may also be added by the Reporting MTA as needed to
provide additional information for use in a trouble ticket or to
preserve information for tunneling of foreign delivery reports
through Internet DSNs.</p>
<p>The Original, Reporting, and Remote MTAs may exist in very different
environments and use dissimilar transport protocols, MTA names,
address formats, and delivery status codes.  DSNs therefore do not
assume any particular format for mailbox addresses, MTA names, or
transport-specific status codes.  Instead, the various DSN fields
that carry such quantities consist of a &#8220;type&#8221; sub-field followed by
a sub-field whose contents are ordinary text characters, and the
format of which is indicated by the &#8220;type&#8221; sub-field.  This allows a
DSN to convey these quantities regardless of format.</p>
</div>
</div>
<div class="section" id="format-of-a-delivery-status-notification">
<h2><a class="toc-backref" href="#id6">2. Format of a Delivery Status Notification</a><a class="headerlink" href="#format-of-a-delivery-status-notification" title="Permalink to this headline">¶</a></h2>
<p>A DSN is a MIME message with a top-level content-type of
<strong>multipart/report</strong> (defined in <em class="xref std std-term">[REPORT]</em>).
When a multipart/report content is used to transmit a DSN:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>The report-type parameter of the multipart/report content is
&#8220;<strong>delivery-status</strong>&#8221;.</li>
<li>The first component of the multipart/report contains a human-
readable explanation of the DSN, as described in <em class="xref std std-term">[REPORT]</em>.</li>
<li>The second component of the multipart/report is of content-type
message/delivery-status,
described in <a class="reference internal" href="#rfc3464-2-1"><em>section 2.1</em></a> of this
document.</li>
<li>If the original message or a portion of the message is to be
returned to the sender, it appears as the third component of the
multipart/report.</li>
</ol>
</div></blockquote>
<p>NOTE:</p>
<p>For delivery status notifications gatewayed from foreign systems,
the headers of the original message may not be available.</p>
<p>In this case the third component of the DSN may be omitted,
or it may contain &#8220;simulated&#8221; RFC 822 headers that contain equivalent information.
In particular,
it is very desirable to preserve the subject, date,
and message-id (or equivalent) fields from the original message.</p>
<p>The DSN MUST be addressed
(in both the message header and the transport envelope) to the return address
from the <em class="xref std std-term">transport envelope</em>
which accompanied the original message for which the DSN was generated.
(For a message that arrived via SMTP, the envelope return address appears in the MAIL FROM command.)</p>
<p>The <strong>From</strong> field of the message header of the DSN SHOULD
contain the address of a human who is responsible for maintaining the mail system
at the Reporting MTA site (e.g., Postmaster),
so that a reply to the DSN will reach that person.</p>
<p>Exception:
if a DSN is translated from a foreign delivery report,
and the gateway performing the translation cannot determine the appropriate address,
the <strong>From</strong> field of the DSN MAY be the address of a human
who is responsible for maintaining the gateway.</p>
<p>The envelope sender address of the DSN SHOULD be chosen to ensure
that no delivery status reports will be issued in response to the DSN itself,
and MUST be chosen so that DSNs will not generate mail loops.
Whenever an SMTP transaction is used to send a DSN,
the <strong>MAIL FROM</strong> command MUST use a NULL return address,
i.e., &#8220;MAIL FROM:&lt;&gt;&#8221;.</p>
<p>A particular DSN describes the delivery status for exactly one message.
However,
an MTA MAY report on the delivery status for several recipients of the same message in a single DSN.
Due to the nature of the mail transport system
(where responsibility for delivery of a message to its recipients may be split among several
MTAs, and delivery to any particular recipient may be delayed),
multiple DSNs may still be issued in response to a single message submission.</p>
<div class="section" id="the-message-delivery-status-content-type">
<span id="rfc3464-2-1"></span><h3><a class="toc-backref" href="#id7">2.1 The message/delivery-status content-type</a><a class="headerlink" href="#the-message-delivery-status-content-type" title="Permalink to this headline">¶</a></h3>
<p>The message/delivery-status content-type is defined as follows:</p>
<div class="highlight-python"><pre>MIME type name:             message
MIME subtype name:          delivery-status
Optional parameters:        none
Encoding considerations:    "7bit" encoding is sufficient and
                            MUST be used to maintain readability
                            when viewed by non-MIME mail readers.
Security considerations:    discussed in section 4 of this memo.</pre>
</div>
<p>The message/delivery-status report type for use in the
multipart/report is &#8220;delivery-status&#8221;.</p>
<p>The body of a message/delivery-status consists of one or more
&#8220;fields&#8221; formatted according to the ABNF of RFC 822 header &#8220;fields&#8221;
(see [RFC822]).  The per-message fields appear first, followed by a
blank line.  Following the per-message fields are one or more groups
of per-recipient fields.  Each group of per-recipient fields is
preceded by a blank line.  Using the ABNF of RFC 822, the syntax of
the message/delivery-status content is as follows:</p>
<div class="highlight-python"><pre>delivery-status-content =  per-message-fields 1*
                          ( CRLF per-recipient-fields )</pre>
</div>
<p>The per-message fields are described in section 2.2.  The
per-recipient fields are described in section 2.3.</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="sentry.html">sentry</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="verp.html">VERP:Variable envelope return path</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>