

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MySQL &mdash; Note 1 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/theme_extras.js"></script>
    <link rel="top" title="Note 1 documentation" href="index.html" />
    <link rel="next" title="Cookie" href="cookie.html" />
    <link rel="prev" title="パターン" href="pattern.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Note 1 documentation</span></a></h1>
        <h2 class="heading"><span>MySQL</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="pattern.html">パターン</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="cookie.html">Cookie</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="mysql">
<h1><a class="toc-backref" href="#id11">MySQL</a><a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="id1">
<p class="topic-title first">MySQL</p>
<ul class="simple">
<li><a class="reference internal" href="#mysql" id="id11">MySQL</a><ul>
<li><a class="reference internal" href="#install" id="id12">Install</a></li>
<li><a class="reference internal" href="#management" id="id13">management</a><ul>
<li><a class="reference internal" href="#id4" id="id14">トレースをとるには？</a></li>
<li><a class="reference internal" href="#id5" id="id15">特権ユーザ−</a></li>
<li><a class="reference internal" href="#id6" id="id16">ユーザー一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql" id="id17">SQL</a></li>
<li><a class="reference internal" href="#mysqldump" id="id18">mysqldump</a><ul>
<li><a class="reference internal" href="#fixturemysql" id="id19">Fixture用にMySQLダンプを作る</a><ul>
<li><a class="reference internal" href="#complete-insert" id="id20"><strong>complete-insert</strong>  で可変カラム対応</a></li>
<li><a class="reference internal" href="#sql-skip-extended-insert" id="id21">1行1SQLで落とす ( &#8211;skip-extended-insert )</a></li>
<li><a class="reference internal" href="#id9" id="id22">指定したテーブルのみ</a></li>
<li><a class="reference internal" href="#ddl" id="id23">DDL文のみ</a></li>
<li><a class="reference internal" href="#id10" id="id24">データのみ</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#trouble" id="id25">Trouble</a></li>
<li><a class="reference internal" href="#python" id="id26">Python</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="install">
<h2><a class="toc-backref" href="#id12">Install</a><a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="debian.html"><em>Debian Linux</em></a></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo aptitude install mysql-server -y
<span class="nv">$ </span>sudo aptitude install libmysqlclient-dev -y
</pre></div>
</div>
<p><a class="reference internal" href="python.html"><em>Python</em></a> binding</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pip install MySQL-python
</pre></div>
</div>
</div>
<div class="section" id="management">
<h2><a class="toc-backref" href="#id13">management</a><a class="headerlink" href="#management" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://hdknr.com/post/80662982/mysql-set-password-for">パスワード変更</a></li>
<li><a class="reference external" href="http://dev.mysql.com/doc/refman/4.1/ja/resetting-permissions.html">パスワードリセット</a></li>
<li></li>
</ul>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id14">トレースをとるには？</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>my.cnf に ログファイルの場所を指定してリスタート ( RedHat? : /etc/my.cnf , Debian : /etc/mysql/my.cnf )</li>
</ul>
<div class="highlight-python"><pre>[mysqld]
log=/tmp/xxx.log
# Debian では /etc/mysql/my.cnfにコメントアウトされているlogエントリを使ったほうがいいです。</pre>
</div>
<ul class="simple">
<li>Debianでは /var/log/mysql/mysql.log がデフォルトのようです。</li>
</ul>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id15">特権ユーザ−</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">REVOKE</span> <span class="k">ALL</span> <span class="n">PRIVILEGES</span> <span class="k">ON</span> <span class="o">*</span> <span class="p">.</span> <span class="o">*</span> <span class="k">FROM</span>  <span class="s1">&#39;prospects&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="p">;</span>

<span class="k">GRANT</span> <span class="k">ALL</span> <span class="n">PRIVILEGES</span> <span class="k">ON</span> <span class="o">*</span> <span class="p">.</span> <span class="o">*</span> <span class="k">TO</span>  <span class="s1">&#39;prospects&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span> <span class="k">WITH</span> <span class="k">GRANT</span> <span class="k">OPTION</span> <span class="n">MAX_QUERIES_PER_HOUR</span> <span class="mi">0</span> <span class="n">MAX_CONNECTIONS_PER_HOUR</span> <span class="mi">0</span> <span class="n">MAX_UPDATES_PER_HOUR</span> <span class="mi">0</span> <span class="n">MAX_USER_CONNECTIONS</span> <span class="mi">0</span> <span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id16">ユーザー一覧</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">User</span><span class="p">,</span> <span class="n">Password</span> <span class="k">FROM</span> <span class="n">mysql</span><span class="p">.</span><span class="n">user</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sql">
<h2><a class="toc-backref" href="#id17">SQL</a><a class="headerlink" href="#sql" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>年月集約</li>
</ul>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">select</span> <span class="nf">date_format</span><span class="p">(</span><span class="n">card_expire</span><span class="p">,</span> <span class="s1">&#39;%%Y-%%m&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">month</span><span class="p">,</span> <span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">count</span>
<span class="k">from</span> <span class="n">credit_card</span>
<span class="k">group</span> <span class="k">by</span> <span class="nf">date_format</span><span class="p">(</span><span class="n">card_expire</span><span class="p">,</span> <span class="s1">&#39;%%Y-%%m&#39;</span><span class="p">)</span>
<span class="n">oorder</span> <span class="k">by</span> <span class="n">card_expire</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>テーブルコピー</li>
</ul>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">create</span> <span class="k">table</span> <span class="n">myiduser_bk</span> <span class="k">as</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">myiduser</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><a class="reference external" href="http://dev.mysql.com/doc/refman/5.1/ja/regexp.html">正規表現</a></li>
</ul>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">select</span> <span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="n">HOGE</span> <span class="k">where</span> <span class="n">userid</span>  <span class="k">REGEXP</span> <span class="s1">&#39;[[:digit:]]{6}&#39;</span><span class="p">;</span>
<span class="k">select</span> <span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="n">HOGE</span> <span class="k">where</span> <span class="n">userid</span> <span class="k">NOT</span> <span class="k">REGEXP</span> <span class="s1">&#39;[[:digit:]]{6}&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>データベース作成</li>
</ul>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="ss">`newdatabase`</span> <span class="k">DEFAULT</span> <span class="k">CHARACTER</span> <span class="kt">SET</span> <span class="n">utf8</span> <span class="k">COLLATE</span> <span class="n">utf8_general_ci</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">on</span> <span class="n">newdatabase</span><span class="p">.</span><span class="o">*</span> <span class="k">to</span> <span class="s1">&#39;newdatabase_user&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span> <span class="n">identified</span> <span class="k">by</span> <span class="s1">&#39;newdatabase_password&#39;</span> <span class="k">WITH</span> <span class="k">GRANT</span> <span class="k">OPTION</span><span class="p">;</span>
</pre></div>
</div>
<ul>
<li><p class="first">encoding</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://hidelafoglia.livejournal.com/47093.html">xoops: ujis環境のxoopsをutf8環境にあるmysql に移行</a></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-mysql"><div class="highlight"><pre><span class="kt">SET</span> <span class="k">CHARACTER</span> <span class="kt">SET</span> <span class="n">utf8</span><span class="p">;</span>
</pre></div>
</div>
<p>エンコーディング確認</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">show</span> <span class="n">variables</span> <span class="k">like</span> <span class="s2">&quot;char%&quot;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><a class="reference external" href="http://harajuku-tech.posterous.com/mysql37-collationitpro">照合順序</a></li>
</ul>
</div>
<div class="section" id="mysqldump">
<h2><a class="toc-backref" href="#id18">mysqldump</a><a class="headerlink" href="#mysqldump" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fixturemysql">
<h3><a class="toc-backref" href="#id19">Fixture用にMySQLダンプを作る</a><a class="headerlink" href="#fixturemysql" title="Permalink to this headline">¶</a></h3>
<div class="section" id="complete-insert">
<h4><a class="toc-backref" href="#id20"><strong>complete-insert</strong>  で可変カラム対応</a><a class="headerlink" href="#complete-insert" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>スキーマが変わるとエラーになる</li>
</ul>
<div class="highlight-python"><pre>ERROR 1136 (21S01) : Column count doesn't match value count at row 1</pre>
</div>
<ul class="simple">
<li><strong>complete-insert</strong>  オプションでdump を作成する。</li>
</ul>
<div class="highlight-python"><pre>$ mysqldump -u $ROOT --password=$PWD --no-create-info --complete-insert  $APP_DB &gt; ../dump.sql

--complete-insert  , -c (小文字のc)
--no-create-info   , -t</pre>
</div>
</div>
<div class="section" id="sql-skip-extended-insert">
<h4><a class="toc-backref" href="#id21">1行1SQLで落とす ( &#8211;skip-extended-insert )</a><a class="headerlink" href="#sql-skip-extended-insert" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>$ mysqldump -c --order-by-primary --skip-extended-insert -u root --password=password mydb</pre>
</div>
</div>
<div class="section" id="id9">
<h4><a class="toc-backref" href="#id22">指定したテーブルのみ</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>$ mysqldump -u ユーザ名 -p -t データベース名 テーブル1 テーブル2...&gt; ファイル名</pre>
</div>
</div>
<div class="section" id="ddl">
<h4><a class="toc-backref" href="#id23">DDL文のみ</a><a class="headerlink" href="#ddl" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">data</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h4><a class="toc-backref" href="#id24">データのみ</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">create</span><span class="o">-</span><span class="n">info</span>    <span class="p">,</span> <span class="o">-</span><span class="n">t</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="trouble">
<h2><a class="toc-backref" href="#id25">Trouble</a><a class="headerlink" href="#trouble" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>PHPで確認</li>
</ul>
<div class="highlight-python"><pre>$link = mysql_connect($host_url,$user,$pass) or  die('Could not connect: ' . mysql_error());</pre>
</div>
</div>
<div class="section" id="python">
<h2><a class="toc-backref" href="#id26">Python</a><a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://harajuku-tech.posterous.com/django-mysql">Django: MySQLのテーブルデータサイズなどの取得</a></li>
</ul>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="pattern.html">パターン</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="cookie.html">Cookie</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>