

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>django.views.generic.create_update &mdash; Django Cheat 1 documentation</title>
    
    <link rel="stylesheet" href="../../../../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../../static/doctools.js"></script>
    <script type="text/javascript" src="../../../../static/theme_extras.js"></script>
    <link rel="top" title="Django Cheat 1 documentation" href="../../../../index.html" />
    <link rel="up" title="django.views.generic" href="../generic.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../../../index.html">
          <span>Django Cheat 1 documentation</span></a></h1>
        <h2 class="heading"><span>django.views.generic.create_update</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for django.views.generic.create_update</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="n">ModelFormMetaclass</span><span class="p">,</span> <span class="n">ModelForm</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">RequestContext</span><span class="p">,</span> <span class="n">loader</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">Http404</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.core.xheaders</span> <span class="kn">import</span> <span class="n">populate_xheaders</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ObjectDoesNotExist</span><span class="p">,</span> <span class="n">ImproperlyConfigured</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.views</span> <span class="kn">import</span> <span class="n">redirect_to_login</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">GenericViewError</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">messages</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
    <span class="s">&#39;Function-based generic views have been deprecated; use class-based views instead.&#39;</span><span class="p">,</span>
    <span class="ne">DeprecationWarning</span>
<span class="p">)</span>


<div class="viewcode-block" id="apply_extra_context"><a class="viewcode-back" href="../../../../django.views.generic.html#django.views.generic.create_update.apply_extra_context">[docs]</a><span class="k">def</span> <span class="nf">apply_extra_context</span><span class="p">(</span><span class="n">extra_context</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds items from extra_context dict to context.  If a value in extra_context</span>
<span class="sd">    is callable, then it is called and the result is added to context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extra_context</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="get_model_and_form_class"><a class="viewcode-back" href="../../../../django.views.generic.html#django.views.generic.create_update.get_model_and_form_class">[docs]</a><span class="k">def</span> <span class="nf">get_model_and_form_class</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">form_class</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a model and form class based on the model and form_class</span>
<span class="sd">    parameters that were passed to the generic view.</span>

<span class="sd">    If ``form_class`` is given then its associated model will be returned along</span>
<span class="sd">    with ``form_class`` itself.  Otherwise, if ``model`` is given, ``model``</span>
<span class="sd">    itself will be returned along with a ``ModelForm`` class created from</span>
<span class="sd">    ``model``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">form_class</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">form_class</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">form_class</span>
    <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
        <span class="c"># The inner Meta class fails if model = model is used for some reason.</span>
        <span class="n">tmp_model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="c"># TODO: we should be able to construct a ModelForm without creating</span>
        <span class="c"># and passing in a temporary inner class.</span>
        <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">tmp_model</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&#39;Form&#39;</span>
        <span class="n">form_class</span> <span class="o">=</span> <span class="n">ModelFormMetaclass</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="p">(</span><span class="n">ModelForm</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;Meta&#39;</span><span class="p">:</span> <span class="n">Meta</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">form_class</span>
    <span class="k">raise</span> <span class="n">GenericViewError</span><span class="p">(</span><span class="s">&quot;Generic view must be called with either a model or&quot;</span>
                           <span class="s">&quot; form_class argument.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="redirect"><a class="viewcode-back" href="../../../../django.views.generic.html#django.views.generic.create_update.redirect">[docs]</a><span class="k">def</span> <span class="nf">redirect</span><span class="p">(</span><span class="n">post_save_redirect</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a HttpResponseRedirect to ``post_save_redirect``.</span>

<span class="sd">    ``post_save_redirect`` should be a string, and can contain named string-</span>
<span class="sd">    substitution place holders of ``obj`` field names.</span>

<span class="sd">    If ``post_save_redirect`` is None, then redirect to ``obj``&#39;s URL returned</span>
<span class="sd">    by ``get_absolute_url()``.  If ``obj`` has no ``get_absolute_url`` method,</span>
<span class="sd">    then raise ImproperlyConfigured.</span>

<span class="sd">    This function is meant to handle the post_save_redirect parameter to the</span>
<span class="sd">    ``create_object`` and ``update_object`` views.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">post_save_redirect</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">post_save_redirect</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;get_absolute_url&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
            <span class="s">&quot;No URL to redirect to.  Either pass a post_save_redirect&quot;</span>
            <span class="s">&quot; parameter to the generic view or define a get_absolute_url&quot;</span>
            <span class="s">&quot; method on the Model.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="lookup_object"><a class="viewcode-back" href="../../../../django.views.generic.html#django.views.generic.create_update.lookup_object">[docs]</a><span class="k">def</span> <span class="nf">lookup_object</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">object_id</span><span class="p">,</span> <span class="n">slug</span><span class="p">,</span> <span class="n">slug_field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the ``model`` object with the passed ``object_id``.  If</span>
<span class="sd">    ``object_id`` is None, then return the object whose ``slug_field``</span>
<span class="sd">    equals the passed ``slug``.  If ``slug`` and ``slug_field`` are not passed,</span>
<span class="sd">    then raise Http404 exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lookup_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">object_id</span><span class="p">:</span>
        <span class="n">lookup_kwargs</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">__exact&#39;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_id</span>
    <span class="k">elif</span> <span class="n">slug</span> <span class="ow">and</span> <span class="n">slug_field</span><span class="p">:</span>
        <span class="n">lookup_kwargs</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">__exact&#39;</span> <span class="o">%</span> <span class="n">slug_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">slug</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">GenericViewError</span><span class="p">(</span>
            <span class="s">&quot;Generic view must be called with either an object_id or a&quot;</span>
            <span class="s">&quot; slug/slug_field.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">**</span><span class="n">lookup_kwargs</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Http404</span><span class="p">(</span><span class="s">&quot;No </span><span class="si">%s</span><span class="s"> found for </span><span class="si">%s</span><span class="s">&quot;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> <span class="n">lookup_kwargs</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="create_object"><a class="viewcode-back" href="../../../../django.views.generic.html#django.views.generic.create_update.create_object">[docs]</a><span class="k">def</span> <span class="nf">create_object</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">template_loader</span><span class="o">=</span><span class="n">loader</span><span class="p">,</span> <span class="n">extra_context</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">post_save_redirect</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">login_required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">context_processors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic object-creation function.</span>

<span class="sd">    Templates: ``&lt;app_label&gt;/&lt;model_name&gt;_form.html``</span>
<span class="sd">    Context:</span>
<span class="sd">        form</span>
<span class="sd">            the form for the object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">extra_context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">extra_context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">login_required</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">redirect_to_login</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="n">model</span><span class="p">,</span> <span class="n">form_class</span> <span class="o">=</span> <span class="n">get_model_and_form_class</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">form_class</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">new_object</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="n">ugettext</span><span class="p">(</span><span class="s">&quot;The </span><span class="si">%(verbose_name)s</span><span class="s"> was created successfully.&quot;</span><span class="p">)</span> <span class="o">%</span>\
                                    <span class="p">{</span><span class="s">&quot;verbose_name&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">}</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">fail_silently</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">post_save_redirect</span><span class="p">,</span> <span class="n">new_object</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">()</span>

    <span class="c"># Create the template, context, response</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">template_name</span><span class="p">:</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">_form.html&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">template_loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">{</span>
        <span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
    <span class="p">},</span> <span class="n">context_processors</span><span class="p">)</span>
    <span class="n">apply_extra_context</span><span class="p">(</span><span class="n">extra_context</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="update_object"><a class="viewcode-back" href="../../../../django.views.generic.html#django.views.generic.create_update.update_object">[docs]</a><span class="k">def</span> <span class="nf">update_object</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">slug_field</span><span class="o">=</span><span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">template_loader</span><span class="o">=</span><span class="n">loader</span><span class="p">,</span>
        <span class="n">extra_context</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">post_save_redirect</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">login_required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">context_processors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">template_object_name</span><span class="o">=</span><span class="s">&#39;object&#39;</span><span class="p">,</span>
        <span class="n">form_class</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic object-update function.</span>

<span class="sd">    Templates: ``&lt;app_label&gt;/&lt;model_name&gt;_form.html``</span>
<span class="sd">    Context:</span>
<span class="sd">        form</span>
<span class="sd">            the form for the object</span>
<span class="sd">        object</span>
<span class="sd">            the original object being edited</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">extra_context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">extra_context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">login_required</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">redirect_to_login</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="n">model</span><span class="p">,</span> <span class="n">form_class</span> <span class="o">=</span> <span class="n">get_model_and_form_class</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">form_class</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">lookup_object</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">object_id</span><span class="p">,</span> <span class="n">slug</span><span class="p">,</span> <span class="n">slug_field</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">ugettext</span><span class="p">(</span><span class="s">&quot;The </span><span class="si">%(verbose_name)s</span><span class="s"> was updated successfully.&quot;</span><span class="p">)</span> <span class="o">%</span>\
                                    <span class="p">{</span><span class="s">&quot;verbose_name&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">}</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">fail_silently</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">post_save_redirect</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">template_name</span><span class="p">:</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">_form.html&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">template_loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">{</span>
        <span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="n">template_object_name</span><span class="p">:</span> <span class="n">obj</span><span class="p">,</span>
    <span class="p">},</span> <span class="n">context_processors</span><span class="p">)</span>
    <span class="n">apply_extra_context</span><span class="p">(</span><span class="n">extra_context</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
    <span class="n">populate_xheaders</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">attname</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">response</span>
</div>
<div class="viewcode-block" id="delete_object"><a class="viewcode-back" href="../../../../django.views.generic.html#django.views.generic.create_update.delete_object">[docs]</a><span class="k">def</span> <span class="nf">delete_object</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">post_delete_redirect</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">slug</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">slug_field</span><span class="o">=</span><span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">template_loader</span><span class="o">=</span><span class="n">loader</span><span class="p">,</span> <span class="n">extra_context</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">login_required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">context_processors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">template_object_name</span><span class="o">=</span><span class="s">&#39;object&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic object-delete function.</span>

<span class="sd">    The given template will be used to confirm deletetion if this view is</span>
<span class="sd">    fetched using GET; for safty, deletion will only be performed if this</span>
<span class="sd">    view is POSTed.</span>

<span class="sd">    Templates: ``&lt;app_label&gt;/&lt;model_name&gt;_confirm_delete.html``</span>
<span class="sd">    Context:</span>
<span class="sd">        object</span>
<span class="sd">            the original object being deleted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">extra_context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">extra_context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">login_required</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">redirect_to_login</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">lookup_object</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">object_id</span><span class="p">,</span> <span class="n">slug</span><span class="p">,</span> <span class="n">slug_field</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">ugettext</span><span class="p">(</span><span class="s">&quot;The </span><span class="si">%(verbose_name)s</span><span class="s"> was deleted.&quot;</span><span class="p">)</span> <span class="o">%</span>\
                                    <span class="p">{</span><span class="s">&quot;verbose_name&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">}</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">fail_silently</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">post_delete_redirect</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">template_name</span><span class="p">:</span>
            <span class="n">template_name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">_confirm_delete.html&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">template_loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">template_object_name</span><span class="p">:</span> <span class="n">obj</span><span class="p">,</span>
        <span class="p">},</span> <span class="n">context_processors</span><span class="p">)</span>
        <span class="n">apply_extra_context</span><span class="p">(</span><span class="n">extra_context</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="n">populate_xheaders</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">attname</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">response</span></div>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>