

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>django.contrib.gis.maps.google.gmap &mdash; Django Cheat 1 documentation</title>
    
    <link rel="stylesheet" href="../../../../../../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../../static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../../static/theme_extras.js"></script>
    <link rel="top" title="Django Cheat 1 documentation" href="../../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../../../../../index.html">
          <span>Django Cheat 1 documentation</span></a></h1>
        <h2 class="heading"><span>django.contrib.gis.maps.google.gmap</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        <a class="uplink" href="../../../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for django.contrib.gis.maps.google.gmap</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.contrib.gis</span> <span class="kn">import</span> <span class="n">geos</span>
<span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>
<span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>

<span class="k">class</span> <span class="nc">GoogleMapException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>
<span class="kn">from</span> <span class="nn">django.contrib.gis.maps.google.overlays</span> <span class="kn">import</span> <span class="n">GPolygon</span><span class="p">,</span> <span class="n">GPolyline</span><span class="p">,</span> <span class="n">GMarker</span><span class="p">,</span> <span class="n">GIcon</span>

<span class="c"># The default Google Maps URL (for the API javascript)</span>
<span class="c"># TODO: Internationalize for Japan, UK, etc.</span>
<span class="n">GOOGLE_MAPS_URL</span><span class="o">=</span><span class="s">&#39;http://maps.google.com/maps?file=api&amp;amp;v=</span><span class="si">%s</span><span class="s">&amp;amp;key=&#39;</span>

<div class="viewcode-block" id="GoogleMap"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap">[docs]</a><span class="k">class</span> <span class="nc">GoogleMap</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">&quot;A class for generating Google Maps JavaScript.&quot;</span>

    <span class="c"># String constants</span>
    <span class="n">onunload</span> <span class="o">=</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;onunload=&quot;GUnload()&quot;&#39;</span><span class="p">)</span> <span class="c"># Cleans up after Google Maps</span>
    <span class="n">vml_css</span>  <span class="o">=</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;v\:* {behavior:url(#default#VML);}&#39;</span><span class="p">)</span> <span class="c"># CSS for IE VML</span>
    <span class="n">xmlns</span>    <span class="o">=</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;xmlns:v=&quot;urn:schemas-microsoft-com:vml&quot;&#39;</span><span class="p">)</span> <span class="c"># XML Namespace (for IE VML).</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">api_url</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">center</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dom_id</span><span class="o">=</span><span class="s">&#39;map&#39;</span><span class="p">,</span>
                 <span class="n">kml_urls</span><span class="o">=</span><span class="p">[],</span> <span class="n">polylines</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">polygons</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">template</span><span class="o">=</span><span class="s">&#39;gis/google/google-map.js&#39;</span><span class="p">,</span>
                 <span class="n">js_module</span><span class="o">=</span><span class="s">&#39;geodjango&#39;</span><span class="p">,</span>
                 <span class="n">extra_context</span><span class="o">=</span><span class="p">{}):</span>

        <span class="c"># The Google Maps API Key defined in the settings will be used</span>
        <span class="c"># if not passed in as a parameter.  The use of an API key is</span>
        <span class="c"># _required_.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">GOOGLE_MAPS_API_KEY</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GoogleMapException</span><span class="p">(</span><span class="s">&#39;Google Maps API Key not found (try adding GOOGLE_MAPS_API_KEY to your settings).&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

        <span class="c"># Getting the Google Maps API version, defaults to using the latest (&quot;2.x&quot;),</span>
        <span class="c"># this is not necessarily the most stable.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;GOOGLE_MAPS_API_VERSION&#39;</span><span class="p">,</span> <span class="s">&#39;2.x&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>

        <span class="c"># Can specify the API URL in the `api_url` keyword.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">mark_safe</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;GOOGLE_MAPS_URL&#39;</span><span class="p">,</span> <span class="n">GOOGLE_MAPS_URL</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">api_url</span>

        <span class="c"># Setting the DOM id of the map, the load function, the JavaScript</span>
        <span class="c"># template, and the KML URLs array.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dom_id</span> <span class="o">=</span> <span class="n">dom_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_context</span> <span class="o">=</span> <span class="n">extra_context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">js_module</span> <span class="o">=</span> <span class="n">js_module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kml_urls</span> <span class="o">=</span> <span class="n">kml_urls</span>

        <span class="c"># Does the user want any GMarker, GPolygon, and/or GPolyline overlays?</span>
        <span class="n">overlay_info</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GMarker</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="s">&#39;markers&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">GPolygon</span><span class="p">,</span> <span class="n">polygons</span><span class="p">,</span> <span class="s">&#39;polygons&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">GPolyline</span><span class="p">,</span> <span class="n">polylines</span><span class="p">,</span> <span class="s">&#39;polylines&#39;</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">overlay_class</span><span class="p">,</span> <span class="n">overlay_list</span><span class="p">,</span> <span class="n">varname</span> <span class="ow">in</span> <span class="n">overlay_info</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">overlay_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">overlay</span> <span class="ow">in</span> <span class="n">overlay_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">overlay_class</span><span class="p">):</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overlay_class</span><span class="p">(</span><span class="n">overlay</span><span class="p">))</span>

        <span class="c"># If GMarker, GPolygons, and/or GPolylines are used the zoom will be</span>
        <span class="c"># automatically calculated via the Google Maps API.  If both a zoom</span>
        <span class="c"># level and a center coordinate are provided with polygons/polylines,</span>
        <span class="c"># no automatic determination will occur.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_zoom</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polygons</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">polylines</span>  <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">zoom</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calc_zoom</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Defaults for the zoom level and center coordinates if the zoom</span>
        <span class="c"># is not automatically calculated.</span>
        <span class="k">if</span> <span class="n">zoom</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">zoom</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="n">zoom</span>
        <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>

<div class="viewcode-block" id="GoogleMap.render"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the JavaScript necessary for displaying this Google Map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;calc_zoom&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_zoom</span><span class="p">,</span>
                  <span class="s">&#39;center&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
                  <span class="s">&#39;dom_id&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dom_id</span><span class="p">,</span>
                  <span class="s">&#39;js_module&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">js_module</span><span class="p">,</span>
                  <span class="s">&#39;kml_urls&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kml_urls</span><span class="p">,</span>
                  <span class="s">&#39;zoom&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span>
                  <span class="s">&#39;polygons&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">polygons</span><span class="p">,</span>
                  <span class="s">&#39;polylines&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">polylines</span><span class="p">,</span>
                  <span class="s">&#39;icons&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">icons</span><span class="p">,</span>
                  <span class="s">&#39;markers&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="p">,</span>
                  <span class="p">}</span>
        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="GoogleMap.body"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap.body">[docs]</a>    <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns HTML body tag for loading and unloading Google Maps javascript.&quot;</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;&lt;body </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onunload</span><span class="p">))</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="GoogleMap.onload"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap.onload">[docs]</a>    <span class="k">def</span> <span class="nf">onload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns the `onload` HTML &lt;body&gt; attribute.&quot;</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;onload=&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">_load()&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">js_module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dom_id</span><span class="p">))</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="GoogleMap.api_script"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap.api_script">[docs]</a>    <span class="k">def</span> <span class="nf">api_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns the &lt;script&gt; tag for the Google Maps API javascript.&quot;</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;&lt;script src=&quot;</span><span class="si">%s%s</span><span class="s">&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">))</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="GoogleMap.js"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap.js">[docs]</a>    <span class="k">def</span> <span class="nf">js</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns only the generated Google Maps JavaScript (no &lt;script&gt; tags).&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="GoogleMap.scripts"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap.scripts">[docs]</a>    <span class="k">def</span> <span class="nf">scripts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns all &lt;script&gt;&lt;/script&gt; tags required with Google Maps JavaScript.&quot;</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">  &lt;script type=&quot;text/javascript&quot;&gt;</span><span class="se">\n</span><span class="s">//&lt;![CDATA[</span><span class="se">\n</span><span class="si">%s</span><span class="s">//]]&gt;</span><span class="se">\n</span><span class="s">  &lt;/script&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_script</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">js</span><span class="p">))</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="GoogleMap.style"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap.style">[docs]</a>    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns additional CSS styling needed for Google Maps on IE.&quot;</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;&lt;style type=&quot;text/css&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/style&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">vml_css</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="GoogleMap.xhtml"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap.xhtml">[docs]</a>    <span class="k">def</span> <span class="nf">xhtml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns XHTML information needed for IE VML overlays.&quot;</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlns</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="GoogleMap.icons"><a class="viewcode-back" href="../../../../../../django.contrib.gis.maps.google.html#django.contrib.gis.maps.google.gmap.GoogleMap.icons">[docs]</a>    <span class="k">def</span> <span class="nf">icons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns a sequence of GIcon objects in this map.&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">marker</span><span class="o">.</span><span class="n">icon</span> <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span> <span class="k">if</span> <span class="n">marker</span><span class="o">.</span><span class="n">icon</span><span class="p">])</span>
</div></div>
<span class="k">class</span> <span class="nc">GoogleMapSet</span><span class="p">(</span><span class="n">GoogleMap</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A class for generating sets of Google Maps that will be shown on the</span>
<span class="sd">        same page together.</span>

<span class="sd">        Example:</span>
<span class="sd">         gmapset = GoogleMapSet( GoogleMap( ... ), GoogleMap( ... ) )</span>
<span class="sd">         gmapset = GoogleMapSet( [ gmap1, gmap2] )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># The `google-multi.js` template is used instead of `google-single.js`</span>
        <span class="c"># by default.</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;template&#39;</span><span class="p">,</span> <span class="s">&#39;gis/google/google-multi.js&#39;</span><span class="p">)</span>

        <span class="c"># This is the template used to generate the GMap load JavaScript for</span>
        <span class="c"># each map in the set.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_template</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;map_template&#39;</span><span class="p">,</span> <span class="s">&#39;gis/google/google-single.js&#39;</span><span class="p">)</span>

        <span class="c"># Running GoogleMap.__init__(), and resetting the template</span>
        <span class="c"># value with default obtained above.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GoogleMapSet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>

        <span class="c"># If a tuple/list passed in as first element of args, then assume</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="n">args</span>

        <span class="c"># Generating DOM ids for each of the maps in the set.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dom_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;map</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">load_map_js</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns JavaScript containing all of the loading routines for each</span>
<span class="sd">        map in this set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dom_id</span><span class="p">,</span> <span class="n">gmap</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dom_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">):</span>
            <span class="c"># Backup copies the GoogleMap DOM id and template attributes.</span>
            <span class="c"># They are overridden on each GoogleMap instance in the set so</span>
            <span class="c"># that only the loading JavaScript (and not the header variables)</span>
            <span class="c"># is used with the generated DOM ids.</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">gmap</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">gmap</span><span class="o">.</span><span class="n">dom_id</span><span class="p">)</span>
            <span class="n">gmap</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_template</span>
            <span class="n">gmap</span><span class="o">.</span><span class="n">dom_id</span> <span class="o">=</span> <span class="n">dom_id</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gmap</span><span class="o">.</span><span class="n">js</span><span class="p">)</span>
            <span class="c"># Restoring the backup values.</span>
            <span class="n">gmap</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">gmap</span><span class="o">.</span><span class="n">dom_id</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the JavaScript for the collection of Google Maps in</span>
<span class="sd">        this set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;js_module&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">js_module</span><span class="p">,</span>
                  <span class="s">&#39;dom_ids&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dom_ids</span><span class="p">,</span>
                  <span class="s">&#39;load_map_js&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_map_js</span><span class="p">(),</span>
                  <span class="s">&#39;icons&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">icons</span><span class="p">,</span>
                  <span class="p">}</span>
        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">onload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns the `onload` HTML &lt;body&gt; attribute.&quot;</span>
        <span class="c"># Overloaded to use the `load` function defined in the</span>
        <span class="c"># `google-multi.js`, which calls the load routines for</span>
        <span class="c"># each one of the individual maps in the set.</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;onload=&quot;</span><span class="si">%s</span><span class="s">.load()&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">js_module</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">icons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns a sequence of all icons in each map of the set.&quot;</span>
        <span class="n">icons</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">:</span> <span class="n">icons</span> <span class="o">|=</span> <span class="nb">map</span><span class="o">.</span><span class="n">icons</span>
        <span class="k">return</span> <span class="n">icons</span>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        <a class="uplink" href="../../../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre.
    </div>
  </body>
</html>