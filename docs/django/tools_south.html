

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>south &mdash; Django Cheat 1 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/theme_extras.js"></script>
    <link rel="top" title="Django Cheat 1 documentation" href="index.html" />
    <link rel="up" title="Models" href="tools.html" />
    <link rel="next" title="mandb" href="tools_mandb.html" />
    <link rel="prev" title="Models" href="tools.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Django Cheat 1 documentation</span></a></h1>
        <h2 class="heading"><span>south</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="tools.html">Models</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="tools_mandb.html">mandb</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="south">
<h1><a class="toc-backref" href="#id7">south</a><a class="headerlink" href="#south" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="id1">
<p class="topic-title first">South</p>
<ul class="simple">
<li><a class="reference internal" href="#south" id="id7">south</a><ul>
<li><a class="reference internal" href="#id2" id="id8">リソース</a></li>
<li><a class="reference internal" href="#id3" id="id9">インストール</a><ul>
<li><a class="reference internal" href="#settings-py" id="id10">settings.py</a></li>
<li><a class="reference internal" href="#syncdb" id="id11">syncdb</a></li>
<li><a class="reference internal" href="#schemamigration-initial" id="id12">初期化(schemamigration &#8211;initial)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4" id="id13">モデル修正</a></li>
<li><a class="reference internal" href="#id5" id="id14">マイグレーションスクリプト作成</a></li>
<li><a class="reference internal" href="#id6" id="id15">マイグレート</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id8">リソース</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>チュートリアル : <a class="reference external" href="http://ae35.bitbucket.org/south-doc-ja/tutorial/">http://ae35.bitbucket.org/south-doc-ja/tutorial/</a></li>
</ul>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id9">インストール</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>$ pip install South
Downloading/unpacking South
  Downloading South-0.7.3.tar.gz (70Kb): 70Kb downloaded
  Running setup.py egg_info for package South
Installing collected packages: South
  Running setup.py install for South
Successfully installed South
Cleaning up...</pre>
</div>
<div class="highlight-python"><pre>yolk -l | grep South
South           - 0.7.3        - active</pre>
</div>
<div class="section" id="settings-py">
<h3><a class="toc-backref" href="#id10">settings.py</a><a class="headerlink" href="#settings-py" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ svn diff settings.py

Index: settings.py
===================================================================
--- settings.py (リビジョン 1006)
+++ settings.py (作業コピー)
@@ -155,5 +155,9 @@
 }

 #
+INSTALLED_APPS +=('south',)  #: for Model Migration</pre>
</div>
</div>
<div class="section" id="syncdb">
<h3><a class="toc-backref" href="#id11">syncdb</a><a class="headerlink" href="#syncdb" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>syncdb忘れずに</li>
</ul>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ python manage.py syncdb
Syncing...
Creating tables ...
Creating table south_migrationhistory
Installing custom SQL ...
Installing indexes ...
Installed 25 object(s) from 1 fixture(s)

Synced:
 &gt; django.contrib.auth
 &gt; django.contrib.contenttypes
 &gt; django.contrib.sessions
 &gt; django.contrib.sites
 &gt; django.contrib.messages
 &gt; django.contrib.staticfiles
 &gt; django.contrib.admin
 &gt; south

Not synced (use migrations):
 - membership
(use ./manage.py migrate to migrate these)</pre>
</div>
</div>
<div class="section" id="schemamigration-initial">
<h3><a class="toc-backref" href="#id12">初期化(schemamigration &#8211;initial)</a><a class="headerlink" href="#schemamigration-initial" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ python manage.py schemamigration  membership --initial
Creating migrations directory at '/home/hdknr/ve/main/src/remote/membership/migrations'...
Creating __init__.py in '/home/hdknr/ve/main/src/remote/membership/migrations'...
 + Added model membership.Member
 + Added model membership.Prospect
 + Added model membership.Service
 + Added model membership.Order
 + Added model membership.MemberSerial
Created 0001_initial.py. You can now apply this migration with: ./manage.py migrate membership</pre>
</div>
<ul class="simple">
<li>この時点で migrations ディレクトリが作成される</li>
</ul>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ svn status
M       settings.py
?       membership/migrations
(main)hdknr@sqg:~/ve/main/src/c
}}}
{{{
(main)hdknr@sqg:~/ve/main/src/remote$ tree membership/migrations/
membership/migrations/
├── 0001_initial.py
├── __init__.py
└── __init__.pyc

0 directories, 3 files</pre>
</div>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/ve/main/src/remote$ wc membership/migrations/*.py
  301  1175 24811 membership/migrations/0001_initial.py
    0     0     0 membership/migrations/__init__.py
  301  1175 24811 合計</pre>
</div>
<ul class="simple">
<li>既にテーブルがあるので、&#8211;fake で最初のマイグレーションを走らせる</li>
</ul>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ python manage.py migrate  membership --fake 0001
 - Soft matched migration 0001 to 0001_initial.
Running migrations for membership:
 - Migrating forwards to 0001_initial.
 &gt; membership:0001_initial
   (faked)</pre>
</div>
<ul class="simple">
<li>この時点でヒストリが作成</li>
</ul>
<div class="highlight-python"><pre>mysql&gt; select * from south_migrationhistory;
+----+------------+--------------+---------------------+
| id | app_name   | migration    | applied             |
+----+------------+--------------+---------------------+
|  2 | membership | 0001_initial | 2012-02-19 19:50:53 |
+----+------------+--------------+---------------------+
1 row in set (0.06 sec)</pre>
</div>
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id13">モデル修正</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>membership.models.Memberにフィールドを追加する</li>
</ul>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ vi membership/models.py
(main)hdknr@sqg:~/remote$ svn diff
Index: membership/models.py
===================================================================
--- membership/models.py        (リビジョン 1010)
+++ membership/models.py        (作業コピー)
@@ -102,7 +102,9 @@

     objects = MemberManager()

+    has_error = models.BooleanField(u'エラー修了',default=False, )</pre>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id14">マイグレーションスクリプト作成</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>マイグレーション名を指定せずに &#8211;auto でマイグレーションスクリプトを生成させる</li>
</ul>
</div></blockquote>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ python manage.py schemamigration membership --auto
 + Added field has_error on membership.Member
Created 0002_auto__add_field_member_has_error.py.
You can now apply this migration with: ./manage.py migrate membership</pre>
</div>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ svn status
M       membership/models.py
?       membership/migrations/0002_auto__add_field_member_has_error.py</pre>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id15">マイグレート</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>マイグレーション</li>
</ul>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ python manage.py migrate membership
Running migrations for membership:
 - Migrating forwards to 0002_auto__add_field_member_has_error.
 &gt; membership:0002_auto__add_field_member_has_error
 - Loading initial data for membership.
Installed 25 object(s) from 1 fixture(s)</pre>
</div>
<ul class="simple">
<li>テーブルに追加されている (<a class="reference internal" href="tools_mandb.html"><em>mandb</em></a> )</li>
</ul>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ python manage.py db --c ddl --t membership_member;

CREATE TABLE `membership_member` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  -- 途中省略
  --
  `has_error` tinyint(1) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=304 DEFAULT CHARSET=utf8;
}}}</pre>
</div>
<ul class="simple">
<li>ヒストリ 確認</li>
</ul>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ python manage.py db --c data --t south_migrationhistory &gt; membership/migrations/hsitory.sql</pre>
</div>
<div class="highlight-python"><pre>(main)hdknr@sqg:~/remote$ grep INSERT membership/migrations/history.sql

INSERT INTO `south_migrationhistory`
(`id`, `app_name`, `migration`, `applied`)
VALUES
(1,'membership','0001_initial','2012-02-19 19:50:53'),
(2,'membership','0002_auto__add_field_member_has_error','2012-02-19 19:52:52');</pre>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="tools.html">Models</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="tools_mandb.html">mandb</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre.
    </div>
  </body>
</html>