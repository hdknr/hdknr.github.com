

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Frequently Asked Questions &mdash; Celery 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../static/theme_extras.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="Celery 1 documentation" href="../index.html" />
    <link rel="up" title="Celery Integration for Django" href="index.html" />
    <link rel="next" title="Cookbook" href="cookbook/index.html" />
    <link rel="prev" title="First steps with Django" href="getting-started/first-steps-with-django.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>Celery 1 documentation</span></a></h1>
        <h2 class="heading"><span>Frequently Asked Questions</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="getting-started/first-steps-with-django.html">First steps with Django</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="cookbook/index.html">Cookbook</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="generating-a-template-in-a-task-doesn-t-seem-to-respect-my-i18n-settings">
<h2>Generating a template in a task doesn&#8217;t seem to respect my i18n settings?<a class="headerlink" href="#generating-a-template-in-a-task-doesn-t-seem-to-respect-my-i18n-settings" title="Permalink to this headline">¶</a></h2>
<p><strong>Answer</strong>: To enable the Django translation machinery you need to activate
it with a language. <strong>Note</strong>: Be sure to reset to the previous language when
done.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">translation</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">prev_language</span> <span class="o">=</span> <span class="n">translation</span><span class="o">.</span><span class="n">get_language</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">render_template</span><span class="p">()</span>
<span class="gp">... </span><span class="k">finally</span><span class="p">:</span>
<span class="go">        translation.activate(prev_language)</span>
</pre></div>
</div>
<p>The common pattern here would be for the task to take a <tt class="docutils literal"><span class="pre">language</span></tt>
argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.decorators</span> <span class="kn">import</span> <span class="n">task</span>

<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">translation</span>
<span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">generate_report</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s">&quot;report.html&quot;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">prev_language</span> <span class="o">=</span> <span class="n">translation</span><span class="o">.</span><span class="n">get_language</span><span class="p">()</span>
    <span class="n">language</span> <span class="ow">and</span> <span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">prev_language</span><span class="p">)</span>
    <span class="n">save_report_somewhere</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-celery-test-suite-is-failing">
<h2>The celery test-suite is failing<a class="headerlink" href="#the-celery-test-suite-is-failing" title="Permalink to this headline">¶</a></h2>
<p><strong>Answer</strong>: If you&#8217;re running tests from your Django project, and the celery
test suite is failing in that context, then follow the steps below. If the
celery tests are failing in another context, please report an issue to our
issue tracker at GitHub:</p>
<blockquote>
<div><a class="reference external" href="http://github.com/celery/celery/issues/">http://github.com/celery/celery/issues/</a></div></blockquote>
<p>That Django is running tests for all applications in <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt>
by default is a pet peeve for many. You should use a test runner that either</p>
<blockquote>
<div><ol class="arabic simple">
<li>Explicitly lists the apps you want to run tests for, or</li>
<li>Make a test runner that skips tests for apps you don&#8217;t want to run.</li>
</ol>
</div></blockquote>
<p>For example the test runner that celery is using:</p>
<blockquote>
<div><a class="reference external" href="http://github.com/celery/celery/blob/f90491fe0194aa472b5aecdefe5cc83289e65e69/celery/tests/runners.py">http://github.com/celery/celery/blob/f90491fe0194aa472b5aecdefe5cc83289e65e69/celery/tests/runners.py</a></div></blockquote>
<p>To use this test runner, add the following to your <tt class="docutils literal"><span class="pre">settings.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TEST_RUNNER</span> <span class="o">=</span> <span class="s">&quot;djcelery.tests.runners.CeleryTestSuiteRunner&quot;</span><span class="p">,</span>
<span class="n">TEST_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&quot;app1&quot;</span><span class="p">,</span>
    <span class="s">&quot;app2&quot;</span><span class="p">,</span>
    <span class="s">&quot;app3&quot;</span><span class="p">,</span>
    <span class="s">&quot;app4&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Or, if you just want to skip the celery tests:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span><span class="o">.....</span><span class="p">)</span>
<span class="n">TEST_RUNNER</span> <span class="o">=</span> <span class="s">&quot;djcelery.tests.runners.CeleryTestSuiteRunner&quot;</span><span class="p">,</span>
<span class="n">TEST_APPS</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="o">!=</span> <span class="s">&quot;celery&quot;</span><span class="p">,</span> <span class="n">INSTALLED_APPS</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="getting-started/first-steps-with-django.html">First steps with Django</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="cookbook/index.html">Cookbook</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>