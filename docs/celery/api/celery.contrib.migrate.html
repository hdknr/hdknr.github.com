

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>celery.contrib.migrate &mdash; Celery 1 documentation</title>
    
    <link rel="stylesheet" href="../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/theme_extras.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="Celery 1 documentation" href="../index.html" />
    <link rel="up" title="API Reference" href="index.html" />
    <link rel="next" title="celery.contrib.rdb" href="celery.contrib.rdb.html" />
    <link rel="prev" title="celery.contrib.batches" href="celery.contrib.batches.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>Celery 1 documentation</span></a></h1>
        <h2 class="heading"><span>celery.contrib.migrate</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="celery.contrib.batches.html">celery.contrib.batches</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="celery.contrib.rdb.html">celery.contrib.rdb</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="celery-contrib-migrate">
<h1>celery.contrib.migrate<a class="headerlink" href="#celery-contrib-migrate" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id2">celery.contrib.migrate</a></li>
</ul>
</div>
<span class="target" id="module-celery.contrib.migrate"></span><div class="section" id="id1">
<h2><a class="toc-backref" href="#id2">celery.contrib.migrate</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Migration tools.</p>
<dl class="class">
<dt id="celery.contrib.migrate.State">
<em class="property">class </em><tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">State</tt><a class="reference internal" href="../modules/celery/contrib/migrate.html#State"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.State" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="celery.contrib.migrate.State.count">
<tt class="descname">count</tt><em class="property"> = 0</em><a class="headerlink" href="#celery.contrib.migrate.State.count" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="celery.contrib.migrate.State.filtered">
<tt class="descname">filtered</tt><em class="property"> = 0</em><a class="headerlink" href="#celery.contrib.migrate.State.filtered" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="celery.contrib.migrate.State.strtotal">
<tt class="descname">strtotal</tt><a class="reference internal" href="../modules/celery/contrib/migrate.html#State.strtotal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.State.strtotal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="celery.contrib.migrate.State.total_apx">
<tt class="descname">total_apx</tt><em class="property"> = 0</em><a class="headerlink" href="#celery.contrib.migrate.State.total_apx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="exception">
<dt id="celery.contrib.migrate.StopFiltering">
<em class="property">exception </em><tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">StopFiltering</tt><a class="reference internal" href="../modules/celery/contrib/migrate.html#StopFiltering"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.StopFiltering" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.expand_dest">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">expand_dest</tt><big>(</big><em>ret</em>, <em>exchange</em>, <em>routing_key</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#expand_dest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.expand_dest" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.filter_callback">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">filter_callback</tt><big>(</big><em>callback</em>, <em>tasks</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#filter_callback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.filter_callback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.filter_status">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">filter_status</tt><big>(</big><em>state</em>, <em>body</em>, <em>message</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#filter_status"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.filter_status" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.migrate_task">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">migrate_task</tt><big>(</big><em>producer</em>, <em>body_</em>, <em>message</em>, <em>queues=None</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#migrate_task"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.migrate_task" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.migrate_tasks">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">migrate_tasks</tt><big>(</big><em>source</em>, <em>dest</em>, <em>migrate=&lt;function migrate_task at 0x1087ff758&gt;</em>, <em>app=None</em>, <em>queues=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#migrate_tasks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.migrate_tasks" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.move">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">move</tt><big>(</big><em>predicate</em>, <em>connection=None</em>, <em>exchange=None</em>, <em>routing_key=None</em>, <em>source=None</em>, <em>app=None</em>, <em>callback=None</em>, <em>limit=None</em>, <em>transform=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#move"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.move" title="Permalink to this definition">¶</a></dt>
<dd><p>Find tasks by filtering them and move the tasks to a new queue.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>predicate</strong> &#8211; Predicate function used to filter messages to move.
Must accept the standard signature of <tt class="docutils literal"><span class="pre">(body,</span> <span class="pre">message)</span></tt> used
by Kombu consumer callbacks.  If the predicate wants the message
to be moved it should return the hostname of the worker to move it
to, otherwise it should return <tt class="xref py py-const docutils literal"><span class="pre">False</span></tt></li>
<li><strong>queues</strong> &#8211; A list of queues to consume from, if not specified
it will consume from all configured task queues in <tt class="docutils literal"><span class="pre">CELERY_QUEUES</span></tt>.</li>
<li><strong>predicate</strong> &#8211; <p>Filter function used to decide which messages
to move.  Must accept the standard signature of <tt class="docutils literal"><span class="pre">(body,</span> <span class="pre">message)</span></tt>
used by Kombu consumer callbacks. If the predicate wants the message
to be moved it must return either</p>
<blockquote>
<div><ol class="arabic">
<li>a tuple of <tt class="docutils literal"><span class="pre">(exchange,</span> <span class="pre">routing_key)</span></tt>, or</li>
<li>a <tt class="xref py py-class docutils literal"><span class="pre">Queue</span></tt> instance, or</li>
<li>any other true value which means the specified
<tt class="docutils literal"><span class="pre">exchange</span></tt> and <tt class="docutils literal"><span class="pre">routing_key</span></tt> arguments will be used.</li>
</ol>
</div></blockquote>
</li>
<li><strong>connection</strong> &#8211; Custom connection to use.</li>
<li><strong>source</strong> &#8211; Optional list of source queues to use instead of the
default (which is the queues in <a class="reference external" href="http://docs.celeryproject.org/en/latest/configuration.html#std:setting-CELERY_QUEUES" title="(in Celery v3.0)"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_QUEUES</span></tt></a>).
This list can also contain new <tt class="xref py py-class docutils literal"><span class="pre">Queue</span></tt> instances.</li>
<li><strong>exchange</strong> &#8211; Default destination exchange.</li>
<li><strong>routing_key</strong> &#8211; Default destination routing key.</li>
<li><strong>limit</strong> &#8211; Limit number of messages to filter.</li>
<li><strong>callback</strong> &#8211; Callback called after message moved,
with signature <tt class="docutils literal"><span class="pre">(state,</span> <span class="pre">body,</span> <span class="pre">message)</span></tt>.</li>
<li><strong>transform</strong> &#8211; Optional function to transform the return
value (destination) of the filter function.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Also supports the same keyword arguments as <a class="reference internal" href="#celery.contrib.migrate.start_filter" title="celery.contrib.migrate.start_filter"><tt class="xref py py-func docutils literal"><span class="pre">start_filter()</span></tt></a>.</p>
<p>To demonstrate, the <a class="reference internal" href="#celery.contrib.migrate.move_task_by_id" title="celery.contrib.migrate.move_task_by_id"><tt class="xref py py-func docutils literal"><span class="pre">move_task_by_id()</span></tt></a> operation can be implemented
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_wanted_task</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wanted_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="n">Exchange</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">),</span>
                     <span class="n">routing_key</span><span class="o">=</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>

<span class="n">move</span><span class="p">(</span><span class="n">is_wanted_task</span><span class="p">)</span>
</pre></div>
</div>
<p>or with a transform:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Queue</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Exchange</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">move</span><span class="p">(</span><span class="n">is_wanted_task</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
</pre></div>
</div>
<p>The predicate may also return a tuple of <tt class="docutils literal"><span class="pre">(exchange,</span> <span class="pre">routing_key)</span></tt>
to specify the destination to where the task should be moved,
or a <tt class="xref py py-class docutils literal"><span class="pre">Queue</span></tt> instance.
Any other true value means that the task will be moved to the
default exchange/routing_key.</p>
</dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.move_by_idmap">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">move_by_idmap</tt><big>(</big><em>map</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#move_by_idmap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.move_by_idmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Moves tasks by matching from a <tt class="docutils literal"><span class="pre">task_id:</span> <span class="pre">queue</span></tt> mapping,
where <tt class="docutils literal"><span class="pre">queue</span></tt> is a queue to move the task to.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">reroute_idmap</span><span class="p">({</span>
<span class="gp">... </span>    <span class="s">&#39;5bee6e82-f4ac-468e-bd3d-13e8600250bc&#39;</span><span class="p">:</span> <span class="n">Queue</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="gp">... </span>    <span class="s">&#39;ada8652d-aef3-466b-abd2-becdaf1b82b3&#39;</span><span class="p">:</span> <span class="n">Queue</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="gp">... </span>    <span class="s">&#39;3a2b140d-7db1-41ba-ac90-c36a0ef4ab1f&#39;</span><span class="p">:</span> <span class="n">Queue</span><span class="p">(</span><span class="o">...</span><span class="p">)},</span>
<span class="gp">... </span>  <span class="n">queues</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;hipri&#39;</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.move_by_taskmap">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">move_by_taskmap</tt><big>(</big><em>map</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#move_by_taskmap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.move_by_taskmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Moves tasks by matching from a <tt class="docutils literal"><span class="pre">task_name:</span> <span class="pre">queue</span></tt> mapping,
where <tt class="docutils literal"><span class="pre">queue</span></tt> is the queue to move the task to.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">reroute_idmap</span><span class="p">({</span>
<span class="gp">... </span>    <span class="s">&#39;tasks.add&#39;</span><span class="p">:</span> <span class="n">Queue</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="gp">... </span>    <span class="s">&#39;tasks.mul&#39;</span><span class="p">:</span> <span class="n">Queue</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="gp">... </span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.move_task_by_id">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">move_task_by_id</tt><big>(</big><em>task_id</em>, <em>dest</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#move_task_by_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.move_task_by_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Find a task by id and move it to another queue.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>task_id</strong> &#8211; Id of task to move.</li>
<li><strong>dest</strong> &#8211; Destination queue.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Also supports the same keyword arguments as <a class="reference internal" href="#celery.contrib.migrate.move" title="celery.contrib.migrate.move"><tt class="xref py py-func docutils literal"><span class="pre">move()</span></tt></a>.</p>
</dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.prepare_queues">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">prepare_queues</tt><big>(</big><em>queues</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#prepare_queues"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.prepare_queues" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.republish">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">republish</tt><big>(</big><em>producer, message, exchange=None, routing_key=None, remove_props=['application_headers', 'content_type', 'content_encoding', 'headers']</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#republish"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.republish" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.start_filter">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">start_filter</tt><big>(</big><em>app</em>, <em>conn</em>, <em>filter</em>, <em>limit=None</em>, <em>timeout=1.0</em>, <em>ack_messages=False</em>, <em>tasks=None</em>, <em>queues=None</em>, <em>callback=None</em>, <em>forever=False</em>, <em>on_declare_queue=None</em>, <em>consume_from=None</em>, <em>state=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#start_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.start_filter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.task_id_eq">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">task_id_eq</tt><big>(</big><em>task_id</em>, <em>body</em>, <em>message</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#task_id_eq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.task_id_eq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.contrib.migrate.task_id_in">
<tt class="descclassname">celery.contrib.migrate.</tt><tt class="descname">task_id_in</tt><big>(</big><em>ids</em>, <em>body</em>, <em>message</em><big>)</big><a class="reference internal" href="../modules/celery/contrib/migrate.html#task_id_in"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#celery.contrib.migrate.task_id_in" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="celery.contrib.batches.html">celery.contrib.batches</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="celery.contrib.rdb.html">celery.contrib.rdb</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>