

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>First Steps with Celery &mdash; Celery 1 documentation</title>
    
    <link rel="stylesheet" href="../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/theme_extras.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="Celery 1 documentation" href="../index.html" />
    <link rel="next" title="Next Steps" href="next-steps.html" />
    <link rel="prev" title="Welcome to Celery’s documentation!" href="../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>Celery 1 documentation</span></a></h1>
        <h2 class="heading"><span>First Steps with Celery</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="../index.html">Welcome to Celery&#8217;s documentation!</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="next-steps.html">Next Steps</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="first-steps-with-celery">
<span id="first-steps"></span><span id="tut-celery"></span><h1>First Steps with Celery<a class="headerlink" href="#first-steps-with-celery" title="Permalink to this headline">¶</a></h1>
<p>Celery is a task queue with batteries included.
It is easy to use so that you can get started without learning
the full complexities of the problem it solves. It is designed
around best practices so that your product can scale
and integrate with other languages, and it comes with the
tools and support you need to run such a system in production.</p>
<p>In this tutorial you will learn the absolute basics of using Celery.
You will learn about;</p>
<ul class="simple">
<li>Choosing and installing a <a class="reference internal" href="../terms.html#term-message-broker"><em class="xref std std-term">message broker</em></a>.</li>
<li>Installing Celery and creating your first task</li>
<li>Starting the worker and calling tasks.</li>
<li>Keeping track of tasks as they transition through different states,
and inspecting return values.</li>
</ul>
<p>Celery may seem daunting at first - but don&#8217;t worry - this tutorial
will get you started in no time. It is deliberately kept simple, so
to not confuse you with advanced features.
After you have finished this tutorial
it&#8217;s a good idea to browse the rest of the documentation,
for example the <a class="reference internal" href="next-steps.html#next-steps"><em>Next Steps</em></a> tutorial, which will
showcase Celery&#8217;s capabilities.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#choosing-a-broker" id="id3">Choosing a Broker</a><ul>
<li><a class="reference internal" href="#rabbitmq" id="id4">RabbitMQ</a></li>
<li><a class="reference internal" href="#redis" id="id5">Redis</a></li>
<li><a class="reference internal" href="#using-a-database" id="id6">Using a database</a></li>
<li><a class="reference internal" href="#other-brokers" id="id7">Other brokers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installing-celery" id="id8">Installing Celery</a></li>
<li><a class="reference internal" href="#application" id="id9">Application</a><ul>
<li><a class="reference internal" href="#django-celery" id="id10">django-celery</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-the-celery-worker-server" id="id11">Running the celery worker server</a></li>
<li><a class="reference internal" href="#calling-the-task" id="id12">Calling the task</a></li>
<li><a class="reference internal" href="#keeping-results" id="id13">Keeping Results</a></li>
<li><a class="reference internal" href="#configuration" id="id14">Configuration</a></li>
<li><a class="reference internal" href="#where-to-go-from-here" id="id15">Where to go from here</a></li>
</ul>
</div>
<div class="section" id="choosing-a-broker">
<span id="celerytut-broker"></span><h2><a class="toc-backref" href="#id3">Choosing a Broker</a><a class="headerlink" href="#choosing-a-broker" title="Permalink to this headline">¶</a></h2>
<p>Celery requires a solution to send and receive messages, usually this
comes in the form of a separate service called a <a class="reference internal" href="../terms.html#term-message-broker"><em class="xref std std-term">message broker</em></a>.</p>
<p>There are several choices available, including:</p>
<div class="section" id="rabbitmq">
<h3><a class="toc-backref" href="#id4">RabbitMQ</a><a class="headerlink" href="#rabbitmq" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference internal" href="../terms.html#term-kombu"><em class="xref std std-term">Kombu</em></a> は基本的に <a class="reference internal" href="../terms.html#term-amqp"><em class="xref std std-term">amqp</em></a> をブローカーのモデルとして考えていて、
<a class="reference internal" href="../terms.html#term-ampqlib"><em class="xref std std-term">ampqlib</em></a> と、:term:<cite>Pika</cite> を&#8221;Native&#8221; トランスポートとして扱っている。</li>
<li>それ以外は**Virtual** トランスポート。</li>
</ul>
</div>
<p><a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a> is feature-complete, stable, durable and easy to install.
It&#8217;s an excellent choice for a production environment.
Detailed information about using RabbitMQ with Celery:</p>
<blockquote>
<div><a class="reference external" href="http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html#broker-rabbitmq" title="(in Celery v3.0)"><em>Using RabbitMQ</em></a></div></blockquote>
<p>If you are using Ubuntu or Debian install RabbitMQ by executing this
command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install rabbitmq-server
</pre></div>
</div>
<p>When the command completes the broker is already running in the background,
ready to move messages for you: <tt class="docutils literal"><span class="pre">Starting</span> <span class="pre">rabbitmq-server:</span> <span class="pre">SUCCESS</span></tt>.</p>
<p>And don&#8217;t worry if you&#8217;re not running Ubuntu or Debian, you can go to this
website to find similarly simple installation instructions for other
platforms, including Microsoft Windows:</p>
<blockquote>
<div><a class="reference external" href="http://www.rabbitmq.com/download.html">http://www.rabbitmq.com/download.html</a></div></blockquote>
</div>
<div class="section" id="redis">
<h3><a class="toc-backref" href="#id5">Redis</a><a class="headerlink" href="#redis" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Redisは障害時に多少データロスしやすい。</li>
</ul>
</div>
<p><a class="reference external" href="http://redis.io/">Redis</a> is also feature-complete, but is more susceptible to data loss in
the event of abrupt termination or power failures. Detailed information about using Redis:</p>
<blockquote>
<div><a class="reference external" href="http://docs.celeryproject.org/en/latest/getting-started/brokers/redis.html#broker-redis" title="(in Celery v3.0)"><em>Using Redis</em></a></div></blockquote>
</div>
<div class="section" id="using-a-database">
<h3><a class="toc-backref" href="#id6">Using a database</a><a class="headerlink" href="#using-a-database" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>データベースは推奨されませんが、小規模だったらいいのではないでしょうか。</li>
</ul>
</div>
<p>Using a database as a message queue is not recommended, but can be sufficient
for very small installations.  Your options include:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.celeryproject.org/en/latest/getting-started/brokers/sqlalchemy.html#broker-sqlalchemy" title="(in Celery v3.0)"><em>Using SQLAlchemy</em></a></li>
<li><a class="reference external" href="http://docs.celeryproject.org/en/latest/getting-started/brokers/django.html#broker-django" title="(in Celery v3.0)"><em>Using the Django Database</em></a></li>
</ul>
<p>If you&#8217;re already using a Django database for example,
using it as your <a class="reference internal" href="../terms.html#term-message-broker"><em class="xref std std-term">message broker</em></a> can be convenient
while developing even if you use a more robust system in production.</p>
</div>
<div class="section" id="other-brokers">
<h3><a class="toc-backref" href="#id7">Other brokers</a><a class="headerlink" href="#other-brokers" title="Permalink to this headline">¶</a></h3>
<p>In addition to the above, there are other transport implementations
to choose from, including</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.celeryproject.org/en/latest/getting-started/brokers/sqs.html#broker-sqs" title="(in Celery v3.0)"><em class="xref std std-ref">Amazon SQS</em></a></li>
<li><a class="reference external" href="http://docs.celeryproject.org/en/latest/getting-started/brokers/mongodb.html#broker-mongodb" title="(in Celery v3.0)"><em>Using MongoDB</em></a></li>
</ul>
<p>See also <a class="reference external" href="http://kombu.readthedocs.org/en/latest/introduction.html#transport-comparison">Transport Comparison</a>.</p>
</div>
</div>
<div class="section" id="installing-celery">
<span id="celerytut-installation"></span><h2><a class="toc-backref" href="#id8">Installing Celery</a><a class="headerlink" href="#installing-celery" title="Permalink to this headline">¶</a></h2>
<p>Celery is on the Python Package Index (PyPI), so it can be installed
with standard Python tools like <tt class="docutils literal"><span class="pre">pip</span></tt> or <tt class="docutils literal"><span class="pre">easy_install</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pip install celery
</pre></div>
</div>
</div>
<div class="section" id="application">
<h2><a class="toc-backref" href="#id9">Application</a><a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h2>
<p>The first thing you need is a Celery instance, this is called the celery
application or just app in short.
Since this instance is used as the entry-point for everything
you want to do in Celery, like creating tasks and managing workers,
it must be possible for other modules to import it.</p>
<p>In this tutorial
you will keep everything contained in a single module,
but for larger projects
you want to create a <a class="reference internal" href="next-steps.html#project-layout"><em>dedicated module</em></a>.</p>
<p>Let&#8217;s create the file <tt class="file docutils literal"><span class="pre">tasks.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>

<span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s">&#39;tasks&#39;</span><span class="p">,</span> <span class="n">broker</span><span class="o">=</span><span class="s">&#39;amqp://guest@localhost//&#39;</span><span class="p">)</span>

<span class="nd">@celery.task</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>The first argument to <tt class="xref py py-class docutils literal"><span class="pre">Celery</span></tt> is the name of the current module,
this is needed so that names can be automatically generated, the second
argument is the broker keyword argument which specifies the URL of the
message broker you want to use, using RabbitMQ here, which is already the
default option.  See <a class="reference internal" href="#celerytut-broker"><em>Choosing a Broker</em></a> above for more choices,
e.g. for Redis you can use <tt class="docutils literal"><span class="pre">redis://localhost</span></tt>, or MongoDB:
<tt class="docutils literal"><span class="pre">mongodb://localhost</span></tt>.</p>
<p>You defined a single task, called <tt class="docutils literal"><span class="pre">add</span></tt>, which returns the sum of two numbers.</p>
<div class="section" id="django-celery">
<h3><a class="toc-backref" href="#id10">django-celery</a><a class="headerlink" href="#django-celery" title="Permalink to this headline">¶</a></h3>
<p>settings.pyで初期化します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">djcelery</span>
<span class="n">djcelery</span><span class="o">.</span><span class="n">setup_loader</span><span class="p">()</span>
</pre></div>
</div>
<p>setup_loader()では CELERY_LOADERをDjangoLoaderに設定します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">setup_loader</span><span class="p">():</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;CELERY_LOADER&quot;</span><span class="p">,</span> <span class="s">&quot;djcelery.loaders.DjangoLoader&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>CeleryはこのCELERY_LOADERクラスを celery.app.default_loader として設定し、
このローダーを使って Celeryアプリケーションインスタンスを作成する事になります。
( この方法で生成されたアプリケーションを old applcation と読んでいるようです <a class="reference internal" href="../api/celery.app.html#module-celery.app" title="celery.app"><tt class="xref py py-mod docutils literal"><span class="pre">celery.app</span></tt></a> )</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://github.com/celery/celery/blob/master/celery/app/__init__.py#L37">https://github.com/celery/celery/blob/master/celery/app/__init__.py#L37</a></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="running-the-celery-worker-server">
<span id="celerytut-running-celeryd"></span><h2><a class="toc-backref" href="#id11">Running the celery worker server</a><a class="headerlink" href="#running-the-celery-worker-server" title="Permalink to this headline">¶</a></h2>
<p>You now run the worker by executing our program with the <tt class="docutils literal"><span class="pre">worker</span></tt>
argument:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>celery -A tasks worker --loglevel<span class="o">=</span>info
</pre></div>
</div>
<p>In production you will want to run the worker in the
background as a daemon.  To do this you need to use the tools provided
by your platform, or something like <a class="reference external" href="http://supervisord.org">supervisord</a> (see <a class="reference external" href="http://docs.celeryproject.org/en/latest/tutorials/daemonizing.html#daemonizing" title="(in Celery v3.0)"><em>Running the worker as a daemon</em></a>
for more information).</p>
<p>For a complete listing of the command line options available, do:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span> celery worker --help
</pre></div>
</div>
<p>There also several other commands available, and help is also available:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>celery <span class="nb">help</span>
</pre></div>
</div>
</div>
<div class="section" id="calling-the-task">
<span id="celerytut-calling"></span><h2><a class="toc-backref" href="#id12">Calling the task</a><a class="headerlink" href="#calling-the-task" title="Permalink to this headline">¶</a></h2>
<p>To call our task you can use the <a class="reference internal" href="../api/celery.app.task.html#celery.app.task.Task.delay" title="celery.app.task.Task.delay"><tt class="xref py py-meth docutils literal"><span class="pre">delay()</span></tt></a> method.</p>
<p>This is a handy shortcut to the <a class="reference internal" href="../api/celery.app.task.html#celery.app.task.Task.apply_async" title="celery.app.task.Task.apply_async"><tt class="xref py py-meth docutils literal"><span class="pre">apply_async()</span></tt></a>
method which gives greater control of the task execution (see
<a class="reference internal" href="../userguide/calling.html#guide-calling"><em>Calling Tasks</em></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tasks</span> <span class="kn">import</span> <span class="n">add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>The task has now been processed by the worker you started earlier,
and you can verify that by looking at the workers console output.</p>
<p>Calling a task returns an <a class="reference internal" href="../api/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><tt class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></tt></a> instance,
which can be used to check the state of the task, wait for the task to finish
or get its return value (or if the task failed, the exception and traceback).
But this isn&#8217;t enabled by default, and you have to configure Celery to
use a result backend, which is detailed in the next section.</p>
</div>
<div class="section" id="keeping-results">
<span id="celerytut-keeping-results"></span><h2><a class="toc-backref" href="#id13">Keeping Results</a><a class="headerlink" href="#keeping-results" title="Permalink to this headline">¶</a></h2>
<p>If you want to keep track of the tasks&#8217; states, Celery needs to store or send
the states somewhere.  There are several
built-in result backends to choose from: <a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a>/<a class="reference external" href="http://djangoproject.com">Django</a> ORM,
<a class="reference external" href="http://memcached.org">Memcached</a>, <a class="reference external" href="http://redis.io/">Redis</a>, AMQP (<a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a>), and <a class="reference external" href="http://www.mongodb.org">MongoDB</a> &#8211; or you can define your own.</p>
<p>For this example you will use the <cite>amqp</cite> result backend, which sends states
as messages.  The backend is specified via the <tt class="docutils literal"><span class="pre">backend</span></tt> argument to
<a class="reference internal" href="../api/celery.html#celery.Celery" title="celery.Celery"><tt class="xref py py-class docutils literal"><span class="pre">Celery</span></tt></a>, (or via the <a class="reference internal" href="../configuration.html#std:setting-CELERY_RESULT_BACKEND"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_RESULT_BACKEND</span></tt></a> setting if
you choose to use a configuration module):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s">&#39;tasks&#39;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s">&#39;amqp&#39;</span><span class="p">,</span> <span class="n">broker</span><span class="o">=</span><span class="s">&#39;amqp://&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or if you want to use Redis as the result backend, but still use RabbitMQ as
the message broker (a popular combination):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s">&#39;tasks&#39;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s">&#39;redis://localhost&#39;</span><span class="p">,</span> <span class="n">broker</span><span class="o">=</span><span class="s">&#39;amqp://&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To read more about result backends please see <a class="reference internal" href="../userguide/tasks.html#task-result-backends"><em>Result Backends</em></a>.</p>
<p>Now with the result backend configured, let&#8217;s call the task again.
This time you&#8217;ll hold on to the <a class="reference internal" href="../api/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><tt class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></tt></a> instance returned
when you call a task:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../api/celery.result.html#celery.result.AsyncResult.ready" title="celery.result.AsyncResult.ready"><tt class="xref py py-meth docutils literal"><span class="pre">ready()</span></tt></a> method returns whether the task
has finished processing or not:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
<p>You can wait for the result to complete, but this is rarely used
since it turns the asynchronous call into a synchronous one:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">4</span>
</pre></div>
</div>
<p>In case the task raised an exception, <a class="reference internal" href="../api/celery.result.html#celery.result.AsyncResult.get" title="celery.result.AsyncResult.get"><tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt></a> will
re-raise the exception, but you can override this by specifying
the <tt class="docutils literal"><span class="pre">propagate</span></tt> argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">propagate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>If the task raised an exception you can also gain access to the
original traceback:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">traceback</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../api/celery.result.html#module-celery.result" title="celery.result"><tt class="xref py py-mod docutils literal"><span class="pre">celery.result</span></tt></a> for the complete result object reference.</p>
</div>
<div class="section" id="configuration">
<span id="celerytut-configuration"></span><h2><a class="toc-backref" href="#id14">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Celery, like a consumer appliance doesn&#8217;t need much to be operated.
It has an input and an output, where you must connect the input to a broker and maybe
the output to a result backend if so wanted.  But if you look closely at the back
there is a lid revealing lots of sliders, dials and buttons: this is the configuration.</p>
<p>The default configuration should be good enough for most uses, but there
are many things to tweak so that Celery works just the way you want it to.
Reading about the options available is a good idea to get familiar with what
can be configured, see the <a class="reference internal" href="../configuration.html#configuration"><em>Configuration and defaults</em></a> reference.</p>
<p>The configuration can be set on the app directly or by using a dedicated
configuration module.
As an example you can configure the default serializer used for serializing
task payloads by changing the <a class="reference internal" href="../configuration.html#std:setting-CELERY_TASK_SERIALIZER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_SERIALIZER</span></tt></a> setting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">celery</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">CELERY_TASK_SERIALIZER</span> <span class="o">=</span> <span class="s">&#39;json&#39;</span>
</pre></div>
</div>
<p>If you are configuring many settings at once you can use <tt class="docutils literal"><span class="pre">update</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">celery</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">CELERY_TASK_SERIALIZER</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">,</span>
    <span class="n">CELERY_RESULT_SERIALIZER</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">,</span>
    <span class="n">CELERY_TIMEZONE</span><span class="o">=</span><span class="s">&#39;Europe/Oslo&#39;</span><span class="p">,</span>
    <span class="n">CELERY_ENABLE_UTC</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For larger projects using a dedicated configuration module is useful,
in fact you are discouraged from hard coding
periodic task intervals and task routing options, as it is much
better to keep this in a centralized location, and especially for libraries
it makes it possible for users to control how they want your tasks to behave,
you can also imagine your SysAdmin making simple changes to the configuration
in the event of system trouble.</p>
<p>You can tell your Celery instance to use a configuration module,
by calling the <a class="reference internal" href="../api/celery.html#celery.Celery.config_from_object" title="celery.Celery.config_from_object"><tt class="xref py py-meth docutils literal"><span class="pre">config_from_object()</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">celery</span><span class="o">.</span><span class="n">config_from_object</span><span class="p">(</span><span class="s">&#39;celeryconfig&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This module is often called &#8220;<tt class="docutils literal"><span class="pre">celeryconfig</span></tt>&#8221;, but you can use any
module name.</p>
<p>A module named <tt class="docutils literal"><span class="pre">celeryconfig.py</span></tt> must then be available to load from the
current directory or on the Python path, it could look like this:</p>
<p><tt class="file docutils literal"><span class="pre">celeryconfig.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">BROKER_URL</span> <span class="o">=</span> <span class="s">&#39;amqp://&#39;</span>
<span class="n">CELERY_RESULT_BACKEND</span> <span class="o">=</span> <span class="s">&#39;amqp://&#39;</span>

<span class="n">CELERY_TASK_SERIALIZER</span> <span class="o">=</span> <span class="s">&#39;json&#39;</span>
<span class="n">CELERY_RESULT_SERIALIZER</span> <span class="o">=</span> <span class="s">&#39;json&#39;</span>
<span class="n">CELERY_TIMEZONE</span> <span class="o">=</span> <span class="s">&#39;Europe/Oslo&#39;</span>
<span class="n">CELERY_ENABLE_UTC</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>To verify that your configuration file works properly, and doesn&#8217;t
contain any syntax errors, you can try to import it:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python -m celeryconfig
</pre></div>
</div>
<p>For a complete reference of configuration options, see <a class="reference internal" href="../configuration.html#configuration"><em>Configuration and defaults</em></a>.</p>
<p>To demonstrate the power of configuration files, this how you would
route a misbehaving task to a dedicated queue:</p>
<p><tt class="file docutils literal"><span class="pre">celeryconfig.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_ROUTES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;tasks.add&#39;</span><span class="p">:</span> <span class="s">&#39;low-priority&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or instead of routing it you could rate limit the task
instead, so that only 10 tasks of this type can be processed in a minute
(10/m):</p>
<p><tt class="file docutils literal"><span class="pre">celeryconfig.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_ANNOTATIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;tasks.add&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;rate_limit&#39;</span><span class="p">:</span> <span class="s">&#39;10/m&#39;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you are using RabbitMQ, Redis or MongoDB as the
broker then you can also direct the workers to set a new rate limit
for the task at runtime:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>celery control rate_limit tasks.add 10/m
worker.example.com: OK
    new rate limit <span class="nb">set </span>successfully
</pre></div>
</div>
<p>See <a class="reference internal" href="../userguide/routing.html#guide-routing"><em>Routing Tasks</em></a> to read more about task routing,
and the <a class="reference internal" href="../configuration.html#std:setting-CELERY_ANNOTATIONS"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ANNOTATIONS</span></tt></a> setting for more about annotations,
or <a class="reference internal" href="../userguide/monitoring.html#guide-monitoring"><em>Monitoring and Management Guide</em></a> for more about remote control commands,
and how to monitor what your workers are doing.</p>
</div>
<div class="section" id="where-to-go-from-here">
<h2><a class="toc-backref" href="#id15">Where to go from here</a><a class="headerlink" href="#where-to-go-from-here" title="Permalink to this headline">¶</a></h2>
<p>If you want to learn more you should continue to the
<a class="reference internal" href="next-steps.html#next-steps"><em>Next Steps</em></a> tutorial, and after that you
can study the <a class="reference internal" href="../userguide/index.html#guide"><em>User Guide</em></a>.</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="../index.html">Welcome to Celery&#8217;s documentation!</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="next-steps.html">Next Steps</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>