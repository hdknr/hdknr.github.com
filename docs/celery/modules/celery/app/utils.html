

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>celery.app.utils &mdash; Celery 1 documentation</title>
    
    <link rel="stylesheet" href="../../../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../static/doctools.js"></script>
    <script type="text/javascript" src="../../../static/theme_extras.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="Celery 1 documentation" href="../../../index.html" />
    <link rel="up" title="celery.app" href="../app.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../../index.html">
          <span>Celery 1 documentation</span></a></h1>
        <h2 class="heading"><span>celery.app.utils</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for celery.app.utils</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    celery.app.utils</span>
<span class="sd">    ~~~~~~~~~~~~~~~~</span>

<span class="sd">    App utilities: Compat settings, bugreport tool, pickling apps.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span> <span class="kn">as</span> <span class="nn">_platform</span>

<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">datastructures</span>
<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">platforms</span>
<span class="kn">from</span> <span class="nn">celery.utils.text</span> <span class="kn">import</span> <span class="n">pretty</span>
<span class="kn">from</span> <span class="nn">celery.utils.imports</span> <span class="kn">import</span> <span class="n">qualname</span>

<span class="kn">from</span> <span class="nn">.defaults</span> <span class="kn">import</span> <span class="n">find</span>

<span class="c">#: Format used to generate bugreport information.</span>
<span class="n">BUGREPORT_INFO</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">software -&gt; celery:</span><span class="si">%(celery_v)s</span><span class="s"> kombu:</span><span class="si">%(kombu_v)s</span><span class="s"> py:</span><span class="si">%(py_v)s</span><span class="s"></span>
<span class="s">            billiard:</span><span class="si">%(billiard_v)s</span><span class="s"> </span><span class="si">%(driver_v)s</span><span class="s"></span>
<span class="s">platform -&gt; system:</span><span class="si">%(system)s</span><span class="s"> arch:</span><span class="si">%(arch)s</span><span class="s"> imp:</span><span class="si">%(py_i)s</span><span class="s"></span>
<span class="s">loader   -&gt; </span><span class="si">%(loader)s</span><span class="s"></span>
<span class="s">settings -&gt; transport:</span><span class="si">%(transport)s</span><span class="s"> results:</span><span class="si">%(results)s</span><span class="s"></span>

<span class="si">%(human_settings)s</span><span class="s"></span>
<span class="s">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="Settings"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings">[docs]</a><span class="k">class</span> <span class="nc">Settings</span><span class="p">(</span><span class="n">datastructures</span><span class="o">.</span><span class="n">ConfigurationView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Celery settings object.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Settings.CELERY_RESULT_BACKEND"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings.CELERY_RESULT_BACKEND">[docs]</a>    <span class="k">def</span> <span class="nf">CELERY_RESULT_BACKEND</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="s">&#39;CELERY_RESULT_BACKEND&#39;</span><span class="p">,</span> <span class="s">&#39;CELERY_BACKEND&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Settings.BROKER_TRANSPORT"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings.BROKER_TRANSPORT">[docs]</a>    <span class="k">def</span> <span class="nf">BROKER_TRANSPORT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="s">&#39;BROKER_TRANSPORT&#39;</span><span class="p">,</span>
                          <span class="s">&#39;BROKER_BACKEND&#39;</span><span class="p">,</span> <span class="s">&#39;CARROT_BACKEND&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Settings.BROKER_BACKEND"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings.BROKER_BACKEND">[docs]</a>    <span class="k">def</span> <span class="nf">BROKER_BACKEND</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deprecated compat alias to :attr:`BROKER_TRANSPORT`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">BROKER_TRANSPORT</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Settings.BROKER_HOST"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings.BROKER_HOST">[docs]</a>    <span class="k">def</span> <span class="nf">BROKER_HOST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CELERY_BROKER_URL&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="s">&#39;BROKER_URL&#39;</span><span class="p">,</span> <span class="s">&#39;BROKER_HOST&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Settings.without_defaults"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings.without_defaults">[docs]</a>    <span class="k">def</span> <span class="nf">without_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the current configuration, but without defaults.&quot;&quot;&quot;</span>
        <span class="c"># the last stash is the default settings, so just skip that</span>
        <span class="k">return</span> <span class="n">Settings</span><span class="p">({},</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Settings.find_option"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings.find_option">[docs]</a>    <span class="k">def</span> <span class="nf">find_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">&#39;celery&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search for option by name.</span>

<span class="sd">        Will return ``(namespace, option_name, Option)`` tuple, e.g.::</span>

<span class="sd">            &gt;&gt;&gt; celery.conf.find_option(&#39;disable_rate_limits&#39;)</span>
<span class="sd">            (&#39;CELERY&#39;, &#39;DISABLE_RATE_LIMITS&#39;,</span>
<span class="sd">             &lt;Option: type-&gt;bool default-&gt;False&gt;))</span>

<span class="sd">        :param name: Name of option, cannot be partial.</span>
<span class="sd">        :keyword namespace: Preferred namespace (``CELERY`` by default).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Settings.find_value_for_key"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings.find_value_for_key">[docs]</a>    <span class="k">def</span> <span class="nf">find_value_for_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">&#39;celery&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shortcut to ``get_by_parts(*find_option(name)[:-1])``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_by_parts</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">find_option</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Settings.get_by_parts"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings.get_by_parts">[docs]</a>    <span class="k">def</span> <span class="nf">get_by_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">parts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the current value for setting specified as a path.</span>

<span class="sd">        Example::</span>

<span class="sd">            &gt;&gt;&gt; celery.conf.get_by_parts(&#39;CELERY&#39;, &#39;DISABLE_RATE_LIMITS&#39;)</span>
<span class="sd">            False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">parts</span><span class="p">))]</span>
</div>
<div class="viewcode-block" id="Settings.humanize"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.Settings.humanize">[docs]</a>    <span class="k">def</span> <span class="nf">humanize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a human readable string showing changes to the</span>
<span class="sd">        configuration.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">pretty</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">without_defaults</span><span class="p">()</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>

</div></div>
<div class="viewcode-block" id="AppPickler"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.AppPickler">[docs]</a><span class="k">class</span> <span class="nc">AppPickler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Default application pickler/unpickler.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">app</span>

<div class="viewcode-block" id="AppPickler.prepare"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.AppPickler.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;changes&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="AppPickler.build_kwargs"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.AppPickler.build_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">build_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_standard_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AppPickler.build_standard_kwargs"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.AppPickler.build_standard_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">build_standard_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main</span><span class="p">,</span> <span class="n">changes</span><span class="p">,</span> <span class="n">loader</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">amqp</span><span class="p">,</span>
            <span class="n">events</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">control</span><span class="p">,</span> <span class="n">accept_magic_kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="n">main</span><span class="p">,</span> <span class="n">loader</span><span class="o">=</span><span class="n">loader</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">amqp</span><span class="o">=</span><span class="n">amqp</span><span class="p">,</span>
                    <span class="n">changes</span><span class="o">=</span><span class="n">changes</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="n">control</span><span class="p">,</span>
                    <span class="n">set_as_current</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">accept_magic_kwargs</span><span class="o">=</span><span class="n">accept_magic_kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AppPickler.construct"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.AppPickler.construct">[docs]</a>    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div></div>
<span class="k">def</span> <span class="nf">_unpickle_app</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pickler</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pickler</span><span class="p">()(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>


<div class="viewcode-block" id="bugreport"><a class="viewcode-back" href="../../../api/celery.app.utils.html#celery.app.utils.bugreport">[docs]</a><span class="k">def</span> <span class="nf">bugreport</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a string containing information useful in bug reports.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">billiard</span>
    <span class="kn">import</span> <span class="nn">celery</span>
    <span class="kn">import</span> <span class="nn">kombu</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span><span class="o">.</span><span class="n">transport</span>
        <span class="n">driver_v</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">driver_name</span><span class="p">,</span> <span class="n">trans</span><span class="o">.</span><span class="n">driver_version</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">driver_v</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">return</span> <span class="n">BUGREPORT_INFO</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="n">_platform</span><span class="o">.</span><span class="n">system</span><span class="p">(),</span>
        <span class="s">&#39;arch&#39;</span><span class="p">:</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">_platform</span><span class="o">.</span><span class="n">architecture</span><span class="p">())),</span>
        <span class="s">&#39;py_i&#39;</span><span class="p">:</span> <span class="n">platforms</span><span class="o">.</span><span class="n">pyimplementation</span><span class="p">(),</span>
        <span class="s">&#39;celery_v&#39;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">VERSION_BANNER</span><span class="p">,</span>
        <span class="s">&#39;kombu_v&#39;</span><span class="p">:</span> <span class="n">kombu</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
        <span class="s">&#39;billiard_v&#39;</span><span class="p">:</span> <span class="n">billiard</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
        <span class="s">&#39;py_v&#39;</span><span class="p">:</span> <span class="n">_platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">(),</span>
        <span class="s">&#39;driver_v&#39;</span><span class="p">:</span> <span class="n">driver_v</span><span class="p">,</span>
        <span class="s">&#39;transport&#39;</span><span class="p">:</span> <span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">BROKER_TRANSPORT</span> <span class="ow">or</span> <span class="s">&#39;amqp&#39;</span><span class="p">,</span>
        <span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">CELERY_RESULT_BACKEND</span> <span class="ow">or</span> <span class="s">&#39;disabled&#39;</span><span class="p">,</span>
        <span class="s">&#39;human_settings&#39;</span><span class="p">:</span> <span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">humanize</span><span class="p">(),</span>
        <span class="s">&#39;loader&#39;</span><span class="p">:</span> <span class="n">qualname</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">__class__</span><span class="p">),</span>
    <span class="p">}</span></div>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>