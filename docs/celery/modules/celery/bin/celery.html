

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>celery.bin.celery &mdash; Celery 1 documentation</title>
    
    <link rel="stylesheet" href="../../../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../static/doctools.js"></script>
    <script type="text/javascript" src="../../../static/theme_extras.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="Celery 1 documentation" href="../../../index.html" />
    <link rel="up" title="celery" href="../../celery.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../../index.html">
          <span>Celery 1 documentation</span></a></h1>
        <h2 class="heading"><span>celery.bin.celery</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for celery.bin.celery</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">The :program:`celery` umbrella command.</span>

<span class="sd">.. program:: celery</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">with_statement</span>

<span class="kn">import</span> <span class="nn">anyjson</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">billiard</span> <span class="kn">import</span> <span class="n">freeze_support</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pformat</span>

<span class="kn">from</span> <span class="nn">celery.platforms</span> <span class="kn">import</span> <span class="n">EX_OK</span><span class="p">,</span> <span class="n">EX_FAILURE</span><span class="p">,</span> <span class="n">EX_UNAVAILABLE</span><span class="p">,</span> <span class="n">EX_USAGE</span>
<span class="kn">from</span> <span class="nn">celery.utils</span> <span class="kn">import</span> <span class="n">term</span>
<span class="kn">from</span> <span class="nn">celery.utils</span> <span class="kn">import</span> <span class="n">text</span>
<span class="kn">from</span> <span class="nn">celery.utils.functional</span> <span class="kn">import</span> <span class="n">memoize</span>
<span class="kn">from</span> <span class="nn">celery.utils.imports</span> <span class="kn">import</span> <span class="n">symbol_by_name</span>
<span class="kn">from</span> <span class="nn">celery.utils.timeutils</span> <span class="kn">import</span> <span class="n">maybe_iso8601</span>

<span class="kn">from</span> <span class="nn">celery.bin.base</span> <span class="kn">import</span> <span class="n">Command</span> <span class="k">as</span> <span class="n">BaseCommand</span><span class="p">,</span> <span class="n">Option</span>

<span class="n">HELP</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">---- -- - - ---- Commands- -------------- --- ------------</span>

<span class="si">%(commands)s</span><span class="s"></span>
<span class="s">---- -- - - --------- -- - -------------- --- ------------</span>

<span class="s">Type &#39;</span><span class="si">%(prog_name)s</span><span class="s"> &lt;command&gt; --help&#39; for help using a specific command.</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">commands</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">command_classes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">&#39;Main&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;worker&#39;</span><span class="p">,</span> <span class="s">&#39;events&#39;</span><span class="p">,</span> <span class="s">&#39;beat&#39;</span><span class="p">,</span> <span class="s">&#39;shell&#39;</span><span class="p">,</span> <span class="s">&#39;multi&#39;</span><span class="p">,</span> <span class="s">&#39;amqp&#39;</span><span class="p">],</span> <span class="s">&#39;green&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;Remote Control&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">,</span> <span class="s">&#39;inspect&#39;</span><span class="p">,</span> <span class="s">&#39;control&#39;</span><span class="p">],</span> <span class="s">&#39;blue&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;Utils&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;purge&#39;</span><span class="p">,</span> <span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="s">&#39;migrate&#39;</span><span class="p">,</span> <span class="s">&#39;call&#39;</span><span class="p">,</span> <span class="s">&#39;result&#39;</span><span class="p">,</span> <span class="s">&#39;report&#39;</span><span class="p">],</span> <span class="bp">None</span><span class="p">),</span>
<span class="p">]</span>


<span class="nd">@memoize</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">_get_extension_classes</span><span class="p">():</span>
    <span class="n">extensions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">command_classes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Extensions&#39;</span><span class="p">,</span> <span class="n">extensions</span><span class="p">,</span> <span class="s">&#39;magenta&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">extensions</span>


<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Error">[docs]</a><span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">EX_FAILURE</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="n">reason</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">reason</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reason</span>

</div>
<div class="viewcode-block" id="command"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.command">[docs]</a><span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sortpri</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">commands</span><span class="p">[</span><span class="n">name</span> <span class="ow">or</span> <span class="n">fun</span><span class="o">.</span><span class="n">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span>
    <span class="n">fun</span><span class="o">.</span><span class="n">sortpri</span> <span class="o">=</span> <span class="n">sortpri</span>
    <span class="k">return</span> <span class="n">fun</span>

</div>
<div class="viewcode-block" id="load_extension_commands"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.load_extension_commands">[docs]</a><span class="k">def</span> <span class="nf">load_extension_commands</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="s">&#39;celery.commands&#39;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">iter_entry_points</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">iter_entry_points</span><span class="p">(</span><span class="n">namespace</span><span class="p">):</span>
        <span class="n">_get_extension_classes</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ep</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ep</span><span class="o">.</span><span class="n">module_name</span><span class="p">,</span> <span class="n">ep</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cls</span> <span class="o">=</span> <span class="n">symbol_by_name</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">SyntaxError</span><span class="p">),</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Cannot load extension </span><span class="si">%r</span><span class="s">: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">ep</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Command"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command">[docs]</a><span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">BaseCommand</span><span class="p">):</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">prog_name</span> <span class="o">=</span> <span class="s">&#39;celery&#39;</span>
    <span class="n">show_body</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">show_reply</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">option_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--quiet&#39;</span><span class="p">,</span> <span class="s">&#39;-q&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">),</span>
        <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--no-color&#39;</span><span class="p">,</span> <span class="s">&#39;-C&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">no_color</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">show_reply</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Command</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colored</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">colored</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="ow">not</span> <span class="n">no_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">stderr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">show_reply</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_reply</span> <span class="o">=</span> <span class="n">show_reply</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colored</span><span class="o">.</span><span class="n">red</span><span class="p">(</span><span class="s">&#39;Error: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">exc</span><span class="o">.</span><span class="n">status</span>

        <span class="k">return</span> <span class="n">ret</span> <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">EX_OK</span>

<div class="viewcode-block" id="Command.show_help"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.show_help">[docs]</a>    <span class="k">def</span> <span class="nf">show_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_from_argv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prog_name</span><span class="p">,</span> <span class="p">[</span><span class="n">command</span><span class="p">,</span> <span class="s">&#39;--help&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">EX_USAGE</span>
</div>
<div class="viewcode-block" id="Command.error"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Command.out"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.out">[docs]</a>    <span class="k">def</span> <span class="nf">out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="p">(</span><span class="n">fh</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Command.run_from_argv"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.run_from_argv">[docs]</a>    <span class="k">def</span> <span class="nf">run_from_argv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog_name</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prog_name</span> <span class="o">=</span> <span class="n">prog_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arglist</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_parser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prog_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">)</span>
        <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_args</span><span class="p">(</span>
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arglist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colored</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">colored</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="ow">not</span> <span class="n">options</span><span class="p">[</span><span class="s">&#39;no_color&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;quiet&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_body</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;show_body&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Command.usage"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.usage">[docs]</a>    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%%</span><span class="s">prog </span><span class="si">%s</span><span class="s"> [options] </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Command.prettify_list"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.prettify_list">[docs]</a>    <span class="k">def</span> <span class="nf">prettify_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colored</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;- empty -&#39;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">white</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">),</span> <span class="s">&#39; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">)))</span>
                            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">n</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Command.prettify_dict_ok_error"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.prettify_dict_ok_error">[docs]</a>    <span class="k">def</span> <span class="nf">prettify_dict_ok_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colored</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">green</span><span class="p">(</span><span class="s">&#39;OK&#39;</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prettify</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="s">&#39;ok&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">red</span><span class="p">(</span><span class="s">&#39;ERROR&#39;</span><span class="p">),</span>
                <span class="n">text</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prettify</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Command.say_remote_command_reply"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.say_remote_command_reply">[docs]</a>    <span class="k">def</span> <span class="nf">say_remote_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replies</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colored</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">replies</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="n">replies</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">preply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prettify</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">say_chat</span><span class="p">(</span><span class="s">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">cyan</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">&#39;: &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">status</span><span class="p">,</span>
                      <span class="n">text</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">preply</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_reply</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Command.prettify"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.prettify">[docs]</a>    <span class="k">def</span> <span class="nf">prettify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">OK</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colored</span><span class="o">.</span><span class="n">green</span><span class="p">(</span><span class="s">&#39;OK&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">OK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prettify_list</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&#39;ok&#39;</span> <span class="ow">in</span> <span class="n">n</span> <span class="ow">or</span> <span class="s">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prettify_dict_ok_error</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">OK</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">OK</span><span class="p">,</span> <span class="n">pformat</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Command.say_chat"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.say_chat">[docs]</a>    <span class="k">def</span> <span class="nf">say_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colored</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s">&#39;&lt;-&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">dirstr</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">bold</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">white</span><span class="p">(</span><span class="n">direction</span><span class="p">),</span> <span class="s">&#39; &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">dirstr</span><span class="p">,</span> <span class="n">title</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">body</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Command.description"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Command.description">[docs]</a>    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span>

</div></div>
<div class="viewcode-block" id="Delegate"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Delegate">[docs]</a><span class="k">class</span> <span class="nc">Delegate</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Delegate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">symbol_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Command</span><span class="p">)(</span><span class="n">app</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">args</span>

<div class="viewcode-block" id="Delegate.get_options"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Delegate.get_options">[docs]</a>    <span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">get_options</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Delegate.create_parser"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Delegate.create_parser">[docs]</a>    <span class="k">def</span> <span class="nf">create_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog_name</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Delegate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create_parser</span><span class="p">(</span><span class="n">prog_name</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">prepare_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Delegate.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.Delegate.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">check_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="multi"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.multi">[docs]</a><span class="k">class</span> <span class="nc">multi</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Start multiple worker instances.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="multi.get_options"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.multi.get_options">[docs]</a>    <span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">()</span>
</div>
<div class="viewcode-block" id="multi.run_from_argv"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.multi.run_from_argv">[docs]</a>    <span class="k">def</span> <span class="nf">run_from_argv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog_name</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">celery.bin.celeryd_multi</span> <span class="kn">import</span> <span class="n">MultiTool</span>
        <span class="k">return</span> <span class="n">MultiTool</span><span class="p">()</span><span class="o">.</span><span class="n">execute_from_commandline</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="n">prog_name</span><span class="p">)</span></div></div>
<span class="n">multi</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">multi</span><span class="p">)</span>


<div class="viewcode-block" id="worker"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.worker">[docs]</a><span class="k">class</span> <span class="nc">worker</span><span class="p">(</span><span class="n">Delegate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Start worker instance.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery worker --app=proj -l info</span>
<span class="sd">        celery worker -A proj -l info -Q hipri,lopri</span>

<span class="sd">        celery worker -A proj --concurrency=4</span>
<span class="sd">        celery worker -A proj --concurrency=1000 -P eventlet</span>

<span class="sd">        celery worker --autoscale=10,0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Command</span> <span class="o">=</span> <span class="s">&#39;celery.bin.celeryd:WorkerCommand&#39;</span></div>
<span class="n">worker</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="n">sortpri</span><span class="o">=</span><span class="mo">01</span><span class="p">)</span>


<div class="viewcode-block" id="events"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.events">[docs]</a><span class="k">class</span> <span class="nc">events</span><span class="p">(</span><span class="n">Delegate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Event-stream utilities.</span>

<span class="sd">    Commands::</span>

<span class="sd">        celery events --app=proj</span>
<span class="sd">            start graphical monitor (requires curses)</span>
<span class="sd">        celery events -d --app=proj</span>
<span class="sd">            dump events to screen.</span>
<span class="sd">        celery events -b amqp://</span>
<span class="sd">        celery events -C &lt;camera&gt; [options]</span>
<span class="sd">            run snapshot camera.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery events</span>
<span class="sd">        celery events -d</span>
<span class="sd">        celery events -C mod.attr -F 1.0 --detach --maxrate=100/m -l info</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Command</span> <span class="o">=</span> <span class="s">&#39;celery.bin.celeryev:EvCommand&#39;</span></div>
<span class="n">events</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">sortpri</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>


<div class="viewcode-block" id="beat"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.beat">[docs]</a><span class="k">class</span> <span class="nc">beat</span><span class="p">(</span><span class="n">Delegate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Start the celerybeat periodic task scheduler.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery beat -l info</span>
<span class="sd">        celery beat -s /var/run/celerybeat/schedule --detach</span>
<span class="sd">        celery beat -S djcelery.schedulers.DatabaseScheduler</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Command</span> <span class="o">=</span> <span class="s">&#39;celery.bin.celerybeat:BeatCommand&#39;</span></div>
<span class="n">beat</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">beat</span><span class="p">,</span> <span class="n">sortpri</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


<div class="viewcode-block" id="amqp"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.amqp">[docs]</a><span class="k">class</span> <span class="nc">amqp</span><span class="p">(</span><span class="n">Delegate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;AMQP Administration Shell.</span>

<span class="sd">    Also works for non-amqp transports.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery amqp</span>
<span class="sd">            start shell mode</span>
<span class="sd">        celery amqp help</span>
<span class="sd">            show list of commands</span>

<span class="sd">        celery amqp exchange.delete name</span>
<span class="sd">        celery amqp queue.delete queue</span>
<span class="sd">        celery amqp queue.delete queue yes yes</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Command</span> <span class="o">=</span> <span class="s">&#39;celery.bin.camqadm:AMQPAdminCommand&#39;</span></div>
<span class="n">amqp</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">amqp</span><span class="p">,</span> <span class="n">sortpri</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>


<div class="viewcode-block" id="list_"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.list_">[docs]</a><span class="k">class</span> <span class="nc">list_</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get info from broker.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery list bindings</span>

<span class="sd">    NOTE: For RabbitMQ the management plugin is required.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="s">&#39;[bindings]&#39;</span>

<div class="viewcode-block" id="list_.list_bindings"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.list_.list_bindings">[docs]</a>    <span class="k">def</span> <span class="nf">list_bindings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">management</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bindings</span> <span class="o">=</span> <span class="n">management</span><span class="o">.</span><span class="n">get_bindings</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&#39;Your transport cannot list bindings.&#39;</span><span class="p">)</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">28</span><span class="p">),</span>
                                                     <span class="n">e</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">28</span><span class="p">),</span> <span class="n">r</span><span class="p">))</span>
        <span class="n">fmt</span><span class="p">(</span><span class="s">&#39;Queue&#39;</span><span class="p">,</span> <span class="s">&#39;Exchange&#39;</span><span class="p">,</span> <span class="s">&#39;Routing Key&#39;</span><span class="p">)</span>
        <span class="n">fmt</span><span class="p">(</span><span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">:</span>
            <span class="n">fmt</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s">&#39;destination&#39;</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="s">&#39;source&#39;</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="s">&#39;routing_key&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="list_.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.list_.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;bindings&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_bindings</span><span class="p">}</span>
        <span class="n">available</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topics</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">what</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&#39;You must specify what to list (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">available</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">what</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&#39;unknown topic </span><span class="si">%r</span><span class="s"> (choose one of: </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">what</span><span class="p">,</span> <span class="n">available</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">amqp</span><span class="o">.</span><span class="n">TaskConsumer</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span><span class="o">.</span><span class="n">declare</span><span class="p">()</span>
            <span class="n">topics</span><span class="p">[</span><span class="n">what</span><span class="p">](</span><span class="n">conn</span><span class="o">.</span><span class="n">manager</span><span class="p">)</span></div></div>
<span class="n">list_</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="s">&#39;list&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="call"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.call">[docs]</a><span class="k">class</span> <span class="nc">call</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a task by name.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery call tasks.add --args=&#39;[2, 2]&#39;</span>
<span class="sd">        celery call tasks.add --args=&#39;[2, 2]&#39; --countdown=10</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="s">&#39;&lt;task_name&gt;&#39;</span>
    <span class="n">option_list</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">option_list</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--args&#39;</span><span class="p">,</span> <span class="s">&#39;-a&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;positional arguments (json).&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--kwargs&#39;</span><span class="p">,</span> <span class="s">&#39;-k&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;keyword arguments (json).&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--eta&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;scheduled time (ISO-8601).&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--countdown&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;eta in seconds from now (float/int).&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--expires&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;expiry time (ISO-8601/float/int).&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--serializer&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;defaults to json.&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--queue&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;custom queue name.&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--exchange&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;custom exchange name.&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--routing-key&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;custom routing key.&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="call.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.call.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c"># Positional args.</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;args&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">anyjson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="c"># Keyword args.</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;kwargs&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">anyjson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># Expires can be int/float.</span>
        <span class="n">expires</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;expires&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">expires</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">expires</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="c"># or a string describing an ISO 8601 datetime.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">expires</span> <span class="o">=</span> <span class="n">maybe_iso8601</span><span class="p">(</span><span class="n">expires</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">raise</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">send_task</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
                                 <span class="n">countdown</span><span class="o">=</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;countdown&#39;</span><span class="p">),</span>
                                 <span class="n">serializer</span><span class="o">=</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;serializer&#39;</span><span class="p">),</span>
                                 <span class="n">queue</span><span class="o">=</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;queue&#39;</span><span class="p">),</span>
                                 <span class="n">exchange</span><span class="o">=</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;exchange&#39;</span><span class="p">),</span>
                                 <span class="n">routing_key</span><span class="o">=</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;routing_key&#39;</span><span class="p">),</span>
                                 <span class="n">eta</span><span class="o">=</span><span class="n">maybe_iso8601</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;eta&#39;</span><span class="p">)),</span>
                                 <span class="n">expires</span><span class="o">=</span><span class="n">expires</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div></div>
<span class="n">call</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>


<div class="viewcode-block" id="purge"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.purge">[docs]</a><span class="k">class</span> <span class="nc">purge</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Erase all messages from all known task queues.</span>

<span class="sd">    WARNING: There is no undo operation for this command.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="purge.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.purge.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">queues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">amqp</span><span class="o">.</span><span class="n">queues</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">messages_removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">purge</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">messages_removed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&#39;Purged </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> from </span><span class="si">%s</span><span class="s"> known task </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">messages_removed</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">pluralize</span><span class="p">(</span><span class="n">messages_removed</span><span class="p">,</span> <span class="s">&#39;message&#39;</span><span class="p">),</span>
                <span class="n">queues</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">pluralize</span><span class="p">(</span><span class="n">queues</span><span class="p">,</span> <span class="s">&#39;queue&#39;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&#39;No messages purged from </span><span class="si">%s</span><span class="s"> known </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">queues</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">pluralize</span><span class="p">(</span><span class="n">queues</span><span class="p">,</span> <span class="s">&#39;queue&#39;</span><span class="p">)))</span></div></div>
<span class="n">purge</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">purge</span><span class="p">)</span>


<div class="viewcode-block" id="result"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.result">[docs]</a><span class="k">class</span> <span class="nc">result</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gives the return value for a given task id.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery result 8f511516-e2f5-4da4-9d2f-0fb83a86e500</span>
<span class="sd">        celery result 8f511516-e2f5-4da4-9d2f-0fb83a86e500 -t tasks.add</span>
<span class="sd">        celery result 8f511516-e2f5-4da4-9d2f-0fb83a86e500 --traceback</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="s">&#39;&lt;task_id&gt;&#39;</span>
    <span class="n">option_list</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">option_list</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--task&#39;</span><span class="p">,</span> <span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;name of task (if custom backend)&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--traceback&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                   <span class="n">help</span><span class="o">=</span><span class="s">&#39;show traceback instead&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="result.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.result.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">AsyncResult</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;task&#39;</span><span class="p">)</span>
        <span class="n">traceback</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;traceback&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">task</span><span class="p">:</span>
            <span class="n">result_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task</span><span class="p">]</span><span class="o">.</span><span class="n">AsyncResult</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result_cls</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">traceback</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">traceback</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prettify</span><span class="p">(</span><span class="n">value</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span></div></div>
<span class="n">result</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_RemoteControl</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">leaf</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">option_list</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">option_list</span> <span class="o">+</span> <span class="p">(</span>
                <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--timeout&#39;</span><span class="p">,</span> <span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;Timeout in seconds (float) waiting for reply&#39;</span><span class="p">),</span>
                <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--destination&#39;</span><span class="p">,</span> <span class="s">&#39;-d&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;Comma separated list of destination node names.&#39;</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_command_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">help</span><span class="p">:</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="n">command</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">help</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># see if it uses args.</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="n">command</span><span class="p">),</span>
                                               <span class="n">meth</span><span class="o">.</span><span class="n">__doc__</span><span class="p">),</span> <span class="n">indent</span><span class="p">),</span> <span class="n">help</span><span class="p">,</span>
            <span class="p">])</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">color</span><span class="p">(</span><span class="n">command</span><span class="p">)),</span> <span class="n">indent</span><span class="p">),</span> <span class="n">help</span><span class="p">,</span>
            <span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color</span> <span class="k">if</span> <span class="n">color</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="k">if</span> <span class="n">prefix</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_command_info</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">help</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s">&#39;[Commands]&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_commands</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%%</span><span class="s">prog </span><span class="si">%s</span><span class="s"> [options] </span><span class="si">%s</span><span class="s"> &lt;command&gt; [arg1 .. argN]&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;get_obj&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&#39;Missing </span><span class="si">%s</span><span class="s"> method. See --help&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_call_method</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_call_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;help&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&quot;Did you mean &#39;</span><span class="si">%s</span><span class="s"> --help&#39;?&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&#39;Unknown </span><span class="si">%s</span><span class="s"> method </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>

        <span class="n">destination</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;destination&#39;</span><span class="p">)</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;timeout&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">destination</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span>

        <span class="c"># XXX Python 2.5 does not support X(*args, foo=1)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;timeout&quot;</span><span class="p">:</span> <span class="n">timeout</span><span class="p">,</span> <span class="s">&quot;destination&quot;</span><span class="p">:</span> <span class="n">destination</span><span class="p">,</span>
                  <span class="s">&quot;callback&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">say_remote_command_reply</span><span class="p">}</span>
        <span class="n">replies</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replies</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&#39;No nodes replied within time constraint.&#39;</span><span class="p">,</span>
                        <span class="n">status</span><span class="o">=</span><span class="n">EX_UNAVAILABLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">replies</span>

    <span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colored</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s">&#39;&lt;-&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">dirstr</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">bold</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">white</span><span class="p">(</span><span class="n">direction</span><span class="p">),</span> <span class="s">&#39; &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">dirstr</span><span class="p">,</span> <span class="n">title</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">body</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>


<div class="viewcode-block" id="inspect"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.inspect">[docs]</a><span class="k">class</span> <span class="nc">inspect</span><span class="p">(</span><span class="n">_RemoteControl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inspect the worker at runtime.</span>

<span class="sd">    Availability: RabbitMQ (amqp), Redis, and MongoDB transports.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery inspect active --timeout=5</span>
<span class="sd">        celery inspect scheduled -d worker1.example.com</span>
<span class="sd">        celery inspect revoked -d w1.e.com,w2.e.com</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;inspect&#39;</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;active&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;dump active tasks (being processed)&#39;</span><span class="p">),</span>
        <span class="s">&#39;active_queues&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;dump queues being consumed from&#39;</span><span class="p">),</span>
        <span class="s">&#39;scheduled&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;dump scheduled tasks (eta/countdown/retry)&#39;</span><span class="p">),</span>
        <span class="s">&#39;reserved&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;dump reserved tasks (waiting to be processed)&#39;</span><span class="p">),</span>
        <span class="s">&#39;stats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;dump worker statistics&#39;</span><span class="p">),</span>
        <span class="s">&#39;revoked&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;dump of revoked task ids&#39;</span><span class="p">),</span>
        <span class="s">&#39;registered&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;dump of registered tasks&#39;</span><span class="p">),</span>
        <span class="s">&#39;ping&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="s">&#39;ping worker(s)&#39;</span><span class="p">),</span>
        <span class="s">&#39;report&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;get bugreport info&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="inspect.call"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.inspect.call">[docs]</a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div></div>
<span class="n">inspect</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">inspect</span><span class="p">)</span>


<div class="viewcode-block" id="control"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.control">[docs]</a><span class="k">class</span> <span class="nc">control</span><span class="p">(</span><span class="n">_RemoteControl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Workers remote control.</span>

<span class="sd">    Availability: RabbitMQ (amqp), Redis, and MongoDB transports.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery control enable_events --timeout=5</span>
<span class="sd">        celery control -d worker1.example.com enable_events</span>
<span class="sd">        celery control -d w1.e.com,w2.e.com enable_events</span>

<span class="sd">        celery control -d w1.e.com add_consumer queue_name</span>
<span class="sd">        celery control -d w1.e.com cancel_consumer queue_name</span>

<span class="sd">        celery control -d w1.e.com add_consumer queue exchange direct rkey</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;control&#39;</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;enable_events&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;tell worker(s) to enable events&#39;</span><span class="p">),</span>
        <span class="s">&#39;disable_events&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;tell worker(s) to disable events&#39;</span><span class="p">),</span>
        <span class="s">&#39;add_consumer&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;tell worker(s) to start consuming a queue&#39;</span><span class="p">),</span>
        <span class="s">&#39;cancel_consumer&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;tell worker(s) to stop consuming a queue&#39;</span><span class="p">),</span>
        <span class="s">&#39;rate_limit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="s">&#39;tell worker(s) to modify the rate limit for a task type&#39;</span><span class="p">),</span>
        <span class="s">&#39;time_limit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="s">&#39;tell worker(s) to modify the time limit for a task type.&#39;</span><span class="p">),</span>
        <span class="s">&#39;autoscale&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;change autoscale settings&#39;</span><span class="p">),</span>
        <span class="s">&#39;pool_grow&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;start more pool processes&#39;</span><span class="p">),</span>
        <span class="s">&#39;pool_shrink&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;use less pool processes&#39;</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="control.call"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.control.call">[docs]</a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c"># XXX Python 2.5 doesn&#39;t support X(*args, reply=True, **kwargs)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="control.pool_grow"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.control.pool_grow">[docs]</a>    <span class="k">def</span> <span class="nf">pool_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[N=1]&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="control.pool_shrink"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.control.pool_shrink">[docs]</a>    <span class="k">def</span> <span class="nf">pool_shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[N=1]&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="control.autoscale"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.control.autoscale">[docs]</a>    <span class="k">def</span> <span class="nf">autoscale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[max] [min]&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="control.rate_limit"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.control.rate_limit">[docs]</a>    <span class="k">def</span> <span class="nf">rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">rate_limit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&lt;task_name&gt; &lt;rate_limit&gt; (e.g. 5/s | 5/m | 5/h)&gt;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">rate_limit</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="control.time_limit"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.control.time_limit">[docs]</a>    <span class="k">def</span> <span class="nf">time_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">soft</span><span class="p">,</span> <span class="n">hard</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&lt;task_name&gt; &lt;soft_secs&gt; [hard_secs]&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">soft</span><span class="p">,</span> <span class="n">hard</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="control.add_consumer"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.control.add_consumer">[docs]</a>    <span class="k">def</span> <span class="nf">add_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">exchange_type</span><span class="o">=</span><span class="s">&#39;direct&#39;</span><span class="p">,</span> <span class="n">routing_key</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&lt;queue&gt; [exchange [type [routing_key]]]&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">exchange</span><span class="p">,</span>
                         <span class="n">exchange_type</span><span class="p">,</span> <span class="n">routing_key</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="control.cancel_consumer"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.control.cancel_consumer">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&lt;queue&gt;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>
<span class="n">control</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>


<div class="viewcode-block" id="status"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.status">[docs]</a><span class="k">class</span> <span class="nc">status</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Show list of workers that are online.&quot;&quot;&quot;</span>
    <span class="n">option_list</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">option_list</span>

<div class="viewcode-block" id="status.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.status.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">replies</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span>
                          <span class="n">no_color</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;no_color&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
                          <span class="n">stdout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                          <span class="n">show_reply</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> \
                    <span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;ping&#39;</span><span class="p">,</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">show_body</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replies</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&#39;No nodes replied within time constraint&#39;</span><span class="p">,</span>
                        <span class="n">status</span><span class="o">=</span><span class="n">EX_UNAVAILABLE</span><span class="p">)</span>
        <span class="n">nodecount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">replies</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;quiet&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> online.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nodecount</span><span class="p">,</span>
                                          <span class="n">text</span><span class="o">.</span><span class="n">pluralize</span><span class="p">(</span><span class="n">nodecount</span><span class="p">,</span> <span class="s">&#39;node&#39;</span><span class="p">)))</span></div></div>
<span class="n">status</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>


<div class="viewcode-block" id="migrate"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.migrate">[docs]</a><span class="k">class</span> <span class="nc">migrate</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Migrate tasks from one broker to another.</span>

<span class="sd">    Examples::</span>

<span class="sd">        celery migrate redis://localhost amqp://guest@localhost//</span>
<span class="sd">        celery migrate django:// redis://localhost</span>

<span class="sd">    NOTE: This command is experimental, make sure you have</span>
<span class="sd">          a backup of the tasks before you continue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="s">&#39;&lt;source_url&gt; &lt;dest_url&gt;&#39;</span>
    <span class="n">option_list</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">option_list</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--limit&#39;</span><span class="p">,</span> <span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;Number of tasks to consume (int)&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--timeout&#39;</span><span class="p">,</span> <span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;Timeout in seconds (float) waiting for tasks&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--ack-messages&#39;</span><span class="p">,</span> <span class="s">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;Ack messages from source broker.&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--tasks&#39;</span><span class="p">,</span> <span class="s">&#39;-T&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;List of task names to filter on.&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--queues&#39;</span><span class="p">,</span> <span class="s">&#39;-Q&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;List of queues to migrate.&#39;</span><span class="p">),</span>
            <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--forever&#39;</span><span class="p">,</span> <span class="s">&#39;-F&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;Continually migrate tasks until killed.&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="migrate.on_migrate_task"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.migrate.on_migrate_task">[docs]</a>    <span class="k">def</span> <span class="nf">on_migrate_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&#39;Migrating task </span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">strtotal</span><span class="p">,</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;task&#39;</span><span class="p">],</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="migrate.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.migrate.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_help</span><span class="p">(</span><span class="s">&#39;migrate&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">kombu</span> <span class="kn">import</span> <span class="n">Connection</span>
        <span class="kn">from</span> <span class="nn">celery.contrib.migrate</span> <span class="kn">import</span> <span class="n">migrate_tasks</span>

        <span class="n">migrate_tasks</span><span class="p">(</span><span class="n">Connection</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                      <span class="n">Connection</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                      <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_migrate_task</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>
<span class="n">migrate</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">migrate</span><span class="p">)</span>


<div class="viewcode-block" id="shell"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.shell">[docs]</a><span class="k">class</span> <span class="nc">shell</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>  <span class="c"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Start shell session with convenient access to celery symbols.</span>

<span class="sd">    The following symbols will be added to the main globals:</span>

<span class="sd">        - celery:  the current application.</span>
<span class="sd">        - chord, group, chain, chunks,</span>
<span class="sd">          xmap, xstarmap subtask, Task</span>
<span class="sd">        - all registered tasks.</span>

<span class="sd">    Example Session::</span>

<span class="sd">        $ celery shell</span>

<span class="sd">        &gt;&gt;&gt; celery</span>
<span class="sd">        &lt;Celery default:0x1012d9fd0&gt;</span>
<span class="sd">        &gt;&gt;&gt; add</span>
<span class="sd">        &lt;@task: tasks.add&gt;</span>
<span class="sd">        &gt;&gt;&gt; add.delay(2, 2)</span>
<span class="sd">        &lt;AsyncResult: 537b48c7-d6d3-427a-a24a-d1b4414035be&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">option_list</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">option_list</span> <span class="o">+</span> <span class="p">(</span>
                <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--ipython&#39;</span><span class="p">,</span> <span class="s">&#39;-I&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;force_ipython&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;force iPython.&#39;</span><span class="p">),</span>
                <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--bpython&#39;</span><span class="p">,</span> <span class="s">&#39;-B&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;force_bpython&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;force bpython.&#39;</span><span class="p">),</span>
                <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--python&#39;</span><span class="p">,</span> <span class="s">&#39;-P&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;force_python&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;force default Python shell.&#39;</span><span class="p">),</span>
                <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--without-tasks&#39;</span><span class="p">,</span> <span class="s">&#39;-T&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;don&#39;t add tasks to locals.&quot;</span><span class="p">),</span>
                <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--eventlet&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;use eventlet.&#39;</span><span class="p">),</span>
                <span class="n">Option</span><span class="p">(</span><span class="s">&#39;--gevent&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;use gevent.&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="shell.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.shell.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_ipython</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force_bpython</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">force_python</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">without_tasks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">eventlet</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">gevent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">eventlet</span><span class="p">:</span>
            <span class="n">import_module</span><span class="p">(</span><span class="s">&#39;celery.concurrency.eventlet&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gevent</span><span class="p">:</span>
            <span class="n">import_module</span><span class="p">(</span><span class="s">&#39;celery.concurrency.gevent&#39;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">celery</span>
        <span class="kn">import</span> <span class="nn">celery.task.base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">import_default_modules</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locals</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;celery&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span>
                       <span class="s">&#39;Task&#39;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">Task</span><span class="p">,</span>
                       <span class="s">&#39;chord&#39;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">chord</span><span class="p">,</span>
                       <span class="s">&#39;group&#39;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">group</span><span class="p">,</span>
                       <span class="s">&#39;chain&#39;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span>
                       <span class="s">&#39;chunks&#39;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">chunks</span><span class="p">,</span>
                       <span class="s">&#39;xmap&#39;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">xmap</span><span class="p">,</span>
                       <span class="s">&#39;xstarmap&#39;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">xstarmap</span><span class="p">,</span>
                       <span class="s">&#39;subtask&#39;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">subtask</span><span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">without_tasks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">task</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">itervalues</span><span class="p">()</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;celery.&#39;</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">force_python</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_fallback_shell</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">force_bpython</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_bpython_shell</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">force_ipython</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_ipython_shell</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_default_shell</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="shell.invoke_default_shell"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.shell.invoke_default_shell">[docs]</a>    <span class="k">def</span> <span class="nf">invoke_default_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">IPython</span>  <span class="c"># noqa</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">bpython</span>  <span class="c"># noqa</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_fallback_shell</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_bpython_shell</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_ipython_shell</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="shell.invoke_fallback_shell"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.shell.invoke_fallback_shell">[docs]</a>    <span class="k">def</span> <span class="nf">invoke_fallback_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">code</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">readline</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">rlcompleter</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">set_completer</span><span class="p">(</span>
                    <span class="n">rlcompleter</span><span class="o">.</span><span class="n">Completer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locals</span><span class="p">)</span><span class="o">.</span><span class="n">complete</span><span class="p">)</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s">&#39;tab:complete&#39;</span><span class="p">)</span>
        <span class="n">code</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locals</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="shell.invoke_ipython_shell"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.shell.invoke_ipython_shell">[docs]</a>    <span class="k">def</span> <span class="nf">invoke_ipython_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">IPython.frontend.terminal</span> <span class="kn">import</span> <span class="n">embed</span>
            <span class="n">embed</span><span class="o">.</span><span class="n">TerminalInteractiveShell</span><span class="p">(</span><span class="n">user_ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locals</span><span class="p">)</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c"># ipython &lt; 0.11</span>
            <span class="kn">from</span> <span class="nn">IPython.Shell</span> <span class="kn">import</span> <span class="n">IPShell</span>
            <span class="n">IPShell</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="n">user_ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locals</span><span class="p">)</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="shell.invoke_bpython_shell"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.shell.invoke_bpython_shell">[docs]</a>    <span class="k">def</span> <span class="nf">invoke_bpython_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">bpython</span>
        <span class="n">bpython</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locals</span><span class="p">)</span>
</div></div>
<span class="n">shell</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">shell</span><span class="p">)</span>


<div class="viewcode-block" id="help"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.help">[docs]</a><span class="k">class</span> <span class="nc">help</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Show help screen and exit.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="help.usage"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.help.usage">[docs]</a>    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%%</span><span class="s">prog &lt;command&gt; [options] </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="help.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.help.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">HELP</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;prog_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_name</span><span class="p">,</span>
                         <span class="s">&#39;commands&#39;</span><span class="p">:</span> <span class="n">CeleryCommand</span><span class="o">.</span><span class="n">list_commands</span><span class="p">()})</span>

        <span class="k">return</span> <span class="n">EX_USAGE</span></div></div>
<span class="n">help</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">help</span><span class="p">)</span>


<div class="viewcode-block" id="report"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.report">[docs]</a><span class="k">class</span> <span class="nc">report</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shows information useful to include in bugreports.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="report.run"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.report.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">bugreport</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">EX_OK</span></div></div>
<span class="n">report</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>


<div class="viewcode-block" id="CeleryCommand"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.CeleryCommand">[docs]</a><span class="k">class</span> <span class="nc">CeleryCommand</span><span class="p">(</span><span class="n">BaseCommand</span><span class="p">):</span>
    <span class="n">commands</span> <span class="o">=</span> <span class="n">commands</span>
    <span class="n">enable_config_from_cmdline</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">prog_name</span> <span class="o">=</span> <span class="s">&#39;celery&#39;</span>

<div class="viewcode-block" id="CeleryCommand.execute"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.CeleryCommand.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">argv</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="n">command</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">cls</span><span class="p">,</span> <span class="n">argv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;help&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;help&#39;</span><span class="p">]</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;help&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span><span class="o">.</span><span class="n">run_from_argv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prog_name</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;help&#39;</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CeleryCommand.remove_options_at_beginning"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.CeleryCommand.remove_options_at_beginning">[docs]</a>    <span class="k">def</span> <span class="nf">remove_options_at_beginning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">argv</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">):</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">argv</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="CeleryCommand.handle_argv"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.CeleryCommand.handle_argv">[docs]</a>    <span class="k">def</span> <span class="nf">handle_argv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog_name</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prog_name</span> <span class="o">=</span> <span class="n">prog_name</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_options_at_beginning</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">argv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_args</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">command</span><span class="p">,</span> <span class="n">argv</span> <span class="o">=</span> <span class="s">&#39;help&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;help&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CeleryCommand.execute_from_commandline"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.CeleryCommand.execute_from_commandline">[docs]</a>    <span class="k">def</span> <span class="nf">execute_from_commandline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">determine_exit_status</span><span class="p">(</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">CeleryCommand</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">execute_from_commandline</span><span class="p">(</span><span class="n">argv</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">EX_FAILURE</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="CeleryCommand.get_command_info"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.CeleryCommand.get_command_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_command_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">colored</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">colored</span><span class="p">()</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="k">if</span> <span class="n">color</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="n">command</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">leaf</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;celery </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">colored</span><span class="p">(</span><span class="n">command</span><span class="p">),</span> <span class="n">indent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s">&#39; &#39;</span><span class="p">,</span>
            <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;celery </span><span class="si">%s</span><span class="s"> --help&#39;</span> <span class="o">%</span> <span class="n">colored</span><span class="p">(</span><span class="n">command</span><span class="p">),</span> <span class="n">indent</span><span class="p">),</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">list_commands</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="s">&#39;celery </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">command</span><span class="p">,</span> <span class="n">colored</span><span class="p">),</span>
        <span class="p">])</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="CeleryCommand.list_commands"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.CeleryCommand.list_commands">[docs]</a>    <span class="k">def</span> <span class="nf">list_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">white</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">colored</span><span class="p">()</span><span class="o">.</span><span class="n">white</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cls</span><span class="p">,</span> <span class="n">commands</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">command_classes</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                <span class="n">text</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;+ </span><span class="si">%s</span><span class="s">: &#39;</span> <span class="o">%</span> <span class="n">white</span><span class="p">(</span><span class="n">cls</span><span class="p">),</span> <span class="n">indent</span><span class="p">),</span>
                <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_command_info</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">),</span>
                <span class="s">&#39;&#39;</span>
            <span class="p">])</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="CeleryCommand.with_pool_option"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.CeleryCommand.with_pool_option">[docs]</a>    <span class="k">def</span> <span class="nf">with_pool_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;worker&#39;</span><span class="p">:</span>
            <span class="c"># this command supports custom pools</span>
            <span class="c"># that may have to be loaded as early as possible.</span>
            <span class="k">return</span> <span class="p">([</span><span class="s">&#39;-P&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;--pool&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="CeleryCommand.on_concurrency_setup"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.CeleryCommand.on_concurrency_setup">[docs]</a>    <span class="k">def</span> <span class="nf">on_concurrency_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">load_extension_commands</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="determine_exit_status"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.determine_exit_status">[docs]</a><span class="k">def</span> <span class="nf">determine_exit_status</span><span class="p">(</span><span class="n">ret</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">return</span> <span class="n">EX_OK</span> <span class="k">if</span> <span class="n">ret</span> <span class="k">else</span> <span class="n">EX_FAILURE</span>

</div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../api/celery.bin.celery.html#celery.bin.celery.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c"># Fix for setuptools generated scripts, so that it will</span>
    <span class="c"># work with multiprocessing fork emulation.</span>
    <span class="c"># (see multiprocessing.forking.get_preparation_data())</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">__name__</span> <span class="o">!=</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>  <span class="c"># pragma: no cover</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;__main__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">]</span>
        <span class="n">freeze_support</span><span class="p">()</span>
        <span class="n">CeleryCommand</span><span class="p">()</span><span class="o">.</span><span class="n">execute_from_commandline</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">pass</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>          <span class="c"># pragma: no cover</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>