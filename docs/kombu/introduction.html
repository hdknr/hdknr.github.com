

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>kombu - Messaging Framework for Python &mdash; Kombu Docs 1 documentation</title>
    
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/theme_extras.js"></script>
    <link rel="top" title="Kombu Docs 1 documentation" href="index.html" />
    <link rel="next" title="User Guide" href="userguide/index.html" />
    <link rel="prev" title="Kombu Documentation" href="index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Kombu Docs 1 documentation</span></a></h1>
        <h2 class="heading"><span>kombu - Messaging Framework for Python</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="index.html">Kombu Documentation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="userguide/index.html">User Guide</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="kombu-messaging-framework-for-python">
<h1>kombu - Messaging Framework for Python<a class="headerlink" href="#kombu-messaging-framework-for-python" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">2.3.2</td>
</tr>
</tbody>
</table>
<p><cite>Kombu</cite> is a messaging framework for Python.</p>
<p>The aim of <cite>Kombu</cite> is to make messaging in Python as easy as possible by
providing an idiomatic high-level interface for the AMQ protocol, and also
provide proven and tested solutions to common messaging problems.</p>
<p><a class="reference external" href="http://amqp.org">AMQP</a> is the Advanced Message Queuing Protocol, an open standard protocol
for message orientation, queuing, routing, reliability and security,
for which the <a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a> messaging server is the most popular implementation.</p>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Allows application authors to support several message server
solutions by using pluggable transports.</p>
<blockquote>
<div><ul>
<li><p class="first">AMQP transports for both the <a class="reference external" href="http://barryp.org/software/py-amqplib/">amqplib</a> (sync) and
<a class="reference external" href="http://github.com/pika/pika">pika</a> (sync + async) clients.</p>
</li>
<li><p class="first">Fast AMQP transport using <a class="reference external" href="http://pypi.python.org/pypi/librabbitmq">librabbitmq</a>, written in C.</p>
<p>This is automatically enabled if librabbitmq is installed:</p>
<div class="highlight-python"><pre>$ pip install librabbitmq</pre>
</div>
</li>
<li><p class="first">Virtual transports makes it really easy to add support for non-AMQP
transports.  There is already built-in support for <a class="reference external" href="http://code.google.com/p/redis/">Redis</a>,
<a class="reference external" href="http://kr.github.com/beanstalkd/">Beanstalk</a>, <a class="reference external" href="http://aws.amazon.com/sqs/">Amazon SQS</a>, <a class="reference external" href="http://couchdb.apache.org/">CouchDB</a>, <a class="reference external" href="http://www.mongodb.org/">MongoDB</a> and <a class="reference external" href="https://zookeeper.apache.org/">ZooKeeper</a>.</p>
</li>
<li><p class="first">You can also use the SQLAlchemy and Django ORM transports to
use a database as the broker.</p>
</li>
<li><p class="first">In-memory transport for unit testing.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Supports automatic encoding, serialization and compression of message
payloads.</p>
</li>
<li><p class="first">Consistent exception handling across transports.</p>
</li>
<li><p class="first">The ability to ensure that an operation is performed by gracefully
handling connection and channel errors.</p>
</li>
<li><p class="first">Several annoyances with <a class="reference external" href="http://barryp.org/software/py-amqplib/">amqplib</a> has been fixed, like supporting
timeouts and the ability to wait for events on more than one channel.</p>
</li>
<li><p class="first">Projects already using <a class="reference external" href="http://pypi.python.org/pypi/carrot/">carrot</a> can easily be ported by using
a compatibility layer.</p>
</li>
</ul>
<p>For an introduction to AMQP you should read the article <a class="reference external" href="http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/">Rabbits and warrens</a>,
and the <a class="reference external" href="http://en.wikipedia.org/wiki/AMQP">Wikipedia article about AMQP</a>.</p>
</div>
<div class="section" id="transport-comparison">
<h2>Transport Comparison<a class="headerlink" href="#transport-comparison" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="16%" />
<col width="19%" />
<col width="19%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Client</strong></td>
<td><strong>Type</strong></td>
<td><strong>Direct</strong></td>
<td><strong>Topic</strong></td>
<td><strong>Fanout</strong></td>
</tr>
<tr class="row-even"><td><em>amqplib</em></td>
<td>Native</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td><em>pika</em></td>
<td>Native</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td><em>redis</em></td>
<td>Virtual</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes (PUB/SUB)</td>
</tr>
<tr class="row-odd"><td><em>mongodb</em></td>
<td>Virtual</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td><em>beanstalk</em></td>
<td>Virtual</td>
<td>Yes</td>
<td>Yes <a class="footnote-reference" href="#f1" id="id1">[1]</a></td>
<td>No</td>
</tr>
<tr class="row-odd"><td><em>SQS</em></td>
<td>Virtual</td>
<td>Yes</td>
<td>Yes <a class="footnote-reference" href="#f1" id="id2">[1]</a></td>
<td>Yes <a class="footnote-reference" href="#f2" id="id3">[2]</a></td>
</tr>
<tr class="row-even"><td><em>couchdb</em></td>
<td>Virtual</td>
<td>Yes</td>
<td>Yes <a class="footnote-reference" href="#f1" id="id4">[1]</a></td>
<td>No</td>
</tr>
<tr class="row-odd"><td><em>zookeeper</em></td>
<td>Virtual</td>
<td>Yes</td>
<td>Yes <a class="footnote-reference" href="#f1" id="id5">[1]</a></td>
<td>No</td>
</tr>
<tr class="row-even"><td><em>in-memory</em></td>
<td>Virtual</td>
<td>Yes</td>
<td>Yes <a class="footnote-reference" href="#f1" id="id6">[1]</a></td>
<td>No</td>
</tr>
<tr class="row-odd"><td><em>django</em></td>
<td>Virtual</td>
<td>Yes</td>
<td>Yes <a class="footnote-reference" href="#f1" id="id7">[1]</a></td>
<td>No</td>
</tr>
<tr class="row-even"><td><em>sqlalchemy</em></td>
<td>Virtual</td>
<td>Yes</td>
<td>Yes <a class="footnote-reference" href="#f1" id="id8">[1]</a></td>
<td>No</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>, <a class="fn-backref" href="#id4">3</a>, <a class="fn-backref" href="#id5">4</a>, <a class="fn-backref" href="#id6">5</a>, <a class="fn-backref" href="#id7">6</a>, <a class="fn-backref" href="#id8">7</a>)</em> Declarations only kept in memory, so exchanges/queues
must be declared by all clients that needs them.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>Fanout supported via storing routing tables in SimpleDB.
Disabled by default, but can be enabled by using the
<tt class="docutils literal"><span class="pre">supports_fanout</span></tt> transport option.</td></tr>
</tbody>
</table>
<div class="section" id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<p>Kombu is using Sphinx, and the latest documentation can be found here:</p>
<blockquote>
<div><a class="reference external" href="http://kombu.readthedocs.org/">http://kombu.readthedocs.org/</a></div></blockquote>
</div>
<div class="section" id="quick-overview">
<h3>Quick overview<a class="headerlink" href="#quick-overview" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">kombu</span> <span class="kn">import</span> <span class="n">Connection</span><span class="p">,</span> <span class="n">Exchange</span><span class="p">,</span> <span class="n">Queue</span>

<span class="n">media_exchange</span> <span class="o">=</span> <span class="n">Exchange</span><span class="p">(</span><span class="s">&#39;media&#39;</span><span class="p">,</span> <span class="s">&#39;direct&#39;</span><span class="p">,</span> <span class="n">durable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">video_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&#39;video&#39;</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="n">media_exchange</span><span class="p">,</span> <span class="n">routing_key</span><span class="o">=</span><span class="s">&#39;video&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">process_media</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">body</span>
    <span class="n">message</span><span class="o">.</span><span class="n">ack</span><span class="p">()</span>

<span class="c"># connections</span>
<span class="k">with</span> <span class="n">Connection</span><span class="p">(</span><span class="s">&#39;amqp://guest:guest@localhost//&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>

    <span class="c"># produce</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">Producer</span><span class="p">(</span><span class="n">serializer</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">producer</span><span class="p">:</span>
        <span class="n">producer</span><span class="o">.</span><span class="n">publish</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;/tmp/lolcat1.avi&#39;</span><span class="p">,</span> <span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="mi">1301013</span><span class="p">},</span>
                         <span class="n">exchange</span><span class="o">=</span><span class="n">media_exchange</span><span class="p">,</span> <span class="n">routing_key</span><span class="o">=</span><span class="s">&#39;video&#39;</span><span class="p">,</span>
                         <span class="n">declare</span><span class="o">=</span><span class="p">[</span><span class="n">video_queue</span><span class="p">])</span>

    <span class="c"># the declare above, makes sure the video queue is declared</span>
    <span class="c"># so that the messages can be delivered.</span>
    <span class="c"># It&#39;s a best practice in Kombu to have both publishers and</span>
    <span class="c"># consumers declare the queue.  You can also declare the</span>
    <span class="c"># queue manually using:</span>
    <span class="c">#     video_queue(conn).declare()</span>

    <span class="c"># consume</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">Consumer</span><span class="p">(</span><span class="n">video_queue</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">process_media</span><span class="p">])</span> <span class="k">as</span> <span class="n">consumer</span><span class="p">:</span>
        <span class="c"># Process messages and handle events on all channels</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">drain_events</span><span class="p">()</span>

<span class="c"># Consume from several queues on the same channel:</span>
<span class="n">video_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&#39;video&#39;</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="n">media_exchange</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">&#39;video&#39;</span><span class="p">)</span>
<span class="n">image_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="n">media_exchange</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">&#39;image&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">Consumer</span><span class="p">([</span><span class="n">video_queue</span><span class="p">,</span> <span class="n">image_queue</span><span class="p">],</span>
                         <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">process_media</span><span class="p">])</span> <span class="k">as</span> <span class="n">consumer</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">drain_events</span><span class="p">()</span>
</pre></div>
</div>
<p>Or handle channels manually:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">channel</span><span class="p">()</span> <span class="k">as</span> <span class="n">channel</span><span class="p">:</span>
    <span class="n">producer</span> <span class="o">=</span> <span class="n">Producer</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="n">consumer</span> <span class="o">=</span> <span class="n">Producer</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
</pre></div>
</div>
<p>All objects can be used outside of with statements too,
just remember to close the objects after use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">kombu</span> <span class="kn">import</span> <span class="n">Connection</span><span class="p">,</span> <span class="n">Consumer</span><span class="p">,</span> <span class="n">Producer</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">()</span>
    <span class="c"># ...</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">consumer</span> <span class="o">=</span> <span class="n">Consumer</span><span class="p">(</span><span class="n">channel_or_connection</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">consumer</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">my_callback</span><span class="p">)</span>
<span class="n">consumer</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
    <span class="c"># ....</span>
<span class="n">consumer</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>


<span class="n">producer</span> <span class="o">=</span> <span class="n">Producer</span><span class="p">(</span><span class="n">channel_or_connection</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="c"># ....</span>
<span class="n">producer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p><cite>Exchange</cite> and <cite>Queue</cite> are simply declarations that can be pickled
and used in configuration files etc.</p>
<p>They also support operations, but to do so they need to be bound
to a channel.</p>
<p>Binding exchanges and queues to a connection will make it use
that connections default channel.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">exchange</span> <span class="o">=</span> <span class="n">Exchange</span><span class="p">(</span><span class="s">&#39;tasks&#39;</span><span class="p">,</span> <span class="s">&#39;direct&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bound_exchange</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bound_exchange</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="go"># the original exchange is not affected, and stays unbound.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exchange</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="go">raise NotBoundError: Can&#39;t call delete on Exchange not bound to</span>
<span class="go">    a channel.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>You can install <cite>Kombu</cite> either via the Python Package Index (PyPI)
or from source.</p>
<p>To install using <cite>pip</cite>,:</p>
<div class="highlight-python"><pre>$ pip install kombu</pre>
</div>
<p>To install using <cite>easy_install</cite>,:</p>
<div class="highlight-python"><pre>$ easy_install kombu</pre>
</div>
<p>If you have downloaded a source tarball you can install it
by doing the following,:</p>
<div class="highlight-python"><pre>$ python setup.py build
# python setup.py install # as root</pre>
</div>
</div>
<div class="section" id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<p>There are some concepts you should be familiar with before starting:</p>
<blockquote>
<div><ul>
<li><p class="first">Producers</p>
<blockquote>
<div><p>Producers sends messages to an exchange.</p>
</div></blockquote>
</li>
<li><p class="first">Exchanges</p>
<blockquote>
<div><p>Messages are sent to exchanges. Exchanges are named and can be
configured to use one of several routing algorithms. The exchange
routes the messages to consumers by matching the routing key in the
message with the routing key the consumer provides when binding to
the exchange.</p>
</div></blockquote>
</li>
<li><p class="first">Consumers</p>
<blockquote>
<div><p>Consumers declares a queue, binds it to a exchange and receives
messages from it.</p>
</div></blockquote>
</li>
<li><p class="first">Queues</p>
<blockquote>
<div><p>Queues receive messages sent to exchanges. The queues are declared
by consumers.</p>
</div></blockquote>
</li>
<li><p class="first">Routing keys</p>
<blockquote>
<div><p>Every message has a routing key.  The interpretation of the routing
key depends on the exchange type. There are four default exchange
types defined by the AMQP standard, and vendors can define custom
types (so see your vendors manual for details).</p>
<p>These are the default exchange types defined by AMQP/0.8:</p>
<blockquote>
<div><ul>
<li><p class="first">Direct exchange</p>
<blockquote>
<div><p>Matches if the routing key property of the message and
the <cite>routing_key</cite> attribute of the consumer are identical.</p>
</div></blockquote>
</li>
<li><p class="first">Fan-out exchange</p>
<blockquote>
<div><p>Always matches, even if the binding does not have a routing
key.</p>
</div></blockquote>
</li>
<li><p class="first">Topic exchange</p>
<blockquote>
<div><p>Matches the routing key property of the message by a primitive
pattern matching scheme. The message routing key then consists
of words separated by dots (<cite>&#8221;.&#8221;</cite>, like domain names), and
two special characters are available; star (<cite>&#8220;*&#8221;</cite>) and hash
(<cite>&#8220;#&#8221;</cite>). The star matches any word, and the hash matches
zero or more words. For example <cite>&#8220;*.stock.#&#8221;</cite> matches the
routing keys <cite>&#8220;usd.stock&#8221;</cite> and <cite>&#8220;eur.stock.db&#8221;</cite> but not
<cite>&#8220;stock.nasdaq&#8221;</cite>.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="getting-help">
<h2>Getting Help<a class="headerlink" href="#getting-help" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mailing-list">
<h3>Mailing list<a class="headerlink" href="#mailing-list" title="Permalink to this headline">¶</a></h3>
<p>Join the <a class="reference external" href="http://groups.google.com/group/carrot-users/">carrot-users</a> mailing list.</p>
</div>
</div>
<div class="section" id="bug-tracker">
<h2>Bug tracker<a class="headerlink" href="#bug-tracker" title="Permalink to this headline">¶</a></h2>
<p>If you have any suggestions, bug reports or annoyances please report them
to our issue tracker at <a class="reference external" href="http://github.com/celery/kombu/issues/">http://github.com/celery/kombu/issues/</a></p>
</div>
<div class="section" id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p>Development of <cite>Kombu</cite> happens at Github: <a class="reference external" href="http://github.com/celery/kombu">http://github.com/celery/kombu</a></p>
<p>You are highly encouraged to participate in the development. If you don&#8217;t
like Github (for some reason) you&#8217;re welcome to send regular patches.</p>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>This software is licensed under the <cite>New BSD License</cite>. See the <cite>LICENSE</cite>
file in the top distribution directory for the full license text.</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a href="/">Home</a>:
        «&#160;&#160;<a href="index.html">Kombu Documentation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="userguide/index.html">User Guide</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, HDKNR.COM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/3c28de26aac2.
    </div>
  </body>
</html>